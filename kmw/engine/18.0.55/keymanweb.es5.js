(function(){var Er=Object.create;var ln=Object.defineProperty;var Ar=Object.getOwnPropertyDescriptor;var Wr=Object.getOwnPropertyNames;var Hr=Object.getPrototypeOf,Nr=Object.prototype.hasOwnProperty;var Gi=function(c,t){return function(){return t||c((t={exports:{}}).exports,t),t.exports}},pi=function(c,t){for(var e in t)ln(c,e,{get:t[e],enumerable:!0})},rn=function(c,t,e,n){if(t&&typeof t=="object"||typeof t=="function")for(var i=Wr(t),r=0,l=i.length,s;r<l;r++)s=i[r],!Nr.call(c,s)&&s!==e&&ln(c,s,{get:function(o){return t[o]}.bind(null,s),enumerable:!(n=Ar(t,s))||n.enumerable});return c},sn=function(c,t,e){return rn(c,t,"default"),e&&rn(e,t,"default")},on=function(c,t,e){return e=c!=null?Er(Hr(c)):{},rn(t||!c||!c.__esModule?ln(e,"default",{value:c,enumerable:!0}):e,c)};var gn=Gi(function(Io,Xt){var Vi,mi,Xi,Zi,fi,vi,an,Li,Si,mt;(function(c){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(n){c(e(t,e(n)))}):typeof Xt=="object"&&typeof Xt.exports=="object"?c(e(t,e(Xt.exports))):c(e(t));function e(n,i){return n!==t&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(r,l){return n[r]=i?i(r,l):l}}})(function(c){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])};Vi=function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function i(){this.constructor=e}e.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)},mi=Object.assign||function(e){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var l in n)Object.prototype.hasOwnProperty.call(n,l)&&(e[l]=n[l])}return e},Xi=function(e,n,i,r){var l=arguments.length,s=l<3?n:r===null?r=Object.getOwnPropertyDescriptor(n,i):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,n,i,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(l<3?o(s):l>3?o(n,i,s):o(n,i))||s);return l>3&&s&&Object.defineProperty(n,i,s),s},Zi=function(e,n,i,r){function l(s){return s instanceof i?s:new i(function(o){o(s)})}return new(i||(i=Promise))(function(s,o){function a(F){try{d(r.next(F))}catch(u){o(u)}}function g(F){try{d(r.throw(F))}catch(u){o(u)}}function d(F){F.done?s(F.value):l(F.value).then(a,g)}d((r=r.apply(e,n||[])).next())})},fi=function(e,n){var i={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,l,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(d){return function(F){return g([d,F])}}function g(d){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,d[0]&&(i=0)),i;)try{if(r=1,l&&(s=d[0]&2?l.return:d[0]?l.throw||((s=l.return)&&s.call(l),0):l.next)&&!(s=s.call(l,d[1])).done)return s;switch(l=0,s&&(d=[d[0]&2,s.value]),d[0]){case 0:case 1:s=d;break;case 4:return i.label++,{value:d[1],done:!1};case 5:i.label++,l=d[1],d=[0];continue;case 7:d=i.ops.pop(),i.trys.pop();continue;default:if(s=i.trys,!(s=s.length>0&&s[s.length-1])&&(d[0]===6||d[0]===2)){i=0;continue}if(d[0]===3&&(!s||d[1]>s[0]&&d[1]<s[3])){i.label=d[1];break}if(d[0]===6&&i.label<s[1]){i.label=s[1],s=d;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(d);break}s[2]&&i.ops.pop(),i.trys.pop();continue}d=n.call(e,i)}catch(F){d=[6,F],l=0}finally{r=s=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},vi=function(e){var n=typeof Symbol=="function"&&Symbol.iterator,i=n&&e[n],r=0;if(i)return i.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},an=function(e,n){var i=typeof Symbol=="function"&&e[Symbol.iterator];if(!i)return e;var r=i.call(e),l,s=[],o;try{for(;(n===void 0||n-- >0)&&!(l=r.next()).done;)s.push(l.value)}catch(a){o={error:a}}finally{try{l&&!l.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return s},Li=function(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(an(arguments[n]));return e},Si=function(e,n,i){if(i||arguments.length===2)for(var r=0,l=n.length,s;r<l;r++)(s||!(r in n))&&(s||(s=Array.prototype.slice.call(n,0,r)),s[r]=n[r]);return e.concat(s||Array.prototype.slice.call(n))},mt=function(e){return this instanceof mt?(this.v=e,this):new mt(e)},c("__extends",Vi),c("__assign",mi),c("__decorate",Xi),c("__awaiter",Zi),c("__generator",fi),c("__values",vi),c("__read",an),c("__spread",Li),c("__spreadArray",Si),c("__await",mt)})});var Ei=Gi(function(Uo,dn){"use strict";var kr=Object.prototype.hasOwnProperty,O="~";function ct(){}Object.create&&(ct.prototype=Object.create(null),new ct().__proto__||(O=!1));function Yr(c,t,e){this.fn=c,this.context=t,this.once=e||!1}function Ji(c,t,e,n,i){if(typeof e!="function")throw new TypeError("The listener must be a function");var r=new Yr(e,n||c,i),l=O?O+t:t;return c._events[l]?c._events[l].fn?c._events[l]=[c._events[l],r]:c._events[l].push(r):(c._events[l]=r,c._eventsCount++),c}function Zt(c,t){--c._eventsCount===0?c._events=new ct:delete c._events[t]}function M(){this._events=new ct,this._eventsCount=0}M.prototype.eventNames=function(){var t=[],e,n;if(this._eventsCount===0)return t;for(n in e=this._events)kr.call(e,n)&&t.push(O?n.slice(1):n);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};M.prototype.listeners=function(t){var e=O?O+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,r=n.length,l=new Array(r);i<r;i++)l[i]=n[i].fn;return l};M.prototype.listenerCount=function(t){var e=O?O+t:t,n=this._events[e];return n?n.fn?1:n.length:0};M.prototype.emit=function(t,e,n,i,r,l){var s=O?O+t:t;if(!this._events[s])return!1;var o=this._events[s],a=arguments.length,g,d;if(o.fn){switch(o.once&&this.removeListener(t,o.fn,void 0,!0),a){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,e),!0;case 3:return o.fn.call(o.context,e,n),!0;case 4:return o.fn.call(o.context,e,n,i),!0;case 5:return o.fn.call(o.context,e,n,i,r),!0;case 6:return o.fn.call(o.context,e,n,i,r,l),!0}for(d=1,g=new Array(a-1);d<a;d++)g[d-1]=arguments[d];o.fn.apply(o.context,g)}else{var F=o.length,u;for(d=0;d<F;d++)switch(o[d].once&&this.removeListener(t,o[d].fn,void 0,!0),a){case 1:o[d].fn.call(o[d].context);break;case 2:o[d].fn.call(o[d].context,e);break;case 3:o[d].fn.call(o[d].context,e,n);break;case 4:o[d].fn.call(o[d].context,e,n,i);break;default:if(!g)for(u=1,g=new Array(a-1);u<a;u++)g[u-1]=arguments[u];o[d].fn.apply(o[d].context,g)}}return!0};M.prototype.on=function(t,e,n){return Ji(this,t,e,n,!1)};M.prototype.once=function(t,e,n){return Ji(this,t,e,n,!0)};M.prototype.removeListener=function(t,e,n,i){var r=O?O+t:t;if(!this._events[r])return this;if(!e)return Zt(this,r),this;var l=this._events[r];if(l.fn)l.fn===e&&(!i||l.once)&&(!n||l.context===n)&&Zt(this,r);else{for(var s=0,o=[],a=l.length;s<a;s++)(l[s].fn!==e||i&&!l[s].once||n&&l[s].context!==n)&&o.push(l[s]);o.length?this._events[r]=o.length===1?o[0]:o:Zt(this,r)}return this};M.prototype.removeAllListeners=function(t){var e;return t?(e=O?O+t:t,this._events[e]&&Zt(this,e)):(this._events=new ct,this._eventsCount=0),this};M.prototype.off=M.prototype.removeListener;M.prototype.addListener=M.prototype.on;M.prefixed=O;M.EventEmitter=M;typeof dn!="undefined"&&(dn.exports=M)});var B={};pi(B,{tslib:function(){return Ri}});sn(B,on(gn(),1));var Ri=on(gn(),1);var f=on(Ei(),1);var ae={modifierCodes:{LCTRL:1,RCTRL:2,LALT:4,RALT:8,SHIFT:16,CTRL:32,ALT:64,META:128,CAPS:256,NO_CAPS:512,NUM_LOCK:1024,NO_NUM_LOCK:2048,SCROLL_LOCK:4096,NO_SCROLL_LOCK:8192,VIRTUAL_KEY:16384,VIRTUAL_CHAR_KEY:32768},modifierBitmasks:{ALL:127,ALT_GR_SIM:5,CHIRAL:31,IS_CHIRAL:15,NON_CHIRAL:112,NON_LEGACY:111},stateBitmasks:{ALL:16128,CAPS:768,NUM_LOCK:3072,SCROLL_LOCK:12288},keyCodes:{K_BKSP:8,K_TAB:9,K_ENTER:13,K_SHIFT:16,K_CONTROL:17,K_ALT:18,K_PAUSE:19,K_CAPS:20,K_ESC:27,K_SPACE:32,K_PGUP:33,K_PGDN:34,K_END:35,K_HOME:36,K_LEFT:37,K_UP:38,K_RIGHT:39,K_DOWN:40,K_SEL:41,K_PRINT:42,K_EXEC:43,K_INS:45,K_DEL:46,K_HELP:47,K_0:48,K_1:49,K_2:50,K_3:51,K_4:52,K_5:53,K_6:54,K_7:55,K_8:56,K_9:57,K_A:65,K_B:66,K_C:67,K_D:68,K_E:69,K_F:70,K_G:71,K_H:72,K_I:73,K_J:74,K_K:75,K_L:76,K_M:77,K_N:78,K_O:79,K_P:80,K_Q:81,K_R:82,K_S:83,K_T:84,K_U:85,K_V:86,K_W:87,K_X:88,K_Y:89,K_Z:90,K_NP0:96,K_NP1:97,K_NP2:98,K_NP3:99,K_NP4:100,K_NP5:101,K_NP6:102,K_NP7:103,K_NP8:104,K_NP9:105,K_NPSTAR:106,K_NPPLUS:107,K_SEPARATOR:108,K_NPMINUS:109,K_NPDOT:110,K_NPSLASH:111,K_F1:112,K_F2:113,K_F3:114,K_F4:115,K_F5:116,K_F6:117,K_F7:118,K_F8:119,K_F9:120,K_F10:121,K_F11:122,K_F12:123,K_NUMLOCK:144,K_SCROLL:145,K_LSHIFT:160,K_RSHIFT:161,K_LCONTROL:162,K_RCONTROL:163,K_LALT:164,K_RALT:165,K_COLON:186,K_EQUAL:187,K_COMMA:188,K_HYPHEN:189,K_PERIOD:190,K_SLASH:191,K_BKQUOTE:192,K_LBRKT:219,K_BKSLASH:220,K_RBRKT:221,K_QUOTE:222,K_oE2:226,K_OE2:226,K_LOPT:50001,K_ROPT:50002,K_NUMERALS:50003,K_SYMBOLS:50004,K_CURRENCIES:50005,K_UPPER:50006,K_LOWER:50007,K_ALPHA:50008,K_SHIFTED:50009,K_ALTGR:50010,K_TABBACK:50011,K_TABFWD:50012},codesUS:[["0123456789",";=,-./`","[\\]'"],[")!@#$%^&*(",":+<_>?~",'{|}"']],isFrameKey:function(c){switch(c){case"K_SHIFT":case"K_LOPT":case"K_ROPT":case"K_NUMLOCK":case"K_CAPS":return!0;default:if(ae.keyCodes[c]>=5e4)return!0}return!1},getModifierState:function(c){var t=0;c.indexOf("shift")>=0&&(t|=ae.modifierCodes.SHIFT);var e=!1;c.indexOf("leftctrl")>=0&&(t|=ae.modifierCodes.LCTRL,e=!0),c.indexOf("rightctrl")>=0&&(t|=ae.modifierCodes.RCTRL,e=!0),c.indexOf("ctrl")>=0&&!e&&(t|=ae.modifierCodes.CTRL);var n=!1;return c.indexOf("leftalt")>=0&&(t|=ae.modifierCodes.LALT,n=!0),c.indexOf("rightalt")>=0&&(t|=ae.modifierCodes.RALT,n=!0),c.indexOf("alt")>=0&&!n&&(t|=ae.modifierCodes.ALT),t},getStateFromLayer:function(c){var t=0;return c.indexOf("caps")>=0?t|=ae.modifierCodes.CAPS:t|=ae.modifierCodes.NO_CAPS,t}},h=ae;var Se;(function(c){c.Enter="\n",c.Backspace="\b"})(Se||(Se={}));var wr=function(){function c(){}return c.prototype.codeForEvent=function(t){return h.keyCodes[t.kName]||t.Lcode},c.prototype.forAny=function(t,e,n){var i="";if((i=this.forSpecialEmulation(t))!=null)return i;if(!e&&(i=this.forNumpadKeys(t))!=null)return i;if((i=this.forUnicodeKeynames(t,n))!=null)return i;if((i=this.forBaseKeys(t,n))!=null)return i;var r=this.codeForEvent(t);switch(r){default:return null}},c.prototype.isCommand=function(t){var e=this.codeForEvent(t);switch(e){default:return!1}},c.prototype.applyCommand=function(t,e){},c.prototype.forSpecialEmulation=function(t){var e=this.codeForEvent(t);switch(e){case h.keyCodes.K_BKSP:return Se.Backspace;case h.keyCodes.K_ENTER:return Se.Enter;default:return null}},c.prototype.forNumpadKeys=function(t){if(t.Lcode>=h.keyCodes.K_NP0&&t.Lcode<=h.keyCodes.K_NPSLASH){if(t.Lcode<106)var e=t.Lcode-48;else e=t.Lcode-64;var n=String._kmwFromCharCode(e);return n}else return null},c.prototype.forUnicodeKeynames=function(t,e){var n=t.kName;if(!n||n.substr(0,2)!="U_")return null;for(var i="",r=n.substr(2).split("_"),l=0,s=r;l<s.length;l++){var o=s[l],a=parseInt(o,16);if(0<=a&&a<=31||128<=a&&a<=159||isNaN(a)){e&&(e.errorLog="Suppressing Unicode control code in "+n);continue}else i+=String.kmwFromCharCode(a)}return i||null},c.prototype.forBaseKeys=function(t,e){var n=t.Lcode,i=t.Lmodifiers;if(i==h.modifierCodes.SHIFT)i=1;else if(i!=0)return e&&(e.warningLog="KMW only defines default key output for the 'default' and 'shift' layers!"),null;try{if(n==h.keyCodes.K_SPACE)return" ";if(n>=h.keyCodes.K_0&&n<=h.keyCodes.K_9)return h.codesUS[i][0][n-h.keyCodes.K_0];if(n>=h.keyCodes.K_A&&n<=h.keyCodes.K_Z)return String.fromCharCode(n+(i?0:32));if(n>=h.keyCodes.K_COLON&&n<=h.keyCodes.K_BKQUOTE)return h.codesUS[i][1][n-h.keyCodes.K_COLON];if(n>=h.keyCodes.K_LBRKT&&n<=h.keyCodes.K_QUOTE)return h.codesUS[i][2][n-h.keyCodes.K_LBRKT];if(n==h.keyCodes.K_oE2)return i?"|":"\\"}catch(r){e&&(e.errorLog="Error detected with default mapping for key:  code = "+n+", shift state = "+(i==1?"shift":"default"))}return null},c}(),ke=wr;var Tr=new ke,Dr=function(){function c(t){this.isSynthetic=!0;for(var e in t)t[e]!==void 0&&(this[e]=t[e])}return c.constructNullKeyEvent=function(t){var e=new c({Lcode:0,kName:"",device:t,Lstates:void 0,Lmodifiers:void 0,vkCode:void 0,LisVirtualKey:void 0});return e},Object.defineProperty(c.prototype,"isModifier",{get:function(){switch(this.Lcode){case 16:case 17:case 18:case 20:case 144:case 145:return!0;default:return!1}},enumerable:!1,configurable:!0}),c.prototype.setMnemonicCode=function(t,e){if(this.Lcode!=h.keyCodes.K_SPACE){var n=new c(this);for(var i in this)n[i]=this[i];n.kName="K_xxxx",n.Lmodifiers=t?16:0;var r=Tr.forAny(n,!0);this.vkCode=this.Lcode,r?this.Lcode=r.charCodeAt(0):this.isModifier||delete this.Lcode}e&&(this.Lcode>=65&&this.Lcode<=90||this.Lcode>=97&&this.Lcode<=122)&&(this.Lmodifiers^=16,this.Lcode^=32)},c}(),ge=Dr;var Ye=function(){function c(){}return c}(),Mr=function(){function c(){this.FF=new Ye,this.Safari=new Ye,this.Opera=new Ye,this.FF.k61=187,this.FF.k59=186,this.FF.k173=189}return c}(),zr=function(){function c(){this.se=new Ye,this.se.k220=192,this.se.k187=189,this.se.k219=187,this.se.k221=219,this.se.k186=221,this.se.k191=220,this.se.k192=186,this.se.k189=191,this.uk=new Ye,this.uk.k223=192,this.uk.k192=222,this.uk.k222=226,this.uk.k220=220}return c}(),Kr=function(){function c(){}return c._usCodeInit=function(){var t=new Ye,e=new Ye;t.k192=96,t.k49=49,t.k50=50,t.k51=51,t.k52=52,t.k53=53,t.k54=54,t.k55=55,t.k56=56,t.k57=57,t.k48=48,t.k189=45,t.k187=61,t.k81=113,t.k87=119,t.k69=101,t.k82=114,t.k84=116,t.k89=121,t.k85=117,t.k73=105,t.k79=111,t.k80=112,t.k219=91,t.k221=93,t.k220=92,t.k65=97,t.k83=115,t.k68=100,t.k70=102,t.k71=103,t.k72=104,t.k74=106,t.k75=107,t.k76=108,t.k186=59,t.k222=39,t.k90=122,t.k88=120,t.k67=99,t.k86=118,t.k66=98,t.k78=110,t.k77=109,t.k188=44,t.k190=46,t.k191=47,e.k192=126,e.k49=33,e.k50=64,e.k51=35,e.k52=36,e.k53=37,e.k54=94,e.k55=38,e.k56=42,e.k57=40,e.k48=41,e.k189=95,e.k187=43,e.k81=81,e.k87=87,e.k69=69,e.k82=82,e.k84=84,e.k89=89,e.k85=85,e.k73=73,e.k79=79,e.k80=80,e.k219=123,e.k221=125,e.k220=124,e.k65=65,e.k83=83,e.k68=68,e.k70=70,e.k71=71,e.k72=72,e.k74=74,e.k75=75,e.k76=76,e.k186=58,e.k222=34,e.k90=90,e.k88=88,e.k67=67,e.k86=86,e.k66=66,e.k78=78,e.k77=77,e.k188=60,e.k190=62,e.k191=63,c._usCharCodes=[t,e]},c._USKeyCodeToCharCode=function(t){return c.usCharCodes[t.Lmodifiers&16?1:0]["k"+t.Lcode]},Object.defineProperty(c,"usCharCodes",{get:function(){return c._usCharCodes||c._usCodeInit(),c._usCharCodes},enumerable:!1,configurable:!0}),c.browserMap=new Mr,c.languageMap=new zr,c}(),de=Kr;function $(c){if(typeof c!="object"||!c)return c;for(var t=Array.isArray(c)?[]:{},e=Object.keys(c),n=0,i=e;n<i.length;n++){var r=i[n];c[r]!==void 0&&(t[r]=$(c[r]))}return t}var rt=function(){function c(t,e,n,i){switch(t.toLowerCase()){case c.Browser.Chrome:case c.Browser.Edge:case c.Browser.Firefox:case c.Browser.Native:case c.Browser.Opera:case c.Browser.Safari:this.browser=t.toLowerCase();break;default:this.browser=c.Browser.Other}switch(e.toLowerCase()){case c.FormFactor.Desktop:case c.FormFactor.Phone:case c.FormFactor.Tablet:this.formFactor=e.toLowerCase();break;default:throw"Invalid form factor specified for device: "+e}switch(n.toLowerCase()){case c.OperatingSystem.Windows.toLowerCase():case c.OperatingSystem.macOS.toLowerCase():case c.OperatingSystem.Linux.toLowerCase():case c.OperatingSystem.Android.toLowerCase():case c.OperatingSystem.iOS.toLowerCase():this.OS=n.toLowerCase();break;default:this.OS=c.OperatingSystem.Other}this.touchable=i}return c}();(function(c){var t;(function(i){i.Chrome="chrome",i.Edge="edge",i.Firefox="firefox",i.Native="native",i.Opera="opera",i.Safari="safari",i.Other="other"})(t=c.Browser||(c.Browser={}));var e;(function(i){i.Windows="windows",i.macOS="macosx",i.Linux="linux",i.Android="android",i.iOS="ios",i.Other="other"})(e=c.OperatingSystem||(c.OperatingSystem={}));var n;(function(i){i.Desktop="desktop",i.Phone="phone",i.Tablet="tablet"})(n=c.FormFactor||(c.FormFactor={}))})(rt||(rt={}));function Bn(c){return new rt(c.browser,rt.FormFactor.Desktop,c.OS,!1)}var v=rt;var Fn=function(){function c(){}return c.VERSION="18.0.55",c.VERSION_RELEASE="18.0",c.VERSION_MAJOR="18",c.VERSION_MINOR="0",c.VERSION_PATCH="55",c.TIER="alpha",c.VERSION_TAG="-alpha",c.VERSION_WITH_TAG="18.0.55-alpha",c.VERSION_ENVIRONMENT="alpha",c.VERSION_GIT_TAG="release@18.0.55-alpha",c}();var Re=Fn;var Pr=function(){function c(t){if(t==null){this.components=[].concat(c.DEVELOPER_VERSION_FALLBACK.components);return}if(Array.isArray(t)){var e=t;if(e.length<2)throw new Error("Version string must have at least a major and minor component!");this.components=[].concat(e);return}var n=t.split("."),i=[];if(n.length<2)throw new Error("Version string must have at least a major and minor component!");for(var r=0;r<n.length;r++){var l=parseInt(n[r],10);if(isNaN(l))throw new Error("Version string components must be numerical!");i.push(l)}this.components=i}return Object.defineProperty(c.prototype,"major",{get:function(){return this.components[0]},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"minor",{get:function(){return this.components[1]},enumerable:!1,configurable:!0}),c.prototype.toString=function(){return this.components.join(".")},c.prototype.toJSON=function(){return this.toString()},c.prototype.equals=function(t){return this.compareTo(t)==0},c.prototype.precedes=function(t){return this.compareTo(t)<0},c.prototype.compareTo=function(t){var e=this.components.length<t.components.length,n=this.components.length<t.components.length?this.components.length:t.components.length,i;for(i=0;i<n;i++){var r=this.components[i]-t.components[i];if(r!=0)return r}var l=e?t.components:this.components;do{if(l[i]>0)return e?-1:1;i++}while(i<l.length);return 0},c.CURRENT=new c(Re.VERSION_RELEASE),c.DEVELOPER_VERSION_FALLBACK=new c([9,0,0]),c.NO_DEFAULT_KEYCAPS=new c([12,0]),c.MAC_POSSIBLE_IPAD_ALIAS=new c([10,15]),c}(),ee=Pr;function Pe(){return typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof self!="undefined"?self:global}function lt(){String.kmwFromCharCode=function(c){var t=[],e;for(e=0;e<arguments.length;e++){var n=Number(arguments[e]);if(!isFinite(n)||n<0||n>1114111||Math.floor(n)!==n)throw new RangeError("Invalid code point "+n);n<65536?t.push(n):(n-=65536,t.push((n>>10)+55296),t.push(n%1024+56320))}return String.fromCharCode.apply(void 0,t)},String.prototype.kmwCharCodeAt=function(c){var t=String(this),e=0;if(c<0||c>=t.length)return NaN;for(var n=0;n<c;n++)if(e=t.kmwNextChar(e),e===null)return NaN;var i=t.charCodeAt(e);if(i>=55296&&i<=56319&&t.length>e+1){var r=t.charCodeAt(e+1);if(r>=56320&&r<=57343)return(i-55296<<10)+(r-56320)+65536}return i},String.prototype.kmwIndexOf=function(c,t){var e=String(this),n=e.indexOf(c,t);if(n<0)return n;for(var i=0,r=0;r!==null&&r<n;r=e.kmwNextChar(r))i++;return i},String.prototype.kmwLastIndexOf=function(c,t){var e=String(this),n=e.lastIndexOf(c,t);if(n<0)return n;for(var i=0,r=0;r!==null&&r<n;r=e.kmwNextChar(r))i++;return i},String.prototype.kmwLength=function(){var c=String(this);if(c.length==0)return 0;for(var t=0,e=0;e!==null;t++)e=c.kmwNextChar(e);return t},String.prototype.kmwSlice=function(c,t){var e=String(this),n=e.kmwCodePointToCodeUnit(c),i=e.kmwCodePointToCodeUnit(t);return n===null||i===null?"":e.slice(n,i)},String.prototype.kmwSubstr=function(c,t){var e=String(this);c<0&&(c=e.kmwLength()+c),c<0&&(c=0);var n=e.kmwCodePointToCodeUnit(c),i=n;if(n===null)return"";if(arguments.length<2)i=e.length;else for(var r=0;r<t;r++)i=e.kmwNextChar(i);return i===null?e.substring(n):e.substring(n,i)},String.prototype.kmwSubstring=function(c,t){var e=String(this),n,i;if(typeof t=="undefined")n=e.kmwCodePointToCodeUnit(c),i=e.length;else{if(c>t){var r=c;c=t,t=r}n=e.kmwCodePointToCodeUnit(c),i=e.kmwCodePointToCodeUnit(t)}return(isNaN(n)||n===null)&&(n=0),(isNaN(i)||i===null)&&(i=e.length),e.substring(n,i)},String.prototype.kmwNextChar=function(c){var t=String(this);if(c===null||c<0||c>=t.length-1)return null;var e=t.charCodeAt(c);if(e>=55296&&e<=56319&&t.length>c+1){var n=t.charCodeAt(c+1);if(n>=56320&&n<=57343)return c==t.length-2?null:c+2}return c+1},String.prototype.kmwPrevChar=function(c){var t=String(this);if(c==null||c<=0||c>t.length)return null;var e=t.charCodeAt(c-1);if(e>=56320&&e<=57343&&c>1){var n=t.charCodeAt(c-2);if(n>=55296&&n<=56319)return c-2}return c-1},String.prototype.kmwCodePointToCodeUnit=function(c){if(c===null)return null;var t=String(this),e=0;if(c<0){e=t.length;for(var n=0;n>c;n--)e=t.kmwPrevChar(e);return e}if(c==t.kmwLength())return t.length;for(var n=0;n<c;n++)e=t.kmwNextChar(e);return e},String.prototype.kmwCodeUnitToCodePoint=function(c){var t=String(this);return c===null?null:c==0?0:c<0?t.substr(c).kmwLength():t.substr(0,c).kmwLength()},String.prototype.kmwCharAt=function(c){var t=String(this);return c>=0?t.kmwSubstr(c,1):""},String.prototype.kmwBMPNextChar=function(c){var t=String(this);return c<0||c>=t.length-1?null:c+1},String.prototype.kmwBMPPrevChar=function(c){var t=String(this);return c<=0||c>t.length?null:c-1},String.prototype.kmwBMPCodePointToCodeUnit=function(c){return c},String.prototype.kmwBMPCodeUnitToCodePoint=function(c){return c},String.prototype.kmwBMPLength=function(){var c=String(this);return c.length},String.prototype.kmwBMPSubstr=function(c,t){var e=String(this);return c>-1?e.substr(c,t):e.substr(e.length+c,-c)},String.kmwEnableSupplementaryPlane=function(c){var t=String.prototype;String._kmwFromCharCode=c?String.kmwFromCharCode:String.fromCharCode,t._kmwCharAt=c?t.kmwCharAt:t.charAt,t._kmwCharCodeAt=c?t.kmwCharCodeAt:t.charCodeAt,t._kmwIndexOf=c?t.kmwIndexOf:t.indexOf,t._kmwLastIndexOf=c?t.kmwLastIndexOf:t.lastIndexOf,t._kmwSlice=c?t.kmwSlice:t.slice,t._kmwSubstring=c?t.kmwSubstring:t.substring,t._kmwSubstr=c?t.kmwSubstr:t.kmwBMPSubstr,t._kmwLength=c?t.kmwLength:t.kmwBMPLength,t._kmwNextChar=c?t.kmwNextChar:t.kmwBMPNextChar,t._kmwPrevChar=c?t.kmwPrevChar:t.kmwBMPPrevChar,t._kmwCodePointToCodeUnit=c?t.kmwCodePointToCodeUnit:t.kmwBMPCodePointToCodeUnit,t._kmwCodeUnitToCodePoint=c?t.kmwCodeUnitToCodePoint:t.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}lt();var Or=function(){function c(t){var e=this;this._isFulfilled=!1,this._isRejected=!1,this._promise=new Promise(function(n,i){e._resolve=function(r){e._isFulfilled=!0,n(r)},e._reject=function(r){e._isRejected=!0,i(r)},t&&t(e._resolve,e._reject)})}return Object.defineProperty(c.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isFulfilled",{get:function(){return this._isFulfilled},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isRejected",{get:function(){return this._isRejected},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isResolved",{get:function(){return this.isFulfilled||this.isRejected},enumerable:!1,configurable:!0}),c.prototype.then=function(t,e){return this._promise.then(t,e)},c.prototype.catch=function(t){return this._promise.catch(t)},c.prototype.finally=function(t){return this._promise.finally(t)},Object.defineProperty(c.prototype,"corePromise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),c}(),J=Or;var Ai=function(c){(0,B.__extends)(t,c);function t(e){var n=this,i=null;n=c.call(this,function(s){var o=setTimeout(function(){n.isResolved||s(!0)},e);i=o})||this,n.timerHandle=i;var r=n._resolve;n._resolve=function(s){clearTimeout(n.timerHandle),r(s)};var l=n._reject;return n._reject=function(s){clearTimeout(n.timerHandle),l(s)},n}return t}(J),st=Ai,Be=function(c){var t=new Ai(c);return t.corePromise};var _r=55296,jr=56319,qr=56320,$r=57343;function ft(c){return c>=_r&&c<=jr}function vt(c){return c>=qr&&c<=$r}var el=200,D=function(){function c(){}return c.buildDefaultLayout=function(t,e,n){var i,r=n;typeof c.dfltLayout[r]!="object"&&(r="desktop");var l=h.modifierBitmasks.NON_CHIRAL,s=ee.CURRENT;e&&(l=e.modifierBitmask,s=e.compilerVersion),t||(t=this.DEFAULT_RAW_SPEC);var o=$(c.dfltLayout[r]),a,g=o.layer,d=t.KLS,F=t.K102,u,I,Q,y,U,b,C=(l&h.modifierBitmasks.IS_CHIRAL)!=0;if(t.F){var x=/^(?:(?:italic|bold) )* *[0-9.eE-]+(?:[a-z]+) "(.+)"$/.exec(t.F);x&&(o.font=x[1])}var X=!(typeof d=="undefined"||!d);X||(d=t.KLS=c.processLegacyDefinitions(t.BK));var p=Object.getOwnPropertyNames(d),V=[];if(p.splice(p.indexOf("default"),1),p=["default"].concat(p),e&&e.emulatesAltGr&&(p.indexOf("leftctrl-leftalt")==-1&&p.indexOf("rightalt")!=-1&&(p.push("leftctrl-leftalt"),d["leftctrl-leftalt"]=d.rightalt),p.indexOf("leftctrl-leftalt-shift")==-1&&p.indexOf("rightalt-shift")!=-1&&(p.push("leftctrl-leftalt-shift"),d["leftctrl-leftalt-shift"]=d["rightalt-shift"])),o.displayUnderlying=e?!!e.scriptObject.KDU:!1,n=="desktop")for(V=c.generateLayerIds(C),a=0;a<V.length;a++)p.indexOf(V[a])!=-1&&V.splice(a--,1);var L=p.concat(V);if(X&&n!="desktop"){var m=null;y=g[0].row;for(var G=0;G<y.length;G++){b=y[G].key;for(var S=0;S<b.length;S++)U=b[S],U.id=="K_SHIFT"&&(m=U)}if(m){m.sk=[];for(var k in d)if(!(k=="default"||k=="shift")){var W=c.modifierSpecials[k],Y={id:"K_".concat(W),text:W,sp:1,nextlayer:k};m.sk.push(Y)}}else console.warn("Error in default layout - cannot find default Shift key!")}for(a=0;a<L.length;a++)a>0&&(g[a]=$(g[0])),g[a].id=L[a],g[a].nextlayer=L[a],c.formatDefaultLayer(g[a],C,n,!!F);for(a=0;a<g.length;a++){var R=g[a],E,m=null,A=null,H=null,oe=null,ie=d[R.id],Ke=R.id=="shift"?1:0,it=R.id=="default"||Ke?1:0;for(y=R.row,u=0;u<y.length;u++)for(b=y[u].key,I=0;I<b.length;I++){switch(U=b[I],E=c.dfltCodes.indexOf(U.id),(ie||it)&&(ie&&E>=0&&E<ie.length&&(U.text=ie[E]),it&&s.precedes(ee.NO_DEFAULT_KEYCAPS)&&U.id!="K_SPACE"&&E+65*Ke<c.dfltText.length&&U.text!==null&&(U.text=U.text||c.dfltText[E+65*Ke])),U.text!==null&&(U.text=U.text||""),U.id){case"K_SHIFT":m=U;break;case"K_CAPS":A=U;break;case"K_NUMLOCK":H=U;break;case"K_SCROLL":oe=U;break}if(U.sk!=null){for(Q=0;Q<U.sk.length;Q++)p.indexOf(U.sk[Q].nextlayer)==-1&&U.sk.splice(Q--,1);U.sk.length==0&&(U.sk=null)}}R.shiftKey=m,R.capsKey=A,R.numKey=H,R.scrollKey=oe;var cn=g[a].id;n!="desktop"&&a>0&&m!=null&&(m.sp=2,m.sk=null,m.text=(i=c.modifierSpecials[cn])!==null&&i!==void 0?i:"*Shift*")}return o},c.getLayerId=function(t){var e=h.modifierCodes,n="";return t==0?"default":(t&e.LCTRL&&(n=(n.length>0?n+"-":"")+"leftctrl"),t&e.RCTRL&&(n=(n.length>0?n+"-":"")+"rightctrl"),t&e.LALT&&(n=(n.length>0?n+"-":"")+"leftalt"),t&e.RALT&&(n=(n.length>0?n+"-":"")+"rightalt"),t&e.SHIFT&&(n=(n.length>0?n+"-":"")+"shift"),t&e.CTRL&&(n=(n.length>0?n+"-":"")+"ctrl"),t&e.ALT&&(n=(n.length>0?n+"-":"")+"alt"),n)},c.generateLayerIds=function(t){var e,n;t?(e=32,n=1):(e=8,n=16);for(var i=[],r=0;r<e;r++)i.push(c.getLayerId(r*n));return i},c.formatDefaultLayer=function(t,e,n,i){for(var r=t.id,l=0;l<t.row.length;l++)for(var s=t.row[l],o=s.key,a=0;a<o.length;a++){var g=o[a];switch(g.id){case"K_SHIFT":case"K_LSHIFT":case"K_RSHIFT":r.indexOf("shift")!=-1&&(g.sp=2),n!="desktop"&&(r!="default"?g.nextlayer="default":g.nextlayer="shift");break;case"K_LCTRL":case"K_LCONTROL":if(e){r.indexOf("leftctrl")!=-1&&(g.sp=2);break}case"K_RCTRL":case"K_RCONTROL":if(e){r.indexOf("rightctrl")!=-1&&(g.sp=2);break}case"K_CONTROL":r.indexOf("ctrl")!=-1&&(!e||r.indexOf("leftctrl")!=-1&&r.indexOf("rightctrl")!=-1)&&(g.sp=2);break;case"K_LALT":if(e){r.indexOf("leftalt")!=-1&&(g.sp=2);break}case"K_RALT":if(e){r.indexOf("rightalt")!=-1&&(g.sp=2);break}case"K_ALT":r.indexOf("alt")!=-1&&(!e||r.indexOf("leftalt")!=-1&&r.indexOf("rightalt")!=-1)&&(g.sp=2);break;case"K_oE2":(typeof i=="undefined"||!i)&&(n=="desktop"?(o.splice(a--,1),o[0].width=el):o[a].sp=10);break}}},c.processLegacyDefinitions=function(t){for(var e=c.generateLayerIds(!1),n={},i=0;i<e.length;i++){for(var r=e[i],l=[],s=!1,o=0;o<65;o++){var a=o+65*i;l.push(t[a]),a<t.length&&t[a]!=""&&o!=c.dfltCodes.indexOf("K_SPACE")&&(s=!0)}s&&(n[r]=l)}return(typeof n.default=="undefined"||!n.default)&&(n.default=[""]),(typeof n.shift=="undefined"||!n.shift)&&(n.shift=[""]),n},c.dfltCodes=["K_BKQUOTE","K_1","K_2","K_3","K_4","K_5","K_6","K_7","K_8","K_9","K_0","K_HYPHEN","K_EQUAL","K_*","K_*","K_*","K_Q","K_W","K_E","K_R","K_T","K_Y","K_U","K_I","K_O","K_P","K_LBRKT","K_RBRKT","K_BKSLASH","K_*","K_*","K_*","K_A","K_S","K_D","K_F","K_G","K_H","K_J","K_K","K_L","K_COLON","K_QUOTE","K_*","K_*","K_*","K_*","K_*","K_oE2","K_Z","K_X","K_C","K_V","K_B","K_N","K_M","K_COMMA","K_PERIOD","K_SLASH","K_*","K_*","K_*","K_*","K_*","K_SPACE"],c.dfltText="`1234567890-=\xA7~~qwertyuiop[]\\~~~asdfghjkl;'~~~~~?zxcvbnm,./~~~~~ ~!@#$%^&*()_+\xA7~~QWERTYUIOP{}\\~~~ASDFGHJKL:\"~~~~~?ZXCVBNM<>?~~~~~ ",c.DEFAULT_RAW_SPEC={F:"Tahoma",BK:c.dfltText.split("")},c.modifierSpecials={leftalt:"*LAlt*",rightalt:"*RAlt*",alt:"*Alt*",leftctrl:"*LCtrl*",rightctrl:"*RCtrl*",ctrl:"*Ctrl*","ctrl-alt":"*AltGr*","leftctrl-leftalt":"*LAltCtrl*","rightctrl-rightalt":"*RAltCtrl*","leftctrl-leftalt-shift":"*LAltCtrlShift*","rightctrl-rightalt-shift":"*RAltCtrlShift*",shift:"*Shift*","shift-alt":"*AltShift*","shift-ctrl":"*CtrlShift*","shift-ctrl-alt":"*AltCtrlShift*","leftalt-shift":"*LAltShift*","rightalt-shift":"*RAltShift*","leftctrl-shift":"*LCtrlShift*","rightctrl-shift":"*RCtrlShift*"},c.dfltShiftToCaps={id:"T_*_MT_SHIFT_TO_CAPS",text:"*ShiftLock*",sp:1,nextlayer:"caps"},c.dfltShiftToDefault={id:"T_*_MT_SHIFT_TO_DEFAULT",text:"*Shift*",sp:1,nextlayer:"default"},c.dfltShiftToShift={id:"T_*_MT_SHIFT_TO_SHIFT",text:"*Shift*",sp:1,nextlayer:"shift"},c.dfltLayout={desktop:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:1,key:[{id:"K_BKQUOTE"},{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{id:"K_BKSP",text:"*BkSp*",sp:1,width:130}]},{id:2,key:[{id:"K_TAB",text:"*Tab*",sp:1,width:130},{id:"K_Q"},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{id:"K_BKSLASH"}]},{id:3,key:[{id:"K_CAPS",text:"*Caps*",sp:1,width:165},{id:"K_A"},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_ENTER",text:"*Enter*",sp:1,width:165}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:130},{id:"K_oE2"},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_RSHIFT",text:"*Shift*",sp:1,width:130}]},{id:5,key:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:170},{id:"K_LALT",text:"*Alt*",sp:1,width:160},{id:"K_SPACE",text:"",width:770},{id:"K_RALT",text:"*Alt*",sp:1,width:160},{id:"K_RCONTROL",text:"*Ctrl*",sp:1,width:170}]}]}]},tablet:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",sp:1,width:150},{id:"K_SPACE",text:"",width:570},{id:"K_BKSP",text:"*BkSp*",sp:1,width:150},{id:"K_ENTER",text:"*Enter*",sp:1,width:200}]}]}]},phone:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",width:150,sp:1},{id:"K_SPACE",width:570,text:""},{id:"K_BKSP",text:"*BkSp*",width:150,sp:1},{id:"K_ENTER",text:"*Enter*",width:200,sp:1}]}]}]}},c}();function xe(c,t,e){e.enumerable=!0}var Wi={id:"string",text:"string",layer:"string",nextlayer:"string",font:"string",fontsize:"string",sp:"number",pad:"number",width:"number",sk:"subkeys",flick:"flicks",multitap:"subkeys",hint:"string",default:"boolean"},Hi=["n","ne","e","se","s","sw","w","nw"];function Lt(c,t){var e=Object.getPrototypeOf(t);for(var n in t)if(!c.hasOwnProperty(n)){var i=Object.getOwnPropertyDescriptor(e,n);i?Object.defineProperty(c,n,i):c[n]=t[n]}return c}var un=function(){function c(){this.isMnemonic=!1}return Object.defineProperty(c.prototype,"baseKeyID",{get:function(){if(typeof this.id!="undefined")return this.id},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isPadding",{get:function(){return this.sp==10},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"coreID",{get:function(){if(typeof this.id!="undefined"){var t=this.id||"";return this.displayLayer!=this.layer&&(t=t+"+"+this.layer),t}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"elementID",{get:function(){if(typeof this.id!="undefined")return this.displayLayer+"-"+this.coreID},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"baseKeyEvent",{get:function(){return new ge(this._baseKeyEvent)},enumerable:!1,configurable:!0}),c.unicodeIDToText=function(t,e){if(!t||t.substring(0,2)!="U_")return null;for(var n="",i=t.substring(2).split("_"),r=0,l=i;r<l.length;r++){var s=l[r],o=parseInt(s,16);if(0<=o&&o<=31||128<=o&&o<=159||isNaN(o)){e&&e(s);continue}else n+=String.kmwFromCharCode(o)}return n||null},c.sanitize=function(t){typeof t.width=="string"&&(t.width=parseInt(t.width,10)),t.width||(t.width=_.DEFAULT_KEY_WIDTH),typeof t.pad=="string"&&(t.pad=parseInt(t.pad,10)),t.pad||(t.pad=_.DEFAULT_PAD),typeof t.sp=="string"&&(t.sp=Number.parseInt(t.sp,10)),t.sp||(t.sp=_.DEFAULT_KEY.sp);for(var e=0,n=Object.keys(Wi);e<n.length;e++){var i=n[e],r=Wi[i];switch(r){case"subkeys":var l=t[i];if(!Array.isArray(l))delete t[i];else for(var s=0;s<l.length;s++){var o=l[s];typeof o!="object"?l.splice(s--,1):_.sanitize(o)}break;case"flicks":var a=t[i];if(typeof a!="object")delete t[i];else for(var g=0,d=Hi;g<d.length;g++){var F=d[g],o=a[F];typeof o!="object"?delete a[F]:_.sanitize(o)}break;default:var u=t[i];typeof u!=r&&delete t[i]}}t.text||(t.text=_.DEFAULT_KEY.text)},c.polyfill=function(t,e,n,i,r){if(r||(r={hasFlicks:!1,hasLongpresses:!1,hasMultitaps:!1}),Lt(t,new c),!t.text&&typeof t.id=="string"&&(t.text=_.unicodeIDToText(t.id)),t.sk){r.hasLongpresses=!0;for(var l=0,s=t.sk;l<s.length;l++){var o=s[l];ot.polyfill(o,e,n,i,r)}}if(t.multitap){r.hasMultitaps=!0;for(var a=0,g=t.multitap;a<g.length;a++){var d=g[a];ot.polyfill(d,e,n,i,r)}}if(t.flick){r.hasFlicks=!0;for(var F in t.flick)ot.polyfill(t.flick[F],e,n,i,r)}var u=t;u.displayLayer=i,u.layer=u.layer||i,c.determineHint(u,n.defaultHint),u.constructBaseKeyEvent(e,n,i)},c.determineHint=function(t,e){var n;if(t.hint){t.hintSrc=t;return}if(e!=null&&e.includes("flick-")){if(t.flick){var i=e.substring(6);!((n=t.flick[i])===null||n===void 0)&&n.text&&(t.hintSrc=t.flick[i])}return}switch(e){case"none":return;case"multitap":t.multitap&&(t.hintSrc=t.multitap[0]);return;case"flick":if(t.flick)for(var r=0,l=Hi;r<l.length;r++){var s=l[r];if(t.flick[s]){t.hintSrc=t.flick[s];return}}return;case"longpress":t.sk&&(t.hintSrc=t.sk[0]);return;case"dot":default:t.sk&&(t.hint="\u2022",t.hintSrc=t);return}},c.prototype.constructBaseKeyEvent=function(t,e,n){var i=this.layer||n||"",r=this.id?this.id.toUpperCase():null,l={Lmodifiers:h.getModifierState(i),Lstates:h.getStateFromLayer(i),Lcode:r?h.keyCodes[r]:0,LisVirtualKey:!0,vkCode:0,kName:r,kLayer:i,kbdLayer:n,kNextLayer:this.nextlayer,device:null,isSynthetic:!0},s=new ge(l);if(e.keyboard){var o=e.keyboard;o.isMnemonic&&!(e.isDefault&&e.formFactor!="desktop")?s.Lcode!=h.keyCodes.K_SPACE&&(s.vkCode=s.Lcode,this.isMnemonic=!0):s.vkCode=s.Lcode,o.definesPositionalOrMnemonic||(s.Lcode=de._USKeyCodeToCharCode(s),s.LisVirtualKey=!1)}this._baseKeyEvent=s},c.DEFAULT_PAD=15,c.DEFAULT_RIGHT_MARGIN=15,c.DEFAULT_KEY_WIDTH=100,c.DEFAULT_KEY={text:"",width:c.DEFAULT_KEY_WIDTH,sp:0,pad:c.DEFAULT_PAD},(0,B.__decorate)([xe],c.prototype,"baseKeyID",null),(0,B.__decorate)([xe],c.prototype,"isPadding",null),(0,B.__decorate)([xe],c.prototype,"coreID",null),(0,B.__decorate)([xe],c.prototype,"elementID",null),(0,B.__decorate)([xe],c.prototype,"baseKeyEvent",null),(0,B.__decorate)([xe],c.prototype,"constructBaseKeyEvent",null),c}();var _=function(c){(0,B.__extends)(t,c);function t(){return c!==null&&c.apply(this,arguments)||this}return t.prototype.getSubkey=function(e){if(this.sk)for(var n=0,i=this.sk;n<i.length;n++){var r=i[n];if(r.coreID==e)return r}return null},t}(un);var ot=function(c){(0,B.__extends)(t,c);function t(){return c!==null&&c.apply(this,arguments)||this}return t}(un);var Ni=function(){function c(){}return c.sanitize=function(t){for(var e=0,n=t.key;e<n.length;e++){var i=n[e];i==null?t.key.length=t.key.length-1:_.sanitize(i)}typeof t.id=="string"&&(t.id=Number.parseInt(t.id,10))},c.polyfill=function(t,e,n,i,r,l,s){for(var o=t.key,a=un.DEFAULT_KEY,g=0;g<o.length;g++){for(var d=o[g],F=Object.keys(a),u=0,I=F;u<I.length;u++){var Q=I[u],y=Q;typeof d[y]!="string"&&typeof d[y]!="number"&&(d[y]=a[y])}switch(d.sp){case 1:!c.SPECIAL_LABEL.test(d.text)&&d.text!=""&&(d.sp=3);break;case 2:!c.SPECIAL_LABEL.test(d.text)&&d.text!=""&&(d.sp=4);break}_.polyfill(d,e,n,i,s)}for(var U=function(L,m,G,S){L.proportionalPad=m,L.proportionalWidth=G,L.proportionalX=S+m+G/2},b=0,g=0;g<o.length-1;g++){var d=o[g];U(d,d.pad/r,d.width/r,b),b+=d.proportionalPad,b+=d.proportionalWidth}var C=_.DEFAULT_RIGHT_MARGIN/r;if(o.length>0){var x=o[o.length-1];if(o.length==1&&x.pad<0){var X=x.width/r,p=1-(b+X+C);U(x,p,X,b)}else{var p=x.pad/r,X=1-(b+p+C);U(x,p,X,b)}}Lt(t,new c);var V=t;V.proportionalY=l},c.prototype.populateKeyMap=function(t){this.key.forEach(function(e){e.coreID&&(t[e.coreID]=e)})},c.SPECIAL_LABEL=/\*\w+\*/,(0,B.__decorate)([xe],c.prototype,"populateKeyMap",null),c}();var ki=function(){function c(){}return c.sanitize=function(t){for(var e=0,n=t.row;e<n.length;e++){var i=n[e];Ni.sanitize(i)}},c.polyfill=function(t,e,n,i){t.aligned=!1;for(var r=t.row,l=0,s=0,o=r;s<o.length;s++){for(var a=o[s],g=0,d=a.key,F=0,u=d;F<u.length;F++){var I=u[F];g+=I.width+I.pad}g>l&&(l=g)}n.formFactor=="desktop"?l+=5:l+=_.DEFAULT_RIGHT_MARGIN;for(var Q=t.row.length,y=0;y<Q;y++){var U=(y+.5)/Q;Ni.polyfill(t.row[y],e,n,t.id,l,U,i)}Lt(t,new c);var b=t;b.totalWidth=l,b.defaultKeyProportionalWidth=_.DEFAULT_KEY.width/l,b.rowProportionalHeight=1/Q,b.keyMap=b.constructKeyMap()},c.prototype.constructKeyMap=function(){var t={};return this.row.forEach(function(e){e.populateKeyMap(t)}),t},c.prototype.getKey=function(t){t.indexOf(this.id+"-")==0&&(t=t.replace(this.id+"-",""));var e=t.split("::");if(e.length>1){var n=this.keyMap[e[0]];return n.getSubkey(e[1])}else return this.keyMap[t]},(0,B.__decorate)([xe],c.prototype,"constructKeyMap",null),(0,B.__decorate)([xe],c.prototype,"getKey",null),c}();var St=function(){function c(){this.hasFlicks=!1,this.hasLongpresses=!1,this.hasMultitaps=!1}return c.prototype.getLayer=function(t){return this.layerMap[t]},c.correctLayerEmptyRowBug=function(t){for(var e=0;e<t.length;e++){var n=t[e],i=n.row,r=void 0;for(r=i.length-1;r>=0;r--)(!Array.isArray(i[r].key)||i[r].key.length==0)&&i.splice(r,1)}},c.sanitize=function(t){c.correctLayerEmptyRowBug(t.layer);for(var e=0,n=t.layer;e<n.length;e++){var i=n[e];ki.sanitize(i)}},c.polyfill=function(t,e,n){if(t==null)throw new Error("Cannot build an ActiveLayout for a null specification.");var i={hasFlicks:!1,hasLongpresses:!1,hasMultitaps:!1};this.sanitize(t);var r,l={},s=t.layer;Lt(t,new c);var o=t;for(o.keyboard=e,o.formFactor=n,r=0;r<s.length;r++)ki.polyfill(s[r],e,o,i),l[s[r].id]=s[r];if(n!="desktop"&&!!t.layer.find(function(u){return u.id=="caps"})){var a=t.layer.find(function(u){return u.id=="default"}),g=t.layer.find(function(u){return u.id=="shift"}),d=a.getKey("K_SHIFT"),F=g==null?void 0:g.getKey("K_SHIFT");d&&F&&!d.multitap&&!F.multitap&&!d.sk&&!F.sk&&(i.hasMultitaps=!0,d.multitap=[(0,B.__assign)({},D.dfltShiftToCaps),(0,B.__assign)({},D.dfltShiftToDefault)],F.multitap=[(0,B.__assign)({},D.dfltShiftToCaps),(0,B.__assign)({},D.dfltShiftToShift)],d.multitap.forEach(function(u){return ot.polyfill(u,e,o,"default")}),F.multitap.forEach(function(u){return ot.polyfill(u,e,o,"shift")}))}return o.hasFlicks=i.hasFlicks,o.hasLongpresses=i.hasLongpresses,o.hasMultitaps=i.hasMultitaps,o.layerMap=l,o},(0,B.__decorate)([xe],c.prototype,"getLayer",null),c}();var tl=function(){function c(){this.stores={}}return c}(),we;(function(c){c[c.NOT_LOADED=void 0]="NOT_LOADED",c[c.POLYFILLED=1]="POLYFILLED",c[c.CALIBRATED=2]="CALIBRATED"})(we||(we={}));var nl=function(){function c(t){t?this.scriptObject=t:this.scriptObject=c.DEFAULT_SCRIPT_OBJECT,this.layoutStates={}}return c.prototype.process=function(t,e){return this.scriptObject.gs(t,e)},c.prototype.processNewContextEvent=function(t,e){return this.scriptObject.gn?this.scriptObject.gn(t,e):!1},c.prototype.processPostKeystroke=function(t,e){return this.scriptObject.gpk?this.scriptObject.gpk(t,e):!1},Object.defineProperty(c.prototype,"isHollow",{get:function(){return this.scriptObject==c.DEFAULT_SCRIPT_OBJECT},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"id",{get:function(){return this.scriptObject.KI},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"name",{get:function(){return this.scriptObject.KN},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"variableStores",{get:function(){var t=this.scriptObject.KVS,e={};if(Array.isArray(t))for(var n=0,i=t;n<i.length;n++){var r=i[n];e[r]=this.scriptObject[r]}return e},set:function(t){var e=this.scriptObject.KVS;if(Array.isArray(e))for(var n=0,i=e;n<i.length;n++){var r=i[n];typeof t[r]=="string"&&(this.scriptObject[r]=t[r])}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"_legacyLayoutSpec",{get:function(){return this.scriptObject.KV},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"_layouts",{get:function(){return this.scriptObject.KVKL},set:function(t){this.scriptObject.KVKL=t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"compilerVersion",{get:function(){return new ee(this.scriptObject.KVER)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isMnemonic",{get:function(){return!!this.scriptObject.KM},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"definesPositionalOrMnemonic",{get:function(){return typeof this.scriptObject.KM!="undefined"},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"helpText",{get:function(){return this.scriptObject.KH},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"hasScript",{get:function(){return!!this.scriptObject.KHF},enumerable:!1,configurable:!0}),c.prototype.embedScript=function(t){this.scriptObject.KHF(t)},Object.defineProperty(c.prototype,"oskStyling",{get:function(){return this.scriptObject.KCSS},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isCJK",{get:function(){var t;return typeof this.scriptObject.KLC!="undefined"?t=this.scriptObject.KLC:typeof this.scriptObject.LanguageCode!="undefined"&&(t=this.scriptObject.LanguageCode),t=="cmn"||t=="jpn"||t=="kor"},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isRTL",{get:function(){return!!this.scriptObject.KRTL},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"modifierBitmask",{get:function(){return this.scriptObject.KMBM||h.modifierBitmasks.NON_CHIRAL},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isChiral",{get:function(){return!!(this.modifierBitmask&h.modifierBitmasks.IS_CHIRAL)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"desktopFont",{get:function(){return this.scriptObject.KV?this.scriptObject.KV.F:null},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"cacheTag",{get:function(){var t=this.scriptObject._kmw;return t||(t=new tl,this.scriptObject._kmw=t),t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"explodedStores",{get:function(){return this.cacheTag.stores},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"emulatesAltGr",{get:function(){var t=h.modifierCodes;if(!this.isChiral||this._legacyLayoutSpec==null)return!1;var e=this._legacyLayoutSpec.KLS;if(!e)return!1;var n=t.LCTRL|t.LALT,i=e[D.getLayerId(n)],r=e[D.getLayerId(t.SHIFT|n)];if(i!=null&&i!=e[D.getLayerId(t.RALT)]||r!=null&&r!=e[D.getLayerId(t.RALT|t.SHIFT)])return!1;var l=this.modifierBitmask;return(l&n)!=n||i==null&&r==null,!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"usesSupplementaryPlaneChars",{get:function(){var t=this.scriptObject;return t&&(t.KS&&t.KS==1||t.KN=="Hieroglyphic")},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"version",{get:function(){return this.scriptObject.KBVER||""},enumerable:!1,configurable:!0}),c.prototype.usesDesktopLayoutOnDevice=function(t){return this.scriptObject.KVKL?t.formFactor==v.FormFactor.Desktop:!0},c.prototype.notify=function(t,e,n){typeof this.scriptObject.KNS=="function"&&this.scriptObject.KNS(t,e,n)},c.prototype.findOrConstructLayout=function(t){if(this._layouts){if(this._layouts[t]!==void 0)return this._layouts[t];if(t==v.FormFactor.Phone&&this._layouts[v.FormFactor.Tablet])return this._layouts[v.FormFactor.Phone]=this._layouts[v.FormFactor.Tablet];if(t==v.FormFactor.Tablet&&this._layouts[v.FormFactor.Phone])return this._layouts[v.FormFactor.Tablet]=this._layouts[v.FormFactor.Phone]}var e=null;if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.KLS)e=this._legacyLayoutSpec;else if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.BK!=null){for(var n=this._legacyLayoutSpec.BK,i=0;i<n.length;i++)if(n[i].length>0){e=this._legacyLayoutSpec;break}}if(!e&&(this.helpText==""||t!=v.FormFactor.Desktop)&&(e={F:"Tahoma",BK:D.dfltText}),this._layouts||(this._layouts={}),e){var r=this._layouts[t]=D.buildDefaultLayout(e,this,t);return r.isDefault=!0,r}else return this._layouts[t]=null,null},c.prototype.layout=function(t){var e=this.findOrConstructLayout(t);return e?(this.layoutStates[t]==we.NOT_LOADED&&(e=St.polyfill(e,this,t),this.layoutStates[t]=we.POLYFILLED),e):null},c.prototype.refreshLayouts=function(){var t=[v.FormFactor.Desktop,v.FormFactor.Phone,v.FormFactor.Tablet],e=this;t.forEach(function(n){e.layoutStates[n]=we.NOT_LOADED})},c.prototype.markLayoutCalibrated=function(t){this.layoutStates[t]!=we.NOT_LOADED&&(this.layoutStates[t]=we.CALIBRATED)},c.prototype.getLayoutState=function(t){return this.layoutStates[t]},c.prototype.constructNullKeyEvent=function(t,e){e=e||{K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};var n=ge.constructNullKeyEvent(t);return this.setSyntheticEventDefaults(n,e),n},c.prototype.constructKeyEvent=function(t,e,n){var i=t.baseKeyEvent;i.device=e,this.isMnemonic&&i.setMnemonicCode(t.layer.indexOf("shift")!=-1,n.K_CAPS),this.setSyntheticEventDefaults(i,n);var r={K_CAPS:h.stateBitmasks.CAPS,K_NUMLOCK:h.stateBitmasks.NUM_LOCK,K_SCROLL:h.stateBitmasks.SCROLL_LOCK},l=r[i.kName];return l&&(i.Lstates^=l,i.LmodifierChange=!0),i},c.prototype.setSyntheticEventDefaults=function(t,e){t.device.touchable||(t.Lstates=0,t.Lstates|=e.K_CAPS?h.modifierCodes.CAPS:h.modifierCodes.NO_CAPS,t.Lstates|=e.K_NUMLOCK?h.modifierCodes.NUM_LOCK:h.modifierCodes.NO_NUM_LOCK,t.Lstates|=e.K_SCROLL?h.modifierCodes.SCROLL_LOCK:h.modifierCodes.NO_SCROLL_LOCK),t.kName&&t.kName.substr(0,2)=="U_"&&(t.LisVirtualKey=!1),typeof t.Lcode=="undefined"&&(t.Lcode=this.getVKDictionaryCode(t.kName),t.Lcode||(t.Lcode=1)),(t.Lmodifiers&h.modifierBitmasks.ALT_GR_SIM)==h.modifierBitmasks.ALT_GR_SIM&&this.emulatesAltGr&&(t.Lmodifiers&=~h.modifierBitmasks.ALT_GR_SIM,t.Lmodifiers|=h.modifierCodes.RALT)},c.prototype.getVKDictionaryCode=function(t){var e=this.scriptObject.VKDictionary||{};if(!this.scriptObject.VKDictionary){if(typeof this.scriptObject.KVKD=="string")for(var n=this.scriptObject.KVKD.split(" "),i=0;i<n.length;i++)e[n[i].toUpperCase()]=i+256;this.scriptObject.VKDictionary=e}var r=e[t.toUpperCase()];return r||0},c.DEFAULT_SCRIPT_OBJECT={gs:function(t,e){return!1},KI:"",KN:"",KV:D.DEFAULT_RAW_SPEC,KM:0},c}(),j=nl;var at={osk:h},gt=function(){function c(t,e){this.loadedKeyboard=null,this._jsGlobal=t,this.keymanGlobal=e,this.install()}return c.prototype.KR=function(t){if(this.loadedKeyboard)throw new Error("Unexpected state:  the most-recently loaded keyboard field was not properly reset.");this.loadedKeyboard=new j(t)},c.prototype.KLOAD=function(t,e,n){return n},c.prototype.install=function(){this._jsGlobal.KeymanWeb=this,this._jsGlobal.keyman=this.keymanGlobal},c.prototype.uninstall=function(){this._jsGlobal.KeymanWeb==this&&delete this._jsGlobal.KeymanWeb,this._jsGlobal.keyman==this.keymanGlobal&&delete this._jsGlobal.keyman},c}();var dt=function(c){(0,B.__extends)(t,c);function t(e,n){var i=c.call(this,e)||this;return i.cause=n,i}return t}(Error);var yn=function(c){(0,B.__extends)(t,c);function t(e,n){var i=c.call(this,e)||this;return i.cause=n,i}return t}(Error);var il=function(){function c(t){this.uri=t}return c.prototype.missingError=function(t){var e="Cannot find the keyboard at ".concat(this.uri,".");return new yn(e,t)},c.prototype.scriptError=function(t){var e="Error registering the keyboard script at ".concat(this.uri,"; it may contain an error.");return new dt(e,t)},c}(),cl=function(){function c(t){this.stub=t}return c.prototype.missingError=function(t){var e=this.stub,n="Cannot find the ".concat(e.name," keyboard for ").concat(e.langName," at ").concat(e.filename,".");return new yn(n,t)},c.prototype.scriptError=function(t){var e=this.stub,n="Error registering the ".concat(e.name," keyboard for ").concat(e.langName,"; keyboard script at ").concat(e.filename," may contain an error.");return new dt(n,t)},c}(),rl=function(){function c(t){this._harness=t}return Object.defineProperty(c.prototype,"harness",{get:function(){return this._harness},enumerable:!1,configurable:!0}),c.prototype.loadKeyboardFromPath=function(t){this.harness.install();var e=this.loadKeyboardInternal(t,new il(t));return e},c.prototype.loadKeyboardFromStub=function(t){this.harness.install();var e=this.loadKeyboardInternal(t.filename,new cl(t),t.id);return e},c}(),In=rl;var Qn;(function(c){c.KEYBOARD="keyboard",c.LANGUAGE="language",c.LANGUAGE_KEYBOARD="languageKeyboard",c.BLANK="blank"})(Qn||(Qn={}));var Fe=Qn;function Un(c,t){if(c)return{family:c.family,path:t,files:c.filename||c.source}}var ll=function(){function c(t,e){if(typeof t!="string")if(t.KI||t.KL||t.KLC||t.KFont||t.KOskFont){var n=t;this.KI=n.KI,this.KN=n.KN,this.KL=n.KL,this.KLC=n.KLC,this.KFont=n.KFont,this.KOskFont=n.KOskFont,this._displayName=n instanceof c?n._displayName:n.displayName}else{var i=t;i.languages||(i.languages=i.language),this.KI=i.id,this.KN=i.name,this.KL=i.languages.name,this.KLC=i.languages.id,this.KFont=Un(i.languages.font,e),this.KOskFont=Un(i.languages.oskFont,e)}else this.KI=t,this.KLC=e}return Object.defineProperty(c,"spacebarTextMode",{get:function(){return typeof this.spacebarTextModeSrc=="string"?this.spacebarTextModeSrc:this.spacebarTextModeSrc()},set:function(t){this.spacebarTextModeSrc=t},enumerable:!1,configurable:!0}),c.fromMultilanguageAPIStub=function(t){var e=[];t.languages||(t.languages=t.language);for(var n=0,i=t.languages;n<i.length;n++){var r=i[n],l={id:t.id,name:t.name,languages:r};e.push(new c(l))}return e},Object.defineProperty(c.prototype,"id",{get:function(){return this.KI},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"name",{get:function(){return this.KN},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"langId",{get:function(){return this.KLC},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"langName",{get:function(){return this.KL},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"displayName",{get:function(){if(this._displayName)return this._displayName;var t=this.KN,e=this.KL;switch(c.spacebarTextMode){case Fe.KEYBOARD:return t;case Fe.LANGUAGE:return e;case Fe.LANGUAGE_KEYBOARD:return t==e?e:e+" - "+t;case Fe.BLANK:return"";default:return t}},set:function(t){this._displayName=t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"textFont",{get:function(){return this.KFont},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"oskFont",{get:function(){return this.KOskFont},enumerable:!1,configurable:!0}),c.prototype.validateForOSK=function(){return this.KLC?this.displayName===void 0||c.spacebarTextMode!=Fe.BLANK&&!this.displayName?new Error("A display name is missing for this keyboard and cannot be generated under current settings."):null:this.KI||this.KN?new Error("No language code was specified for use with the ".concat(this.KI||this.KN," keyboard")):new Error("No language code was specified for use with the corresponding keyboard")},c.prototype.validateForCustomKeyboard=function(){return!this.KI||!this.KN||!this.KL||!this.KLC?new Error("To use a custom keyboard, you must specify keyboard id, keyboard name, language and language code."):null},c.spacebarTextModeSrc=Fe.KEYBOARD,c}(),Oe=ll;var bn=function(){function c(t,e){this.p=t,this.d=e,this.o=c.ordinalSeed++}return c.prototype.match=function(t,e){var n=this.p==t&&this.d==e;return n},c.prototype.set=function(){this.matched=1},c.prototype.reset=function(){this.matched=0},c.prototype.before=function(t){return this.o<t.o},c.prototype.clone=function(){var t=new c(this.p,this.d);return t.o=this.o,t},c.prototype.equal=function(t){return this.d==t.d&&this.p==t.d&&this.o==t.o},c.ordinalSeed=0,c.sortFunc=function(t,e){return t.p!=e.p?e.p-t.p:e.o-t.o},c}();var Yi=function(){function c(){this.dks=[]}return c.prototype.toSortedArray=function(){return this.dks=this.dks.sort(bn.sortFunc),[].concat(this.dks)},c.prototype.clone=function(){var t=new c,e=this.toSortedArray();return t.dks=[],e.forEach(function(n){t.dks.push(n.clone())}),t},c.prototype.isMatch=function(t,e,n){if(this.dks.length==0)return!1;var i=t;e=i-e;for(var r=0;r<this.dks.length;r++)if(this.dks[r].match(e,n)&&!this.dks[r].matched)return this.dks[r].set(),!0;return this.resetMatched(),!1},c.prototype.add=function(t){this.dks=this.dks.concat(t)},c.prototype.remove=function(t){var e=this.dks.indexOf(t);this.dks.splice(e,1)},c.prototype.clear=function(){this.dks=[]},c.prototype.resetMatched=function(){for(var t=0,e=this.dks;t<e.length;t++){var n=e[t];n.reset()}},c.prototype.deleteMatched=function(){for(var t=0;t<this.dks.length;t++)this.dks[t].matched&&this.dks.splice(t--,1)},c.prototype.adjustPositions=function(t,e){if(e!=0)for(var n=0,i=this.dks;n<i.length;n++){var r=i[n];r.p>t&&(r.p+=e)}},c.prototype.equal=function(t){if(this.dks.length!=t.dks.length)return!1;for(var e=t.dks,n=[],i=function(a){var g=e.find(function(d){return a.equal(d)});if(!g)return{value:!1}},r=0,l=this.dks;r<l.length;r++){var s=l[r],o=i(s);if(typeof o=="object")return o.value}return n.length==e.length},c.prototype.count=function(){return this.dks.length},c}();var wi=function(){function c(t){this.id=t}return c.prototype.set=function(t){throw new Error("System store with ID "+this.id+" may not be directly set.")},c}();var Rt=function(c){(0,B.__extends)(t,c);function t(e,n){var i=c.call(this,e)||this;return i.handler=null,i._value=n,i}return Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),t.prototype.matches=function(e){return this._value==e},t.prototype.set=function(e){this.handler&&this.handler(this,e)||(this._value=e)},t}(wi);var Ti=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this,w.TSS_PLATFORM)||this;return n.kbdInterface=e,n}return t.prototype.matches=function(e){var n,i,r=e.split(" "),l=this.kbdInterface.activeDevice;for(n=0;n<r.length;n++)switch(i=r[n].toLowerCase(),i){case"touch":case"hardware":if(l.touchable!=(i=="touch"))return!1;break;case"macos":case"mac":i="macosx";case"macosx":case"windows":case"android":case"ios":case"linux":if(l.OS!=i)return!1;break;case"tablet":case"phone":case"desktop":if(l.formFactor!=i)return!1;break;case"web":if(l.browser=="native")return!1;break;case"native":case"chrome":case"firefox":case"safari":case"edge":case"opera":if(l.browser!=i)return!1;break;default:return!1}return!0},t}(wi);function hn(c,t,e){var n=Math.min(c.length,t.length),i,r,l,s,o;for(e?(i=r=c.length-1,l=r-n,s=-1,o=t.length-c.length):(i=r=0,l=n,s=1,o=0);r!=l&&c.charAt(r)==t.charAt(r+o);r+=s);if(r!=i&&r!=l){var a=c.charCodeAt(r-s),g=c.charCodeAt(r),d=t.charCodeAt(r+o),F=e?vt:ft,u=e?ft:vt;if(F(a)&&(u(g)||u(d)))return r-s}return r}lt();function Te(c){var t;return c?c.insert===""&&c.deleteLeft===0&&((t=c.deleteRight)!==null&&t!==void 0?t:0)===0:!0}var sl=function(){function c(t,e,n,i){this.insert=t,this.deleteLeft=e,this.deleteRight=n,this.erasedSelection=i}return c.nil=new c("",0,0,!1),c}();var ol=function(){function c(t,e,n,i){var r=this.token=c.tokenSeed++;this.keystroke=t,this.transform=e,this.alternates=i,this.preInput=n,this.transform.id=this.token,i&&i.forEach(function(l){l.sample.id=r})}return c.tokenSeed=0,c}();var Di=function(){function c(){this._dks=new Yi}return Object.defineProperty(c.prototype,"isSynthetic",{get:function(){return!0},enumerable:!1,configurable:!0}),c.prototype.resetContext=function(){this.deadkeys().clear()},c.prototype.deadkeys=function(){return this._dks},c.prototype.hasDeadkeyMatch=function(t,e){return this.deadkeys().isMatch(this.getDeadkeyCaret(),t,e)},c.prototype.insertDeadkeyBeforeCaret=function(t){var e=new bn(this.getDeadkeyCaret(),t);this.deadkeys().add(e)},c.prototype.adjustDeadkeys=function(t){this.deadkeys().adjustPositions(this.getDeadkeyCaret(),t)},c.prototype.setDeadkeys=function(t){this._dks=t.clone()},c.prototype.buildTransformFrom=function(t){var e=this.getTextBeforeCaret(),n=t.getTextBeforeCaret(),i=hn(n,e,!1),r=n.substring(i)._kmwLength(),l=e.substring(i),s=this.getTextAfterCaret(),o=t.getTextAfterCaret(),a=hn(o,s,!0),g=o.substring(0,a+1)._kmwLength();return new sl(l,r,g,t.getSelectedText()&&!this.getSelectedText())},c.prototype.buildTranscriptionFrom=function(t,e,n,i){var r=this.buildTransformFrom(t);return new ol(e,r,T.from(t,n),i)},c.prototype.restoreTo=function(t){this.clearSelection(),this.setTextBeforeCaret(t.getTextBeforeCaret()),this.setTextAfterCaret(t.getTextAfterCaret()),this._dks=t._dks.clone()},c.prototype.apply=function(t){this.clearSelection(),t.deleteRight&&this.setTextAfterCaret(this.getTextAfterCaret()._kmwSubstr(t.deleteRight)),t.deleteLeft&&this.deleteCharsBeforeCaret(t.deleteLeft),t.insert&&this.insertTextBeforeCaret(t.insert),this._dks.clear()},c.prototype.setTextBeforeCaret=function(t){this.deleteCharsBeforeCaret(this.getTextBeforeCaret()._kmwLength()),this.insertTextBeforeCaret(t)},c.prototype.saveProperties=function(){},c.prototype.restoreProperties=function(){},c}(),Cn=Di,T=function(c){(0,B.__extends)(t,c);function t(e,n,i){var r=c.call(this)||this;r.selForward=!0,r.text=e||"";var l=r.text._kmwLength();return r.selStart=typeof n=="number"?n:l,r.selEnd=typeof i=="number"?i:r.selStart,r.selForward=r.selEnd>=r.selStart,r}return t.from=function(e,n){var i;if(e instanceof t){var r=e;i=new t(r.text,r.selStart,r.selEnd)}else{var l=e.getText(),s=l._kmwLength(),o=s,a=0;if(e.hasSelection()){var g=e.getTextBeforeCaret(),d=e.getTextAfterCaret();o=g._kmwLength(),a=s-d._kmwLength()}i=new t(l,o,a)}return i.setDeadkeys(e.deadkeys()),i},t.prototype.clearSelection=function(){this.text=this.getTextBeforeCaret()+this.getTextAfterCaret(),this.selEnd=this.selStart,this.selForward=!0},t.prototype.invalidateSelection=function(){},t.prototype.isSelectionEmpty=function(){return this.selStart==this.selEnd},t.prototype.hasSelection=function(){return!0},t.prototype.getDeadkeyCaret=function(){return this.selStart},t.prototype.setSelection=function(e,n){if(this.selStart=e,this.selEnd=typeof n=="number"?n:e,this.selForward=n>=e,!this.selForward){var i=this.selStart;this.selStart=this.selEnd,this.selEnd=i}},t.prototype.getTextBeforeCaret=function(){return this.text.kmwSubstr(0,this.selStart)},t.prototype.getSelectedText=function(){return this.text.kmwSubstr(this.selStart,this.selEnd-this.selStart)},t.prototype.getTextAfterCaret=function(){return this.text.kmwSubstr(this.selEnd)},t.prototype.getText=function(){return this.text},t.prototype.deleteCharsBeforeCaret=function(e){e>=0&&(e>this.selStart&&(e=this.selStart),this.adjustDeadkeys(-e),this.text=this.text.kmwSubstr(0,this.selStart-e)+this.text.kmwSubstr(this.selStart),this.selStart-=e,this.selEnd-=e)},t.prototype.insertTextBeforeCaret=function(e){this.adjustDeadkeys(e._kmwLength()),this.text=this.getTextBeforeCaret()+e+this.text.kmwSubstr(this.selStart),this.selStart+=e.kmwLength(),this.selEnd+=e.kmwLength()},t.prototype.handleNewlineAtCaret=function(){this.insertTextBeforeCaret("\n")},t.prototype.setTextAfterCaret=function(e){this.text=this.getTextBeforeCaret()+e},t.prototype.isEqual=function(e){return this.text==e.text&&this.selStart==e.selStart&&this.selEnd==e.selEnd&&this.deadkeys().equal(e.deadkeys())},t.prototype.doInputEvent=function(){},t}(Di);var al=function(){function c(){this.transcription=null,this.setStore={},this.saveStore={},this.variableStores={},this.triggersDefaultCommand=!1}return c.prototype.finalize=function(t,e,n){if(!this.transcription)throw"Cannot finalize a RuleBehavior with no transcription.";t.beepHandler&&this.beep&&t.beepHandler(e);for(var i in this.setStore){var r=t.keyboardInterface.systemStores[i];if(r)try{r.set(this.setStore[i])}catch(s){t.errorLogger&&t.errorLogger("Rule attempted to perform illegal operation - 'platform' may not be changed.")}else t.warningLogger&&t.warningLogger("Unknown store affected by keyboard rule: "+i)}if(t.keyboardInterface.applyVariableStores(this.variableStores),t.keyboardInterface.variableStoreSerializer)for(var i in this.saveStore)t.keyboardInterface.variableStoreSerializer.saveStore(t.activeKeyboard.id,i,this.saveStore[i]);if(this.triggersDefaultCommand){var l=this.transcription.keystroke;t.defaultRules.applyCommand(l,e)}t.warningLogger&&this.warningLog?t.warningLogger(this.warningLog):t.errorLogger&&this.errorLog&&t.errorLogger(this.errorLog)},c.prototype.mergeInDefaults=function(t){var e=this.transcription.keystroke,n=t.transcription.keystroke;if(e.Lcode!=n.Lcode||e.Lmodifiers!=n.Lmodifiers)throw"RuleBehavior default-merge not supported unless keystrokes are identical!";this.triggersDefaultCommand=this.triggersDefaultCommand||t.triggersDefaultCommand;var i=T.from(this.transcription.preInput,!1);i.apply(this.transcription.transform),i.apply(t.transcription.transform),this.transcription=i.buildTranscriptionFrom(this.transcription.preInput,e,!1,this.transcription.alternates)},c}(),ue=al;var gl=function(){function c(){}return c}();var dl=function(){function c(){}return c.prototype.reset=function(){this._cache=[]},c.prototype.get=function(t,e){return typeof this._cache[t]=="undefined"||typeof this._cache[t][e]=="undefined"?null:this._cache[t][e]},c.prototype.set=function(t,e,n){typeof this._cache[t]=="undefined"&&(this._cache[t]=[]),this._cache[t][e]=n},c}(),Bl=function(){function c(){}return c.prototype.reset=function(){this._cache=[]},c.prototype.get=function(t,e){return typeof this._cache[t]=="undefined"||typeof this._cache[t][e]=="undefined"?null:this._cache[t][e]},c.prototype.set=function(t,e,n){typeof this._cache[t]=="undefined"&&(this._cache[t]=[]),this._cache[t][e]=n},c.prototype.clone=function(){var t=new c;return t._cache=this._cache,t},c}(),w;(function(c){c[c.TSS_LAYER=33]="TSS_LAYER",c[c.TSS_PLATFORM=31]="TSS_PLATFORM",c[c.TSS_NEWLAYER=42]="TSS_NEWLAYER",c[c.TSS_OLDLAYER=43]="TSS_OLDLAYER"})(w||(w={}));var Mi=function(c){(0,B.__extends)(t,c);function t(e,n,i){i===void 0&&(i=null);var r=c.call(this,e,n)||this;return r.cachedContext=new dl,r.cachedContextEx=new Bl,r._AnyIndices=[],r.systemStores={},r.systemStores[w.TSS_PLATFORM]=new Ti(r),r.systemStores[w.TSS_LAYER]=new Rt(w.TSS_LAYER,"default"),r.systemStores[w.TSS_NEWLAYER]=new Rt(w.TSS_NEWLAYER,""),r.systemStores[w.TSS_OLDLAYER]=new Rt(w.TSS_OLDLAYER,""),r.variableStoreSerializer=i,r}return Object.defineProperty(t.prototype,"Codes",{get:function(){return h},enumerable:!1,configurable:!0}),t.prototype.saveFocus=function(){},t.prototype.registerKeyboard=function(e){var n=new j(e);this.loadedKeyboard=n},t.prototype.context=function(e,n,i){var r=this.cachedContext.get(e,n);if(r!==null)return r;var l=this.KC_(e,n,i);return this.cachedContext.set(e,n,l),l},t.prototype.KC_=function(e,n,i){var r="";return r=i.isSelectionEmpty()?i.getTextBeforeCaret():"",r._kmwLength()<e&&(r=Array(e-r._kmwLength()+1).join("\uFFFE")+r),r._kmwSubstr(-e)._kmwSubstr(0,n)},t.prototype.nul=function(e,n){var i=this.context(e+1,1,n);return i==="\uFFFE"},t.prototype.contextMatch=function(e,n,i,r){var l=this.context(e,r,n);return l===i?!0:(n.deadkeys().resetMatched(),!1)},t.prototype._BuildExtendedContext=function(e,n,i){var r=this.cachedContextEx.get(e,n);if(r!==null)return r;if(r=this.cachedContextEx.get(e,e),r===null){var l=i.deadkeys().toSortedArray(),s=0;for(r={valContext:[],deadContext:[]};r.valContext.length<e;){var o=i.getDeadkeyCaret(),a=o-s;if(l.length>0&&l[0].p>a){l.splice(0,1);continue}else if(l.length>0&&l[0].p==a)r.deadContext[e-r.valContext.length-1]=l[0],r.valContext=[l[0].d].concat(r.valContext),l.splice(0,1);else{var g=this.context(++s,1,i);r.valContext=[g].concat(r.valContext)}}this.cachedContextEx.set(e,e,r)}var d=r;d.valContext=d.valContext.slice(0,n);for(var F=0;F<d.valContext.length;F++)d.valContext[F]=="\uFFFE"&&(d.valContext.splice(0,1),d.deadContext.splice(0,1));return d.valContext.length==0&&(d.valContext=["\uFFFE"],d.deadContext=[]),this.cachedContextEx.set(e,n,d),d},t.prototype.fullContextMatch=function(e,n,i){var r=this._BuildExtendedContext(e,i.length,n);this.ruleContextEx=this.cachedContextEx.clone();for(var l=r.valContext,s=r.deadContext,o=!1,a="\uFFFE",g=function(U){throw new Error("Unexpected object in fullContextMatch specification: "+U)},d=0;d<i.length;d++)if(typeof i[d]=="string"){var F=i[d];if(F!==l[d]){o=!0;break}}else{var u=i[d];switch(u.t){case"d":u.d!==l[d]?o=!0:s[d].set();break;case"a":var I;typeof l[d]=="string"?I=l[d]:I={t:"d",d:l[d]};var Q=this.any(d,I,u.a);u.n?u.n&&(Q||l[d]===a)&&(o=!0):Q?s[d]!==void 0&&s[d].set():o=!0;break;case"i":var y=this._Index(u.i,u.o);y!==void 0&&(typeof y=="string"?y:y.d)!==l[d]?o=!0:s[d]!==void 0&&s[d].set();break;case"c":l[u.c-1]!==l[d]?o=!0:s[d]!==void 0&&s[d].set();break;case"n":l[d]!=a&&(o=!0);break;default:g(u)}}return o&&(n.deadkeys().resetMatched(),this._AnyIndices=[]),!o},t.prototype.isKeypress=function(e){return this.activeKeyboard.isMnemonic?!e.LisVirtualKey:!!de._USKeyCodeToCharCode(e)},t.matchModifiersToRuleChirality=function(e,n){var i=h.modifierCodes.LALT|h.modifierCodes.RALT,r=h.modifierCodes.LCTRL|h.modifierCodes.RCTRL,l=e;if(!(n&i)){var s=l&i;s&&(l^=s|h.modifierCodes.ALT)}if(!(n&r)){var o=l&r;o&&(l^=o|h.modifierCodes.CTRL)}return l},t.prototype.keyMatch=function(e,n,i){var r=!1,l=e.Lcode==173?189:e.Lcode,s=this.activeKeyboard.modifierBitmask,o=s&h.modifierBitmasks.ALL,a=s&h.stateBitmasks.ALL,g=t.matchModifiersToRuleChirality(e.Lmodifiers,n);return e.vkCode>255&&(l=e.vkCode),e.LisVirtualKey||l>255?((n&16384)==16384||l>255)&&(r=i==l&&(n&o)==g,r=r&&this.stateMatch(e,n&a)):(n&16384)==0&&(r=l==i),r||this.activeTargetOutput.deadkeys().resetMatched(),r},t.prototype.stateMatch=function(e,n){return(n&e.Lstates)==n},t.prototype.keyInformation=function(e){var n=new gl;return n.vk=e.LisVirtualKey,n.code=e.Lcode,n.modifiers=e.Lmodifiers,n},t.prototype.deadkeyMatch=function(e,n,i){return n.hasDeadkeyMatch(e,i)},t.prototype.beep=function(e){this.resetContextCache(),this.ruleBehavior.beep=!0},t.prototype._ExplodeStore=function(e){if(typeof e=="string"){var n=this.activeKeyboard.explodedStores;if(n[e])return n[e];for(var i=[],r=0;r<e._kmwLength();r++)i.push(e._kmwCharAt(r));return n[e]=i,i}else return e},t.prototype.any=function(e,n,i){if(n=="")return!1;i=this._ExplodeStore(i);for(var r=-1,l=0;l<i.length;l++){var s=i[l];if(typeof s=="string"){if(i[l]==n){r=l;break}}else if(s.d===n.d){r=l;break}}return this._AnyIndices[e]=r,r>=0},t.prototype._Index=function(e,n){return e=this._ExplodeStore(e),this._AnyIndices[n-1]<e.length?e[this._AnyIndices[n-1]]:(console.warn("Unmatched contextual index() statement detected in rule with index "+n+"!"),"")},t.prototype.indexOutput=function(e,n,i,r){this.resetContextCache();var l=function(o){throw new Error("Unexpected object in fullContextMatch specification: "+o)},s=this._Index(n,i);if(s!=="")if(typeof s=="string")this.output(e,r,s);else if(s.t)switch(s.t){case"b":this.beep(r);break;case"d":this.deadkeyOutput(e,r,s.d);break;default:l(s)}else this.deadkeyOutput(e,r,s.d)},t.prototype.deleteContext=function(e,n){var i;if(e>0){i=this._BuildExtendedContext(e,e,n);for(var r=0,l=0;l<i.valContext.length;l++){var s=i.deadContext[l];s?(n.deadkeys().remove(s),e--):i.valContext[l]=="\uFFFE"&&r++}var o=i.valContext.length-r;e>o&&(e=o)}n.deadkeys().resetMatched(),this.output(e,n,"")},t.prototype.output=function(e,n,i){this.resetContextCache(),n.saveProperties(),n.clearSelection(),n.deadkeys().deleteMatched(),e>=0&&n.deleteCharsBeforeCaret(e),n.insertTextBeforeCaret(i),n.restoreProperties()},t.prototype.contextExOutput=function(e,n,i,r){this.resetContextCache(),e>=0&&this.output(e,n,"");var l=this.ruleContextEx.get(i,i),s=l.deadContext[r-1],o=l.valContext[r-1];if(s)n.insertDeadkeyBeforeCaret(s.d);else if(typeof o=="string")this.output(-1,n,o);else throw new Error("contextExOutput: should never be a numeric valContext with no corresponding deadContext")},t.prototype.deadkeyOutput=function(e,n,i){this.resetContextCache(),e>=0&&this.output(e,n,""),n.insertDeadkeyBeforeCaret(i)},t.prototype.ifStore=function(e,n,i){var r=!0,l=this.systemStores[e];return l&&(r=l.matches(n)),r},t.prototype.setStore=function(e,n,i){return this.resetContextCache(),e==w.TSS_LAYER&&this.activeDevice.touchable?(this.ruleBehavior.setStore[e]=n,!0):!1},t.prototype.loadStore=function(e,n,i){if(this.resetContextCache(),this.variableStoreSerializer){var r=this.variableStoreSerializer.loadStore(e,n);return r[n]||i}else return i},t.prototype.saveStore=function(e,n){this.resetContextCache();var i=this.activeKeyboard;if(!i||typeof i.id=="undefined"||i.id=="")return!1;var r={};return r[e]=n,this.ruleBehavior?this.ruleBehavior.saveStore[e]=r:this.variableStoreSerializer.saveStore(this.activeKeyboard.id,e,r),!0},t.prototype.resetContextCache=function(){this.cachedContext.reset(),this.cachedContextEx.reset()},t.prototype.defaultBackspace=function(e){e.isSelectionEmpty()?this.output(1,e,""):this.output(0,e,"")},t.prototype.processNewContextEvent=function(e,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processNewContextEvent.bind(this.activeKeyboard),e,n,!0)},t.prototype.processPostKeystroke=function(e,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processPostKeystroke.bind(this.activeKeyboard),e,n,!0)},t.prototype.processKeystroke=function(e,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.process.bind(this.activeKeyboard),e,n,!1)},t.prototype.process=function(e,n,i,r){if(n)if(this.activeKeyboard){if(!e)throw"No callee for keystroke processing!"}else throw"No active keyboard for keystroke processing!";else throw"No target specified for keyboard output!";n.invalidateSelection(),n.deadkeys().resetMatched(),this.resetContextCache();var l=T.from(n,!0),s=this.activeKeyboard.variableStores;this.ruleBehavior=new ue,this.activeDevice=i.device,this.activeTargetOutput=n;var o=e(n,i);this.activeTargetOutput=null,this.ruleBehavior.transcription=n.buildTranscriptionFrom(l,i,r),this.ruleBehavior.variableStores=this.activeKeyboard.variableStores,this.activeKeyboard.variableStores=s,this.ruleBehavior.triggerKeyDefault=!o;var a=this.ruleBehavior;return this.ruleBehavior=null,a},t.prototype.applyVariableStores=function(e){this.activeKeyboard.variableStores=e},t.__publishShorthandAPI=function(){var e=this.prototype,n=function(i,r){e[r]&&(e[i]=e[r])};n("KSF","saveFocus"),n("KBR","beepReset"),n("KT","insertText"),n("KR","registerKeyboard"),n("KRS","registerStub"),n("KC","context"),n("KN","nul"),n("KCM","contextMatch"),n("KFCM","fullContextMatch"),n("KIK","isKeypress"),n("KKM","keyMatch"),n("KSM","stateMatch"),n("KKI","keyInformation"),n("KDM","deadkeyMatch"),n("KB","beep"),n("KA","any"),n("KDC","deleteContext"),n("KO","output"),n("KDO","deadkeyOutput"),n("KCXO","contextExOutput"),n("KIO","indexOutput"),n("KIFS","ifStore"),n("KSETS","setStore"),n("KLOAD","loadStore"),n("KSAVE","saveStore")},t.GLOBAL_NAME="KeymanWeb",t}(gt),Bt=Mi;(function(){Mi.__publishShorthandAPI()})();var Fl=function(c){(0,B.__extends)(t,c);function t(e,n){var i=c.call(this)||this;return i.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1},i.modStateFlags=0,n||(n=t.DEFAULT_OPTIONS),i.contextDevice=e,i.baseLayout=n.baseLayout||t.DEFAULT_OPTIONS.baseLayout,i.keyboardInterface=n.keyboardInterface||new Bt(Pe(),at),i.defaultRules=n.defaultOutputRules||t.DEFAULT_OPTIONS.defaultOutputRules,i}return Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this.keyboardInterface.activeKeyboard},set:function(e){this.keyboardInterface.activeKeyboard=e,this.resetContext()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerStore",{get:function(){return this.keyboardInterface.systemStores[w.TSS_LAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newLayerStore",{get:function(){return this.keyboardInterface.systemStores[w.TSS_NEWLAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldLayerStore",{get:function(){return this.keyboardInterface.systemStores[w.TSS_OLDLAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerId",{get:function(){return this.layerStore.value},set:function(e){this.layerStore.set(e)},enumerable:!1,configurable:!0}),t.prototype.defaultRuleBehavior=function(e,n,i){var r=T.from(n,i),l=new ue,s=!1,o="",a;if(e.isSynthetic||n.isSynthetic)if(s=!0,this.defaultRules.isCommand(e))l.triggersDefaultCommand=!0;else if((a=this.defaultRules.forSpecialEmulation(e))!=null)switch(a){case Se.Backspace:this.keyboardInterface.defaultBackspace(n);break;case Se.Enter:n.handleNewlineAtCaret();break;default:l.errorLog="Unexpected 'special emulation' character (\\u"+a.kmwCharCodeAt(0).toString(16)+") went unhandled!"}else s=!1;var g=this.activeKeyboard&&this.activeKeyboard.isMnemonic;if(!s)if((o=this.defaultRules.forAny(e,g))!=null)if(a=this.defaultRules.forSpecialEmulation(e),a==Se.Backspace)this.keyboardInterface.defaultBackspace(n);else{if(a||this.defaultRules.isCommand(e))return null;this.keyboardInterface.output(0,n,o)}else return null;if(l.errorLog)return l;var d=n.buildTranscriptionFrom(r,e,i);return l.transcription=d,l},t.prototype.processNewContextEvent=function(e,n){return this.activeKeyboard?this.keyboardInterface.processNewContextEvent(n,this.activeKeyboard.constructNullKeyEvent(e,this.stateKeys)):null},t.prototype.processPostKeystroke=function(e,n){return this.activeKeyboard?this.keyboardInterface.processPostKeystroke(n,this.activeKeyboard.constructNullKeyEvent(e,this.stateKeys)):null},t.prototype.processKeystroke=function(e,n){var i,r=n.getTextBeforeCaret().kmwLength()==0&&n.isSelectionEmpty();if(this.activeKeyboard&&e.Lcode!=0&&(i=this.keyboardInterface.processKeystroke(n,e)),r&&e.Lcode==h.keyCodes.K_BKSP&&i.triggerKeyDefault)i=this.defaultRuleBehavior(e,n,!1),i.triggerKeyDefault=!0,i.transcription.transform.deleteLeft=1;else if(!i||i.triggerKeyDefault){e.Lcode=e.vkCode||e.Lcode,this.keyboardInterface.activeTargetOutput=n;var l=this.defaultRuleBehavior(e,n,!1);l&&(i?i.mergeInDefaults(l):i=l,i.triggerKeyDefault=!1),this.keyboardInterface.activeTargetOutput=null}return i},t.prototype._UpdateVKShift=function(e){var n=0,i=["CAPS","NUM_LOCK","SCROLL_LOCK"],r=["K_CAPS","K_NUMLOCK","K_SCROLL"];if(!this.activeKeyboard)return!0;if(e){n=e.Lmodifiers,this.activeKeyboard.isChiral&&this.activeKeyboard.emulatesAltGr&&(this.modStateFlags&h.modifierBitmasks.ALT_GR_SIM)==h.modifierBitmasks.ALT_GR_SIM&&(n|=h.modifierBitmasks.ALT_GR_SIM,n&=~h.modifierCodes.RALT);for(var l=!1,s=0;s<i.length;s++)e.Lstates&h.stateBitmasks[i[s]]&&(this.stateKeys[r[s]]=!!(e.Lstates&h.modifierCodes[i[s]]),l=!0);l&&this.emit("statekeychange",this.stateKeys)}return this.updateStates(),this.activeKeyboard.isMnemonic&&this.stateKeys.K_CAPS&&(!e||!e.isModifier)&&(n^=h.modifierCodes.SHIFT),this.layerId=this.getLayerId(n),!0},t.prototype.updateStates=function(){for(var e=["CAPS","NUM_LOCK","SCROLL_LOCK"],n=["K_CAPS","K_NUMLOCK","K_SCROLL"],i=0;i<n.length;i++){var r=n[i],l=this.stateKeys[r],s=e[i],o="NO_"+e[i];l?(this.modStateFlags|=h.modifierCodes[s],this.modStateFlags&=~h.modifierCodes[o]):(this.modStateFlags&=~h.modifierCodes[s],this.modStateFlags|=h.modifierCodes[o])}},t.prototype.getLayerId=function(e){return D.getLayerId(e)},t.prototype.selectLayer=function(e){var n=e.kName,i=e.kNextLayer,r=this.activeKeyboard&&this.activeKeyboard.isChiral;if(typeof i=="number"&&(i=this.getLayerId(i*16)),!i)switch(n){case"K_LSHIFT":case"K_RSHIFT":case"K_SHIFT":i="shift";break;case"K_LCONTROL":case"K_LCTRL":if(r){i="leftctrl";break}case"K_RCONTROL":case"K_RCTRL":if(r){i="rightctrl";break}case"K_CTRL":i="ctrl";break;case"K_LMENU":case"K_LALT":if(r){i="leftalt";break}case"K_RMENU":case"K_RALT":if(r){i="rightalt";break}case"K_ALT":i="alt";break;case"K_ALTGR":r?i="leftctrl-rightalt":i="ctrl-alt";break;case"K_CURRENCIES":case"K_NUMERALS":case"K_SHIFTED":case"K_UPPER":case"K_LOWER":case"K_SYMBOLS":i="default";break}return i?(this.updateLayer(e,i),!0):!1},t.prototype.updateLayer=function(e,n){var i=this.layerId,r=i;if(!(n==i&&e.device.formFactor!=v.FormFactor.Desktop)){var l=n,s;if(e.device.formFactor==v.FormFactor.Desktop){var o=["leftctrl","rightctrl","ctrl","leftalt","rightalt","alt","shift"];for(s=0;s<o.length;s++)l=l.replace(o[s]+"-",""),l=l.replace(o[s],"");if(i=="default"||i=="numeric"||i=="symbol"||i=="currency"||l!="")r=n;else{var a=h.getModifierState(r);for(s=0;s<o.length;s++)r=r.replace(o[s]+"-",""),r=r.replace(o[s],"");switch(n){case"shift":a^=h.modifierCodes.SHIFT;break;case"leftctrl":a^=h.modifierCodes.LCTRL;break;case"rightctrl":a^=h.modifierCodes.RCTRL;break;case"ctrl":a^=h.modifierCodes.CTRL;break;case"leftalt":a^=h.modifierCodes.LALT;break;case"rightalt":a^=h.modifierCodes.RALT;break;case"alt":a^=h.modifierCodes.ALT;break;default:r=n}r!="default"&&(r==""?r=this.getLayerId(a):r=this.getLayerId(a)+"-"+r)}r==""&&(r="default")}else r=n;var g=this.activeKeyboard.layout(e.device.formFactor);g.getLayer(r)?this.layerId=r:this.layerId="default";var d=h.getModifierState(this.layerId);this.modStateFlags=d|e.Lstates}},t.prototype.doModifierPress=function(e,n,i){return this.activeKeyboard?e.isModifier?(this.activeKeyboard.notify(e.Lcode,n,i?1:0),e.device.touchable?!0:this._UpdateVKShift(e)):(e.LmodifierChange&&(this.activeKeyboard.notify(0,n,1),e.device.touchable||this._UpdateVKShift(e)),!1):!1},t.prototype.performNewContextEvent=function(e){var n=this.processNewContextEvent(this.contextDevice,e);return n&&n.finalize(this,e,!0),n},t.prototype.resetContext=function(e){this.layerId="default",e==null||e.resetContext(),this.keyboardInterface.resetContextCache(),e&&this.performNewContextEvent(e),this.contextDevice.touchable||this._UpdateVKShift(null)},t.prototype.setNumericLayer=function(e){if(this.activeKeyboard){var n=this.activeKeyboard.layout(e.formFactor);n.getLayer("numeric")&&(this.layerId="numeric")}},t.DEFAULT_OPTIONS={baseLayout:"us",defaultOutputRules:new ke},t}(f.default),xn=Fl;var zi=function(c){return c.substring(c.length-1)!="/"?c+"/":c},ul=function(){function c(t,e){e=zi(e),this.sourcePath=e,this.protocol=e.replace(/(.{3,5}:)(.*)/,"$1"),this.updateFromOptions(t)}return c.prototype.updateFromOptions=function(t){var e=this.sourcePath.replace(/(https?:\/\/)([^\/]*)(.*)/,"$1$2/");this._root=e,t.root!=""?this._root=this.fixPath(t.root):this._root=this.fixPath(e);var n=t.resources;n==""&&(n=this.sourcePath),this._resources=this.fixPath(n),this._keyboards=this.fixPath(t.keyboards),this._fonts=this.fixPath(t.fonts)},c.prototype.fixPath=function(t){return t.length==0||(t=zi(t),t.replace(/^(http)s?:.*/,"$1")=="http"||t.replace(/^(file):.*/,"$1")=="file")?t:t.substring(0,2)=="//"?this.protocol+t:t.substring(0,1)=="/"?this.root+t.substring(1):this.sourcePath+t},Object.defineProperty(c.prototype,"fonts",{get:function(){return this._fonts},enumerable:!1,configurable:!0}),c.prototype.updateFontPath=function(t){this._fonts=this.fixPath(t)},Object.defineProperty(c.prototype,"root",{get:function(){return this._root},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"resources",{get:function(){return this._resources},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"keyboards",{get:function(){return this._keyboards},enumerable:!1,configurable:!0}),c}(),Gn=ul;var pn={root:"",resources:"",keyboards:"",fonts:""};var yl=function(){function c(t){t.OS==v.OperatingSystem.Android?this.popupCanvasBackgroundColor="#999":this.popupCanvasBackgroundColor=c.prefersDarkMode()?"#0f1319":"#ffffff"}return c.prefersDarkMode=function(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches},c}(),Ki=yl;var Jt=function(){function c(){this.touchable="ontouchstart"in window,this.OS="",this.formFactor="desktop",this.browser="",this.dyPortrait=0,this.dyLandscape=0,this.version="0",this.orientation=window.orientation}return c.prototype.getDPI=function(){var t=document.createElement("DIV"),e=t.style,n=96;return document.readyState!=="complete"||(t.id="calculateDPI",e.position="absolute",e.display="block",e.visibility="hidden",e.left="10px",e.top="10px",e.width="1in",e.height="10px",document.body.appendChild(t),n=typeof window.devicePixelRatio=="undefined"?t.offsetWidth:t.offsetWidth*window.devicePixelRatio,document.body.removeChild(t)),n},c.prototype.detect=function(){var t=!1;if(navigator&&navigator.userAgent){var e=navigator.userAgent;if(e.indexOf("iPad")>=0)this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;else if(e.indexOf("iPhone")>=0)this.OS="iOS",this.formFactor="phone",this.dyPortrait=this.dyLandscape=25;else if(e.indexOf("Android")>=0){this.OS="Android",this.formFactor="phone",this.dyPortrait=75,this.dyLandscape=25;try{var n=new RegExp("(?:Android\\s+)(\\d+\\.\\d+\\.\\d+)");this.version=e.match(n)[1]}catch(I){}}else if(e.indexOf("Linux")>=0)this.OS="Linux";else if(e.indexOf("Macintosh")>=0){var i=/Intel Mac OS X (\d+(?:[_\.]\d+)+)/i,r=i.exec(e);if(!r)console.warn("KMW could not properly parse the user agent string.A suboptimal keyboard layout may result."),this.OS="MacOSX";else if(r.length>1&&r[1]){var l=r[1].replace("_","."),s=new ee(l);t=ee.MAC_POSSIBLE_IPAD_ALIAS.compareTo(s)<=0,this.OS="MacOSX"}}else e.indexOf("Windows NT")>=0&&(this.OS="Windows",e.indexOf("Touch")>=0&&(this.formFactor="phone"),typeof navigator.msMaxTouchPoints=="number"&&navigator.msMaxTouchPoints>0&&(this.touchable=!0))}var o=Math.min(screen.width,screen.height),a=Math.max(screen.width,screen.height),g=o/a;this.OS!="iOS"&&this.formFactor=="phone"&&(o>=600&&g>.5625||g>=.625)&&(this.formFactor="tablet");var d=navigator.platform=="Win32"||navigator.platform=="MacIntel";this.OS=="iOS"&&!("ongesturestart"in window)&&!d&&(this.OS="Android"),this.browser="web",(this.OS=="iOS"||this.OS.toLowerCase()=="macosx")&&(this.browser="safari");var F=/Firefox|Chrome|OPR|Safari|Edge/;if(F.test(navigator.userAgent)&&(navigator.userAgent.indexOf("Firefox")>=0&&"onmozorientationchange"in screen?this.browser="firefox":navigator.userAgent.indexOf("OPR")>=0?this.browser="opera":navigator.userAgent.indexOf(" Edge/")>=0?this.browser="edge":navigator.userAgent.indexOf("Chrome")>=0?this.browser="chrome":navigator.userAgent.indexOf("Safari")>=0&&(this.browser="safari")),t&&this.browser=="safari"&&window.TouchEvent){this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;var u=screen.height/screen.width;u<1&&(u=1/u),u>1.6&&(this.formFactor="phone",this.dyPortrait=this.dyLandscape=25)}return this.colorScheme=Ki.prefersDarkMode()?"dark":"light",this.coreSpec},Object.defineProperty(c.prototype,"coreSpec",{get:function(){return new v(this.browser,this.formFactor,this.OS,this.touchable)},enumerable:!1,configurable:!0}),c}();var Vn=function(c){(0,B.__extends)(t,c);function t(e,n){var i=c.call(this)||this;if(i.applyCacheBusting=!1,!n){var r=new Jt;r.detect(),n=r.coreSpec}return i.sourcePath=e,i.hostDevice=n,i.deferForInitialization=new J,i}return t.prototype.initialize=function(e){var n=this;this._paths?this._paths.updateFromOptions(e):this._paths=new Gn(e,this.sourcePath),typeof e.setActiveOnRegister=="boolean"?this.activateFirstKeyboard=e.setActiveOnRegister:this.activateFirstKeyboard=!0,this._spacebarText=e.spacebarText,Oe.spacebarTextMode=function(){return n.spacebarText}},t.prototype.finalizeInit=function(){this.deferForInitialization.resolve()},Object.defineProperty(t.prototype,"paths",{get:function(){return this._paths},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spacebarText",{get:function(){return this._spacebarText},set:function(e){this._spacebarText!=e&&(this._spacebarText=e,this.emit("spacebartext",e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"softDevice",{get:function(){return this.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hardDevice",{get:function(){return Bn(this.hostDevice)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stubNamespacer",{get:function(){return this._stubNamespacer},set:function(e){this._stubNamespacer=e},enumerable:!1,configurable:!0}),t.prototype.debugReport=function(){return{hostDevice:this.hostDevice,initialized:this.deferForInitialization.isResolved}},t.prototype.onRuleFinalization=function(e,n){},t}(f.default);var mn=(0,B.__assign)({setActiveOnRegister:!0,spacebarText:Fe.LANGUAGE_KEYBOARD},pn);var Xn=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this)||this;return n.pendingActivations=[],n.engineConfig=e,n}return Object.defineProperty(t.prototype,"predictionContext",{get:function(){return this._predictionContext},enumerable:!1,configurable:!0}),t.prototype.configure=function(e){this._resetContext=e.resetContext,this._predictionContext=e.predictionContext,this.keyboardCache=e.keyboardCache},t.prototype.insertText=function(e,n,i){var r=this.activeTarget;return r!=null?(n!=null&&e.output(0,r,n),typeof i!="undefined"&&i!==null&&e.deadkeyOutput(0,r,i),r.invalidateSelection(),!0):!1},t.prototype.resetContext=function(){this._resetContext(this.activeTarget),this.predictionContext.resetContext()},t.prototype.findAndPopActivation=function(e){var n;for(n=0;n<this.pendingActivations.length&&this.pendingActivations[n].target!=e;n++);return n==this.pendingActivations.length?null:this.pendingActivations.splice(n,1)[0]},t.prototype.deferredKeyboardActivation=function(e,n,i){return(0,B.__awaiter)(this,void 0,void 0,function(){var r,l;return(0,B.__generator)(this,function(s){switch(s.label){case 0:return r={target:i,keyboard:e,stub:n},this.findAndPopActivation(i),this.pendingActivations.push(r),[4,e];case 1:return s.sent(),l=this.findAndPopActivation(i),l==r?[2,r]:l?(this.pendingActivations.push(l),[2,null]):[2,null]}})})},t.prototype.activateKeyboard=function(e,n,i){return(0,B.__awaiter)(this,void 0,void 0,function(){var r,l,s,o,a;return(0,B.__generator)(this,function(g){switch(g.label){case 0:return r=!this.activeKeyboard,this.findAndPopActivation(this.currentKeyboardSrcTarget()),l=this.prepareKeyboardForActivation(e,n),s=this.currentKeyboardSrcTarget(),[4,l.keyboard];case 1:return o=g.sent(),o==null&&l.metadata?[2,!1]:(this.currentKeyboardSrcTarget()==s&&this.emit("beforekeyboardchange",l.metadata),a=null,o&&(a={keyboard:o,metadata:l.metadata}),this.activateKeyboardForTarget(a,s),this.currentKeyboardSrcTarget()==s&&(!r||!!o)&&this.emit("keyboardchange",this.activeKeyboard),[2,!0])}})})},t.prototype.prepareKeyboardForActivation=function(e,n){var i=this,r;n||(n="");var l=null;if(e?l=this.keyboardCache.getStub(e,n):n=="",!l){if(e)throw new Error("No matching stub has been registered.");return{keyboard:Promise.resolve(null),metadata:null}}if(((r=this.activeKeyboard)===null||r===void 0?void 0:r.metadata)&&e==this.activeKeyboard.metadata.id){var s=this.activeKeyboard.keyboard;return{keyboard:Promise.resolve(s),metadata:l}}var o;if(o=this.keyboardCache.getKeyboardForStub(l))return{keyboard:Promise.resolve(o),metadata:l};this.emit("beforekeyboardchange",l);var a=this.engineConfig.deferForInitialization.then(function(){var d=new J;i.emit("keyboardasyncload",l,d.corePromise);var F=i.keyboardCache.fetchKeyboardForStub(l),u=new Promise(function(Q,y){var U="Sorry, the ".concat(l.name," keyboard for ").concat(l.langName," is not currently available.");window.setTimeout(function(){return y(new Error(U))},t.TIMEOUT_THRESHOLD)}),I=Promise.race([F,u]);return I.then(function(){d.resolve(null),u.catch(function(){})}),I.catch(function(Q){throw d.resolve(Q),Q}),I}),g=this.deferredKeyboardActivation(a,l,this.currentKeyboardSrcTarget());return{keyboard:g.then(function(d){return(0,B.__awaiter)(i,void 0,void 0,function(){return(0,B.__generator)(this,function(F){return d?[2,a]:[2,Promise.resolve(null)]})})}),metadata:l}},t.TIMEOUT_THRESHOLD=1e4,t}(f.default);var Il=function(c){(0,B.__extends)(t,c);function t(){return c!==null&&c.apply(this,arguments)||this}return t}(f.default),Zn=Il;function fn(c,t,e){var n=h.modifierCodes;if(t&&t.isMnemonic&&c.setMnemonicCode(!!(c.Lmodifiers&n.SHIFT),!!(c.Lmodifiers&n.CAPS)),t&&!t.isMnemonic){var i=de.languageMap[e];i&&i["k"+c.Lcode]&&(c.Lcode=i["k"+c.Lcode]),!t.definesPositionalOrMnemonic&&!(c.Lmodifiers&h.modifierBitmasks.NON_LEGACY)&&!c.isModifier&&(c=new ge({Lcode:de._USKeyCodeToCharCode(c),Lmodifiers:0,LisVirtualKey:!1,vkCode:c.Lcode,Lstates:c.Lstates,kName:"",device:c.device,isSynthetic:!1}))}return c}var Et="Keyboard_";function q(c){return c.startsWith(Et)?c:Et+c}function Ve(c){return c.startsWith(Et)?c.substring(Et.length):c}var Ql=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this)||this;return n.stubSetTable={},n.keyboardTable={},n.keyboardLoader=e,n}return t.prototype.getKeyboardForStub=function(e){return e?this.getKeyboard(e.KI):null},t.prototype.getKeyboard=function(e){if(!e)return null;var n=this.keyboardTable[q(e)];return n instanceof Promise?null:n},Object.defineProperty(t.prototype,"defaultStub",{get:function(){function e(i){var r=Object.keys(i);if(r.length!=0)return i[r[0]]}var n=e(this.stubSetTable);if(n)return e(n)},enumerable:!1,configurable:!0}),t.prototype.addKeyboard=function(e){var n=q(e.id);this.keyboardTable[n]=e,this.emit("keyboardadded",e)},t.prototype.fetchKeyboardForStub=function(e){return this.fetchKeyboard(e.KI)},t.prototype.isFetchingKeyboard=function(e){if(!e)throw new Error("Keyboard ID must be specified");e=q(e);var n=this.keyboardTable[e];return n instanceof Promise},t.prototype.fetchKeyboard=function(e){var n=this;if(!e)throw new Error("Keyboard ID must be specified");if(!this.keyboardLoader)throw new Error("Cannot load keyboards; this cache was configured without a loader");e=q(e);var i=this.keyboardTable[e];if(i instanceof j)return Promise.resolve(i);if(i instanceof Promise)return i;var r=this.getStub(e,null);if(!r)throw new Error("No stub for ".concat(Ve(e)," has been registered"));if(!r.filename)throw new Error("The registered stub for ".concat(Ve(e)," lacks a path to the main keyboard file"));var l=this.keyboardLoader.loadKeyboardFromStub(r);return this.keyboardTable[e]=l,l.then(function(s){s.scriptObject.KI=e,n.addKeyboard(s)}).catch(function(s){throw delete n.keyboardTable[e],s}),l},t.prototype.addStub=function(e){var n,i=q(e.KI),r=this.stubSetTable[i]=(n=this.stubSetTable[i])!==null&&n!==void 0?n:{};r[e.KLC]=e,this.emit("stubadded",e)},t.prototype.findMatchingStub=function(e){return this.getStub(e.KI,e.KLC)},t.prototype.getStub=function(e,n){var i,r,l=n||"---";e instanceof j?r=e.id:r=e,r&&(r=q(r));var s=(i=this.stubSetTable[r])!==null&&i!==void 0?i:{};if(l!="---")return s[l];var o=Object.keys(s);return o.length==0?null:s[o[0]]},t.prototype.forgetKeyboard=function(e,n){n===void 0&&(n=!1);var i=e instanceof j?e.id:q(e);this.stubSetTable[i]&&delete this.stubSetTable[i],n&&this.keyboardTable[i]&&delete this.keyboardTable[i]},t.prototype.getStubList=function(){for(var e=[],n=Object.keys(this.stubSetTable),i=0,r=n;i<r.length;i++)for(var l=r[i],s=this.stubSetTable[l],o=Object.keys(s),a=0,g=o;a<g.length;a++){var d=g[a];e.push(s[d])}return e},t}(f.default),vn=Ql;var Ln=["World","Africa","Asia","Europe","South America","North America","Oceania","Central America","Middle East"],Sn=["un","af","as","eu","sa","na","oc","ca","me"],Ul=RegExp("^(([\\.]/)|([\\.][\\.]/)|(/))|(:)");function Pi(c,t){return t=t||"",c&&!Ul.test(c)?t+c:c}var bl=function(c){(0,B.__extends)(t,c);function t(e,n,i){var r=this;if(typeof e!="string")if(e.id!==void 0){var l=e;l.id=q(l.id),r=c.call(this,l,i)||this,r.KF=Pi(l.filename,n),r.mapRegion(l.languages)}else{var s=e;return s.KI=q(s.KI),r=c.call(this,s,i)||this,r.KF=Pi(s.KF,n),r.KP=s.KP,r.KR=s.KR,r.KRC=s.KRC,r}else r=c.call(this,q(e),n)||this;return r}return t.prototype.mapRegion=function(e){var n=e.region,i=0;if(typeof n=="number")n<1||n>9?i=0:i=n-1;else if(typeof n=="string"){for(var r=n.length==2?Sn:Ln,l=0;l<r.length;l++)if(n.toLowerCase()==r[l].toLowerCase()){i=l;break}}this.KR=Ln[i],this.KRC=Sn[i]},Object.defineProperty(t.prototype,"region",{get:function(){return this.KR},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"regionCode",{get:function(){return this.KRC},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filename",{get:function(){return this.KF},enumerable:!1,configurable:!0}),t.toStubs=function(e,n,i){var r="";if(typeof e.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),e.languages||(e.languages=e.language),e?e.id?e.languages||(r="KeyboardStub has undefined languages"):r="KeyboardStub has undefined id":r="Stub undefined",r!="")return[{error:new Error(r)}];var l=[];Array.isArray(e.languages)?l=l.concat(e.languages):l.push(e.languages);var s=[];return l.forEach(function(o){var a=(0,B.__assign)((0,B.__assign)({},e),{languages:o,language:void 0}),g=new t(a,n,i);s.push(g)}),s},t.prototype.merge=function(e){this.KL||(this.KL=e.KL),this.KR||(this.KR=e.KR),this.KRC||(this.KRC=e.KRC),this.KN||(this.KN=e.KN),this.KF||(this.KF=e.KF),this.KFont||(this.KFont=e.KFont),this.KOskFont||(this.KOskFont=e.KOskFont),e._displayName&&(this._displayName||(this._displayName=e._displayName))},t.prototype.validateForCustomKeyboard=function(){return c.prototype.validateForCustomKeyboard.call(this)||!this.KF||!this.KR?new Error("To use a custom keyboard, you must specify file name, keyboard id, keyboard name, language, language code, and region."):null},t}(Oe),ce=bl;function Ft(c,t){if(t.length==0)return Promise.resolve(c);if(c.length==0)return Promise.reject(t);var e=c;return Promise.resolve(e.concat(t))}var Oi="The Cloud API request timed out.",Rn="Could not find a keyboard with that ID.",_i="The Cloud API failed to find an appropriate keyboard.",hl="Error occurred while registering keyboards: ",Cl=function(c){return c+" keyboard not found."},xl=function(c){(0,B.__extends)(t,c);function t(e,n){var i=c.call(this)||this;return i.cloudResolutionPromises=new Map,i.languageFetchStarted=!1,i.registerFromCloud=function(r){var l=Number.parseInt(r.timerid),s;try{s=i._registerCore(r)}catch(a){s=new Error(hl+a)}if(l){var o=i.cloudResolutionPromises.get(l);if(o)try{s instanceof Error?o.reject(s):o.resolve(s)}finally{i.cloudResolutionPromises.delete(l)}else{i.emit("unboundregister",s);return}}else{i.emit("unboundregister",s);return}},i.requestEngine=e,i.pathConfig=n,i._languageListPromise=new J,i}return Object.defineProperty(t.prototype,"languageListPromise",{get:function(){var e=this;return this.languageFetchStarted||(this.languageFetchStarted=!0,this.keymanCloudRequest("",!0).catch(function(n){e.languageFetchStarted=!1,e._languageListPromise.reject(n),e._languageListPromise=new J})),this._languageListPromise.corePromise},enumerable:!1,configurable:!0}),t.prototype.keymanCloudRequest=function(e,n){var i=this,r="https://api.keyman.com/cloud/4.0/"+(arguments.length>1&&n?"languages":"keyboards"),l="?jsonp=keyman.register&languageidtype=bcp47&version="+ee.CURRENT.toString(),s=r+l+e,o=this.requestEngine.request(s),a=o.promise,g=o.queryId;return this.cloudResolutionPromises.set(g,a),a.finally(function(){i.cloudResolutionPromises.delete(g)}),a.corePromise},t.prototype._registerCore=function(e){var n=e.options,i=n.fontBaseUri;if(this.pathConfig.fonts!=""?i=this.pathConfig.fonts:this.pathConfig.updateFontPath(i),typeof e.error=="string"){var r="";if(typeof e.options.keyboardid=="string"){var l=e.options.keyboardid;r=l.substring(0,1).toUpperCase()+l.substring(1)}return new Error(Cl(r))}if(typeof n=="undefined"||typeof n.context=="undefined")return new Error(Rn);var s=[];if(n.context=="keyboard"){var o=void 0,a=e.keyboard;if(Array.isArray(a))for(o=0;o<a.length;o++)s=s.concat(t.registerLanguagesForKeyboard(a[o],n,o));else s=s.concat(t.registerLanguagesForKeyboard(a,n,0))}else if(n.context=="language"){var g=e.languages;return this._languageListPromise.resolve(g),g}return s},t.registerLanguagesForKeyboard=function(e,n,i){var r="";if(typeof e=="undefined")return[];if(typeof n.keyboardid=="string"&&(r=n.keyboardid.split(",")[i]),Array.isArray(e))if(e.length==1||r.substr(-1,1)=="$"||r==""){for(var l=[],s=0;s<e.length;s++)l=l.concat(this.registerLanguagesForKeyboard(e[s],n,i));return l}else{for(var o=0,s=0;s<e.length;s++){var a=e[s].id.toLowerCase();if(a=="us"&&(a="english"),Array.isArray(e[s].languages)){for(var g=e[s].languages,d=0;d<g.length;d++)if(a==g[d].name.toLowerCase()){o=s;break}}}return this.registerLanguagesForKeyboard(e[o],n,i)}else{var F=n.fontBaseUri||"",u=ce.toStubs(e,n.keyboardBaseUri,F),I=r.split("@")[1];if(u.length==1&&typeof u[0].error!="undefined")throw u[0].error;return typeof I!="string"?u:(I=I.replace(/\$$/,""),[u.find(function(Q){return Q.KLC==I})])}},t.prototype.fetchCloudStubs=function(e){return(0,B.__awaiter)(this,void 0,void 0,function(){var n,i,r,l,s,o,a;return(0,B.__generator)(this,function(g){switch(g.label){case 0:if(e.length==0)return[2,Promise.resolve([])];for(n="&keyboardid=",i="",r=0;r<e.length;r++)n=n+i+e[r].toString(),i=",";l=[],g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.keymanCloudRequest(n,!1)];case 2:return s=g.sent(),[2,Ft(s,l)];case 3:return o=g.sent(),console.error(o),a={error:o},l.push(a),[2,Promise.reject(l)];case 4:return[2]}})})},t}(f.default),Jn=xl;var Gl=function(){function c(t,e){this.id=t,this.language=e}return c.prototype.toString=function(){var t=this.id;return this.language?(t=t+"@"+this.language,this.version&&(t=t+"@"+this.version)):this.version&&(t=t+"@@"+this.version),t},c}();function En(c,t){return{keyboard:{id:c.id,name:c.name},error:typeof t=="string"?new Error(t):t}}function ji(c,t,e){var n=new Gl(c,t);return e&&(n.version=e),n}function qi(c,t,e){if(c.getStub(e.id,e.language)==null){for(var n=0;n<t.length;n++)if(t[n].id==e.id&&t[n].language==e.language)return!1;return!0}else return!1}var pl=function(){function c(t,e,n){var i=this;this.pathConfig=n,this.cache=new vn(t),this.cloudQueryEngine=new Jn(e,this.pathConfig),this.cloudQueryEngine.on("unboundregister",function(r){Array.isArray(r)&&r.forEach(function(l){l instanceof ce&&i.cache.addStub(l)})})}return c.prototype.addKeyboardArray=function(t){for(var e=this,n=[],i=[],r=[],l=[],s=[],o=0,a=t;o<a.length;o++){var g=a[o];if(typeof g=="string")g.length>0&&l.push(g);else if(g.KI||g.KL||g.KLC||g.KFont||g.KOskFont)r.push(new ce(g));else{var d=g;if(typeof d.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),d.languages||(d.languages=d.language),typeof d.languages=="undefined"){var F="To use keyboard '"+d.id+"', you must specify languages.";s.push(En(d,F))}else if(Array.isArray(d.languages))for(var u=ce.toStubs(d,this.pathConfig.keyboards,this.pathConfig.fonts),I=0,Q=u;I<Q.length;I++){var y=Q[I];y instanceof ce?r.push(y):s.push(y)}else{var U=d;r.push(new ce(U,this.pathConfig.keyboards,this.pathConfig.fonts))}}}for(var b=0,C=r;b<C.length;b++){var y=C[b];if(y.KF){var x=y.validateForCustomKeyboard();x?s.push(En(y,x)):n.push(y)}else i.push(y)}for(var X=[],p=0,V=i;p<V.length;p++){var L=V[p];if(!L.KI&&!L.KLC){s.push(En(L,"Cannot fetch keyboard information without a keyboard ID or language code."));continue}var m=ji(Ve(L.id),L.langId);qi(this.cache,X,m)&&X.push(m)}for(var G=0,S=l;G<S.length;G++){var k=S[G],W=k.split("@"),Y=[""];W[0].toLowerCase()=="english"&&(W[0]="us"),W.length>1&&(Y=W[1].split(","));for(var R=0;R<Y.length;R++)if(!(R>0&&Y[R]=="")){var m=ji(W[0],Y[R],W[2]);qi(this.cache,X,m)&&X.push(m)}}n.forEach(function(A){return e.cache.addStub(A)});var E=this.cloudQueryEngine.fetchCloudStubs(X.map(function(A){return A.toString()}));return E.then(function(A){for(var H=0,oe=A;H<oe.length;H++){var ie=oe[H];ie instanceof ce?(e.cache.addStub(ie),n.push(ie)):s.push(ie)}return[].concat(s).concat(n)})},c.prototype.addLanguageKeyboards=function(t){return(0,B.__awaiter)(this,void 0,void 0,function(){var e,n,i,r,l,s,o,a,g,d,F,u=this;return(0,B.__generator)(this,function(I){switch(I.label){case 0:e=[],n=[],I.label=1;case 1:return I.trys.push([1,3,,4]),[4,this.cloudQueryEngine.languageListPromise];case 2:return n=I.sent(),[3,4];case 3:return i=I.sent(),console.error(i),e.push({error:i}),[2,e];case 4:for(r=n,l="",s=0;s<t.length;s++){for(o=t[s].toLowerCase(),a=o.substr(-1,1)=="$",a&&(o=o.substr(0,o.length-1)),g=!1,d=0;d<r.length;d++)if(o==r[d].name.toLowerCase()){l!=""&&(l=l+","),l=l+"@"+r[d].id,a&&(l=l+"$"),g=!0;break}g||(F={language:{name:o},error:new Error(this.alertLanguageUnavailable(o))},e.push(F))}return l==""?[2,Promise.reject(e)]:[2,this.cloudQueryEngine.keymanCloudRequest("&keyboardid="+l,!1).then(function(Q){return(0,B.__awaiter)(u,void 0,void 0,function(){var y,U,b,C;return(0,B.__generator)(this,function(x){switch(x.label){case 0:return[4,Ft(Q,e)];case 1:for(y=x.sent(),U=0,b=y;U<b.length;U++)C=b[U],typeof C.error=="undefined"&&this.cache.addStub(C);return[2,y]}})})},function(Q){console.error(Q);var y={error:Q};return e.push(y),Promise.reject(e)})]}})})},c.prototype.fetchCloudCatalog=function(){return(0,B.__awaiter)(this,void 0,void 0,function(){var t,e,n=this;return(0,B.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.cloudQueryEngine.keymanCloudRequest("",!1)];case 1:return t=i.sent(),t.forEach(function(r){return n.cache.addStub(r)}),[2,t];case 2:return e=i.sent(),[2,Promise.reject([{error:e}])];case 3:return[2]}})})},c.prototype.alertLanguageUnavailable=function(t){var e="No keyboards are available for "+t+". Does it have another language name?";return e},c}(),An=pl;var Vl=function(){function c(){this.registeredModels={},this.languageModelMap={}}return c.prototype.modelForLanguage=function(t){return this.languageModelMap[t]},c.prototype.register=function(t){if(t.id=t.id.toLowerCase(),JSON.stringify(t)!=JSON.stringify(this.registeredModels[t.id])){this.registeredModels[t.id]=t;var e=this;t.languages.forEach(function(n){if(!n){console.warn("Null / undefined language codes are not permitted for registration.");return}e.languageModelMap[n]=t})}},c.prototype.unregister=function(t){var e;if(t=t.toLowerCase(),this.registeredModels[t])e=this.registeredModels[t],delete this.registeredModels[t];else return null;var n=this;return e.languages.forEach(function(i){n.languageModelMap[i].id==t&&delete n.languageModelMap[i]}),e},c.prototype.isRegistered=function(t){return!!this.registeredModels[t.id.toLowerCase()]},c}(),Wn=Vl;function At(c){for(var t=[],e=0;e<c.length;e++)t.push(c[e]);return t}function N(c){var t=document.createElement(c);return t.style.userSelect="none",t.style.webkitUserSelect="none",t}var ye=function(){function c(t,e){if(this.fontStyleDefinitions={},this.linkedSheets=[],this.fontPromises=[],!t){var n=document.getElementsByTagName("HEAD");n.length>0?t=n[0]:t=document.body}this.linkNode=t,this.doCacheBusting=e||!1}return Object.defineProperty(c.prototype,"sheets",{get:function(){return this.linkedSheets.map(function(t){return t.sheet})},enumerable:!1,configurable:!0}),c.prototype.linkStylesheet=function(t){if(!(!(t instanceof HTMLLinkElement)&&!t.innerHTML)){var e=new J;t instanceof HTMLLinkElement?t.onload=function(){return e.resolve()}:e.resolve(),this.linkedSheets.push({sheet:t,load:e}),this.linkNode.appendChild(t)}},c.prototype.allLoadedPromise=function(){return(0,B.__awaiter)(this,void 0,void 0,function(){var t;return(0,B.__generator)(this,function(e){switch(e.label){case 0:return t=this.linkedSheets.map(function(n){return n.load.corePromise}),Promise.allSettled?[4,Promise.allSettled(t)]:[3,2];case 1:return e.sent(),[3,4];case 2:return[4,Promise.all(t)];case 3:e.sent(),e.label=4;case 4:return[2]}})})},c.prototype.addStyleSheetForFont=function(t,e,n){var i=this;if(!t||typeof t.files=="undefined")return null;var r=t.family,l,s,o="",a="",g=[],d="";n||(n=v.OperatingSystem.Other);var F=this.fontStyleDefinitions[n]=this.fontStyleDefinitions[n]||{};if(F[r]){var u=F[r];return u.parentNode||this.linkStylesheet(u),null}for(typeof t.files=="string"?g[0]=t.files:g=t.files,s=0;s<g.length;s++)g[s].toLowerCase().indexOf("data:font")==0&&(d=g[s]),g[s].toLowerCase().indexOf(".otf")>0&&(o=g[s]),g[s].toLowerCase().indexOf(".ttf")>0&&(o=g[s]),g[s].toLowerCase().indexOf(".woff")>0&&(a=g[s]);o!=""&&o.indexOf("/")<0&&(o=e+o),a!=""&&a.indexOf("/")<0&&(a=e+a);var I="@font-face {\nfont-family:"+t.family+";\nfont-style:normal;\nfont-weight:normal;\n";if(d){var Q=10,y=d.substring(Q,d.indexOf(";",Q));I+="src:url('".concat(d,"'), format('").concat(y,"');")}else n==v.OperatingSystem.iOS?o!=""&&(this.doCacheBusting&&(o=this.cacheBust(o)),l="url('"+encodeURI(o)+"') format('truetype')"):(a!=""&&(l="url('"+encodeURI(a)+"') format('woff')"),o!=""&&(l="url('"+encodeURI(o)+"') format('truetype')"));if(!l)return null;I+="src:"+l+";",I=I+"\n}\n";var U=Je(I);F[r]=U;var b=new FontFace(t.family,l),C=b.load(),x=function(){i.fontPromises=i.fontPromises.filter(function(X){return X!=C})};return this.fontPromises.push(C.then(x).catch(x)),this.linkStylesheet(U),U},c.prototype.cacheBust=function(t){return t+"?v="+new Date().getTime()},c.prototype.linkExternalSheet=function(t,e){try{if(!e&&document.querySelector("link[href="+JSON.stringify(t)+"]")!=null)return null}catch(i){return null}var n=document.createElement("link");return n.type="text/css",n.rel="stylesheet",n.href=t,this.linkStylesheet(n),n},c.prototype.unlink=function(t){var e=this.linkedSheets.findIndex(function(i){return i.sheet==t});if(e>-1){var n=this.linkedSheets.splice(e,1);return n[0].load.resolve(),t.parentNode.removeChild(t),!0}return!1},c.prototype.unlinkAll=function(){for(var t=0,e=this.linkedSheets;t<e.length;t++){var n=e[t],i=n.sheet;i.parentNode&&i.parentNode.removeChild(i),n.load.resolve()}this.linkedSheets.splice(0,this.linkedSheets.length)},c}();function Je(c){var t=document.createElement("style");return t.type="text/css",t.appendChild(document.createTextNode(c)),t}function re(){var c;return typeof window.orientation!="undefined"?c=window.orientation:typeof window.screen.orientation!="undefined"&&(c=window.screen.orientation.angle),c!==void 0?Math.abs(c/90)==1:!1}var ml=function(){function c(t){this.name=t}return c.prototype.load=function(t){return this.loadCookie(this.name,t||function(e){return e})},c.prototype.save=function(t,e){this.saveCookie(this.name,t,e||function(n){return n})},c.prototype._loadRawCookies=function(){var t={};if(typeof document.cookie!="undefined"&&document.cookie!="")for(var e=document.cookie.split(/;\s*/),n=0;n<e.length;n++){var i=e[n].split("=");i.length==2&&(t[i[0]]=i[1])}return t},c.prototype.loadCookie=function(t,e){var n={},i=this._loadRawCookies(),r=i[t];if(r)for(var l=decodeURIComponent(r).split(";"),s=0;s<l.length&&!(s==l.length-1&&!l[s]);s++){var o=l[s].split("=");if(o.length>1){var a=o[0],g=o[1];n[a]=e(g,a)}else n[o[0]]=""}return n},c.prototype.saveCookie=function(t,e,n){var i="";for(var r in e)i+=r+"="+n(e[r],r)+";";var l=new Date(new Date().valueOf()+1e3*60*60*24*30).toUTCString(),s=" path=/; expires="+l;document.cookie="".concat(t,"=").concat(encodeURIComponent(i),"; ").concat(s)},c}(),Ie=ml;function z(c){var t;if(!c)return 0;var e=c.offsetLeft?c.offsetLeft:0;if(t=c,t.offsetParent){for(;t.offsetParent;)t=t.offsetParent,e+=t.offsetLeft;var n=t.ownerDocument;t.style.position=="fixed"&&n&&n.scrollingElement&&(e+=n.scrollingElement.scrollLeft)}if(t&&t.ownerDocument&&c.ownerDocument!=window.document){var i=t.ownerDocument;if(i&&i.defaultView&&i.defaultView.frameElement)return e+z(i.defaultView.frameElement)-i.documentElement.scrollLeft}return e}function K(c){var t;if(!c)return 0;var e=c.offsetTop?c.offsetTop:0;if(t=c,t.ownerDocument&&t instanceof t.ownerDocument.defaultView.HTMLElement){for(;t.offsetParent;)t=t.offsetParent,e+=t.offsetTop;var n=t.ownerDocument;t.style.position=="fixed"&&n&&n.scrollingElement&&(e+=n.scrollingElement.scrollTop)}if(t&&t.ownerDocument&&c.ownerDocument!=window.document){var i=t.ownerDocument;if(i&&i.defaultView&&i.defaultView.frameElement)return e+K(i.defaultView.frameElement)}return e}var $i=function(c){(0,B.__extends)(t,c);function t(e,n){return c.call(this,"KeymanWeb_".concat(e,"_Option_").concat(n))||this}return t.prototype.load=function(){return c.prototype.load.call(this,decodeURIComponent)},t.prototype.save=function(e){c.prototype.save.call(this,e,encodeURIComponent)},t}(Ie),Hn=function(){function c(){}return c.prototype.loadStore=function(t,e){var n=new $i(t,e);return n.load()},c.prototype.saveStore=function(t,e,n){var i=new $i(t,e);i.save(n)},c}();var ec=function(c){(0,B.__extends)(t,c);function t(e,n,i){var r=c.call(this,e,n,new Hn)||this;return r.insertText=function(l,s){r.resetContextCache(),r.engine.contextManager.insertText(r,l,s)},r.KT=r.insertText,r.engine=n,r.stubNamespacer=i,r}return t.prototype.preserveID=function(e){var n;if(document.currentScript)n=document.currentScript.id;else{var i=document.getElementsByTagName("script"),r=i[i.length-1];n=r.id}if(n)n.indexOf(Ve(e.KI))!=-1?e.KI=n:console.error("Error when registering keyboard:  current SCRIPT tag's ID does not match!");else return},t.prototype.registerKeyboard=function(e){var n=this;c.prototype.registerKeyboard.call(this,e);var i=this.loadedKeyboard;this.preserveID(e),this.engine.config.deferForInitialization.then(function(){n.engine.keyboardRequisitioner.cache.isFetchingKeyboard(i.id)||(n.engine.keyboardRequisitioner.cache.addKeyboard(i),n.loadedKeyboard=null)})},t.prototype.registerStub=function(e){var n=this,i;this.stubNamespacer&&this.stubNamespacer(e);var r=function(){var s=n.engine.config.paths;return new ce(e,s.keyboards,s.fonts)};if(!this.engine.config.deferForInitialization.isResolved)this.engine.config.deferForInitialization.then(function(){return n.engine.keyboardRequisitioner.cache.addStub(r())});else{var l=r();if(!((i=this.engine.keyboardRequisitioner)===null||i===void 0)&&i.cache.findMatchingStub(l))return 1;this.engine.keyboardRequisitioner.cache.addStub(l)}return null},t}(Bt),Nn=ec;(function(){ec.__publishShorthandAPI()})();var tc=function(c){(0,B.__extends)(t,c);function t(e,n){var i=this;return e&&e._jsGlobal!=window&&(e._jsGlobal.String=window.String),e?i=c.call(this,e)||this:i=c.call(this,new gt(window,at))||this,i.performCacheBusting=n||!1,i}return t.prototype.loadKeyboardInternal=function(e,n,i){var r=this,l=new J;this.performCacheBusting&&(e=this.cacheBust(e));try{var s=this.harness._jsGlobal.document,o=s.createElement("script");i&&(o.id=i),s.head.appendChild(o),o.onerror=function(a){l.reject(n.missingError(a))},o.onload=function(){if(r.harness.loadedKeyboard){var a=r.harness.loadedKeyboard;r.harness.loadedKeyboard=null,l.resolve(a)}else l.reject(n.scriptError())},l.then(function(){o.remove()}).catch(function(){o.remove()}),o.src=e}catch(a){return Promise.reject(a)}return l.corePromise},t.prototype.cacheBust=function(e){return e+"?v="+new Date().getTime()},t}(In);function Wt(c,t){var e=new Map;return t.keys.forEach(function(n){var i=Math.abs(c.x-n.centerX),r=Math.abs(c.y-n.centerY),l,s;i>.5*n.width?(l=i-.5*n.width,i=.5):(l=0,i/=n.width),r>.5*n.height?(s=r-.5*n.height,r=.5):(s=0,r/=n.height),l*=t.kbdScaleRatio,l+=i*n.height,s+=r*n.height;var o=l*l+s*s;e.set(n.keySpec,o)}),e}function Ee(c){var t,e,n,i,r,l,s,o=new Map,a=0;Array.isArray(c)||(c=[c]);try{for(var g=(0,B.__values)(c),d=g.next();!d.done;d=g.next()){var F=d.value;try{for(var u=(n=void 0,(0,B.__values)(F.keys())),I=u.next();!I.done;I=u.next()){var Q=I.value,y=1/(Math.pow(F.get(Q),2)+1e-6);a+=y,o.set(Q,(s=o.get(Q))!==null&&s!==void 0?s:0+y)}}catch(x){n={error:x}}finally{try{I&&!I.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}}catch(x){t={error:x}}finally{try{d&&!d.done&&(e=g.return)&&e.call(g)}finally{if(t)throw t.error}}var U=[];try{for(var b=(0,B.__values)(o.keys()),C=b.next();!C.done;C=b.next()){var Q=C.value;U.push({keySpec:Q,p:o.get(Q)/a})}}catch(x){r={error:x}}finally{try{C&&!C.done&&(l=b.return)&&l.call(b)}finally{if(r)throw r.error}}return U.sort(function(x,X){return X.p-x.p})}var Xl=function(){function c(t,e,n){this.keySpec=n,this.centerX=n.proportionalX,this.centerY=e.proportionalY,this.width=n.proportionalWidth,this.height=t.rowProportionalHeight}return c}();function Zl(c){return c.baseKeyID?h.isFrameKey(c.baseKeyID)?!1:!c.isPadding:!1}function nc(c,t){return{keys:c.row.map(function(e){return e.key.map(function(n){return new Xl(c,e,n)})}).reduce(function(e,n){return e.concat(n)},[]).filter(function(e){return Zl(e.keySpec)}),kbdScaleRatio:t}}var fl=function(){function c(t,e,n){this.left=t.getTextBeforeCaret(),this.startOfBuffer=this.left._kmwLength()<=e.leftContextCodePoints,this.startOfBuffer||(this.left=this.left._kmwSubstr(-e.leftContextCodePoints)),this.right=t.getTextAfterCaret(),this.endOfBuffer=this.right._kmwLength()<=e.rightContextCodePoints,this.endOfBuffer||(this.right=this.right._kmwSubstr(0,e.rightContextCodePoints)),this.casingForm=n=="shift"?"initial":n=="caps"?"upper":null}return c.prototype.toMock=function(){var t=this.left._kmwLength();return new T(this.left+(this.right||""),t)},c.ENGINE_RULE_WINDOW={leftContextCodePoints:64,rightContextCodePoints:32},c}(),me=fl;var vl=function(){function c(){this._promises=new Map}return Object.defineProperty(c.prototype,"length",{get:function(){return this._promises.size},enumerable:!1,configurable:!0}),c.prototype.make=function(t,e,n){if(this._promises.has(t))return n("Existing request with token ".concat(t));this._promises.set(t,{reject:n,resolve:e})},c.prototype.keep=function(t,e){var n=this._promises.get(t);if(!n)throw new Error("No promise associated with token: ".concat(t));var i=n.resolve;return this._promises.delete(t),i(e)},c.prototype.break=function(t,e){var n=this._promises.get(t);if(!n)throw new Error("No promise associated with token: ".concat(t));this._promises.delete(t),n.reject(e)},c}(),ut=vl;var Ll=function(){function c(t,e,n){this._worker=e,this._worker.onmessage=this.onMessage.bind(this),this._declareLMLayerReady=null,this._predictPromises=new ut,this._wordbreakPromises=new ut,this._acceptPromises=new ut,this._revertPromises=new ut,this._nextToken=Number.MIN_SAFE_INTEGER,this.sendConfig(t,!!n)}return c.prototype.sendConfig=function(t,e){this._worker.postMessage({message:"config",capabilities:t,testMode:e})},c.prototype.loadModel=function(t,e){var n=this;return e===void 0&&(e="file"),new Promise(function(i,r){n._declareLMLayerReady=i;var l={type:e};e=="file"?l.file=t:l.code=t,n._worker.postMessage({message:"load",source:l})})},c.prototype.unloadModel=function(){this._worker.postMessage({message:"unload"})},c.prototype.predict=function(t,e){var n=this,i=this._nextToken++;return new Promise(function(r,l){n._predictPromises.make(i,r,l),n._worker.postMessage({message:"predict",token:i,transform:t,context:e})})},c.prototype.wordbreak=function(t){var e=this,n=this._nextToken++;return new Promise(function(i,r){e._wordbreakPromises.make(n,i,r),e._worker.postMessage({message:"wordbreak",token:n,context:t})})},c.prototype.acceptSuggestion=function(t,e,n){var i=this,r=this._nextToken++;return new Promise(function(l,s){i._acceptPromises.make(r,l,s),i._worker.postMessage({message:"accept",token:r,suggestion:t,context:e,postTransform:n})})},c.prototype.revertSuggestion=function(t,e){var n=this,i=this._nextToken++;return new Promise(function(r,l){n._revertPromises.make(i,r,l),n._worker.postMessage({message:"revert",token:i,reversion:t,context:e})})},c.prototype.resetContext=function(t){this._worker.postMessage({message:"reset-context",context:t})},c.prototype.onMessage=function(t){var e=t.data;if(e.message==="error")console.error(e.log),e.error&&console.error(e.error);else if(e.message==="ready")this._declareLMLayerReady(t.data.configuration);else if(e.message==="suggestions")this._predictPromises.keep(e.token,e.suggestions);else if(e.message==="currentword")this._wordbreakPromises.keep(e.token,e.word);else if(e.message==="postaccept")this._acceptPromises.keep(e.token,e.reversion);else if(e.message==="postrevert")this._revertPromises.keep(e.token,e.suggestions);else throw new Error("Message not implemented: ".concat(e.message))},c.prototype.shutdown=function(){this._worker.terminate()},c}(),kn=Ll;function Ht(c){return c}var ic='"use strict";/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){"use strict";var N=function(){try{var M={},q=Object.defineProperty,O=q(M,M,M)&&q}catch(L){}return O}(),x=function(M){if(this==null)throw TypeError();var q=String(this),O=q.length,L=M?Number(M):0;if(L!=L&&(L=0),!(L<0||L>=O)){var D=q.charCodeAt(L),R;return D>=55296&&D<=56319&&O>L+1&&(R=q.charCodeAt(L+1),R>=56320&&R<=57343)?(D-55296)*1024+R-56320+65536:D}};N?N(String.prototype,"codePointAt",{value:x,configurable:!0,writable:!0}):String.prototype.codePointAt=x}(),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(N){if(this==null)throw new TypeError("this is null or not defined");for(var x=Object(this),M=x.length>>>0,q=arguments[1],O=q>>0,L=O<0?Math.max(M+O,0):Math.min(O,M),D=arguments[2],R=D===void 0?M:D>>0,re=R<0?Math.max(M+R,0):Math.min(R,M);L<re;)x[L]=N,L++;return x}});/**\n* Array.prototype.findIndex() polyfill\n* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex\n* @license MIT\n*/Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(N){if(this==null)throw new TypeError(\'"this" is null or not defined\');var x=Object(this),M=x.length>>>0;if(typeof N!="function")throw new TypeError("predicate must be a function");for(var q=arguments[1],O=0;O<M;){var L=x[O];if(N.call(q,L,O,x))return O;O++}return-1},configurable:!0,writable:!0}),Array.prototype.includes||(Array.prototype.includes=function(N){return!!~this.indexOf(N)}),Object.keys||(Object.keys=function(){"use strict";var N=Object.prototype.hasOwnProperty,x=!{toString:null}.propertyIsEnumerable("toString"),M=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],q=M.length;return function(O){if(typeof O!="function"&&(typeof O!="object"||O===null))throw new TypeError("Object.keys called on non-object");var L=[],D,R;for(D in O)N.call(O,D)&&L.push(D);if(x)for(R=0;R<q;R++)N.call(O,M[R])&&L.push(M[R]);return L}}());var reduce=Function.bind.call(Function.call,Array.prototype.reduce),isEnumerable=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),concat=Function.bind.call(Function.call,Array.prototype.concat),keys=Object.keys;Object.values||(Object.values=function(x){return reduce(keys(x),function(M,q){return concat(M,typeof q=="string"&&isEnumerable(x,q)?[x[q]]:[])},[])}),Object.entries||(Object.entries=function(x){return reduce(keys(x),function(M,q){return concat(M,typeof q=="string"&&isEnumerable(x,q)?[[q,x[q]]]:[])},[])}),self.Symbol||function(N,x){"use strict";typeof module=="object"&&typeof module.exports=="object"?module.exports=x(N):x(N)}(typeof window!="undefined"?window:self||global,function(N){"use strict";var x=Object.defineProperty,M=Object.defineProperties,q=0,O=[],L=Array.prototype.slice,D=typeof N.ES6=="object"?N.ES6:N.ES6={},R=Array.isArray,re=Object.prototype.toString,Oe=Array.prototype.push,we=function(){},Se=function(d){return d},T=function(d){return typeof d=="function"},ge=function(){},V=function(d,y){this._array=d,this._flag=y,this._nextIndex=0},z=function(d,y){this._string=d,this._flag=y,this._nextIndex=0},H=function(d){return d!==null&&(typeof d=="object"||typeof d=="function")},Y=function(d,y){return M(d,{_description:{value:y},_isSymbol:{value:!0},_id:{value:q++}}),d},ce=function(d,y){if(typeof d.length=="number"&&d.length>=0&&typeof y.length=="number"&&y.length>=0){var I=Math.floor(d.length),b=Math.floor(y.length),j=0;for(d.length=I+b;j<b;++j)y.hasOwnProperty(j)&&(d[I+j]=y[j])}},ne=function(d,y){if(typeof d!="function"||typeof y!="function")throw new TypeError("Child and Parent must be function type");d.prototype=Object.create(y.prototype),d.prototype.constructor=d},E=function d(y){if(y=y===void 0?"":String(y),this instanceof d)throw new TypeError("Symbol is not a constructor");return Y(Object.create(d.prototype),y)};M(E,{for:{value:function(d){d=String(d);for(var y,I=O.length,b=0;b<I;++b)if((y=O[b]).key===d)return y.symbol;return y={key:d,symbol:E(d)},O.push(y),y.symbol},writable:!0,configurable:!0},keyFor:{value:function(d){if(!D.isSymbol(d))throw new TypeError(String(d)+" is not a symbol");for(var y,I=O.length,b=0;b<I;++b)if((y=O[b]).symbol===d)return y.key},writable:!0,configurable:!0},hasInstance:{value:E("Symbol.hasInstance")},isConcatSpreadable:{value:E("Symbol.isConcatSpreadable")},iterator:{value:E("Symbol.iterator")},toStringTag:{value:E("Symbol.toStringTag")}}),E.prototype.toString=function(){return"@@_____"+this._id+"_____"},E.prototype.valueOf=function(){return this},x(ge.prototype,E.iterator.toString(),{value:function(){return this},writable:!0,configurable:!0}),ne(V,ge),ne(z,ge),x(V.prototype,E.toStringTag.toString(),{value:"Array Iterator",configurable:!0}),x(z.prototype,E.toStringTag.toString(),{value:"String Iterator",configurable:!0}),V.prototype.next=function(){if(!(this instanceof V))throw new TypeError("Method Array Iterator.prototype.next called on incompatible receiver "+String(this));var d;return this._nextIndex===-1?{done:!0,value:void 0}:typeof this._array.length=="number"&&this._array.length>=0&&this._nextIndex<Math.floor(this._array.length)?(this._flag===1?d=[this._nextIndex,this._array[this._nextIndex]]:this._flag===2?d=this._array[this._nextIndex]:this._flag===3&&(d=this._nextIndex),this._nextIndex++,{done:!1,value:d}):(this._nextIndex=-1,{done:!0,value:void 0})},z.prototype.next=function(){if(!(this instanceof z))throw new TypeError("Method String Iterator.prototype.next called on incompatible receiver "+String(this));var d,y=new String(this._string);return this._nextIndex===-1?{done:!0,value:void 0}:this._nextIndex<y.length?(d=y[this._nextIndex],this._nextIndex++,{done:!1,value:d}):(this._nextIndex=-1,{done:!0,value:void 0})};var Z=function(d,y){this._target=d,this._values=[],this._thisArg=y};return Z.prototype.spread=function(){var d=this;return L.call(arguments).forEach(function(y){D.forOf(y,function(I){d._values.push(I)})}),d},Z.prototype.add=function(){var d=this;return L.call(arguments).forEach(function(y){d._values.push(y)}),d},Z.prototype.call=function(d){if(typeof this._target!="function")throw new TypeError("Target is not a function");return d=arguments.length<=0?this._thisArg:d,this._target.apply(d,this._values)},Z.prototype.new=function(){if(typeof this._target!="function")throw new TypeError("Target is not a constructor");var d,y;return d=Object.create(this._target.prototype),y=this._target.apply(d,this._values),H(y)?y:d},Z.prototype.array=function(){if(!R(this._target))throw new TypeError("Target is not a array");return Oe.apply(this._target,this._values),this._target},M(D,{isSymbol:{value:function(d){return d instanceof E&&function(y){return y._isSymbol===!0&&typeof y._id=="number"&&typeof y._description=="string"}(d)},writable:!0,configurable:!0},instanceOf:{value:function(d,y){if(!H(y))throw new TypeError("Right-hand side of \'instanceof\' is not an object");var I=y[E.hasInstance];if(I===void 0)return d instanceof y;if(typeof I!="function")throw new TypeError(typeof I+" is not a function");return I.call(y,d)},writable:!0,configurable:!0},forOf:{value:function(d,y,I){if(y=typeof y!="function"?we:y,typeof d[E.iterator]!="function")throw new TypeError("Iterable[Symbol.iterator] is not a function");var b,j=d[E.iterator]();if(typeof j.next!="function")throw new TypeError(".iterator.next is not a function");for(;;){if(b=j.next(),!H(b))throw new TypeError("Iterator result "+b+" is not an object");if(b.done)break;y.call(I,b.value)}},writable:!0,configurable:!0},spreadOperator:{value:function(d,y){if(typeof d!="function"&&!R(d))throw new TypeError("Spread operator only supports on array and function objects at this moment");return new Z(d,y)},writable:!0,configurable:!0}}),x(N,"Symbol",{value:E,writable:!0,configurable:!0}),x(Function.prototype,E.hasInstance.toString(),{value:function(d){return typeof this=="function"&&d instanceof this}}),x(Array.prototype,"concat",{value:function(){if(this===void 0||this===null)throw new TypeError("Array.prototype.concat called on null or undefined");var d=Object(this),y=L.call(arguments),I=[];return y.unshift(d),y.forEach(function(b){H(b)?b[E.isConcatSpreadable]!==void 0?b[E.isConcatSpreadable]?ce(I,b):I.push(b):R(b)?ce(I,b):I.push(b):I.push(b)}),I},writable:!0,configurable:!0}),x(Object.prototype,"toString",{value:function(){return this===void 0||this===null?re.call(this):typeof this[E.toStringTag]=="string"?"[object "+this[E.toStringTag]+"]":re.call(this)},writable:!0,configurable:!0}),x(Array.prototype,E.iterator.toString(),{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var d=Object(this);return new V(d,2)},writable:!0,configurable:!0}),x(Array,"from",{value:function(d,y,I){var b,j,U,J=0;if(b=T(this)?this:Array,d==null)throw new TypeError("Cannot convert undefined or null to object");if(d=Object(d),y===void 0)y=Se;else if(!T(y))throw new TypeError(y+" is not a function");if(d[E.iterator]===void 0){if(!(typeof d.length=="number"&&d.length>=0))return(U=new b(0)).length=0,U;for(j=Math.floor(d.length),(U=new b(j)).length=j;J<j;++J)U[J]=y.call(I,d[J])}else(U=new b).length=0,D.forOf(d,function(ye){U.length++,U[U.length-1]=y.call(I,ye)});return U},writable:!0,configurable:!0}),x(Array.prototype,"entries",{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var d=Object(this);return new V(d,1)},writable:!0,configurable:!0}),x(Array.prototype,"keys",{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var d=Object(this);return new V(d,3)},writable:!0,configurable:!0}),x(String.prototype,E.iterator.toString(),{value:function(){if(this===void 0||this===null)throw new TypeError("String.prototype[Symbol.iterator] called on null or undefined");return new z(String(this),0)},writable:!0,configurable:!0}),D}),function(){var N=Object.create,x=Object.defineProperty,M=Object.getOwnPropertyDescriptor,q=Object.getOwnPropertyNames,O=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,D=function(r,e){return function(){return e||(0,r[q(r)[0]])((e={exports:{}}).exports,e),e.exports}},R=function(r,e){for(var t in e)x(r,t,{get:e[t],enumerable:!0})},re=function(r,e,t,n){if(e&&typeof e=="object"||typeof e=="function")for(var i=q(e),o=0,u=i.length,a;o<u;o++)a=i[o],!L.call(r,a)&&a!==t&&x(r,a,{get:function(s){return e[s]}.bind(null,a),enumerable:!(n=M(e,a))||n.enumerable});return r},Oe=function(r,e,t){return re(r,e,"default"),t&&re(t,e,"default")},we=function(r,e,t){return t=r!=null?N(O(r)):{},re(e||!r||!r.__esModule?x(t,"default",{value:r,enumerable:!0}):t,r)},Se=D({"../../../node_modules/tslib/tslib.js":function(r,e){var t,n,i,o,u,a,s;(function(c){var f=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(h){c(l(f,l(h)))}):typeof e=="object"&&typeof e.exports=="object"?c(l(f,l(e.exports))):c(l(f));function l(h,p){return h!==f&&(typeof Object.create=="function"?Object.defineProperty(h,"__esModule",{value:!0}):h.__esModule=!0),function(w,m){return h[w]=p?p(w,m):m}}})(function(c){var f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(l[p]=h[p])};t=function(l,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");f(l,h);function p(){this.constructor=l}l.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)},n=Object.assign||function(l){for(var h,p=1,w=arguments.length;p<w;p++){h=arguments[p];for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&(l[m]=h[m])}return l},i=function(l,h,p,w){function m(g){return g instanceof p?g:new p(function(C){C(g)})}return new(p||(p=Promise))(function(g,C){function _(S){try{v(w.next(S))}catch(P){C(P)}}function k(S){try{v(w.throw(S))}catch(P){C(P)}}function v(S){S.done?g(S.value):m(S.value).then(_,k)}v((w=w.apply(l,h||[])).next())})},o=function(l,h){var p={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},w,m,g,C;return C={next:_(0),throw:_(1),return:_(2)},typeof Symbol=="function"&&(C[Symbol.iterator]=function(){return this}),C;function _(v){return function(S){return k([v,S])}}function k(v){if(w)throw new TypeError("Generator is already executing.");for(;C&&(C=0,v[0]&&(p=0)),p;)try{if(w=1,m&&(g=v[0]&2?m.return:v[0]?m.throw||((g=m.return)&&g.call(m),0):m.next)&&!(g=g.call(m,v[1])).done)return g;switch(m=0,g&&(v=[v[0]&2,g.value]),v[0]){case 0:case 1:g=v;break;case 4:return p.label++,{value:v[1],done:!1};case 5:p.label++,m=v[1],v=[0];continue;case 7:v=p.ops.pop(),p.trys.pop();continue;default:if(g=p.trys,!(g=g.length>0&&g[g.length-1])&&(v[0]===6||v[0]===2)){p=0;continue}if(v[0]===3&&(!g||v[1]>g[0]&&v[1]<g[3])){p.label=v[1];break}if(v[0]===6&&p.label<g[1]){p.label=g[1],g=v;break}if(g&&p.label<g[2]){p.label=g[2],p.ops.push(v);break}g[2]&&p.ops.pop(),p.trys.pop();continue}v=h.call(l,p)}catch(S){v=[6,S],m=0}finally{w=g=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}},u=function(l){var h=typeof Symbol=="function"&&Symbol.iterator,p=h&&l[h],w=0;if(p)return p.call(l);if(l&&typeof l.length=="number")return{next:function(){return l&&w>=l.length&&(l=void 0),{value:l&&l[w++],done:!l}}};throw new TypeError(h?"Object is not iterable.":"Symbol.iterator is not defined.")},a=function(l,h){var p=typeof Symbol=="function"&&l[Symbol.iterator];if(!p)return l;var w=p.call(l),m,g=[],C;try{for(;(h===void 0||h-- >0)&&!(m=w.next()).done;)g.push(m.value)}catch(_){C={error:_}}finally{try{m&&!m.done&&(p=w.return)&&p.call(w)}finally{if(C)throw C.error}}return g},s=function(l){return this instanceof s?(this.v=l,this):new s(l)},c("__extends",t),c("__assign",n),c("__awaiter",i),c("__generator",o),c("__values",u),c("__read",a),c("__await",s)})}}),T={};R(T,{tslib:function(){return ge}}),Oe(T,we(Se(),1));var ge=we(Se(),1);function V(){String.kmwFromCharCode=function(r){var e=[],t;for(t=0;t<arguments.length;t++){var n=Number(arguments[t]);if(!isFinite(n)||n<0||n>1114111||Math.floor(n)!==n)throw new RangeError("Invalid code point "+n);n<65536?e.push(n):(n-=65536,e.push((n>>10)+55296),e.push(n%1024+56320))}return String.fromCharCode.apply(void 0,e)},String.prototype.kmwCharCodeAt=function(r){var e=String(this),t=0;if(r<0||r>=e.length)return NaN;for(var n=0;n<r;n++)if(t=e.kmwNextChar(t),t===null)return NaN;var i=e.charCodeAt(t);if(i>=55296&&i<=56319&&e.length>t+1){var o=e.charCodeAt(t+1);if(o>=56320&&o<=57343)return(i-55296<<10)+(o-56320)+65536}return i},String.prototype.kmwIndexOf=function(r,e){var t=String(this),n=t.indexOf(r,e);if(n<0)return n;for(var i=0,o=0;o!==null&&o<n;o=t.kmwNextChar(o))i++;return i},String.prototype.kmwLastIndexOf=function(r,e){var t=String(this),n=t.lastIndexOf(r,e);if(n<0)return n;for(var i=0,o=0;o!==null&&o<n;o=t.kmwNextChar(o))i++;return i},String.prototype.kmwLength=function(){var r=String(this);if(r.length==0)return 0;for(var e=0,t=0;t!==null;e++)t=r.kmwNextChar(t);return e},String.prototype.kmwSlice=function(r,e){var t=String(this),n=t.kmwCodePointToCodeUnit(r),i=t.kmwCodePointToCodeUnit(e);return n===null||i===null?"":t.slice(n,i)},String.prototype.kmwSubstr=function(r,e){var t=String(this);r<0&&(r=t.kmwLength()+r),r<0&&(r=0);var n=t.kmwCodePointToCodeUnit(r),i=n;if(n===null)return"";if(arguments.length<2)i=t.length;else for(var o=0;o<e;o++)i=t.kmwNextChar(i);return i===null?t.substring(n):t.substring(n,i)},String.prototype.kmwSubstring=function(r,e){var t=String(this),n,i;if(typeof e=="undefined")n=t.kmwCodePointToCodeUnit(r),i=t.length;else{if(r>e){var o=r;r=e,e=o}n=t.kmwCodePointToCodeUnit(r),i=t.kmwCodePointToCodeUnit(e)}return(isNaN(n)||n===null)&&(n=0),(isNaN(i)||i===null)&&(i=t.length),t.substring(n,i)},String.prototype.kmwNextChar=function(r){var e=String(this);if(r===null||r<0||r>=e.length-1)return null;var t=e.charCodeAt(r);if(t>=55296&&t<=56319&&e.length>r+1){var n=e.charCodeAt(r+1);if(n>=56320&&n<=57343)return r==e.length-2?null:r+2}return r+1},String.prototype.kmwPrevChar=function(r){var e=String(this);if(r==null||r<=0||r>e.length)return null;var t=e.charCodeAt(r-1);if(t>=56320&&t<=57343&&r>1){var n=e.charCodeAt(r-2);if(n>=55296&&n<=56319)return r-2}return r-1},String.prototype.kmwCodePointToCodeUnit=function(r){if(r===null)return null;var e=String(this),t=0;if(r<0){t=e.length;for(var n=0;n>r;n--)t=e.kmwPrevChar(t);return t}if(r==e.kmwLength())return e.length;for(var n=0;n<r;n++)t=e.kmwNextChar(t);return t},String.prototype.kmwCodeUnitToCodePoint=function(r){var e=String(this);return r===null?null:r==0?0:r<0?e.substr(r).kmwLength():e.substr(0,r).kmwLength()},String.prototype.kmwCharAt=function(r){var e=String(this);return r>=0?e.kmwSubstr(r,1):""},String.prototype.kmwBMPNextChar=function(r){var e=String(this);return r<0||r>=e.length-1?null:r+1},String.prototype.kmwBMPPrevChar=function(r){var e=String(this);return r<=0||r>e.length?null:r-1},String.prototype.kmwBMPCodePointToCodeUnit=function(r){return r},String.prototype.kmwBMPCodeUnitToCodePoint=function(r){return r},String.prototype.kmwBMPLength=function(){var r=String(this);return r.length},String.prototype.kmwBMPSubstr=function(r,e){var t=String(this);return r>-1?t.substr(r,e):t.substr(t.length+r,-r)},String.kmwEnableSupplementaryPlane=function(r){var e=String.prototype;String._kmwFromCharCode=r?String.kmwFromCharCode:String.fromCharCode,e._kmwCharAt=r?e.kmwCharAt:e.charAt,e._kmwCharCodeAt=r?e.kmwCharCodeAt:e.charCodeAt,e._kmwIndexOf=r?e.kmwIndexOf:e.indexOf,e._kmwLastIndexOf=r?e.kmwLastIndexOf:e.lastIndexOf,e._kmwSlice=r?e.kmwSlice:e.slice,e._kmwSubstring=r?e.kmwSubstring:e.substring,e._kmwSubstr=r?e.kmwSubstr:e.kmwBMPSubstr,e._kmwLength=r?e.kmwLength:e.kmwBMPLength,e._kmwNextChar=r?e.kmwNextChar:e.kmwBMPNextChar,e._kmwPrevChar=r?e.kmwPrevChar:e.kmwBMPPrevChar,e._kmwCodePointToCodeUnit=r?e.kmwCodePointToCodeUnit:e.kmwBMPCodePointToCodeUnit,e._kmwCodeUnitToCodePoint=r?e.kmwCodeUnitToCodePoint:e.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}V();var z={};R(z,{DummyModel:function(){return yt},PriorityQueue:function(){return b},QuoteBehavior:function(){return U},SENTINEL_CODE_UNIT:function(){return H},TrieModel:function(){return ht},applyTransform:function(){return Y},buildMergedTransform:function(){return ce},defaultApplyCasing:function(){return y},getLastPreCaretToken:function(){return ye},isHighSurrogate:function(){return ne},isLowSurrogate:function(){return E},isSentinel:function(){return Z},tokenize:function(){return J},transformToSuggestion:function(){return d},wordbreak:function(){return Pe}}),V();var H="\\uFDD0";function Y(r,e){var t,n,i=e.left||"",o=i.kmwLength(),u=o<r.deleteLeft?o:r.deleteLeft,a=i.kmwSubstr(0,o-u)+(r.insert||""),s=e.right||"",c=s.kmwLength(),f=c<((t=r.deleteRight)!==null&&t!==void 0?t:0)?c:(n=r.deleteRight)!==null&&n!==void 0?n:0,l=s.kmwSubstr(f);return{left:a,right:l,startOfBuffer:e.startOfBuffer,endOfBuffer:e.endOfBuffer,casingForm:e.casingForm}}function ce(r,e){var t=r.insert,n=e.deleteLeft;if(e.deleteLeft){var i=r.insert.kmwLength();i<=e.deleteLeft?(t="",n=e.deleteLeft-i):(t=r.insert.kmwSubstr(0,i-e.deleteLeft),n=0)}return{insert:t+e.insert,deleteLeft:r.deleteLeft+n,deleteRight:(r.deleteRight||0)+(e.deleteRight||0)}}function ne(r){return typeof r=="string"&&(r=r.charCodeAt(0)),r>=55296&&r<=56319}function E(r){return typeof r=="string"&&(r=r.charCodeAt(0)),r>=56320&&r<=57343}function Z(r){return r==H}function d(r,e){var t={transform:r,transformId:r.id,displayAs:r.insert};return(e===0||e)&&(t.p=e),t}function y(r,e){switch(r){case"lower":return e.toLowerCase();case"upper":return e.toUpperCase();case"initial":var t=1;return e.length>1&&ne(e.charAt(0))&&E(e.charCodeAt(1))&&(t=2),e.substring(0,t).toUpperCase().concat(e.substring(t))}}var I=function(){function r(e,t){if(typeof e!="function"){this.comparator=e.comparator,this.heap=[].concat(e.heap);return}var n=e;this.comparator=n,this.heap=(t!=null?t:[]).slice(0),this.heapify()}return r.leftChildIndex=function(e){return e*2+1},r.rightChildIndex=function(e){return e*2+2},r.parentIndex=function(e){return Math.floor((e-1)/2)},r.prototype.heapify=function(e,t){if(e==null||t==null){this.heapify(0,this.count-1);return}for(var n=[],i=-1,o=t;o>=e;o--){var u=r.parentIndex(o);this.siftDown(o)&&u<e&&i!=u&&(n.push(u),i=u)}for(i=-1;n.length>0;){var a=n.shift(),u=r.parentIndex(a);this.siftDown(a)&&u>=0&&i!=u&&(n.push(u),i=u)}},Object.defineProperty(r.prototype,"count",{get:function(){return this.heap.length},enumerable:!1,configurable:!0}),r.prototype.peek=function(){return this.heap[0]},r.prototype.enqueue=function(e){var t=this.heap.length;this.heap.push(e);for(var n=r.parentIndex,i=n(t);t!==0&&this.comparator(this.heap[t],this.heap[i])<0;){var o=this.heap[t];this.heap[t]=this.heap[i],this.heap[i]=o,t=i,i=n(t)}},r.prototype.enqueueAll=function(e){if(e.length!=0){var t=this.count;this.heap=this.heap.concat(e);var n=r.parentIndex(t);this.heapify(n>=0?n:0,r.parentIndex(this.count-1))}},r.prototype.dequeue=function(){if(this.count!=0){var e=this.heap[0],t=this.heap.pop();return this.heap.length>0&&(this.heap[0]=t,this.siftDown(0)),e}},r.prototype.siftDown=function(e){var t=r.leftChildIndex(e),n=r.rightChildIndex(e),i=e;if(t<this.heap.length&&this.comparator(this.heap[t],this.heap[i])<0&&(i=t),n<this.heap.length&&this.comparator(this.heap[n],this.heap[i])<0&&(i=n),i!=e){var o=this.heap[e];return this.heap[e]=this.heap[i],this.heap[i]=o,this.siftDown(i),!0}else return!1},r.prototype.toArray=function(){return this.heap.slice(0)},r}(),b=I,j;(function(r){r.noQuotes="no-quotes",r.useQuotes="use-quotes",r.default="default-quotes"})(j||(j={})),function(r){function e(t,n,i,o){if(o==r.default||!o)throw"Specified quote behavior may be ambiguous - default behavior not specified (may not be .default)";switch(t==r.default&&(t=o),t){case r.noQuotes:return n;case r.useQuotes:var u=i.quotesForKeepSuggestion,a=u.open,s=u.close;return a+n+s;default:throw"Unsupported quote behavior state detected; implementation missing!"}}r.apply=e}(j||(j={}));var U=j;function J(r,e){e=e||{left:void 0,startOfBuffer:void 0,endOfBuffer:void 0};var t=r(e.left||"")||[],n=r(e.right||"")||[],i;if(t.length>0&&(i=t[t.length-1]),t.length>1){var o=t[t.length-2];if(o.end==i.start&&i.text=="\'"){var u={text:o.text+i.text,start:o.start,end:i.end,length:o.length+i.length};t.pop(),t.pop(),t.push(u),i=u}}var a={left:t.map(function(l){return l.text}),right:n.map(function(l){return l.text}),caretSplitsToken:!1};if(t.length>0&&n.length>0){var s=n[0],c=i.end!=e.left.length,f=s.start!=0;if(c||f)return a;r(i.text+s.text).length==1&&(a.caretSplitsToken=!0)}return a}function ye(r,e){var t=J(r,e);return t.left.length>0?t.left.pop():""}function Pe(r,e){return ye(r,e)}var Me={};R(Me,{ascii:function(){return it},default:function(){return fe},defaultWordbreaker:function(){return fe},placeholder:function(){return nt}});function nt(r){var e=0;return r.split(/\\s+/).map(function(t){var n={start:e,end:e+t.length,text:t,length:t.length};return e=n.end,n})}function it(r){for(var e=/[A-Za-z0-9\']+/g,t=[],n;(n=e.exec(r))!==null;)t.push(new ot(n[0],n.index));return t}var ot=function(){function r(e,t){this.text=e,this.start=t}return Object.defineProperty(r.prototype,"length",{get:function(){return this.text.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"end",{get:function(){return this.start+this.text.length},enumerable:!1,configurable:!0}),r}(),at=["Other","LF","Newline","CR","WSegSpace","Double_Quote","Single_Quote","MidNum","MidNumLet","Numeric","MidLetter","ALetter","ExtendNumLet","Format","Extend","Hebrew_Letter","ZWJ","Katakana","Regional_Indicator","sot","eot"],Ee=[[0,0],[10,1],[11,2],[13,3],[14,0],[32,4],[33,0],[34,5],[35,0],[39,6],[40,0],[44,7],[45,0],[46,8],[47,0],[48,9],[58,10],[59,7],[60,0],[65,11],[91,0],[95,12],[96,0],[97,11],[123,0],[133,2],[134,0],[170,11],[171,0],[173,13],[174,0],[181,11],[182,0],[183,10],[184,0],[186,11],[187,0],[192,11],[215,0],[216,11],[247,0],[248,11],[728,0],[734,11],[768,14],[880,11],[885,0],[886,11],[888,0],[890,11],[894,7],[895,11],[896,0],[902,11],[903,10],[904,11],[907,0],[908,11],[909,0],[910,11],[930,0],[931,11],[1014,0],[1015,11],[1154,0],[1155,14],[1162,11],[1328,0],[1329,11],[1367,0],[1369,11],[1373,0],[1374,11],[1375,10],[1376,11],[1417,7],[1418,11],[1419,0],[1425,14],[1470,0],[1471,14],[1472,0],[1473,14],[1475,0],[1476,14],[1478,0],[1479,14],[1480,0],[1488,15],[1515,0],[1519,15],[1523,11],[1524,10],[1525,0],[1536,13],[1542,0],[1548,7],[1550,0],[1552,14],[1563,0],[1564,13],[1565,0],[1568,11],[1611,14],[1632,9],[1642,0],[1643,9],[1644,7],[1645,0],[1646,11],[1648,14],[1649,11],[1748,0],[1749,11],[1750,14],[1757,13],[1758,0],[1759,14],[1765,11],[1767,14],[1769,0],[1770,14],[1774,11],[1776,9],[1786,11],[1789,0],[1791,11],[1792,0],[1807,13],[1808,11],[1809,14],[1810,11],[1840,14],[1867,0],[1869,11],[1958,14],[1969,11],[1970,0],[1984,9],[1994,11],[2027,14],[2036,11],[2038,0],[2040,7],[2041,0],[2042,11],[2043,0],[2045,14],[2046,0],[2048,11],[2070,14],[2074,11],[2075,14],[2084,11],[2085,14],[2088,11],[2089,14],[2094,0],[2112,11],[2137,14],[2140,0],[2144,11],[2155,0],[2208,11],[2229,0],[2230,11],[2248,0],[2259,14],[2274,13],[2275,14],[2308,11],[2362,14],[2365,11],[2366,14],[2384,11],[2385,14],[2392,11],[2402,14],[2404,0],[2406,9],[2416,0],[2417,11],[2433,14],[2436,0],[2437,11],[2445,0],[2447,11],[2449,0],[2451,11],[2473,0],[2474,11],[2481,0],[2482,11],[2483,0],[2486,11],[2490,0],[2492,14],[2493,11],[2494,14],[2501,0],[2503,14],[2505,0],[2507,14],[2510,11],[2511,0],[2519,14],[2520,0],[2524,11],[2526,0],[2527,11],[2530,14],[2532,0],[2534,9],[2544,11],[2546,0],[2556,11],[2557,0],[2558,14],[2559,0],[2561,14],[2564,0],[2565,11],[2571,0],[2575,11],[2577,0],[2579,11],[2601,0],[2602,11],[2609,0],[2610,11],[2612,0],[2613,11],[2615,0],[2616,11],[2618,0],[2620,14],[2621,0],[2622,14],[2627,0],[2631,14],[2633,0],[2635,14],[2638,0],[2641,14],[2642,0],[2649,11],[2653,0],[2654,11],[2655,0],[2662,9],[2672,14],[2674,11],[2677,14],[2678,0],[2689,14],[2692,0],[2693,11],[2702,0],[2703,11],[2706,0],[2707,11],[2729,0],[2730,11],[2737,0],[2738,11],[2740,0],[2741,11],[2746,0],[2748,14],[2749,11],[2750,14],[2758,0],[2759,14],[2762,0],[2763,14],[2766,0],[2768,11],[2769,0],[2784,11],[2786,14],[2788,0],[2790,9],[2800,0],[2809,11],[2810,14],[2816,0],[2817,14],[2820,0],[2821,11],[2829,0],[2831,11],[2833,0],[2835,11],[2857,0],[2858,11],[2865,0],[2866,11],[2868,0],[2869,11],[2874,0],[2876,14],[2877,11],[2878,14],[2885,0],[2887,14],[2889,0],[2891,14],[2894,0],[2901,14],[2904,0],[2908,11],[2910,0],[2911,11],[2914,14],[2916,0],[2918,9],[2928,0],[2929,11],[2930,0],[2946,14],[2947,11],[2948,0],[2949,11],[2955,0],[2958,11],[2961,0],[2962,11],[2966,0],[2969,11],[2971,0],[2972,11],[2973,0],[2974,11],[2976,0],[2979,11],[2981,0],[2984,11],[2987,0],[2990,11],[3002,0],[3006,14],[3011,0],[3014,14],[3017,0],[3018,14],[3022,0],[3024,11],[3025,0],[3031,14],[3032,0],[3046,9],[3056,0],[3072,14],[3077,11],[3085,0],[3086,11],[3089,0],[3090,11],[3113,0],[3114,11],[3130,0],[3133,11],[3134,14],[3141,0],[3142,14],[3145,0],[3146,14],[3150,0],[3157,14],[3159,0],[3160,11],[3163,0],[3168,11],[3170,14],[3172,0],[3174,9],[3184,0],[3200,11],[3201,14],[3204,0],[3205,11],[3213,0],[3214,11],[3217,0],[3218,11],[3241,0],[3242,11],[3252,0],[3253,11],[3258,0],[3260,14],[3261,11],[3262,14],[3269,0],[3270,14],[3273,0],[3274,14],[3278,0],[3285,14],[3287,0],[3294,11],[3295,0],[3296,11],[3298,14],[3300,0],[3302,9],[3312,0],[3313,11],[3315,0],[3328,14],[3332,11],[3341,0],[3342,11],[3345,0],[3346,11],[3387,14],[3389,11],[3390,14],[3397,0],[3398,14],[3401,0],[3402,14],[3406,11],[3407,0],[3412,11],[3415,14],[3416,0],[3423,11],[3426,14],[3428,0],[3430,9],[3440,0],[3450,11],[3456,0],[3457,14],[3460,0],[3461,11],[3479,0],[3482,11],[3506,0],[3507,11],[3516,0],[3517,11],[3518,0],[3520,11],[3527,0],[3530,14],[3531,0],[3535,14],[3541,0],[3542,14],[3543,0],[3544,14],[3552,0],[3558,9],[3568,0],[3570,14],[3572,0],[3633,14],[3634,0],[3636,14],[3643,0],[3655,14],[3663,0],[3664,9],[3674,0],[3761,14],[3762,0],[3764,14],[3773,0],[3784,14],[3790,0],[3792,9],[3802,0],[3840,11],[3841,0],[3864,14],[3866,0],[3872,9],[3882,0],[3893,14],[3894,0],[3895,14],[3896,0],[3897,14],[3898,0],[3902,14],[3904,11],[3912,0],[3913,11],[3949,0],[3953,14],[3973,0],[3974,14],[3976,11],[3981,14],[3992,0],[3993,14],[4029,0],[4038,14],[4039,0],[4139,14],[4159,0],[4160,9],[4170,0],[4182,14],[4186,0],[4190,14],[4193,0],[4194,14],[4197,0],[4199,14],[4206,0],[4209,14],[4213,0],[4226,14],[4238,0],[4239,14],[4240,9],[4250,14],[4254,0],[4256,11],[4294,0],[4295,11],[4296,0],[4301,11],[4302,0],[4304,11],[4347,0],[4348,11],[4681,0],[4682,11],[4686,0],[4688,11],[4695,0],[4696,11],[4697,0],[4698,11],[4702,0],[4704,11],[4745,0],[4746,11],[4750,0],[4752,11],[4785,0],[4786,11],[4790,0],[4792,11],[4799,0],[4800,11],[4801,0],[4802,11],[4806,0],[4808,11],[4823,0],[4824,11],[4881,0],[4882,11],[4886,0],[4888,11],[4955,0],[4957,14],[4960,0],[4992,11],[5008,0],[5024,11],[5110,0],[5112,11],[5118,0],[5121,11],[5741,0],[5743,11],[5760,4],[5761,11],[5787,0],[5792,11],[5867,0],[5870,11],[5881,0],[5888,11],[5901,0],[5902,11],[5906,14],[5909,0],[5920,11],[5938,14],[5941,0],[5952,11],[5970,14],[5972,0],[5984,11],[5997,0],[5998,11],[6001,0],[6002,14],[6004,0],[6068,14],[6100,0],[6109,14],[6110,0],[6112,9],[6122,0],[6155,14],[6158,13],[6159,0],[6160,9],[6170,0],[6176,11],[6265,0],[6272,11],[6277,14],[6279,11],[6313,14],[6314,11],[6315,0],[6320,11],[6390,0],[6400,11],[6431,0],[6432,14],[6444,0],[6448,14],[6460,0],[6470,9],[6480,0],[6608,9],[6618,0],[6656,11],[6679,14],[6684,0],[6741,14],[6751,0],[6752,14],[6781,0],[6783,14],[6784,9],[6794,0],[6800,9],[6810,0],[6832,14],[6849,0],[6912,14],[6917,11],[6964,14],[6981,11],[6988,0],[6992,9],[7002,0],[7019,14],[7028,0],[7040,14],[7043,11],[7073,14],[7086,11],[7088,9],[7098,11],[7142,14],[7156,0],[7168,11],[7204,14],[7224,0],[7232,9],[7242,0],[7245,11],[7248,9],[7258,11],[7294,0],[7296,11],[7305,0],[7312,11],[7355,0],[7357,11],[7360,0],[7376,14],[7379,0],[7380,14],[7401,11],[7405,14],[7406,11],[7412,14],[7413,11],[7415,14],[7418,11],[7419,0],[7424,11],[7616,14],[7674,0],[7675,14],[7680,11],[7958,0],[7960,11],[7966,0],[7968,11],[8006,0],[8008,11],[8014,0],[8016,11],[8024,0],[8025,11],[8026,0],[8027,11],[8028,0],[8029,11],[8030,0],[8031,11],[8062,0],[8064,11],[8117,0],[8118,11],[8125,0],[8126,11],[8127,0],[8130,11],[8133,0],[8134,11],[8141,0],[8144,11],[8148,0],[8150,11],[8156,0],[8160,11],[8173,0],[8178,11],[8181,0],[8182,11],[8189,0],[8192,4],[8199,0],[8200,4],[8203,0],[8204,14],[8205,16],[8206,13],[8208,0],[8216,8],[8218,0],[8228,8],[8229,0],[8231,10],[8232,2],[8234,13],[8239,12],[8240,0],[8255,12],[8257,0],[8260,7],[8261,0],[8276,12],[8277,0],[8287,4],[8288,13],[8293,0],[8294,13],[8304,0],[8305,11],[8306,0],[8319,11],[8320,0],[8336,11],[8349,0],[8400,14],[8433,0],[8450,11],[8451,0],[8455,11],[8456,0],[8458,11],[8468,0],[8469,11],[8470,0],[8473,11],[8478,0],[8484,11],[8485,0],[8486,11],[8487,0],[8488,11],[8489,0],[8490,11],[8494,0],[8495,11],[8506,0],[8508,11],[8512,0],[8517,11],[8522,0],[8526,11],[8527,0],[8544,11],[8585,0],[9398,11],[9450,0],[11264,11],[11311,0],[11312,11],[11359,0],[11360,11],[11493,0],[11499,11],[11503,14],[11506,11],[11508,0],[11520,11],[11558,0],[11559,11],[11560,0],[11565,11],[11566,0],[11568,11],[11624,0],[11631,11],[11632,0],[11647,14],[11648,11],[11671,0],[11680,11],[11687,0],[11688,11],[11695,0],[11696,11],[11703,0],[11704,11],[11711,0],[11712,11],[11719,0],[11720,11],[11727,0],[11728,11],[11735,0],[11736,11],[11743,0],[11744,14],[11776,0],[11823,11],[11824,0],[12288,4],[12289,0],[12293,11],[12294,0],[12330,14],[12336,0],[12337,17],[12342,0],[12347,11],[12349,0],[12441,14],[12443,17],[12445,0],[12448,17],[12539,0],[12540,17],[12544,0],[12549,11],[12592,0],[12593,11],[12687,0],[12704,11],[12736,0],[12784,17],[12800,0],[13008,17],[13055,0],[13056,17],[13144,0],[40960,11],[42125,0],[42192,11],[42238,0],[42240,11],[42509,0],[42512,11],[42528,9],[42538,11],[42540,0],[42560,11],[42607,14],[42611,0],[42612,14],[42622,0],[42623,11],[42654,14],[42656,11],[42736,14],[42738,0],[42760,11],[42944,0],[42946,11],[42955,0],[42997,11],[43010,14],[43011,11],[43014,14],[43015,11],[43019,14],[43020,11],[43043,14],[43048,0],[43052,14],[43053,0],[43072,11],[43124,0],[43136,14],[43138,11],[43188,14],[43206,0],[43216,9],[43226,0],[43232,14],[43250,11],[43256,0],[43259,11],[43260,0],[43261,11],[43263,14],[43264,9],[43274,11],[43302,14],[43310,0],[43312,11],[43335,14],[43348,0],[43360,11],[43389,0],[43392,14],[43396,11],[43443,14],[43457,0],[43471,11],[43472,9],[43482,0],[43493,14],[43494,0],[43504,9],[43514,0],[43520,11],[43561,14],[43575,0],[43584,11],[43587,14],[43588,11],[43596,14],[43598,0],[43600,9],[43610,0],[43643,14],[43646,0],[43696,14],[43697,0],[43698,14],[43701,0],[43703,14],[43705,0],[43710,14],[43712,0],[43713,14],[43714,0],[43744,11],[43755,14],[43760,0],[43762,11],[43765,14],[43767,0],[43777,11],[43783,0],[43785,11],[43791,0],[43793,11],[43799,0],[43808,11],[43815,0],[43816,11],[43823,0],[43824,11],[43882,0],[43888,11],[44003,14],[44011,0],[44012,14],[44014,0],[44016,9],[44026,0],[44032,11],[55204,0],[55216,11],[55239,0],[55243,11],[55292,0],[64256,11],[64263,0],[64275,11],[64280,0],[64285,15],[64286,14],[64287,15],[64297,0],[64298,15],[64311,0],[64312,15],[64317,0],[64318,15],[64319,0],[64320,15],[64322,0],[64323,15],[64325,0],[64326,15],[64336,11],[64434,0],[64467,11],[64830,0],[64848,11],[64912,0],[64914,11],[64968,0],[65008,11],[65020,0],[65024,14],[65040,7],[65041,0],[65043,10],[65044,7],[65045,0],[65056,14],[65072,0],[65075,12],[65077,0],[65101,12],[65104,7],[65105,0],[65106,8],[65107,0],[65108,7],[65109,10],[65110,0],[65136,11],[65141,0],[65142,11],[65277,0],[65279,13],[65280,0],[65287,8],[65288,0],[65292,7],[65293,0],[65294,8],[65295,0],[65296,9],[65306,10],[65307,7],[65308,0],[65313,11],[65339,0],[65343,12],[65344,0],[65345,11],[65371,0],[65382,17],[65438,14],[65440,11],[65471,0],[65474,11],[65480,0],[65482,11],[65488,0],[65490,11],[65496,0],[65498,11],[65501,0],[65529,13],[65532,0],[65536,11],[65548,0],[65549,11],[65575,0],[65576,11],[65595,0],[65596,11],[65598,0],[65599,11],[65614,0],[65616,11],[65630,0],[65664,11],[65787,0],[65856,11],[65909,0],[66045,14],[66046,0],[66176,11],[66205,0],[66208,11],[66257,0],[66272,14],[66273,0],[66304,11],[66336,0],[66349,11],[66379,0],[66384,11],[66422,14],[66427,0],[66432,11],[66462,0],[66464,11],[66500,0],[66504,11],[66512,0],[66513,11],[66518,0],[66560,11],[66718,0],[66720,9],[66730,0],[66736,11],[66772,0],[66776,11],[66812,0],[66816,11],[66856,0],[66864,11],[66916,0],[67072,11],[67383,0],[67392,11],[67414,0],[67424,11],[67432,0],[67584,11],[67590,0],[67592,11],[67593,0],[67594,11],[67638,0],[67639,11],[67641,0],[67644,11],[67645,0],[67647,11],[67670,0],[67680,11],[67703,0],[67712,11],[67743,0],[67808,11],[67827,0],[67828,11],[67830,0],[67840,11],[67862,0],[67872,11],[67898,0],[67968,11],[68024,0],[68030,11],[68032,0],[68096,11],[68097,14],[68100,0],[68101,14],[68103,0],[68108,14],[68112,11],[68116,0],[68117,11],[68120,0],[68121,11],[68150,0],[68152,14],[68155,0],[68159,14],[68160,0],[68192,11],[68221,0],[68224,11],[68253,0],[68288,11],[68296,0],[68297,11],[68325,14],[68327,0],[68352,11],[68406,0],[68416,11],[68438,0],[68448,11],[68467,0],[68480,11],[68498,0],[68608,11],[68681,0],[68736,11],[68787,0],[68800,11],[68851,0],[68864,11],[68900,14],[68904,0],[68912,9],[68922,0],[69248,11],[69290,0],[69291,14],[69293,0],[69296,11],[69298,0],[69376,11],[69405,0],[69415,11],[69416,0],[69424,11],[69446,14],[69457,0],[69552,11],[69573,0],[69600,11],[69623,0],[69632,14],[69635,11],[69688,14],[69703,0],[69734,9],[69744,0],[69759,14],[69763,11],[69808,14],[69819,0],[69821,13],[69822,0],[69837,13],[69838,0],[69840,11],[69865,0],[69872,9],[69882,0],[69888,14],[69891,11],[69927,14],[69941,0],[69942,9],[69952,0],[69956,11],[69957,14],[69959,11],[69960,0],[69968,11],[70003,14],[70004,0],[70006,11],[70007,0],[70016,14],[70019,11],[70067,14],[70081,11],[70085,0],[70089,14],[70093,0],[70094,14],[70096,9],[70106,11],[70107,0],[70108,11],[70109,0],[70144,11],[70162,0],[70163,11],[70188,14],[70200,0],[70206,14],[70207,0],[70272,11],[70279,0],[70280,11],[70281,0],[70282,11],[70286,0],[70287,11],[70302,0],[70303,11],[70313,0],[70320,11],[70367,14],[70379,0],[70384,9],[70394,0],[70400,14],[70404,0],[70405,11],[70413,0],[70415,11],[70417,0],[70419,11],[70441,0],[70442,11],[70449,0],[70450,11],[70452,0],[70453,11],[70458,0],[70459,14],[70461,11],[70462,14],[70469,0],[70471,14],[70473,0],[70475,14],[70478,0],[70480,11],[70481,0],[70487,14],[70488,0],[70493,11],[70498,14],[70500,0],[70502,14],[70509,0],[70512,14],[70517,0],[70656,11],[70709,14],[70727,11],[70731,0],[70736,9],[70746,0],[70750,14],[70751,11],[70754,0],[70784,11],[70832,14],[70852,11],[70854,0],[70855,11],[70856,0],[70864,9],[70874,0],[71040,11],[71087,14],[71094,0],[71096,14],[71105,0],[71128,11],[71132,14],[71134,0],[71168,11],[71216,14],[71233,0],[71236,11],[71237,0],[71248,9],[71258,0],[71296,11],[71339,14],[71352,11],[71353,0],[71360,9],[71370,0],[71453,14],[71468,0],[71472,9],[71482,0],[71680,11],[71724,14],[71739,0],[71840,11],[71904,9],[71914,0],[71935,11],[71943,0],[71945,11],[71946,0],[71948,11],[71956,0],[71957,11],[71959,0],[71960,11],[71984,14],[71990,0],[71991,14],[71993,0],[71995,14],[71999,11],[72e3,14],[72001,11],[72002,14],[72004,0],[72016,9],[72026,0],[72096,11],[72104,0],[72106,11],[72145,14],[72152,0],[72154,14],[72161,11],[72162,0],[72163,11],[72164,14],[72165,0],[72192,11],[72193,14],[72203,11],[72243,14],[72250,11],[72251,14],[72255,0],[72263,14],[72264,0],[72272,11],[72273,14],[72284,11],[72330,14],[72346,0],[72349,11],[72350,0],[72384,11],[72441,0],[72704,11],[72713,0],[72714,11],[72751,14],[72759,0],[72760,14],[72768,11],[72769,0],[72784,9],[72794,0],[72818,11],[72848,0],[72850,14],[72872,0],[72873,14],[72887,0],[72960,11],[72967,0],[72968,11],[72970,0],[72971,11],[73009,14],[73015,0],[73018,14],[73019,0],[73020,14],[73022,0],[73023,14],[73030,11],[73031,14],[73032,0],[73040,9],[73050,0],[73056,11],[73062,0],[73063,11],[73065,0],[73066,11],[73098,14],[73103,0],[73104,14],[73106,0],[73107,14],[73112,11],[73113,0],[73120,9],[73130,0],[73440,11],[73459,14],[73463,0],[73648,11],[73649,0],[73728,11],[74650,0],[74752,11],[74863,0],[74880,11],[75076,0],[77824,11],[78895,0],[78896,13],[78905,0],[82944,11],[83527,0],[92160,11],[92729,0],[92736,11],[92767,0],[92768,9],[92778,0],[92880,11],[92910,0],[92912,14],[92917,0],[92928,11],[92976,14],[92983,0],[92992,11],[92996,0],[93008,9],[93018,0],[93027,11],[93048,0],[93053,11],[93072,0],[93760,11],[93824,0],[93952,11],[94027,0],[94031,14],[94032,11],[94033,14],[94088,0],[94095,14],[94099,11],[94112,0],[94176,11],[94178,0],[94179,11],[94180,14],[94181,0],[94192,14],[94194,0],[110592,17],[110593,0],[110948,17],[110952,0],[113664,11],[113771,0],[113776,11],[113789,0],[113792,11],[113801,0],[113808,11],[113818,0],[113821,14],[113823,0],[113824,13],[113828,0],[119141,14],[119146,0],[119149,14],[119155,13],[119163,14],[119171,0],[119173,14],[119180,0],[119210,14],[119214,0],[119362,14],[119365,0],[119808,11],[119893,0],[119894,11],[119965,0],[119966,11],[119968,0],[119970,11],[119971,0],[119973,11],[119975,0],[119977,11],[119981,0],[119982,11],[119994,0],[119995,11],[119996,0],[119997,11],[120004,0],[120005,11],[120070,0],[120071,11],[120075,0],[120077,11],[120085,0],[120086,11],[120093,0],[120094,11],[120122,0],[120123,11],[120127,0],[120128,11],[120133,0],[120134,11],[120135,0],[120138,11],[120145,0],[120146,11],[120486,0],[120488,11],[120513,0],[120514,11],[120539,0],[120540,11],[120571,0],[120572,11],[120597,0],[120598,11],[120629,0],[120630,11],[120655,0],[120656,11],[120687,0],[120688,11],[120713,0],[120714,11],[120745,0],[120746,11],[120771,0],[120772,11],[120780,0],[120782,9],[120832,0],[121344,14],[121399,0],[121403,14],[121453,0],[121461,14],[121462,0],[121476,14],[121477,0],[121499,14],[121504,0],[121505,14],[121520,0],[122880,14],[122887,0],[122888,14],[122905,0],[122907,14],[122914,0],[122915,14],[122917,0],[122918,14],[122923,0],[123136,11],[123181,0],[123184,14],[123191,11],[123198,0],[123200,9],[123210,0],[123214,11],[123215,0],[123584,11],[123628,14],[123632,9],[123642,0],[124928,11],[125125,0],[125136,14],[125143,0],[125184,11],[125252,14],[125259,11],[125260,0],[125264,9],[125274,0],[126464,11],[126468,0],[126469,11],[126496,0],[126497,11],[126499,0],[126500,11],[126501,0],[126503,11],[126504,0],[126505,11],[126515,0],[126516,11],[126520,0],[126521,11],[126522,0],[126523,11],[126524,0],[126530,11],[126531,0],[126535,11],[126536,0],[126537,11],[126538,0],[126539,11],[126540,0],[126541,11],[126544,0],[126545,11],[126547,0],[126548,11],[126549,0],[126551,11],[126552,0],[126553,11],[126554,0],[126555,11],[126556,0],[126557,11],[126558,0],[126559,11],[126560,0],[126561,11],[126563,0],[126564,11],[126565,0],[126567,11],[126571,0],[126572,11],[126579,0],[126580,11],[126584,0],[126585,11],[126589,0],[126590,11],[126591,0],[126592,11],[126602,0],[126603,11],[126620,0],[126625,11],[126628,0],[126629,11],[126634,0],[126635,11],[126652,0],[127280,11],[127306,0],[127312,11],[127338,0],[127344,11],[127370,0],[127462,18],[127488,0],[127995,14],[128e3,0],[130032,9],[130042,0],[917505,13],[917506,0],[917536,14],[917632,0],[917760,14],[918e3,0]];function fe(r,e){var t=lt(r,e);if(t.length==0)return[];for(var n=[],i=0;i<t.length-1;i++){var o=t[i],u=t[i+1],a=new We(r,o,u);st(a.text,e)?n.push(a):i==t.length-2&&(a=new We(r,u,u),n.push(a))}return n}var We=function(){function r(e,t,n){this._source=e,this.start=t,this.end=n}return Object.defineProperty(r.prototype,"text",{get:function(){return this._source.substring(this.start,this.end)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"length",{get:function(){return this.end-this.start},enumerable:!1,configurable:!0}),r}(),ut=function(){function r(e,t,n,i,o,u){this.lookbehind=19,this.left=19,this.right=19,this.text=e,this.options=t,arguments.length==3?this.lookahead=this.wordbreakPropertyAt(n):(this.lookbehind=n,this.left=i,this.right=o,this.lookahead=u)}return r.prototype.next=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.left,this.right,this.lookahead,t)},r.prototype.ignoringRight=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.lookbehind,this.left,this.lookahead,t)},r.prototype.ignoringLookahead=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.lookbehind,this.left,this.right,t)},r.prototype.wordbreakPropertyAt=function(e){return e<0?19:e>=this.text.length?20:Qe(this.text[e])?Ie(this.text[e]+this.text[e+1]):Ie(this.text[e],this.options)},r.prototype.match=function(e,t,n,i){var o,u,a,s,c=(o=e==null?void 0:e.includes(this.lookbehind))!==null&&o!==void 0?o:!0;return c=c&&((u=t==null?void 0:t.includes(this.left))!==null&&u!==void 0?u:!0),c=c&&((a=n==null?void 0:n.includes(this.right))!==null&&a!==void 0?a:!0),c&&((s=i==null?void 0:i.includes(this.lookahead))!==null&&s!==void 0?s:!0)},r.prototype.propertyMatch=function(e,t,n,i){var o=this,u=function(a){return Be(a,o.options)};return this.match(e==null?void 0:e.map(u),t==null?void 0:t.map(u),n==null?void 0:n.map(u),i==null?void 0:i.map(u))},r}();function st(r,e){return!Array.from(r).map(function(t){return Ie(t,e)}).every(function(t){return t===3||t===1||t===2||t===4})}function lt(r,e){var t,n,i;if(r.length===0)return[];e&&!e.rules&&(e.rules=[]);var o=[],u,a=0,s=new ut(r,e,a),c=0;do{if(u=a,a=S(a),s=s.next(a),s.match(null,[19],null,null)){o.push(u);continue}if(s.match(null,null,[20],null)){o.push(u);break}if(!s.match(null,[3],[1],null)){var f=[2,3,1];if(s.match(null,f,null,null)){o.push(u);continue}if(s.match(null,null,f,null)){o.push(u);continue}if(!s.match(null,[4],[4],null)){for(var l=[13,14,16];s.match(null,null,l,null);)t=(0,T.__read)([a,S(a)],2),u=t[0],a=t[1],s=s.ignoringRight(a);if(s.right===20){o.push(u);break}for(;s.match(null,null,null,l);)a=S(a),s=s.ignoringLookahead(a);var h=[11,15],p=[8,6];if(e!=null&&e.rules){var w=!1;try{for(var m=(n=void 0,(0,T.__values)(e.rules)),g=m.next();!g.done;g=m.next()){var C=g.value;if(w=C.match(s),w){C.breakIfMatch&&o.push(u);break}}}catch(P){n={error:P}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(n)throw n.error}}if(w)continue}if(!s.match(null,h,h,null)){var _=[10].concat(p);if(!s.match(null,h,_,h)&&!s.match(h,_,h,null)&&!s.match(null,[15],[6],null)&&!s.match(null,[15],[5],[15])&&!s.match([15],[5],[15],null)&&!s.match(null,[9],[9],null)&&!s.match(null,h,[9],null)&&!s.match(null,[9],h,null)){var k=[7].concat(p);if(!s.match([9],k,[9],null)&&!s.match(null,[9],k,[9])&&!s.match(null,[17],[17],null)){var v=[17,9].concat(h);if(!s.match(null,v,[12],null)&&!s.match(null,[12],[12],null)&&!s.match(null,[12],v,null)){if(s.right===18){if(c+=1,c%2==1)continue}else c=0;o.push(u)}}}}}}}while(u<r.length);return o;function S(P){return P>=r.length?r.length:Qe(r[P])?P+2:P+1}}function Qe(r){var e=r.charCodeAt(0);return e>=55296&&e<=56319}function Ie(r,e){if(e!=null&&e.propertyMapping){var t=e.propertyMapping(r);if(t)return Be(t,e)}var n=r.codePointAt(0);return qe(n,0,Ee.length-1)}function Be(r,e){var t,n,i=function(u){return u.toLowerCase()==r.toLowerCase()},o=(n=(t=e==null?void 0:e.customProperties)===null||t===void 0?void 0:t.findIndex(i))!==null&&n!==void 0?n:-1;return o!=-1?-o-1:at.findIndex(i)}function qe(r,e,t){if(t<e)return 0;var n=e+~~((t-e)/2),i=Ee[n],o=Ee[n+1],u=o?o[0]:1/0;return r<i[0]?qe(r,e,n-1):r>=u?qe(r,n+1,t):i[1]}V();var Ke=12,ct=function(){function r(e,t){this.root=e,this.prefix=t}return r.prototype.children=function(){var e,t,n,i,o,u,a,s,c,f,l,h,p,w,m,g,C,_;return(0,T.__generator)(this,function(k){switch(k.label){case 0:if(e=this.root,e.type!="internal")return[3,9];t=function(v){var S,P,W,ue,G,$,he,K,pe,le,X,se;return(0,T.__generator)(this,function(Q){switch(Q.label){case 0:if(S=e.children[v],!ne(v))return[3,12];if(S.type!="internal")return[3,9];P=S,W=function(ee){var te;return(0,T.__generator)(this,function(B){switch(B.label){case 0:return te=n.prefix+v+ee,[4,{char:v+ee,traversal:function(){return new r(P.children[ee],te)}}];case 1:return B.sent(),[2]}})},Q.label=1;case 1:Q.trys.push([1,6,7,8]),ue=(X=void 0,(0,T.__values)(P.values)),G=ue.next(),Q.label=2;case 2:return G.done?[3,5]:($=G.value,[5,W($)]);case 3:Q.sent(),Q.label=4;case 4:return G=ue.next(),[3,2];case 5:return[3,8];case 6:return he=Q.sent(),X={error:he},[3,8];case 7:try{G&&!G.done&&(se=ue.return)&&se.call(ue)}finally{if(X)throw X.error}return[7];case 8:return[3,11];case 9:return K=S.entries[0].key,v=v+K[n.prefix.length+1],pe=n.prefix+v,[4,{char:v,traversal:function(){return new r(S,pe)}}];case 10:Q.sent(),Q.label=11;case 11:return[3,16];case 12:return Z(v)?[2,"continue"]:[3,13];case 13:return v?[3,14]:[2,"continue"];case 14:return le=n.prefix+v,[4,{char:v,traversal:function(){return new r(S,le)}}];case 15:Q.sent(),Q.label=16;case 16:return[2]}})},n=this,k.label=1;case 1:k.trys.push([1,6,7,8]),i=(0,T.__values)(e.values),o=i.next(),k.label=2;case 2:return o.done?[3,5]:(u=o.value,[5,t(u)]);case 3:k.sent(),k.label=4;case 4:return o=i.next(),[3,2];case 5:return[3,8];case 6:return a=k.sent(),m={error:a},[3,8];case 7:try{o&&!o.done&&(g=i.return)&&g.call(i)}finally{if(m)throw m.error}return[7];case 8:return[2];case 9:s=this.prefix,c=e.entries.filter(function(v){return v.key!=s&&s.length<v.key.length}),f=function(v){var S;return(0,T.__generator)(this,function(P){switch(P.label){case 0:return S=v[s.length],ne(S)&&(S=S+v[s.length+1]),[4,{char:S,traversal:function(){return new r(e,s+S)}}];case 1:return P.sent(),[2]}})},k.label=10;case 10:k.trys.push([10,15,16,17]),l=(0,T.__values)(c),h=l.next(),k.label=11;case 11:return h.done?[3,14]:(p=h.value.key,[5,f(p)]);case 12:k.sent(),k.label=13;case 13:return h=l.next(),[3,11];case 14:return[3,17];case 15:return w=k.sent(),C={error:w},[3,17];case 16:try{h&&!h.done&&(_=l.return)&&_.call(l)}finally{if(C)throw C.error}return[7];case 17:return[2]}})},Object.defineProperty(r.prototype,"entries",{get:function(){if(this.root.type=="leaf"){var e=this.prefix,t=this.root.entries.filter(function(i){return i.key==e});return t.map(function(i){return i.content})}else{var n=this.root.children[H];return n&&n.type=="leaf"?n.entries.map(function(i){return i.content}):[]}},enumerable:!1,configurable:!0}),r}(),ft=function(){function r(e,t){t===void 0&&(t={}),this.languageUsesCasing=t.languageUsesCasing,this.applyCasing=t.applyCasing,this._trie=new pt(e.root,e.totalWeight,t.searchTermToKey||vt),this.breakWords=t.wordBreaker||fe,this.punctuation=t.punctuation}return r.prototype.configure=function(e){var t;return this.configuration={leftContextCodePoints:e.maxLeftContextCodePoints,rightContextCodePoints:(t=e.maxRightContextCodePoints)!==null&&t!==void 0?t:0}},r.prototype.toKey=function(e){return this._trie.toKey(e)},r.prototype.predict=function(e,t){if(!e.insert&&!t.left&&!t.right&&t.startOfBuffer&&t.endOfBuffer)return u(this._trie.firstN(Ke).map(function(a){var s=a.text,c=a.p;return{transform:{insert:s,deleteLeft:0},displayAs:s,p:c}}));var n=Y(e,t),i=e.deleteLeft-e.insert.kmwLength(),o=ye(this.breakWords,n);return u(this._trie.lookup(o).map(function(a){var s=a.text,c=a.p;return d({insert:s,deleteLeft:i+o.kmwLength()},c)}));function u(a){var s,c,f=[];try{for(var l=(0,T.__values)(a),h=l.next();!h.done;h=l.next()){var p=h.value;f.push({sample:p,p:p.p})}}catch(w){s={error:w}}finally{try{h&&!h.done&&(c=l.return)&&c.call(l)}finally{if(s)throw s.error}}return f}},Object.defineProperty(r.prototype,"wordbreaker",{get:function(){return this.breakWords},enumerable:!1,configurable:!0}),r.prototype.traverseFromRoot=function(){return new ct(this._trie.root,"")},r}(),ht=ft,pt=function(){function r(e,t,n){this.root=e,this.toKey=n,this.totalWeight=t}return r.prototype.lookup=function(e){var t=this.toKey(e),n=Ve(this.root,t);return n===null?[]:Ge(n,t,this.totalWeight)},r.prototype.firstN=function(e){return Ge(this.root,"",this.totalWeight,e)},r}();function Ve(r,e,t){if(t===void 0&&(t=0),r.type==="leaf"||t===e.length)return r;var n=e[t];return r.children[n]?Ve(r.children[n],e,t+1):null}function Ge(r,e,t,n){var i,o;n===void 0&&(n=Ke);var u=new b(function(g,C){return(C?C.weight:0)-(g?g.weight:0)}),a=[];if(r.type==="leaf")try{for(var s=(0,T.__values)(r.entries),c=s.next();!c.done;c=s.next()){var f=c.value;if(f.key.indexOf(e)==0){var l=f.content,h=f.weight;if(a.push({text:l,p:h/t}),a.length>=n)return a}}}catch(g){i={error:g}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}else{u.enqueue(r);for(var p=void 0,w=function(){if(dt(p))if(p.type==="leaf")u.enqueueAll(p.entries);else{var g=p;u.enqueueAll(p.values.map(function(C){return g.children[C]}))}else if(a.push({text:p.content,p:p.weight/t}),a.length>=n)return{value:a}};p=u.dequeue();){var m=w();if(typeof m=="object")return m.value}}return a}function dt(r){return"type"in r}function vt(r){return r.normalize("NFD").replace(/[\\u0300-\\u036f]/g,"").toLowerCase()}var gt=function(){function r(e){e=e||{},this._futureSuggestions=e.futureSuggestions?e.futureSuggestions.slice():[],e.punctuation&&(this.punctuation=e.punctuation)}return r.prototype.configure=function(e){return this.configuration={leftContextCodePoints:e.maxLeftContextCodePoints,rightContextCodePoints:e.maxRightContextCodePoints},this.configuration},r.prototype.predict=function(e,t,n){var i=function(u){var a,s,c=[];try{for(var f=(0,T.__values)(u),l=f.next();!l.done;l=f.next()){var h=l.value;c.push({sample:h,p:1})}}catch(p){a={error:p}}finally{try{l&&!l.done&&(s=f.return)&&s.call(f)}finally{if(a)throw a.error}}return c};if(n)return i(n);var o=this._futureSuggestions.shift();return o?i(o):[]},r}(),yt=gt,Le={};R(Le,{ClassicalDistanceCalculation:function(){return Ne},ContextTracker:function(){return Ye},QUEUE_NODE_COMPARATOR:function(){return Ce},SearchNode:function(){return He},SearchResult:function(){return Xe},SearchSpace:function(){return ie},TrackedContextState:function(){return be},TrackedContextSuggestion:function(){return wt},TrackedContextToken:function(){return ae}});var Ne=function(){function r(e){if(this.diagonalWidth=2,this.inputSequence=[],this.matchSequence=[],e){var t=e.resolvedDistances.length;this.resolvedDistances=Array(t);for(var n=0;n<t;n++)this.resolvedDistances[n]=e.resolvedDistances[n].slice(0);this.inputSequence=e.inputSequence.slice(0),this.matchSequence=e.matchSequence.slice(0),this.diagonalWidth=e.diagonalWidth}else this.resolvedDistances=[]}return r.prototype.getTrueIndex=function(e,t,n){var i={row:e,col:t-e+n,sparse:!1};return(i.col<0||i.col>2*n)&&(i.sparse=!0),i},r.prototype.getCostAt=function(e,t,n){if(n===void 0&&(n=this.diagonalWidth),e<0||t<0)return e==-1&&t>=-1?t+1:t==-1&&e>=-1?e+1:Number.MAX_VALUE;var i=this.getTrueIndex(e,t,n);return i.sparse?Number.MAX_VALUE:this.resolvedDistances[i.row][i.col]},r.prototype.getFinalCost=function(){for(var e=this,t=e.getHeuristicFinalCost();t>e.diagonalWidth;)e=e.increaseMaxDistance(),t=e.getHeuristicFinalCost();return t},r.prototype.getHeuristicFinalCost=function(){return this.getCostAt(this.inputSequence.length-1,this.matchSequence.length-1)},r.prototype.hasFinalCostWithin=function(e){var t=this,n=t.getHeuristicFinalCost(),i=this.diagonalWidth;do{if(n<=e)return!0;if(i<e)t=t.increaseMaxDistance(),i++,n=t.getHeuristicFinalCost();else break}while(!0);return!1},r.prototype.editPath=function(e,t){e===void 0&&(e=this.inputSequence.length-1),t===void 0&&(t=this.matchSequence.length-1);var n=this.getCostAt(e,t),i=null,o=null,u=this.getCostAt(e,t-1),a=this.getCostAt(e-1,t),s=this.getCostAt(e-1,t-1),c=(0,T.__read)(r.getTransposeParent(this,e,t),2),f=c[0],l=c[1];if(f>=0&&l>=0){var h=1;if(i=["transpose-start"],f!=e-1){var p=e-f-1;i=i.concat(Array(p).fill("transpose-delete")),h+=p}else{var p=t-l-1;i=i.concat(Array(p).fill("transpose-insert")),h+=p}i.push("transpose-end"),this.getCostAt(f-1,l-1)!=n-h&&(i=null),o=[f-1,l-1]}return i||(s==n-1?(i=["substitute"],o=[e-1,t-1]):u==n-1?(i=["insert"],o=[e,t-1]):a==n-1?(i=["delete"],o=[e-1,t]):(i=["match"],o=[e-1,t-1])),o[0]>=0&&o[1]>=0?this.editPath(o[0],o[1]).concat(i):o[0]>-1?Array(o[0]+1).fill("delete").concat(i):o[1]>-1?Array(o[1]+1).fill("insert").concat(i):i},r.getTransposeParent=function(e,t,n){if(t<0||n<0||e.inputSequence[t].key==e.matchSequence[n].key)return[-1,-1];for(var i=-1,o=t-1;o>=0;o--)if(e.inputSequence[o].key==e.matchSequence[n].key){i=o;break}for(var u=-1,o=n-1;o>=0;o--)if(e.matchSequence[o].key==e.inputSequence[t].key){u=o;break}return[i,u]},r.initialCostAt=function(e,t,n,i,o){var u=e.inputSequence[t].key==e.matchSequence[n].key?0:1,a=e.getCostAt(t-1,n-1)+u,s=i||e.getCostAt(t,n-1)+1,c=o||e.getCostAt(t-1,n)+1,f=Number.MAX_VALUE;if(t>0&&n>0){var l=(0,T.__read)(r.getTransposeParent(e,t,n),2),h=l[0],p=l[1];f=e.getCostAt(h-1,p-1)+(t-h-1)+1+(n-p-1)}return Math.min(a,c,s,f)},r.prototype.getSubset=function(e,t){var n=new r(this);if(e>this.inputSequence.length||t>this.matchSequence.length)throw"Invalid dimensions specified for trim operation";n.inputSequence.splice(e),n.matchSequence.splice(t),n.resolvedDistances.splice(e);for(var i=this.getTrueIndex(e-1,t-1,this.diagonalWidth),o=i.col;o<=2*this.diagonalWidth;o++){var u=i.row-(o-i.col);if(u<0)break;if(o<0)n.resolvedDistances[u]=Array(2*n.diagonalWidth+1).fill(Number.MAX_VALUE);else{var a=2*this.diagonalWidth-o,s=n.resolvedDistances[u].splice(0,o+1),c=Array(a).fill(Number.MAX_VALUE);n.resolvedDistances[u]=s.concat(c)}}return n},r.forDiagonalOfAxis=function(e,t,n,i){for(var o=n-t<e?n-t+e:2*e,u=t-e,a=u<0?0:u,s=a-u;s<=o;s++)i(u+s,s)},r.prototype.addInputChar=function(e){var t=new r(this),n=t.inputSequence.length;t.inputSequence.push(e);var i=Array(2*t.diagonalWidth+1).fill(Number.MAX_VALUE);return t.resolvedDistances[n]=i,t.matchSequence.length==0||r.forDiagonalOfAxis(t.diagonalWidth,n,t.matchSequence.length-1,function(o,u){i[u]=r.initialCostAt(t,n,o)}),t},r.prototype.addMatchChar=function(e){var t=new r(this),n=t.matchSequence.length;return t.matchSequence.push(e),t.inputSequence.length==0||r.forDiagonalOfAxis(t.diagonalWidth,n,t.inputSequence.length-1,function(i,o){var u=t.resolvedDistances[i];u[2*t.diagonalWidth-o]=r.initialCostAt(t,i,n)}),t},r.prototype.increaseMaxDistance=function(){var e=new r(this);if(e.diagonalWidth++,e.inputSequence.length<1||e.matchSequence.length<1)return e;function t(a,s,c,f){var l=2*(e.diagonalWidth-1),h=c.length-1;l=l<h-a?l:h-a;for(var p=0;p<=l;p++)s==c[a+p].key&&f(a+p,p)}for(var n=function(a){var s=Number.MAX_VALUE,c=a-e.diagonalWidth;if(c>=0){var f=c==0?a+2:Number.MAX_VALUE;s=r.initialCostAt(e,a,c,f,void 0);var l=s;if(c<e.matchSequence.length-1){r.propagateUpdateFrom(e,a,c+1,l+1,0);var h=a+2;if(a+2<i.inputSequence.length){var p=e.inputSequence[a+1].key;t(c+3,p,e.matchSequence,function(k,v){r.propagateUpdateFrom(e,h,k,l+v+2,v)})}}}var w=Number.MAX_VALUE;if(c=a+e.diagonalWidth,c<e.matchSequence.length){var m=a==0?c+2:Number.MAX_VALUE;o=e.getCostAt(a,c-1,i.diagonalWidth)+1,w=r.initialCostAt(e,a,c,o,m);var g=w;if(a<e.inputSequence.length-1){r.propagateUpdateFrom(e,a+1,c,g+1,2*i.diagonalWidth);var C=c+2;if(c+2<i.matchSequence.length){var _=e.matchSequence[a+1].key;t(a+3,_,e.inputSequence,function(k,v){var S=2*(e.diagonalWidth-1)-v;r.propagateUpdateFrom(e,k,C,g+v+2,S)})}}}e.resolvedDistances[a]=[s].concat(e.resolvedDistances[a],w)},i=this,o,u=0;u<e.inputSequence.length;u++)n(u);return e},r.propagateUpdateFrom=function(e,t,n,i,o){if(i<e.resolvedDistances[t][o])e.resolvedDistances[t][o]=i;else return;var u=t<e.inputSequence.length-1,a=n<e.matchSequence.length-1;if(o<2*(e.diagonalWidth-1)&&a){var s=i+1;this.propagateUpdateFrom(e,t,n+1,s,o+1)}if(o>0&&u){var s=i+1;this.propagateUpdateFrom(e,t+1,n,s,o-1)}if(u&&a){var s=i+(e.inputSequence[t+1].key==e.matchSequence[n+1].key?0:1);this.propagateUpdateFrom(e,t+1,n+1,s,o);for(var c=-1,f=t+2;f<e.inputSequence.length;f++)if(e.inputSequence[f].key==e.matchSequence[n+1].key){c=f;break}for(var l=-1,f=n+2;f<e.matchSequence.length;f++)if(e.matchSequence[f].key==e.inputSequence[t+1].key){l=f;break}if(c>0&&l>0){var h=i+(c-t-2)+1+(l-n-2);this.propagateUpdateFrom(e,c,l,h,e.diagonalWidth-1+l-c)}}},Object.defineProperty(r.prototype,"mapKey",{get:function(){var e=this.inputSequence.map(function(n){return n.key}).join(""),t=this.matchSequence.map(function(n){return n.key}).join("");return e+H+t+H+this.diagonalWidth},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastInputEntry",{get:function(){return this.inputSequence[this.inputSequence.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastMatchEntry",{get:function(){return this.matchSequence[this.matchSequence.length-1]},enumerable:!1,configurable:!0}),r.computeDistance=function(e,t,n){n===void 0&&(n=1);var i=new r;n=n||1,i.diagonalWidth=n;for(var o=0;o<e.length;o++)i=i.addInputChar(e[o]);for(var u=0;u<t.length;u++)i=i.addMatchChar(t[u]);return i},r}(),Ce=function(r,e){return r.currentCost-e.currentCost},He=function(){function r(e,t){if(this.toKey=function(i){return i},t=t||function(i){return i},e instanceof r){var n=e;this.calculation=n.calculation,this.currentTraversal=n.currentTraversal,this.priorInput=n.priorInput,this.toKey=n.toKey}else this.calculation=new Ne,this.currentTraversal=e,this.priorInput=[],this.toKey=t}return Object.defineProperty(r.prototype,"knownCost",{get:function(){return this.calculation.getHeuristicFinalCost()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputSamplingCost",{get:function(){if(this._inputCost!==void 0)return this._inputCost;var e=ie.MIN_KEYSTROKE_PROBABILITY;return this._inputCost=this.priorInput.map(function(t){return t.p>e?t.p:e}).reduce(function(t,n){return t-Math.log(n)},0),this._inputCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentCost",{get:function(){return ie.EDIT_DISTANCE_COST_SCALE*this.knownCost+this.inputSamplingCost},enumerable:!1,configurable:!0}),r.prototype.buildInsertionEdges=function(){var e,t,n=[];try{for(var i=(0,T.__values)(this.currentTraversal.children()),o=i.next();!o.done;o=i.next()){var u=o.value,a=u.traversal(),s={key:u.char,traversal:a},c=this.calculation.addMatchChar(s),f=new r(this);f.calculation=c,f.priorInput=this.priorInput,f.currentTraversal=a,n.push(f)}}catch(l){e={error:l}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.buildDeletionEdges=function(e){var t,n,i=[];try{for(var o=(0,T.__values)(e),u=o.next();!u.done;u=o.next()){var a=u.value;if(a.p<e[0].p*Math.exp(-ie.EDIT_DISTANCE_COST_SCALE))break;var s=this.calculation,c=a.sample;c.deleteLeft&&(s=s.getSubset(s.inputSequence.length-c.deleteLeft,s.matchSequence.length));var f=this.priorInput.slice(0);f.push(a);for(var l=0;l<c.insert.length;l++){var h=c.insert[l];ne(h)&&(l++,h=h+c.insert[l]);var p=this.toKey(h);p&&(s=s.addInputChar({key:p}))}var w=new r(this);w.calculation=s,w.priorInput=f,i.push(w)}}catch(m){t={error:m}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},r.prototype.buildSubstitutionEdges=function(e){var t,n,i,o,u=this.buildDeletionEdges(e),a=[];try{for(var s=(0,T.__values)(this.currentTraversal.children()),c=s.next();!c.done;c=s.next()){var f=c.value;try{for(var l=(i=void 0,(0,T.__values)(u)),h=l.next();!h.done;h=l.next()){var p=h.value,w=f.traversal(),m={key:f.char,traversal:w},g=p.calculation.addMatchChar(m),C=new r(this);C.calculation=g,C.priorInput=p.priorInput,C.currentTraversal=w,a.push(C)}}catch(_){i={error:_}}finally{try{h&&!h.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}}}catch(_){t={error:_}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return a},Object.defineProperty(r.prototype,"mapKey",{get:function(){var e=this.priorInput.map(function(n){return"+"+n.sample.insert+"-"+n.sample.deleteLeft}).join(""),t=this.calculation.matchSequence.map(function(n){return n.key}).join("");return e+H+t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isFullReplacement",{get:function(){return this.knownCost&&this.knownCost==this.priorInput.length},enumerable:!1,configurable:!0}),r}(),Re=function(){function r(e,t){if(this.processed=[],typeof e=="number"){this.index=e,this.correctionQueue=new b(Ce,t);return}else this.index=e.index,this.processed=[].concat(e.processed),this.correctionQueue=new b(e.correctionQueue)}return r.prototype.increaseMaxEditDistance=function(){var e=this.correctionQueue.toArray();e.forEach(function(t){t.calculation=t.calculation.increaseMaxDistance()}),this.correctionQueue=new b(Ce,e)},r}(),Xe=function(){function r(e){this.resultNode=e}return Object.defineProperty(r.prototype,"inputSequence",{get:function(){return this.resultNode.priorInput},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"matchSequence",{get:function(){return this.resultNode.calculation.matchSequence},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"matchString",{get:function(){return this.matchSequence.map(function(e){return e.key}).join("")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"knownCost",{get:function(){return this.resultNode.knownCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputSamplingCost",{get:function(){return this.resultNode.inputSamplingCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"totalCost",{get:function(){return this.resultNode.currentCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"finalTraversal",{get:function(){return this.resultNode.currentTraversal},enumerable:!1,configurable:!0}),r}(),ie=function(){function r(e){if(this.tierOrdering=[],this.inputSequence=[],this.minInputCost=[],this.returnedValues={},this.processedEdgeSet={},this.buildQueueSpaceComparator(),e instanceof r){this.inputSequence=[].concat(e.inputSequence),this.minInputCost=[].concat(e.minInputCost),this.rootNode=e.rootNode,this.completedPaths=[].concat(e.completedPaths),this.returnedValues=(0,T.__assign)({},e.returnedValues),this.processedEdgeSet=(0,T.__assign)({},e.processedEdgeSet),this.tierOrdering=e.tierOrdering.map(function(i){return new Re(i)}),this.selectionQueue=new b(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering);return}var t=e;if(t){if(!t.traverseFromRoot)throw"The provided model does not implement the `traverseFromRoot` function, which is needed to support robust correction searching."}else throw"The LexicalModel parameter must not be null / undefined.";this.selectionQueue=new b(this.QUEUE_SPACE_COMPARATOR),this.rootNode=new He(t.traverseFromRoot(),t.toKey?t.toKey.bind(t):null),this.completedPaths=[this.rootNode];var n=new Re(0,[this.rootNode]);this.tierOrdering.push(n),this.selectionQueue.enqueue(n)}return r.prototype.buildQueueSpaceComparator=function(){var e=this;this.QUEUE_SPACE_COMPARATOR=function(t,n){var i=t.correctionQueue.peek(),o=n.correctionQueue.peek(),u=t.index,a=n.index,s=0,c=1;if(a<u){var f=a;a=u,u=f,c=-1}for(var l=u;l<a;l++)s=s+e.minInputCost[l];return i&&o?i.currentCost-o.currentCost+c*s:o?1:-1}},r.prototype.increaseMaxEditDistance=function(){this.tierOrdering.forEach(function(e){e.increaseMaxEditDistance()})},r.prototype.addInput=function(e){this.inputSequence.push(e),this.minInputCost.push(-Math.log(e[0].p));var t=[],n=this.completedPaths.map(function(o){var u=o.buildDeletionEdges(e),a=o.buildSubstitutionEdges(e);return u.concat(a)});this.completedPaths=[],this.returnedValues={},n.forEach(function(o){t=t.concat(o)});var i=new Re(this.tierOrdering.length,t);this.tierOrdering.push(i),this.selectionQueue.enqueue(i)},r.prototype.removeLastInput=function(){},r.prototype.hasNextMatchEntry=function(){var e=this.selectionQueue.peek();return e?e.correctionQueue.count>0:!1},r.prototype.handleNextNode=function(){if(!this.hasNextMatchEntry())return{type:"none"};var e=this.selectionQueue.dequeue(),t=e.correctionQueue.dequeue(),n={type:"intermediate",cost:t.currentCost};if(this.processedEdgeSet[t.mapKey])return this.selectionQueue.enqueue(e),n;this.processedEdgeSet[t.mapKey]=!0;var i=!1;if(t.knownCost>2)return n;t.knownCost==2&&(i=!0);for(var o=0,u=0;u<=e.index;u++)o+=this.minInputCost[u];if(t.currentCost>o+2.5*r.EDIT_DISTANCE_COST_SCALE)return n;if(!i){var a=t.buildInsertionEdges();e.correctionQueue.enqueueAll(a)}if(e.index==this.tierOrdering.length-1)return this.completedPaths.push(t),this.selectionQueue.enqueue(e),{type:"complete",cost:t.currentCost,finalNode:t};var s=this.tierOrdering[e.index+1],c=s.index,f=[];i||(f=t.buildDeletionEdges(this.inputSequence[c-1]));var l=t.buildSubstitutionEdges(this.inputSequence[c-1]);return s.correctionQueue.enqueueAll(f.concat(l)),this.selectionQueue=new b(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering),n},r.prototype.getBestMatches=function(e){var t,n,i,o,u,a,s,c,f,l,h,p,w,m,g,C;return(0,T.__generator)(this,function(_){switch(_.label){case 0:if(t=this,n={},e==0?i=1/0:e==null||Number.isNaN(e)?i=r.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL:i=e,o=function(){function k(v,S){this.largestIntervals=[0],this.loopStart=this.start=Date.now(),this.maxExecutionTime=v,this.maxTrueTime=S}return k.prototype.startLoop=function(){this.loopStart=Date.now()},k.prototype.markIteration=function(){var v=Date.now(),S=v-this.loopStart;this.executionTime+=S,S&&S>this.largestIntervals[0]&&(this.largestIntervals.length>2?this.largestIntervals[0]=S:this.largestIntervals.push(S),this.largestIntervals.sort(),this.updateOutliers())},k.prototype.updateOutliers=function(){this.largestIntervals.length>2&&this.largestIntervals[2]>=2*(this.largestIntervals[0]+this.largestIntervals[1])&&(this.executionTime-=this.largestIntervals[2],this.largestIntervals.pop())},k.prototype.shouldTimeout=function(){var v=Date.now();return v-this.start>this.maxTrueTime?!0:this.executionTime>this.maxExecutionTime},k.prototype.resetOutlierCheck=function(){this.largestIntervals=[]},k}(),u=function(){function k(){this.currentCost=Number.MIN_SAFE_INTEGER,this.entries=[]}return k.prototype.checkAndAdd=function(v){var S=null;v.currentCost>this.currentCost&&(S=this.tryFinalize(),this.currentCost=v.currentCost);var P=v.calculation.matchSequence.map(function(W){return W.key}).join("");return t.returnedValues[P]||(t.returnedValues[P]=v),n[P]||(this.entries.push(new Xe(v)),n[P]=v),S},k.prototype.tryFinalize=function(){var v=null;return this.entries.length>0&&(v=this.entries,this.entries=[]),v},k}(),a=new u,s=new o(i*1.5,i),c=Object.values(this.returnedValues),!(c.length>0))return[3,6];f=new b(Ce,c),s.startLoop(),_.label=1;case 1:return f.count>0?(l=f.dequeue(),l.isFullReplacement?[3,1]:(h=a.checkAndAdd(l),s.markIteration(),h?[4,h]:[3,3])):[3,4];case 2:_.sent(),_.label=3;case 3:return[3,1];case 4:return p=a.tryFinalize(),p?[4,p]:[3,6];case 5:_.sent(),_.label=6;case 6:s.resetOutlierCheck(),s.startLoop(),w=!1,_.label=7;case 7:m=void 0;do m=this.handleNextNode(),s.markIteration(),s.shouldTimeout()&&(w=!0);while(!w&&m.type=="intermediate");if(g=void 0,m.type=="none")return[3,10];if(m.type=="complete"){if(m.finalNode.isFullReplacement)return[3,10];g=a.checkAndAdd(m.finalNode)}return g?[4,g]:[3,9];case 8:_.sent(),_.label=9;case 9:if(!w&&this.hasNextMatchEntry())return[3,7];_.label=10;case 10:return C=a.tryFinalize(),C?[4,C]:[3,12];case 11:_.sent(),_.label=12;case 12:return[2,null]}})},r.EDIT_DISTANCE_COST_SCALE=5,r.MIN_KEYSTROKE_PROBABILITY=1e-4,r.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL=33,r}(),mt=function(){function r(){}return r.isWhitespace=function(e){var t=/^[\\u0009\\u000A\\u000D\\u0020\\u00a0\\u1680\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u200b\\u2028\\u2029\\u202f\\u205f\\u3000]+$/i;return e.insert.match(t)!=null},r.isBackspace=function(e){return e.insert==""&&e.deleteLeft>0&&!e.deleteRight},r.isEmpty=function(e){return e.insert==""&&e.deleteLeft==0&&!e.deleteRight},r}(),oe=mt;function ze(r,e){for(var t=[],n=0;n<r.kmwLength();n++){var i=r.kmwCharAt(n),o={insert:i,deleteLeft:0,id:e};t.push(o)}return t}var wt=function(){function r(){}return r}(),ae=function(){function r(){this.transformDistributions=[],this.activeReplacementId=-1}return Object.defineProperty(r.prototype,"currentText",{get:function(){return this.replacementText===void 0||this.replacementText===null?this.raw:this.replacementText},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"replacement",{get:function(){var e=this.activeReplacementId;return this.replacements.find(function(t){return t.suggestion.id==e})},enumerable:!1,configurable:!0}),r.prototype.revert=function(){delete this.activeReplacementId},r}(),be=function(){function r(e){if(this.searchSpace=[],e instanceof r){var t=e;this.tokens=t.tokens.map(function(i){var o=new ae;return o.raw=i.raw,o.replacements=[].concat(i.replacements),o.activeReplacementId=i.activeReplacementId,o.transformDistributions=[].concat(i.transformDistributions),i.replacementText&&(o.replacementText=i.replacementText),o}),this.indexOffset=0;var n=this.model=e.model;this.taggedContext=e.taggedContext,n!=null&&n.traverseFromRoot&&(this.searchSpace=e.searchSpace.map(function(i){return new ie(i)}))}else{var n=e;this.tokens=[],this.indexOffset=Number.MIN_SAFE_INTEGER,this.model=n,n&&n.traverseFromRoot&&(this.searchSpace=[new ie(n)])}}return Object.defineProperty(r.prototype,"head",{get:function(){return this.tokens[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tail",{get:function(){return this.tokens[this.tokens.length-1]},enumerable:!1,configurable:!0}),r.prototype.popHead=function(){this.tokens.splice(0,2),this.indexOffset-=1},r.prototype.pushTail=function(e){this.model&&this.model.traverseFromRoot?this.searchSpace=[new ie(this.model)]:this.searchSpace=[],this.tokens.push(e);var t=this;t.searchSpace.length>0&&e.transformDistributions.forEach(function(n){return t.searchSpace[0].addInput(n)})},r.prototype.pushWhitespaceToTail=function(e){e===void 0&&(e=null);var t=new ae;t.transformDistributions=e?[e]:[],t.raw=null,this.tokens.push(t)},r.prototype.replaceTailForBackspace=function(e,t){this.tokens.pop();var n=ze(e,t).map(function(o){return[{sample:o,p:1}]}),i=new ae;i.raw=e,i.transformDistributions=n,this.pushTail(i)},r.prototype.updateTail=function(e,t){var n=this.tail;t=t||(t===""?"":n.raw),e&&e.length>0&&(n.transformDistributions.push(e),this.searchSpace&&this.searchSpace.forEach(function(i){return i.addInput(e)})),n.raw=t},r.prototype.toRawTokenization=function(){var e,t,n=[];try{for(var i=(0,T.__values)(this.tokens),o=i.next();!o.done;o=i.next()){var u=o.value;u.currentText!==null&&n.push(u.currentText)}}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r}(),St=function(){function r(e){e===void 0&&(e=r.DEFAULT_ARRAY_SIZE),this.currentHead=0,this.currentTail=0,this.circle=Array(e)}return Object.defineProperty(r.prototype,"count",{get:function(){var e=this.currentHead-this.currentTail;return e<0&&(e=e+this.circle.length),e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxCount",{get:function(){return this.circle.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"oldest",{get:function(){if(this.count!=0)return this.item(0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"newest",{get:function(){if(this.count!=0)return this.item(this.count-1)},enumerable:!1,configurable:!0}),r.prototype.enqueue=function(e){var t=null,n=(this.currentHead+1)%this.maxCount;return n==this.currentTail&&(t=this.circle[this.currentTail],this.currentTail=(this.currentTail+1)%this.maxCount),this.circle[this.currentHead]=e,this.currentHead=n,t},r.prototype.dequeue=function(){if(this.currentTail==this.currentHead)return null;var e=this.circle[this.currentTail];return this.currentTail=(this.currentTail+1)%this.maxCount,e},r.prototype.popNewest=function(){if(this.currentTail==this.currentHead)return null;var e=this.circle[this.currentHead];return this.currentHead=(this.currentHead-1+this.maxCount)%this.maxCount,e},r.prototype.item=function(e){if(e>=this.count)throw"Invalid array index";var t=(this.currentTail+e)%this.maxCount;return this.circle[t]},r.DEFAULT_ARRAY_SIZE=5,r}(),Ye=function(r){(0,T.__extends)(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.attemptMatchContext=function(t,n,i){var o=n.toRawTokenization(),u=Ne.computeDistance(o.map(function(W){return{key:W}}),t.map(function(W){return{key:W}}),1),a=u.editPath(),s=!1,c=!1;if(a.length>1){if(a[0]=="insert"&&!(a[1]=="substitute"&&a.length==2)||a[0].indexOf("transpose")>=0)return null;a[0]=="delete"&&(s=!0)}var f=a.length-1,l=!1;if(a[f]=="delete"||a[0].indexOf("transpose")>=0||(a[f]=="insert"?c=!0:f>0&&a[f-1]=="insert"&&a[f]=="substitute"&&(c=!0,l=!0),f>0&&a[f-1]=="delete"&&a[f]=="substitute"))return null;for(var h=1;h<a.length-(l?2:1);h++)if(a[h]!="match")return null;var p;c?(l&&(n.tail.replacementText=t[t.length-2]),p=new be(n)):p=i?new be(n):n;var w=i&&Array.isArray(i),m=w?i[0].sample:null;m&&m.insert==""&&m.deleteLeft==0&&!m.deleteRight&&(m=null);var g=m&&oe.isWhitespace(m),C=m&&oe.isBackspace(m),_=t[t.length-1];function k(){g&&a[f]=="match"||(C?p.replaceTailForBackspace(_,m.id):p.updateTail(m?i:null,_))}if(a.length>1)if(s&&p.popHead(),c){var v=t[t.length-1],S=new ae;S.raw=v,g||!m?(p.pushWhitespaceToTail(i!=null?i:[]),S.transformDistributions=[]):(p.pushWhitespaceToTail(),S.transformDistributions=i?[i]:[]),p.pushTail(S)}else k();else if(a[f]=="insert"){var P=new ae;P.raw=t[0],P.transformDistributions=[i],p.pushTail(P)}else k();return p},e.modelContextState=function(t,n,i){var o=t.map(function(s){var c=new ae;return c.raw=s,c.raw?c.transformDistributions=ze(c.raw).map(function(f){return[{sample:f,p:1}]}):c.transformDistributions=[],c}),u=new be(i);for(o.length>0&&u.pushTail(o.splice(0,1)[0]);o.length>0;)u.pushWhitespaceToTail(),u.pushTail(o.splice(0,1)[0]);if(u.tokens.length==0){var a=new ae;a.raw="",u.pushTail(a)}return u},e.prototype.analyzeState=function(t,n,i){if(!t.traverseFromRoot)throw"This lexical model does not provide adequate data for correction algorithms and context reuse";var o=J(t.wordbreaker||fe,n);if(o.left.length>0)for(var u=this.count-1;u>=0;u--){var a=this.item(u),s=a.taggedContext;if(s&&i&&i.length>0){var c=Y(i[0].sample,s);if(c.left!=n.left)continue}else if((s==null?void 0:s.left)!=n.left)continue;var f=e.attemptMatchContext(o.left,this.item(u),i);if(f)return this.newest!=f&&this.newest!=a&&this.enqueue(a),f.taggedContext=n,f!=this.item(u)&&this.enqueue(f),f}var l=e.modelContextState(o.left,i,t);return l.taggedContext=n,this.enqueue(l),l},e.prototype.clearCache=function(){for(;this.count>0;)this.dequeue()},e}(St),Ct=function(){function r(e,t){this.SUGGESTION_ID_SEED=0,this.testMode=!1,this.lexicalModel=e,e.traverseFromRoot&&(this.contextTracker=new Ye),this.punctuation=r.determinePunctuationFromModel(e),this.testMode=!!t}return r.prototype.predictFromCorrections=function(e,t){var n,i,o=[],u=function(l){var h=a.lexicalModel.predict(l.sample,t),p=h.map(function(w){var m=l.sample,g=l.p;m.id!==void 0&&(w.sample.transformId=m.id);var C={sample:w.sample,p:w.p*g};return C},a);o=o.concat(p)},a=this;try{for(var s=(0,T.__values)(e),c=s.next();!c.done;c=s.next()){var f=c.value;u(f)}}catch(l){n={error:l}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o},r.prototype.predict=function(e,t){return(0,T.__awaiter)(this,void 0,void 0,function(){var n,i,o,u,a,s,c,f,l,h,p,w,K,m,g,C,_,k,v,S,P,W,ue,G,$,he,K,pe,le,X,se,Q,ee,te,B,de,_e,ke,me,Je,Fe,me,De,$e,et,ve,xe,je,tt,Ue,rt;return(0,T.__generator)(this,function(xt){if(n=[],i=this.lexicalModel,o=this.punctuation,e instanceof Array?e.length==0&&e.push({sample:{insert:"",deleteLeft:0},p:1}):e=[{sample:e,p:1}],u=e.sort(function(A,F){return F.p-A.p})[0].sample,a=oe.isWhitespace(u),s=oe.isBackspace(u),c=Y(u,t),f=this.wordbreak(c),l=null,h=[],w=null,!this.contextTracker)K=void 0,a?(K=[{sample:u,p:1}],p=u):K=e.map(function(A){var F=A.sample;return oe.isWhitespace(F)&&!a||oe.isBackspace(F)&&!s?null:A}),K=K.filter(function(A){return!!A}),h=this.predictFromCorrections(K,t);else{m=this.contextTracker.analyzeState(this.lexicalModel,t,null),w=this.contextTracker.analyzeState(this.lexicalModel,c,oe.isEmpty(u)?null:e),g=w.searchSpace[0],C=0,_=w.tokens,k=_.length,v=_.length-m.tokens.length,k==0||v>0?(C=0,oe.isWhitespace(u)&&(p=u,t=c,m=w)):v<0?C=this.wordbreak(c).kmwLength()+u.deleteLeft:C=this.wordbreak(t).kmwLength(),S=_[_.length-1],P=S.transformDistributions.length<=1,W=void 0,ue=this.testMode?0:ie.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL;try{for(G=(0,T.__values)(g.getBestMatches(ue)),$=G.next();!$.done&&(he=$.value,K=he.map(function(A){var F=A.matchString,Te={insert:F,deleteLeft:C,id:u.id},Ae=A.totalCost;return P&&(Ae*=r.SINGLE_CHAR_KEY_PROB_EXPONENT),{sample:Te,p:Math.exp(-Ae)}},this),pe=this.predictFromCorrections(K,t),pe.length>0&&W===void 0&&(W=-Math.log(K[0].p)),h=h.concat(pe),le=he[0].totalCost,!(le>=W+8));$=G.next())if(h.length>=r.MAX_SUGGESTIONS){if(le>=W+4)break;if(h.sort(function(A,F){return F.p-A.p}),h[r.MAX_SUGGESTIONS-1].p>Math.exp(-le))break}}catch(A){je={error:A}}finally{try{$&&!$.done&&(tt=G.return)&&tt.call(G)}finally{if(je)throw je.error}}}X={},se=null,i.languageUsesCasing&&(se=this.detectCurrentCasing(c)),Q=this.wordbreak(t);try{for(ee=(0,T.__values)(h),te=ee.next();!te.done;te=ee.next())B=te.value,de=B.sample.displayAs,_e=de==f,this.lexicalModel.languageUsesCasing&&(_e=_e||de==this.lexicalModel.applyCasing("lower",f)),_e?l?l.p&&B.p&&(l.p+=B.p):(ke=B.sample.transform,me={insert:f,deleteLeft:ke.deleteLeft,deleteRight:ke.deleteRight,id:ke.id},Je=d(me,B.p),l=this.toAnnotatedSuggestion(Je,"keep",U.noQuotes),l.matchesModel=!0,l.transformId=B.sample.transformId):(se&&se!="lower"&&(this.applySuggestionCasing(B.sample,Q,se),de=B.sample.displayAs),Fe=X[de],Fe?Fe.p+=B.p:X[de]=B)}catch(A){Ue={error:A}}finally{try{te&&!te.done&&(rt=ee.return)&&rt.call(ee)}finally{if(Ue)throw Ue.error}}!l&&f!=""&&(me=(0,T.__assign)({},u),De=d(me,1),De.displayAs=f,l=this.toAnnotatedSuggestion(De,"keep"),l.matchesModel=!1);for($e in X)et=X[$e],n.push(et);return n=n.sort(function(A,F){return F.p-A.p}),ve=n.splice(0,r.MAX_SUGGESTIONS).map(function(A){var F=A.sample;return F.p&&(F["lexical-p"]=F.p,F["correction-p"]=A.p/F.p,F.p=A.p),F}),l&&(ve=[l].concat(ve)),xe=this,ve.forEach(function(A){if(!t.right)A.transform.insert+=o.insertAfterWord;else{var F=xe.tokenize(t);F&&F.caretSplitsToken&&(A.transform.insert+=o.insertAfterWord)}if(p){var Te=ce(p,A.transform);Te.id=A.transformId;var Ae=A;Ae.transform=Te}A.id=xe.SUGGESTION_ID_SEED,xe.SUGGESTION_ID_SEED++}),w&&(w.tail.replacements=ve.map(function(A){return{suggestion:A,tokenWidth:1}})),[2,ve]})})},r.prototype.applySuggestionCasing=function(e,t,n){var i=t.kmwLength()-e.transform.deleteLeft;i>0&&(e.transform.deleteLeft+=i,e.transform.insert=t.kmwSubstr(0,i)+e.transform.insert),e.transform.insert=this.lexicalModel.applyCasing(n,e.transform.insert),e.displayAs=this.lexicalModel.applyCasing(n,e.displayAs)},r.prototype.toAnnotatedSuggestion=function(e,t,n){n===void 0&&(n=U.default);var i=U,o=i.noQuotes;return(t=="keep"||t=="revert")&&(o=i.useQuotes),{transform:e.transform,transformId:e.transformId,displayAs:i.apply(n,e.displayAs,this.punctuation,o),tag:t,p:e.p}},r.determinePunctuationFromModel=function(e){var t=_t;if(!e.punctuation)return t;var n=e.punctuation,i=n.insertAfterWord;i!==""&&!i&&(i=t.insertAfterWord);var o=n.quotesForKeepSuggestion;o||(o=t.quotesForKeepSuggestion);var u=n.isRTL;return{insertAfterWord:i,quotesForKeepSuggestion:o,isRTL:u}},r.prototype.acceptSuggestion=function(e,t,n){var i=e.transform,o=t.left.kmwSubstr(-i.deleteLeft,i.deleteLeft),u=i.insert.kmwLength(),a={insert:o,deleteLeft:u},s=t;n&&(a=ce(a,n),s=Y(n,s));var c,f=this.tokenize(s);f?(f.left.length>0?c=f.left[f.left.length-1]:c="",c+=f.caretSplitsToken?f.right[0]:""):c=this.wordbreak(s);var l=d(a);l.displayAs=c;var h=this.toAnnotatedSuggestion(l,"revert");if(e.transformId!=null&&(h.transformId=-e.transformId),e.id!=null?h.id=-e.id:(h.id=-this.SUGGESTION_ID_SEED,this.SUGGESTION_ID_SEED++),this.contextTracker){var p=this.contextTracker.newest;p||(p=this.contextTracker.analyzeState(this.lexicalModel,t)),p.tail.activeReplacementId=e.id;var w=Y(e.transform,t);this.contextTracker.analyzeState(this.lexicalModel,w)}return h},r.prototype.applyReversion=function(e,t){return(0,T.__awaiter)(this,void 0,void 0,function(){var n,i,o,u,a,s;return(0,T.__generator)(this,function(c){if(n=this,i=function(){return(0,T.__awaiter)(this,void 0,void 0,function(){var f,l;return(0,T.__generator)(this,function(h){switch(h.label){case 0:return f=Y(e.transform,t),[4,n.predict({insert:"",deleteLeft:0},f)];case 1:return l=h.sent(),l.forEach(function(p){p.transformId=-e.transformId}),[2,l]}})})},!this.contextTracker)return[2,i()];for(o=!1,u=this.contextTracker.count-1;u>=0;u--)if(a=this.contextTracker.item(u),a.tail.activeReplacementId==-e.id){o=!0;break}if(!o)return[2,i()];for(;this.contextTracker.newest.tail.activeReplacementId!=-e.id;)this.contextTracker.popNewest();return this.contextTracker.newest.tail.revert(),s=this.contextTracker.newest.tail.replacements.map(function(f){return f.suggestion}),s.forEach(function(f){f.transformId=-e.transformId}),[2,s]})})},r.prototype.wordbreak=function(e){var t=this.lexicalModel;if(t.wordbreaker||!t.wordbreak){var n=t.wordbreaker||fe;return Pe(n,e)}else return t.wordbreak(e)},r.prototype.tokenize=function(e){var t=this.lexicalModel;return t.wordbreaker?J(t.wordbreaker,e):null},r.prototype.resetContext=function(e){this.contextTracker&&(this.contextTracker.clearCache(),this.contextTracker.analyzeState(this.lexicalModel,e,null))},r.prototype.detectCurrentCasing=function(e){var t,n=this.lexicalModel,i=this.wordbreak(e);if(!n.languageUsesCasing)throw"Invalid attempt to detect casing: languageUsesCasing is set to false";if(!n.applyCasing)throw"Invalid LMLayer state:  languageUsesCasing is set to true, but no applyCasing function exists";return e.casingForm=="upper"||e.casingForm=="initial"?e.casingForm:n.applyCasing("lower",i)==i?"lower":n.applyCasing("upper",i)==i?i.kmwLength()>1?"upper":"initial":n.applyCasing("initial",i)==i?"initial":(t=e.casingForm)!==null&&t!==void 0?t:null},r.MAX_SUGGESTIONS=12,r.SINGLE_CHAR_KEY_PROB_EXPONENT=16,r}(),bt=Ct,_t={quotesForKeepSuggestion:{open:"\\u201C",close:"\\u201D"},insertAfterWord:" "};V();var kt=function(){function r(e){e===void 0&&(e={importScripts:null,postMessage:null}),this._testMode=!1,this._postMessage=e.postMessage||postMessage,this._importScripts=e.importScripts||importScripts,this.setupConfigState()}return r.prototype.error=function(e,t){this.cast("error",{log:e,error:t&&t.stack?t.stack:void 0})},r.prototype.onMessage=function(e){var t=e.data.message;if(!t)throw new Error("Missing required \'message\' property: ".concat(e.data));var n=e.data;if(n.message=="load"){var i=n,o=!1;if(this._currentModelSource&&i.source.type==this._currentModelSource.type&&(i.source.type=="file"&&i.source.file==this._currentModelSource.file||i.source.type=="raw"&&i.source.code==this._currentModelSource.code)&&(o=!0),o){typeof console!="undefined"&&console.warn("Duplicate model load message detected - squashing!");return}else this._currentModelSource=i.source}else n.message=="unload"&&(this._currentModelSource=null);this.state.handleMessage(n)},r.prototype.cast=function(e,t){var n=this._postMessage;n((0,T.__assign)({message:e},t))},r.prototype.loadModel=function(e){try{var t=e.configure(this._platformCapabilities);t.leftContextCodePoints||(t.leftContextCodePoints=t.leftContextCodeUnits),t.rightContextCodePoints||(t.rightContextCodePoints=t.rightContextCodeUnits),t.leftContextCodePoints||(t.leftContextCodePoints=this._platformCapabilities.maxLeftContextCodePoints),t.rightContextCodePoints||(t.rightContextCodePoints=this._platformCapabilities.maxRightContextCodePoints||0),e.languageUsesCasing&&!e.applyCasing&&(e.applyCasing=y);var n=this.transitionToReadyState(e);t.wordbreaksAfterSuggestions===void 0&&(t.wordbreaksAfterSuggestions=n.punctuation.insertAfterWord!=""),this.cast("ready",{configuration:t})}catch(i){this.error("loadModel failed!",i)}},r.prototype.loadModelFile=function(e){try{this._importScripts(e)}catch(t){this.error("Error occurred when attempting to load dictionary",t)}},r.prototype.unloadModel=function(){this.transitionToLoadingState()},r.prototype.setupConfigState=function(){var e=this;this.state={name:"unconfigured",handleMessage:function(t){if(t.message!=="config")throw new Error("invalid message; expected \'config\' but got ".concat(t.message));e._platformCapabilities=t.capabilities,e._testMode=!!t.testMode,e.transitionToLoadingState()}}},r.prototype.transitionToLoadingState=function(){var e=this;this.state={name:"modelless",handleMessage:function(t){if(t.message!=="load")throw new Error("invalid message; expected \'load\' but got ".concat(t.message));if(t.source.type=="file")e.loadModelFile(t.source.file);else{var n=t.source.code,i=new Function("LMLayerWorker","models","correction","wordBreakers",n);i(e,z,Le,Me)}}}},r.prototype.transitionToReadyState=function(e){var t=this,n=new bt(e,this._testMode);return this.state={name:"ready",handleMessage:function(i){switch(i.message){case"predict":var o=i.transform,f=i.context;n.predict(o,f).then(function(l){t.cast("suggestions",{token:i.token,suggestions:l})});break;case"wordbreak":var u=Pe(e.wordbreaker||fe,i.context);t.cast("currentword",{token:i.token,word:u});break;case"unload":t.unloadModel();break;case"accept":var a=i.suggestion,f=i.context,s=i.postTransform,c=n.acceptSuggestion(a,f,s);t.cast("postaccept",{token:i.token,reversion:c});break;case"revert":var c=i.reversion,f=i.context;n.applyReversion(c,f).then(function(l){t.cast("postrevert",{token:i.token,suggestions:l})});break;case"reset-context":var f=i.context;n.resetContext(f);break;default:throw new Error("invalid message; expected one of {\'predict\', \'wordbreak\', \'accept\', \'revert\', \'reset-context\', \'unload\'} but got ".concat(i.message))}},compositor:n},n},r.install=function(e){var t=new r({postMessage:e.postMessage,importScripts:e.importScripts.bind(e)});return e.onmessage=t.onMessage.bind(t),t.self=e,e.LMLayerWorker=t,e.models=z,e.correction=Le,e.wordBreakers=Me,t},r}(),Ze=kt;typeof self!="undefined"&&"postMessage"in self&&"importScripts"in self?Ze.install(self):window.LMLayerWorker=Ze}();\n',cc="";var Sl=function(){function c(){}return c.constructInstance=function(){return new Worker(this.asBlobURI(ic))},c.asBlobURI=function(t){var e=Ht(t);e+="\n"+cc;var n=new Blob([e],{type:"text/javascript"});return URL.createObjectURL(n)},c}(),Yn=Sl;var rc=function(){function c(t,e){this.suggestions=t,this.transcriptionID=e}return c}();var Rl=function(c){(0,B.__extends)(t,c);function t(e,n,i){i===void 0&&(i=!1);var r=c.call(this)||this;r._mayPredict=!0,r._mayCorrect=!0,r._state="inactive",r.recentTranscriptions=n;var l={maxLeftContextCodePoints:64,maxRightContextCodePoints:i?0:64};return e&&(r.lmEngine=new kn(l,e)),r}return Object.defineProperty(t.prototype,"activeModel",{get:function(){return this.currentModel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isConfigured",{get:function(){return!!this.configuration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype.unloadModel=function(){this.lmEngine.unloadModel(),delete this.currentModel,delete this.configuration,this._state="inactive",this.emit("statechange","inactive")},t.prototype.loadModel=function(e){var n=this;if(!e)throw new Error("Null reference not allowed.");var i=e.path?"file":"raw",r=i=="file"?e.path:e.code;return this.currentModel=e,this.mayPredict&&(this._state="active",this.emit("statechange","active")),this.lmEngine.loadModel(r,i).then(function(l){n.configuration=l,n.mayPredict&&(n._state="configured",n.emit("statechange","configured"))}).catch(function(l){var s;l instanceof Error?s=l.message:s=String(l),console.error("Could not load model '"+e.id+"': "+s),n.currentModel=null,n._state="inactive",n.emit("statechange","inactive")})},t.prototype.invalidateContext=function(e,n){if(this.emit("invalidatesuggestions","context"),!this.currentModel||!this.configuration)return Promise.resolve([]);if(this.isActive)if(e){var i=e.buildTranscriptionFrom(e,null,!1);return this.predict_internal(i,!0,n)}else return Promise.resolve([]);else return Promise.resolve([])},t.prototype.wordbreak=function(e,n){if(!this.isActive)return null;var i=new me(T.from(e,!1),this.configuration,n);return this.lmEngine.wordbreak(i)},t.prototype.predict=function(e,n){return!this.isActive||!this.currentModel||!this.configuration?null:(this.emit("invalidatesuggestions","new"),this.predict_internal(e,!1,n))},t.prototype.applySuggestion=function(e,n,i){var r=this;if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";if(!this.isConfigured)return console.warn("Could not apply suggestion; the corresponding model has been unloaded"),null;var l=this.getPredictionState(e.transformId);if(l){var s=T.from(l.preInput,!1);s.apply(e.transform);var o=s.buildTransformFrom(n);n.apply(o),this.emit("suggestionapplied",n);var a=T.from(l.preInput,!1);a.apply(l.transform);var g=new me(l.preInput,this.configuration,i()),d=this.lmEngine.acceptSuggestion(e,g,l.transform);return d=d.then(function(F){var u={transform:l.transform,transformId:-l.token,displayAs:F.displayAs,id:F.id,tag:F.tag};return r.predictFromTarget(n,i()),u}),d}else return console.warn("Could not apply the Suggestion!"),null},t.prototype.applyReversion=function(e,n){var i=this;if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";var r=this.getPredictionState(-e.transformId);if(!r)return console.warn("Could not apply the Suggestion!"),Promise.resolve([]);var l=T.from(r.preInput,!1);l.apply(e.transform);var s=l.buildTransformFrom(n);n.apply(s);var o=this.lmEngine.revertSuggestion(e,new me(r.preInput,this.configuration,null));return o.then(function(a){var g=new rc(a,s.id);return i.emit("suggestionsready",g),i.currentPromise=null,a})},t.prototype.predictFromTarget=function(e,n){if(!e)return null;var i=e.buildTranscriptionFrom(e,null,!1);return this.predict(i,n)},t.prototype.predict_internal=function(e,n,i){var r=this;if(!e)return null;var l=new me(e.preInput,this.configuration,i);this.recordTranscription(e),n&&this.lmEngine.resetContext(l);var s=e.alternates;(!s||s.length==0)&&(s=[{sample:e.transform,p:1}]);var o=e.transform,a=this.currentPromise=this.lmEngine.predict(s,l);return a.then(function(g){if(a==r.currentPromise){var d=new rc(g,o.id);r.emit("suggestionsready",d),r.currentPromise=null}return g})},t.prototype.recordTranscription=function(e){this.recentTranscriptions.save(e)},t.prototype.getPredictionState=function(e){return this.recentTranscriptions.get(e)},t.prototype.shutdown=function(){this.lmEngine.shutdown()},Object.defineProperty(t.prototype,"isActive",{get:function(){return this.canEnable()?(this.activeModel||!1)&&this._mayPredict:(this._mayPredict=!1,!1)},enumerable:!1,configurable:!0}),t.prototype.canEnable=function(){return!!this.lmEngine},Object.defineProperty(t.prototype,"mayPredict",{get:function(){return this._mayPredict},set:function(e){if(!!this.canEnable()){var n=this._mayPredict;if(this._mayPredict=e,n!=e&&this.activeModel){var i=e?"active":"inactive";this._state=i,this.emit("statechange",i),e&&this.isConfigured&&(this._state="configured",this.emit("statechange","configured"))}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mayCorrect",{get:function(){return this._mayCorrect},set:function(e){this._mayCorrect=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordbreaksAfterSuggestions",{get:function(){return this.configuration.wordbreaksAfterSuggestions},enumerable:!1,configurable:!0}),t.prototype.tryAcceptSuggestion=function(e){return this.emit("tryaccept",e),!1},t.prototype.tryRevertSuggestion=function(){return this.emit("tryrevert"),!1},t}(f.default),wn=Rl;var Jl=10,Tn=function(){function c(){this.map=new Map}return c.prototype.get=function(t){var e=this.map.get(t);return e&&this.save(e),e},c.prototype.save=function(t){var e=t.token>=0?t.token:-t.token;this.map.delete(e),this.map.set(e,t),this.map.size>Jl&&this.map.delete(this.map.keys().next().value)},c}();var El=function(){function c(t,e,n){if(this.contextCache=new Tn,!t)throw new Error("device must be defined");n||(n=c.DEFAULT_OPTIONS),this.contextDevice=t,this.kbdProcessor=new xn(t,n),this.lngProcessor=new wn(e,this.contextCache)}return Object.defineProperty(c.prototype,"languageProcessor",{get:function(){return this.lngProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"keyboardProcessor",{get:function(){return this.kbdProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"keyboardInterface",{get:function(){return this.keyboardProcessor.keyboardInterface},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"activeKeyboard",{get:function(){return this.keyboardInterface.activeKeyboard},set:function(t){this.keyboardInterface.activeKeyboard=t,this.resetContext()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"activeModel",{get:function(){return this.languageProcessor.activeModel},enumerable:!1,configurable:!0}),c.prototype.processKeyEvent=function(t,e){var n=t.srcKeyboard&&this.activeKeyboard!=t.srcKeyboard,i=this.activeKeyboard;try{if(n&&(this.keyboardInterface.activeKeyboard=t.srcKeyboard),t.baseTranscriptionToken){var r=this.contextCache.get(t.baseTranscriptionToken);r?(!Te(r.transform)||!r.preInput.isEqual(T.from(e)))&&e.restoreTo(r.preInput):console.warn("The base context for the multitap could not be found")}return this._processKeyEvent(t,e)}finally{n&&(this.keyboardInterface.activeKeyboard=i)}},c.prototype._processKeyEvent=function(t,e){var n,i=t.device.formFactor,r=t.isSynthetic;if((i==v.FormFactor.Desktop||!this.activeKeyboard||this.activeKeyboard.usesDesktopLayoutOnDevice(t.device))&&r&&this.keyboardProcessor.selectLayer(t))return new ue;if(this.keyboardProcessor.doModifierPress(t,e,!r)&&!r)return new ue;if(this.languageProcessor.isActive){if((t.kName=="K_BKSP"||t.Lcode==h.keyCodes.K_BKSP)&&this.languageProcessor.tryRevertSuggestion())return new ue;if((t.kName=="K_SPACE"||t.Lcode==h.keyCodes.K_SPACE)&&this.languageProcessor.tryAcceptSuggestion("space"))return new ue}var l=T.from(e,!0),s=this.keyboardProcessor.layerId,o=this.keyboardProcessor.processKeystroke(t,e);t.kNextLayer&&this.keyboardProcessor.selectLayer(t);var a=h.isFrameKey(t.kName);Te((n=o==null?void 0:o.transcription)===null||n===void 0?void 0:n.transform)&&t.kNextLayer&&(a=!0);var g=o!=null;if(g){var d=a?null:this.buildAlternates(o,t,l);o.finalize(this.keyboardProcessor,e,!1),d&&d.length>0&&(o.transcription.alternates=d)}else o=new ue,o.transcription=e.buildTranscriptionFrom(e,null,!1),o.triggersDefaultCommand=!0;this.contextCache.save(o.transcription);var F=o.setStore[w.TSS_LAYER]||t.kNextLayer;this.keyboardProcessor.newLayerStore.set(F?this.keyboardProcessor.layerId:""),this.keyboardProcessor.oldLayerStore.set(F?s:"");var u=this.keyboardProcessor.processPostKeystroke(this.contextDevice,e);return u&&u.finalize(this.keyboardProcessor,e,!0),o.predictionPromise=this.languageProcessor.predict(o.transcription,this.keyboardProcessor.layerId),o.triggersDefaultCommand||e.doInputEvent(),g?o:null},c.prototype.buildAlternates=function(t,e,n){var i,r,l;if(this.languageProcessor.isActive&&!t.triggersDefaultCommand){var s=e.keyDistribution,o=new me(n,me.ENGINE_RULE_WINDOW,this.keyboardProcessor.layerId),a=o.toMock();if(this.languageProcessor.isActive&&s&&e.kbdLayer){var g=Number.MAX_VALUE,d=Pe(),F=void 0;d.performance&&d.performance.now&&(F=function(){return d.performance.now()},g=F()+16);var u=Math.exp(-5);s.sort(function(V,L){return L.p-V.p}),l=[];var I=0;try{for(var Q=(0,B.__values)(s),y=Q.next();!y.done;y=Q.next()){var U=y.value;if(U.p<u){I+=U.p;break}else if(F&&F()>=g)break;var b=T.from(a,!1),C=U.keySpec;if(!C){console.warn("Internal error:  failed to properly filter set of keys for corrections");continue}var x=this.keyboardProcessor.activeKeyboard.constructKeyEvent(C,e.device,this.keyboardProcessor.stateKeys),X=this.keyboardProcessor.processKeystroke(x,b);if(X&&!X.beep&&U.p>0){var p=X.transcription.transform;p.id=t.transcription.token,l.push({sample:p,p:U.p}),I+=U.p}}}catch(V){i={error:V}}finally{try{y&&!y.done&&(r=Q.return)&&r.call(Q)}finally{if(i)throw i.error}}l.forEach(function(V){V.p/=I})}}return l},c.prototype.resetContext=function(t){this.keyboardProcessor.resetContext(t),this.languageProcessor.invalidateContext(t,this.keyboardProcessor.layerId)},c.DEFAULT_OPTIONS={baseLayout:"us"},c}(),Dn=El;var Al=function(c){(0,B.__extends)(t,c);function t(e,n){var i=c.call(this)||this;i.initNewContext=!0,i._currentSuggestions=[],i.recentAccept=!1,i.swallowPrediction=!1,i.doRevert=!1,i.recentRevert=!1,i.doTryAccept=function(l){!i.recentAccept&&i.selected?i.accept(i.selected):i.recentAccept&&l=="space"&&(i.recentAccept=!1)},i.doTryRevert=function(){i.doRevert?(i.doRevert=!1,i.recentAccept=!1):i.recentAccept&&(i.showRevert(),i.swallowPrediction=!0)},i.invalidateSuggestions=function(l){i.initNewContext=!1,(!i.swallowPrediction||l=="context")&&(i.recentAccept=!1,i.doRevert=!1,i.recentRevert=!1,l=="context"&&(i.swallowPrediction=!1,i.initNewContext=!0)),l!="new"&&i.clearSuggestions()},i.updateSuggestions=function(l){var s,o,a=l.suggestions;i._currentSuggestions=a,i.keepSuggestion=null;try{for(var g=(0,B.__values)(a),d=g.next();!d.done;d=g.next()){var F=d.value;F.tag=="keep"&&(i.keepSuggestion=F)}}catch(u){s={error:u}}finally{try{d&&!d.done&&(o=g.return)&&o.call(g)}finally{if(s)throw s.error}}i.keepSuggestion&&i._currentSuggestions.splice(i._currentSuggestions.indexOf(i.keepSuggestion),1),i.swallowPrediction?i.swallowPrediction=!1:(i.recentAccept=!1,i.doRevert=!1,i.recentRevert=!1),i.sendUpdateEvent()},i.onModelStateChange=function(l){(l=="configured"||l=="inactive")&&i.resetContext()},i.langProcessor=e,i.kbdProcessor=n;var r=function(){return i.currentTarget&&e.state=="configured"};return i.suggestionApplier=function(l){return r()?e.applySuggestion(l,i.currentTarget,function(){return n.layerId}):null},i.suggestionReverter=function(l){r()&&e.applyReversion(l,i.currentTarget)},i.postApplicationHandler=function(){var l;n.newLayerStore.set(""),n.oldLayerStore.set(""),(l=n.processPostKeystroke(n.contextDevice,i.currentTarget))===null||l===void 0||l.finalize(n,i.currentTarget,!0)},i.connect(),i}return Object.defineProperty(t.prototype,"currentTarget",{get:function(){return this._currentTarget},enumerable:!1,configurable:!0}),t.prototype.setCurrentTarget=function(e){var n=this._currentTarget;return this._currentTarget=e,n!=e?this.resetContext():Promise.resolve([])},Object.defineProperty(t.prototype,"modelState",{get:function(){return this.langProcessor.state},enumerable:!1,configurable:!0}),t.prototype.connect=function(){this.langProcessor.addListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.addListener("suggestionsready",this.updateSuggestions),this.langProcessor.addListener("tryaccept",this.doTryAccept),this.langProcessor.addListener("tryrevert",this.doTryRevert),this.langProcessor.addListener("statechange",this.onModelStateChange),this.langProcessor.addListener("suggestionapplied",this.postApplicationHandler)},t.prototype.disconnect=function(){this.langProcessor.removeListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.removeListener("suggestionsready",this.updateSuggestions),this.langProcessor.removeListener("tryaccept",this.doTryAccept),this.langProcessor.removeListener("tryrevert",this.doTryRevert),this.langProcessor.removeListener("statechange",this.onModelStateChange),this.langProcessor.removeListener("suggestionapplied",this.postApplicationHandler),this.clearSuggestions()},Object.defineProperty(t.prototype,"currentSuggestions",{get:function(){var e=[];return this.activateKeep()&&this.keepSuggestion&&this.keepSuggestion.matchesModel?e.push(this.keepSuggestion):this.doRevert&&e.push(this.revertSuggestion),e.concat(this._currentSuggestions)},enumerable:!1,configurable:!0}),t.prototype.acceptInternal=function(e){return e?e.tag=="revert"?(this.suggestionReverter(e),null):this.suggestionApplier(e):null},t.prototype.accept=function(e){var n=this;return this.selected=null,this.doRevert=!1,this.revertAcceptancePromise=this.acceptInternal(e),this.revertAcceptancePromise?(this.revertAcceptancePromise.then(function(i){i&&(n.revertSuggestion=i)}),this.recentAccept=!0,this.recentRevert=!1,this.swallowPrediction=!0,this.revertAcceptancePromise):(e&&e.tag=="revert"&&(this.recentAccept=!1,this.recentRevert=!0),Promise.resolve(null))},t.prototype.showRevert=function(){this.doRevert=!0,this.sendUpdateEvent()},t.prototype.clearSuggestions=function(){this.updateSuggestions({suggestions:[],transcriptionID:0})},t.prototype.activateKeep=function(){return!this.recentAccept&&!this.recentRevert&&!this.initNewContext},t.prototype.sendUpdateEvent=function(){this.emit("update",this.currentSuggestions)},t.prototype.resetContext=function(){var e=this.currentTarget;return e?this.langProcessor.invalidateContext(e,this.kbdProcessor.layerId):Promise.resolve([])},t}(f.default),Mn=Al;var lc=function(){function c(t,e,n,i){this.Pelem=t,this.Peventname=e.toLowerCase(),this.Phandler=n,this.PuseCapture=i}return c.prototype.equals=function(t){return this.Pelem==t.Pelem&&this.Peventname==t.Peventname&&this.Phandler==t.Phandler&&this.PuseCapture==t.PuseCapture},c}(),Xe=function(){function c(){this.domEvents=[]}return c.prototype.attachDOMEvent=function(t,e,n,i){this.detachDOMEvent(t,e,n,i),t.addEventListener(e,n,!!i);var r=new lc(t,e,n,i);this.domEvents.push(r)},c.prototype.detachDOMEvent=function(t,e,n,i){t.removeEventListener(e,n,i);for(var r=new lc(t,e,n,i),l=0;l<this.domEvents.length;l++)if(this.domEvents[l].equals(r)){this.domEvents.splice(l,1);break}},c.prototype.shutdown=function(){for(var t=0,e=this.domEvents;t<e.length;t++){var n=e[t];this.detachDOMEvent(n.Pelem,n.Peventname,n.Phandler,n.PuseCapture)}},c}();var Nt=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this)||this;return e instanceof f.default?(e.on=n.listenerRegistrationSpy("listeneradded",e,e.on),e.addListener=n.listenerRegistrationSpy("listeneradded",e,e.addListener),e.off=n.listenerRegistrationSpy("listenerremoved",e,e.off),e.removeListener=n.listenerRegistrationSpy("listenerremoved",e,e.off)):(e.addEventListener=n.listenerRegistrationSpy("listeneradded",e,e.addEventListener),e.removeEventListener=n.listenerRegistrationSpy("listenerremoved",e,e.removeEventListener)),n}return t.prototype.listenerRegistrationSpy=function(e,n,i){var r=this;return function(l,s){var o=i.apply(n,[l,s]);return r.emit(e,l),o}},t}(f.default);var kt=function(){function c(){this.events={},this.currentEvents=[]}return c.prototype.addEventListener=function(t,e){return this._removeEventListener(t,e),this.events[t].push(e),!0},c.prototype.removeEventListener=function(t,e){return this._removeEventListener(t,e)},c.prototype._removeEventListener=function(t,e){typeof this.events[t]=="undefined"&&(this.events[t]=[]);for(var n=0;n<this.events[t].length;n++)if(this.events[t][n]==e)return this.events[t].splice(n,1),!0;return!1},c.prototype.callEvent=function(t,e){if(typeof this.events[t]=="undefined")return!0;if(this.currentEvents.indexOf(t)!=-1)return!1;this.currentEvents.push(t);for(var n=0;n<this.events[t].length;n++){var i=this.events[t][n],r=!1;try{r=i(e)}catch(l){console.error(l),r=!1}if(r===!1)return this.currentEvents.pop(),!1}return this.currentEvents.pop(),!0},c.prototype.listenerCount=function(t){var e=this.events[t];return e?e.length:0},c.prototype.shutdown=function(){this.events={}},c}();var Wl=function(){function c(t){t===void 0&&(t=!1),this.fileLocal=t}return c.prototype.request=function(t){var e=new J,n=window.setTimeout(function(){e.reject(new Error(Oi))},1e4),i="&timerid="+n,r=t+i,l=document.createElement("script");l.onload=function(s){window.clearTimeout(n),e.isResolved||e.reject(new Error(_i))},l.onerror=function(s,o,a,g,d){window.clearTimeout(n);var F=Rn;d&&(F=F+": "+d.message),e.reject(new Error(F))},this.fileLocal?l.src=t:l.src=r;try{document.body.appendChild(l)}catch(s){document.getElementsByTagName("head")[0].appendChild(l)}return e.finally(function(){clearTimeout(n)}),{promise:e,queryId:n}},c}(),sc=Wl;function Hl(){return typeof window.KeymanWeb_BaseLayout!="undefined"?window.KeymanWeb_BaseLayout:"us"}var Nl=function(){function c(t,e,n,i){var r=this;this.legacyAPIEvents=new kt,this.keyEventListener=function(s,o){var a,g=r.contextManager.activeTarget;if(!r.contextManager.activeKeyboard||!g){o&&o(null,null);return}if(r.keyEventRefocus&&r.keyEventRefocus(),g.invalidateSelection(),g.deadkeys().deleteMatched(),s.isSynthetic){var d=r.osk.vkbd.layerId;d&&d!=r.core.keyboardProcessor.layerId&&(r.core.keyboardProcessor.layerId=d)}var F=r.core.processKeyEvent(s,g);F&&((a=F.transcription)===null||a===void 0?void 0:a.transform)&&r.config.onRuleFinalization(F,r.contextManager.activeTarget),o&&o(F,null)},this.config=e,this.contextManager=n;var l=i(this);l.baseLayout=Hl(),this.interface=l.keyboardInterface,this.core=new Dn(e.hostDevice,t,l),this.core.languageProcessor.on("statechange",function(s){var o,a;(o=r.osk)===null||o===void 0||o.bannerController.selectBanner(s),(a=r.osk)===null||a===void 0||a.refreshLayout()}),this.core.keyboardProcessor.on("statekeychange",function(s){var o,a;(a=(o=r.osk)===null||o===void 0?void 0:o.vkbd)===null||a===void 0||a.updateStateKeys(s)}),this.contextManager.on("beforekeyboardchange",function(s){r.legacyAPIEvents.callEvent("beforekeyboardchange",{internalName:s==null?void 0:s.id,languageCode:s==null?void 0:s.langId})}),this.contextManager.on("keyboardchange",function(s){s||r.osk.startHide(!1);var o=function(){var a,g;r.refreshModel(),r.core.activeKeyboard=s==null?void 0:s.keyboard,r.legacyAPIEvents.callEvent("keyboardchange",{internalName:(a=s==null?void 0:s.metadata.id)!==null&&a!==void 0?a:"",languageCode:(g=s==null?void 0:s.metadata.langId)!==null&&g!==void 0?g:""})};r.osk?r.osk.batchLayoutAfter(function(){o(),r.osk.activeKeyboard=s,r.contextManager.resetContext(),r.osk.present()}):(o(),r.contextManager.resetContext())}),this.contextManager.on("keyboardasyncload",function(s){var o,a;r.config.hostDevice.touchable&&((o=r.osk)===null||o===void 0?void 0:o.activationModel)&&(r.osk.activationModel.enabled=!0),(a=r.osk)===null||a===void 0||a.startHide(!1)})}return c.prototype.init=function(t){return(0,B.__awaiter)(this,void 0,void 0,function(){var e,n,i,r=this;return(0,B.__generator)(this,function(l){return e=this.config,e.deferForInitialization.isResolved?[2,Promise.resolve()]:(e.initialize(t),String.kmwEnableSupplementaryPlane(!0),n=new tc(this.interface,e.applyCacheBusting),this.keyboardRequisitioner=new An(n,new sc,this.config.paths),this.modelCache=new Wn,i=this.keyboardRequisitioner.cache,this.contextManager.configure({resetContext:function(s){r.osk?r.osk.batchLayoutAfter(function(){r.core.resetContext(s)}):r.core.resetContext(s)},predictionContext:new Mn(this.core.languageProcessor,this.core.keyboardProcessor),keyboardCache:this.keyboardRequisitioner.cache}),this.config.on("spacebartext",function(){var s;(s=r.osk)===null||s===void 0||s.refreshLayout()}),i.on("stubadded",function(s){var o=function(){r.legacyAPIEvents.callEvent("keyboardregistered",{internalName:s.KI,language:s.KL,keyboardName:s.KN,languageCode:s.KLC,package:s.KP}),r.config.activateFirstKeyboard&&r.keyboardRequisitioner.cache.defaultStub==s&&r.contextManager.activateKeyboard(s.id,s.langId,!0)};r.config.deferForInitialization.isResolved?o():r.config.deferForInitialization.then(o)}),i.on("keyboardadded",function(s){var o=function(){r.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:s.id})};r.config.deferForInitialization.isResolved?o():r.config.deferForInitialization.then(o)}),this.keyboardRequisitioner.cache.on("keyboardadded",function(s){r.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:s.id})}),[2])})})},Object.defineProperty(c.prototype,"build",{get:function(){return Number.parseInt(Re.VERSION_PATCH,10)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"version",{get:function(){return Re.VERSION_RELEASE},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"hardKeyboard",{get:function(){return this._hardKeyboard},set:function(t){this._hardKeyboard&&this._hardKeyboard.off("keyevent",this.keyEventListener),this._hardKeyboard=t,t.on("keyevent",this.keyEventListener)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"osk",{get:function(){return this._osk},set:function(t){this._osk&&(this._osk.off("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=this.osk.layerChangeHandler),this._osk=t,t&&(this.contextManager.activeKeyboard&&(t.activeKeyboard=this.contextManager.activeKeyboard),t.on("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=t.layerChangeHandler)},enumerable:!1,configurable:!0}),c.prototype.getDebugInfo=function(){var t,e,n,i,r,l,s,o,a,g,d,F,u,I,Q=(t=this.contextManager)===null||t===void 0?void 0:t.activeKeyboard,y={configReport:(e=this.config)===null||e===void 0?void 0:e.debugReport(),keyboard:{id:Ve((i=(n=Q==null?void 0:Q.metadata)===null||n===void 0?void 0:n.id)!==null&&i!==void 0?i:""),langId:((r=Q==null?void 0:Q.metadata)===null||r===void 0?void 0:r.langId)||"",version:(s=(l=Q==null?void 0:Q.keyboard)===null||l===void 0?void 0:l.version)!==null&&s!==void 0?s:""},model:{id:((a=(o=this.core)===null||o===void 0?void 0:o.activeModel)===null||a===void 0?void 0:a.id)||""},osk:{banner:(F=(d=(g=this.osk)===null||g===void 0?void 0:g.banner)===null||d===void 0?void 0:d.banner.type)!==null&&F!==void 0?F:"",layer:((I=(u=this.osk)===null||u===void 0?void 0:u.vkbd)===null||I===void 0?void 0:I.layerId)||""}};return y},c.prototype.refreshModel=function(){var t=this.contextManager.activeKeyboard,e=this.modelCache.modelForLanguage(t==null?void 0:t.metadata.langId);return this.core.activeModel!=e&&(this.core.activeModel&&this.core.languageProcessor.unloadModel(),e)?this.core.languageProcessor.loadModel(e).then(function(){return e}):Promise.resolve(e)},c.prototype.addEventListener=function(t,e){this.legacyAPIEvents.addEventListener(t,e)},c.prototype.removeEventListener=function(t,e){this.legacyAPIEvents.removeEventListener(t,e)},c.prototype.shutdown=function(){var t;this.legacyAPIEvents.shutdown(),(t=this.osk)===null||t===void 0||t.shutdown()},c.prototype.addModel=function(t){var e;this.modelCache.register(t);var n=(e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata;return n&&t.languages.indexOf(n.langId)!=-1?this.refreshModel().then(function(){}):Promise.resolve()},c.prototype.removeModel=function(t){this.modelCache.unregister(t),this.core.activeModel&&this.core.activeModel.id==t&&this.core.languageProcessor.unloadModel()},c.prototype.setActiveKeyboard=function(t,e){return(0,B.__awaiter)(this,void 0,void 0,function(){return(0,B.__generator)(this,function(n){return[2,this.contextManager.activateKeyboard(t,e,!0)]})})},c.prototype.getActiveKeyboard=function(){var t,e;return(e=(t=this.contextManager.activeKeyboard)===null||t===void 0?void 0:t.metadata.id)!==null&&e!==void 0?e:""},c.prototype.getActiveLanguage=function(t){var e,n,i,r=(e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata;return t?(i=r==null?void 0:r.langName)!==null&&i!==void 0?i:"":(n=r==null?void 0:r.langId)!==null&&n!==void 0?n:""},c.prototype.isChiral=function(t){var e;if(t){if(typeof t=="string"){var n=this.keyboardRequisitioner.cache.getKeyboard(t);if(n)t=n;else throw new Error("Keyboard '".concat(t,"' has not been loaded."))}e=t}else e=this.core.activeKeyboard;return e.isChiral},c.prototype.resetContext=function(){this.contextManager.resetContext()},c.prototype.setNumericLayer=function(){this.core.keyboardProcessor.setNumericLayer(this.config.softDevice)},c}(),zn=Nl;var Qe=function(){function c(t){var e=N("div");e.id=c.BANNER_ID,e.className=c.BANNER_CLASS,this.div=e,this.height=t,this.update()}return Object.defineProperty(c.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t>0?t:0,this.update()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this.update()},enumerable:!1,configurable:!0}),c.prototype.update=function(){var t=this.div.style,e=t.height,n=t.display;return this._height>0?(t.height=this._height+"px",t.display="block"):(t.height="0px",t.display="none"),e!==t.height||n!==t.display},c.prototype.appendStyleSheet=function(){},c.prototype.getDiv=function(){return this.div},c.prototype.configureForKeyboard=function(t,e){},c.prototype.shutdown=function(){},c.DEFAULT_HEIGHT=37,c.BANNER_CLASS="kmw-banner-bar",c.BANNER_ID="kmw-banner-bar",c}();var Z=function(){function c(t){var e=typeof t=="string"?c.parseLengthStyle(t):t;this.val=e.val,this.absolute=e.absolute,e.special&&(this.special=e.special)}return Object.defineProperty(c.prototype,"styleString",{get:function(){return this.absolute?this.val+"px":this.special?this.val+this.special:this.val*100+"%"},enumerable:!1,configurable:!0}),c.prototype.scaledBy=function(t){return new c({val:t*this.val,absolute:this.absolute})},c.inPixels=function(t){return new c({val:t,absolute:!0})},c.inPercent=function(t){return new c({val:t/100,absolute:!1})},c.forScalar=function(t){return new c({val:t,absolute:!1})},c.special=function(t,e){return new c({val:t,absolute:!1,special:e})},c.parseLengthStyle=function(t){if(t=="")return oc;var e=parseFloat(t);return isNaN(e)?(console.error("Could not properly parse specified length style info: '"+t+"'."),oc):t.indexOf("px")!=-1?{val:e,absolute:!0}:t.indexOf("pt")!=-1?{val:4*e/3,absolute:!0}:t.indexOf("%")!=-1?{val:e/100,absolute:!1}:t.indexOf("rem")!=-1?{val:e,absolute:!1,special:"rem"}:t.indexOf("em")!=-1?{val:e,absolute:!1,special:"em"}:{val:4*e/3,absolute:!0}},c}();var oc=new Z("1em");var _e=function(c){(0,B.__extends)(t,c);function t(){var e=c.call(this,0)||this;return e.type="blank",e}return t}(Qe);var ac=function(){function c(){this._activeBannerHeight=Qe.DEFAULT_HEIGHT,this.events=new f.default,this.constructContainer()}return c.prototype.constructContainer=function(){var t=N("div");return t.id="keymanweb_banner_container",t.className="kmw-banner-container",this.bannerContainer=t},Object.defineProperty(c.prototype,"element",{get:function(){return this.bannerContainer},enumerable:!1,configurable:!0}),c.prototype.appendStyles=function(){this.currentBanner&&this.currentBanner.appendStyleSheet()},Object.defineProperty(c.prototype,"banner",{get:function(){return this.currentBanner},set:function(t){if(this.currentBanner){if(t==this.currentBanner)return;var e=this.currentBanner;this.currentBanner=t,this.bannerContainer.replaceChild(t.getDiv(),e.getDiv()),e.shutdown()}else this.currentBanner=t,t&&this.bannerContainer.appendChild(t.getDiv());t instanceof _e||(t.height=this.activeBannerHeight),this.events.emit("bannerchange")},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"height",{get:function(){return this.currentBanner?this.currentBanner.height:0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"activeBannerHeight",{get:function(){return this._activeBannerHeight},set:function(t){this._activeBannerHeight=t,this.currentBanner&&!(this.currentBanner instanceof _e)&&(this.currentBanner.height=t)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"layoutHeight",{get:function(){return Z.inPixels(this.height)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"width",{get:function(){var t;return(t=this.currentBanner)===null||t===void 0?void 0:t.width},set:function(t){this.currentBanner&&(this.currentBanner.width=t)},enumerable:!1,configurable:!0}),c.prototype.refreshLayout=function(){var t,e;(e=(t=this.currentBanner).refreshLayout)===null||e===void 0||e.call(t)},c}();var gc=function(c){(0,B.__extends)(t,c);function t(e,n){var i=this;e.length>0?(i=c.call(this)||this,n&&(i.height=n)):i=c.call(this,0)||this,i.type="image",e.indexOf("base64")>=0?console.log("Loading img from base64 data"):console.log("Loading img with src '"+e+"'"),i.img=document.createElement("img"),i.img.setAttribute("src",e);var r=i.img.style;return r.width="100%",r.height="100%",i.getDiv().appendChild(i.img),console.log("Image loaded."),i}return t.prototype.setImagePath=function(e){this.img&&this.img.setAttribute("src",e)},t}(Qe);function Ge(c,t){t instanceof Error?console.error("".concat(c,": ").concat(t.message,"\n\n").concat(t.stack)):(console.error(c),console.error(t))}var dc=function(){function c(t){this.queue=[],this.defaultWaitFactory=t||function(){return Be(0)}}return Object.defineProperty(c.prototype,"defaultWait",{get:function(){return this.defaultWaitFactory()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"ready",{get:function(){return this.queue.length==0&&!this.waitLock},enumerable:!1,configurable:!0}),c.prototype.triggerNextClosure=function(){return(0,B.__awaiter)(this,void 0,void 0,function(){var t,e,n;return(0,B.__generator)(this,function(i){switch(i.label){case 0:if(this.queue.length==0)return[2];t=this.queue.shift(),this.waitLock=Promise.resolve();try{e=t()}catch(r){Ge("Error from queued closure",r)}e=e!=null?e:this.defaultWaitFactory(),this.waitLock=e,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),Ge("Async error from queued closure",n),[3,4];case 4:return this.waitLock=null,this.triggerNextClosure(),[2]}})})},c.prototype.runAsync=function(t){var e=this.ready;this.queue.push(t),e&&this.triggerNextClosure()},c}();function Bc(c){return"targetX"in c&&"targetY"in c&&"t"in c}var Ae=function(){function c(t){if(this.rawLinearSums={x:0,y:0,t:0},this.coordArcSum=0,this._sampleCount=0,!!t)if(t instanceof c)Object.assign(this,t),this.rawLinearSums=(0,B.__assign)({},t.rawLinearSums);else if(Bc(t))Object.assign(this,this.extend(t));else throw new Error("A constructor for this input pattern has not yet been implemented")}return c.prototype.extend=function(t){return this._extend(new c(this),t)},c.prototype._extend=function(t,e){t._initialSample||(t._initialSample=e,t.baseSample=e);var n=t.baseSample;this.followingSample=e;var i=e.targetX-n.targetX,r=e.targetY-n.targetY,l=e.t-n.t;if(t.rawLinearSums.x+=i,t.rawLinearSums.y+=r,t.rawLinearSums.t+=l,this.lastSample){var s=e.targetX-this.lastSample.targetX,o=e.targetY-this.lastSample.targetY,a=s*s+o*o,g=Math.sqrt(a);t.coordArcSum+=g}return t._lastSample=e,t.sampleCount=this.sampleCount+1,t},c.prototype.deaccumulate=function(t){var e=new c(this);return this._deaccumulate(e,t)},c.prototype._deaccumulate=function(t,e){if(!e)return t;if(!e.followingSample||!e.lastSample)throw"Invalid argument:  stats missing necessary tracking variable.";for(var n in t.rawLinearSums){var i=n;t.rawLinearSums[i]-=e.rawLinearSums[i]}if(e.followingSample&&e.lastSample){var r=e.followingSample.targetX-e.lastSample.targetX,l=e.followingSample.targetY-e.lastSample.targetY,s=r*r+l*l,o=Math.sqrt(s);t.coordArcSum-=o,t.coordArcSum-=e.coordArcSum}return t.sampleCount-=e.sampleCount,t._initialSample=e.followingSample,t},c.prototype.translateCoordSystem=function(t){var e=new c(this);return this._translateCoordSystem(e,t)},c.prototype._translateCoordSystem=function(t,e){if(this.sampleCount==0)return t;var n=t.initialSample==t.lastSample;return t._initialSample=e(t.initialSample),t.baseSample=e(t.baseSample),t._lastSample=n?t._initialSample:e(t.lastSample),t},c.prototype.replaceInitialSample=function(t){var e=new c(this);return this._replaceInitialSample(e,t)},c.prototype._replaceInitialSample=function(t,e){if(this.sampleCount==0)throw new Error("no sample available to replace");var n=t.initialSample;if(t._initialSample=e,this.sampleCount>1){var i=e.targetX-n.targetX,r=e.targetY-n.targetY,l=e.t-n.t;t.rawLinearSums.x+=i,t.rawLinearSums.y+=r,t.rawLinearSums.t+=l;var s=i*i+r*r,o=Math.sqrt(s);t.coordArcSum+=o}else t._lastSample=e;return t},Object.defineProperty(c.prototype,"lastSample",{get:function(){return this._lastSample},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastTimestamp",{get:function(){var t;return(t=this.lastSample)===null||t===void 0?void 0:t.t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"sampleCount",{get:function(){return this._sampleCount},set:function(t){this._sampleCount=t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"initialSample",{get:function(){return this._initialSample},enumerable:!1,configurable:!0}),c.prototype.mappingConstant=function(t){if(!!this.baseSample)return t=="t"?this.baseSample.t:t=="x"?this.baseSample.targetX:t=="y"?this.baseSample.targetY:0},c.prototype.mean=function(t){return this.rawLinearSums[t]/this.sampleCount+this.mappingConstant(t)},Object.defineProperty(c.prototype,"netDistance",{get:function(){if(!this.lastSample||!this.initialSample)return 0;var t=this.lastSample.targetX-this.initialSample.targetX,e=this.lastSample.targetY-this.initialSample.targetY;return Math.sqrt(t*t+e*e)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"duration",{get:function(){return!this.lastSample||!this.initialSample?0:this.lastSample.t-this.initialSample.t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"angle",{get:function(){if(!(this.sampleCount==1||!this.lastSample||!this.initialSample)&&!(this.netDistance<1)){var t=this.lastSample.targetX-this.initialSample.targetX,e=this.lastSample.targetY-this.initialSample.targetY,n=Math.acos(-e/this.netDistance);return t<0?2*Math.PI-n:n}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"angleInDegrees",{get:function(){return this.angle*180/Math.PI},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"cardinalDirection",{get:function(){if(!(this.sampleCount==1||!this.lastSample||!this.initialSample)&&!(isNaN(this.angle)||this.angle===null||this.angle===void 0)){var t=["n","ne","e","se","s","sw","w","nw","n"],e=Math.ceil((this.angleInDegrees-22.5)/45);return t[e]}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"speed",{get:function(){return this.duration?this.netDistance/this.duration:0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"rawDistance",{get:function(){return this.coordArcSum},enumerable:!1,configurable:!0}),c.prototype.toJSON=function(){return{angle:this.angle,cardinal:this.cardinalDirection,netDistance:this.netDistance,duration:this.duration,sampleCount:this.sampleCount,rawDistance:this.rawDistance}},c}();var Fc=function(){function c(){}return c.prototype.getBoundingClientRect=function(){return new DOMRect(0,0,Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0))},c}();var Ue=function(){function c(t,e){Array.isArray(t)&&(e=t,t=new Fc),this.root=t,e=e||[0,0,0,0],this.updatePadding(e)}return Object.defineProperty(c.prototype,"edgePadding",{get:function(){return this._edgePadding},enumerable:!1,configurable:!0}),c.prototype.updatePadding=function(t){switch(t.length){case 1:var e=t[0];this._edgePadding={x:e,y:e,w:2*e,h:2*e};break;case 2:this._edgePadding={x:t[1],y:t[0],w:2*t[1],h:2*t[0]};break;case 3:this._edgePadding={x:t[1],y:t[0],w:2*t[1],h:t[0]+t[2]};break;case 4:this._edgePadding={x:t[3],y:t[0],w:t[1]+t[3],h:t[0]+t[2]};break;default:throw new Error("Invalid values for PaddedZoneSource's edgePadding - must be between 1 to 4 `number` values.")}},c.prototype.getBoundingClientRect=function(){var t=this.root.getBoundingClientRect();return new DOMRect(t.left+this.edgePadding.x,t.top+this.edgePadding.y,t.width-this.edgePadding.w,t.height-this.edgePadding.h)},c}();function Yt(c){var t,e,n,i,r,l,s,o=(0,B.__assign)({},c);if(o.mouseEventRoot=(t=o.mouseEventRoot)!==null&&t!==void 0?t:o.targetRoot,o.touchEventRoot=(e=o.touchEventRoot)!==null&&e!==void 0?e:o.targetRoot,o.inputStartBounds=(n=o.inputStartBounds)!==null&&n!==void 0?n:o.targetRoot,o.maxRoamingBounds=(i=o.maxRoamingBounds)!==null&&i!==void 0?i:o.targetRoot,o.safeBounds=(r=o.safeBounds)!==null&&r!==void 0?r:new Ue([2]),o.itemIdentifier=(l=o.itemIdentifier)!==null&&l!==void 0?l:function(){return null},o.recordingMode=!!o.recordingMode,o.historyLength=((s=o.historyLength)!==null&&s!==void 0?s:0)>0?o.historyLength:0,c.paddedSafeBounds)delete o.safeBoundPadding;else{var a=c.safeBoundPadding;typeof a=="number"&&(a=[a]),a=a!=null?a:[3],o.paddedSafeBounds=new Ue(o.safeBounds,a)}return o}var wt=function(c){(0,B.__extends)(t,c);function t(){var e=c.call(this)||this;return e._isComplete=!1,e._stats=new Ae,e}return Object.defineProperty(t.prototype,"stats",{get:function(){return this._stats},enumerable:!1,configurable:!0}),t.prototype.clone=function(){var e=new t;return e._isComplete=this._isComplete,e._wasCancelled=this._wasCancelled,e._stats=new Ae(this._stats),e},Object.defineProperty(t.prototype,"isComplete",{get:function(){return this._isComplete},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wasCancelled",{get:function(){return this._wasCancelled},enumerable:!1,configurable:!0}),t.prototype.translateCoordSystem=function(e){this._stats=this._stats.translateCoordSystem(e)},t.prototype.replaceInitialSample=function(e){this._stats=this._stats.replaceInitialSample(e)},t.prototype.extend=function(e){if(this._isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this._stats=this._stats.extend(e),this.emit("step",e)},t.prototype.terminate=function(e){e===void 0&&(e=!1),!this._isComplete&&(this._wasCancelled=e,this._isComplete=!0,e?this.emit("invalidated"):this.emit("complete"),this.removeAllListeners())},t.prototype.toJSON=function(){return{stats:this.stats,wasCancelled:this.wasCancelled}},t}(f.default);var je=function(c){(0,B.__extends)(t,c);function t(){var e=c!==null&&c.apply(this,arguments)||this;return e.samples=[],e}return t.prototype.clone=function(){var e=new t;return e.samples=[].concat(this.samples),e._isComplete=this._isComplete,e._wasCancelled=this._wasCancelled,e._stats=new Ae(this._stats),e},t.deserialize=function(e){var n=new t;n.samples=[].concat(e.coords.map(function(r){return(0,B.__assign)({},r)})),n._isComplete=!0,n._wasCancelled=e.wasCancelled;var i=n.samples.reduce(function(r,l){return r.extend(l)},new Ae);return n._stats=i,n},t.prototype.extend=function(e){if(this.isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this.samples.push(e),c.prototype.extend.call(this,e)},t.prototype.translateCoordSystem=function(e){c.prototype.translateCoordSystem.call(this,e);for(var n=0;n<this.samples.length;n++)this.samples[n]=e(this.samples[n])},Object.defineProperty(t.prototype,"coords",{get:function(){return this.samples},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){for(var e={coords:[].concat(this.samples.map(function(l){return{targetX:l.targetX,targetY:l.targetY,t:l.t,item:l.item}})),wasCancelled:this.wasCancelled,stats:this.stats},n=0,i=e.coords;n<i.length;n++){var r=i[n];delete r.clientX,delete r.clientY,r.item===void 0&&delete r.item}return e},t}(wt);var pe=function(){function c(t,e,n,i){this.stateToken=null,this.rawIdentifier=t,this.isFromTouch=n,this._path=i?new i:new wt,this.recognizerConfigStack=Array.isArray(e)?e:[e]}return Object.defineProperty(c.prototype,"path",{get:function(){return this._path},enumerable:!1,configurable:!0}),c.prototype.setGestureMatchInspector=function(t){if(this._matchInspectionClosure)throw new Error("Invalid state:  the match-inspection closure has already been set");this._matchInspectionClosure=t},c.prototype.update=function(t){this.path.extend(t),this._baseItem||(this._baseItem=t.item)},Object.defineProperty(c.prototype,"baseItem",{get:function(){return this._baseItem},set:function(t){this._baseItem=t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"currentSample",{get:function(){return this.path.stats.lastSample},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"potentialModelMatchIds",{get:function(){return this._matchInspectionClosure(this)},enumerable:!1,configurable:!0}),c.prototype.constructSubview=function(t,e,n){return new le(this,this.recognizerConfigStack,t,e,n)},c.prototype.terminate=function(t){this.path.terminate(t)},Object.defineProperty(c.prototype,"isPathComplete",{get:function(){return this.path.isComplete},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"identifier",{get:function(){var t=this.isFromTouch?"touch":"mouse";return"".concat(t,":").concat(this.rawIdentifier)},enumerable:!1,configurable:!0}),c.prototype.pushRecognizerConfig=function(t){var e=(0,B.__assign)((0,B.__assign)({},t),{mouseEventRoot:this.recognizerConfigStack[0].mouseEventRoot,touchEventRoot:this.recognizerConfigStack[0].touchEventRoot});this.recognizerConfigStack.push(Yt(e))},c.prototype.popRecognizerConfig=function(){if(this.recognizerConfigStack.length==1)throw new Error("Cannot 'pop' the original recognizer-configuration for this GestureSource.");return this.recognizerConfigStack.pop()},Object.defineProperty(c.prototype,"currentRecognizerConfig",{get:function(){return this.recognizerConfigStack[this.recognizerConfigStack.length-1]},enumerable:!1,configurable:!0}),c.prototype.toJSON=function(){var t={identifier:this.identifier,isFromTouch:this.isFromTouch,path:this.path.toJSON(),stateToken:this.stateToken};return t},c}();var le=function(c){(0,B.__extends)(t,c);function t(e,n,i,r,l){var s=this,o=0,a=e.path.stats.sampleCount;e instanceof t&&(o=e._baseStartIndex),s=c.call(this,e.rawIdentifier,n,e.isFromTouch,Object.getPrototypeOf(e.path).constructor)||this;var g=s._baseSource=e instanceof t?e._baseSource:e;s.stateToken=l!=null?l:e.stateToken;var d=function(y){var U=s.recognizerTranslation,b=(0,B.__assign)((0,B.__assign)({},y),{targetX:y.targetX-U.x,targetY:y.targetY-U.y});return s.stateToken&&(b.stateToken=s.stateToken),(s.stateToken!=g.stateToken||s.stateToken!=e.stateToken)&&(b.item=s.currentRecognizerConfig.itemIdentifier(b,null)),b},F=e.path.stats.lastSample;i?(s._baseStartIndex=o=Math.max(o+a-1,0),a=a>0?1:0):s._baseStartIndex=o,i?e.path.stats.sampleCount&&s._path.extend(e.path.stats.lastSample):s._path=e.path.clone(),s._path.translateCoordSystem(d),r?s._baseItem=e.baseItem:s._baseItem=F==null?void 0:F.item;var u=function(){return s.path.terminate(!1)},I=function(){return s.path.terminate(!0)},Q=function(y){c.prototype.update.call(s,d(y))};return g.path.on("complete",u),g.path.on("invalidated",I),g.path.on("step",Q),s.subviewDisconnector=function(){g.path.off("complete",u),g.path.off("invalidated",I),g.path.off("step",Q)},g.isPathComplete&&(s.path.terminate(g.path.wasCancelled),s.disconnect()),s}return Object.defineProperty(t.prototype,"recognizerTranslation",{get:function(){if(this.recognizerConfigStack.length==1||!this.currentRecognizerConfig)return{x:0,y:0};var e=this.currentRecognizerConfig,n=e.targetRoot.getBoundingClientRect(),i=this.recognizerConfigStack[0].targetRoot.getBoundingClientRect();return{x:n.left-i.left,y:n.top-i.top}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseSource",{get:function(){return this._baseSource},enumerable:!1,configurable:!0}),t.prototype.disconnect=function(){this.subviewDisconnector&&(this.subviewDisconnector(),this.subviewDisconnector=null)},t.prototype.pushRecognizerConfig=function(e){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")},t.prototype.popRecognizerConfig=function(){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")},t.prototype.update=function(e){throw new Error("Updates should be provided through the base GestureSource.")},t.prototype.terminate=function(e){this.baseSource.terminate(e)},t}(pe);var uc=function(c){(0,B.__extends)(t,c);function t(e,n,i){var r=c.call(this,e,n,i,je)||this;return r.stateToken=null,r}return t.prototype.initPath=function(){return new je},t.deserialize=function(e,n){var i=n!==void 0?n:this._jsonIdSeed++,r=e.isFromTouch,l=je.deserialize(e.path),s=new t(i,null,r);return s._path=l,s},t}(pe);var yc=function(c){(0,B.__extends)(t,c);function t(e){var n,i=c.call(this)||this;return i._activeTouchpoints=[],i.identifierMap={},i.config=e,i.sourceConstructor=!((n=e==null?void 0:e.recordingMode)!==null&&n!==void 0)||n?uc:pe,i}return t.prototype.createTouchpoint=function(e,n){var i=t.IDENTIFIER_SEED++;this.identifierMap[e]=i;var r=new this.sourceConstructor(i,this.config,n);return r.stateToken=this.stateToken,r},t.prototype.fulfillInputStart=function(e){},t.prototype.maintainTouchpoints=function(e){e||(e=[]),this._activeTouchpoints.filter(function(n){return!e.includes(n)}).forEach(function(n){return n.terminate(!0)})},t.prototype.hasActiveTouchpoint=function(e){return this.identifierMap[e]!==void 0},t.prototype.getTouchpointWithId=function(e){var n=this.identifierMap[e];return this._activeTouchpoints.find(function(i){return i.rawIdentifier==n})},t.prototype.getConfigForId=function(e){return this.getTouchpointWithId(e).currentRecognizerConfig},t.prototype.getStateTokenForId=function(e){var n;return(n=this.getTouchpointWithId(e).stateToken)!==null&&n!==void 0?n:null},t.prototype.dropTouchpoint=function(e){var n=e.rawIdentifier;this._activeTouchpoints=this._activeTouchpoints.filter(function(o){return e!=o});for(var i=0,r=Object.keys(this.identifierMap);i<r.length;i++){var l=r[i],s=Number.parseInt(l,10);this.identifierMap[s]==n&&delete this.identifierMap[s]}},t.prototype.addTouchpoint=function(e){this._activeTouchpoints.push(e)},Object.defineProperty(t.prototype,"activeSources",{get:function(){return[].concat(this._activeTouchpoints)},enumerable:!1,configurable:!0}),t.IDENTIFIER_SEED=0,t}(f.default);function Kn(c,t,e){var n=c.targetRoot.getBoundingClientRect();return{clientX:t,clientY:e,targetX:t-n.left,targetY:e-n.top}}var Tt=function(c){(0,B.__extends)(t,c);function t(){return c!==null&&c.apply(this,arguments)||this}return t.prototype.buildSampleFor=function(e,n,i,r,l){var s,o,a=(0,B.__assign)((0,B.__assign)({},Kn(this.config,e,n)),{t:r,stateToken:(s=l==null?void 0:l.stateToken)!==null&&s!==void 0?s:this.stateToken}),g=(o=l==null?void 0:l.currentRecognizerConfig.itemIdentifier)!==null&&o!==void 0?o:this.config.itemIdentifier,d=g(a,i);return a.item=d,a},t.prototype.onInputStart=function(e,n,i,r){var l=this,s=this.createTouchpoint(e,r);s.update(n),this.addTouchpoint(s),s.path.on("invalidated",function(){l.dropTouchpoint(s)}),s.path.on("complete",function(){l.dropTouchpoint(s)});try{this.emit("pointstart",s)}catch(o){Ge("Engine-internal error while initializing gesture matching for new source",o)}return s},t.prototype.onInputMove=function(e,n,i){if(!!e)try{e.update(n)}catch(r){Ge("Error occurred while updating source",r)}},t.prototype.onInputMoveCancel=function(e,n,i){if(!!e)try{e.update(n),e.path.terminate(!0)}catch(r){Ge("Error occurred while cancelling further input for source",r)}},t.prototype.onInputEnd=function(e,n){if(!!e)try{e.path.terminate(!1)}catch(i){Ge("Error occurred while finalizing input for source",i)}},t}(yc);var We=function(){function c(){}return c.getCoordZoneBitmask=function(t,e){var n=e.getBoundingClientRect(),i=0;return i|=t.clientX<n.left?c.FAR_LEFT:0,i|=t.clientX>n.right?c.FAR_RIGHT:0,i|=t.clientY<n.top?c.FAR_TOP:0,i|=t.clientY>n.bottom?c.FAR_BOTTOM:0,i},c.inputStartOutOfBoundsCheck=function(t,e){return!!this.getCoordZoneBitmask(t,e.inputStartBounds)},c.inputStartSafeBoundProximityCheck=function(t,e){return this.getCoordZoneBitmask(t,e.paddedSafeBounds)},c.inputMoveCancellationCheck=function(t,e,n){if(n=n||0,this.getCoordZoneBitmask(t,e.maxRoamingBounds))return!0;var i=this.getCoordZoneBitmask(t,e.safeBounds);return!!(i&~n)},c.FAR_TOP=8,c.FAR_LEFT=4,c.FAR_BOTTOM=2,c.FAR_RIGHT=1,c}();var Ic=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this,e)||this;return n.hasActiveClick=!1,n.disabledSafeBounds=0,n.currentSource=null,n.activeIdentifier=0,n._mouseStart=function(i){return n.onMouseStart(i)},n._mouseMove=function(i){return n.onMouseMove(i)},n._mouseEnd=function(i){return n.onMouseEnd(i)},n}return Object.defineProperty(t.prototype,"eventRoot",{get:function(){return this.config.mouseEventRoot},enumerable:!1,configurable:!0}),t.prototype.registerEventHandlers=function(){this.eventRoot.addEventListener("mousedown",this._mouseStart,!0),this.eventRoot.addEventListener("mousemove",this._mouseMove,!1),this.eventRoot.addEventListener("mouseup",this._mouseEnd,!0)},t.prototype.unregisterEventHandlers=function(){this.eventRoot.removeEventListener("mousedown",this._mouseStart,!0),this.eventRoot.removeEventListener("mousemove",this._mouseMove,!1),this.eventRoot.removeEventListener("mouseup",this._mouseEnd,!0)},t.prototype.preventPropagation=function(e){e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,typeof e.stopImmediatePropagation=="function"?e.stopImmediatePropagation():typeof e.stopPropagation=="function"&&e.stopPropagation()},t.prototype.buildSampleFromEvent=function(e){return this.buildSampleFor(e.clientX,e.clientY,e.target,performance.now(),this.currentSource)},t.prototype.onMouseStart=function(e){var n=this;if(!!this.config.targetRoot.contains(e.target)){this.preventPropagation(e);var i=this.buildSampleFromEvent(e);We.inputStartOutOfBoundsCheck(i,this.config)||(this.disabledSafeBounds=We.inputStartSafeBoundProximityCheck(i,this.config));var r=this.onInputStart(this.activeIdentifier,i,e.target,!1);this.currentSource=r;var l=function(){n.currentSource=null};r.path.on("complete",l),r.path.on("invalidated",l)}},t.prototype.onMouseMove=function(e){var n=this.currentSource;if(!!n){var i=this.buildSampleFromEvent(e);if(!e.buttons){this.hasActiveClick&&(this.hasActiveClick=!1,this.onInputMoveCancel(n,i,e.target));return}this.preventPropagation(e);var r=n.currentRecognizerConfig;We.inputMoveCancellationCheck(i,r,this.disabledSafeBounds)?this.onInputMoveCancel(n,i,e.target):this.onInputMove(n,i,e.target)}},t.prototype.onMouseEnd=function(e){var n=this.currentSource;!n||(e.buttons||(this.hasActiveClick=!1),this.onInputEnd(n,e.target))},t}(Tt);function Qc(c){for(var t=[],e=0;e<c.length;e++)t.push(c.item(e));return t}var Uc=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this,e)||this;return n.eventDispatcher=new dc,n.safeBoundMaskMap={},n.pendingSourcePromises=new Map,n.inputStartSignalMap=new Map,n._touchStart=function(i){return n.onTouchStart(i)},n._touchMove=function(i){return n.onTouchMove(i)},n._touchEnd=function(i){return n.onTouchEnd(i)},n}return Object.defineProperty(t.prototype,"eventRoot",{get:function(){return this.config.touchEventRoot},enumerable:!1,configurable:!0}),t.prototype.registerEventHandlers=function(){this.eventRoot.addEventListener("touchstart",this._touchStart,{capture:!0,passive:!1}),this.eventRoot.addEventListener("touchmove",this._touchMove,{capture:!1,passive:!1}),this.eventRoot.addEventListener("touchend",this._touchEnd,{capture:!0,passive:!1})},t.prototype.unregisterEventHandlers=function(){this.eventRoot.removeEventListener("touchstart",this._touchStart,!0),this.eventRoot.removeEventListener("touchmove",this._touchMove,!1),this.eventRoot.removeEventListener("touchend",this._touchEnd,!0)},t.prototype.preventPropagation=function(e){e.cancelable&&e.preventDefault(),typeof e.stopImmediatePropagation=="function"?e.stopImmediatePropagation():typeof e.stopPropagation=="function"&&e.stopPropagation()},t.prototype.dropTouchpoint=function(e){c.prototype.dropTouchpoint.call(this,e);for(var n=0,i=Object.keys(this.safeBoundMaskMap);n<i.length;n++){var r=i[n],l=Number.parseInt(r,10);this.getTouchpointWithId(l)==e&&delete this.safeBoundMaskMap[l]}},t.prototype.fulfillInputStart=function(e){var n=this.inputStartSignalMap.get(e);n&&(this.inputStartSignalMap.delete(e),n.resolve())},t.prototype.hasActiveTouchpoint=function(e){var n=c.prototype.hasActiveTouchpoint.call(this,e);return n||!!this.pendingSourcePromises.has(e)},t.prototype.buildSampleFromTouch=function(e,n,i){return this.buildSampleFor(e.clientX,e.clientY,e.target,n,i)},t.prototype.onTouchStart=function(e){var n=this;if(!!this.config.targetRoot.contains(e.target)){this.preventPropagation(e);var i=Qc(e.touches),r=Qc(e.changedTouches),l=i.filter(function(F){return r.findIndex(function(u){return F.identifier==u.identifier})==-1}),s=l.map(function(F){return n.pendingSourcePromises.get(F.identifier)});this.eventDispatcher.runAsync(function(){return(0,B.__awaiter)(n,void 0,void 0,function(){var F;return(0,B.__generator)(this,function(u){switch(u.label){case 0:return[4,Promise.all(s)];case 1:return F=u.sent(),this.maintainTouchpoints(F),[2,this.eventDispatcher.defaultWait]}})})});for(var o=new Map,a=0;a<e.changedTouches.length;a++){var g=e.changedTouches.item(a),d=new J;this.pendingSourcePromises.set(g.identifier,d),o.set(g.identifier,d)}this.eventDispatcher.runAsync(function(){for(var F=performance.now(),u=null,I=function(U){var b=e.changedTouches.item(U),C=b.identifier,x=n.buildSampleFromTouch(b,F,null);if(!We.inputStartOutOfBoundsCheck(x,n.config))n.safeBoundMaskMap[C]=We.inputStartSafeBoundProximityCheck(x,n.config);else{var X=o.get(C);return X.resolve(null),"continue"}u=n.onInputStart(C,x,e.target,!0);var p=o.get(C);p.resolve(u);var V=function(){n.pendingSourcePromises.get(C)==p&&n.pendingSourcePromises.delete(C)};u.path.on("complete",V),u.path.on("invalidated",V)},Q=0;Q<e.changedTouches.length;Q++)I(Q);if(u){var y=new J;return n.inputStartSignalMap.set(u,y),y.corePromise}else return Promise.resolve()})}},t.prototype.onTouchMove=function(e){for(var n=this,i,r=0;r<e.touches.length;r++){var l=e.touches.item(r);if(this.hasActiveTouchpoint(l.identifier)){this.preventPropagation(e);break}}for(var s=new Map,r=0;r<e.touches.length;r++){var o=e.touches.item(r).identifier;s.set(o,(i=this.pendingSourcePromises.get(o))===null||i===void 0?void 0:i.corePromise)}this.eventDispatcher.runAsync(function(){return(0,B.__awaiter)(n,void 0,void 0,function(){var a;return(0,B.__generator)(this,function(g){switch(g.label){case 0:return[4,Promise.all(s.values())];case 1:return a=g.sent(),this.maintainTouchpoints(a),[2,this.eventDispatcher.defaultWait]}})})}),this.eventDispatcher.runAsync(function(){return(0,B.__awaiter)(n,void 0,void 0,function(){var a,g,d,F,u,I,Q;return(0,B.__generator)(this,function(y){switch(y.label){case 0:a=performance.now(),g=0,y.label=1;case 1:return g<e.touches.length?(d=e.touches.item(g),F=d.identifier,[4,s.get(F)]):[3,4];case 2:if(u=y.sent(),!u||u.isPathComplete)return[3,3];I=u.currentRecognizerConfig,Q=this.buildSampleFromTouch(d,a,u),We.inputMoveCancellationCheck(Q,I,this.safeBoundMaskMap[F])?this.onInputMoveCancel(u,Q,d.target):this.onInputMove(u,Q,d.target),y.label=3;case 3:return g++,[3,1];case 4:return[2,this.eventDispatcher.defaultWait]}})})})},t.prototype.onTouchEnd=function(e){for(var n=this,i,r=0;r<e.changedTouches.length;r++){var l=e.changedTouches.item(r);if(this.hasActiveTouchpoint(l.identifier)){this.preventPropagation(e);break}}for(var s=new Map,r=0;r<e.changedTouches.length;r++){var o=e.changedTouches.item(r).identifier,a=(i=this.pendingSourcePromises.get(o))===null||i===void 0?void 0:i.corePromise;s.set(o,a)}this.eventDispatcher.runAsync(function(){return(0,B.__awaiter)(n,void 0,void 0,function(){var g,d,F;return(0,B.__generator)(this,function(u){switch(u.label){case 0:g=0,u.label=1;case 1:return g<e.changedTouches.length?(d=e.changedTouches.item(g),[4,s.get(d.identifier)]):[3,4];case 2:if(F=u.sent(),!F||F.isPathComplete)return[3,3];this.onInputEnd(F,e.target),u.label=3;case 3:return g++,[3,1];case 4:return[2,this.eventDispatcher.defaultWait]}})})})},t}(Tt);var bc=function(){function c(t,e,n){var i=this;if(!t||!e)throw new Error("A gesture-path source and contact-path model must be specified.");if(this.model=t,this.publishedPromise=new J,this.source=e,this.inheritedStats=n,this.lastStats=null,t.timer){var r=t.timer.inheritElapsed?Math.min(e.path.stats.duration,t.timer.duration):0;this.timerPromise=new st(t.timer.duration-r),this.publishedPromise.then(function(){i.timerPromise.resolve(!1)}),this.timerPromise.then(function(l){var s=e instanceof le?e.baseSource:e,o=performance.now();!s.isPathComplete&&s.currentSample.t!=o&&s.path.extend((0,B.__assign)((0,B.__assign)({},s.currentSample),{t:o})),l!=t.timer.expectedResult&&i.finalize(!1,"timer"),i.finalize(!0,"timer")})}}return Object.defineProperty(c.prototype,"promise",{get:function(){return this.publishedPromise.corePromise},enumerable:!1,configurable:!0}),c.prototype.finalize=function(t,e){if(this.publishedPromise.isFulfilled)return this._result;var n=this.model;n.validateItem&&t&&(t=n.validateItem(this.source.path.stats.lastSample.item,this.baseItem));var i;return t?i={type:n.pathResolutionAction,cause:e}:i={type:"reject",cause:e},this.publishedPromise.resolve(i),this._result=i,i},Object.defineProperty(c.prototype,"stats",{get:function(){return this.source.path.stats},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"baseItem",{get:function(){return this.source.baseItem},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastItem",{get:function(){return this.source.currentSample.item},enumerable:!1,configurable:!0}),c.prototype.update=function(){var t=this.model,e=this.source;if(e.path.wasCancelled)return this.finalize(!1,"path");if(t.itemChangeAction&&e.path.stats.sampleCount>0&&e.currentSample.item!=e.baseItem){var n=t.itemChangeAction=="resolve";return this.finalize(n,"item")}else{var n=t.pathModel.evaluate(e.path,this.lastStats,e.baseItem,this.inheritedStats)||"continue";return this.lastStats=e.path.stats,n!="continue"?this.finalize(n=="resolve","path"):e.path.isComplete?this.finalize(!1,"path"):{type:"continue"}}},c}();var Pn=function(){function c(t,e){var n=this,i;if(this._isCancelled=!1,!t||!e)throw new Error("Construction of GestureMatcher requires a gesture-model spec and a source for related contact points.");if(!t.sustainTimer&&!e)throw new Error("If the provided gesture-model spec lacks a sustain timer, there must be an active contact point.");var r=e instanceof pe?null:e,l=r?null:e;this.predecessor=r,this.publishedPromise=new J,this.model=t,t.sustainTimer&&(this.sustainTimerPromise=new st(t.sustainTimer.duration),this.sustainTimerPromise.then(function(Q){var y=t.sustainTimer.expectedResult==Q;n.finalize(y,"timer")})),this.pathMatchers=[];var s=l?[l]:r.sources,o=s.map(function(Q){return l&&Q==l?l:Q.isPathComplete?null:Q}).reduce(function(Q,y){return y?Q.concat(y):Q},[]);if(t.sustainTimer&&o.length>0){this.finalize(!1,"path");return}else!t.sustainTimer&&o.length==0&&this.finalize(!1,"path");for(var a=0;a<o.length;a++){var g=o[a];g instanceof le&&g.disconnect();var d=t.contacts[a];if(!d)throw new Error('No contact model for inherited path: gesture "'.concat(t.id,"', entry ").concat(a));var F=(i=d==null?void 0:d.model.pathInheritance)!==null&&i!==void 0?i:"chop",u=!1,I=void 0;switch(F){case"reject":this.finalize(!1,"path");return;case"full":I=g.constructSubview(!1,!0),this.addContactInternal(I,g.path.stats,!0);continue;case"partial":u=!0;case"chop":I=g.constructSubview(!0,u),this.addContactInternal(I,g.path.stats,!0);break}}}return Object.defineProperty(c.prototype,"sources",{get:function(){var t=this;return this.pathMatchers.map(function(e,n){if(!t.model.contacts[n].resetOnInstantFulfill)return e.source}).filter(function(e){return!!e})},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"promise",{get:function(){return this.publishedPromise.corePromise},enumerable:!1,configurable:!0}),c.prototype.cancel=function(){this._isCancelled=!0,this._result||this.finalize(!1,"cancelled")},Object.defineProperty(c.prototype,"isCancelled",{get:function(){return this._isCancelled},enumerable:!1,configurable:!0}),c.prototype.finalize=function(t,e){var n,i;if(this.publishedPromise.isFulfilled)return this._result;try{var r=void 0;t?r=this.model.resolutionAction:(e!="cancelled"&&((n=this.model.rejectionActions)===null||n===void 0?void 0:n[e])&&(r=this.model.rejectionActions[e],r.item="none"),r=r||{type:"none",item:"none"});var l=void 0,s=(i=r.item)!==null&&i!==void 0?i:"current";switch(s){case"none":l=null;break;case"base":l=this.primaryPath.baseItem;break;case"current":l=this.primaryPath.currentSample.item;break}var o={matched:t,action:(0,B.__assign)((0,B.__assign)({},r),{item:l})};return this.publishedPromise.resolve(o),this._result=o,o}catch(a){return this.publishedPromise.reject(a),{matched:!1,action:{type:"none",item:null}}}},c.prototype.finalizeSources=function(){if(!this._result)throw Error("Invalid state for source-finalization - the matcher's evaluation of the gesture model is not yet complete");for(var t=this._result.matched,e=0;e<this.pathMatchers.length;e++){var n=this.pathMatchers[e],i=this.model.contacts[e];n.source.isPathComplete||(t&&i.endOnResolve||!t&&i.endOnReject)&&n.source.terminate(!1)}},Object.defineProperty(c.prototype,"primaryPath",{get:function(){for(var t,e=Number.NEGATIVE_INFINITY,n=0,i=this.pathMatchers;n<i.length;n++){var r=i[n];r.model.itemPriority>e&&(e=r.model.itemPriority,t=r)}return!t&&this.predecessor?this.predecessor.primaryPath:t==null?void 0:t.source},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"baseItem",{get:function(){return this.primaryPath.baseItem},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"currentItem",{get:function(){return this.primaryPath.currentSample.item},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"allSourceIds",{get:function(){var t=this.sources.map(function(n){return n.identifier}),e=this.predecessor?this.predecessor.allSourceIds:[];return t=t.filter(function(n){return e.indexOf(n)==-1}),t.concat(e)},enumerable:!1,configurable:!0}),c.prototype.mayAddContact=function(){return this.pathMatchers.length<this.model.contacts.length},c.prototype.addContact=function(t){var e=this.pathMatchers.length;if(!this.mayAddContact())throw new Error("The specified gesture model does not support more than ".concat(e," contact points."));this.addContactInternal(t.constructSubview(!1,!0),null)},Object.defineProperty(c.prototype,"result",{get:function(){return this._result},enumerable:!1,configurable:!0}),c.prototype.addContactInternal=function(t,e,n){var i=this,r,l=this.pathMatchers.length,s=this.model.contacts[l],o=new bc(s.model,t,new Ae(e));this.pathMatchers.push(o);var a=null,g=null;if(!l&&this.predecessor&&this.model.sustainTimer){a=this.predecessor.primaryPath;var d=(r=this.model.sustainTimer.baseItem)!==null&&r!==void 0?r:"result",F=void 0;switch(d){case"none":g=null;break;case"base":g=this.predecessor.primaryPath.baseItem,F=this.predecessor.primaryPath.stateToken;break;case"result":g=this.predecessor.result.action.item,F=this.predecessor.primaryPath.currentSample.stateToken;break}t.baseItem=g!=null?g:t.baseItem,t.stateToken=F,t.currentSample.stateToken=F,t.currentRecognizerConfig&&(t.currentSample.item=t.currentRecognizerConfig.itemIdentifier(t.currentSample,null))}else g=this.primaryPath.baseItem,a=this.primaryPath;if(s.model.baseCoordReplacer){var u=t.path.stats,I=s.model.baseCoordReplacer(u,g);if(I){var Q=(0,B.__assign)((0,B.__assign)({},Kn(t.currentRecognizerConfig,I.clientX,I.clientY)),{t:I.t||I.t===0?I.t:u.initialSample.t,item:g,stateToken:t.stateToken});t.path.replaceInitialSample(Q)}}if(s.model.allowsInitialState){var y=s.model.allowsInitialState(t.currentSample,a.currentSample,g,a.stateToken);if(!y){this.pathMatchers.pop(),this.finalize(!1,"cancelled");return}}var U=o.update();if((U==null?void 0:U.type)=="reject"){this.finalize(!1,n?"cancelled":"path");return}o.promise.then(function(b){i.finalize(b.type=="resolve",b.cause)})},c.prototype.update=function(){var t=this;this.pathMatchers.forEach(function(e){try{e.update()}catch(n){console.error(n),t.finalize(!1,"cancelled")}})},c}();var Dt=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this)||this;return n._sourceSelector=[],n.potentialMatchers=[],n.sustainMode=!1,n.attemptSynchronousUpdate=function(){var i=n._sourceSelector.filter(function(s){return!s.source.isPathComplete}),r=i.map(function(s){return s.source.currentSample.t}),l=r[0];r.find(function(s){return l!=s})||n.potentialMatchers.forEach(function(s){return s.update()})},n.baseGestureSetId=e||"default",n}return t.prototype.potentialMatchersForSource=function(e){return this.potentialMatchers.filter(function(n){return n.allSourceIds.find(function(i){return i==e.identifier})})},t.prototype.cascadeTermination=function(){var e=this,n=this.potentialMatchers,i=n.filter(function(o){return!o.model.sustainWhenNested}),r=n.filter(function(o){return o.model.sustainWhenNested});this.potentialMatchers=r;var l=r.map(function(o){return o.allSourceIds}).reduce(function(o,a){for(var g=0,d=a;g<d.length;g++){var F=d[g];o.indexOf(F)==-1&&o.push(F)}return o},[]),s=this._sourceSelector.filter(function(o){return!l.find(function(a){return a==o.source.identifier})});return s.forEach(function(o){o.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}});var a=e._sourceSelector.indexOf(o);a>-1&&e._sourceSelector.splice(a,1)}),i.forEach(function(o){return o.cancel()}),this.sustainMode=!0,this._sourceSelector.map(function(o){return o.source})},t.prototype.matchGesture=function(e,n){return(0,B.__awaiter)(this,void 0,void 0,function(){var i,r,l,s,o,a,g,d,F,u,I,Q,y,U,b,C,x,X,p,V,L=this;return(0,B.__generator)(this,function(m){switch(m.label){case 0:return i=e instanceof pe,r=function(G){var S=G.sources.map(function(k){return k.baseSource});return S&&S.length>0?S:G.predecessor?r(G.predecessor):[]},l=i?[e instanceof le?e.baseSource:e]:r(e),s=i?e:null,o=i?null:e,this.pendingMatchSetup?(a=this.pendingMatchSetup,g=new J,this.pendingMatchSetup=g.corePromise,[4,a]):[3,2];case 1:m.sent(),this.pendingMatchSetup==g.corePromise&&(this.pendingMatchSetup=null),g.resolve(),m.label=2;case 2:return i&&s.path.on("invalidated",function(){L.dropSourcesWithIds([s.identifier])}),d=new J,F=l.map(function(G){var S={source:G,matchPromise:d,preserve:!0};return L._sourceSelector.push(S),S}),u=F.map(function(G){return G.matchPromise}),i?(I=this.potentialMatchers.filter(function(G){return G.mayAddContact()}),I.forEach(function(G){G.addContact(s),G.promise.then(L.matcherSelectionFilter(G,u))}),I.length>0?(Q=this.stateToken,y=new J,this.pendingMatchSetup=y.corePromise,[4,Be(0)]):[3,5]):[3,5];case 3:return m.sent(),[4,Be(0)];case 4:if(m.sent(),this.pendingMatchSetup==y.corePromise&&(this.pendingMatchSetup=null),y.resolve(),U=this.stateToken,Q!=U&&(b=s.currentSample,s.stateToken=U,b.stateToken=U,b.item=e.currentRecognizerConfig.itemIdentifier(b,null),s.baseItem=b.item),C=I.find(function(G){return G.result}),C&&C.allSourceIds.includes(e.identifier))return d.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),[2,{selectionPromise:d.corePromise}];m.label=5;case 5:if(F.forEach(function(G){G.preserve=!1}),this.sustainMode&&s)return d.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),[2,{selectionPromise:d.corePromise,sustainModeWithoutMatch:!0}];for(x=n.map(function(G){try{return new Pn(G,s||o)}catch(S){return console.error(S),null}}).filter(function(G){return!!G}),x=x.filter(function(G){return!G.result||G.result.matched!==!1}),X=0,p=x;X<p.length;X++)V=p[X],V.promise.then(this.matcherSelectionFilter(V,u));return x.length>0?this.potentialMatchers=this.potentialMatchers.concat(x):d.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),this.potentialMatchers.sort(function(G,S){return S.model.resolutionPriority-G.model.resolutionPriority}),this.resetSourceHooks(),[2,{selectionPromise:d.corePromise}]}})})},t.prototype.resetSourceHooks=function(){var e=this,n=function(i){var r=i;r.path.off("step",e.attemptSynchronousUpdate),r.path.off("complete",e.attemptSynchronousUpdate),r.path.off("invalidated",e.attemptSynchronousUpdate),r.path.on("step",e.attemptSynchronousUpdate),r.path.on("complete",e.attemptSynchronousUpdate),r.path.on("invalidated",e.attemptSynchronousUpdate)};this._sourceSelector.forEach(function(i){return n(i.source)})},t.prototype.dropSourcesWithIds=function(e){for(var n=function(o){var a=i._sourceSelector.findIndex(function(d){return d.source.identifier==o});if(a>-1){var g=i._sourceSelector.splice(a,1)[0];g.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"none",item:null}}})}},i=this,r=0,l=e;r<l.length;r++){var s=l[r];n(s)}},t.prototype.matchersForSource=function(e){return this.potentialMatchers.filter(function(n){return!!n.sources.find(function(i){return i.identifier==e.identifier})})},t.prototype.matcherSelectionFilter=function(e,n){var i=this;return function(r){return(0,B.__awaiter)(i,void 0,void 0,function(){var l,s,o,a,g,d,F,u,I,Q=this;return(0,B.__generator)(this,function(y){if(e.isCancelled?r={matched:!1,action:{type:"none",item:null}}:e.finalizeSources(),l=e.allSourceIds,s=l.map(function(U){return Q._sourceSelector.find(function(b){return b.source.identifier==U})}).filter(function(U){return!!U}),o=this.potentialMatchers.indexOf(e),o==-1)return[2];if(this.potentialMatchers.splice(o,1),r.action.type=="none")return this.finalizeMatcherlessTrackers(s),[2];if(r.matched)for(g=function(U){var b=d.matchersForSource(U.source);d.potentialMatchers=d.potentialMatchers.filter(function(C){return!b.find(function(x){return C==x})}),b.forEach(function(C){C.cancel()}),d._sourceSelector=d._sourceSelector.filter(function(C){return!s.find(function(x){return C==x})}),U.matchPromise.resolve({matcher:e,result:r})},d=this,F=0,u=s;F<u.length;F++)I=u[F],g(I);else return a=function(U){if(Q.sustainMode&&!U.sustainWhenNested){Q.finalizeMatcherlessTrackers(s);return}var b=new Pn(U,e);if(b.result&&b.result.matched==!1){Q.finalizeMatcherlessTrackers(s);return}b.promise.then(Q.matcherSelectionFilter(b,s.map(function(C){return C.matchPromise}))),Q.potentialMatchers.push(b),Q.resetSourceHooks()},this.emit("rejectionwithaction",{matcher:e,result:r},a),[2];return[2]})})}},t.prototype.finalizeMatcherlessTrackers=function(e){for(var n=this,i=e.map(function(o){return{tracker:o,pendingCount:n.potentialMatchers.filter(function(a){return!!a.allSourceIds.find(function(g){return o.source.identifier==g})}).length}}),r=0,l=i;r<l.length;r++){var s=l[r];s.pendingCount==0&&!s.tracker.preserve&&s.tracker.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}})}},t}(f.default);function qe(c,t){var e=c.gestures.find(function(n){return n.id==t});if(!e)throw new Error("Could not find spec for gesture with id '".concat(t,"'"));return e}function hc(c,t){var e=c.sets[t];if(!e)throw new Error("Could not find a defined gesture-set with id '".concat(t,"'"));var n=c.gestures.filter(function(r){return!!e.find(function(l){return r.id==l})}),i=e.filter(function(r){return!n.find(function(l){return l.id==r})});if(i.length>0)throw new Error("Set '".concat(t,"' cannot find definitions for gestures with ids ").concat(i));return n}var Cc={gestures:[],sets:{default:[]}};var kl=function(){function c(t,e){var n,i,r=t.matcher,l=t.result;this.gestureSetId=e,this.matchedId=r==null?void 0:r.model.id,this.linkType=l.action.type,this.item=l.action.item,this.sources=r==null?void 0:r.sources,(n=this.sources)===null||n===void 0||n.forEach(function(s){return s.disconnect()}),(i=this.sources)===null||i===void 0||i.sort(function(s,o){return(r==null?void 0:r.primaryPath)==s?-1:(r==null?void 0:r.primaryPath)==o?1:0}),this.allSourceIds=(r==null?void 0:r.allSourceIds)||[]}return c}();var xc=function(c){(0,B.__extends)(t,c);function t(e,n,i,r){var l=c.call(this)||this;return l.markedComplete=!1,l.selectionHandler=function(s){return(0,B.__awaiter)(l,void 0,void 0,function(){var o,a,g,d,F,u,I,Q,y,U,b,C,x,X=this,p,V,L,m,G,S,k,W,Y,R;return(0,B.__generator)(this,function(E){switch(E.label){case 0:return o=((p=this.pushedSelector)===null||p===void 0?void 0:p.baseGestureSetId)||((V=this.selector)===null||V===void 0?void 0:V.baseGestureSetId),a=new kl(s,o),s.matcher&&this.stageReports.push(a),g=(L=s.matcher)!==null&&L!==void 0?L:this.stageReports[this.stageReports.length-1],d=(m=g==null?void 0:g.sources.map(function(A){return A instanceof le?A.baseSource:A}))!==null&&m!==void 0?m:[],F=s.result.action.type,(F=="complete"||F=="none")&&(d.forEach(function(A){A.isPathComplete||A.terminate(F=="none")}),!s.result.matched)?(this.markedComplete||(this.markedComplete=!0,this.emit("complete")),[2]):F=="complete"&&this.touchpointCoordinator&&this.pushedSelector?(u=(G=this.touchpointCoordinator)===null||G===void 0?void 0:G.sustainSelectorSubstack(this.pushedSelector),I=u.map(function(A){var H=new J;return A.path.on("invalidated",function(){return H.resolve()}),A.path.on("complete",function(){return H.resolve()}),H.corePromise}),I.length>0&&s.result.action.awaitNested?[4,Promise.all(I)]:[3,3]):[3,4];case 1:return E.sent(),[4,Be(0)];case 2:E.sent(),E.label=3;case 3:(S=this.touchpointCoordinator)===null||S===void 0||S.popSelector(this.pushedSelector),this.pushedSelector=null,E.label=4;case 4:return this.emit("stage",a,function(A){A.type=="pop"?d.forEach(function(H){return H.popRecognizerConfig()}):d.forEach(function(H){return H.pushRecognizerConfig(A.config)})}),Q=!1,this.touchpointCoordinator&&(Q=!this.touchpointCoordinator.selectorStackIncludes(this.selector)),y=Yl(s.result.action,this.gestureConfig,this.baseGestureSetId),Q&&(y=y.filter(function(A){return A.sustainWhenNested})),y.length>0?(F=="chain"&&s.result.action.selectionMode==((k=this.pushedSelector)===null||k===void 0?void 0:k.baseGestureSetId)||(this.pushedSelector&&(this.pushedSelector.off("rejectionwithaction",this.modelResetHandler),(W=this.touchpointCoordinator)===null||W===void 0||W.popSelector(this.pushedSelector),this.pushedSelector=null),F=="chain"&&(U=s.result.action.selectionMode,U&&(b=new Dt(U),b.on("rejectionwithaction",this.modelResetHandler),this.pushedSelector=b,(Y=this.touchpointCoordinator)===null||Y===void 0||Y.pushSelector(b)))),C=(R=this.pushedSelector)!==null&&R!==void 0?R:this.selector,x=C.matchGesture(s.matcher,y),x.then(function(A){return(0,B.__awaiter)(X,void 0,void 0,function(){var H;return(0,B.__generator)(this,function(oe){switch(oe.label){case 0:return H=this.selectionHandler,[4,A.selectionPromise];case 1:return[2,H.apply(this,[oe.sent()])]}})})})):this.markedComplete||(this.markedComplete=!0,this.emit("complete")),[2]}})})},l.modelResetHandler=function(s,o){var a=s.matcher.allSourceIds;if(!l.allSourceIds.find(function(g){return a.indexOf(g)==-1}))if(s.result.action.type=="replace")o(qe(l.gestureConfig,s.result.action.replace));else throw new Error("Missed a case in implementation!")},l.stageReports=[],l.selector=i,l.selector.on("rejectionwithaction",l.modelResetHandler),l.once("complete",function(){var s;l.pushedSelector&&((s=l.touchpointCoordinator)===null||s===void 0||s.popSelector(l.pushedSelector),l.pushedSelector=null),l.selector.off("rejectionwithaction",l.modelResetHandler),l.selector.dropSourcesWithIds(l.allSourceIds),l.selector=null}),l.gestureConfig=n,l.touchpointCoordinator=r,Promise.resolve().then(function(){return l.selectionHandler(e)}),l}return Object.defineProperty(t.prototype,"allSourceIds",{get:function(){var e,n;return(n=(e=this.stageReports[this.stageReports.length-1])===null||e===void 0?void 0:e.allSourceIds)!==null&&n!==void 0?n:[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseGestureSetId",{get:function(){var e,n;return(n=(e=this.selector)===null||e===void 0?void 0:e.baseGestureSetId)!==null&&n!==void 0?n:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"potentialModelMatchIds",{get:function(){if(!this.selector)return[];var e=[this.selector];this.pushedSelector&&e.push(this.pushedSelector);var n=this.stageReports[this.stageReports.length-1],i=n.sources,r=i.map(function(l){return e.map(function(s){return s.potentialMatchersForSource(l).map(function(o){return o.model.id})})}).reduce(function(l,s){return l.concat(s)}).reduce(function(l,s){for(var o=0,a=s;o<a.length;o++){var g=a[o];l.indexOf(g)==-1&&l.push(g)}return l},[]);return r},enumerable:!1,configurable:!0}),t.prototype.cancel=function(){var e=this.stageReports[this.stageReports.length-1].sources;e.forEach(function(n){return n.baseSource.isPathComplete||n.baseSource.terminate(!0)}),this.markedComplete||(this.markedComplete=!0,this.emit("complete"))},t.prototype.toJSON=function(){return this.stageReports},t}(f.default);function Yl(c,t,e){switch(c.type){case"none":case"complete":return[];case"replace":return[qe(t,c.replace)];case"chain":return[qe(t,c.next)];default:throw new Error("Unexpected case arose within `processGestureAction` method")}}var Gc=function(c){(0,B.__extends)(t,c);function t(e,n,i){var r=c.call(this)||this;if(r.selectorStack=[new Dt],r._activeSources=[],r._activeGestures=[],r._history=[],r.modelResetHandler=function(a,g){var d=a.matcher.allSourceIds;if(!r.activeGestures.find(function(F){return F.allSourceIds.find(function(u){return d.indexOf(u)!=-1})}))if(a.result.action.type=="replace")g(qe(r.gestureModelDefinitions,a.result.action.replace));else throw new Error("Missed a case in implementation!")},r.onNewTrackedPath=function(a){return(0,B.__awaiter)(r,void 0,void 0,function(){var g,d,F,u,I,Q,y,U,b,C,x,X,p,V,L=this;return(0,B.__generator)(this,function(m){switch(m.label){case 0:this.addSimpleSourceHooks(a),g=this.gestureModelDefinitions,m.label=1;case 1:return d=this.currentSelector,u=d.matchGesture(a,hc(g,d.baseGestureSetId)),[4,u];case 2:return I=m.sent(),I.sustainModeWithoutMatch?(Q=function(G){G.stateToken=L.stateToken,G.item=a.currentRecognizerConfig.itemIdentifier(G,null)},a.path instanceof je&&a.path.coords.forEach(Q),a.stateToken=this.stateToken,a.baseItem=a.path.stats.initialSample.item,Q(a.path.stats.initialSample),Q(a.path.stats.lastSample),[3,3]):(F=I.selectionPromise,[3,4]);case 3:if(d!=this.currentSelector)return[3,1];m.label=4;case 4:y=this.currentSelector,a.setGestureMatchInspector(this.buildGestureMatchInspector(y)),U=function(){L.recordHistory(a)};try{a.path.on("invalidated",U),this.emit("inputstart",a)}catch(G){Ge("Error from 'inputstart' event listener",G)}return this.inputEngines.forEach(function(G){G.fulfillInputStart(a)}),[4,F];case 5:if(b=m.sent(),!b||b.result.matched==!1)return[2];for(C=b.matcher.allSourceIds,x=0,X=this._activeGestures;x<X.length;x++)if(p=X[x],p.allSourceIds.find(function(G){return!!C.find(function(S){return G==S})}))return[2];return V=new xc(b,g,this.currentSelector,this),this._activeGestures.push(V),V.on("complete",function(){var G=L._activeGestures.indexOf(V);G!=-1&&L._activeGestures.splice(G,1)}),a.path.wasCancelled||(a.path.off("invalidated",U),V.on("complete",function(){return L.recordHistory(V)})),this.emit("recognizedgesture",V),[2]}})})},r.historyMax=i>0?i:0,r.gestureModelDefinitions=e,r.inputEngines=[],n)for(var l=0,s=n;l<s.length;l++){var o=s[l];r.addEngine(o)}return r.selectorStack[0].on("rejectionwithaction",r.modelResetHandler),r}return t.prototype.pushSelector=function(e){this.selectorStack.push(e),e.on("rejectionwithaction",this.modelResetHandler)},t.prototype.sustainSelectorSubstack=function(e){if(!e)return[];var n=this.selectorStack.indexOf(e);if(n==-1)return[];if(this.selectorStack.length<=1)throw new Error("May not force the original, base gesture selector into sustain mode.");for(var i=[],r=n;r<this.selectorStack.length;r++)e=this.selectorStack[r],i=i.concat(e.cascadeTermination());return i},t.prototype.popSelector=function(e){if(!!e){var n=this.selectorStack.indexOf(e);if(n!=-1){if(this.selectorStack.length<=1)throw new Error("May not pop the original, base gesture selector.");for(;n<this.selectorStack.length;)e=this.selectorStack[n],e.off("rejectionwithaction",this.modelResetHandler),this.selectorStack.splice(n,1);this.currentSelector.stateToken=this.stateToken}}},t.prototype.selectorStackIncludes=function(e){return this.selectorStack.includes(e)},Object.defineProperty(t.prototype,"currentSelector",{get:function(){return this.selectorStack[this.selectorStack.length-1]},enumerable:!1,configurable:!0}),t.prototype.buildGestureMatchInspector=function(e){var n=this;return function(i){var r=n.selectorStack.indexOf(e),l=n.selectorStack.slice(r);return l.map(function(s){return s.potentialMatchersForSource(i).map(function(o){return o.model.id})}).reduce(function(s,o){return s.concat(o)})}},t.prototype.addEngine=function(e){e.on("pointstart",this.onNewTrackedPath),this.inputEngines.push(e)},t.prototype.recordHistory=function(e){var n=this.historyMax;n>0&&(this._history.length==n&&this._history.shift(),this._history.push(e))},Object.defineProperty(t.prototype,"activeGestures",{get:function(){return[].concat(this._activeGestures)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeSources",{get:function(){return[].concat(this.inputEngines.map(function(e){return e.activeSources}).reduce(function(e,n){return e.concat(n)},[]))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"history",{get:function(){return this._history},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"historyJSON",{get:function(){var e=function(n,i){return n=="item"?i==null?void 0:i.id:i};return JSON.stringify(this.history,e,2)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateToken",{get:function(){return this._stateToken},set:function(e){this._stateToken=e,this.inputEngines.forEach(function(n){return n.stateToken=e}),this.currentSelector.stateToken=e},enumerable:!1,configurable:!0}),t.prototype.addSimpleSourceHooks=function(e){var n=this;e.path.on("invalidated",function(){var i=n.activeGestures.find(function(l){return l.allSourceIds.includes(e.identifier)});i&&i.cancel();var r=n._activeSources.indexOf(e);n._activeSources=n._activeSources.splice(r,1)}),e.path.on("complete",function(){var i=n._activeSources.indexOf(e);n._activeSources=n._activeSources.splice(i,1)})},t}(f.default);var yt=function(c){(0,B.__extends)(t,c);function t(e,n){var i=this,r=Yt(n);return e=e||Cc,i=c.call(this,e,null,r.historyLength)||this,i.config=r,i.mouseEngine=new Ic(i.config),i.touchEngine=new Uc(i.config),i.mouseEngine.registerEventHandlers(),i.touchEngine.registerEventHandlers(),i.addEngine(i.mouseEngine),i.addEngine(i.touchEngine),i}return t.prototype.destroy=function(){this.activeGestures.forEach(function(e){return e.cancel()}),this.activeSources.forEach(function(e){return e.terminate(!0)}),this.mouseEngine.unregisterEventHandlers(),this.touchEngine.unregisterEventHandlers(),this.mouseEngine=null,this.touchEngine=null},t}(Gc);var On=["n","ne","e","se","s","sw","w","nw"],pc=Math.PI,_n=function(){for(var c=new Map,t=pc/4,e=0;e<On.length;e++)c.set(On[e],[t*e,1]);return c}();function Mt(c){return Math.PI/4*On.indexOf(c)}function It(c,t){var e=Mt(t),n=c.initialSample,i=c.lastSample.targetX-n.targetX,r=c.lastSample.targetY-n.targetY,l=Math.max(0,-r*Math.cos(e)),s=Math.max(0,i*Math.sin(e));return s+l}function wl(c,t,e,n){return function(i){var r=Mt(t),l=n.flick.triggerDist-n.flick.dirLockDist,s=Math.max(0,It(c.path.stats,t)-n.flick.dirLockDist),o=.7,a=Math.min(1,o*s/l),g=Math.sin(r)*a,d=-Math.cos(r)*a;e==null||e.scrollFlickPreview(g,d)}}var zt=Math.PI/3,Tl=function(){function c(t,e,n,i,r,l){var s=this;this.directlyEmitsKeys=!0,this.sequence=t,this.gestureParams=r,this.baseSpec=i.key.spec,this.baseKeyDistances=n.getSimpleTapCorrectionDistances(t.stageReports[0].sources[0].path.stats.initialSample,this.baseSpec);var o=t.stageReports[0].sources[0].baseSource,a=o;t.on("complete",function(){l==null||l.cancel()}),this.sequence.on("stage",function(d){var F,u=a.path.stats;s.computedFlickDistribution=s.flickDistribution(u,!0);var I=s.computedFlickDistribution[0].keySpec;if(d.matchedId=="flick-restart"){a.path.replaceInitialSample(d.sources[0].path.stats.initialSample);return}if(d.matchedId=="flick-reset-centering"){a=o.constructSubview(!0,!0);return}else if(d.matchedId=="flick-reset-end"){s.emitKey(n,s.baseSpec,a.path.stats);return}else if(d.matchedId=="flick-reset"){s.flickScroller&&(s.flickScroller(a.currentSample),a.path.off("step",s.flickScroller)),s.lockedDir=null,s.lockedSelectable=null,a instanceof le&&a.disconnect();return}else if(d.matchedId=="flick-mid"){if(I==s.baseSpec)return;var Q=Object.keys(s.baseSpec.flick).find(function(U){return s.baseSpec.flick[U]==I});s.lockedDir=Q,s.lockedSelectable=I,s.flickScroller&&a.path.off("step",s.flickScroller),s.flickScroller=wl(a,Q,l,s.gestureParams),s.flickScroller(a.currentSample),a.path.on("step",s.flickScroller);return}var y=(F=s.lockedSelectable)!==null&&F!==void 0?F:I;s.emitKey(n,y,u)});var g=this.buildPopupRecognitionConfig(n);e({type:"push",config:g})}return c.prototype.emitKey=function(t,e,n){var i,r=It(n,this.lockedDir);r>this.gestureParams.flick.triggerDist?i=t.keyEventFromSpec(e):i=t.keyEventFromSpec(this.baseSpec),i.keyDistribution=this.currentStageKeyDistribution(this.baseKeyDistances),t.raiseKeyEvent(i,null)},c.prototype.buildPopupRecognitionConfig=function(t){var e={getBoundingClientRect:function(){var n=Number.MAX_SAFE_INTEGER;return new DOMRect(-n,-n,2*n,2*n)}};return(0,B.__assign)((0,B.__assign)({},t.gestureEngine.config),{maxRoamingBounds:e,safeBounds:e})},c.prototype.cancel=function(){},c.prototype.flickDistribution=function(t,e){var n=this.baseSpec.flick,i=[{spec:this.baseSpec,coord:[NaN,0]}];i=i.concat(Object.keys(n).map(function(F){return{spec:n[F],coord:_n.get(F)}}));var r=t.angle,l=this.gestureParams.flick.triggerDist,s=Math.min(l,e?l:t.netDistance),o=s/l,a=0,g=i.map(function(F){var u=0,I=F.coord;if(!isNaN(I[0])){var Q=r-I[0],y=2*pc+I[0]-r;u=Math.min(Q*Q,y*y)}var U=zt*(I[1]-o),b=U*U,C=1/(u+b+1e-6);return a+=C,{keySpec:F.spec,p:C}}),d=1/a;return g.forEach(function(F){return F.p*=d}),g.sort(function(F,u){return u.p-F.p})},c.prototype.currentStageKeyDistribution=function(t){var e=this.baseSpec,n=this.baseKeyDistances,i=this.computedFlickDistribution,r=n.get(e);if(!r){var l=i[0];return[{keySpec:l.keySpec,p:1}]}var s=i.findIndex(function(g){return g.keySpec==e}),o=i.splice(s,1)[0].p,a=Ee(n);return i.concat(a.map(function(g){return{keySpec:g.keySpec,p:g.p*o}}))},c}(),Vc=Tl;var jn={longpress:{permitsFlick:function(){return!0},flickDistStart:8,flickDistFinal:40,waitLength:500,noiseTolerance:10},multitap:{waitLength:300,holdLength:150},flick:{startDist:10,dirLockDist:25,triggerDist:40}};function mc(c){var t=c.getBoundingClientRect();return{clientX:t.left+t.width/2,clientY:t.top+t.height/2}}function Xc(c){var t=mc(c);return function(e){var n=e.lastSample.clientX-t.clientX,i=e.lastSample.clientY-t.clientY;return Math.sqrt(n*n+i*i)}}function Qt(c){var t,e,n=c.key.spec;if(n.sk)return!1;var i=["K_SHIFT","K_ALT","K_CTRL","K_NUMERALS","K_SYMBOLS","K_CURRENCIES"];try{for(var r=(0,B.__values)(i),l=r.next();!l.done;l=r.next()){var s=l.value;if(n.id==s)return!0}}catch(o){t={error:o}}finally{try{l&&!l.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}if(n.nextlayer)switch(n.sp){case 1:case 2:case 3:case 4:return!0;default:return!1}else return!1}function qn(c,t){var e=function(F,u){if(!F)return!1;var I=F.key.spec;switch(u){case"modipress-start":return Qt(F);case"special-key-start":return["K_LOPT","K_ROPT","K_BKSP"].indexOf(I.baseKeyID)!=-1;case"longpress":return!0;case"multitap-start":case"modipress-multitap-start":return c.hasMultitaps?!!I.multitap:!1;case"flick-start":return!!I.flick;default:return!0}},n=t.roamingEnabled||(t.roamingEnabled=!c.hasFlicks),i=$(n?os(t):Rc(t)),r=$(n?ei(t):Jc(t)),l=$(Lc(t,!0,n));function s(F,u){F=$(F);var I=F.id;return typeof u=="number"&&(u=[u]),F.contacts.forEach(function(Q,y){var U;if(u.indexOf(y)!=-1){var b=(U=Q.model.allowsInitialState)!==null&&U!==void 0?U:function(){return!0};Q.model=(0,B.__assign)((0,B.__assign)({},Q.model),{allowsInitialState:function(C,x,X){return e(X,I)&&b(C,x,X)}})}}),F}var o=_l(),a=gs(),g=[s(l,0),s(ls(t),0),ss(t),i,r,s(o,0),jl(t),as(),s(a,0),ds(t),Fs(),Bs(),s(us(t),0),ys(t),Is()],d=[l.id,i.id,a.id,o.id];return n?(g.push(s(ql(t),0)),g.push($l())):(g.push(s(Sc(t),0)),g.push(ts(t)),g.push(ns(t)),g.push(is(t)),g.push(es(t)),g.push(cs()),g.push(rs(t)),d.push("flick-start")),{gestures:g,sets:{default:d,modipress:d.filter(function(F){return F!=a.id}),none:[]}}}function $n(){return{itemPriority:0,pathResolutionAction:"reject",pathModel:{evaluate:function(c){return"resolve"}}}}function Ze(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:function(c){return"resolve"}}}}function Dl(c){var t=c.flick;return{itemPriority:1,pathModel:{evaluate:function(e,n,i){var r=e.stats,l=i==null?void 0:i.key.spec;if(l&&l.sk){var s=l.flick,o=s.nw||s.n||s.ne;if(!o){var a=r.netDistance,g=r.angle,d=a*Math.cos(g);if(d>c.longpress.flickDistStart)return"reject"}}return r.netDistance>t.startDist?"resolve":null}},pathResolutionAction:"resolve",pathInheritance:"partial"}}function Zc(c,t){var e,n,i=t.key.spec.flick,r=Object.keys(i),l,s=0;try{for(var o=(0,B.__values)(r),a=o.next();!a.done;a=o.next()){var g=a.value,d=It(c,g);d>s&&(s=d,l=g)}}catch(F){e={error:F}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return{dir:l,dist:s}}function Ml(c){return{itemPriority:1,pathModel:{evaluate:function(t,e,n){var i=Zc(t.stats,n),r=i.dir,l=i.dist;if(l>c.flick.dirLockDist){var s=t.stats.angle,o=Mt(r),a=Math.abs(s-o),g=Math.abs(2*Math.PI+o-s);if(a<=zt||g<=zt)return"resolve"}else if(t.isComplete)return"reject"}},pathResolutionAction:"resolve",pathInheritance:"full"}}function zl(c){return{itemPriority:1,pathModel:{evaluate:function(t,e,n,i){if(t.isComplete)return"resolve";var r=Zc(i,n).dir;if(It(t.stats,r)<c.flick.dirLockDist)return"reject"}},pathResolutionAction:"resolve",pathInheritance:"full"}}function Kl(c,t,e){var n=c.longpress;return{itemPriority:0,pathResolutionAction:"resolve",timer:{duration:n.waitLength,expectedResult:!0},validateItem:function(i,r){return!!(r!=null&&r.key.spec.sk)},pathModel:{evaluate:function(i){var r,l,s=i.stats;if(t&&n.permitsFlick(s.lastSample.item)&&((l=((r=s.cardinalDirection)===null||r===void 0?void 0:r.indexOf("n"))!=-1)!==null&&l!==void 0?l:!1)){var o=s.netDistance,a=s.angle,g=o*Math.cos(a);if(g>n.flickDistFinal)return"resolve"}else if(e){if(s.rawDistance>n.noiseTolerance||s.lastSample.item!=s.initialSample.item)return"reject"}else if(s.lastSample.item!=s.initialSample.item)return"reject";return i.isComplete?"reject":null}}}}function fc(){return{itemPriority:-1,pathResolutionAction:"resolve",pathModel:{evaluate:function(c){return"resolve"}}}}function Pl(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:function(c){if(c.isComplete)return"reject"}}}}function vc(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:function(c){if(c.isComplete)return"resolve"}}}}function Kt(c,t){var e,n=(e=c==null?void 0:c.roamingEnabled)!==null&&e!==void 0?e:!0;return{itemPriority:0,itemChangeAction:n?"reject":void 0,pathResolutionAction:"resolve",pathInheritance:!n&&t?"full":"chop",pathModel:{evaluate:function(i){if(i.isComplete&&!i.wasCancelled)return"resolve"}}}}function Ol(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:function(c){if(c.isComplete&&!c.wasCancelled)return"resolve"}}}}function _l(){return{id:"special-key-start",resolutionPriority:0,contacts:[{model:(0,B.__assign)({},Ze()),endOnResolve:!1}],resolutionAction:{type:"chain",next:"special-key-end",item:"current"}}}function jl(c){return{id:"special-key-end",resolutionPriority:0,contacts:[{model:(0,B.__assign)((0,B.__assign)({},Kt(c)),{itemChangeAction:"resolve"}),endOnResolve:!0}],resolutionAction:{type:"complete",item:"none"}}}function Lc(c,t,e){var n={id:"longpress",resolutionPriority:4,contacts:[{model:(0,B.__assign)((0,B.__assign)({},Kl(c,t,e)),{itemPriority:1,pathInheritance:"chop"}),endOnResolve:!1},{model:$n(),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"subkey-select",selectionMode:"none",item:"none"}};return e?(0,B.__assign)((0,B.__assign)({},n),{rejectionActions:{path:{type:"replace",replace:"longpress-roam"},timer:{type:"replace",replace:"longpress-roam-restore"}}}):n}function ql(c){var t=Lc(c,!1,!0);return(0,B.__assign)((0,B.__assign)({},t),{id:"longpress-roam"})}function $l(){return{id:"longpress-roam-restore",contacts:[{model:{pathModel:{evaluate:function(c){return null}},itemChangeAction:"reject",pathInheritance:"full",pathResolutionAction:"reject",itemPriority:0}}],resolutionPriority:-1,rejectionActions:{item:{type:"replace",replace:"longpress-roam"}},resolutionAction:{type:"chain",next:"longpress-roam"}}}function Sc(c){return{id:"flick-start",resolutionPriority:3,contacts:[{model:Dl(c)}],resolutionAction:{type:"chain",item:"none",next:"flick-mid"}}}function es(c){var t=Sc(c);return(0,B.__assign)((0,B.__assign)({},t),{contacts:[(0,B.__assign)((0,B.__assign)({},t.contacts[0]),{model:(0,B.__assign)((0,B.__assign)({},t.contacts[0].model),{baseCoordReplacer:function(e,n){var i=mc(n),r=Xc(n),l=e.initialSample,s=r(e);if(s>c.flick.triggerDist)return i;var o=c.flick.dirLockDist;if(s<o)return l;var a=o/s,g=l.clientX-i.clientX,d=l.clientY-i.clientY;return{clientX:i.clientX+g*a,clientY:i.clientY+d*a}}})})],id:"flick-restart",sustainWhenNested:!0,rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}}})}function ts(c){return{id:"flick-mid",resolutionPriority:0,contacts:[{model:Ml(c),endOnReject:!0},{model:$n(),resetOnInstantFulfill:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}},resolutionAction:{type:"chain",item:"none",next:"flick-end"},sustainWhenNested:!0}}function ns(c){return{id:"flick-reset",resolutionPriority:1,contacts:[{model:(0,B.__assign)((0,B.__assign)({},Ze()),{pathInheritance:"partial"})}],resolutionAction:{type:"chain",next:"flick-reset-centering"},sustainWhenNested:!0}}function is(c){return{id:"flick-reset-centering",resolutionPriority:1,contacts:[{model:{pathModel:{evaluate:function(t,e,n){e||(e=t.stats);var i=Xc(n),r=i(t.stats),l=i(e);if(l<r)return"resolve"}},itemPriority:0,pathResolutionAction:"resolve",pathInheritance:"full"}}],resolutionAction:{type:"chain",next:"flick-restart"},sustainWhenNested:!0}}function cs(){return{id:"flick-reset-end",resolutionPriority:1,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"complete",item:"base"},sustainWhenNested:!0}}function rs(c){return{id:"flick-end",resolutionPriority:0,contacts:[{model:zl(c)},{model:Ze(),resetOnInstantFulfill:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset"}},resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}function ls(c){return{id:"multitap-start",resolutionPriority:2,contacts:[{model:(0,B.__assign)((0,B.__assign)({},Ze()),{itemPriority:1,pathInheritance:"reject",allowsInitialState:function(t,e,n){return t.item==n}})}],sustainTimer:{duration:c.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"multitap-end",item:"current"}}}function ss(c){return{id:"multitap-end",resolutionPriority:2,contacts:[{model:(0,B.__assign)((0,B.__assign)({},Kt(c)),{itemPriority:1,timer:{duration:c.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Ze(),resetOnInstantFulfill:!0}],rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"none"}}}function Rc(c){return{id:"initial-tap",resolutionPriority:1,contacts:[{model:(0,B.__assign)((0,B.__assign)({},Kt(c)),{pathInheritance:"chop",itemPriority:1,timer:{duration:c.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Ze(),resetOnInstantFulfill:!0}],sustainWhenNested:!0,rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"base"}}}function Jc(c){return{id:"simple-tap",resolutionPriority:1,contacts:[{model:(0,B.__assign)((0,B.__assign)({},Kt(c,!0)),{itemPriority:1}),endOnResolve:!0},{model:Ze(),resetOnInstantFulfill:!0}],sustainWhenNested:!0,resolutionAction:{type:"complete",item:"base"}}}function os(c){var t=Rc(c);return(0,B.__assign)((0,B.__assign)({},t),{rejectionActions:(0,B.__assign)((0,B.__assign)({},t.rejectionActions),{item:{type:"replace",replace:"initial-tap"}})})}function ei(c){var t=Jc(c);return(0,B.__assign)((0,B.__assign)({},t),{rejectionActions:(0,B.__assign)((0,B.__assign)({},t.rejectionActions),{item:{type:"replace",replace:"simple-tap"}})})}function as(){return{id:"subkey-select",resolutionPriority:0,contacts:[{model:(0,B.__assign)((0,B.__assign)({},Ol()),{pathInheritance:"full",itemPriority:1}),endOnResolve:!0,endOnReject:!0}],resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}function gs(){return{id:"modipress-start",resolutionPriority:5,contacts:[{model:(0,B.__assign)((0,B.__assign)({},fc()),{allowsInitialState:function(c,t,e){return Qt(e)},itemChangeAction:"reject",itemPriority:1})}],resolutionAction:{type:"chain",next:"modipress-hold",selectionMode:"modipress",item:"current"}}}function ds(c){return{id:"modipress-hold",resolutionPriority:5,contacts:[{model:(0,B.__assign)((0,B.__assign)({},Pl()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:c.multitap.holdLength,expectedResult:!0,inheritElapsed:!0}})},{model:(0,B.__assign)({},Ze()),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"},rejectionActions:{path:{type:"replace",replace:"modipress-end-multitap-transition"}}}}function Bs(){return{id:"modipress-end-multitap-transition",resolutionPriority:5,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"}}}function Fs(){return{id:"modipress-end",resolutionPriority:5,contacts:[{model:(0,B.__assign)((0,B.__assign)({},vc()),{itemChangeAction:"reject",pathInheritance:"full"})}],resolutionAction:{type:"complete",item:"none",awaitNested:!0}}}function us(c){return{id:"modipress-multitap-start",resolutionPriority:6,contacts:[{model:(0,B.__assign)((0,B.__assign)({},fc()),{pathInheritance:"reject",allowsInitialState:function(t,e,n){return t.item!=n?!1:Qt(n)},itemChangeAction:"reject",itemPriority:1})}],sustainTimer:{duration:c.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"modipress-multitap-end",selectionMode:"modipress",item:"current"}}}function ys(c){return{id:"modipress-multitap-end",resolutionPriority:5,contacts:[{model:(0,B.__assign)((0,B.__assign)({},vc()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:c.multitap.holdLength,expectedResult:!1}})},{model:(0,B.__assign)({},$n()),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"},rejectionActions:{timer:{type:"replace",replace:"modipress-multitap-lock-transition"},path:{type:"replace",replace:"modipress-multitap-lock-transition"}}}}function Is(){return{id:"modipress-multitap-lock-transition",resolutionPriority:5,contacts:[{model:(0,B.__assign)((0,B.__assign)({},Ze()),{pathResolutionAction:"resolve"})}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"}}}var Ec=(0,B.__assign)((0,B.__assign)({},$(ei(null))),{resolutionAction:{type:"complete",item:"current"}}),Ac={gestures:[Ec],sets:{default:[Ec.id]}};function Pt(c){var t;return typeof c=="string"?t=c:(t=c.style.fontSize,t||(t=getComputedStyle(c).fontSize)),new Z(t)}function Wc(c,t,e){if(c.touchable){var n=c.formFactor=="phone"?1.6*(e?.65:.6)*1.2:2;return Z.special(n,"em")}else return t?Z.inPixels(t/8):void 0}var Ut;function Ot(c,t,e){e={fontFamily:e.fontFamily,fontSize:e.fontSize},e.fontFamily||(e.fontFamily=getComputedStyle(document.body).fontFamily),(!e.fontSize||e.fontSize=="")&&(e.fontSize="1em");var n=e.fontFamily,i=Pt(e.fontSize),r;i.absolute?r=i.val+"px":r=i.val*t+"px",Ut=Ut!=null?Ut:document.createElement("canvas");var l=Ut.getContext("2d");l.font=r+" "+n;var s=l.measureText(c);return s}var Qs=10,Hc=function(){function c(t,e){this.totalLength=0,this.baseCoord=t,this.curCoord=t,this.baseScrollLeft=e,this.totalLength=0}return c.prototype.updateTo=function(t){var e=this.curCoord;this.curCoord=t;var n=this.baseCoord.targetX-this.curCoord.targetX+this.baseScrollLeft;return this.totalLength+=Math.abs(this.curCoord.targetX-e.targetX),n},Object.defineProperty(c.prototype,"hasScrolled",{get:function(){return this.totalLength>Qs},enumerable:!1,configurable:!0}),c}();var Nc="kmw-suggest-touched",Us="kmw-suggest-banner-scroller",kc=.666,Yc="swallow-fade-transition",bs=function(){function c(t,e){this.index=t,this.rtl=e!=null?e:!1,this.constructRoot();var n=this.display=N("span");n.className="kmw-suggestion-text",this.container.appendChild(n)}return Object.defineProperty(c.prototype,"computedStyle",{get:function(){return getComputedStyle(this.display)},enumerable:!1,configurable:!0}),c.prototype.constructRoot=function(){var t=this.div=N("div");t.className="kmw-suggest-option",t.id=c.BASE_ID+this.index,this.div.suggestion=this;var e=this.container=document.createElement("div");e.className="kmw-suggestion-container";var n=100-He.MARGIN*(He.LONG_SUGGESTION_DISPLAY_LIMIT-1),i=n/He.LONG_SUGGESTION_DISPLAY_LIMIT;e.style.minWidth=i+"%",t.appendChild(e)},c.prototype.matchKeyboardProperties=function(t){var e=this.div;if(t){t.KLC&&(e.lang=t.KLC);var n=t.KFont;n&&n.family&&n.family!=""&&(e.style.fontFamily=n.family)}},Object.defineProperty(c.prototype,"suggestion",{get:function(){return this._suggestion},enumerable:!1,configurable:!0}),c.prototype.update=function(t,e){this._suggestion=t;var n=this.generateSuggestionText(this.rtl);if(this.container.replaceChild(n,this.display),this.display=n,e.minWidth!==void 0&&(this._minWidth=e.minWidth),this._paddingWidth=e.paddingWidth,this._collapsedWidth=e.collapsedWidth,t&&t.displayAs){var i=Ot(t.displayAs,e.emSize,e.styleForFont);this._textWidth=i.width}else this._textWidth=0;this.currentWidth=this.collapsedWidth,this.updateLayout()},c.prototype.updateLayout=function(){if(!this.suggestion&&this.index!=0){this.div.style.width="0px";return}else this.div.style.width="";var t=this.container.style;t.minWidth=this.collapsedWidth+"px",this.rtl?t.marginRight=this.collapsedWidth-this.expandedWidth+"px":t.marginLeft=this.collapsedWidth-this.expandedWidth+"px",this.updateFade()},c.prototype.updateFade=function(){var t=this;this.div.classList.add(Yc),window.requestAnimationFrame(function(){t.div.classList.remove(Yc)}),this.div.classList.add("kmw-hide-fade-".concat(this.rtl?"left":"right"));var e="kmw-hide-fade-".concat(this.rtl?"right":"left");this.expandedWidth-this.collapsedWidth?this.div.classList.remove(e):this.div.classList.add(e)},Object.defineProperty(c.prototype,"targetCollapsedWidth",{get:function(){return this._collapsedWidth},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"textWidth",{get:function(){return this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"paddingWidth",{get:function(){return this._paddingWidth},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"minWidth",{get:function(){return this._minWidth},set:function(t){this._minWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"expandedWidth",{get:function(){return this.minWidth>this.spanWidth?this.minWidth:this.spanWidth},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"spanWidth",{get:function(){var t,e,n=(t=this.textWidth)!==null&&t!==void 0?t:0;return n&&(n+=(e=this.paddingWidth)!==null&&e!==void 0?e:0),n},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"collapsedWidth",{get:function(){var t=this.spanWidth<this.targetCollapsedWidth?this.spanWidth:this.targetCollapsedWidth,e=t<this.expandedWidth?t:this.expandedWidth;return this.minWidth>e?this.minWidth:e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"currentWidth",{get:function(){return this.div.offsetWidth},set:function(t){t<this.collapsedWidth?t=this.collapsedWidth:t>this.expandedWidth&&(t=this.expandedWidth),this.rtl?this.container.style.marginRight="".concat(t-this.expandedWidth,"px"):this.container.style.marginLeft="".concat(t-this.expandedWidth,"px")},enumerable:!1,configurable:!0}),c.prototype.highlight=function(t){var e=this.div;t?e.classList.add(Nc):e.classList.remove(Nc)},c.prototype.isEmpty=function(){return!this._suggestion},c.prototype.generateSuggestionText=function(t){var e=this._suggestion,n,i=N("span");if(i.className="kmw-suggestion-text",e==null)return i;if(e.displayAs==null||e.displayAs=="")n="\xA0";else{var r=t?8238:8237;n=String.fromCharCode(r)+e.displayAs}return i.innerHTML=n,i},c.BASE_ID="kmw-suggestion-",c}();var He=function(c){(0,B.__extends)(t,c);function t(e,n){var i=c.call(this,n||Qe.DEFAULT_HEIGHT)||this;return i.type="suggestion",i.currentSuggestions=[],i.options=[],i.separators=[],i.isRTL=!1,i.onSuggestionUpdate=function(r){var l;i.currentSuggestions=r,(l=i.highlightAnimation)===null||l===void 0||l.cancel();for(var s=i.options[0].computedStyle,o={fontSize:s.fontSize,fontFamily:s.fontFamily},a=getComputedStyle(document.body).fontSize,g=Pt(a).val,d=getComputedStyle(i.options[0].container.firstChild),F=i.width/t.LONG_SUGGESTION_DISPLAY_LIMIT,u=new Z(d.paddingLeft||"4px"),I=new Z(d.paddingRight||"4px"),Q={paddingWidth:u.val+I.val,emSize:g,styleForFont:o,collapsedWidth:F,minWidth:0},y=0;y<t.SUGGESTION_LIMIT;y++){var U=i.options[y];if(r.length>y){var b=r[y];U.update(b,Q)}else U.update(null,Q)}i.refreshLayout()},i.refreshLayout=function(){for(var r=[],l=0,s=Math.min(i.currentSuggestions.length,8),o=0;o<s;o++){var a=i.options[o];a.minWidth=0,l+=a.collapsedWidth,a.collapsedWidth<a.expandedWidth&&r.push(a)}if(s=s||1,l<i.width){for(var g=i.width*.01*(s-1),d=function(){var I=(i.width-l-g)/r.length;r.sort(function(b,C){return b.expandedWidth-C.expandedWidth});var Q=r[0],y=Q.expandedWidth-Q.collapsedWidth,U=Math.min(y,I);U>0&&(r.forEach(function(b){return b.minWidth=b.collapsedWidth+U}),l+=U*r.length),r.splice(0,1)};l<i.width&&r.length>0;)d();for(var F=(i.width-l-g)/s,o=0;o<s;o++){var u=i.options[o];u.minWidth=u.collapsedWidth+F,u.updateLayout()}}for(var o=0;o<t.SUGGESTION_LIMIT-1;o++)i.separators[o].style.display=o<s-1?"":"none"},i.getDiv().className=i.getDiv().className+" "+t.BANNER_CLASS,i.container=document.createElement("div"),i.container.className=Us,i.getDiv().appendChild(i.container),i.buildInternals(!1),i.gestureEngine=i.setupInputHandling(),i}return t.prototype.shutdown=function(){this.gestureEngine.destroy()},t.prototype.buildInternals=function(e){this.isRTL=e,this.options.length>0&&(this.options=[],this.separators=[]);for(var n=0;n<t.SUGGESTION_LIMIT;n++){var i=new bs(n,e);this.options[n]=i}for(var n=0;n<t.SUGGESTION_LIMIT;n++){var r=e?t.SUGGESTION_LIMIT-n-1:n;if(this.container.appendChild(this.options[r].div),e&&(this.container.scrollLeft=this.container.scrollWidth),n!=t.SUGGESTION_LIMIT-1){var l=N("div");l.className="kmw-banner-separator";var s=l.style;s.marginLeft="calc(".concat(t.MARGIN/2,"% - 0.5px)"),s.marginRight="calc(".concat(t.MARGIN/2,"% - 0.5px)"),this.container.appendChild(l),this.separators[r-(e?1:0)]=l}}},t.prototype.setupInputHandling=function(){var e=this,n=new Ue(this.getDiv(),[-Number.MAX_SAFE_INTEGER]);this.selectionBounds=new Ue(this.getDiv(),[-kc*this.height,-Number.MAX_SAFE_INTEGER]);var i={targetRoot:this.getDiv(),maxRoamingBounds:n,safeBounds:n,itemIdentifier:function(a){var g,d,F=e.selectionBounds.getBoundingClientRect();if(a.clientX<F.left||a.clientX>F.right||a.clientY<F.top||a.clientY>F.bottom)return null;var u=null,I=Number.MAX_VALUE;try{for(var Q=(0,B.__values)(e.options),y=Q.next();!y.done;y=Q.next()){var U=y.value,b=U.div.getBoundingClientRect();if(b.left<=a.clientX&&a.clientX<b.right)return U.suggestion?U:null;var C=(a.clientX<b.left?-1:1)*(a.clientX-b.left);C<I&&(I=C,u=U)}}catch(x){g={error:x}}finally{try{y&&!y.done&&(d=Q.return)&&d.call(Q)}finally{if(g)throw g.error}}return u.suggestion?u:null}},r=new yt(Ac,i),l={source:null,scrollingHandler:null,suggestion:null},s=function(a){a.highlight(!0),e.highlightAnimation&&(e.highlightAnimation.cancel(),e.highlightAnimation.decouple()),e.highlightAnimation=new wc(e.container,a,!1),e.highlightAnimation.expand()},o=function(a){a.highlight(!1),e.highlightAnimation||(e.highlightAnimation=new wc(e.container,a,!1)),e.highlightAnimation.collapse()};return r.on("inputstart",function(a){if(l.source){a.terminate(!0);return}e.scrollState=new Hc(a.currentSample,e.container.scrollLeft);var g=a.baseItem;l.source=a,l.scrollingHandler=function(F){var u,I=e.scrollState.updateTo(F);(u=e.highlightAnimation)===null||u===void 0||u.setBaseScroll(I);var Q=F.item?g:null;Q!=l.suggestion&&(l.suggestion&&o(l.suggestion),l.suggestion=Q,Q&&s(Q))},l.suggestion=a.currentSample.item,l.suggestion&&s(l.suggestion);var d=function(){l.suggestion&&(o(l.suggestion),l.suggestion=null),l.source=null,l.scrollingHandler=null};a.path.on("complete",d),a.path.on("invalidated",d),a.path.on("step",l.scrollingHandler)}),r.on("recognizedgesture",function(a){a.once("stage",function(g){var d=g.item;d&&!e.scrollState.hasScrolled&&e.predictionContext.accept(d.suggestion).then(function(){e.container.scrollLeft=e.isRTL?e.container.scrollWidth:0}),e.scrollState=null})}),r},t.prototype.update=function(){var e,n=c.prototype.update.call(this);return(e=this.selectionBounds)===null||e===void 0||e.updatePadding([-kc*this.height,-Number.MAX_SAFE_INTEGER]),n},t.prototype.configureForKeyboard=function(e,n){var i=e.isRTL;this.container.textContent="",this.buildInternals(i),this.options.forEach(function(r){return r.matchKeyboardProperties(n)}),this.onSuggestionUpdate(this.currentSuggestions)},Object.defineProperty(t.prototype,"predictionContext",{get:function(){return this._predictionContext},set:function(e){this._predictionContext&&this._predictionContext.off("update",this.onSuggestionUpdate),this._predictionContext=e,e&&(e.on("update",this.onSuggestionUpdate),this.onSuggestionUpdate(e.currentSuggestions))},enumerable:!1,configurable:!0}),t.SUGGESTION_LIMIT=8,t.LONG_SUGGESTION_DISPLAY_LIMIT=3,t.MARGIN=1,t}(Qe);var wc=function(){function c(t,e,n){var i=this;this.setScrollOffset=function(){if(!!i.scrollContainer){var r=i.option.currentWidth-i.option.collapsedWidth,l=i.option.rtl,s=Math.max(i.rootScrollOffset-i.option.div.offsetLeft,0),o=Math.max(i.option.div.offsetLeft+i.option.collapsedWidth-(i.rootScrollOffset+i.scrollContainer.offsetWidth)),a=Math.max(l?o:s,0),g=Math.max(i.collapsedScrollOffset+(l?0:1)*r,0)+(l?0:-1)*a,d=Math.max(i.rootScrollOffset+(l?0:1)*r,0)+(l?0:-1)*a,F=l?Math.max(g,d):Math.min(g,d),u=Math.max(l?i.option.div.offsetLeft+i.option.currentWidth-(F+i.scrollContainer.offsetWidth):F-i.option.div.offsetLeft,0),I=Math.min(r,u),Q=g+(l?1:-1)*I+(l?0:1)*a;if(i.scrollContainer.scrollLeft=Q,i.pendingAnimation){var y=i.scrollContainer.scrollLeft-Q;i.option.currentWidth+=y}}},this._expand=function(r){if(i.startTimestamp!==void 0){var l=r-i.startTimestamp,s=l>c.TRANSITION_TIME;s&&(l=c.TRANSITION_TIME);var o=i.option.expandedWidth-i.option.collapsedWidth,a=l/c.TRANSITION_TIME,g=o*a;i.option.currentWidth=g+i.option.collapsedWidth,s?i.clear():i.pendingAnimation=window.requestAnimationFrame(i._expand),i.setScrollOffset()}},this._collapse=function(r){if(i.startTimestamp!==void 0){var l=r-i.startTimestamp,s=l>c.TRANSITION_TIME;s&&(l=c.TRANSITION_TIME);var o=i.option.expandedWidth-i.option.collapsedWidth,a=1-l/c.TRANSITION_TIME,g=o*a;i.option.currentWidth=g+i.option.collapsedWidth,s?i.clear():i.pendingAnimation=window.requestAnimationFrame(i._collapse),i.setScrollOffset()}},this.scrollContainer=t,this.option=e,this.collapsedScrollOffset=t.scrollLeft,this.rootScrollOffset=t.scrollLeft}return c.prototype.setBaseScroll=function(t){this.collapsedScrollOffset=t,this.option.rtl?t>this.rootScrollOffset&&(this.rootScrollOffset=t):t<this.rootScrollOffset&&(this.rootScrollOffset=t),window.requestAnimationFrame(this.setScrollOffset)},c.prototype.decouple=function(){this.cancel(),this.scrollContainer=null},c.prototype.clear=function(){this.startTimestamp=null,window.cancelAnimationFrame(this.pendingAnimation),this.pendingAnimation=null},c.prototype.cancel=function(){this.clear(),this.option.currentWidth=this.option.collapsedWidth},c.prototype.expand=function(){this.clear(),this.startTimestamp=performance.now();var t=this.option.currentWidth-this.option.collapsedWidth,e=this.option.expandedWidth-this.option.collapsedWidth;t!=0&&(this.startTimestamp-=t/e*c.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._expand)},c.prototype.collapse=function(){this.clear(),this.startTimestamp=performance.now();var t=this.option.expandedWidth-this.option.currentWidth,e=this.option.expandedWidth-this.option.collapsedWidth;t!=0&&(this.startTimestamp-=t/e*c.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._collapse)},c.TRANSITION_TIME=250,c}();var Tc=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this)||this;n.type="html";var i=n.getDiv(),r=document.createElement("div");return r.style.userSelect="none",r.style.height="100%",r.style.width="100%",i.appendChild(r),n.container=r.attachShadow?r.attachShadow({mode:"closed"}):r,n.container.innerHTML=e,n}return Object.defineProperty(t.prototype,"innerHTML",{get:function(){return this.container.innerHTML},set:function(e){this.container.innerHTML=e},enumerable:!1,configurable:!0}),t}(Qe);var ti=function(){function c(t,e,n){this.ImageBanner=gc,this.HTMLBanner=Tc,this.hostDevice=e,this.container=t,this.predictionContext=n,this.inactiveBanner=new _e}return Object.defineProperty(c.prototype,"inactiveBanner",{get:function(){return this._inactiveBanner},set:function(t){this._inactiveBanner=t!=null?t:new _e,this.container.banner instanceof He||(this.container.banner=this._inactiveBanner)},enumerable:!1,configurable:!0}),c.prototype.activateBanner=function(t){var e=this.container.banner;if(e instanceof He&&(e.predictionContext=null),!t)this.container.banner=this.inactiveBanner;else{var n=new He(this.hostDevice,this.container.activeBannerHeight);n.predictionContext=this.predictionContext,this.container.banner=n}},c.prototype.selectBanner=function(t){this.activateBanner(t=="active"||t=="configured"),this.keyboard&&this.container.banner.configureForKeyboard(this.keyboard,this.keyboardStub)},c.prototype.configureForKeyboard=function(t,e){this.keyboard=t,this.keyboardStub=e,this.container.banner.configureForKeyboard(t,e)},c.prototype.shutdown=function(){this.container.banner instanceof He&&(this.container.banner.predictionContext=null)},c}();var hs=function(){function c(){var t=this.element=document.createElement("div");t.style.userSelect="none",t.className="kmw-osk-none"}return c.prototype.postInsert=function(){},c.prototype.updateState=function(){},c.prototype.refreshLayout=function(){},Object.defineProperty(c.prototype,"layoutHeight",{get:function(){return Z.inPixels(0)},enumerable:!1,configurable:!0}),c}(),bt=hs;var Cs=function(){function c(t){this.kbd=t;var e=this.element=document.createElement("div");e.style.userSelect="none",e.className="kmw-osk-static",e.id=c.ID,e.innerHTML=t.helpText}return c.prototype.postInsert=function(){if(!this.element.parentElement||!document.getElementById(c.ID))throw new Error("The HelpPage root element has not yet been inserted into the DOM.");this.kbd.hasScript&&this.kbd.embedScript(this.element.parentElement)},c.prototype.updateState=function(){},c.prototype.refreshLayout=function(){},Object.defineProperty(c.prototype,"layoutHeight",{get:function(){return Z.inPercent(100)},enumerable:!1,configurable:!0}),c.ID="kmw-osk-help-page",c}(),Dc=Cs;var xs={"*Shift*":8,"*Enter*":5,"*Tab*":6,"*BkSp*":4,"*Menu*":11,"*Hide*":10,"*Alt*":25,"*Ctrl*":1,"*Caps*":3,"*ABC*":16,"*abc*":17,"*123*":19,"*Symbol*":21,"*Currency*":20,"*Shifted*":9,"*AltGr*":2,"*TabLeft*":7,"*LAlt*":86,"*RAlt*":87,"*LCtrl*":88,"*RCtrl*":89,"*LAltCtrl*":96,"*RAltCtrl*":97,"*LAltCtrlShift*":98,"*RAltCtrlShift*":99,"*AltShift*":100,"*CtrlShift*":101,"*AltCtrlShift*":102,"*LAltShift*":103,"*RAltShift*":104,"*LCtrlShift*":105,"*RCtrlShift*":112,"*LTREnter*":5,"*LTRBkSp*":4,"*RTLEnter*":113,"*RTLBkSp*":114,"*ShiftLock*":115,"*ShiftedLock*":116,"*ZWNJ*":117,"*ZWNJiOS*":117,"*ZWNJAndroid*":118,"*ZWNJGeneric*":121,"*Sp*":128,"*NBSp*":130,"*NarNBSp*":131,"*EnQ*":132,"*EmQ*":133,"*EnSp*":134,"*EmSp*":135,"*PunctSp*":140,"*ThSp*":141,"*HSp*":142,"*ZWSp*":129,"*ZWJ*":119,"*WJ*":120,"*CGJ*":122,"*LTRM*":144,"*RTLM*":145,"*SH*":161,"*HTab*":162},ni=xs;var Gs=["default","shift","shift-on","special","special-on","","","","deadkey","blank","hidden"],De=Gs;function Me(c,t){switch(c){case"*ZWNJ*":c=t.device.OS==v.OperatingSystem.Android?"*ZWNJAndroid*":"*ZWNJiOS*";break;case"*Enter*":c=t.isRTL?"*RTLEnter*":"*LTREnter*";break;case"*BkSp*":c=t.isRTL?"*RTLBkSp*":"*LTRBkSp*";break;default:}var e=ni[c],n=57344+e;return e?String.fromCharCode(n):c}var ps=function(){function c(t,e){this.spec=t,this.layer=e}return c.prototype.setButtonClass=function(){var t,e=this.spec,n=this.btn,i=0;typeof e.dk=="string"&&e.dk=="1"&&(i=8),i=(t=e.sp)!==null&&t!==void 0?t:i,(i<0||i>10)&&(i=0),n.className="kmw-key kmw-key-"+De[i]},c.prototype.setToggleState=function(t){var e;switch(e=this.spec.sp,De[e]){case"shift":case"shift-on":t===void 0&&(t=De[e]=="shift"),this.spec.sp=1+(t?1:0);break;case"special":case"special-on":t===void 0&&(t=De[e]=="special"),this.spec.sp=3+(t?1:0);break;default:return}this.setButtonClass()},c.prototype.isFrameKey=function(){var t=this.spec.sp||0;switch(De[t]){case"default":case"deadkey":return!1;default:return!0}},c.prototype.allowsKeyTip=function(){return this.isFrameKey()?!1:!this.btn.classList.contains("kmw-spacebar")},c.prototype.highlight=function(t){var e=this.btn.classList;t?e.contains(c.HIGHLIGHT_CLASS)||e.add(c.HIGHLIGHT_CLASS):e.remove(c.HIGHLIGHT_CLASS)},c.prototype.getIdealFontSize=function(t,e,n){if(!this._fontFamily)return new Z("1em");n!=null||(n=1);var i=e.keyWidth,r=e.keyHeight,l=e.baseEmFontSize.scaledBy(e.layoutFontSize.val),s=this._fontSize;s.absolute||(s=l.scaledBy(s.val));var o={fontFamily:this._fontFamily,fontSize:s.styleString,height:e.keyHeight},a=Ot(t,l.scaledBy(n).val,o),g=.9,d=.9,F=2,u;a.fontBoundingBoxAscent&&(u=a.fontBoundingBoxAscent+a.fontBoundingBoxDescent);var I=u!=null?u:0,Q=i*g/(a.width+F),y=I&&r?r*d/I:void 0,U=Q;return y&&y<Q&&(U=y),Z.forScalar(n*Math.min(U,1))},Object.defineProperty(c.prototype,"keyText",{get:function(){var t=this.spec,e="\xA0",n=null;return t.text==null||t.text==""?n=e:(n=t.text,n=="*Tab*"&&this.layer=="shift"&&(n="*TabLeft*")),n},enumerable:!1,configurable:!0}),c.prototype.generateKeyText=function(t){var e=this.spec,n=document.createElement("span"),i=n.style;n.className="kmw-key-text";var r=this.keyText,l=Me(r,t);l!=r&&(r=l,e.font="SpecialOSK"),typeof e.font=="string"&&e.font!=""&&(i.fontFamily=e.font),typeof e.fontsize=="string"&&e.fontsize!=""&&(i.fontSize=e.fontsize);var s={fontSize:i.fontSize};return i.fontFamily?s.fontFamily=i.fontFamily:s.fontFamily=t.fontFamily,t.isRTL&&(r="\u200F"+r),n.innerText=r,n},c.prototype.resetFontPrecalc=function(){this._fontFamily=void 0,this._fontSize=void 0,this.label.style.fontSize=""},c.prototype.detectStyles=function(t){if(!(this.spec.sp==10||this.spec.sp==9)&&this._fontFamily===void 0){var e=getComputedStyle(this.label);if(!e.fontFamily)return;this._fontFamily=e.fontFamily;var n=new Z(e.fontSize),i=t.layoutFontSize;if(i.absolute)this._fontSize=n;else{var r=t.baseEmFontSize,l=i.scaledBy(r.val),s=n.val/l.val;this._fontSize=Z.forScalar(s)}}},c.prototype.refreshLayout=function(t){if(this.label)if(this.label.classList.contains("kmw-spacebar-caption")){var n=this.getIdealFontSize(this.keyText,t);this.label.style.setProperty("font-size",n.styleString,"important")}else{var e=this.label.textContent,n=this.getIdealFontSize(e,t);this.label.style.fontSize=n.styleString}},c.specialCharacters=ni,c.BUTTON_CLASSES=De,c.HIGHLIGHT_CLASS="kmw-key-touched",c}(),Ne=ps;var _t=function(){function c(t,e){this.key=t,this.keyId=e}return c}();function jt(c,t){var e=c;for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e}function Vs(c){return c&&"key"in c&&c.key instanceof Ne}function qt(c){return Vs(c)?c:null}var ms=function(c){(0,B.__extends)(t,c);function t(e,n,i){var r=c.call(this,e,n)||this;return r.row=i,r}return t.prototype.getId=function(){return this.spec.elementID},t.prototype.getCoreId=function(){return this.spec.coreID},t.prototype.getBaseId=function(){return this.spec.baseKeyID},t.prototype.generateKeyCapLabel=function(){var e=h.keyCodes[this.spec.baseKeyID];switch(e){case 186:e=59;break;case 187:e=61;break;case 188:e=44;break;case 189:e=45;break;case 190:e=46;break;case 191:e=47;break;case 192:e=96;break;case 219:e=91;break;case 220:e=92;break;case 221:e=93;break;case 222:e=39;break;default:(e<48||e>90)&&(e=0)}var n=document.createElement("div");return n.className="kmw-key-label",e>0&&(n.innerText=String.fromCharCode(e)),n},t.prototype.processSubkeys=function(e,n){var i,r=e.subKeys=this.spec.sk;for(i=0;i<r.length;i++){if(r[i].sp==1||r[i].sp==2){var l=r[i].text;r[i].text=Me(l,n)}r[i].layer||(r[i].layer=e.key.layer)}},t.prototype.construct=function(e){var n=this.spec,i=document.createElement("div");i.className="kmw-key-square";var r=document.createElement("div"),l=this.btn=jt(r,new _t(this,n.id));this.setButtonClass();var s=this.capLabel=this.generateKeyCapLabel();l.appendChild(s),l.id=this.getId(),l.appendChild(this.label=this.generateKeyText(e)),typeof n.sk!="undefined"&&n.sk!=null?this.processSubkeys(l,e):l.subKeys=null;var o=this.generateHint(e);return l.appendChild(o),i.appendChild(l),this.preview=document.createElement("div"),this.preview.style.display="none",l.appendChild(this.preview),this.square=i},t.prototype.generateHint=function(e){var n=document.createElement("div");n.className="kmw-key-popup-icon";var i=this.spec.hintSrc;if(!i)return n;if(i.font&&i.font!="SpecialOSK"?n.style.fontFamily=i.font:n.classList.add("kmw-key-text"),i.fontsize){var r=new Z(i.fontsize);n.style.fontSize=r.scaledBy(.5).styleString}var l=i==this.spec?this.spec.hint:i.text,s=Me(l,e);return s=="\u2022"&&(n.style.fontWeight="bold"),l!=s&&(n.style.fontFamily="SpecialOSK"),n.textContent=s,n},t.prototype.setPreview=function(e){var n=this,i=this.preview;e?(this.previewHost=e,this.preview=this.previewHost.element):(this.previewHost=null,this.preview=document.createElement("div"),this.preview.style.display="none"),e==null||e.setCancellationHandler(function(){n.setPreview(null)}),this.btn.replaceChild(this.preview,i)},t.prototype.refreshLayout=function(e){c.prototype.refreshLayout.call(this,e);var n=e.baseEmFontSize;n.val<12?this.capLabel.style.fontSize="6px":this.capLabel.style.fontSize=Z.forScalar(.5).styleString},Object.defineProperty(t.prototype,"displaysKeyCap",{get:function(){return this.capLabel&&this.capLabel.style.display=="block"},set:function(e){if(!this.capLabel)throw new Error("Key element not yet constructed; cannot display key cap");this.capLabel.style.display=e?"block":"none"},enumerable:!1,configurable:!0}),t}(Ne),Mc=ms;var $t=.15,Xs=function(){function c(t,e,n){var i=this.element=document.createElement("div");i.className="kmw-key-row",this.heightFraction=1/e.row.length;var r=n.key;this.spec=n,this.keys=[];for(var l=0;l<r.length;l++){var s=r[l],o=new Mc(s,e.id,this),a=o.construct(t);this.keys.push(o),i.appendChild(a)}}return Object.defineProperty(c.prototype,"displaysKeyCaps",{get:function(){if(this.keys.length>0)return this.keys[0].displaysKeyCap},set:function(t){var e,n;try{for(var i=(0,B.__values)(this.keys),r=i.next();!r.done;r=i.next()){var l=r.value;l.displaysKeyCap=t}}catch(s){e={error:s}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},enumerable:!1,configurable:!0}),c.prototype.refreshLayout=function(t){var e=this.element.style,n=t.heightStyle.scaledBy(this.heightFraction);e.maxHeight=e.lineHeight=e.height=n.styleString;var i=t.heightStyle.absolute?n:Z.forScalar(1),r=i.scaledBy($t/2),l=i.scaledBy(1-$t);this.keys.forEach(function(s){var o=s.square,a=s.btn,g=o.style;g.height=g.minHeight=i.styleString;var d=a.style;d.top=r.styleString,d.height=d.lineHeight=d.minHeight=l.styleString})},c.prototype.buildKeyLayout=function(t,e){var n=t.widthStyle.scaledBy(e.spec.proportionalWidth),i=t.heightStyle.scaledBy(this.heightFraction).scaledBy(1-$t),r={keyWidth:n.val*(n.absolute?1:t.keyboardWidth),keyHeight:i.val*(i.absolute?1:t.keyboardHeight),baseEmFontSize:t.baseEmFontSize,layoutFontSize:t.layoutFontSize};return r},c.prototype.detectStyles=function(t){var e=this;this.keys.forEach(function(n){n.detectStyles(e.buildKeyLayout(t,n))})},c.prototype.refreshKeyLayouts=function(t){var e=this;this.keys.forEach(function(n){var i,r=n.btn,l=t.widthStyle,s=t.heightStyle,o=l.scaledBy(n.spec.proportionalWidth),a=l.scaledBy(n.spec.proportionalPad),g=s.scaledBy(e.heightFraction).scaledBy(1-$t),d=s.absolute?g.styleString:"100%",F=e.buildKeyLayout(t,n);(i=r.key)===null||i===void 0||i.refreshLayout(F),n.square.style.width=o.styleString,n.square.style.marginLeft=a.styleString,n.btn.style.width=l.absolute?o.styleString:"100%",n.square.style.height=d})},c}(),zc=Xs;var Zs=function(){function c(t,e,n){this.spec=n;var i=this.element=document.createElement("div"),r=i.style;i.className="kmw-key-layer";var l=n.row.length;l>4&&t.device.formFactor=="phone"&&(i.className=i.className+" kmw-5rows"),r.fontFamily="font"in e?e.font:"",this.nextlayer=n.id,i.layer=n.id,typeof n.nextlayer=="string"&&(i.nextLayer=this.nextlayer=n.nextlayer);var s=n.row;this.rows=[];for(var o=0;o<s.length;o++){var a=new zc(t,n,s[o]);a.displaysKeyCaps=e.displayUnderlying,i.appendChild(a.element),this.rows.push(a)}if(t.device.touchable&&(this.globeKey=this.findKey("K_LOPT"),this.hideKey=this.findKey("K_ROPT")),this.spaceBarKey=this.findKey("K_SPACE"),this.capsKey=this.findKey("K_CAPS"),this.numKey=this.findKey("K_NUMLOCK"),this.scrollKey=this.findKey("K_SCROLL"),this.spaceBarKey){var g=this.spaceBarKey.label,d=this.spaceBarKey.btn;typeof d.className=="undefined"||d.className==""?d.className="kmw-spacebar":d.className.indexOf("kmw-spacebar")==-1&&(d.className+=" kmw-spacebar"),g.className!="kmw-spacebar-caption"&&(g.className="kmw-spacebar-caption")}}return Object.defineProperty(c.prototype,"rowHeight",{get:function(){return this._rowHeight},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"id",{get:function(){return this.spec.id},enumerable:!1,configurable:!0}),c.prototype.findKey=function(t){var e,n,i,r;try{for(var l=(0,B.__values)(this.rows),s=l.next();!s.done;s=l.next()){var o=s.value;try{for(var a=(i=void 0,(0,B.__values)(o.keys)),g=a.next();!g.done;g=a.next()){var d=g.value;if(d.getBaseId()==t)return d}}catch(F){i={error:F}}finally{try{g&&!g.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}}}catch(F){e={error:F}}finally{try{s&&!s.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}return null},c.prototype.showLanguage=function(t){if(!!this.spaceBarKey)try{var e=this.spaceBarKey.label;this.spaceBarKey.spec.text=t,(e.innerText!=t||t=="")&&(e.innerText=t)}catch(n){}},c.prototype.refreshLayout=function(t){var e,n;this.rows.forEach(function(I){return I.detectStyles(t)});var i=t.keyboardHeight,r=this.rows.length,l=this._rowHeight=Math.floor(i/(r==0?1:r)),s=t.widthStyle.absolute;s&&(this.element.style.height=i+"px"),this.showLanguage(t.spacebarText);for(var o=0;o<r;o++){var a=this.rows[o],g=(r-o-1)*l+1;s&&(this.spec.row[o].proportionalY=(i-g-l/2)/i),a.refreshLayout(t),o==r-1&&(a.element.style.bottom="1px")}try{for(var d=(0,B.__values)(this.rows),F=d.next();!F.done;F=d.next()){var u=F.value;u.refreshKeyLayouts(t)}}catch(I){e={error:I}}finally{try{F&&!F.done&&(n=d.return)&&n.call(d)}finally{if(e)throw e.error}}},c}(),Kc=Zs;var fs=.06,vs=function(){function c(t,e,n){this.layers={},this._activeLayerId="default";var i=e.layout(n);this.spec=i;var r=this.element=document.createElement("div"),l=r.style;if(r.className="kmw-key-layer-group",i!=null){var s=i.fontsize;typeof s=="undefined"||s==null||s==""?l.fontSize="1em":l.fontSize=i.fontsize,l.width="100%",l.height="100%";var o,a;a=i.layer;var g=t.getDefaultKeyObject();for(g.fontsize=l.fontSize,o=0;o<a.length;o++){var d=a[o],F=new Kc(t,i,d);this.layers[d.id]=F,F.element.style.display=d.id=="default"?"block":"none",r.appendChild(F.element)}}}return Object.defineProperty(c.prototype,"activeLayer",{get:function(){return this.activeLayerId?this.layers[this.activeLayerId]:null},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"activeLayerId",{get:function(){return this._activeLayerId},set:function(t){var e,n;this._activeLayerId=t;try{for(var i=(0,B.__values)(Object.keys(this.layers)),r=i.next();!r.done;r=i.next()){var l=r.value,s=this.layers[l],o=s.element;s.id==t?o.style.display="block":o.style.display="none"}}catch(a){e={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}},enumerable:!1,configurable:!0}),c.prototype.findNearestKey=function(t){if(!t)return null;var e=t.stateToken;if(!e)throw new Error("Layer id not set for input coordinate");var n=this.layers[e];if(!n)throw new Error("Layer id ".concat(e," could not be found"));return this.nearestKey(t,n)},c.prototype.blinkLayer=function(t){var e=this;if(typeof t=="string"){var n=t;if(t=this.layers[n],!t)throw new Error("Layer id ".concat(n," could not be found"))}var i=t;if(i.element.style.display!="block")for(var r in this.layers){if(this.layers[r].element.style.display=="block"){var l=this.layers[r];l.element.style.display="none"}this.layers[r].element.style.display="none"}i.element.style.display="block",Promise.resolve().then(function(){var s=e.layers[e._activeLayerId];(i.element.style.display=="block"||s.element.style.display!="block")&&(i.element.style.display="none",s.element.style.display="block")})},c.prototype.nearestKey=function(t,e){var n,i;if(e.rows.length==0)return null;var r={x:t.targetX/this.computedWidth,y:t.targetY/this.computedHeight};if(!isFinite(r.x)||!isFinite(r.y))return null;var l=Math.max(0,Math.min(e.rows.length-1,Math.floor(r.y*e.rows.length))),s=e.rows[l],o=null,a=Number.MAX_VALUE;try{for(var g=(0,B.__values)(s.keys),d=g.next();!d.done;d=g.next()){var F=d.value,u=F.spec;if(!(u.sp==9||u.sp==10)){var I=u.proportionalWidth/2,Q=Math.abs(r.x-u.proportionalX);if(Q-I<=0)return F.btn;var y=Q-I;y<a&&(a=y,o=F)}}}catch(U){n={error:U}}finally{try{d&&!d.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}return a<=fs?o.btn:null},c.prototype.resetPrecalcFontSizes=function(){var t,e,n,i,r,l;try{for(var s=(0,B.__values)(Object.values(this.layers)),o=s.next();!o.done;o=s.next()){var a=o.value;try{for(var g=(n=void 0,(0,B.__values)(a.rows)),d=g.next();!d.done;d=g.next()){var F=d.value;try{for(var u=(r=void 0,(0,B.__values)(F.keys)),I=u.next();!I.done;I=u.next()){var Q=I.value;Q.resetFontPrecalc()}}catch(y){r={error:y}}finally{try{I&&!I.done&&(l=u.return)&&l.call(u)}finally{if(r)throw r.error}}}}catch(y){n={error:y}}finally{try{d&&!d.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}}}catch(y){t={error:y}}finally{try{o&&!o.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}this._heightPadding=void 0},c.prototype.refreshLayout=function(t){if(!(isNaN(t.keyboardWidth)||isNaN(t.keyboardHeight))){if(this.computedWidth=t.keyboardWidth,this.computedHeight=t.keyboardHeight,this._heightPadding===void 0){var e=getComputedStyle(this.element),n=parseInt(e.paddingTop,10)||0,i=parseInt(e.paddingBottom,10)||0;this._heightPadding=n+i}this.activeLayer&&this.activeLayer.refreshLayout(t)}},Object.defineProperty(c.prototype,"verticalPadding",{get:function(){var t;return(t=this._heightPadding)!==null&&t!==void 0?t:0},enumerable:!1,configurable:!0}),c}(),Pc=vs;var Oc="kmw-",_c="top",Ls=function(){function c(t,e){var n=this;this.state=!1,this.orientation=_c,this.vkbd=t;var i=this.element=document.createElement("div");i.className="kmw-keytip",i.id="kmw-keytip",i.style.pointerEvents="none",i.style.display="none",i.appendChild(this.tip=document.createElement("div")),i.appendChild(this.cap=document.createElement("div")),this.tip.appendChild(this.preview=document.createElement("div")),this.tip.className="kmw-keytip-tip",this.cap.className="kmw-keytip-cap",this.constrain=e,this.reorient=function(r){n.orientation=r,n.show(n.key,n.state,n.previewHost)}}return c.prototype.show=function(t,e,n){var i=this,r,l=this.vkbd;if(e&&l.layerGroup.blinkLayer(t.key.spec.displayLayer),e&&t.offsetParent){var s=t.key.row.element,o=t.getClientRects()[0],a=s.getClientRects()[0],g=o.left-a.left,d=o.width,F=o.height,u=1.8,I=this.element.style,Q=l.topContainer,y=Q.getBoundingClientRect(),U=t.getBoundingClientRect(),b=void 0,C=this.orientation,x=U.bottom-y.top;b=x+(C=="top"?1:-1);var X=b-Math.floor(b),p=d+Math.ceil(d*.3)*2,V=Math.ceil(2.3*F)+X;C=="bottom"&&(b+=V-F),I.top="auto";var L=C=="top"?"bottom":"top";this.tip.classList.remove("".concat(Oc).concat(L)),this.tip.classList.add("".concat(Oc).concat(C)),I.bottom=Math.floor(y.height-b)+"px",I.textAlign="center",I.overflow="visible",I.width=p+"px",I.height=V+"px";var m=this.vkbd.currentLayer.element.style.fontFamily,G=getComputedStyle(l.element);I.fontFamily=t.key.spec.font||m||G.fontFamily;var S=parseInt(G.fontSize,10);if(S==Number.NaN&&(S=0),S!=0){var k={keyWidth:1.6*d,keyHeight:1.6*F,baseEmFontSize:l.getKeyEmFontSize(),layoutFontSize:new Z(l.kbdDiv.style.fontSize)};I.fontSize=t.key.getIdealFontSize(t.key.keyText,k,u).styleString}var W=(p-d)/2;g<W?(this.cap.style.left="1px",g+=W-1):g>window.innerWidth-d-W?(this.cap.style.left=p-d-1+"px",g-=W-1):this.cap.style.left=W+"px",I.left=g-W+"px";var Y=getComputedStyle(this.element),R=y.height,E=parseFloat(Y.bottom),A=parseFloat(Y.height),H=Math.ceil(V/2);this.cap.style.width=d+"px",this.tip.style.height=H+"px";var oe=3,ie=H-oe+"px";C=="top"?(this.cap.style.top=ie,this.cap.style.bottom=""):(this.cap.style.top="",this.cap.style.bottom=ie);var Ke=x-Math.floor(b)+V-(C=="top"?H:-oe*2);if(this.cap.style.height=Ke+"px",this.constrain&&A+E>R){var it=A+E-R;I.height=V-it+"px";var cn=Math.max(0,V-it-V/2+2);this.cap.style.height=cn+"px"}else E<0&&(I.bottom="0px",this.cap.style.height=Math.max(0,Ke+E)+"px");if(I.display="block",this.previewHost==n)return;var Rr=this.preview;this.previewHost&&this.previewHost.off("preferredOrientation",this.reorient),this.previewHost=n,n&&(this.previewHost.on("preferredOrientation",this.reorient),this.preview=this.previewHost.element,this.tip.replaceChild(this.preview,Rr),n.setCancellationHandler(function(){return i.show(null,!1,null)}),n.on("startFade",function(){i.element.classList.remove("kmw-preview-fade"),i.element.offsetWidth,i.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",(r=this.previewHost)===null||r===void 0||r.off("preferredOrientation",this.reorient),this.previewHost=null;var Jr=this.preview;this.preview=document.createElement("div"),this.tip.replaceChild(this.preview,Jr),this.element.classList.remove("kmw-preview-fade"),this.orientation=_c}this.key=t,this.state=e},c}(),jc=Ls;var ii="kmw-keypreview",Ss="kmw-preview-overlay",Rs="kmw-keytip",qc=function(){function c(t){this.state=!1,this.vkbd=t;var e=this.element=document.createElement("div");e.className=ii,e.id="kmw-keytip",e.style.pointerEvents="none",e.style.display="none",this.preview=document.createElement("div"),e.appendChild(this.preview)}return c.prototype.show=function(t,e,n){var i=this,r=this.vkbd,l=t==null?void 0:t.key.spec.displayLayer;if(e&&r.layerGroup.blinkLayer(l),e&&(t==null?void 0:t.offsetParent)){var s=this.vkbd.topContainer.getBoundingClientRect(),o=t.getBoundingClientRect(),a=l!=r.layerId?Ss:"";this.element.className="".concat(ii," ").concat(t.className," ").concat(a),this.element.id="".concat(Rs,"-").concat(t.id);var g=this.element.style,d=this.vkbd.currentLayer.element.style.fontFamily;if(g.fontFamily=t.key.spec.font||d,g.left=o.left-s.left+"px",g.top=o.top-s.top+"px",g.width=o.width+"px",g.height=o.height+"px",this.element.style.display="block",this.previewHost==n)return;var F=this.preview;this.previewHost=n,n&&(this.preview=this.previewHost.element,this.element.replaceChild(this.preview,F),n.setCancellationHandler(function(){return i.show(null,!1,null)}),n.on("startFade",function(){i.element.classList.remove("kmw-preview-fade"),i.element.offsetWidth,i.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",this.element.className=ii,this.previewHost=null;var u=this.preview;this.preview=document.createElement("div"),this.element.replaceChild(this.preview,u),this.element.classList.remove("kmw-preview-fade")}this.key=t,this.state=e},c}();function be(c){try{if(c=="desktop")return 1;var t=document.documentElement.clientWidth;if(screen.width>t)return 1;var e=screen.width;return re()?screen.width<screen.height&&(e=screen.height):screen.width>screen.height&&(e=screen.height),Math.round(100*e/t)/100}catch(n){return 1}}var $c=function(){function c(t,e){var n=this;this.directlyEmitsKeys=!0,this.hasModalVisualization=!1,this.deleteRepeater=function(){n.repeatClosure(),n.timerHandle=window.setTimeout(n.deleteRepeater,c.REPEAT_DELAY)},this.source=t;var i=t.stageReports[0].item;i.key.highlight(!0),this.repeatClosure=function(){e(),i.key.highlight(!0)},this.timerHandle=window.setTimeout(this.deleteRepeater,c.INITIAL_DELAY),this.source.on("complete",function(){window.clearTimeout(n.timerHandle),n.timerHandle=void 0,i.key.highlight(!1)})}return c.prototype.cancel=function(){this.deleteRepeater(),this.source.cancel()},c.prototype.currentStageKeyDistribution=function(){return null},c.INITIAL_DELAY=500,c.REPEAT_DELAY=100,c}();var Js=function(c){(0,B.__extends)(t,c);function t(e,n){if(typeof n!="string"||n=="")throw"The 'layer' parameter for subkey construction must be properly defined.";return c.call(this,e,n)||this}return t.prototype.getId=function(){return"popup-"+this.layer+"-"+this.spec.id},t.prototype.construct=function(e,n,i,r){var l=this.spec,s=document.createElement("div"),o=s.style;s.className="kmw-key-square-ex",r&&(o.marginTop="5px"),o.width=i+"px",o.height=n.offsetHeight+"px";var a=document.createElement("div"),g=this.btn=jt(a,new _t(this,l.id));this.setButtonClass(),g.id=this.getId();var d=g.style;return d.height=o.height,d.lineHeight=n.style.lineHeight,d.width=o.width,d.position="absolute",g.appendChild(this.label=this.generateKeyText(e)),s.appendChild(g),this.square=s},t.prototype.allowsKeyTip=function(){return!1},t}(Ne),er=Js;var tr=.2,Es=1.2,ir=3,$e=5,nr=6+ir,As=function(){function c(t,e,n,i,r){var l=this,s;this.directlyEmitsKeys=!0,this.shouldLockLayer=!1,this.baseKey=i,this.source=t,this.gestureParams=r,n.layerLocked&&(this.shouldLockLayer=!0),t.on("complete",function(){var m;(m=l.currentSelection)===null||m===void 0||m.key.highlight(!1),l.clear()}),t.on("stage",function(){var m=l.currentSelection;if(m){var G=n.keyEventFromSpec(m.key.spec);G.keyDistribution=l.currentStageKeyDistribution(),n.raiseKeyEvent(G,m)}});var o=t.stageReports[0].sources[0].constructSubview(!0,!1);o.path.on("step",function(m){var G,S;o.path.stats.netDistance>=4&&((G=l.currentSelection)===null||G===void 0||G.key.highlight(!1),(S=m.item)===null||S===void 0||S.key.highlight(!0),l.currentSelection=m.item)}),this.currentSelection=i,i.key.highlight(!0);var a=i.subKeys,g=this.element=document.createElement("div");g.id="kmw-popup-keys";var d=g.style;d.fontFamily=n.fontFamily;var F=getComputedStyle(i);d.fontSize=F.fontSize,d.visibility="hidden";var u=i.key.layer;(typeof u!="string"||u=="")&&(u=n.layerId);var I=a.length,Q=Math.ceil(I/9),y=Math.ceil(I/Q);this.subkeys=[];for(var U=$e,b=0,C=0,x=0;C<I;C++,x++){var X=typeof a[C].width!="undefined"?a[C].width*i.offsetWidth/100:i.offsetWidth;X>n.width-2*$e&&(X=n.width-2*$e),(U+X+$e>n.width||x>=y)&&(b++,x=0,U=$e);var p=new er(a[C],u),V=p.construct(n,i,X,b>0);U+=X+$e,this.menuWidth=Math.max((s=this.menuWidth)!==null&&s!==void 0?s:0,U),this.subkeys.push(V.firstChild),g.appendChild(V)}d.width=this.menuWidth+"px",this.shim=document.createElement("div"),this.shim.id="kmw-popup-shim",n.device.formFactor==v.FormFactor.Phone&&this.selectDefaultSubkey(i,g),n.element.appendChild(this.element),n.topContainer.appendChild(this.shim),this.reposition(n);var L=this.buildPopupRecognitionConfig(n);e({type:"push",config:L})}return c.prototype.buildPopupRecognitionConfig=function(t){var e=this,n=this.element.getBoundingClientRect(),i=this.baseKey.getBoundingClientRect(),r=this.subkeys[0].style,l=Number.parseInt(r.height,10),s=-.666*l,o=3,a=i.bottom-n.bottom,g=new Ue(this.element,[s*o,s,-a<s?-a:s]),d={getBoundingClientRect:function(){var F=Number.MAX_SAFE_INTEGER;return new DOMRect(-F,-F,2*F,2*F)}};return{targetRoot:this.element,inputStartBounds:t.element,maxRoamingBounds:d,safeBounds:d,itemIdentifier:function(F,u){var I,Q,y=g.getBoundingClientRect(),U=null,b=Number.MAX_VALUE,C=Number.MAX_VALUE;if(F.clientX<y.left||F.clientX>y.right||F.clientY<y.top||F.clientY>y.bottom)return null;try{for(var x=(0,B.__values)(e.subkeys),X=x.next();!X.done;X=x.next()){var p=X.value,V=p.getBoundingClientRect(),L=Number.MAX_VALUE,m=Number.MAX_VALUE;if(V.left<=F.clientX&&F.clientX<V.right?L=0:L=V.left>=F.clientX?V.left-F.clientX:F.clientX-V.right,V.top<=F.clientY&&F.clientY<V.bottom?m=0:m=V.top>=F.clientY?V.top-F.clientY:F.clientY-V.bottom,L==0&&m==0)return p;(L<C||L==C&&m<b)&&(C=L,U=p,b=m)}}catch(G){I={error:G}}finally{try{X&&!X.done&&(Q=x.return)&&Q.call(x)}finally{if(I)throw I.error}}return U}}},c.prototype.reposition=function(t){var e=this.element,n=this.baseKey,i=t.topContainer,r=n.key.row.element,l=e.style,s=n.offsetParent?n.offsetParent.offsetLeft:0,o=n.offsetLeft+s+.5*(n.offsetWidth-e.offsetWidth),a=t.width-e.offsetWidth;o>a&&(o=a),o<0&&(o=0),l.left=o+"px";var g=i.getBoundingClientRect(),d=r.getBoundingClientRect();l.top=d.top-g.top-e.offsetHeight-ir+"px",l.visibility="visible";var F=t.isEmbedded,u=getComputedStyle(e),I=parseFloat(u.top),Q=0,y=0;I<Q&&F&&(y=Q-I,l.top=Q+"px"),this.callout=this.addCallout(n,y,t.element,t.topContainer,t.device.formFactor=="tablet")},c.prototype.addCallout=function(t,e,n,i,r){e=e||0;var l=getComputedStyle(this.element),s=Math.max(Number.parseInt(l.borderRadius),0),o=t.getBoundingClientRect(),a=i.getBoundingClientRect(),g=Math.floor(Number.parseInt(l.top,10)+Number.parseInt(l.height,10)+Number.parseInt(l.paddingTop,10)/2+Number.parseInt(l.paddingBottom,10)),d=tr*(o.height-e),F=tr*o.height,u=d+nr,I=u/(F+nr),Q=o.bottom-a.top-g-1,y=Q<u?Q:u;if(y>0){var U=document.createElement("div"),b=U.style;U.id="kmw-popup-callout",n.appendChild(U),b.top=g+"px",b.borderTopWidth=y+"px";var C=Es*I,x=o.width*C,X=this.menuWidth-2*s,p=X<x?X:x,V=o.left-a.left-(p-o.width)/2,L=Math.max(0,V+p-(a.right-s)),m=Math.max(0,s-V);return b.left=o.left-a.left-(p-o.width)/2+m+"px",b.borderLeftWidth=p/2-m+"px",b.borderRightWidth=p/2-L+"px",U}else return null},c.prototype.selectDefaultSubkey=function(t,e){for(var n,i,r=t.subKeys,l=0;l<r.length;l++){var s=r[l],o=e.childNodes[l].firstChild;if(s.default){i=o;break}else if(!t.key||!t.key.spec)continue;s.elementID==t.key.spec.elementID&&(i=o)}i&&((n=this.currentSelection)===null||n===void 0||n.key.highlight(!1),this.currentSelection=i,i.key.highlight(!0))},Object.defineProperty(c.prototype,"hasModalVisualization",{get:function(){return this.element.style.visibility=="visible"},enumerable:!1,configurable:!0}),c.prototype.buildCorrectiveLayout=function(){var t=this.element.getBoundingClientRect(),e=t.width/t.height,n=this.subkeys.map(function(i){var r=i.getBoundingClientRect(),l={keySpec:i.key.spec,centerX:(r.right-r.width/2-t.left)/t.width,centerY:(r.bottom-r.height/2-t.top)/t.height,width:r.width/t.width,height:r.height/t.height};return l});return{keys:n,kbdScaleRatio:e}},c.prototype.currentStageKeyDistribution=function(){var t=this,e=this.source.stageReports[this.source.stageReports.length-1],n=this.source.stageReports[0],i=e.sources[0],r=i.currentSample,l=this.element.getBoundingClientRect(),s={x:r.targetX/l.width,y:r.targetY/l.height};s.x=s.x<0?0:s.x>1?1:s.x,s.y=s.y<0?0:s.y>1?1:s.y;var o=Wt(s,this.buildCorrectiveLayout()),a=o.get(r.item.key.spec),g=Math.min(i.path.stats.duration-n.sources[0].path.stats.duration,this.gestureParams.longpress.waitLength)/(2*this.gestureParams.longpress.waitLength),d=Math.min(i.path.stats.rawDistance,this.gestureParams.longpress.noiseTolerance*4)/(this.gestureParams.longpress.noiseTolerance*8),F=Math.min(g*g,d*d),u=a+F,I=new Map,Q=this.subkeys.find(function(y){return y.keyId==t.baseKey.keyId});return Q?I.set(Q.key.spec,u):I.set(this.baseKey.key.spec,u),Ee([o,I])},c.prototype.cancel=function(){this.clear(),this.source.cancel()},c.prototype.clear=function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.shim.parentNode&&this.shim.parentNode.removeChild(this.shim),this.callout&&this.callout.parentNode&&this.callout.parentNode.removeChild(this.callout)},c}(),ci=As;var Ws=function(){function c(t,e,n){var i=this;this.directlyEmitsKeys=!0,this.shouldRestore=!1,this.hasModalVisualization=!1;var r=t.stageReports[0];this.originalLayer=r.sources[0].stateToken,this.source=t,this.completionCallback=function(){e.lockLayer(!1),i.shouldRestore&&(e.layerId=i.originalLayer,e.updateState()),n==null||n()},e.lockLayer(!0),t.on("stage",function(l){var s=l.matchedId;s.includes("modipress")&&s.includes("-end")?i.clear():s.includes("modipress")&&s.includes("-hold")&&(i.shouldRestore=!0)}),t.on("complete",function(){return i.cancel()})}return Object.defineProperty(c.prototype,"isLocked",{get:function(){return this.shouldRestore},enumerable:!1,configurable:!0}),c.prototype.setLocked=function(){this.shouldRestore=!0},Object.defineProperty(c.prototype,"completed",{get:function(){return this.completionCallback===null},enumerable:!1,configurable:!0}),c.prototype.clear=function(){var t=this.completionCallback;this.completionCallback=null,t==null||t()},c.prototype.cancel=function(){this.clear(),this.source.cancel()},c.prototype.currentStageKeyDistribution=function(t){return null},c}(),ht=Ws;var Hs=function(){function c(t,e,n,i,r){var l=this;this.directlyEmitsKeys=!0,this.hasModalVisualization=!1,this.tapIndex=0,this.baseKey=n,this.baseContextToken=i,this.multitaps=[n.key.spec].concat(n.key.spec.multitap),this.sequence=t;var s=function(F){var u;(u=l.modipress)===null||u===void 0||u.clear();var I=new ht(t,e,function(){l.modipress=e.activeModipress=null});l.modipress=e.activeModipress=I};this.originalLayer=e.layerId;var o=function(F){return(l.tapIndex+F)%l.multitaps.length},a=function(){r==null||r.setMultitapHint(l.multitaps[o(0)],l.multitaps[o(1)],e)};t.on("complete",function(){var F;(F=l.modipress)===null||F===void 0||F.cancel(),l.clear()});var g=function(F){var u;switch(F.matchedId){case"modipress-hold":l.clear(),t.off("stage",g);return;case"modipress-end-multitap-transition":case"modipress-multitap-end":case"modipress-end":case"multitap-end":case"simple-tap":return;case"modipress-multitap-lock-transition":(u=l.modipress)===null||u===void 0||u.setLocked();return;case"modipress-multitap-start":case"multitap-start":break;default:throw new Error("Unsupported gesture state encountered during multitap: ".concat(F.matchedId))}l.tapIndex=o(1);var I=l.multitaps[l.tapIndex];a();var Q=e.keyEventFromSpec(I);Q.baseTranscriptionToken=l.baseContextToken;var y=F.sources[0].currentSample,U=e.getSimpleTapCorrectionDistances(y,l.baseKey.key.spec);if(y.stateToken!=e.layerId&&!F.matchedId.includes("modipress")){var b=e.layerGroup.findNearestKey((0,B.__assign)((0,B.__assign)({},y),{stateToken:e.layerId})),C=U.get(b.key.spec);C==null&&console.warn("Could not find current layer's key"),U.delete(b.key.spec),U.set(y.item.key.spec,C)}Q.keyDistribution=l.currentStageKeyDistribution(U),Q.kNextLayer||(Q.kNextLayer=l.originalLayer),e.raiseKeyEvent(Q,null),F.matchedId=="modipress-multitap-start"&&s(F)};t.on("stage",g);var d=t.stageReports[0];d.matchedId=="modipress-start"&&s(t.stageReports[0]),a()}return c.prototype.currentStageKeyDistribution=function(t){var e=this,n=Ee(t),i=n.findIndex(function(Q){return Q.keySpec==e.baseKey.key.spec});if(i==-1)return Qt(this.baseKey)||console.warn("Could not find base key's probability for multitap correction"),n;for(var r=n.splice(i,1)[0].p,l=0,s=[],o=0;o<this.multitaps.length;o++){var a=this.multitaps[o],g=Math.abs(o-this.tapIndex)%this.multitaps.length,d=(o+this.multitaps.length-this.tapIndex)%this.multitaps.length,F=g<d?g:d,u=1/((1+F)*(1+F));l+=u,s.push({keySpec:a,p:u})}var I=r/l;return s.forEach(function(Q){Q.p=I*Q.p}),n.concat(s).sort(function(Q,y){return y.p-Q.p})},c.prototype.cancel=function(){this.clear(),this.sequence.cancel()},c.prototype.clear=function(){},c}(),cr=Hs;var Ct=1.4142,ri=function(c){return Math.abs(c)<1e-10?0:c},rr=function(c){(0,B.__extends)(t,c);function t(e,n,i,r){var l,s=c.call(this)||this;s.flickPreviews=new Map,s.orientation="top";var o=e.key.spec,a=s.flickEdgeLength=Math.max(i,r),g=s.div=document.createElement("div");g.className=g.id="kmw-gesture-preview",g.style.pointerEvents="none";var d=s.previewImgContainer=document.createElement("div");s.previewImgContainer.id="kmw-preview-img-container";var F=s.label=document.createElement("span");if(F.className="kmw-gesture-base-label kmw-key-text",F.id="kmw-gesture-base-label",d.appendChild(F),F.textContent=e.key.label.textContent,s.div.appendChild(s.previewImgContainer),o.flick){var u=o.flick||{};Object.keys(u).forEach(function(Q){var y=document.createElement("div");y.className="kmw-flick-preview kmw-key-text",y.textContent=u[Q].text;var U=y.style,b=_n.get(Q),C=ri(-Math.sin(b[0])),x=ri(Math.cos(b[0]));U.width="100%",U.textAlign="center",C<0?U.right=-C*Ct*a+"px":C>0?U.left=C*Ct*a+"px":U.left="0px",U.height="100%",U.lineHeight="100%",x<0?U.bottom=-x*Ct*a+"px":x>0?U.top=x*Ct*a+"px":U.top="0px",s.flickPreviews.set(Q,y),d.appendChild(y)})}var I=s.hintLabel=document.createElement("div");return I.className="kmw-key-popup-icon",n||(I.textContent=o==o.hintSrc?o.hint:(l=o.hintSrc)===null||l===void 0?void 0:l.text,I.style.fontWeight=I.textContent=="\u2022"?"bold":""),g.appendChild(I),s}return Object.defineProperty(t.prototype,"element",{get:function(){return this.div},enumerable:!1,configurable:!0}),t.prototype.refreshLayout=function(){var e=getComputedStyle(this.div),n=Number.parseInt(e.height,10);this.flickPreviews.forEach(function(i){i.style.lineHeight=i.style.height="".concat(n,"px")})},t.prototype.cancel=function(){var e;(e=this.onCancel)===null||e===void 0||e.call(this),this.onCancel=null},t.prototype.setCancellationHandler=function(e){this.onCancel=e},t.prototype.setMultitapHint=function(e,n,i){var r,l,s=Me(e.text,i),o=Me(n.text,i);this.label.textContent=s,this.hintLabel.textContent=o,this.label.style.fontFamily=s!=e.text?"SpecialOSK":(r=e.font)!==null&&r!==void 0?r:this.label.style.fontFamily,this.hintLabel.style.fontFamily=o!=n.text?"SpecialOSK":(l=n.font)!==null&&l!==void 0?l:this.hintLabel.style.fontFamily,this.emit("startFade"),this.clearFlick()},t.prototype.scrollFlickPreview=function(e,n){this.clearHint();var i=this.previewImgContainer.style,r=this.flickEdgeLength*Ct;i.marginLeft="".concat(r*e,"px"),i.marginTop="".concat(r*n,"px");var l=ri(n)<0?"bottom":"top";this.orientation!=l&&(this.orientation=l,this.emit("preferredOrientation",l))},t.prototype.clearFlick=function(){this.previewImgContainer.style.marginTop="0px",this.previewImgContainer.style.marginLeft="0px",this.previewImgContainer.classList.add("kmw-flick-clear")},t.prototype.clearHint=function(){this.hintLabel.classList.add("kmw-hint-clear")},t.prototype.clearAll=function(){this.clearFlick()},t}(f.default);var lr=Re.TIER!="stable"||Re.VERSION_ENVIRONMENT!="",Ns=lr?10:0,ks=function(c){(0,B.__extends)(t,c);function t(e){var n,i,r=c.call(this)||this;r.gestureParams=(0,B.__assign)({},jn),r.layerLocked=!1,r.layerIndex=0,r.isStatic=!1,r._fixedWidthScaling=!1,r._fixedHeightScaling=!0,r._borderWidth=0,r.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1},r.activeGestures=[],r.activeModipress=null,r.repeatDelete=function(){this.deleting&&(this.modelKeyClick(this.deleteKey),this.deleting=window.setTimeout(this.repeatDelete,100))}.bind(r),r.config=e,r.config.device=e.device||e.hostDevice,r.config.isEmbedded=e.isEmbedded||!1,e.isStatic&&(r.isStatic=e.isStatic),r._fixedWidthScaling=r.device.touchable&&!r.isStatic,r._fixedHeightScaling=r.device.touchable&&!r.isStatic;var l=document.createElement("div");r.config.styleSheetManager=e.styleSheetManager||new ye(l);var s;if(e.keyboard)s=r.kbdLayout=e.keyboard.layout(e.device.formFactor),r.layoutKeyboardProperties=e.keyboardMetadata,r.isRTL=e.keyboard.isRTL;else{var o=D.buildDefaultLayout(null,null,e.device.formFactor);s=r.kbdLayout=St.polyfill(o,null,e.device.formFactor),r.layoutKeyboardProperties=null,r.isRTL=!1}"font"in s?r.fontFamily=s.font:r.fontFamily="";var a=e.device.formFactor;r.layoutKeyboard=e.keyboard,r.layoutKeyboard||(r.layoutKeyboard=new j(null)),r.layerGroup=new Pc(r,r.layoutKeyboard,a),r.layoutKeyboard.markLayoutCalibrated(a),l.appendChild(r.layerGroup.element),r.kbdDiv=l,r.isStatic||(r.gestureEngine=r.constructGestureEngine()),l.classList.add(e.device.formFactor,"kmw-osk-inner-frame");var g=(i=(n=r.layoutKeyboard)===null||n===void 0?void 0:n.id.replace("Keyboard_",""))!==null&&i!==void 0?i:"",d=g.indexOf("::");d!=-1&&(g=g.substring(d+2));var F="kmw-keyboard-"+g;return r.element.classList.add(F),r}return Object.defineProperty(t.prototype,"layerId",{get:function(){var e,n;return(n=(e=this.layerGroup)===null||e===void 0?void 0:e.activeLayerId)!==null&&n!==void 0?n:"default"},set:function(e){var n=e!=this.layerId;if(this.layerGroup.layers[e])this.layerGroup.activeLayerId=e,this.gestureEngine&&(this.gestureEngine.stateToken=e);else throw new Error("Keyboard ".concat(this.layoutKeyboard.id," does not have a layer with id ").concat(e));n&&!this.deferLayout&&(this.updateState(),this.layerGroup.refreshLayout(this.constructLayoutParams()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentLayer",{get:function(){var e;return(e=this.layerGroup)===null||e===void 0?void 0:e.activeLayer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lgKey",{get:function(){var e,n;return(n=(e=this.currentLayer)===null||e===void 0?void 0:e.globeKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hkKey",{get:function(){var e,n;return(n=(e=this.currentLayer)===null||e===void 0?void 0:e.hideKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spaceBar",{get:function(){var e,n;return(n=(e=this.currentLayer)===null||e===void 0?void 0:e.spaceBarKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),t.prototype.constructGestureEngine=function(){var e=this,n={targetRoot:this.element,mouseEventRoot:document.body,maxRoamingBounds:new Ue(this.topContainer,[NaN]),itemIdentifier:function(o,a){return e.layerGroup.findNearestKey(o)},recordingMode:lr,historyLength:Ns};this.gestureParams.longpress.permitsFlick=function(o){var a=o==null?void 0:o.key.spec.flick;return!a||!(a.n||a.nw||a.ne)};var i=new yt(qn(this.kbdLayout,this.gestureParams),n);i.stateToken=this.layerId;var r={},l=function(o){var a,g;try{for(var d=(0,B.__values)(Object.keys(r)),F=d.next();!F.done;F=d.next()){var u=F.value;if(u!=o){var I=r[u];I.source.terminate(!0)}}}catch(Q){a={error:Q}}finally{try{F&&!F.done&&(g=d.return)&&g.call(d)}finally{if(a)throw a.error}}},s=new Map;return i.on("inputstart",function(o){var a,g=e.highlightKey(o.currentSample.item,!0);g&&((a=e.gesturePreviewHost)===null||a===void 0||a.cancel(),e.gesturePreviewHost=g),r[o.identifier]={source:o,roamingHighlightHandler:null,key:o.currentSample.item,previewHost:g};var d=r[o.identifier],F=function(){Be(0).then(function(){var u=d.previewHost;u&&(u.cancel(),e.gesturePreviewHost=null,d.previewHost=null),d.key&&(e.highlightKey(d.key,!1),d.key=null)})};d.roamingHighlightHandler=function(u){var I,Q=u.item,y=r[o.identifier].key;if(!e.kbdLayout.hasFlicks&&Q!=y){e.highlightKey(y,!1),(I=e.gesturePreviewHost)===null||I===void 0||I.cancel(),e.gesturePreviewHost=null,d.previewHost=null;var U=e.highlightKey(Q,!0);U&&(e.gesturePreviewHost=U,d.previewHost=U),r[o.identifier].key=Q}},o.path.on("invalidated",F),o.path.on("complete",F),o.path.on("step",d.roamingHighlightHandler)}),i.on("recognizedgesture",function(o){var a;(a=e.activeModipress)===null||a===void 0||a.setLocked(),o.on("complete",function(){var g,d,F;try{for(var u=(0,B.__values)(o.allSourceIds),I=u.next();!I.done;I=u.next()){var Q=I.value;!((F=r[Q])===null||F===void 0)&&F.previewHost&&(e.gesturePreviewHost=null,r[Q].previewHost.cancel()),delete r[Q]}}catch(y){g={error:y}}finally{try{I&&!I.done&&(d=u.return)&&d.call(u)}finally{if(g)throw g.error}}}),o.on("stage",function(g,d){var F,u,I=o.allSourceIds.map(function(R){var E;return(E=r[R])===null||E===void 0?void 0:E.previewHost}).find(function(R){return!!R}),Q=function(){I&&(I.cancel(),e.gesturePreviewHost=null)},y=s.get(o);!y&&I&&!g.matchedId.includes("flick")&&I.clearFlick();var U,b=function(R){var E=function(H){H.key&&(e.highlightKey(H.key,!1),H.key=null),H.source.path.off("step",H.roamingHighlightHandler)};if(U=r[R],U)E(U);else{var A=R;Be(0).then(function(){var H=r[A];H&&E(H)})}};try{for(var C=(0,B.__values)(g.allSourceIds),x=C.next();!x.done;x=C.next()){var X=x.value;b(X)}}catch(R){F={error:R}}finally{try{x&&!x.done&&(u=C.return)&&u.call(C)}finally{if(F)throw F.error}}var p=g.item,V=g.sources[0],L=V?V.currentSample:null,m=null;if(p&&!(y&&y[0].directlyEmitsKeys)){var G=void 0,S=e.getSimpleTapCorrectionDistances(V.currentSample,p.key.spec);y&&(G=y[0].currentStageKeyDistribution(S)),G||(G=Ee(S));var k=!e.layerLocked&&y&&y[0]instanceof ci&&y[0].shouldLockLayer;try{k&&e.lockLayer(!0),m=e.modelKeyClick(g.item,L)}finally{k&&e.lockLayer(!1)}}if(!(o.stageReports.length>1&&g.matchedId!="modipress-end")){var W=o.stageReports[0].item;if(g.matchedId=="special-key-start")p.key.spec.baseKeyID=="K_BKSP"?(Q(),y=[new $c(o,function(){return e.modelKeyClick(p,L)})]):p.key.spec.baseKeyID=="K_LOPT"&&(o.on("complete",function(){p.key.highlight(!1),e.emit("globekey",p,!1)}),l(V.identifier),p.key.highlight(!0));else if(g.matchedId.indexOf("longpress")>-1)Q(),y=[new ci(o,d,e,o.stageReports[0].sources[0].baseItem,e.gestureParams)];else if((W==null?void 0:W.key.spec.multitap)&&(g.matchedId=="initial-tap"||g.matchedId=="multitap"||g.matchedId=="modipress-start"))U.previewHost=null,o.on("complete",function(){Q()}),y=[new cr(o,e,W,m.contextToken,I)];else if(g.matchedId.indexOf("flick")>-1)y=[new Vc(o,d,e,o.stageReports[0].sources[0].baseItem,e.gestureParams,I)];else if(g.matchedId.includes("modipress")&&g.matchedId.includes("-start"))if(Q(),e.layerLocked)console.warn("Unexpected state:  modipress start attempt during an active modipress");else{y||(y=[]);var Y=new ht(o,e,function(){var R=y.indexOf(Y);R>-1&&y.splice(R,1),e.activeModipress=null});y.push(Y),e.activeModipress=Y}else Q();y&&(e.activeGestures=e.activeGestures.concat(y),s.set(o,y),o.on("complete",function(){var R=e.activeGestures.filter(function(E){return y.includes(E)});e.activeGestures=e.activeGestures.filter(function(E){return!y.includes(E)}),R.forEach(function(E){E instanceof ht&&E.cancel()})}))}})}),i},Object.defineProperty(t.prototype,"element",{get:function(){return this.kbdDiv},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"device",{get:function(){return this.config.device},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hostDevice",{get:function(){return this.config.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontRootPath",{get:function(){return this.config.pathConfig.fonts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"styleSheetManager",{get:function(){return this.config.styleSheetManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"topContainer",{get:function(){return this.config.topContainer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmbedded",{get:function(){return this.config.isEmbedded},enumerable:!1,configurable:!0}),t.prototype.postInsert=function(){},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutWidth",{get:function(){if(this.usesFixedWidthScaling){var e=this.width;return e-=this._borderWidth*2,Z.inPixels(e)}else return Z.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutHeight",{get:function(){if(this.usesFixedHeightScaling){var e=this.height;return e-=this._borderWidth*2,Z.inPixels(e)}else return Z.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"internalHeight",{get:function(){return this.usesFixedHeightScaling?Z.inPixels(this.layoutHeight.val-this._borderWidth*2-this.layerGroup.verticalPadding):Z.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize||(this._fontSize=new Z("1em")),this._fontSize},set:function(e){this._fontSize=e,this.kbdDiv.style.fontSize=e.styleString},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usesFixedWidthScaling",{get:function(){return this._fixedWidthScaling},set:function(e){this._fixedWidthScaling=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usesFixedHeightScaling",{get:function(){return this._fixedHeightScaling},set:function(e){this._fixedHeightScaling=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usesFixedPositioning",{get:function(){for(var e=this.element;e;){if(getComputedStyle(e).position=="fixed")return!0;e=e.offsetParent}return!1},enumerable:!1,configurable:!0}),t.prototype.setSize=function(e,n,i){this._width=e,this._height=n,this.kbdDiv&&(this.kbdDiv.style.width=e?this._width+"px":"",this.kbdDiv.style.height=n?this._height+"px":"",!this.device.touchable&&n&&(this.fontSize=new Z(this._height/8+"px")),i||this.refreshLayout())},t.prototype.getDefaultKeyObject=function(){var e=(0,B.__assign)({},_.DEFAULT_KEY);return _.polyfill(e,this.layoutKeyboard,this.kbdLayout,this.layerId),e},t.prototype.getTouchCoordinatesOnKeyboard=function(e){var n={x:e.targetX,y:e.targetY};return n.x/=this.layerGroup.element.offsetWidth,n.y/=this.kbdDiv.offsetHeight,n},t.prototype.getSimpleTapCorrectionDistances=function(e,n){var i=this.getTouchCoordinatesOnKeyboard(e),r=this.layerGroup.element,l=r.offsetWidth,s=this.kbdDiv.offsetHeight;if(!l||!s)return new Map;var o=l/s,a=nc(this.kbdLayout.getLayer(this.layerId),o);return Wt(i,a)},t.prototype.keyTarget=function(e){var n=e;try{if(n){if(n.classList.contains("kmw-key"))return qt(n);if(n.parentNode&&n.parentNode.classList.contains("kmw-key"))return qt(n.parentNode);if(n.firstChild&&n.firstChild.classList.contains("kmw-key"))return qt(n.firstChild)}}catch(i){}return null},t.prototype.cancelDelete=function(){this.deleting&&window.clearTimeout(this.deleting),this.deleting=0},t.prototype.modelKeyClick=function(e,n,i){var r=this.initKeyEvent(e);return n&&(r.source=n),i&&(r.keyDistribution=i),this.raiseKeyEvent(r,e)},t.prototype.initKeyEvent=function(e){this.highlightKey(e,!1);var n=e.key?e.key.spec:null;return n?this.keyEventFromSpec(n):null},t.prototype.keyEventFromSpec=function(e){var n=this.layoutKeyboard.constructKeyEvent(e,this.device,this.stateKeys);return n.srcKeyboard=this.layoutKeyboard,n},t.prototype._UpdateVKShiftStyle=function(e){var n,i;e||(e=this.layerId);var r=this.layerGroup.layers[e];if(!!r&&(this.gestureEngine&&(this.gestureEngine.stateToken=e),!!(!((n=this.layoutKeyboard)===null||n===void 0)&&n.usesDesktopLayoutOnDevice(this.device)))){var l=["K_CAPS","K_NUMLOCK","K_SCROLL"],s=[r.capsKey,r.numKey,r.scrollKey];for(i=0;i<s.length;i++)s[i]!=null&&s[i].setToggleState(this.stateKeys[l[i]])}},t.prototype.updateStateKeys=function(e){var n,i;try{for(var r=(0,B.__values)(Object.keys(this.stateKeys)),l=r.next();!l.done;l=r.next()){var s=l.value;this.stateKeys[s]=e[s]}}catch(o){n={error:o}}finally{try{l&&!l.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}this._UpdateVKShiftStyle()},t.prototype.highlightKey=function(e,n){if(!e||!e.key||e.className==""||e.className.indexOf("kmw-key-row")>=0)return null;var i=e.key.allowsKeyTip(),r=this.activeGestures.find(function(l){return l.hasModalVisualization});return n=r?!1:n,e.key.highlight(n),n&&i?this.gesturePreviewHost?null:this.showGesturePreview(e):null},t.prototype.getKeyEmFontSize=function(){if(!this.fontSize)return new Z("0px");if(this.device.formFactor=="desktop"){var e=.8;return this.fontSize.scaledBy(e)}else{var n=getComputedStyle(document.body).fontSize,i=new Z(n),r=1;if(!this.isStatic){if(this.fontSize.absolute)return this.fontSize;r=this.fontSize.val}return i.scaledBy(r)}},t.prototype.updateState=function(){!this.currentLayer||(this.nextLayer=this.layerId,this.currentLayer.nextlayer&&(this.nextLayer=this.currentLayer.nextlayer),this.layerGroup.activeLayerId=this.layerId,this._UpdateVKShiftStyle())},t.prototype.refreshLayout=function(){if(!this.deferLayout){var e=this.device,n=1;e.OS==v.OperatingSystem.iOS&&!this.isEmbedded&&(n=n/be(this.device.formFactor));var i=this.kbdDiv.style;this.usesFixedHeightScaling&&this.height&&(i.height=i.maxHeight=this.height+"px"),i.fontSize=this.fontSize.scaledBy(n).styleString;var r=this.width&&this.height,l=getComputedStyle(this.kbdDiv),s=getComputedStyle(this.layerGroup.element),o=l.height!=""&&l.height!="auto";if(l.border&&(this._borderWidth=new Z(l.borderWidth).val),r)this._computedWidth=this.width,this._computedHeight=this.height;else if(o)this._computedWidth=parseInt(l.width,10),this._computedWidth||(this._computedWidth=parseInt(s.width,10)),this._computedHeight=parseInt(l.height,10);else return;if(this.layerGroup.refreshLayout(this.constructLayoutParams()),!this.isStatic){var a=this.gestureEngine.config.maxRoamingBounds;a.updatePadding([-.333*this.currentLayer.rowHeight]),this.gestureParams.longpress.flickDistStart=.24*this.currentLayer.rowHeight,this.gestureParams.flick.startDist=.3*this.currentLayer.rowHeight,this.gestureParams.flick.dirLockDist=.35*this.currentLayer.rowHeight,this.gestureParams.flick.triggerDist=.75*this.currentLayer.rowHeight,this.gestureParams.longpress.flickDistFinal=.75*this.currentLayer.rowHeight}}},t.prototype.constructLayoutParams=function(){var e,n;return{keyboardWidth:this._computedWidth-2*this._borderWidth,keyboardHeight:this._computedHeight-2*this._borderWidth-this.layerGroup.verticalPadding,widthStyle:this.layoutWidth,heightStyle:this.internalHeight,baseEmFontSize:this.getKeyEmFontSize(),layoutFontSize:new Z(this.layerGroup.element.style.fontSize),spacebarText:(n=(e=this.layoutKeyboardProperties)===null||e===void 0?void 0:e.displayName)!==null&&n!==void 0?n:"(System keyboard)"}},t.prototype.computedAdjustedOskHeight=function(e){if(!this.layerGroup)return e;var n=this.layerGroup.layers,i=0;for(var r in n){var l=n[r],s=l.rows.length,o=Math.floor(e/(s==0?1:s)),a=s*o;a>i&&(i=a)}var g=0,d=i+g;return d},t.prototype.appendStyleSheet=function(){var e=this,n=this.layoutKeyboard,i=this.layoutKeyboardProperties;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet);var r=i==null?void 0:i.textFont,l=i==null?void 0:i.oskFont;this.styleSheetManager.addStyleSheetForFont(r,this.fontRootPath,this.device.OS),this.styleSheetManager.addStyleSheetForFont(l,this.fontRootPath,this.device.OS),this.config.specialFont&&this.styleSheetManager.addStyleSheetForFont(this.config.specialFont,"",this.device.OS);var s=this.addFontStyle(r,l);n!=null&&typeof n.oskStyling=="string"&&(s=s+n.oskStyling),s&&(this.styleSheet=Je(s),this.styleSheetManager.linkStylesheet(this.styleSheet)),this.styleSheetManager.allLoadedPromise().then(function(){e.layerGroup.resetPrecalcFontSizes(),e.refreshLayout()})},t.prototype.addFontStyle=function(e,n){var i="",r=function(l){return l.family.replace(/\u0022/g,"").replace(/,/g,'","')};return(e||n)&&(i='\n.kmw-key-text {\n  font-family: "'.concat(r(n||e),'";\n}\n\n.kmw-suggestion-text {\n  font-family: "').concat(r(e||n),'";\n}\n')),i},t.buildDocumentationKeyboard=function(e,n,i,r,l,s){var o,a,g=this;if(!e)return null;var d=typeof r=="undefined"?"desktop":r,F=typeof l=="undefined"?"default":l,u={};u.formFactor=d,d!="desktop"?(u.OS=v.OperatingSystem.iOS,u.touchable=!0):(u.OS=v.OperatingSystem.Windows,u.touchable=!1);var I=e.layout(d),Q=new v("other",u.formFactor,u.OS,u.touchable),y=new t({keyboard:e,keyboardMetadata:n,hostDevice:Q,isStatic:!0,topContainer:null,pathConfig:i,styleSheetManager:null,specialFont:{family:"SpecialOSK",files:["".concat(i.resources,"/osk/keymanweb-osk.ttf")],path:""}});y.layerGroup.element.className=y.kbdDiv.className,y.layerGroup.element.classList.add(u.formFactor+"-static");var U=y.kbdDiv.childNodes[0],b=document.createElement("div");b.classList.add(u.OS.toLowerCase(),u.formFactor),I!=null?(y.layerId=F,y.layerGroup.activeLayerId=F,y.setSize(800,s),y.fontSize=Wc(Q,s,!1),b.style.fontSize=y.element.style.fontSize,y.refreshLayout(),U.style.height=y.kbdDiv.style.height,U.style.maxHeight=y.kbdDiv.style.maxHeight):U.innerHTML="<p style='color:#c40; font-size:0.5em;margin:10px;'>No "+d+" layout is defined for "+e.name+".</p>",U.style.border="1px solid #ccc",y.updateState();var C=function(){return(0,B.__awaiter)(g,void 0,void 0,function(){var G,S,k,W,Y,R,E;return(0,B.__generator)(this,function(A){switch(A.label){case 0:if(!document.contains(U))return[3,4];A.label=1;case 1:return A.trys.push([1,,3,4]),[4,y.styleSheetManager.allLoadedPromise()];case 2:A.sent(),G=y.styleSheet,G&&U.appendChild(G),S=[].concat(y.styleSheetManager.sheets);try{for(k=(0,B.__values)(S),W=k.next();!W.done;W=k.next())Y=W.value,Y!=G&&(Y.href||(y.styleSheetManager.unlink(Y),document.head.appendChild(Y)))}catch(H){R={error:H}}finally{try{W&&!W.done&&(E=k.return)&&E.call(k)}finally{if(R)throw R.error}}return y.refreshLayout(),y.styleSheet=null,y.shutdown(),[3,4];case 3:return x.disconnect(),[7];case 4:return[2]}})})},x=new MutationObserver(C);x.observe(document.body,{childList:!0,subtree:!0}),b.append(U);try{for(var X=(0,B.__values)(ve.STYLESHEET_FILES),p=X.next();!p.done;p=X.next()){var V=p.value,L="".concat(i.resources,"/osk/").concat(V),m=y.styleSheetManager.linkExternalSheet(L,!0);m.parentNode.removeChild(m),b.appendChild(m)}}catch(G){o={error:G}}finally{try{p&&!p.done&&(a=X.return)&&a.call(X)}finally{if(o)throw o.error}}return y.appendStyleSheet(),b},t.prototype.onHide=function(){this.hkKey&&this.highlightKey(this.hkKey,!1)},t.prototype.optionKey=function(e,n,i){n.indexOf("K_LOPT")>=0?this.emit("globekey",e,i):n.indexOf("K_ROPT")>=0&&i&&this.emit("hiderequested",e)},t.prototype.showGesturePreview=function(e){var n=this.keytip,i=this.constructLayoutParams(),r=i.keyboardWidth*e.key.spec.proportionalWidth,l=i.keyboardHeight/this.currentLayer.rows.length,s=new rr(e,this.device.formFactor=="phone",r,l);if(n==null){var o=e.key;o.setPreview(s)}else n.show(e,!0,s);return s.refreshLayout(),s},t.prototype.createKeyTip=function(){if(this.keytip==null)if(this.device.formFactor=="phone"){var e=this.isEmbedded;this.keytip=new jc(this,e)}else this.keytip=new qc(this);this.keytip&&this.keytip.element&&this.element.appendChild(this.keytip.element)},t.prototype.createGlobeHint=function(){return this.config.embeddedGestureConfig.createGlobeHint?this.config.embeddedGestureConfig.createGlobeHint(this):null},t.prototype.shutdown=function(){var e;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet),this.activeGestures.forEach(function(n){return n.cancel()}),this.gestureEngine&&this.gestureEngine.destroy(),this.deleting&&window.clearTimeout(this.deleting),(e=this.keytip)===null||e===void 0||e.show(null,!1,null)},t.prototype.lockLayer=function(e){this.layerLocked=e},t.prototype.raiseKeyEvent=function(e,n){if(e.kName=="K_LOPT"||e.kName=="K_ROPT")return this.optionKey(n,e.kName,!0),{};var i={},r=function(l,s){var o,a;i.contextToken=(o=l==null?void 0:l.transcription)===null||o===void 0?void 0:o.token;var g=(a=l==null?void 0:l.transcription)===null||a===void 0?void 0:a.transform;i.alteredText=l&&(!g||Te(g))};return this.layerLocked&&(e.kNextLayer=this.layerId),this.emit("keyevent",e,r),i},t.specialCharacters=Ne.specialCharacters,t}(f.default),fe=ks;var sr=function(c){(0,B.__extends)(t,c);function t(){return c!==null&&c.apply(this,arguments)||this}return t}(f.default),xt=sr,Gt=function(c){(0,B.__extends)(t,c);function t(){return c!==null&&c.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"enabled",{get:function(){return!0},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activate",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"conditionsMet",{get:function(){return!0},enumerable:!1,configurable:!0}),t}(sr);var Ys=function(){function c(){this.map=new Map}return c.prototype.promiseForTouchpoint=function(t){return this.map.get(t)||this.map.set(t,new J),this.map.get(t)},c.prototype.maintainTouches=function(t){for(var e,n,i=Array.from(this.map.keys()),r=0;r<t.length;r++){var l=i.indexOf(t.item(r).identifier);l!=-1&&i.splice(l,1)}try{for(var s=(0,B.__values)(i),o=s.next();!o.done;o=s.next()){var a=o.value;this.map.get(a).resolve(),this.map.delete(a)}}catch(g){e={error:g}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}},c}(),or=Ys;function ar(c){var t="osk/";return c.isEmbedded&&(t=""),"".concat(c.pathConfig.resources,"/").concat(t)}var ws=function(c){(0,B.__extends)(t,c);function t(e){var n,i,r,l=c.call(this)||this;l.legacyEvents=new kt,l.needsLayout=!0,l.touchEventPromiseManager=new or,l.activationListener=function(u){if(!l.mayDisable&&!l.activationModel.enabled){l.activationModel.off("activate",l.activationListener);try{l.activationModel.enabled=!0}finally{l.activationModel.on("activate",l.activationListener)}}l.commonCheckAndDisplay()},l.layerChangeHandler=function(u,I){var Q,y;return l.vkbd&&l.vkbd._UpdateVKShiftStyle(I),(l.vkbd&&l.vkbd.layerId!=I||u.value!=I)&&((Q=l.vkbd)===null||Q===void 0?void 0:Q.layerGroup.layers[I])&&!(!((y=l.vkbd)===null||y===void 0)&&y.layerLocked)&&(l.vkbd.layerId=I),!1},l._Visible=!1,l.config=e=(0,B.__assign)({},e),l.config.allowHideAnimations===void 0&&(l.config.allowHideAnimations=!0),l.config.device=e.device||e.hostDevice,l.config.isEmbedded=e.isEmbedded||!1,l.config.embeddedGestureConfig=e.embeddedGestureConfig||{},l.config.activator.on("activate",l.activationListener),l._Box=N("div"),l.kbdStyleSheetManager=new ye(l._Box,l.config.doCacheBusting||!1),l.uiStyleSheetManager=new ye(l._Box),l.bannerView=new ac,l.bannerView.events.on("bannerchange",function(){return l.refreshLayout()}),l._Box.appendChild(l.bannerView.element),l._bannerController=new ti(l.bannerView,l.hostDevice,l.config.predictionContextManager),l.keyboardView=new bt,l._Box.appendChild(l.keyboardView.element);var s=ar(l.config);try{for(var o=(0,B.__values)(t.STYLESHEET_FILES),a=o.next();!a.done;a=o.next()){var g=a.value,d="".concat(s).concat(g);l.uiStyleSheetManager.linkExternalSheet(d)}}catch(u){n={error:u}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}l.activeKeyboard=l.config.keyboardToActivate;var F=(r=l.config.predictionContextManager)===null||r===void 0?void 0:r.modelState;return F&&l.bannerController.selectBanner(F),l.setBaseMouseEventListeners(),l.hostDevice.touchable&&l.setBaseTouchEventListeners(),l._Box.style.display="none",l.initialized=!0,l}return Object.defineProperty(t.prototype,"keyCodes",{get:function(){return h.keyCodes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"modifierCodes",{get:function(){return h.modifierCodes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"modifierBitmasks",{get:function(){return h.modifierBitmasks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateBitmasks",{get:function(){return h.stateBitmasks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"configuration",{get:function(){return this.config},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bannerController",{get:function(){return this._bannerController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hostDevice",{get:function(){return this.config.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontRootPath",{get:function(){return this.config.pathConfig.fonts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmbedded",{get:function(){return this.config.isEmbedded},enumerable:!1,configurable:!0}),t.prototype.setBaseMouseEventListeners=function(){var e=this;this._Box.onmouseenter=function(n){e.mouseEnterPromise&&e.mouseEnterPromise.resolve(),e.mouseEnterPromise=new J,e.emit("pointerinteraction",e.mouseEnterPromise.corePromise)},this._Box.onmouseleave=function(n){e.mouseEnterPromise.resolve(),e.mouseEnterPromise=null}},t.prototype.removeBaseMouseEventListeners=function(){this._Box.onmouseenter=null,this._Box.onmouseleave=null},t.prototype.setBaseTouchEventListeners=function(){var e=this,n=function(i){return i.cancelable&&i.preventDefault(),i.stopPropagation(),!1};this._boxBaseTouchEventCancel=function(i){return e.touchEventPromiseManager.maintainTouches(i.touches),n(i)},this._boxBaseTouchStart=function(i){for(var r=0;r<i.changedTouches.length;r++){var l=e.touchEventPromiseManager.promiseForTouchpoint(i.changedTouches[r].identifier);e.emit("pointerinteraction",l.corePromise)}return e.touchEventPromiseManager.maintainTouches(i.touches),n(i)},this._Box.addEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.addEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchcancel",this._boxBaseTouchEventCancel,!1)},t.prototype.removeBaseTouchEventListeners=function(){!this._boxBaseTouchEventCancel||(this._Box.removeEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.removeEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchcancel",this._boxBaseTouchEventCancel,!1),this._boxBaseTouchEventCancel=null,this._boxBaseTouchStart=null)},Object.defineProperty(t.prototype,"targetDevice",{get:function(){return this.config.device},set:function(e){this.allowsDeviceChange(e)?(this.config.device=e,this.loadActiveKeyboard()):console.error("May not change target device for this OSKView type.")},enumerable:!1,configurable:!0}),t.prototype.allowsDeviceChange=function(e){return!1},Object.defineProperty(t.prototype,"activationModel",{get:function(){return this.config.activator},set:function(e){if(!e)throw new Error("The activation model may not be set to null or undefined!");this.config.activator.off("activate",this.activationListener),e.on("activate",this.activationListener),this.config.activator=e,this.commonCheckAndDisplay()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mayDisable",{get:function(){var e;return!(this.hostDevice.touchable||!((e=this.activeKeyboard)===null||e===void 0)&&e.keyboard.isCJK)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayIfActive",{get:function(){return this.activationModel.enabled},enumerable:!1,configurable:!0}),t.prototype.commonCheckAndDisplay=function(){this.activationModel.activate&&this.activeKeyboard?this.present():this.startHide(!1)},Object.defineProperty(t.prototype,"vkbd",{get:function(){return this.keyboardView instanceof fe?this.keyboardView:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"banner",{get:function(){return this.bannerView},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computedWidth",{get:function(){return this.needsLayout&&this.refreshLayout(),this._computedWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computedHeight",{get:function(){return this.needsLayout&&this.refreshLayout(),this._computedHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseFontSize",{get:function(){var e;return((e=this.parsedBaseFontSize)===null||e===void 0?void 0:e.styleString)||""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parsedBaseFontSize",{get:function(){return this._baseFontSize||(this._baseFontSize=t.defaultFontSize(this.targetDevice,this.computedHeight,this.isEmbedded)),this._baseFontSize},enumerable:!1,configurable:!0}),t.defaultFontSize=function(e,n,i){if(e.touchable){var r=e.formFactor=="phone"?1.6*(i?.65:.6)*1.2:2;return Z.special(r,"em")}else return n?Z.inPixels(n/8):void 0},Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this.keyboardData},set:function(e){var n,i,r;this.initialized&&((n=this.keyboardData)===null||n===void 0?void 0:n.keyboard)==(e==null?void 0:e.keyboard)&&((i=this.keyboardData)===null||i===void 0?void 0:i.metadata)==(e==null?void 0:e.metadata)||(this.keyboardData=e,this.loadActiveKeyboard(),!((r=this.keyboardData)===null||r===void 0)&&r.keyboard.isCJK&&(this.activationModel.enabled=!0))},enumerable:!1,configurable:!0}),t.prototype.computeFrameHeight=function(){var e,n;return(((e=this.headerView)===null||e===void 0?void 0:e.layoutHeight.val)||0)+(((n=this.footerView)===null||n===void 0?void 0:n.layoutHeight.val)||0)},t.prototype.setSize=function(e,n,i){var r=!1,l,s;!e&&e!==0||!n&&n!==0||(Number.isFinite(e)?l=Z.inPixels(e):l=new Z(e),Number.isFinite(n)?s=Z.inPixels(n):s=new Z(n),e&&n&&(r=!this._width||!this._height,r=r||l.styleString!=this._width.styleString,r=r||s.styleString!=this._height.styleString,this._width=l,this._height=s),this.needsLayout=this.needsLayout||r,this.refreshLayoutIfNeeded(i))},t.prototype.setNeedsLayout=function(){this.needsLayout=!0},t.prototype.batchLayoutAfter=function(e){if(this.deferLayout){e();return}try{this.deferLayout=!0,this.vkbd&&(this.vkbd.deferLayout=!0),e()}finally{this.deferLayout=!1,this.vkbd&&(this.vkbd.deferLayout=!1),this.refreshLayout()}},t.prototype.refreshLayout=function(e){var n,i;if(!(!this.keyboardView||this.deferLayout)){var r=this.width&&this.height;if(!!r){var l=this.width.absolute&&this.height.absolute,s=getComputedStyle(this._Box),o=s.height!=""&&s.height!="auto";if(l)this._computedWidth=this.width.val,this._computedHeight=this.height.val;else if(o){var a=this._Box.parentElement;this._computedWidth=this.width.val*(this.width.absolute?1:a.offsetWidth),this._computedHeight=this.height.val*(this.height.absolute?1:a.offsetHeight)}else{console.warn("Unable to properly perform layout - specification uses a relative spec, thus relies upon insertion into the DOM for layout.");return}if(this.needsLayout=!1,this.banner.element.style.fontSize=this.baseFontSize,this.vkbd&&(this.vkbd.fontSize=this.parsedBaseFontSize),e||((n=this.headerView)===null||n===void 0||n.refreshLayout(),this.bannerView.width=this.computedWidth,this.bannerView.refreshLayout(),(i=this.footerView)===null||i===void 0||i.refreshLayout()),this.vkbd){var g=this.computedHeight-this.computeFrameHeight();this.bannerView.height>0&&(g-=this.bannerView.height+5),this.vkbd.setSize(this.computedWidth,g,e);var d=this._Box.style;d.width=d.maxWidth=this.computedWidth+"px",d.height=d.maxHeight=this.computedHeight+"px"}else{var d=this._Box.style;d.width="auto",d.height="auto",d.maxWidth=d.maxHeight=""}}}},t.prototype.refreshLayoutIfNeeded=function(e){this.needsLayout&&this.refreshLayout(e)},t.prototype.postKeyboardLoad=function(){this._Visible=!1,this.postKeyboardAdjustments(),this.displayIfActive&&this.present()},t.prototype.loadActiveKeyboard=function(){var e,n,i,r,l;this.setBoxStyling(),this.needsLayout=!0;var s=this.keyboardView,o=this.kbdStyleSheetManager;this.kbdStyleSheetManager=new ye(this._Box,this.config.doCacheBusting||!1);var a=this.keyboardView=this._GenerateKeyboardView((e=this.keyboardData)===null||e===void 0?void 0:e.keyboard,(n=this.keyboardData)===null||n===void 0?void 0:n.metadata);if(this._Box.replaceChild(a.element,s.element),a.postInsert(),(i=this.bannerController)===null||i===void 0||i.configureForKeyboard((r=this.keyboardData)===null||r===void 0?void 0:r.keyboard,(l=this.keyboardData)===null||l===void 0?void 0:l.metadata),s instanceof fe&&s.shutdown(),o.unlinkAll(),this.banner.appendStyles(),this.vkbd){this.vkbd.createKeyTip();var g=this.vkbd.createGlobeHint();g&&this._Box.appendChild(g.element),this.vkbd.appendStyleSheet()}this.postKeyboardLoad()},t.prototype._GenerateKeyboardView=function(e,n){var i=this.targetDevice;return this._Box.className="",e==null&&!i.touchable?new bt:e&&e.layout(i.formFactor)?this._GenerateVisualKeyboard(e,n):!e||!n?this._GenerateVisualKeyboard(null,null):new Dc(e)},t.prototype._GenerateVisualKeyboard=function(e,n){var i=this,r=this.targetDevice,l=ar(this.config),s=new fe({keyboard:e,keyboardMetadata:n,device:r,hostDevice:this.hostDevice,topContainer:this._Box,styleSheetManager:this.kbdStyleSheetManager,pathConfig:this.config.pathConfig,embeddedGestureConfig:this.config.embeddedGestureConfig,isEmbedded:this.config.isEmbedded,specialFont:{family:"SpecialOSK",files:["".concat(l,"/keymanweb-osk.ttf")],path:""}});return s.on("keyevent",function(o,a){return i.emit("keyevent",o,a)}),s.on("globekey",function(o,a){return i.emit("globekey",o,a)}),s.on("hiderequested",function(o){i.doHide(!0),i.emit("hiderequested",o)}),this._Box.className=r.formFactor+" "+r.OS.toLowerCase()+" kmw-osk-frame",s},t.prototype.present=function(){if(!!this.mayShow()){if(this.keyboardView.updateState(),this._Box.style.display="block",this.refreshLayoutIfNeeded(),this._Visible=!0,this._Box.style.opacity="1",this._Box.style.visibility=="hidden"){var e=this;window.setTimeout(function(){e._Box.style.visibility="visible"},0)}this.setDisplayPositioning()}},t.prototype.startHide=function(e){if(!!this.mayHide(e)){e&&(this.activationModel.enabled=!!(this.keyboardData.keyboard.isCJK||this.hostDevice.touchable));var n=null;this._Box&&this.hostDevice.touchable&&!(this.keyboardView instanceof bt)&&this.config.allowHideAnimations?n=this.useHideAnimation():n=Promise.resolve(!0);var i=this;n.then(function(r){r&&i.finalizeHide()}),this.doHide(e)}},t.prototype.finalizeHide=function(){if(!(document.body.className.indexOf("osk-always-visible")>=0&&this.hostDevice.formFactor=="desktop")){if(this._Box){var e=this._Box.style;e.display="none",e.transition="",e.opacity="1",this._Visible=!1}this.vkbd&&this.vkbd.onHide()}},t.prototype.mayShow=function(){return!(!this.activationModel.conditionsMet||!this.keyboardView||this.keyboardView instanceof bt||!this.activationModel.enabled||!this._Box)},t.prototype.mayHide=function(e){return!(this.activationModel.conditionsMet&&!this.mayDisable||this.activationModel instanceof Gt||!e&&this.hostDevice.formFactor=="desktop"&&document.body.className.indexOf("osk-always-visible")>=0)},t.prototype.useHideAnimation=function(){var e=this._Box.style,n=this;return new Promise(function(i){var r=function(){return n._Box.removeEventListener("transitionend",r,!1),n._Box.removeEventListener("webkitTransitionEnd",r,!1),n._Box.removeEventListener("transitioncancel",r,!1),n._Box.removeEventListener("webkitTransitionCancel",r,!1),n._animatedHideTimeout!=0&&window.clearTimeout(n._animatedHideTimeout),n._animatedHideTimeout=0,n._Visible&&n.activationModel.conditionsMet?(e.transition="",e.opacity="1",i(!1),!1):(i(!0),!0)},l=function(){n._Box.removeEventListener("transitionrun",l,!1),n._Box.removeEventListener("webkitTransitionRun",l,!1),n._Box.addEventListener("transitionend",r,!1),n._Box.addEventListener("webkitTransitionEnd",r,!1),n._Box.addEventListener("transitioncancel",r,!1),n._Box.addEventListener("webkitTransitionCancel",r,!1)};n._Box.addEventListener("transitionrun",l,!1),n._Box.addEventListener("webkitTransitionRun",l,!1),e.transition="opacity 0.5s linear 0",e.opacity="0",n._animatedHideTimeout=window.setTimeout(r,200)})},t.prototype.hideNow=function(){if(!(!this.mayHide(!1)||!this._Box)){this._animatedHideTimeout&&(window.clearTimeout(this._animatedHideTimeout),this._animatedHideTimeout=0);var e=this._Box.style;e.transition="",e.opacity="0",this.finalizeHide()}},t.prototype.shutdown=function(){this.removeBaseMouseEventListeners(),this.removeBaseTouchEventListeners();var e=this._Box;e.parentElement&&e.parentElement.removeChild(e),this.kbdStyleSheetManager.unlinkAll(),this.uiStyleSheetManager.unlinkAll(),this.bannerController.shutdown()},t.prototype.getRect=function(){var e={};return e.left=e.left=z(this._Box),e.top=e.top=K(this._Box),e.width=this.computedWidth,e.height=this.computedHeight,e},t.prototype.isEnabled=function(){return this.displayIfActive},t.prototype.isVisible=function(){return this._Visible},t.prototype.hide=function(){this.activationModel.enabled=!1,this.startHide(!0)},t.prototype.show=function(e){arguments.length>0?this.activationModel.enabled=e:this.activationModel.conditionsMet&&(this.activationModel.enabled=!this.activationModel.enabled)},t.prototype.doShow=function(e){this.legacyEvents.callEvent("show",e)},t.prototype.doHide=function(e){var n={HiddenByUser:e};this.legacyEvents.callEvent("hide",n)},t.prototype.addEventListener=function(e,n){this.legacyEvents.addEventListener(e,n)},t.prototype.removeEventListener=function(e,n){this.legacyEvents.removeEventListener(e,n)},t.STYLESHEET_FILES=["kmwosk.css","globe-hint.css"],t}(f.default),ve=ws;var Ts=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this)||this;return n.mouseCancellingHandler=function(i){return i.preventDefault(),i.cancelBubble=!0,!1},n._element=n.buildTitleBar(),n.helpEnabled=!1,n.configEnabled=!1,e&&(n.element.onmousedown=e.mouseDownHandler),n}return Object.defineProperty(t.prototype,"helpEnabled",{get:function(){return this._helpEnabled},set:function(e){this._helpEnabled=e,this._helpButton.style.display=e?"inline":"none"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"configEnabled",{get:function(){return this._configEnabled},set:function(e){this._configEnabled=e,this._configButton.style.display=e?"inline":"none"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutHeight",{get:function(){return t.DISPLAY_HEIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),t.prototype.setPinCJKOffset=function(){this._unpinButton.style.left="15px"},t.prototype.showPin=function(e){this._unpinButton.style.display=e?"block":"none"},t.prototype.setTitle=function(e){this._caption.innerHTML=e},t.prototype.setTitleFromKeyboard=function(e){var n="<span style='font-weight:bold'>"+(e==null?void 0:e.name)+"</span>";this._caption.innerHTML=n},t.prototype.buildTitleBar=function(){var e=this,n=N("div");n.id="keymanweb_title_bar",n.className="kmw-title-bar";var i=this._caption=N("span");i.className="kmw-title-bar-caption",i.style.color="#fff",n.appendChild(i);var r=this._closeButton=this.buildCloseButton();return this._closeButton.onclick=function(){return e.emit("close"),!1},n.appendChild(r),r=this._helpButton=this.buildHelpButton(),this._helpButton.onclick=function(){return e.emit("help"),!1},n.appendChild(r),r=this._configButton=this.buildConfigButton(),this._configButton.onclick=function(){return e.emit("config"),!1},n.appendChild(r),r=this._unpinButton=this.buildUnpinButton(),this._unpinButton.onclick=function(){return e.emit("unpin"),!1},n.appendChild(r),n},t.prototype.buildCloseButton=function(){var e=N("div");return e.id="kmw-close-button",e.className="kmw-title-bar-image",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.buildHelpButton=function(){var e=N("div");return e.id="kmw-help-image",e.className="kmw-title-bar-image",e.title="KeymanWeb Help",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.buildConfigButton=function(){var e=N("div");return e.id="kmw-config-image",e.className="kmw-title-bar-image",e.title="KeymanWeb Configuration Options",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.buildUnpinButton=function(){var e=N("div");return e.id="kmw-pin-image",e.className="kmw-title-bar-image",e.title="Pin the On Screen Keyboard to its default location on the active text box",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.refreshLayout=function(){},t.DISPLAY_HEIGHT=Z.inPixels(20),t}(f.default),li=Ts;var Ds=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this)||this;return n.mouseCancellingHandler=function(i){return i.preventDefault(),i.cancelBubble=!0,!1},n._element=n.buildResizeBar(),e&&(n._resizeHandle.onmousedown=e.mouseDownHandler),n}return Object.defineProperty(t.prototype,"layoutHeight",{get:function(){return t.DISPLAY_HEIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"handle",{get:function(){return this._resizeHandle},enumerable:!1,configurable:!0}),t.prototype.allowResizing=function(e){this._resizeHandle.style.display=e?"block":"none"},t.prototype.buildResizeBar=function(){var e=this,n=N("div");n.className="kmw-footer",n.onmousedown=this.mouseCancellingHandler;var i=N("div");i.className="kmw-footer-caption",i.innerHTML='<a href="https://keyman.com/developer/keymanweb/">KeymanWeb</a>',i.id="keymanweb-osk-footer-caption",i.addEventListener("dblclick",function(l){return e.emit("showbuild"),!1},!1),n.appendChild(i);var r=N("div");return r.className="kmw-footer-resize",n.appendChild(r),this._resizeHandle=r,n},t.prototype.refreshLayout=function(){},t.DISPLAY_HEIGHT=Z.inPixels(16),t}(f.default),gr=Ds;var dr=function(){function c(t,e,n){this.x=t,this.y=e}return c.fromEvent=function(t){var e;if(window.TouchEvent&&t instanceof TouchEvent||t.changedTouches?e=t.changedTouches[0]:e=t,e.pageX)return new c(e.pageX,e.pageY,t);if(e.clientX){var n=e.clientX+document.body.scrollLeft,i=e.clientY+document.body.scrollTop;return new c(n,i,t)}else return new c(null,null,t)},c}(),Ms=function(){function c(t){this._VPreviousMouseMove=document.onmousemove,this._VPreviousMouseUp=document.onmouseup,this._VPreviousCursor=document.body.style.cursor,this._VPreviousMouseButton=typeof t.which=="undefined"?t.button:t.which}return c.prototype.restore=function(){document.onmousemove=this._VPreviousMouseMove,document.onmouseup=this._VPreviousMouseUp,document.body.style.cursor&&(document.body.style.cursor=this._VPreviousCursor)},c.prototype.matchesCausingClick=function(t){return this._VPreviousMouseButton==(typeof t.which=="undefined"?t.button:t.which)},c}(),zs=function(){function c(t){this.startHandler=this._VMoveMouseDown.bind(this),this.cursorType=t}return Object.defineProperty(c.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isActive",{get:function(){return!!this._mouseStartSnapshot},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"mouseDownHandler",{get:function(){return this.startHandler},enumerable:!1,configurable:!0}),c.prototype._VMoveMouseDown=function(t){return!t||!this._enabled?!0:(this._mouseStartSnapshot||(this._mouseStartSnapshot=new Ms(t)),this._startCoord=dr.fromEvent(t),document.onmousemove=this._VMoveMouseMove.bind(this),document.onmouseup=this._VMoveMouseUp.bind(this),document.body.style.cursor&&(document.body.style.cursor=this.cursorType),t.preventDefault(),t.cancelBubble=!0,this.onDragStart(),!1)},c.prototype._VMoveMouseMove=function(t){if(!t||!this.enabled)return!0;if(t.preventDefault(),t.cancelBubble=!0,this._mouseStartSnapshot.matchesCausingClick(t)){var e=dr.fromEvent(t),n=e.x-this._startCoord.x,i=e.y-this._startCoord.y;return this.onDragMove(n,i),!1}else return this._VMoveMouseUp(t)},c.prototype._VMoveMouseUp=function(t){return t?(this._mouseStartSnapshot.restore(),this._mouseStartSnapshot=null,t.preventDefault(),t.cancelBubble=!0,this.onDragRelease(),!1):!0},c}(),si=zs;var Ks=function(c){(0,B.__extends)(t,c);function t(){var e=c.apply(this,(0,B.__spreadArray)([],(0,B.__read)(arguments),!1))||this;return e._enabled=!0,e.actValue=null,e}return Object.defineProperty(t.prototype,"activate",{get:function(){return this._enabled&&!!this.actValue},enumerable:!1,configurable:!0}),t.prototype.checkState=function(e){this.activate!=e&&this.emit("activate",this.activate)},Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(e){var n=this.activate;this._enabled=e,this.checkState(n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activationTrigger",{get:function(){return this.actValue},set:function(e){var n=this.activate,i=this.actValue;this.actValue=e,this.checkState(n),i!=e&&this.emit("triggerchange",e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"conditionsMet",{get:function(){return!!this.activationTrigger},enumerable:!1,configurable:!0}),t}(xt),pt=Ks;var Br=function(c){(0,B.__extends)(t,c);function t(){return c.call(this,"KeymanWeb_OnScreenKeyboard")||this}return t.prototype.loadWithDefaults=function(e){return(0,B.__assign)((0,B.__assign)({},e),this.load())},t.prototype.load=function(){var e=c.prototype.load.call(this,function(n,i){switch(i){case"version":return n;default:return Number.parseInt(n,10)}});return e.width||delete e.width,e.height||delete e.height,e},t.prototype.save=function(e){c.prototype.save.call(this,e)},t}(Ie);var Ps=function(c){(0,B.__extends)(t,c);function t(e){var n,i,r=this;e.activator=e.activator||new pt,r=c.call(this,e)||this,r.userPositioned=!1,r.specifiedPosition=!1,r.noDrag=!1,r.layoutSerializer=new Br,r.restorePosition=function(F){var u=this._Visible,I=new J;this.emit("dragmove",I.corePromise),this.loadPersistedLayout(),this.userPositioned=!1,F||(delete this.dfltX,delete this.dfltY),this.savePersistedLayout(),u&&this.present(),this.titleBar.showPin(!1),I.resolve(),this.doResizeMove()}.bind(r),r.typedActivationModel.on("triggerchange",function(){return r.setDisplayPositioning()}),document.body.appendChild(r._Box),r.titleBar=new li(r.titleDragHandler),r.titleBar.on("help",function(){r.legacyEvents.callEvent("helpclick",{})}),r.titleBar.on("config",function(){r.legacyEvents.callEvent("configclick",{})}),r.titleBar.on("close",function(){return r.startHide(!0)}),r.titleBar.on("unpin",function(){return r.restorePosition(!0)}),r.resizeBar=new gr(r.resizeDragHandler),r.resizeBar.on("showbuild",function(){return r.emit("showbuild")}),r.headerView=r.titleBar,r._Box.insertBefore(r.headerView.element,r._Box.firstChild);var l=function(F){var u=r.headerView;if(u&&u instanceof li)switch(F){case"configclick":u.configEnabled=r.legacyEvents.listenerCount("configclick")>0;break;case"helpclick":u.helpEnabled=r.legacyEvents.listenerCount("helpclick")>0;break;default:return}},s=new Nt(r),o=new Nt(r.legacyEvents);try{for(var a=(0,B.__values)([s,o]),g=a.next();!g.done;g=a.next()){var d=g.value;d.on("listeneradded",l),d.on("listenerremoved",l)}}catch(F){n={error:F}}finally{try{g&&!g.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return r.loadPersistedLayout(),r}return Object.defineProperty(t.prototype,"typedActivationModel",{get:function(){return this.activationModel},enumerable:!1,configurable:!0}),t.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},t.prototype.setBoxStyling=function(){var e=this._Box.style;e.zIndex="9999",e.display="none",e.width="auto",e.position="absolute"},t.prototype.postKeyboardAdjustments=function(){this.enableMoveResizeHandlers(),this.activeKeyboard&&this.titleBar.setTitleFromKeyboard(this.activeKeyboard.keyboard),this.vkbd?(this.footerView=this.resizeBar,this._Box.appendChild(this.footerView.element)):(this.footerView&&this._Box.removeChild(this.footerView.element),this.footerView=null),this.loadPersistedLayout(),this.setNeedsLayout()},t.prototype.isEnabled=function(){return this.displayIfActive},t.prototype.isVisible=function(){return this._Visible},t.prototype.savePersistedLayout=function(){var e=this.getPos(),n={visible:this.displayIfActive?1:0,userSet:this.userPositioned?1:0,left:e.left,top:e.top,_version:ee.CURRENT.toString()};this.vkbd&&(n.width=this.width.val,n.height=this.height.val),this.layoutSerializer.save(n)},t.prototype.loadPersistedLayout=function(){if(!!this.layoutSerializer){var e=this.layoutSerializer.loadWithDefaults({visible:1,userSet:0,left:-1,top:-1,_version:void 0,width:.3*screen.width,height:.15*screen.height});this.activationModel.enabled=e.visible==1,this.userPositioned=e.userSet==1,this.x=e.left,this.y=e.top;var n=e._version,i=n===void 0,r=e.width,l=e.height;r<.2*screen.width&&(r=.2*screen.width),l<.1*screen.height&&(l=.1*screen.height),r>.9*screen.width&&(r=.9*screen.width),l>.5*screen.height&&(l=.5*screen.height),(i||!n)&&(this.headerView&&this.headerView.layoutHeight.absolute&&(l+=this.headerView.layoutHeight.val),this.footerView&&this.footerView.layoutHeight.absolute&&(l+=this.footerView.layoutHeight.val)),this.setSize(r,l),(this.x==-1||this.y==-1||!this._Box)&&(this.userPositioned=!1),this.x<window.pageXOffset-.8*r&&(this.x=window.pageXOffset-.8*r),this.y<0&&(this.x=-1,this.y=-1,this.userPositioned=!1),this.userPositioned&&this._Box&&this.setPos({left:this.x,top:this.y})}},t.prototype.getDefaultKeyboardHeight=function(){if(this.configuration.heightOverride)return this.configuration.heightOverride();var e=Math.floor(Math.min(screen.availHeight,screen.availWidth)/2),n=e;if(this.targetDevice.formFactor=="phone"){var i=Math.min(screen.height,screen.width),r=Math.max(screen.height,screen.width);re()?n=n*(r/i)/1.6:n=Math.floor(Math.max(screen.availHeight,screen.availWidth)/3)}return this.targetDevice.OS==v.OperatingSystem.iOS&&(n=n/be(this.targetDevice.formFactor)),n},t.prototype.getDefaultWidth=function(){if(this.configuration.widthOverride)return this.configuration.widthOverride();var e;if(this.targetDevice.OS==v.OperatingSystem.iOS)e=window.innerWidth;else if(this.targetDevice.OS==v.OperatingSystem.Android)try{e=document.documentElement.clientWidth}catch(n){e=screen.availWidth}else e=screen.width;return e},t.prototype.doResizeMove=function(e){this.legacyEvents.callEvent("resizemove",e)},t.prototype.setRect=function(e){if(!(this._Box==null||this.targetDevice.formFactor!="desktop")){var n=this._Box,i=n.style;if("left"in e&&(this.x=e.left-z(n)+n.offsetLeft,i.left=this.x+"px",this.dfltX=i.left),"top"in e&&(this.y=e.top-K(n)+n.offsetTop,i.top=this.y+"px",this.dfltY=i.top),this.vkbd!=null){var r=this.vkbd.kbdDiv,l=r.style;if("width"in e){var s=e.width-(n.offsetWidth-r.offsetWidth);s<.2*screen.width&&(s=.2*screen.width),s>.9*screen.width&&(s=.9*screen.width),l.width=s+"px",this.setSize(s,this.computedHeight,!0)}if("height"in e){var o=e.height-(n.offsetHeight-r.offsetHeight);o<.1*screen.height&&(o=.1*screen.height),o>.5*screen.height&&(o=.5*screen.height),l.height=o+"px",l.fontSize=o/8+"px",this.setSize(this.computedWidth,o,!0)}"nosize"in e&&(this.resizingEnabled=!e.nosize)}"nomove"in e&&(this.noDrag=e.nomove,this.movementEnabled=!this.noDrag),this.savePersistedLayout()}},t.prototype.getPos=function(){var e=this._Box,n={left:this._Visible?e.offsetLeft:this.x,top:this._Visible?e.offsetTop:this.y};return n},t.prototype.setPos=function(e){if(typeof this._Box!="undefined"){if(this.userPositioned){var n=e.left,i=e.top;typeof n!="undefined"&&(n<-.8*this._Box.offsetWidth&&(n=-.8*this._Box.offsetWidth),this.userPositioned&&(this._Box.style.left=n+"px",this.x=n)),typeof i!="undefined"&&(i<0&&(i=0),this.userPositioned&&(this._Box.style.top=i+"px",this.y=i))}this.titleBar.showPin(this.userPositioned)}},t.prototype.setDisplayPositioning=function(){var e=this._Box.style;if(e.position="absolute",this.activationModel.activate&&(e.display="block"),e.left="0px",this.specifiedPosition||this.userPositioned)e.left=this.x+"px",e.top=this.y+"px";else{var n=this.typedActivationModel.activationTrigger||null;this.dfltX?e.left=this.dfltX:typeof n!="undefined"&&n!=null&&(e.left=z(n)+"px"),this.dfltY?e.top=this.dfltY:typeof n!="undefined"&&n!=null&&(e.top=K(n)+n.offsetHeight+"px")}this.specifiedPosition=!1},t.prototype.presentAtPosition=function(e,n){!this.mayShow()||(this.specifiedPosition=e>=0||n>=0,this.specifiedPosition&&(this.x=e,this.y=n),this.specifiedPosition=this.specifiedPosition||this.userPositioned,this.present())},t.prototype.present=function(){!this.mayShow()||(this.titleBar.showPin(this.userPositioned),c.prototype.present.call(this),this.doShow({x:this._Box.offsetLeft,y:this._Box.offsetTop,userLocated:this.userPositioned}))},t.prototype.startHide=function(e){c.prototype.startHide.call(this,e),e&&this.savePersistedLayout()},t.prototype.show=function(e){e!==void 0?c.prototype.show.call(this,e):c.prototype.show.call(this),this.savePersistedLayout()},t.prototype.userLocated=function(){return this.userPositioned},Object.defineProperty(t.prototype,"movementEnabled",{get:function(){return this.titleDragHandler.enabled},set:function(e){this.titleDragHandler.enabled=e,this.titleBar.showPin(e&&this.userPositioned)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resizingEnabled",{get:function(){return this.resizeDragHandler.enabled},set:function(e){this.resizeDragHandler.enabled=e,this.resizeBar.allowResizing(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBeingMoved",{get:function(){return this.titleDragHandler.isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBeingResized",{get:function(){return this.resizeDragHandler.isActive},enumerable:!1,configurable:!0}),t.prototype.enableMoveResizeHandlers=function(){this.titleDragHandler.enabled=!this.noDrag,this.resizeDragHandler.enabled=!0},Object.defineProperty(t.prototype,"titleDragHandler",{get:function(){var e=this;return this._moveHandler?this._moveHandler:(this._moveHandler=new(function(n){(0,B.__extends)(i,n);function i(){return n.call(this,"move")||this}return i.prototype.onDragStart=function(){this.startX=e._Box.offsetLeft,this.startY=e._Box.offsetTop,e.activeKeyboard.keyboard.isCJK&&e.titleBar.setPinCJKOffset(),this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new J,e.emit("dragmove",this.dragPromise.corePromise)},i.prototype.onDragMove=function(r,l){e.titleBar.showPin(!0),e.userPositioned=!0,e._Box.style.left=this.startX+r+"px",e._Box.style.top=this.startY+l+"px";var s=e.getRect();e.setSize(s.width,s.height,!0),e.x=s.left,e.y=s.top},i.prototype.onDragRelease=function(){e.vkbd&&(e.vkbd.currentKey=null),this.dragPromise.resolve(),this.dragPromise.then(function(){e.userPositioned=!0,e.doResizeMove(),e.savePersistedLayout()}),this.dragPromise=null},i}(si)),this._moveHandler)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resizeDragHandler",{get:function(){var e=this;return this._resizeHandler?this._resizeHandler:(this._resizeHandler=new(function(n){(0,B.__extends)(i,n);function i(){return n.call(this,"se-resize")||this}return i.prototype.onDragStart=function(){this.startWidth=e.computedWidth,this.startHeight=e.computedHeight,this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new J,e.emit("resizemove",this.dragPromise.corePromise)},i.prototype.onDragMove=function(r,l){var s=this.startWidth+r,o=this.startHeight+l;s<.2*screen.width&&(s=.2*screen.width),o<.1*screen.height&&(o=.1*screen.height),s>.9*screen.width&&(s=.9*screen.width),o>.5*screen.height&&(o=.5*screen.height),e.setSize(s,o,!0)},i.prototype.onDragRelease=function(){e.vkbd&&(e.vkbd.currentKey=null),e.vkbd&&(this.startWidth=e.computedWidth,this.startHeight=e.computedHeight),e.refreshLayout(),this.dragPromise.resolve(),this.dragPromise.then(function(){e.doResizeMove(),e.savePersistedLayout()}),this.dragPromise=null},i}(si)),this._resizeHandler)},enumerable:!1,configurable:!0}),t}(ve),et=Ps;var Os=function(c){(0,B.__extends)(t,c);function t(e){var n=this;return e.isEmbedded?e.activator=e.activator||new Gt:e.activator=e.activator||new pt,n=c.call(this,e)||this,n.isResizing=!1,n.restorePosition=function(i){}.bind(n),document.body.appendChild(n._Box),n}return t.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},t.prototype.setBoxStyling=function(){var e=this._Box.style;e.zIndex="9999",e.display="none",e.width="100%",e.position="fixed"},t.prototype.refreshLayout=function(e){if(!this.isResizing){try{this.isResizing=!0,this.doResize()}finally{this.isResizing=!1}c.prototype.refreshLayout.call(this,e)}},t.prototype.doResize=function(){if(this.vkbd){var e=this.getDefaultKeyboardHeight();this.setSize(this.getDefaultWidth(),e+this.banner.height)}},t.prototype.postKeyboardAdjustments=function(){this.doResize()},t.prototype.getDefaultKeyboardHeight=function(){var e,n,i=this.targetDevice;if(this.configuration.heightOverride)return this.configuration.heightOverride();var r=(e=document==null?void 0:document.documentElement)===null||e===void 0?void 0:e.clientWidth,l=(n=document==null?void 0:document.documentElement)===null||n===void 0?void 0:n.clientHeight;if(typeof r=="undefined"&&(r=Math.min(screen.height,screen.width),l=Math.max(screen.height,screen.width),re())){var s=r;r=l,l=s}var o=Math.floor(Math.min(l,r)/2),a=o;return i.formFactor=="phone"&&(re()?a=Math.floor(l/1.6):a=Math.floor(l/2.4)),this.targetDevice.OS==v.OperatingSystem.iOS&&(a=a/be(this.targetDevice.formFactor)),a},t.prototype.getDefaultWidth=function(){var e,n=this.targetDevice;if(this.configuration.widthOverride)return this.configuration.widthOverride();var i;return i=(e=document==null?void 0:document.documentElement)===null||e===void 0?void 0:e.clientWidth,typeof i=="undefined"&&(this.targetDevice.OS==v.OperatingSystem.iOS?i=window.innerWidth:n.OS==v.OperatingSystem.Android?i=screen.availWidth:i=screen.width),i},t.prototype.setRect=function(e){},t.prototype.getPos=function(){var e=this._Box,n={left:this._Visible?e.offsetLeft:this.x,top:this._Visible?e.offsetTop:this.y};return n},t.prototype.setPos=function(e){},t.prototype.setDisplayPositioning=function(){var e=this._Box.style;this.vkbd&&(e.position="fixed",e.left=e.bottom="0px",e.border="none",e.borderTop="1px solid gray")},t.prototype.present=function(){c.prototype.present.call(this),this.legacyEvents.callEvent("show",{})},t}(ve),oi=Os;var _s=function(c){(0,B.__extends)(t,c);function t(){var e=c.apply(this,(0,B.__spreadArray)([],(0,B.__read)(arguments),!1))||this;return e.flag=!0,e}return Object.defineProperty(t.prototype,"enabled",{get:function(){return this.flag},set:function(e){this.activate=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activate",{get:function(){return this.flag},set:function(e){this.flag!=e&&(this.flag=e,this.emit("activate",e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"conditionsMet",{get:function(){return!0},enumerable:!1,configurable:!0}),t}(xt),ai=_s;var js=function(c){(0,B.__extends)(t,c);function t(e){var n=this;return e.activator=e.activator||new ai,n=c.call(this,e)||this,n.restorePosition=function(i){}.bind(n),n}return Object.defineProperty(t.prototype,"element",{get:function(){return this._Box},enumerable:!1,configurable:!0}),t.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},t.prototype.setBoxStyling=function(){var e=this._Box.style;e.display="none",e.position="relative"},t.prototype.postKeyboardAdjustments=function(){},t.prototype.getDefaultKeyboardHeight=function(){return this.keyboardView instanceof fe?this.keyboardView.height:this.computedHeight},t.prototype.getDefaultWidth=function(){return this.computedWidth},t.prototype.setRect=function(e){},t.prototype.getPos=function(){var e=this._Box,n={left:this._Visible?e.offsetLeft:void 0,top:this._Visible?e.offsetTop:void 0};return n},t.prototype.setPos=function(e){},t.prototype.present=function(){c.prototype.present.call(this),this.legacyEvents.callEvent("show",{})},t.prototype.setDisplayPositioning=function(){},t.prototype.allowsDeviceChange=function(e){return!0},t}(ve),gi=js;var ui={};pi(ui,{AnchoredOSKView:function(){return Bi},FloatingOSKView:function(){return Fi},InlinedOSKView:function(){return qs}});function di(c){return{hostDevice:c.config.hostDevice,pathConfig:c.config.paths,predictionContextManager:c.contextManager.predictionContext,isEmbedded:!1}}var Bi=function(c){(0,B.__extends)(t,c);function t(e,n){var i=(0,B.__assign)((0,B.__assign)({},di(e)),n||{});return c.call(this,i)||this}return t}(oi),Fi=function(c){(0,B.__extends)(t,c);function t(e,n){var i=(0,B.__assign)((0,B.__assign)({},di(e)),n||{});return c.call(this,i)||this}return t}(et),qs=function(c){(0,B.__extends)(t,c);function t(e,n){var i=(0,B.__assign)((0,B.__assign)({},di(e)),n||{});return c.call(this,i)||this}return t}(gi);var $s=function(c){(0,B.__extends)(t,c);function t(){var e=c!==null&&c.apply(this,arguments)||this;return e.events=new f.default,e.changed=!1,e}return t.prototype.focus=function(){var e=this.getElement();e.focus&&e.focus()},t.prototype.isForcingScroll=function(){return!1},t.prototype.dispatchInputEventOn=function(e){var n;window.InputEvent&&(n=new InputEvent("input",{bubbles:!0,cancelable:!1})),e&&n&&e.dispatchEvent(n)},t}(Cn),te=$s;var eo=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this)||this;return n.root=e,n._cachedSelectionStart=-1,n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.isSupportedType=function(e){return e=="email"||e=="search"||e=="text"||e=="url"},t.prototype.getElement=function(){return this.root},t.prototype.clearSelection=function(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)},t.prototype.isSelectionEmpty=function(){return this.root.selectionStart==this.root.selectionEnd},t.prototype.hasSelection=function(){return!0},t.prototype.invalidateSelection=function(){this._cachedSelectionStart=-1},t.prototype.getCaret=function(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart},t.prototype.getDeadkeyCaret=function(){return this.getCaret()},t.prototype.setCaret=function(e){this.setSelection(e,e,"none")},t.prototype.setSelection=function(e,n,i){var r=this.root.value._kmwCodePointToCodeUnit(e),l=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(r,l,i),this.processedSelectionStart=e,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(r,l,i)},t.prototype.forceScroll=function(){var e=this.getElement(),n=e.selectionStart,i=e.selectionEnd;this._activeForcedScroll=!0;try{e.blur(),e.focus()}finally{e.selectionStart=n,e.selectionEnd=i,this._activeForcedScroll=!1}},t.prototype.isForcingScroll=function(){return this._activeForcedScroll},t.prototype.getSelectionDirection=function(){return this.root.selectionDirection},t.prototype.getTextBeforeCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)},t.prototype.getSelectedText=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)},t.prototype.setTextBeforeCaret=function(e){this.getCaret();var n=this.processedSelectionEnd-this.processedSelectionStart,i=this.getSelectionDirection(),r=e._kmwLength();this.root.value=e+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(r,r+n,i)},t.prototype.setTextAfterCaret=function(e){var n=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+e,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,n)},t.prototype.getTextAfterCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)},t.prototype.getText=function(){return this.root.value},t.prototype.deleteCharsBeforeCaret=function(e){if(e>0){var n=this.getTextBeforeCaret(),i=this.processedSelectionStart;e>i&&(e=i),this.adjustDeadkeys(-e),this.setTextBeforeCaret(n.kmwSubstring(0,i-e)),this.setCaret(i-e)}},t.prototype.insertTextBeforeCaret=function(e){if(!!e){var n=this.getCaret(),i=this.getTextBeforeCaret(),r=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(e._kmwLength()),this.root.value=i+e+r,this.setCaret(n+e._kmwLength())}},t.prototype.handleNewlineAtCaret=function(){var e=this.root;e&&(e.type=="search"||e.type=="submit")?(e.disabled=!1,e.form.submit()):this.events.emit("unhandlednewline",e)},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(te),tt=eo;var to=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this)||this;return n.root=e,n._cachedSelectionStart=-1,n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getElement=function(){return this.root},t.prototype.clearSelection=function(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)},t.prototype.isSelectionEmpty=function(){return this.root.selectionStart==this.root.selectionEnd},t.prototype.hasSelection=function(){return!0},t.prototype.invalidateSelection=function(){this._cachedSelectionStart=-1},t.prototype.getCaret=function(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart},t.prototype.getDeadkeyCaret=function(){return this.getCaret()},t.prototype.setCaret=function(e){this.setSelection(e,e,"none")},t.prototype.setSelection=function(e,n,i){var r=this.root.value._kmwCodePointToCodeUnit(e),l=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(r,l,i),this.processedSelectionStart=e,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(r,l,i)},t.prototype.forceScroll=function(){var e=this.getElement(),n=e.selectionStart,i=e.selectionEnd;this._activeForcedScroll=!0;try{e.blur(),e.focus()}finally{e.selectionStart=n,e.selectionEnd=i,this._activeForcedScroll=!1}},t.prototype.isForcingScroll=function(){return this._activeForcedScroll},t.prototype.getSelectionDirection=function(){return this.root.selectionDirection},t.prototype.getTextBeforeCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)},t.prototype.setTextBeforeCaret=function(e){this.getCaret();var n=this.processedSelectionEnd-this.processedSelectionStart,i=this.getSelectionDirection(),r=e._kmwLength();this.root.value=e+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(r,r+n,i)},t.prototype.setTextAfterCaret=function(e){var n=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+e,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,n)},t.prototype.getTextAfterCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)},t.prototype.getSelectedText=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)},t.prototype.getText=function(){return this.root.value},t.prototype.deleteCharsBeforeCaret=function(e){if(e>0){var n=this.getTextBeforeCaret(),i=this.processedSelectionStart;e>i&&(e=i),this.adjustDeadkeys(-e),this.setTextBeforeCaret(n.kmwSubstring(0,i-e)),this.setCaret(i-e)}},t.prototype.insertTextBeforeCaret=function(e){if(!!e){var n=this.getCaret(),i=this.getTextBeforeCaret(),r=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(e._kmwLength()),this.root.value=i+e+r,this.setCaret(n+e._kmwLength())}},t.prototype.handleNewlineAtCaret=function(){this.insertTextBeforeCaret("\n")},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(te),yi=to;var Ii=function(){function c(t,e){this.node=t,this.offset=e}return c}(),Qi=function(){function c(t,e){this.start=t,this.end=e}return c}(),he=function(){function c(t,e){this.cmd=t,this.stateType=e}return c}(),no=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this)||this;if(n.root=e,e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.designMode=="on")n.doc=e.contentWindow.document,n.docRoot=e.contentWindow.document.documentElement;else throw"Specified IFrame is not in design-mode!";return n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getElement=function(){return this.root},t.prototype.focus=function(){this.doc.defaultView.focus()},t.prototype.isSelectionEmpty=function(){return this.hasSelection()?this.doc.getSelection().isCollapsed:!0},t.prototype.hasSelection=function(){var e=this.doc.getSelection(),n=document.getSelection();return n.anchorNode==e.anchorNode&&n.focusNode==e.focusNode,!0},t.prototype.clearSelection=function(){if(this.hasSelection()){var e=this.doc.getSelection();e.isCollapsed||e.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")},t.prototype.invalidateSelection=function(){},t.prototype.getCarets=function(){var e=this.doc.getSelection(),n=e.anchorNode.compareDocumentPosition(e.focusNode);if(e.isCollapsed){var i=new Ii(e.anchorNode,e.anchorOffset);return new Qi(i,i)}else{var r=new Ii(e.anchorNode,e.anchorOffset),l=new Ii(e.focusNode,e.focusOffset);return r.node==l.node&&(n=l.offset-r.offset>0?2:4),n&2?new Qi(r,l):new Qi(l,r)}},t.prototype.getDeadkeyCaret=function(){return this.getTextBeforeCaret().kmwLength()},t.prototype.getTextBeforeCaret=function(){if(!this.hasSelection())return this.getText();var e=this.getCarets().start;return e.node.nodeType!=3?"":e.node.textContent.substr(0,e.offset)},t.prototype.getSelectedText=function(){return""},t.prototype.getTextAfterCaret=function(){if(!this.hasSelection())return"";var e=this.getCarets().end;return e.node.nodeType!=3?"":e.node.textContent.substr(e.offset)},t.prototype.getText=function(){return this.docRoot.innerText},t.prototype.deleteCharsBeforeCaret=function(e){if(!(!this.hasSelection()||e<=0)){var n=this.getCarets().start;if(e>n.offset&&(e=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}var i=this.doc.createRange(),r=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-e).length;i.setStart(n.node,r),i.setEnd(n.node,n.offset),this.adjustDeadkeys(-e),i.deleteContents()}},t.prototype.insertTextBeforeCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().start,i=e._kmwLength(),r=this.doc.getSelection();if(i!=0){this.adjustDeadkeys(i);var l=this.root.ownerDocument.createRange();if(n.node.nodeType==3){var s=n.node;s.insertData(n.offset,e),l.setStart(s,n.offset+e.length)}else{var o=this.doc.createTextNode(e),a=this.doc.createRange();a.setStart(n.node,n.offset),a.collapse(!0),a.insertNode(o),l.setStart(o,e.length)}l.collapse(!0),r.removeAllRanges();try{r.addRange(l)}catch(g){n.node.parentElement.scrollIntoView(),r.addRange(l)}r.collapseToEnd()}}},t.prototype.handleNewlineAtCaret=function(){},t.prototype.setTextAfterCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().end,i=e._kmwLength();if(i!=0)if(n.node.nodeType==3){var r=n.node;r.replaceData(n.offset,r.length,e)}else{var l=n.node.ownerDocument.createTextNode(e),s=this.root.ownerDocument.createRange();s.setStart(n.node,n.offset),s.collapse(!0),s.insertNode(l)}}},t.prototype.saveProperties=function(){var e=[new he("backcolor",1),new he("fontname",1),new he("fontsize",1),new he("forecolor",1),new he("bold",0),new he("italic",0),new he("strikethrough",0),new he("subscript",0),new he("superscript",0),new he("underline",0)];this.doc.defaultView&&e.push(new he("hilitecolor",1));for(var n=0;n<e.length;n++){var i=e[n];i.stateType==1?i.cache=this.doc.queryCommandValue(i.cmd):i.cache=this.doc.queryCommandState(i.cmd)}this.commandCache=e},t.prototype.restoreProperties=function(e){this.commandCache||console.error("No command cache exists to restore!");for(var n=0;n<this.commandCache.length;n++){var i=this.commandCache[n];i.stateType==1?this.doc.queryCommandValue(i.cmd)!=i.cache&&(e&&e(),this.doc.execCommand(i.cmd,!1,i.cache)):this.doc.queryCommandState(i.cmd)!=i.cache&&(e&&e(),this.doc.execCommand(i.cmd,!1,null))}},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(te),ne=no;var Ui=function(){function c(t,e){this.node=t,this.offset=e}return c}(),bi=function(){function c(t,e){this.start=t,this.end=e}return c}(),io=function(c){(0,B.__extends)(t,c);function t(e){var n=this;if(e.isContentEditable)n=c.call(this)||this,n.root=e;else throw"Specified element is not already content-editable!";return n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getElement=function(){return this.root},t.prototype.isSelectionEmpty=function(){return this.hasSelection()?this.root.ownerDocument.getSelection().isCollapsed:!0},t.prototype.hasSelection=function(){var e=this.root.ownerDocument.getSelection();return!(this.root!=e.anchorNode&&!this.root.contains(e.anchorNode)||this.root!=e.focusNode&&!this.root.contains(e.focusNode))},t.prototype.clearSelection=function(){if(this.hasSelection()){var e=this.root.ownerDocument.getSelection();e.isCollapsed||e.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")},t.prototype.invalidateSelection=function(){},t.prototype.getCarets=function(){var e=this.root.ownerDocument.getSelection(),n=e.anchorNode.compareDocumentPosition(e.focusNode);if(e.isCollapsed){var i=new Ui(e.anchorNode,e.anchorOffset);return new bi(i,i)}else{var r=new Ui(e.anchorNode,e.anchorOffset),l=new Ui(e.focusNode,e.focusOffset);return r.node==l.node&&(n=l.offset-r.offset>0?2:4),n&2?new bi(r,l):new bi(l,r)}},t.prototype.getDeadkeyCaret=function(){return this.getTextBeforeCaret().kmwLength()},t.prototype.getTextBeforeCaret=function(){if(!this.hasSelection())return this.getText();var e=this.getCarets().start;return e.node.nodeType!=3?"":e.node.textContent.substr(0,e.offset)},t.prototype.getSelectedText=function(){return""},t.prototype.getTextAfterCaret=function(){if(!this.hasSelection())return"";var e=this.getCarets().end;return e.node.nodeType!=3?"":e.node.textContent.substr(e.offset)},t.prototype.getText=function(){return this.root.innerText},t.prototype.deleteCharsBeforeCaret=function(e){if(!(!this.hasSelection()||e<=0)){var n=this.getCarets().start;if(e>n.offset&&(e=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}var i=this.root.ownerDocument.createRange(),r=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-e).length;i.setStart(n.node,r),i.setEnd(n.node,n.offset),this.adjustDeadkeys(-e),i.deleteContents()}},t.prototype.insertTextBeforeCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().start,i=e._kmwLength(),r=this.root.ownerDocument.getSelection();if(i!=0){this.adjustDeadkeys(i);var l=this.root.ownerDocument.createRange();if(n.node.nodeType==3){var s=n.node;s.insertData(n.offset,e),l.setStart(s,n.offset+e.length)}else{var o=n.node.ownerDocument.createTextNode(e),a=this.root.ownerDocument.createRange();a.setStart(n.node,n.offset),a.collapse(!0),a.insertNode(o),l.setStart(o,e.length)}l.collapse(!0),r.removeAllRanges();try{r.addRange(l)}catch(g){n.node.parentElement.scrollIntoView(),r.addRange(l)}r.collapseToEnd()}}},t.prototype.handleNewlineAtCaret=function(){},t.prototype.setTextAfterCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().end,i=e._kmwLength();if(i!=0)if(n.node.nodeType==3){var r=n.node;r.replaceData(n.offset,r.length,e)}else{var l=n.node.ownerDocument.createTextNode(e),s=this.root.ownerDocument.createRange();s.setStart(n.node,n.offset),s.collapse(!0),s.insertNode(l)}}},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(te),en=io;function P(c,t){var e;return c?c.Window?t=="Window":(c.defaultView?e=c.defaultView[t]:c.ownerDocument&&(e=c.ownerDocument.defaultView[t]),e?c instanceof e:!1):!1}function tn(c){if(P(c,"HTMLInputElement"))return new tt(c);if(P(c,"HTMLTextAreaElement"))return new yi(c);if(P(c,"HTMLIFrameElement")){var t=c;return t.contentWindow&&t.contentWindow.document&&t.contentWindow.document.designMode=="on"?new ne(t):c.isContentEditable?new en(c):null}else if(c.isContentEditable)return new en(c);return null}var nt=function(){function c(){var t=this;this.pending=!1;var e=this.bg=document.createElement("div"),n=document.createElement("div"),i=this.lt=document.createElement("div"),r=this.gr=document.createElement("div"),l=this.bx=document.createElement("div");e.className="kmw-wait-background",n.className="kmw-wait-box",this.dismiss=null,i.className="kmw-wait-text",r.className="kmw-wait-graphic",l.className="kmw-alert-close";var s=n.onmousedown=n.onclick=function(a){l.style.display=="block"&&(e.style.display="none",t.dismiss&&t.dismiss())};n.addEventListener("touchstart",s,!1);var o=e.onmousedown=e.onclick=function(a){a.preventDefault(),a.stopPropagation()};e.addEventListener("touchstart",o,!1),n.appendChild(l),n.appendChild(i),n.appendChild(r),e.appendChild(n),document.body.appendChild(e)}return Object.defineProperty(c.prototype,"rootElement",{get:function(){return this.bg},enumerable:!1,configurable:!0}),c.prototype.wait=function(t){var e=this,n=this.bg;typeof n=="undefined"||n==null||(t?(this.pending=!0,window.setTimeout(function(){e.pending&&(window.scrollTo(0,0),e.bx.style.display="none",e.lt.className="kmw-wait-text",e.lt.innerHTML=t,e.gr.style.display="block",n.style.display="block")},1e3)):this.pending&&(this.lt.innerHTML="",this.pending=!1,n.style.display="none"))},c.prototype.alert=function(t,e){var n=this.bg;this.bx.style.display="block",this.lt.className="kmw-alert-text",this.lt.innerHTML=t,this.gr.style.display="none",n.style.display="block",this.dismiss=arguments.length>1?e:null},c.prototype.shutdown=function(){this.bg.parentNode.removeChild(this.bg)},c}();function Vt(){return document.readyState==="complete"?Promise.resolve():new Promise(function(c,t){var e=function(){window.removeEventListener("load",e),c()};window.addEventListener("load",e)})}var Fr=function(c){(0,B.__extends)(t,c);function t(){return c!==null&&c.apply(this,arguments)||this}return t.prototype.initialize=function(e){var n=this;this._options?this._options=(0,B.__assign)((0,B.__assign)({},this._options),e):this._options=(0,B.__assign)({},e),c.prototype.initialize.call(this,e),this._options=e,this._ui=e.ui,this._attachType=e.attachType,Vt().then(function(){var i;e.useAlerts&&!n.alertHost?n._alertHost=new nt:!e.useAlerts&&n.alertHost&&((i=n._alertHost)===null||i===void 0||i.shutdown(),n._alertHost=null)})},Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachType",{get:function(){return this._attachType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alertHost",{get:function(){return this._alertHost},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"signalUser",{set:function(e){(!e||e!=this.alertHost)&&this.alertHost.shutdown(),this._alertHost=e},enumerable:!1,configurable:!0}),t.prototype.debugReport=function(){var e=c.prototype.debugReport.call(this);return e.attachType=this.attachType,e.ui=this._ui,e.keymanEngine="app/browser",e},t.prototype.onRuleFinalization=function(e,n){var i=e.transcription.transform;Te(i)||n instanceof te&&(n.changed=!0)},t}(Vn);var ur=(0,B.__assign)({ui:"",attachType:"",useAlerts:!0},mn);var hi=function(){function c(t,e,n){this.interface=t,this.keyboard=e}return c}();function Le(c){var t=c==null?void 0:c.target;return Ce(t)}function Ce(c){var t;if(c==null)return null;if(c.body&&(c=c.body),c.nodeType==3&&(c=c.parentNode),P(c,"HTMLInputElement")){var e=c.type.toLowerCase();if(!(e=="text"||e=="search"))return null}return(t=c._kmwAttachment)===null||t===void 0?void 0:t.interface}var Ci=function(c){(0,B.__extends)(t,c);function t(e,n){var i=this;if(!e)throw new Error("Cannot attach to a null/undefined document");return i=c.call(this)||this,i.baseFont="",i.appliedFont="",i.embeddedPageContexts=[],i._inputList=[],i._sortedInputs=[],i._InputModeObserverCore=function(r){i.disableInputModeObserver();try{for(var l=0,s=r;l<s.length;l++){var o=s[l],a=o.target;!i.isAttached(a)||(a._kmwAttachment.inputMode=a.inputMode,i.device.touchable&&(a.inputMode="none"))}}finally{i.enableInputModeObserver()}},i._EnablementMutationObserverCore=function(r){for(var l=0;l<r.length;l++){var s=r[l],o=s.oldValue?s.oldValue.indexOf("kmw-disabled")>=0:!1,a=s.target.className.indexOf("kmw-disabled")>=0;if(o&&!a?i._EnableControl(s.target):!o&&a&&i._DisableControl(s.target),!a&&s.attributeName=="readonly"){var g=s.oldValue?s.oldValue!=null:!1,d=s.target;if(d instanceof d.ownerDocument.defaultView.HTMLInputElement||d instanceof d.ownerDocument.defaultView.HTMLTextAreaElement){var F=d.readOnly;g&&!F?i._EnableControl(s.target):!g&&F&&i._DisableControl(s.target)}}}},i._AutoAttachObserverCore=function(r){for(var l=[],s=[],o=0;o<r.length;o++){for(var a=r[o],g=0;g<a.addedNodes.length;g++)l=l.concat(i._GetDocumentEditables(a.addedNodes[g]));for(g=0;g<a.removedNodes.length;g++)s=s.concat(i._GetDocumentEditables(a.removedNodes[g]))}for(var d=0;d<l.length;d++)i.isKMWInput(l[d])&&i._MutationAdditionObserved(l[d]);for(d=0;d<s.length;d++){var F=!1,u=s[d];if(u instanceof u.ownerDocument.defaultView.HTMLIFrameElement){for(var I=0;I<i.embeddedPageContexts.length;I++)if(i.embeddedPageContexts[I].options.owner==u){i.embeddedPageContexts[I].shutdown(),i.embeddedPageContexts.splice(I,1),F=!0;break}if(!F){for(var Q=0;Q<i._inputList.length;Q++)if(i._inputList[Q]==u){i.detachFromControl(u),i._inputList[Q]==u&&i._inputList.splice(Q,1);break}}}else i.isKMWInput(u)&&i._MutationRemovalObserved(u)}(l.length||s.length)&&(i.device.touchable?i.device.touchable&&window.setTimeout(function(){i.listInputs()},1):i.listInputs())},i._MutationAdditionObserved=function(r){if(r instanceof r.ownerDocument.defaultView.HTMLIFrameElement){var l=function(){window.setTimeout(function(){i.attachToControl(r)},1)};r.addEventListener("load",l)}else i.attachToControl(r)},i._MutationRemovalObserved=function(r){i.detachFromControl(r)},i.options=n,i.document=e,i.stylesheetManager=new ye(i.document.body),i}return Object.defineProperty(t.prototype,"device",{get:function(){return this.options.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return this.document.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inputList",{get:function(){var e=this.embeddedPageContexts.map(function(n){return n.inputList}).reduce(function(n,i){return n.concat(i)},[]);return[].concat(this._inputList).concat(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sortedInputs",{get:function(){return this._sortedInputs},enumerable:!1,configurable:!0}),t.prototype.install=function(e){this.manualAttach=e,this.baseFont=this.getBaseFont(),this.manualAttach||(this._SetupDocument(this.document.documentElement),this.listInputs()),this.options.owner||this.initMutationObservers(this.document,e)},t.prototype.setupElementAttachment=function(e){if(!e._kmwAttachment){var n=tn(e);n||P(e,"HTMLIFrameElement")||console.warn("Could not create processing interface for newly-attached element!"),e._kmwAttachment=new hi(n,null,this.device.touchable)}},t.prototype.clearElementAttachment=function(e){e._kmwAttachment=null},t.prototype.isKMWInput=function(e){if(e instanceof e.ownerDocument.defaultView.HTMLTextAreaElement)return!0;if(e instanceof e.ownerDocument.defaultView.HTMLInputElement){if(tt.isSupportedType(e.type))return!0}else if(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)try{if(e.contentWindow){var n=e.contentWindow.document;if(n)return!(this.device.touchable&&n.designMode.toLowerCase()=="on")}else return!!e._kmwAttachment}catch(i){console.warn("Error during attachment to / detachment from iframe: "),console.warn(i)}else if(e.isContentEditable)return!0;return!1},t.prototype.isAttached=function(e){if(e._kmwAttachment)return!0;if(P(e,"HTMLIFrameElement")){var n=e;if(n.contentDocument==this.document)return!0;for(var i=0,r=this.embeddedPageContexts;i<r.length;i++){var l=r[i];if(l.isAttached(e))return!0}}return!1},t.prototype.isKMWDisabled=function(e){var n=e.className;return e.readOnly?!0:!!(n&&n.indexOf("kmw-disabled")>=0)},t.prototype.enableInputElement=function(e){var n;this.isKMWDisabled(e)||(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement?this._AttachToIframe(e):(this.setupElementAttachment(e),e._kmwAttachment.inputMode=(n=e.inputMode)!==null&&n!==void 0?n:"text",this.disableInputModeObserver(),e.inputMode="none",this.enableInputModeObserver(),e.classList.add("keymanweb-font"),this._inputList.push(e),this.emit("enabled",e)))},t.prototype.disableInputElement=function(e){var n;if(!!e)if(e.ownerDocument.defaultView&&e instanceof e.ownerDocument.defaultView.HTMLIFrameElement||e instanceof HTMLIFrameElement)this._DetachFromIframe(e);else{if(this.isAttached(e)){var i=(n=e._kmwAttachment)===null||n===void 0?void 0:n.inputMode;this.disableInputModeObserver(),e.inputMode=i,this.enableInputModeObserver()}var r=e.className.indexOf("keymanweb-font");r>=0&&(e.className=e.className.replace("keymanweb-font","").trim());var l=this.inputList.indexOf(e);l>-1&&this._inputList.splice(l,1),this.emit("disabled",e)}},t.prototype.enableTouchElement=function(e){return this.isKMWDisabled(e)?(this.emit("disabled",e),!1):(this.isAttached(e)||this.setupElementAttachment(e),this.enableInputElement(e),!0)},t.prototype.disableTouchElement=function(e){if(this.isAttached(e)){var n=e._kmwAttachment.inputMode;this.disableInputModeObserver(),e.inputMode=n,this.enableInputModeObserver()}},t.prototype._AttachToIframe=function(e){var n=this;try{var i=e.contentWindow.document;if(i){if(i.designMode.toLowerCase()=="on")this.setupElementAttachment(e),i.body._kmwAttachment=e._kmwAttachment,this._inputList.push(e),this.emit("enabled",e);else if(this.embeddedPageContexts.filter(function(l){return l.document==i}).length==0){var r=new t(i,(0,B.__assign)((0,B.__assign)({},this.options),{owner:e}));this.embeddedPageContexts.push(r),r.on("enabled",function(l){return n.emit("enabled",l)}),r.on("disabled",function(l){return n.emit("disabled",l)}),r.install(this.manualAttach)}}}catch(l){}},t.prototype._DetachFromIframe=function(e){var n=this,i=function(){n.clearElementAttachment(e);var o=n._inputList.indexOf(e);o!=-1&&n._inputList.splice(o,1),n.emit("disabled",e)};try{var r=e.contentWindow.document;if(r){if(r.designMode.toLowerCase()=="on")r.body._kmwAttachment=null,i();else for(var l=0;l<this.embeddedPageContexts.length;l++)if(this.embeddedPageContexts[l].document==r){var s=this.embeddedPageContexts.splice(l,1)[0];s._ClearDocument(r.body),s.shutdown(),this.embeddedPageContexts.splice(l,1);break}}}catch(o){e._kmwAttachment&&i()}},t.prototype.attachToControl=function(e){var n=this.device.touchable;this.isAttached(e)&&!(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(e)?this.isKMWDisabled(e)?this.emit("disabled",e):n?this.enableTouchElement(e):this.enableInputElement(e):n&&this.emit("disabled",e))},t.prototype.detachFromControl=function(e){!(this.isAttached(e)||e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(e)&&(this.isKMWDisabled(e)||this._DisableControl(e)),this.clearElementAttachment(e))},t.prototype._DisableControl=function(e){(this.isAttached(e)||e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)&&(this.device.touchable&&this.disableTouchElement(e),this.listInputs(),this.disableInputElement(e))},t.prototype._EnableControl=function(e){this.isAttached(e)?(this.device.touchable?this.enableTouchElement(e):this.enableInputElement(e),this.listInputs()):P(e,"HTMLIFrameElement")&&this._AttachToIframe(e)},t.prototype.disableControl=function(e){this.isAttached(e)||console.warn("KeymanWeb is not attached to element "+e);var n=e.className;n.indexOf("kmw-disabled")<0&&(e.className=n?n+" kmw-disabled":"kmw-disabled")},t.prototype.enableControl=function(e){!this.isAttached(e)&&!P(e,"HTMLIFrameElement")&&console.warn("KeymanWeb is not attached to element "+e);var n=e.className,i=n.indexOf("kmw-disabled");i>=0&&(e.className=n.replace("kmw-disabled","").trim())},t.prototype.listInputs=function(){for(var e=[],n=document.getElementsByTagName("input"),i=document.getElementsByTagName("textarea"),r=0;r<n.length;r++)tt.isSupportedType(n[r].type)&&n[r].className.indexOf("kmw-disabled")<0&&e.push({ip:n[r],x:z(n[r]),y:K(n[r])});for(var r=0;r<i.length;r++)i[r].className.indexOf("kmw-disabled")<0&&e.push({ip:i[r],x:z(i[r]),y:K(i[r])});e.sort(function(s,o){return s.y!=o.y?s.y-o.y:s.x-o.x});for(var l=[],r=0;r<e.length;r++)l.push(e[r].ip);this._sortedInputs=l},t.prototype.findNeighboringInput=function(e,n){var i,r=this.sortedInputs;if(r.length==0)return null;for(i=0;i<r.length&&r[i]!=e;i++);return i==r.length&&!n&&i--,i=n?i-1:i+1,i=i>=r.length?i-r.length:i,i=i<0?i+r.length:i,r[i]},t.prototype._GetDocumentEditables=function(e){var n=[];if(e.ownerDocument&&e instanceof e.ownerDocument.defaultView.HTMLElement){var i=e.ownerDocument.defaultView;(e instanceof i.HTMLInputElement||e instanceof i.HTMLTextAreaElement||e instanceof i.HTMLIFrameElement)&&n.push(e)}if(e.getElementsByTagName){var r=function(l){return At(e.getElementsByTagName(l))};n=n.concat(r("INPUT"),r("TEXTAREA"),r("IFRAME"))}return e.querySelectorAll&&(n=n.concat(At(e.querySelectorAll("[contenteditable]")))),e.ownerDocument&&e instanceof e.ownerDocument.defaultView.HTMLElement&&e.isContentEditable&&n.push(e),n},t.prototype._SetupDocument=function(e){for(var n=this._GetDocumentEditables(e),i=0;i<n.length;i++)this.attachToControl(n[i])},t.prototype._ClearDocument=function(e){for(var n=this._GetDocumentEditables(e),i=0;i<n.length;i++)this.detachFromControl(n[i])},t.prototype.initMutationObservers=function(e,n){if(typeof MutationObserver=="function"){var i=e.querySelector("body"),r;n||(r={childList:!0,subtree:!0},this.attachmentObserver=new MutationObserver(this._AutoAttachObserverCore),this.attachmentObserver.observe(i,r)),r={subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["class","readonly"]},this.enablementObserver=new MutationObserver(this._EnablementMutationObserverCore),this.enablementObserver.observe(i,r),this.inputModeObserver=new MutationObserver(this._InputModeObserverCore),this.enableInputModeObserver()}else console.warn("Your browser is outdated and does not support MutationObservers, a web feature needed by KeymanWeb to support dynamically-added elements.")},t.prototype.enableInputModeObserver=function(){var e,n=document.querySelector("body"),i={subtree:!0,attributes:!0,attributeFilter:["inputmode"]};(e=this.inputModeObserver)===null||e===void 0||e.observe(n,i)},t.prototype.disableInputModeObserver=function(){var e;(e=this.inputModeObserver)===null||e===void 0||e.disconnect()},t.prototype.getBaseFont=function(){var e=document.getElementsByTagName("input"),n=document.getElementsByTagName("textarea"),i=0,r,l="Arial,sans-serif";if(e.length==0&&n.length==0)i=0;else if(e.length>0&&n.length==0)i=1;else if(e.length==0&&n.length>0)i=2;else{var s=e[0],o=n[0];s.offsetTop<o.offsetTop?i=1:s.offsetTop>o.offsetTop?i=2:s.offsetLeft<o.offsetLeft?i=1:s.offsetLeft>o.offsetLeft&&(i=2)}switch(i){case 0:r=l;break;case 1:r=getComputedStyle(e[0]).fontFamily||"";break;case 2:r=getComputedStyle(n[0]).fontFamily||"";break}return(typeof r=="undefined"||r=="monospace")&&(r=l),r},t.prototype.buildAttachmentFontStyle=function(e){var n=e,i=this.baseFont;n&&typeof n.family!="undefined"&&(i=n.family),i=i.replace(/\u0022/g,"");var r=new RegExp("\\s?"+i+",?"),l=this.appliedFont.replace(/\u0022/g,"");l=l.replace(r,""),l=l.replace(/,$/,""),l==""?l=i:l=i+","+l,l='"'+l.replace(/\,\s?/g,'","')+'"';var s=".keymanweb-font{\nfont-family:"+l+" !important;\n}\n";return this.appliedFont=l,s},t.prototype.setAttachmentFont=function(e,n,i){this.stylesheetManager.unlinkAll(),this.stylesheetManager.addStyleSheetForFont(e,n,i),this.stylesheetManager.linkStylesheet(Je(this.buildAttachmentFontStyle(e)))},t.prototype.shutdown=function(){var e,n,i,r;try{(e=this.enablementObserver)===null||e===void 0||e.disconnect(),(n=this.attachmentObserver)===null||n===void 0||n.disconnect(),(i=this.inputModeObserver)===null||i===void 0||i.disconnect(),(r=this.stylesheetManager)===null||r===void 0||r.unlinkAll(),this.inputModeObserver=null,this.embeddedPageContexts.forEach(function(a){try{a.shutdown()}catch(g){}});for(var l=0,s=this.inputList;l<s.length;l++){var o=s[l];try{this.detachFromControl(o)}catch(a){this.emit("disabled",o)}}this._inputList=[]}catch(a){console.error("Error occurred during shutdown"),console.error(a)}},t}(f.default);var co=function(){function c(t,e){this.activationPending=t,this.activated=e}return c}();var yr=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this)||this;return n._maintainingFocus=!1,n.restoringFocus=!1,n._IgnoreNextSelChange=0,n.isTargetForcingScroll=e,n}return Object.defineProperty(t.prototype,"maintainingFocus",{get:function(){return this._maintainingFocus},set:function(e){var n=this._maintainingFocus;this._maintainingFocus=e,n&&!e&&this.emit("maintainingfocusend")},enumerable:!1,configurable:!0}),t.prototype.getUIState=function(){return new co(this.maintainingFocus,this.restoringFocus)},t.prototype.setMaintainingFocus=function(e){this.maintainingFocus=!!e},t.prototype.setFocusTimer=function(){var e=this;this.focusing=!0,this.focusTimer=window.setTimeout(function(){e.focusing=!1},50)},t}(f.default);function Ir(c,t){var e=t!=null&&t.isRTL?"rtl":"ltr";c&&(c instanceof c.ownerDocument.defaultView.HTMLInputElement||c instanceof c.ownerDocument.defaultView.HTMLTextAreaElement?c.value.length==0&&(c.dir=e):typeof c.textContent=="string"&&c.textContent.length==0&&(c.dir=e))}var ro=function(c){(0,B.__extends)(t,c);function t(e,n){var i=c.call(this,e)||this;return i.cookieManager=new Ie("KeymanWeb_Keyboard"),i.focusAssistant=new yr(function(){var r;return(r=i.activeTarget)===null||r===void 0?void 0:r.isForcingScroll()}),i.domEventTracker=new Xe,i._ControlFocus=function(r){var l=Le(r);return l&&i.setActiveTarget(l,!0),!0},i._ControlBlur=function(r){if(i.focusAssistant._IgnoreNextSelChange)return i.focusAssistant._IgnoreNextSelChange--,r.cancelBubble=!0,r.stopPropagation(),!0;if(i.focusAssistant.isTargetForcingScroll())return r.cancelBubble=!0,r.stopPropagation(),!0;var l=Le(r);if(l==null)return!0;i.lastActiveTarget&&i._BlurKeyboardSettings(i.lastActiveTarget.getElement());var s=i.activeTarget;i.currentTarget=null,(s||i.lastActiveTarget)&&(i.mostRecentTarget=l),i.focusAssistant.restoringFocus=!1;var o=i.activeKeyboard,a=i.focusAssistant.maintainingFocus;return!a&&o&&o.keyboard.notify(0,l,0),s&&!i.activeTarget&&i.emit("targetchange",null),i.apiEvents.callEvent("controlblurred",{target:l.getElement(),event:r,isActivating:a}),i.doChangeEvent(l),i.resetContext(),!0},i._Click=function(r){return i.resetContext(),!0},i.nonKMWTouchHandler=function(r){i.focusAssistant.focusing=!1,clearTimeout(i.focusAssistant.focusTimer),i.forgetActiveTarget()},i._eventsObj=n,i.page=new Ci(window.document,{hostDevice:i.engineConfig.hostDevice}),i.focusAssistant.on("maintainingfocusend",function(){!i.activeTarget&&i.mostRecentTarget&&i.emit("targetchange",i.activeTarget)}),i}return Object.defineProperty(t.prototype,"apiEvents",{get:function(){return this._eventsObj()},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){var e=this;this.on("keyboardasyncload",function(n,i){var r;(r=e.engineConfig.alertHost)===null||r===void 0||r.wait("Installing keyboard<br/>"+n.name),i.then(function(){var l;(l=e.engineConfig.alertHost)===null||l===void 0||l.wait()})}),this.engineConfig.deferForInitialization.then(function(){var n=e.engineConfig.hostDevice,i=function(r){return r.stopPropagation()};e.page.on("enabled",function(r){if(!(r._kmwAttachment.interface instanceof ne))n.touchable&&(e.domEventTracker.detachDOMEvent(r,"touchstart",e.nonKMWTouchHandler),e.domEventTracker.attachDOMEvent(r,"touchmove",i,!1),e.domEventTracker.attachDOMEvent(r,"touchend",i,!1)),e.domEventTracker.attachDOMEvent(r,"focus",e._ControlFocus),e.domEventTracker.attachDOMEvent(r,"blur",e._ControlBlur),e.domEventTracker.attachDOMEvent(r,"click",e._Click);else{var l=r.contentWindow.document;n.browser=="firefox"?(e.domEventTracker.attachDOMEvent(l,"focus",e._ControlFocus),e.domEventTracker.attachDOMEvent(l,"blur",e._ControlBlur)):(e.domEventTracker.attachDOMEvent(l.body,"focus",e._ControlFocus),e.domEventTracker.attachDOMEvent(l.body,"blur",e._ControlBlur))}r.ownerDocument.activeElement==r&&e.setActiveTarget(Ce(r),!0)}),e.page.on("disabled",function(r){var l;if(!P(r,"HTMLIFrameElement"))n.touchable&&e.domEventTracker.attachDOMEvent(r,"touchstart",e.nonKMWTouchHandler,!1),e.domEventTracker.detachDOMEvent(r,"focus",e._ControlFocus),e.domEventTracker.detachDOMEvent(r,"blur",e._ControlBlur),e.domEventTracker.detachDOMEvent(r,"click",e._Click);else{var s=r.contentWindow.document;n.browser=="firefox"?(e.domEventTracker.detachDOMEvent(s,"focus",e._ControlFocus),e.domEventTracker.detachDOMEvent(s,"blur",e._ControlBlur)):(e.domEventTracker.detachDOMEvent(s.body,"focus",e._ControlFocus),e.domEventTracker.detachDOMEvent(s.body,"blur",e._ControlBlur))}var o=(l=e.mostRecentTarget)===null||l===void 0?void 0:l.getElement();o&&o==r&&e.forgetActiveTarget()}),e.page.install(e.engineConfig.attachType=="manual")})},Object.defineProperty(t.prototype,"activeTarget",{get:function(){var e=this.focusAssistant.maintainingFocus;return this.currentTarget||(e?this.mostRecentTarget:null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastActiveTarget",{get:function(){return this.mostRecentTarget},enumerable:!1,configurable:!0}),t.prototype.deactivateCurrentTarget=function(){var e=this.activeTarget||this.lastActiveTarget;e&&this.page.isAttached(e.getElement())&&this._BlurKeyboardSettings(e.getElement()),this.activeTarget||this.setActiveTarget(null,!0)},t.prototype.forgetActiveTarget=function(){this.focusAssistant.maintainingFocus=!1,this.focusAssistant.restoringFocus=!1;var e=this.activeTarget||this.mostRecentTarget;e&&this._BlurKeyboardSettings(e.getElement()),this.setActiveTarget(null,!0),e==this.lastActiveTarget&&(this.mostRecentTarget=null)},t.prototype.setActiveTarget=function(e,n){var i,r=this.mostRecentTarget,l=this.activeTarget;if(e==l){l&&(this.currentTarget=l);return}var s=!!r;if(this.currentTarget=this.mostRecentTarget=e,this.predictionContext.setCurrentTarget(e),this.focusAssistant.restoringFocus?this._BlurKeyboardSettings(e.getElement()):e&&this._FocusKeyboardSettings(e.getElement(),!s),!this._CommonFocusHelper(e)){var o=e==null?void 0:e.getElement();if(e instanceof ne&&(o=e.docRoot),o&&o.ownerDocument&&o instanceof o.ownerDocument.defaultView.HTMLElement&&Ir(o,(i=this.activeKeyboard)===null||i===void 0?void 0:i.keyboard),e!=l&&this.emit("targetchange",e),n){var a=r==null?void 0:r.getElement();r instanceof ne&&(a=r.docRoot),o?this.apiEvents.callEvent("controlfocused",{target:o,activeControl:a}):a&&this.apiEvents.callEvent("controlblurred",{target:a,event:null,isActivating:this.focusAssistant.maintainingFocus})}}},Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this._activeKeyboard},enumerable:!1,configurable:!0}),t.prototype.restoreLastActiveTarget=function(){!this.mostRecentTarget||(this.focusAssistant.restoringFocus=!0,this.mostRecentTarget.focus(),this.focusAssistant.restoringFocus=!1)},t.prototype.insertText=function(e,n,i){this.restoreLastActiveTarget();var r=this.activeTarget;return r==null&&this.mostRecentTarget&&(r=this.activeTarget),r!=null?c.prototype.insertText.call(this,e,n,i):!1},t.prototype.currentKeyboardSrcTarget=function(){var e=this.currentTarget||this.mostRecentTarget;return this.isTargetKeyboardIndependent(e)?e:null},t.prototype.isTargetKeyboardIndependent=function(e){var n=e==null?void 0:e.getElement()._kmwAttachment;return!!((n==null?void 0:n.keyboard)||(n==null?void 0:n.keyboard)==="")},t.prototype.activateKeyboardForTarget=function(e,n){var i,r,l=n==null?void 0:n.getElement()._kmwAttachment;if(l?(l.keyboard=(i=e==null?void 0:e.metadata.id)!==null&&i!==void 0?i:"",l.languageCode=(r=e==null?void 0:e.metadata.langId)!==null&&r!==void 0?r:""):this.globalKeyboard=e,this.currentKeyboardSrcTarget()==n){this._activeKeyboard=e;var s=e==null?void 0:e.metadata;this.page.setAttachmentFont(s==null?void 0:s.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS)}},t.prototype.setKeyboardForTarget=function(e,n,i){if(e instanceof ne){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}var r=e.getElement()._kmwAttachment,l=this.currentKeyboardSrcTarget()==e;if(r){if(r.keyboard=n||null,r.languageCode=i||null,l||this.currentKeyboardSrcTarget()==e){var s=this.globalKeyboard.metadata;this.activateKeyboard(r.keyboard||s.id,r.languageCode||s.langId,!0)}}else return},t.prototype.getKeyboardStubForTarget=function(e){if(this.isTargetKeyboardIndependent(e)){var n=e.getElement()._kmwAttachment;return this.keyboardCache.getStub(n.keyboard,n.languageCode)}else return this.globalKeyboard.metadata},t.prototype.getFallbackStubKey=function(){var e={id:"",langId:""};return this.engineConfig.hostDevice.touchable&&this.keyboardCache.defaultStub||e},t.prototype.activateKeyboard=function(e,n,i){return(0,B.__awaiter)(this,void 0,void 0,function(){var r,l,s,o,a,g=this,d,F,u,I,Q,y;return(0,B.__generator)(this,function(U){switch(U.label){case 0:return i||(i=!1),r=this.currentKeyboardSrcTarget(),this.engineConfig.deferForInitialization.isFulfilled?[3,2]:[4,this.engineConfig.deferForInitialization.corePromise];case 1:U.sent(),U.label=2;case 2:e||(e=this.getFallbackStubKey().id,n=this.getFallbackStubKey().langId),U.label=3;case 3:return U.trys.push([3,5,,9]),[4,c.prototype.activateKeyboard.call(this,e,n,i)];case 4:return l=U.sent(),(d=this.engineConfig.alertHost)===null||d===void 0||d.wait(),i&&!r&&this.cookieManager.save({current:"".concat(e,":").concat(n)}),r==this.currentKeyboardSrcTarget()&&(Ir((F=this.currentTarget)===null||F===void 0?void 0:F.getElement(),this.keyboardCache.getKeyboard(e)),this.page.setAttachmentFont((I=(u=this.activeKeyboard)===null||u===void 0?void 0:u.metadata)===null||I===void 0?void 0:I.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS),this.restoreLastActiveTarget()),[2,l];case 5:return s=U.sent(),o=function(){return(0,B.__awaiter)(g,void 0,void 0,function(){var b;return(0,B.__generator)(this,function(C){switch(C.label){case 0:return b=this.getFallbackStubKey(),b.id==e?[3,2]:[4,this.activateKeyboard(b.id,b.langId,!0).catch(function(){})];case 1:C.sent(),C.label=2;case 2:return[2]}})})},(Q=this.engineConfig.alertHost)===null||Q===void 0||Q.wait(),a=(s==null?void 0:s.message)||"Sorry, the "+e+" keyboard for "+n+" is not currently available.",s instanceof dt?console.error(s||a):console.warn(s||a),this.engineConfig.alertHost?((y=this.engineConfig.alertHost)===null||y===void 0||y.alert(a,o),[3,8]):[3,6];case 6:return[4,o()];case 7:U.sent(),U.label=8;case 8:throw s;case 9:return[2]}})})},t.prototype._BlurKeyboardSettings=function(e,n,i){var r,l=this.activeKeyboard?this.activeKeyboard.keyboard.id:"",s=(r=this.activeKeyboard)===null||r===void 0?void 0:r.metadata.langId;n!==void 0&&i!==void 0&&(l=n,s=i),e&&e._kmwAttachment.keyboard!=null?(e._kmwAttachment.keyboard=l,e._kmwAttachment.languageCode=s):this.globalKeyboard=this.activeKeyboard},t.prototype._FocusKeyboardSettings=function(e,n){var i,r=e._kmwAttachment,l=this.globalKeyboard;r.keyboard!=null?this.activateKeyboard(r.keyboard,r.languageCode,!0):!n&&(l==null?void 0:l.metadata)!=((i=this._activeKeyboard)===null||i===void 0?void 0:i.metadata)&&this.activateKeyboard(l==null?void 0:l.metadata.id,l==null?void 0:l.metadata.langId,!0)},t.prototype._CommonFocusHelper=function(e){var n,i=this.focusAssistant,r=(n=this.activeKeyboard)===null||n===void 0?void 0:n.keyboard;return i.restoringFocus||(e==null||e.deadkeys().clear(),r==null||r.notify(0,e,1)),!i.restoringFocus&&this.mostRecentTarget!=e&&(i.maintainingFocus=!1),i.restoringFocus=!1,this.resetContext(),!1},t.prototype.doChangeEvent=function(e){if(e.changed){var n=new Event("change",{bubbles:!0,cancelable:!1});e.getElement().dispatchEvent(n)}e.changed=!1},t.prototype.getSavedKeyboardRaw=function(){var e=new Ie("KeymanWeb_Keyboard"),n=e.load(decodeURIComponent);return typeof n.current!="string"||n.current=="Keyboard_us:eng"?"Keyboard_us:en":n.current},t.prototype.getSavedKeyboard=function(){for(var e=this.getSavedKeyboardRaw(),n=this.keyboardCache.getStubList(),i,r=0;r<n.length;r++)if(i=n[r].KI+":"+n[r].KLC,i==e)return i;for(var r=0;r<n.length;r++)if(i=n[r].KI+":"+n[r].KLC,i=="Keyboard_us:en")return i;return n.length>0?n[0].KI+":"+n[0].KLC:"Keyboard_us:en"},t.prototype.restoreSavedKeyboard=function(e){var n=e,i=n.split(":");i.length<2&&(i[1]="");var r=this.keyboardCache.getStub(i[0],i[1])||this.keyboardCache.defaultStub;return r?this.activateKeyboard(r.id,r.langId):null},t.prototype.shutdown=function(){this.page.shutdown(),this.domEventTracker.shutdown()},t}(Xn),Qr=ro;var lo=function(c){(0,B.__extends)(t,c);function t(e){var n=c.call(this)||this;return n.contextManager=e,n}return t.prototype.isCommand=function(e){var n=this.codeForEvent(e);switch(n){case h.keyCodes.K_TAB:case h.keyCodes.K_TABBACK:case h.keyCodes.K_TABFWD:return!0;default:return c.prototype.isCommand.call(this,e)}},t.prototype.applyCommand=function(e,n){var i=this,r=this.codeForEvent(e),l=function(s){var o,a=i.contextManager,g=(o=a.activeTarget)===null||o===void 0?void 0:o.getElement(),d=a.page.findNeighboringInput(g,s);d==null||d.focus()};switch(r){case h.keyCodes.K_TAB:l((e.Lmodifiers&h.modifierCodes.SHIFT)!=0);break;case h.keyCodes.K_TABBACK:l(!0);break;case h.keyCodes.K_TABFWD:l(!1);break}c.prototype.applyCommand.call(this,e,n)},t}(ke),Ur=lo;function xi(c){return c.keyCode?c.keyCode:c.which?c.which:null}function nn(c,t,e){if(c.cancelBubble===!0)return null;var n=xi(c);if(n==null)return null;var i=t.modStateFlags,r=0,l=!1,s=!1,o=h.keyCodes;switch(n){case o.K_CTRL:case o.K_LCTRL:case o.K_RCTRL:case o.K_CONTROL:case o.K_LCONTROL:case o.K_RCONTROL:l=!0;break;case o.K_LMENU:case o.K_RMENU:case o.K_ALT:case o.K_LALT:case o.K_RALT:s=!0;break}r|=c.getModifierState("Shift")?16:0;var a=h.modifierCodes;c.getModifierState("Control")&&(r|=c.location!=0&&l?c.location==1?a.LCTRL:a.RCTRL:i&3),c.getModifierState("Alt")&&(r|=c.location!=0&&s?c.location==1?a.LALT:a.RALT:i&12);var g=0;g|=c.getModifierState("CapsLock")?a.CAPS:a.NO_CAPS,g|=c.getModifierState("NumLock")?a.NUM_LOCK:a.NO_NUM_LOCK,g|=c.getModifierState("ScrollLock")?a.SCROLL_LOCK:a.NO_SCROLL_LOCK,r|=g;var d=t.modStateFlags!=r;t.modStateFlags=r;var F=a.RALT|a.LCTRL;(i&F)==F&&(r&F)!=F&&(r&=~F),r&a.RALT&&(r&=~a.LCTRL);var u=h.modifierBitmasks,I=t.activeKeyboard,Q;I&&I.isChiral?(Q=r&u.CHIRAL,I.emulatesAltGr&&(Q&u.ALT_GR_SIM)==u.ALT_GR_SIM&&(Q^=u.ALT_GR_SIM,Q|=a.RALT)):Q=r&16|(r&(a.LCTRL|a.RCTRL)?32:0)|(r&(a.LALT|a.RALT)?64:0),Q|=c.metaKey?a.META:0,e.browser==v.Browser.Firefox&&de.browserMap.FF["k"+n]&&(n=de.browserMap.FF["k"+n]);var y=new ge({device:e,kName:"",Lcode:n,Lmodifiers:Q,Lstates:g,LmodifierChange:d,isSynthetic:!1}),U=typeof c.charCode!="undefined"&&c.charCode!=null&&(c.charCode==0||(Q&111)!=0);y.LisVirtualKey=U||c.type!="keypress",y=fn(y,I,t.baseLayout);var b=new ge(y);return b.source=c,b}var so=function(c){(0,B.__extends)(t,c);function t(e,n,i){var r=c.call(this)||this;r.domEventTracker=new Xe,r.swallowKeypress=!1,r._KeyDown=function(o){var a,g=r.contextManager.activeKeyboard,d=Le(o);if(!d||g==null)return!0;var F=d.getElement();return((a=F==null?void 0:F.getAttribute("class"))===null||a===void 0?void 0:a.indexOf("kmw-disabled"))>=0?!0:r.keyDown(o)},r._KeyPress=function(o){var a,g=Le(o);return!g||((a=r.contextManager.activeKeyboard)===null||a===void 0?void 0:a.keyboard)==null?!0:r.keyPress(o)},r._KeyUp=function(o){var a=Le(o),g=nn(o,r.processor,r.hardDevice);if(g==null||a==null)return!0;var d=a.getElement();if(g.Lcode==13){var F=!1;if(P(d,"HTMLTextAreaElement")&&(F=!0),!F){if(d instanceof d.ownerDocument.defaultView.HTMLInputElement)if(d.form&&(d.type=="search"||d.type=="submit"))d.form.submit();else{var u=r.contextManager.page.findNeighboringInput(d,!1);u.focus()}return!0}}return r.keyUp(o)},r.hardDevice=e,r.contextManager=i,r.processor=n;var l=i.page,s=r.domEventTracker;return l.on("enabled",function(o){var a=Ce(o);if(!(a instanceof ne))s.attachDOMEvent(o,"keypress",r._KeyPress),s.attachDOMEvent(o,"keydown",r._KeyDown),s.attachDOMEvent(o,"keyup",r._KeyUp);else{var g=a.getElement().contentDocument;s.attachDOMEvent(g.body,"keydown",r._KeyDown),s.attachDOMEvent(g.body,"keypress",r._KeyPress),s.attachDOMEvent(g.body,"keyup",r._KeyUp)}}),l.on("disabled",function(o){var a=Ce(o);if(!(a instanceof ne))s.detachDOMEvent(o,"keypress",r._KeyPress),s.detachDOMEvent(o,"keydown",r._KeyDown),s.detachDOMEvent(o,"keyup",r._KeyUp);else{var g=a.getElement().contentDocument;s.detachDOMEvent(g.body,"keydown",r._KeyDown),s.detachDOMEvent(g.body,"keypress",r._KeyPress),s.detachDOMEvent(g.body,"keyup",r._KeyUp)}}),r}return t.prototype.keyDown=function(e){var n=this;this.swallowKeypress=!1;var i=nn(e,this.processor,this.hardDevice);if(i==null)return!0;var r={LeventMatched:!1};return this.emit("keyevent",i,function(l,s){r.LeventMatched=l&&!l.triggerKeyDefault,r.LeventMatched?(e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),n.swallowKeypress=!!i.Lcode,i.Lcode==8&&(n.swallowKeypress=!1)):n.swallowKeypress=!1}),!r.LeventMatched},t.prototype.keyUp=function(e){var n=nn(e,this.processor,this.hardDevice);if(n==null)return!0;var i=Le(e);return this.processor.doModifierPress(n,i,!1)},t.prototype.keyPress=function(e){var n,i=nn(e,this.processor,this.hardDevice);if(i==null||i.LisVirtualKey)return!0;if(!(!((n=this.contextManager.activeKeyboard)===null||n===void 0)&&n.keyboard.isMnemonic))return!this.swallowKeypress||i.Lcode<32||this.hardDevice.browser==v.Browser.Safari&&i.Lcode>63232&&i.Lcode<63744;var r={};return this.swallowKeypress||this.emit("keyevent",i,function(l,s){r.preventDefaultKeystroke=!!l}),this.swallowKeypress||r.preventDefaultKeystroke?(this.swallowKeypress=!1,e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),!1):(this.swallowKeypress=!1,!0)},t.prototype.shutdown=function(){this.domEventTracker.shutdown()},t}(Zn),br=so;var hr=function(){function c(){this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}return c.prototype.equals=function(t){return this.innerWidth==t.innerWidth&&this.innerHeight==t.innerHeight},c}(),Cr=function(){function c(t){this.idlePermutationCounter=c.IDLE_PERMUTATION_CAP,this.keyman=t}return c.prototype.resolve=function(){var t=this,e,n=this.keyman.osk;(e=this.keyman.touchLanguageMenu)===null||e===void 0||e.hide(),this.keyman.touchLanguageMenu=null,n.setNeedsLayout(),this.oskVisible&&n.present(),this.isActive=!1,this.updateTimer&&(window.clearInterval(this.updateTimer),this.rotState=null);var i=this.keyman.contextManager.activeTarget;i&&window.setTimeout(function(){t.keyman.ensureElementVisibility(i.getElement())},0)},c.prototype.initNewRotation=function(){this.oskVisible=this.keyman.osk.isVisible(),this.keyman.osk.hideNow(),this.isActive=!0},c.prototype.init=function(){var t=this,e=this.keyman.config.hostDevice.OS,n=this.keyman.util;e=="ios"?(n.attachDOMEvent(window,"orientationchange",function(){return t.iOSEventHandler(),!1}),n.attachDOMEvent(window,"resize",function(){return t.iOSEventHandler(),!1})):e=="android"&&("onmozorientationchange"in screen?n.attachDOMEvent(screen,"mozorientationchange",function(){return t.initNewRotation(),!1}):n.attachDOMEvent(window,"orientationchange",function(){return t.initNewRotation(),!1}),n.attachDOMEvent(window,"resize",function(){return t.resolve(),!1}))},c.prototype.iOSEventHandler=function(){this.isActive||(this.initNewRotation(),this.rotState=new hr,this.updateTimer=window.setInterval(this.iOSEventUpdate.bind(this),c.UPDATE_INTERVAL)),this.idlePermutationCounter=0},c.prototype.iOSEventUpdate=function(){var t=new hr;this.rotState.equals(t)?++this.idlePermutationCounter==c.IDLE_PERMUTATION_CAP&&this.resolve():(this.rotState=t,this.idlePermutationCounter=0)},c.IDLE_PERMUTATION_CAP=15,c.UPDATE_INTERVAL=20,c}();var xr=function(){function c(t,e){var n=this;this.domEventTracker=new Xe,this.suppressFocusCheck=function(i){return n.focusAssistant.isTargetForcingScroll()&&(i.stopPropagation(),i.cancelBubble=!0),!0},this.pageFocusHandler=function(){var i;return!n.focusAssistant.maintainingFocus&&((i=n.engine.osk)===null||i===void 0?void 0:i.vkbd)&&(n.engine.contextManager.deactivateCurrentTarget(),n.engine.contextManager.resetContext()),!1},this.touchStartActivationHandler=function(i){var r,l,s=n.engine.osk;if(!s)return!1;var o=n.engine.config.hostDevice;if(n.deactivateOnRelease=!0,n.touchY=i.touches[0].screenY,n.deactivateOnScroll=!1,o.OS=="android"&&o.browser=="chrome"){if(typeof s._Box=="undefined"||typeof s._Box.style=="undefined")return!1;var a=i.target.parentElement;if(typeof a!="undefined"&&a!=null&&(((r=a.getAttribute("class"))===null||r===void 0?void 0:r.indexOf("kmw-key-"))>=0||typeof a.parentElement!="undefined"&&a.parentElement!=null&&(a=a.parentElement,((l=a.getAttribute("class"))===null||l===void 0?void 0:l.indexOf("kmw-key-"))>=0)))return!1;n.deactivateOnScroll=!0}return!1},this.touchMoveActivationHandler=function(i){n.deactivateOnScroll&&(n.focusAssistant.focusing=!1,n.engine.contextManager.deactivateCurrentTarget());var r=i.touches[0].screenY,l=n.touchY;return(r-l>5||l-r<5)&&(n.deactivateOnRelease=!1),!1},this.touchEndActivationHandler=function(i){return n.deactivateOnRelease&&!n.engine.touchLanguageMenu&&!n.focusAssistant.focusing&&n.engine.contextManager.deactivateCurrentTarget(),n.deactivateOnRelease=!1,!1},this._WindowLoad=function(){document.body.scrollTop=0,typeof document.documentElement!="undefined"&&(document.documentElement.scrollTop=0)},this._WindowUnload=function(){n.engine.shutdown()},this.window=t,this.engine=e,this.attachHandlers(),e.config.hostDevice.touchable&&(this.buildPageTrailer(),this.rotationProcessor=new Cr(this.engine),this.rotationProcessor.init())}return c.prototype.buildPageTrailer=function(){var t=this.mobilePageTrailer=document.createElement("div"),e=t.style;e.width="100%",e.height=screen.width/2+"px",document.body.appendChild(t)},Object.defineProperty(c.prototype,"focusAssistant",{get:function(){return this.engine.contextManager.focusAssistant},enumerable:!1,configurable:!0}),c.prototype.attachHandlers=function(){var t=this.domEventTracker,e=this.engine.config.hostDevice,n=this.window.document.body;t.attachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),t.attachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),t.attachDOMEvent(n,"focus",this.suppressFocusCheck,!0),t.attachDOMEvent(n,"blur",this.suppressFocusCheck,!0),e.touchable&&(t.attachDOMEvent(n,"touchstart",this.touchStartActivationHandler,!1),t.attachDOMEvent(n,"touchmove",this.touchMoveActivationHandler,!1),t.attachDOMEvent(n,"touchend",this.touchEndActivationHandler,!1)),t.attachDOMEvent(window,"load",this._WindowLoad,!1),t.attachDOMEvent(window,"unload",this._WindowUnload,!1),t.attachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)},c.prototype.shutdown=function(){var t,e=this.domEventTracker,n=this.engine.config.hostDevice,i=this.window.document.body;e.detachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),e.detachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),e.detachDOMEvent(i,"focus",this.suppressFocusCheck,!0),e.detachDOMEvent(i,"blur",this.suppressFocusCheck,!0),n.touchable&&(e.detachDOMEvent(i,"touchstart",this.touchStartActivationHandler,!1),e.detachDOMEvent(i,"touchmove",this.touchMoveActivationHandler,!1),e.detachDOMEvent(i,"touchend",this.touchEndActivationHandler,!1),(t=this.mobilePageTrailer)===null||t===void 0||t.parentElement.removeChild(this.mobilePageTrailer)),e.detachDOMEvent(window,"load",this._WindowLoad,!1),e.detachDOMEvent(window,"unload",this._WindowUnload,!1),e.detachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)},c}();function se(c){var t=document.createElement(c);return t.style.userSelect="none",t.style.MozUserSelect="none",t.style.KhtmlUserSelect="none",t.style.UserSelect="none",t.style.WebkitUserSelect="none",t}function ze(c,t){try{if(c&&typeof window.getComputedStyle!="undefined")return window.getComputedStyle(c,"").getPropertyValue(t)}catch(e){}return""}var Gr=function(){function c(t){this.keyman=t,this.scrolling=!1,this.shim=this.constructShim()}return c.prototype.constructShim=function(){var t=this,e=this,n=se("div"),i=this.keyman.osk;return n.id="kmw-language-menu-background",n.addEventListener("touchstart",function(r){if(r.preventDefault(),e.hide(),r.touches.length>2){var l=r.touches[1].pageX,s=r.touches[1].pageY,o=i.vkbd.spaceBar;l>o.offsetLeft&&l<o.offsetLeft+o.offsetWidth&&s>o.offsetTop&&s<o.offsetTop+o.offsetHeight&&t.keyman.osk.emit("showbuild")}},!1),n},c.prototype.show=function(){var t=this.keyman.config.hostDevice,e=this.keyman.keyboardRequisitioner.cache.getStubList(),n=e.length;if(!(n<1)){var i=this.lgList=se("div");this.lgList.id="kmw-language-menu";var r=this;document.body.appendChild(this.shim);var l=se("div"),s=l.style,o=se("div");l.id="kmw-menu-scroll-container",o.id="kmw-menu-scroller","WebkitOverflowScrolling"in s&&(s.WebkitOverflowScrolling="touch"),l.appendChild(o),i.appendChild(l);var a,g=se("div");g.id="kmw-menu-index";for(var d=1;d<=26;d++)a=se("p"),a.innerHTML=String.fromCharCode(d+64),g.appendChild(a);if(g.addEventListener("touchstart",function(x){r.scrollToLanguage(x,l,o)},!1),g.addEventListener("touchend",function(x){x.stopPropagation()},!1),i.appendChild(g),i.addEventListener("scroll",function(x){r.scrolling=!0},!1),l.addEventListener("scroll",function(x){l.scrollTop<1&&(l.scrollTop=1),l.scrollTop>l.scrollHeight-l.offsetHeight-1&&(l.scrollTop=l.scrollHeight-l.offsetHeight-1)},!1),this.activeLgNo=this.addLanguages(o,e),this.lgList.style.visibility="hidden",document.body.appendChild(this.lgList),t.OS=="android"&&"devicePixelRatio"in window&&(this.lgList.style.fontSize=2/window.devicePixelRatio+"em"),t.OS=="android"&&t.formFactor=="tablet"&&"devicePixelRatio"in window){var F=parseInt(ze(i,"width"),10),u=i.style;isNaN(F)||(u.width=u.maxWidth=2*F/window.devicePixelRatio+"px"),F=parseInt(ze(l,"width"),10),u=l.style,isNaN(F)||(u.width=u.maxWidth=2*F/window.devicePixelRatio+"px"),F=parseInt(ze(o,"width"),10),u=o.style,isNaN(F)||(u.width=u.maxWidth=2*F/window.devicePixelRatio+"px")}this.adjust(0);var I=g.childNodes[1].offsetTop-g.childNodes[0].offsetTop,Q=Math.floor(i.offsetHeight/26),y=Math.round(100*Q/I)/100,U=y>.6?1:2;y>1.25&&(y=1.25);for(var d=0;d<26;d++){var b=g.childNodes[d].style;U==2&&d%2==1?b.display="none":(b.fontSize=y*U+"em",b.lineHeight=Q*U+"px")}var C=l.offsetWidth;l.scrollHeight>l.offsetHeight+3?C=C+g.offsetWidth:g.style.display="none",i.style.width=C+"px",this.lgList.style.visibility="",this.scrollToIndex(this.activeLgNo,l,o)}},c.prototype.adjust=function(t){var e=this.keyman.osk,n=this.keyman.config.hostDevice,i=this.lgList,r=i.firstChild,l=r.firstChild,s=0,o=i.style,a=i.childNodes[1],g=window.innerHeight-e.vkbd.lgKey.offsetHeight-16,d=l.childNodes.length+t-1,F=l.firstChild.firstChild.offsetHeight,u=d*F;n.OS=="ios"&&(n.formFactor=="phone"?(s=re()?36:0,g=(window.innerHeight-s-16)*be(n.formFactor)):n.formFactor=="tablet"&&(s=re()?16:0,g=g-s)),o.left=z(e.vkbd.lgKey)+"px",u>g&&(u=g),o.height=u+"px",o.bottom="0px",a.style.height=r.style.height=o.height},c.prototype.scrollToLanguage=function(t,e,n){t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault();var i=t.touches[0].target;if(i.nodeName=="P"){var r,l,s=i.innerHTML.charCodeAt(0),o=n.childNodes;try{for(r=0;r<o.length-1&&(l=o[r].firstChild.innerHTML.toUpperCase().charCodeAt(0),!(l>=s));r++);}catch(a){}this.scrollToIndex(r,e,n)}},c.prototype.scrollToIndex=function(t,e,n){var i,r=.5;try{i=n.firstChild.getBoundingClientRect().height*(t-r)+1,e.scrollTop=i}catch(l){i=0}try{e.scrollTop<0&&(e.scrollTop=0),e.scrollTop>e.scrollHeight-e.offsetHeight-1&&(e.scrollTop=e.scrollHeight-e.offsetHeight-1)}catch(l){}},c.prototype.addLanguages=function(t,e){for(var n,i=e.length,r=this.keyman.config.hostDevice,l=[],s=0;s<i;s++){var o=e[s].KL;l.indexOf(o)==-1&&l.push(o)}l.sort();for(var a=Math.round(100/be(r.formFactor))/100,g=-1,d=function(y){var U=se("div");U.className="kbd-list-closed";var b=se("p");b.kList=[];for(var C=0;C<i;C++)e[C].KL==l[y]&&b.kList.push(e[C]);r.OS=="ios"&&(b.style.fontSize=a+"em"),U.appendChild(b),t.appendChild(U),l[y]==((n=F.keyman.contextManager.activeKeyboard)===null||n===void 0?void 0:n.metadata.langName)&&(g=y);var x=F;if(b.kList.length>1){b.className="kbd-list",b.innerHTML=l[y]+"...",b.scrolled=!1,b.ontouchend=function(V){V.stopPropagation(),b.scrolled?b.scrolled=!1:b.parentElement.className=b.parentElement.className=="kbd-list-closed"?"kbd-list-open":"kbd-list-closed",x.adjust(b.parentElement.className=="kbd-list-closed"?0:b.kList.length)},b.addEventListener("touchstart",function(V){V.stopPropagation()},!1),b.addEventListener("touchmove",function(V){b.scrolled=!0,V.stopPropagation()},!1);for(var X=0;X<b.kList.length;X++){var p=se("p");p.className="kbd-list-entry",r.OS=="ios"&&(p.style.fontSize=a+"em"),F.addKeyboard(b.kList[X],p,!1),U.appendChild(p)}}else b.innerHTML=l[y],b.className="kbd-single-entry",F.addKeyboard(b.kList[0],b,!0);y==g&&(b.className=b.className+" current")},F=this,u=0;u<l.length;u++)d(u);var I=se("div");I.id="kmw-menu-footer";var Q=function(y){y.cancelable&&y.preventDefault(),y.stopPropagation()};return I.addEventListener("touchstart",Q,!1),I.addEventListener("touchmove",Q,!1),I.addEventListener("touchend",Q,!1),t.appendChild(I),g},c.prototype.addKeyboard=function(t,e,n){var i=this;e.kn=t.KI,e.kc=t.KLC,e.innerHTML=n?t.KL:t.KN.replace(" Keyboard","");var r=this,l=function(){if(i.originalBodyStyle)return console.error("Unexpected state:  `originalBodyStyle` was not cleared by a previous `unlockBodyScroll()` call"),!1;i.originalBodyStyle={};var F=i.originalBodyStyle,u=document.body.style;return F.overflowY=u.overflowY,F.height=u.height,u.overflowY="hidden",u.height="100%",!0},s=function(){if(!i.originalBodyStyle){console.error("Unexpected state:  `originalBodyStyle` is unset; cannot restore original body style");return}var F=i.originalBodyStyle,u=document.body.style;u.overflowY=F.overflowY,u.height=F.height,i.originalBodyStyle=null},o=function(F){F.stopPropagation(),this.className.indexOf("selected")<=0&&(this.className=this.className+" selected"),r.scrolling=!1,r.y0=F.touches[0].pageY,l()},a=function(F){F.stopImmediatePropagation();var u=r.lgList.childNodes[0],I=u.scrollHeight-u.offsetHeight,Q,y;if(typeof F.pageY!="undefined")Q=F.pageY;else if(typeof F.touches!="undefined")Q=F.touches[0].pageY;else return!1;if(y=Q-r.y0,y<0)u.scrollTop>=I-1&&(r.y0=Q);else if(y>0)u.scrollTop<2&&(r.y0=Q);else return!1;return(y<-5||y>5)&&(r.scrolling=!0,this.className=this.className.replace(/\s*selected/,""),r.y0=Q),!0},g=function(F){var u=this;return typeof F.stopImmediatePropagation!="undefined"?F.stopImmediatePropagation():F.stopPropagation(),r.scrolling?this.className=this.className.replace(/\s*selected/,""):(r.keyman.contextManager.focusAssistant.setFocusTimer(),r.lgList.style.display="none",r.keyman.contextManager.activateKeyboard(u.kn,u.kc,!0),r.keyman.contextManager.restoreLastActiveTarget(),r.hide()),s(),!0},d=function(F){s()};e.addEventListener("touchstart",o,!1),e.addEventListener("touchmove",a,!1),e.addEventListener("touchend",g,!1),e.addEventListener("touchcancel",d,!1)},c.prototype.hide=function(){var t=this,e=this.keyman.osk;this.lgList&&(e.vkbd.highlightKey(e.vkbd.lgKey,!1),this.lgList.style.visibility="hidden",window.setTimeout(function(){t.shim.parentElement&&(document.body.removeChild(t.shim),document.body.removeChild(t.lgList))},500)),this.keyman.touchLanguageMenu=null},c}();function pr(c,t,e){var n=this,i=e.focusAssistant;t.on("globekey",function(r,l){l&&t.hostDevice.touchable&&(c.touchLanguageMenu=new Gr(c),c.touchLanguageMenu.show()),t.vkbd&&t.vkbd.highlightKey(r,!1)}),t.on("hiderequested",function(r){t&&(t.startHide(!0),e.forgetActiveTarget())}),t.addEventListener("hide",function(r){var l;r!=null&&r.HiddenByUser&&((l=e.activeTarget)===null||l===void 0||l.focus())}),t.on("showbuild",function(){var r;(r=c.config.alertHost)===null||r===void 0||r.alert("KeymanWeb Version "+Fn.VERSION+'<br /><br /><span style="font-size:0.8em">Copyright &copy; 2007-2023 SIL International</span>')}),t.on("dragmove",function(r){return(0,B.__awaiter)(n,void 0,void 0,function(){return(0,B.__generator)(this,function(l){switch(l.label){case 0:return i.restoringFocus=!0,[4,r];case 1:return l.sent(),e.restoreLastActiveTarget(),i.restoringFocus=!1,i.setMaintainingFocus(!1),[2]}})})}),t.on("resizemove",function(r){return(0,B.__awaiter)(n,void 0,void 0,function(){return(0,B.__generator)(this,function(l){switch(l.label){case 0:return i.restoringFocus=!0,[4,r];case 1:return l.sent(),e.restoreLastActiveTarget(),i.restoringFocus=!1,i.setMaintainingFocus(!1),[2]}})})}),t.on("pointerinteraction",function(r){return(0,B.__awaiter)(n,void 0,void 0,function(){return(0,B.__generator)(this,function(l){switch(l.label){case 0:return i.setMaintainingFocus(!0),[4,r];case 1:return l.sent(),i.setMaintainingFocus(!1),[2]}})})})}function ao(c){var t=document.createElement(c);return t.style.userSelect="none",t}var Vr=function(){function c(t){this.getAbsoluteX=z,this.getAbsoluteY=K,this._GetAbsoluteX=z,this._GetAbsoluteY=K,this._GetAbsolute=this.getAbsolute,this.toNzString=this.nzString,this.createElement=ao,this.getStyleValue=ze,this.config=t,this.stylesheetManager=new ye(document.body,t.applyCacheBusting),this.domEventTracker=new Xe}return c.prototype.isTouchDevice=function(){return this.config.hostDevice.touchable},c.prototype.getAbsolute=function(t){return{x:z(t),y:K(t)}},c.prototype.getOption=function(t,e){return t in this.config.paths?this.config.paths[t]:t in this.config.options?this.config.options[t]:arguments.length>1?e:""},c.prototype.setOption=function(t,e){switch(t){case"attachType":break;case"ui":break;case"useAlerts":this.config.signalUser=e?new nt:null;break;case"setActiveOnRegister":this.config.activateFirstKeyboard=!!e;break;case"spacebarText":this.config.spacebarText=e;break;default:throw new Error("Path-related options may not be changed after the engine has initialized.")}},c.prototype.loadCookie=function(t){var e=new Ie(t);return e.load(decodeURIComponent)},c.prototype.saveCookie=function(t,e){var n=new Ie(t);n.save(e,encodeURIComponent)},c.prototype.addStyleSheet=function(t){var e=Je(t);return this.stylesheetManager.linkStylesheet(e),e},c.prototype.removeStyleSheet=function(t){return this.stylesheetManager.unlink(t)},c.prototype.linkStyleSheet=function(t){this.stylesheetManager.linkExternalSheet(t)},c.prototype.getLanguageCodes=function(t){return t.indexOf("-")==-1?[t]:t.split("-")},c.prototype.attachDOMEvent=function(t,e,n,i){this.domEventTracker.attachDOMEvent(t,e,n,i)},c.prototype.detachDOMEvent=function(t,e,n,i){this.domEventTracker.detachDOMEvent(t,e,n,i)},Object.defineProperty(c.prototype,"alertHost",{get:function(){return this.config.alertHost?this.config.alertHost:(this._alertHost||(this._alertHost=new nt),this._alertHost)},enumerable:!1,configurable:!0}),c.prototype.alert=function(t,e){this.alertHost.alert(t,e)},c.prototype.nzString=function(t,e){var n="";return arguments.length>1&&(n=e),typeof t=="undefined"||t==null||t==0||t==""?n:""+t},c.prototype.toNumber=function(t,e){var n=parseInt(t,10);return isNaN(n)?e:n},c.prototype.toFloat=function(t,e){var n=parseFloat(t);return isNaN(n)?e:n},c.prototype.rgba=function(t,e,n,i,r){var l="transparent";try{l="rgba("+e+","+n+","+i+","+r+")"}catch(s){l="rgb("+e+","+n+","+i+")"}return l},c.prototype.shutdown=function(){var t,e,n;(t=this.stylesheetManager)===null||t===void 0||t.unlinkAll(),(e=this.domEventTracker)===null||e===void 0||e.shutdown(),(n=this._alertHost)===null||n===void 0||n.shutdown()},c}();var go=function(){function c(t,e,n){this.code=t,this.shift=e,this.handler=n}return c.prototype.matches=function(t,e){return this.code==t&&this.shift==e},c}(),mr=function(){function c(){var t=this;this.hotkeys=[],this._Process=function(e){e||(e=window.event);var n=xi(e);if(n==null)return!1;for(var i=(e.shiftKey?16:0)|(e.ctrlKey?32:0)|(e.altKey?64:0),r=0;r<t.hotkeys.length;r++)if(t.hotkeys[r].matches(n,i))return t.hotkeys[r].handler(),e.returnValue=!1,e&&e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1;return!0}}return c.prototype.addHotKey=function(t,e,n){for(var i=0;i<this.hotkeys.length;i++)if(this.hotkeys[i].code==t&&this.hotkeys[i].shift==e){this.hotkeys[i].handler=n;return}this.hotkeys.push(new go(t,e,n))},c.prototype.removeHotkey=function(t,e){for(var n=0;n<this.hotkeys.length;n++)if(this.hotkeys[n].matches(t,e)){this.hotkeys.splice(n,1);return}},c}();var Bo=function(){function c(t){this.e=t,this.c=t.style.backgroundColor}return c.prototype.reset=function(){this.e.style.backgroundColor=this.c},c}(),Xr=function(){function c(t){var e=this;this._BeepObjects=[],this._BeepTimeout=0,this.reset=function(){e.keyboardInterface.resetContextCache();var n;for(e._BeepTimeout=0,n=0;n<e._BeepObjects.length;n++)e._BeepObjects[n].reset();e._BeepObjects=[]},this.keyboardInterface=t}return c.prototype.beep=function(t){if(t instanceof te){var e=t.getElement();if(t instanceof ne&&(e=t.docRoot),!!e&&!(!e.style||typeof e.style.backgroundColor=="undefined")){for(var n=0;n<this._BeepObjects.length;n++)if(this._BeepObjects[n].e==e)return;this._BeepObjects.push(new Bo(e)),e.style.backgroundColor="#000000",this._BeepTimeout==0&&(this._BeepTimeout=1,window.setTimeout(this.reset,50))}}},c}();var Zr=function(c){(0,B.__extends)(t,c);function t(e,n){var i=c.call(this,e,n)||this;return i.GetLastActiveElement=i.getLastActiveElement,i.FocusLastActiveElement=i.focusLastActiveElement,i.HideHelp=i.hideHelp,i.ShowHelp=i.showHelp,i.ShowPinnedHelp=i.showPinnedHelp,i}return t.prototype.saveFocus=function(){this.engine.contextManager.focusAssistant._IgnoreNextSelChange=1},t.prototype.getLastActiveElement=function(){return this.engine.contextManager.lastActiveTarget},t.prototype.focusLastActiveElement=function(){this.engine.contextManager.restoreLastActiveTarget()},t.prototype.hideHelp=function(){var e=this.engine.osk;e.startHide(!0)},t.prototype.showHelp=function(e,n){var i=this.engine.osk;i instanceof et?i.presentAtPosition(e,n):i.present()},t.prototype.showPinnedHelp=function(){var e=this.engine.osk;e instanceof et&&(!e.activeKeyboard.keyboard.isCJK||!this.ruleBehavior)&&(e.userPositioned=!0),e.present()},t}(Nn),fr=Zr;(function(){Zr.__publishShorthandAPI()})();var Fo=function(c){(0,B.__extends)(t,c);function t(e,n){var i=this,r=new Fr(n);return i=c.call(this,e,r,new Qr(r,function(){return i.legacyAPIEvents}),function(l){return{keyboardInterface:new fr(window,l),defaultOutputRules:new Ur(l.contextManager)}})||this,i._initialized=0,i.hotkeyManager=new mr,i.getOskHeight=null,i.getOskWidth=null,i.helpURL="https://help.keyman.com/go",i.keyEventRefocus=function(){i.contextManager.restoreLastActiveTarget()},i._GetKeyboardDetail=function(l,s){var o={Name:l.KN,InternalName:l.KI,LanguageName:l.KL,LanguageCode:l.KLC,RegionName:l.KR,RegionCode:l.KRC,CountryName:l.KC,CountryCode:l.KCC,KeyboardID:l.KD,Font:l.KFont,OskFont:l.KOskFont,HasLoaded:!!s,IsRTL:s?s.isRTL:null};return o},i._util=new Vr(r),i.beepHandler=new Xr(i.core.keyboardInterface),i.core.keyboardProcessor.beepHandler=function(){return i.beepHandler.beep(i.contextManager.activeTarget)},i.hardKeyboard=new br(r.hardDevice,i.core.keyboardProcessor,i.contextManager),i.contextManager.on("targetchange",function(l){var s=l==null?void 0:l.getElement();i.osk&&(i.osk.activationModel.activationTrigger=s),i.config.hostDevice.touchable&&l&&i.ensureElementVisibility(s)}),i}return t.prototype.ensureElementVisibility=function(e){if(!(!e||!this.osk)){var n=K(e),i=window.pageYOffset,r=n-i;n>=i&&(r-=window.innerHeight-this.osk._Box.offsetHeight-e.offsetHeight-2,r<0&&(r=0)),r!=0&&window.scrollTo(0,r+i)}},Object.defineProperty(t.prototype,"util",{get:function(){return this._util},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"views",{get:function(){return ui},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"initialized",{get:function(){return this._initialized},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ui",{get:function(){return this._ui},set:function(e){this._ui&&this._ui.shutdown(),this._ui=e,this.config.deferForInitialization.isFulfilled&&e.initialize()},enumerable:!1,configurable:!0}),t.prototype.init=function(e){return(0,B.__awaiter)(this,void 0,void 0,function(){var n,i,r,l,s,o,a,g,d=this;return(0,B.__generator)(this,function(F){switch(F.label){case 0:return n=new Jt,i=n.detect(),r=(0,B.__assign)((0,B.__assign)({},ur),e),this.config.hostDevice=i,this.config.initialize(r),this._initialized=1,[4,Vt()];case 1:return F.sent(),this.config.deferForInitialization.isResolved?[2,Promise.resolve()]:[4,c.prototype.init.call(this,r)];case 2:return F.sent(),this.keyboardRequisitioner.cloudQueryEngine.once("unboundregister",function(){var u;!((u=d.contextManager.activeKeyboard)===null||u===void 0)&&u.keyboard||d.setActiveKeyboard("","")}),this.contextManager.initialize(),l=this.contextManager.getSavedKeyboardRaw(),this.pageIntegration=new xr(window,this),this.config.finalizeInit(),this.ui&&(this.ui.initialize(),this.legacyAPIEvents.callEvent("loaduserinterface",{})),this._initialized=2,[4,this.config.deferForInitialization];case 3:F.sent(),s=this.contextManager.restoreSavedKeyboard(l),F.label=4;case 4:return F.trys.push([4,6,,7]),[4,s];case 5:return F.sent(),[3,7];case 6:return o=F.sent(),[3,7];case 7:return a={keyboardToActivate:this.contextManager.activeKeyboard},g=i.touchable?new Bi(this,a):new Fi(this,a),pr(this,g,this.contextManager),this.osk=g,[2]}})})},Object.defineProperty(t.prototype,"register",{get:function(){return this.keyboardRequisitioner.cloudQueryEngine.registerFromCloud},enumerable:!1,configurable:!0}),t.prototype.getUIState=function(){return this.contextManager.focusAssistant.getUIState()},t.prototype.activatingUI=function(e){this.contextManager.focusAssistant.setMaintainingFocus(!!e)},t.prototype.setKeyboardForControl=function(e,n,i){if(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}if(!this.isAttached(e)){console.error("KeymanWeb is not attached to element "+e);return}var r=null;if(n&&(r=this.keyboardRequisitioner.cache.getStub(n,i),!r))throw new Error("No keyboard has been registered with id ".concat(n," and language code ").concat(i,"."));this.contextManager.setKeyboardForTarget(e._kmwAttachment.interface,n,i)},t.prototype.getKeyboardForControl=function(e){var n=Ce(e);return this.contextManager.getKeyboardStubForTarget(n).id},t.prototype.getLanguageForControl=function(e){var n=Ce(e);return this.contextManager.getKeyboardStubForTarget(n).langId},t.prototype.isAttached=function(e){return this.contextManager.page.isAttached(e)},t.prototype.addKeyboards=function(){for(var e=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return this.config.deferForInitialization.then(function(){if(!n||!n[0]||n[0].length==0)return e.keyboardRequisitioner.fetchCloudCatalog().catch(function(l){return console.error(l[0].error),l});var r=[];return Array.isArray(n[0])?r=r.concat(n[0]):Array.isArray(n)&&(r=r.concat(n)),e.keyboardRequisitioner.addKeyboardArray(r)})},t.prototype.addKeyboardsForLanguage=function(e){var n=this;return this.config.deferForInitialization.then(function(){return typeof e=="string"?n.keyboardRequisitioner.addLanguageKeyboards(e.split(",").map(function(i){return i.trim()})):n.keyboardRequisitioner.addLanguageKeyboards(e)})},t.prototype.isCJK=function(e){var n;if(e){var i=e;i.KeyboardID?n=this.keyboardRequisitioner.cache.getKeyboard(i.KeyboardID):n=new j(e)}else n=this.core.activeKeyboard;return n&&n.isCJK},t.prototype.getKeyboard=function(e,n){var i=this.keyboardRequisitioner.cache.getStub(e,n),r=this.keyboardRequisitioner.cache.getKeyboardForStub(i);return i&&this._GetKeyboardDetail(i,r)},t.prototype.getKeyboards=function(){for(var e=[],n=this.keyboardRequisitioner.cache,i=n.getStubList(),r=0;r<i.length;r++){var l=i[r],s=n.getKeyboardForStub(l),o=this._GetKeyboardDetail(l,s);e.push(o)}return e},t.prototype.removeKeyboards=function(){for(var e,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];for(var r=0;r<n.length;r++)this.keyboardRequisitioner.cache.forgetKeyboard(n[r],!0),((e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata.id)==q(n[r])&&this.contextManager.activateKeyboard("","");return!0},t.prototype.getSavedKeyboard=function(){return this.contextManager.getSavedKeyboard()},t.prototype.focusLastActiveElement=function(){var e;(e=this.contextManager.lastActiveTarget)===null||e===void 0||e.focus()},t.prototype.getLastActiveElement=function(){var e;return(e=this.contextManager.lastActiveTarget)===null||e===void 0?void 0:e.getElement()},t.prototype.setActiveElement=function(e,n){if(typeof e=="string"){var i=e;if(e=document.getElementById(e),!e)throw new Error("Could not find the specified element (id: ".concat(i))}var r=Ce(e);if(!r)throw new Error("KMW is not attached to the specified element (id: ".concat(e.id,")."));this.contextManager.setActiveTarget(r,n)},t.prototype.moveToElement=function(e){typeof e=="string"&&(e=document.getElementById(e)),e.focus()},t.prototype.addHotKey=function(e,n,i){this.hotkeyManager.addHotKey(e,n,i)},t.prototype.removeHotKey=function(e,n){this.hotkeyManager.removeHotkey(e,n)},t.prototype.attachToControl=function(e){this.contextManager.page.attachToControl(e)},t.prototype.detachFromControl=function(e){this.contextManager.page.detachFromControl(e)},t.prototype.disableControl=function(e){this.contextManager.page.disableControl(e)},t.prototype.enableControl=function(e){this.contextManager.page.enableControl(e)},t.prototype.BuildVisualKeyboard=function(e,n,i,r){var l=null;e!=null&&(l=this.keyboardRequisitioner.cache.getKeyboard(e)),l=l||this.core.activeKeyboard;var s=this.keyboardRequisitioner.cache.getStub(l),o=this.getOskHeight,a=(typeof o=="function"?o():null)||this.osk.computedHeight||200;return fe.buildDocumentationKeyboard(l,s,this.config.paths,i,r,a)},t.prototype.shutdown=function(){var e,n;this.pageIntegration.shutdown(),this.contextManager.shutdown(),(e=this.osk)===null||e===void 0||e.shutdown(),this.core.languageProcessor.shutdown(),this.hardKeyboard.shutdown(),this.util.shutdown(),this.legacyAPIEvents.callEvent("unloaduserinterface",{}),(n=this.ui)===null||n===void 0||n.shutdown()},t}(zn),vr=Fo;var Lr=document.getElementsByTagName("script"),Sr=Lr[Lr.length-1].src,uo=Sr.substr(0,Sr.lastIndexOf("/")+1);window.keyman=new vr(Yn.constructInstance(),uo);})();
//# sourceMappingURL=keymanweb.es5.js.map
