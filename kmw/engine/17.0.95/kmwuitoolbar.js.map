{"version":3,"file":"build/app/ui/release/kmwuitoolbar.js","lineCount":43,"mappings":"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","sources":["src/app/ui/kmwuitoolbar.ts"],"sourcesContent":["/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\n\r\n// If a UI module has been loaded, we can rely on the publically-published 'name' property\r\n// having been set as a way to short-out a UI reload.  Its parent object always exists by\r\n// this point in the build process.\r\nif(!window['keyman']['ui']['name']) {\r\n  /********************************/\r\n  /*                              */\r\n  /* Toolbar User Interface       */\r\n  /*                              */\r\n  /********************************/\r\n\r\n  /**\r\n   * Do not enclose in an anonymous function, as the compiler may create\r\n   * global scope variables to replace true, false, null, which can collide\r\n   * with other variables.\r\n   * Instead, use the --output-wrapper command during optimization, which will\r\n   * add the anonymous function to enclose all code, including those optimized\r\n   * variables which would otherwise have global scope.\r\n   **/\r\n\r\n  try {\r\n\r\n    // Declare KeymanWeb, OnScreen keyboard and Util objects\r\n    var keymanweb=window['keyman'],util=keymanweb['util'],dbg=keymanweb['debug'];\r\n\r\n    // Disable UI for touch devices\r\n    if(util['isTouchDevice']()) throw '';\r\n\r\n    // User interface local variables\r\n    keymanweb['ui'] = {\r\n      init: false,\r\n      toolbarNode: null,\r\n      backgroundNode: null,\r\n      browseMapNode: null,\r\n      keyboardsButtonNode: null,\r\n      languageButtonsNode: null,\r\n      offButtonNode: null,\r\n      offBarNode: null,\r\n      oskButtonNode: null,\r\n      oskBarNode: null,\r\n      selectorNode: null,\r\n      regionLanguageListNodes: [],\r\n      regionNodes: null,\r\n      langKeyboardNodes: [],\r\n      langKeyboardListNodes: [],\r\n      selectedRegion: 'as',\r\n      listedKeyboards: [],\r\n      catchAllRegion: 'un',\r\n      keyboardListPriority: 0,\r\n      maxListedKeyboards: 1,\r\n      lastActiveControl: null,\r\n      selectedKeyboard: null,\r\n      selectedLanguage: '',\r\n      helpOffsetX: 0,\r\n      helpOffsetY: 0,\r\n      languages: [],      // array of objects { id: <langid>, name: <name>, keyboards: <array of KeymanWeb keyboards> }\r\n      updateMap: false,   // flag to control re-initialization of keyboard map\r\n      startTimer: 0,      // initialization timer - wait 2 seconds after last stub installed then initialize map\r\n      lgText: ''          // language name in toolbar\r\n    }\r\n\r\n    // User Interface object\r\n    var ui=keymanweb['ui'];\r\n    ui['name'] = 'toolbar';\r\n\r\n    ui.ToolBar_Text = {\r\n      Keyboards: 'Languages',\r\n      OffTitle: 'Turn off KeymanWeb keyboards',\r\n      Off: 'Off',\r\n      ShowOSK: 'Show On Screen Keyboard',\r\n      LanguageSelector: 'Select language'\r\n      };\r\n\r\n    ui.ToolBar_Text['SelectKeyboardPre']='Select ';\r\n    ui.ToolBar_Text['SelectKeyboardSuf']='keyboard';\r\n    ui.ToolBar_Text['AltKeyboardsPre']='Alternate keyboards for ';\r\n    ui.ToolBar_Text['AltKeyboardsSuf']='';\r\n\r\n    ui.ToolBar_Text['ca']='Central America';\r\n    ui.ToolBar_Text['sa']='South America';\r\n    ui.ToolBar_Text['na']='Americas';\r\n    ui.ToolBar_Text['eu']='Europe';\r\n    ui.ToolBar_Text['af']='Africa';\r\n    ui.ToolBar_Text['un']='Undetermined';\r\n    ui.ToolBar_Text['as']='Asia';\r\n    ui.ToolBar_Text['oc']='Oceania';\r\n\r\n\r\n    var controller=document.getElementById('KeymanWebControl');\r\n  /**\r\n     * Create some of the controls but don't insert them into the document yet\r\n     * This does not need or want to prevent loss of focus, so uses document.createElement\r\n     * rather than util.createElement.\r\n     *\r\n     * @param       {string}  tag\r\n     * @param       {?string=}  id\r\n     * @param       {?string=}  className\r\n     * @param       {string=}  innerHTML\r\n     * @return      {Node|null}\r\n     */\r\n    ui.createNode = function(tag, id, className, innerHTML)\r\n    {\r\n      //var node = util['createElement'](tag);\r\n      var node = document.createElement(tag);\r\n      if(id) node.id = id;\r\n      if(className) node.className = className;\r\n      if(innerHTML) node.innerHTML = innerHTML;\r\n\r\n      // The following is OK for IE and for F3.5 and later - should simply be ignored for others\r\n      // first tried preventDefault() as suggested by many on web, which worked but interfered with keyboard and OSK enabling\r\n      if(tag == 'a' || tag == 'area' || tag == 'map') node.ondragstart = function(){return false;}\r\n      return node;\r\n    }\r\n\r\n    /**\r\n     * Initialize toolbar UI\r\n     */\r\n    ui['initialize'] = ui.initToolbarUI = function()\r\n    {\r\n      if(!keymanweb['initialized'] || ui.init) return;\r\n\r\n      // Find the controller DIV, insert at top of body if undefined\r\n      var e = document.getElementById('KeymanWebControl');\r\n      if(!e)\r\n      {\r\n        if(document.body == null)\r\n          return;\r\n        else\r\n        {\r\n          e=document.createElement('DIV');\r\n          e.id='KeymanWebControl';\r\n          document.body.insertBefore(e,document.body.firstChild);\r\n          ui._insertedElem = e;\r\n        }\r\n      }\r\n\r\n      // Hide toolbar until elements fully drawn, to prevent spurious text displays\r\n      e.style.visibility='hidden'; e.style.maxHeight='35px';\r\n\r\n      ui.init = true;\r\n\r\n      if(util['isTouchDevice']()) return;\r\n\r\n      util['linkStyleSheet'](util['getOption']('resources')+'ui/toolbar/kmwuitoolbar.css');\r\n\r\n      ui.regions = {};\r\n      //ui.regions['ca'] = {t: ui.ToolBar_Text['ca'], m: '49,52,65,54,68,57,71,56,73,59,75,60,93,61,94,58,97,58,101,59,107,60,114,64,115,68,114,77,104,74,98,75,96,78,95,82,90,81,85,80,82,76,78,74,74,73,65,68,57,61' },\r\n      //ui.regions['sa'] = {t: ui.ToolBar_Text['sa'], m: '82,82,95,82,96,78,98,75,104,74,114,77,120,79,124,83,126,87,141,90,142,97,138,103,135,113,127,116,123,124,115,131,112,132,109,138,117,139,140,141,141,146,134,148,114,145,109,148,100,148,91,143,91,130,96,111,89,102,83,95,77,89' },\r\n      ui.regions['na'] = {t: ui.ToolBar_Text['na'], m: '0,3,0,37,24,32,35,37,43,47,49,52,65,54,68,57,71,56,73,59,75,60,93,61,93,57,103,49,118,41,126,41,136,23,148,17,156,14,164,5,164,0,57,0,35,5,25,9,5,8,49,52,65,54,68,57,71,56,73,59,75,60,93,61,94,58,97,58,101,59,107,60,114,64,115,68,114,77,104,74,98,75,96,78,95,82,90,81,85,80,82,76,78,74,74,73,65,68,57,61,82,82,95,82,96,78,98,75,104,74,114,77,120,79,124,83,126,87,141,90,142,97,138,103,135,113,127,116,123,124,115,131,112,132,109,138,117,139,140,141,141,146,134,148,114,145,109,148,100,148,91,143,91,130,96,111,89,102,83,95,77,89' },\r\n      ui.regions['eu'] = {t: ui.ToolBar_Text['eu'], m: '145,29,146,19,158,14,171,6,187,2,206,1,217,4,227,11,231,16,231,33,227,34,225,35,225,37,227,39,228,44,228,47,227,48,223,46,218,44,215,43,208,43,203,45,202,48,205,52,201,52,195,49,189,50,187,48,177,48,175,49,166,50,147,33' },\r\n      ui.regions['af'] = {t: ui.ToolBar_Text['af'], m: '150,58,158,50,166,50,175,49,177,48,187,48,189,50,195,49,201,52,205,52,207,53,221,75,229,75,231,77,231,85,227,92,232,101,237,106,237,112,227,115,222,118,206,125,199,127,193,127,185,111,183,104,180,87,168,89,153,85,143,71,147,60' },\r\n      ui.regions['as'] = {t: ui.ToolBar_Text['as'], m: '219,1,221,6,228,12,231,16,231,33,227,34,225,35,225,37,227,39,229,45,232,48,239,48,240,49,239,53,242,60,243,65,249,70,252,81,259,87,271,87,278,95,289,100,303,101,311,98,320,98,323,98,323,84,311,81,308,73,307,65,317,57,330,50,334,44,348,36,364,38,375,34,375,8,355,8,336,5,292,1,285,0,219,0' },\r\n      ui.regions['oc'] = {t: ui.ToolBar_Text['oc'], m: '288,117,289,107,303,101,311,98,323,98,323,84,333,77,344,73,362,80,369,88,375,96,375,141,352,143,323,142,316,136,310,130,291,130' }\r\n      ui.regions['un'] = {t: ui.ToolBar_Text['un'], m: '205,52,202,48,203,45,208,43,215,43,218,44,223,46,227,48,232,48,239,48,240,49,239,53,242,60,243,65,237,76,231,77,229,75,221,75,207,53' },\r\n\r\n      ui.toolbarNode = ui.createNode('div', 'kmw_controls');\r\n      ui.toolbarNode.style.display='block';\r\n\r\n      var tbNode = ui.createNode('a', 'kmw_controls_start', null, ' ');\r\n      tbNode.href = \"https://keyman.com/developer/keymanweb/\";\r\n      tbNode.target=\"_blank\";\r\n      ui.toolbarNode.appendChild(tbNode);\r\n\r\n      /* Keyboards button */\r\n      ui.keyboardsButtonNode = ui.createNode('div','kmw_btn_keyboards','kmw_button');\r\n      ui.keyboardsButtonNode.title=ui.ToolBar_Text.LanguageSelector;\r\n      var aNode = ui.createNode('a', null, 'kmw_button_a');\r\n      aNode.href='#';\r\n      aNode.onclick = ui.showKeyboardsPopup;\r\n      aNode.appendChild(ui.createNode('div', 'kmw_img_keyboards', 'kmw_img'));\r\n      aNode.appendChild(ui.createNode('div', null, 'kmw_a', ui.ToolBar_Text.Keyboards));\r\n      aNode.appendChild(ui.createNode('div', null, 'kmw_drop'));\r\n      ui.keyboardsButtonNode.appendChild(aNode);\r\n\r\n      /* Keyboards popup */\r\n      ui.selectorNode = ui.createNode('div', 'kmw_selector');\r\n      ui.regionsNode = ui.createNode('div', 'kmw_selector_regions');\r\n      var imgNode;\r\n      ui.browseMapNode = ui.createNode('div', 'kmw_browsemap');\r\n      imgNode = ui.createNode('img', 'kmw_region_browsemap');\r\n      imgNode.src= util['getOption']('resources')+'ui/toolbar/blank.gif';\r\n      imgNode.useMap = '#kmw_worldgrey16';\r\n      ui.browseMapNode.appendChild(imgNode);\r\n\r\n      var areaNode, mapNode = ui.createNode('map', 'kmw_worldgrey16');\r\n      mapNode.name='kmw_worldgrey16';\r\n      for(var i in ui.regions)\r\n      {\r\n        areaNode = ui.createNode('area');\r\n        areaNode.shape = 'poly';\r\n        areaNode.alt = '';\r\n        areaNode.href = '#';\r\n        areaNode.title = ui.regions[i].t;\r\n        areaNode.hidefocus = 'true';\r\n        areaNode.onclick = (function(i) { return function(event) { return ui.selectRegion(event, i); } })(i);\r\n        areaNode.onmouseover = (function(i) { return function(event) { return ui.hoverRegion(event, i); } })(i);\r\n        areaNode.onmouseout = (function(i) { return function(event) { return ui.unhoverRegion(event, i); } })(i);\r\n        areaNode.coords = ui.regions[i].m;\r\n        mapNode.appendChild(areaNode);\r\n      }\r\n\r\n      areaNode = ui.createNode('area');\r\n      areaNode.shape = 'default';\r\n      areaNode.nohref = 'true';\r\n      areaNode.alt = '';\r\n      areaNode.onclick=ui.eventCapture;   // do not close map when clicking on ocean!\r\n      mapNode.appendChild(areaNode);\r\n      ui.browseMapNode.appendChild(mapNode);\r\n      ui.regionsNode.appendChild(ui.browseMapNode);\r\n      ui.regionNodes = {};\r\n\r\n      var listNode = ui.createNode('ul');\r\n      for(i in ui.regions)\r\n      {\r\n        var itemNode = ui.createNode('li');\r\n        ui.regionNodes[i] = ui.createNode('a', null, null, ui.regions[i].t);\r\n        ui.regionNodes[i].href='#';\r\n        ui.regionNodes[i].onclick = (function(i) { return function(event) { return ui.selectRegion(event, i); } })(i);\r\n        ui.regionNodes[i].onmouseover = (function(i) { return function(event) { return ui.hoverRegion(event, i); } })(i);\r\n        ui.regionNodes[i].onmouseout = (function(i) { return function(event) { return ui.unhoverRegion(event, i); } })(i);\r\n        itemNode.appendChild(ui.regionNodes[i]);\r\n        listNode.appendChild(itemNode);\r\n      }\r\n      ui.regionsNode.appendChild(listNode);\r\n      ui.selectorNode.appendChild(ui.regionsNode);\r\n      ui.keyboardsButtonNode.appendChild(ui.selectorNode);\r\n      ui.toolbarNode.appendChild(ui.keyboardsButtonNode);\r\n\r\n      // Separator and Keyboard Off Button\r\n      ui.toolbarNode.appendChild(ui.offBarNode = ui.createNode('div', 'kmw_bar_off', 'kmw_bar'));\r\n\r\n      ui.offButtonNode = ui.createNode('div', 'kmw_btn_off', 'kmw_button_selected');\r\n      aNode = ui.createNode('a', null, 'kmw_button_a');\r\n      aNode.href = '#';\r\n      aNode.onclick = ui.offButtonClickEvent;\r\n      aNode.title = ui.ToolBar_Text.OffTitle;\r\n      aNode.appendChild(ui.createNode('div', 'kmw_img_off', 'kmw_img'));\r\n      aNode.appendChild(ui.createNode('div', null, 'kmw_a', ui.ToolBar_Text.Off));\r\n      ui.offButtonNode.appendChild(aNode);\r\n      ui.toolbarNode.appendChild(ui.offButtonNode);\r\n\r\n      // Keyboard buttons\r\n      ui.toolbarNode.appendChild(ui.languageButtonsNode = ui.createNode('div', 'kmw_control_keyboards', 'kmw_button'));\r\n\r\n      // Separator and On Screen Keyboard Button\r\n      ui.toolbarNode.appendChild(ui.oskBarNode = ui.createNode('div', 'kmw_bar_osk', 'kmw_bar'));\r\n\r\n      ui.oskButtonNode = ui.createNode('div', 'kmw_btn_osk', 'kmw_button');//was 'kmw_button_selected'\r\n      aNode = ui.createNode('a', null, 'kmw_button_a');\r\n      aNode.href = '#';\r\n      aNode.onclick = ui.showOSK;\r\n      aNode.onmousedown = function() {\r\n        keymanweb['activatingUI'](true);\r\n      };\r\n      aNode.title = ui.ToolBar_Text.ShowOSK;\r\n      aNode.appendChild(ui.createNode('div', 'kmw_img_osk', 'kmw_img'));\r\n      //aNode.appendChild(ui.createNode('div', null, 'kmw_a', 'On Screen Keyboard'));\r\n      ui.oskButtonNode.appendChild(aNode);\r\n      ui.toolbarNode.appendChild(ui.oskButtonNode);\r\n\r\n      ui.toolbarNode.appendChild(ui.createNode('div', 'kmw_controls_end', null, ' '));\r\n\r\n      var img = ui.createNode('div');\r\n      img.id = 'kmw_map_preload';\r\n      ui.toolbarNode.appendChild(img);\r\n\r\n      ui.toolbarNode.appendChild(ui.createNode('br', null, 'kmw_clear'));\r\n\r\n      // Append toolbar node to controller\r\n      e.appendChild(ui.toolbarNode);\r\n\r\n      // Initialize map array, using a timer to allow restarting if necessary after keyboards loaded\r\n      // Note that toolbar will be displayed and enabled on completion of timeout routine\r\n      ui.updateMap = true;\r\n      if(ui.startTimer) clearTimeout(ui.startTimer);\r\n      ui.startTimer = setTimeout(ui.addKeyboardsToMap,0);\r\n\r\n      // Ensure that popups are hidden by clicking elsewhere on document\r\n      util['attachDOMEvent'](document.body,'click',ui.hideAllPopups,false);\r\n\r\n      // Set Europe to be the default region\r\n      ui.selectedRegion = 'eu';\r\n\r\n      ui.registerEvents();\r\n\r\n      // Restore focus\r\n      keymanweb['focusLastActiveElement']();\r\n    }\r\n\r\n    ui.shutdown = function() {\r\n      var root = ui.toolbarNode;\r\n      if(root) {\r\n        root.parentNode.removeChild(root);\r\n      }\r\n\r\n      root = ui._insertedElem;\r\n      if(root) {\r\n        root.parentNode.removeChild(root);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Fill the map with available keyboards when the Keyboards selector is clicked\r\n     *    after all keyboard stubs have been registered\r\n    **/\r\n    ui.addKeyboardsToMap = function()\r\n    {\r\n      // Do nothing unless a keyboard has been installed since map created\r\n      if(ui.updateMap) ui.updateMap=false; else return;\r\n\r\n      var n = 0;\r\n      ui.regionLanguageListNodes = {};\r\n\r\n      // Build list of keyboards by region and language\r\n      var Keyboards = keymanweb['getKeyboards']();\r\n\r\n      // Sort the keyboards by region and language\r\n      Keyboards.sort(ui.sortKeyboards);\r\n\r\n      // Always rebuild the map, so remove any previously created language lists\r\n      for(n=ui.regionsNode.childNodes.length; n>0; n--)\r\n      {\r\n        if(ui.regionsNode.childNodes[n-1].className == 'kmw_selector_region')\r\n        {\r\n          ui.regionsNode.removeChild(ui.regionsNode.childNodes[n-1]);\r\n        }\r\n      }\r\n\r\n      for(var i in ui.regions)\r\n      {\r\n\r\n        ui.regionLanguageListNodes[i] = ui.createNode('div', null, 'kmw_selector_region');\r\n        var colNode = ui.createNode('div', null, 'kmw_keyboard_col');\r\n        var max = 0, count = 0, languageCode = '';\r\n\r\n        // Get number of languages for the region\r\n        for(var j=0; j<Keyboards.length; j++) {\r\n          // REVERT:  ensures that keyboards without visible map region get displayed SOMEWHERE.\r\n          var kbdRegion = Keyboards[j]['RegionCode'];\r\n          if(!ui.regions[kbdRegion]) {\r\n            // For now, we'll display them within the 'middle-east' region.\r\n            if(i != ui.catchAllRegion) {\r\n              continue;\r\n            }\r\n          } else if(kbdRegion != i) {\r\n            continue; // Not this region\r\n          }\r\n\r\n          // Get JUST the language code for this section.  BCP-47 codes can include more!\r\n          var bcpSubtags: string[] = keymanweb['util']['getLanguageCodes'](Keyboards[j]['LanguageCode']);\r\n          if(bcpSubtags[0] == languageCode) continue; // Same language as previous keyboard\r\n          languageCode = bcpSubtags[0];\r\n\r\n          max++;\r\n        }\r\n        max = Number(((max+3)/4).toFixed(0));   // Get number of entries per column\r\n\r\n        // Add language list to columns for the region\r\n        languageCode='';\r\n        for(var j=0; j<Keyboards.length; j++) {\r\n          // REVERT:  ensures that keyboards without visible map region get displayed SOMEWHERE.\r\n          var kbdRegion = Keyboards[j]['RegionCode'];\r\n          if(!ui.regions[kbdRegion]) {\r\n            // For now, we'll display them within the 'middle-east' region.\r\n            if(i != ui.catchAllRegion) {\r\n              continue;\r\n            }\r\n          } else if(kbdRegion != i) {\r\n            continue; // Not this region\r\n          }\r\n\r\n          var bcpSubtags: string[] = keymanweb['util']['getLanguageCodes'](Keyboards[j]['LanguageCode']);\r\n          if(bcpSubtags[0] == languageCode) {  // Same language as previous keyboard, so add it to that entry\r\n            var x = ui.languages[languageCode].keyboards;\r\n\r\n            // While we could avoid duplicating keyboard entries that occur for multiple regions, we'll instead\r\n            // allow them to display while distinguishing them more directly.  (That part is handled later.)\r\n            if(x.push) {\r\n              x.push(Keyboards[j]);\r\n            } else {\r\n              ui.languages[languageCode].keyboards = x.concat(Keyboards[j]);\r\n            }\r\n\r\n            continue;\r\n          }\r\n\r\n          // Add a new language entry\r\n          languageCode = bcpSubtags[0];\r\n          ui.languages[languageCode] = { id: Keyboards[j]['LanguageCode'], name: Keyboards[j]['LanguageName'], keyboards: [Keyboards[j]] };\r\n\r\n          // Start a new column if necessary\r\n          if(count % max == 0 && count > 0)\r\n          {\r\n            ui.regionLanguageListNodes[i].appendChild(colNode);\r\n            colNode = ui.createNode('div', null, count/max == 3 ? 'kmw_keyboard_col_right' : 'kmw_keyboard_col');\r\n          }\r\n          count++;\r\n\r\n          // Add the language to the column\r\n          var langNode = ui.createNode('div', null, 'kmw_language');\r\n          var aNode = ui.createNode('a', null, null, Keyboards[j]['LanguageName']);\r\n          aNode.href='#';\r\n          aNode.onclick = (function(lang) { return function(event) { return ui.selectLanguage(event, lang); }; })(ui.languages[languageCode]);\r\n          langNode.appendChild(aNode);\r\n          colNode.appendChild(langNode);\r\n\r\n          n++;\r\n        }\r\n        // Finish the last column and close the list\r\n        ui.regionLanguageListNodes[i].appendChild(colNode);\r\n        ui.regionLanguageListNodes[i].appendChild(ui.createNode('div', null, 'kmw_clear'));\r\n        ui.regionsNode.appendChild(ui.regionLanguageListNodes[i]);\r\n      }\r\n      ui.loadCookie();\r\n\r\n      // Ensure that the correct region has been selected\r\n      ui.selectRegion(null, ui.selectedRegion);\r\n      ui.enableControls();\r\n\r\n      // When a keyboard is activated before init is complete,\r\n      // the toolbar needs to refresh the loaded keyboard\r\n      if(ui.lastSelectedKeyboard) {\r\n        ui.changeKeyboardEvent(ui.lastSelectedKeyboard);\r\n      }\r\n\r\n      // Restore focus\r\n      keymanweb['focusLastActiveElement']();\r\n    }\r\n\r\n    /**\r\n     * Sort keyboards array returned from keymanweb by region and language\r\n     *\r\n     * @param       {Object}  a\r\n     * @param       {Object}  b\r\n     * @return      {number}\r\n     **/\r\n    ui.sortKeyboards = function(a,b)\r\n    {\r\n      if(a['RegionCode'] < b['RegionCode']) return -2;\r\n      if(a['RegionCode'] > b['RegionCode']) return 2;\r\n      if(a['LanguageName'] < b['LanguageName']) return -1;\r\n      if(a['LanguageName'] > b['LanguageName']) return 1;\r\n      return 0;\r\n    }\r\n\r\n    /* KeymanWeb Interfaces */\r\n\r\n    /**\r\n     * Function     findListedKeyboard\r\n     * Scope        Private\r\n     * @param       {Object}  lang\r\n     * @return      {?number}\r\n     * Description  Test if a keyboard is still shown on the toolbar.  Returns index of keyboard in listedKeyboards or null if not found\r\n     */\r\n    ui.findListedKeyboard = function(lang)\r\n    {\r\n      for(var i = 0; i < ui.listedKeyboards.length; i++)\r\n        if(ui.listedKeyboards[i].lang.id == lang.id) return i;\r\n      return null;\r\n    }\r\n\r\n    /**\r\n     * Add a keyboard to the list of keyboards available for a language\r\n     *\r\n     * @param       {Object}  lang\r\n     * @param       {Object}  kbd\r\n     **/\r\n    ui.addKeyboardToList = function(lang,kbd)\r\n    {\r\n      var found = ui.findListedKeyboard(lang);\r\n      if(found == null)\r\n      {\r\n        // Add the button\r\n        if(ui.listedKeyboards.length >= ui.maxListedKeyboards)\r\n        {\r\n          var oldestPriority = 0x7fffffff, oldestFound = null;\r\n\r\n          for(var i = 0; i < ui.listedKeyboards.length; i++)\r\n            if(ui.listedKeyboards[i].priority < oldestPriority)\r\n            {\r\n              oldestFound = i;\r\n              oldestPriority = ui.listedKeyboards[i].priority;\r\n            }\r\n\r\n          // delete the oldest used control\r\n          if(oldestFound != null)\r\n          {\r\n            var rk = ui.listedKeyboards[oldestFound];\r\n            ui.langKeyboardListNodes[rk.lang.id] = null;\r\n            ui.langKeyboardNodes[rk.lang.id] = null;\r\n            ui.languageButtonsNode.removeChild(rk.buttonNode);\r\n            if(oldestFound == 0)\r\n              ui.listedKeyboards = ui.listedKeyboards.slice(oldestFound + 1);\r\n            else if(oldestFound == ui.listedKeyboards.length - 1)\r\n              ui.listedKeyboards = ui.listedKeyboards.slice(0, oldestFound);\r\n            else\r\n              ui.listedKeyboards = ui.listedKeyboards.slice(0, oldestFound).concat(ui.listedKeyboards.slice(oldestFound+1));\r\n          }\r\n        }\r\n        var buttonNode = ui.createNode('div', null/*'kmw_button_keyboard_'+lang.id*/, 'kmw_button');\r\n        var aNode = ui.createNode('a', null, 'kmw_button_a'+(lang.keyboards.length>1 ? ' kmw_norightgap' : ''));\r\n        aNode.href='#';\r\n\r\n        var p1=ui.ToolBar_Text['SelectKeyboardPre']+kbd['Name'],p2=ui.ToolBar_Text['SelectKeyboardSuf'];\r\n        if(p1.toLowerCase().indexOf(p2.toLowerCase()) < 0) p1=p1+' '+ p2;\r\n        aNode.title = p1;\r\n        aNode.onclick = function(event) { return ui.selectLanguage(event, lang) };\r\n        aNode.appendChild(ui.createNode('div', 'kmw_img_kbd', 'kmw_img'));\r\n\r\n        ui.lgText=ui.truncate(lang.name,28);\r\n        aNode.appendChild(ui.createNode('div', null, 'kmw_a', ui.lgText));\r\n        buttonNode.appendChild(aNode);\r\n\r\n        var thisANode = aNode;\r\n\r\n        if(lang.keyboards.length > 1) {\r\n          aNode = ui.createNode('a', null, 'kmw_button_a kmw_noleftgap');\r\n          aNode.href = '#';\r\n          aNode.title = ui.ToolBar_Text['AltKeyboardsPre']+lang.name+ui.ToolBar_Text['AltKeyboardsSuf'];\r\n          aNode.onclick = function(event) { return ui.showKeyboardsForLanguage(event, lang) };\r\n          var divNode = ui.createNode('div', null, 'kmw_a');\r\n          var kbdText=ui.truncate(kbd['Name'].replace(/\\s?keyboard/i,''),40-ui.lgText.length);\r\n          divNode.appendChild(ui.langKeyboardNodes[lang.id] = ui.createNode('span', null, 'kmw_kbd', kbdText));\r\n          aNode.appendChild(divNode);\r\n          aNode.appendChild(ui.createNode('div', null, 'kmw_drop'));\r\n          buttonNode.appendChild(aNode);\r\n\r\n          ui.langKeyboardListNodes[lang.id] = ui.createNode('ul', null, 'kmw_selector_kbd');\r\n          ui.langKeyboardListNodes[lang.id].style.display='none';\r\n\r\n          for(var n in lang.keyboards) {\r\n            var itemNode = ui.createNode('li');\r\n            kbdText = lang.keyboards[n]['Name'].replace(/\\s?keyboard/i,'');\r\n            // We append the full BCP-47 code here for disambiguation when regional and/or script variants exist.\r\n            kbdText = kbdText + \" [\" + lang.keyboards[n]['LanguageCode'] + \"]\";\r\n            aNode = ui.createNode('a', null, null, kbdText);\r\n            aNode.href = '#';\r\n            aNode.title = '';\r\n            aNode.onclick = (function(lang,kbd) { return function(event) { return ui.selectKeyboard(event, lang, kbd, true); } })(lang, lang.keyboards[n]);\r\n\r\n            itemNode.appendChild(aNode);\r\n            ui.langKeyboardListNodes[lang.id].appendChild(itemNode);\r\n          }\r\n          buttonNode.appendChild(ui.langKeyboardListNodes[lang.id]);\r\n        }\r\n\r\n        ui.languageButtonsNode.appendChild(buttonNode);\r\n\r\n        var thisLang = lang, thisButtonNode = buttonNode;\r\n        ui.listedKeyboards.push({priority: ui.keyboardListPriority++, lang:thisLang, keyboard:kbd, buttonNode:thisButtonNode, aNode:thisANode});\r\n      }\r\n      else\r\n      {\r\n        ui.listedKeyboards[found].priority = ui.keyboardListPriority++;\r\n        ui.listedKeyboards[found].keyboard = kbd;\r\n        var e = ui.langKeyboardNodes[lang.id];\r\n        if(e)\r\n        {\r\n          var kbdText=kbd['Name'].replace(/\\s?keyboard/i,'');\r\n          e.innerHTML = ui.truncate(kbdText,40-ui.lgText.length);\r\n        }\r\n        if(ui.listedKeyboards[found].aNode)\r\n        {\r\n          var p1=ui.ToolBar_Text['SelectKeyboardPre']+kbd['Name'],p2=ui.ToolBar_Text['SelectKeyboardSuf'];\r\n          if(p1.toLowerCase().indexOf(p2.toLowerCase()) < 0) p1=p1+' '+ p2;\r\n          ui.listedKeyboards[found].aNode.title = p1;\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     *  Truncate a long name and add an ellipsis\r\n     *\r\n     *  @param  {string}  PName   string that may need to be truncated\r\n     *  @param  {number}  PLen    max non-truncated length\r\n     *  @return {string}          string, truncated with ellipsis if necessary\r\n     *\r\n     **/\r\n    ui.truncate = function(PName,PLen)\r\n    {\r\n      if(PName.length <=PLen) return PName;\r\n      return PName.substr(0,PLen-1)+'\\u2026';\r\n    }\r\n\r\n    /**\r\n     * Rebuild the entire keyboard list whenever a keyboard is installed\r\n     * (without necessarily loading the keyboard)\r\n     *\r\n     * @param       {Object}  p Keyboard metadata object\r\n     **/\r\n    ui.registerKeyboard = function(p)\r\n    {\r\n      ui.updateMap = true;\r\n      if(ui.startTimer) clearTimeout(ui.startTimer);\r\n      ui.startTimer = setTimeout(ui.addKeyboardsToMap,0);\r\n    }\r\n    keymanweb['addEventListener']('keyboardregistered',ui.registerKeyboard);\r\n\r\n    var keyboardsForLangPopup = null;\r\n\r\n    /**\r\n     * Function     hideKeyboardsForLanguage\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @return      {boolean}\r\n     * Description  Hide the list of keyboards for this language\r\n     **/\r\n    ui.hideKeyboardsForLanguage = function(event)\r\n    {\r\n      var e = ui.keyboardsForLangPopup;\r\n      if(e) e.style.display='none';\r\n      ui.CancelPopupDismissal(ui.hideKeyboardsForLanguage);\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Display the list of keyboards for this language\r\n     *\r\n     * @param       {Object}  event\r\n     * @param       {Object}  lang\r\n     * @return      {boolean}\r\n     *\r\n     **/\r\n    ui.showKeyboardsForLanguage = function(event, lang)\r\n    {\r\n      ui.hideKeyboardsPopup(event);\r\n      var e = ui.langKeyboardListNodes[lang.id];\r\n      if(e)\r\n      {\r\n        if(e.style.display=='block') return ui.hideKeyboardsForLanguage(event);\r\n        e.style.display='block';\r\n        ui.keyboardsForLangPopup = e;\r\n        ui.SetupPopupDismissal(e, ui.hideKeyboardsForLanguage);\r\n      }\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Select the language, and either select the keyboard (if unique) or display the list of keyboards\r\n     * available for this language\r\n     *\r\n     * @param       {Object}  event\r\n     * @param       {Object}  lang\r\n     * @return      {boolean}\r\n     **/\r\n    ui.selectLanguage = function(event, lang)\r\n    {\r\n      var found=ui.findListedKeyboard(lang), kbd = null;\r\n\r\n      if(found == null)\r\n        kbd = lang.keyboards[0];\r\n      else\r\n        kbd = ui.listedKeyboards[found].keyboard;\r\n      if(!kbd) return false;\r\n\r\n      return ui.selectKeyboard(event,lang,kbd,true);\r\n    }\r\n\r\n    /**\r\n     * Enable a selected keyboard\r\n     *\r\n     * @param       {Object}  event\r\n     * @param       {Object}  lang\r\n     * @param       {Object}  kbd\r\n     * @param       {boolean} updateKeyman\r\n     * @return      {boolean}\r\n     **/\r\n    ui.selectKeyboard = function(event,lang,kbd,updateKeyman:boolean) {\r\n      keymanweb['activatingUI'](true);\r\n      if(ui.selectedLanguage) {\r\n        var found = ui.findListedKeyboard(ui.selectedLanguage);\r\n        if(found != null) {\r\n          ui.listedKeyboards[found].buttonNode.className = 'kmw_button';\r\n        }\r\n      }\r\n\r\n      ui.offButtonNode.className = 'kmw_button';\r\n      ui.selectedLanguage = lang;\r\n      ui.selectedKeyboard = kbd;\r\n\r\n      // In 12.0, this UI class has only been partially converted to BCP-47.\r\n      // `lang.id` refers to the base language identifier and will NOT include\r\n      // any subtags.  We want the FULL language identifier here, with subtags.\r\n      ui.SelectedLanguage = kbd.LanguageCode;\r\n\r\n      // Return focus to input area and activate the selected keyboard\r\n      ui.setLastFocus(); //*****this seems out of sequence???\r\n      ui.addKeyboardToList(lang, kbd);\r\n      if(updateKeyman) {\r\n        keymanweb['setActiveKeyboard'](kbd['InternalName'], kbd['LanguageCode']);\r\n      }\r\n      ui.listedKeyboards[ui.findListedKeyboard(lang)].buttonNode.className = 'kmw_button_selected';\r\n\r\n      // Always save current state when selecting a keyboard\r\n      ui.saveCookie();\r\n      ui.enableControls();\r\n      keymanweb['activatingUI'](false);\r\n      return ui.hideKeyboardsPopup(event) || ui.hideKeyboardsForLanguage(event);\r\n    }\r\n\r\n    /**\r\n     * Enable all UI controls\r\n     *\r\n     * @return      {boolean}\r\n     **/\r\n    ui.enableControls = function()\r\n    {\r\n      var elems=[ui.offButtonNode, ui.offBarNode, ui.oskButtonNode, ui.oskBarNode],hideOskButton=false;\r\n\r\n      if(keymanweb['isCJK'](ui.selectedKeyboard)) hideOskButton = true;\r\n      else if(ui.selectedKeyboard == null) hideOskButton = (elems[2].style.display == 'none')\r\n\r\n      if(ui.selectedKeyboard != null || ui.listedKeyboards.length > 0)\r\n      {\r\n        for(var i = 0; i < elems.length; i++)\r\n          elems[i].style.display='';\r\n      }\r\n      else\r\n      {\r\n        for(var i = 0; i < elems.length; i++)\r\n          elems[i].style.display='none';\r\n      }\r\n\r\n      if(hideOskButton)\r\n        ui.oskButtonNode.style.display = ui.oskBarNode.style.display = 'none';\r\n\r\n      else if(ui.selectedKeyboard == null)\r\n        ui.oskButtonNode.className='kmw_button_disabled';\r\n      //else\r\n      //  ui.oskButtonNode.className=(osk && osk['isEnabled']() ? 'kmw_button_selected' : 'kmw_button');\r\n\r\n      // Display the toolbar if still hidden\r\n      ui.toolbarNode.parentNode.style.visibility='visible';\r\n      return true;\r\n    }\r\n\r\n    /**\r\n     * Restore the focus to the last focused element\r\n     **/\r\n    ui.setLastFocus = function()\r\n    {\r\n      keymanweb['focusLastActiveElement']();\r\n    }\r\n\r\n    /**\r\n     * Display or hide the OSK according to user control. This will always force\r\n     * the focus to the last active element if currently unfocused, which is\r\n     * preferable to not having the OSK appear when the OSK button is clicked.\r\n     *\r\n     * @param       {Object}  event\r\n     * @return      {boolean}\r\n     **/\r\n    ui.showOSK = function(event)\r\n    {\r\n      let osk = keymanweb['osk'];\r\n      if(!osk) {\r\n        return;\r\n      }\r\n      keymanweb['activatingUI'](true);\r\n      //Toggle OSK on or off\r\n      if(osk && keymanweb['getActiveKeyboard']() != '')\r\n      {\r\n        if(osk['isEnabled']()) osk['hide'](); else osk['show'](true);\r\n      }\r\n      ui.setLastFocus();\r\n      keymanweb['activatingUI'](false);\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Function     offButtonClickEvent\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @return      {boolean}\r\n     * Description  Update the UI when all keyboards disabled by user\r\n     **/\r\n    ui.offButtonClickEvent = function(event)\r\n    {\r\n      if(ui.toolbarNode.className != 'kmw_controls_disabled')\r\n      {\r\n        ui.hideKeyboardsForLanguage(null);\r\n        if(ui.selectedLanguage)\r\n        {\r\n          var found = ui.findListedKeyboard(ui.selectedLanguage);\r\n          if(found != null) ui.listedKeyboards[found].buttonNode.className = 'kmw_button';\r\n        }\r\n        ui.selectedKeyboard = null;\r\n        ui.selectedLanguage = null;\r\n        ui.SelectedLanguage = '';\r\n        ui.offButtonNode.className = 'kmw_button_selected';\r\n      }\r\n      // Return the focus to the input area and set the active keyboard to nothing\r\n      ui.setLastFocus();\r\n      keymanweb['setActiveKeyboard']('','');\r\n\r\n      //Save current state when deselecting a keyboard (may not be needed)\r\n      ui.saveCookie();\r\n      ui.enableControls();\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Function     eventCapture\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @return      {boolean}\r\n     * Description  Browser-independent event capture\r\n     **/\r\n    ui.eventCapture = function(event)\r\n    {\r\n      if(!event) event = window.event;\r\n      if(window.event) window.event.returnValue = false;\r\n      if(event) event.cancelBubble = true;\r\n\r\n      return false;\r\n    }\r\n\r\n    /**\r\n     * Function     selectRegion\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @param       {string}  region\r\n     * @return      {boolean}\r\n     * Description  Select the region for which to list languages\r\n     **/\r\n    ui.selectRegion = function(event, region)\r\n    {\r\n      var e = ui.browseMapNode;\r\n      if(!e) return ui.eventCapture(event);\r\n      e.className = 'kmw_browsemap_'+region;\r\n      if(typeof(ui.regionLanguageListNodes[region]) == 'undefined')\r\n      {\r\n        ui.updateMap = true; ui.addKeyboardsToMap();\r\n      }\r\n      ui.regionLanguageListNodes[region].style.display='block';\r\n      ui.regionNodes[region].className='selected';\r\n      if(ui.selectedRegion != null && ui.selectedRegion != region)\r\n      {\r\n        ui.regionLanguageListNodes[ui.selectedRegion].style.display='none';\r\n        ui.regionNodes[ui.selectedRegion].className='';\r\n      }\r\n      ui.selectedRegion = region;\r\n      //ui.saveCookie();\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Function     unhoverRegion\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @param       {string}  region\r\n     * @return      {boolean}\r\n     * Description  Remove highlighting from a region\r\n     **/\r\n    ui.unhoverRegion = function(event, region)\r\n    {\r\n      ui.browseMapNode.className = (ui.selectedRegion == null ? '' : 'kmw_browsemap_'+ui.selectedRegion);\r\n      ui.regionNodes[region].className=(ui.selectedRegion==region?'selected':'');\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Function     hoverRegion\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @param       {string}  region\r\n     * @return      {boolean}\r\n     * Description  Highlight a hovered region\r\n     **/\r\n    ui.hoverRegion = function(event, region)\r\n    {\r\n      ui.browseMapNode.className = 'kmw_browsemap_'+region+'_sel';\r\n      ui.regionNodes[region].className='hover';\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Function     pluck\r\n     * Scope        Private\r\n     * @param       {Object}  elem\r\n     * @param       {string}  property\r\n     * @return      {*}\r\n     * Description  Get the value of an element property\r\n     **/\r\n    ui.pluck = function(elem, property) {\r\n        return elem.getAttribute ? elem.getAttribute(property) || elem[property] : elem[property];\r\n      };\r\n\r\n    /**\r\n     * Function     focusControlEvent\r\n     * Scope        Private\r\n     * @param       {Object}  params    Object containing Target element (or frame)\r\n     * @return      {boolean}\r\n     * Description  UI code to be executed on receiving focus\r\n     */\r\n    ui.focusControlEvent = function(params)\r\n    {\r\n      if(!ui.init) return true;\r\n\r\n      var t=params.target;\r\n      if(t.tagName.toLowerCase() == 'textarea' || (t.tagName.toLowerCase() == 'input' && t.type.toLowerCase() == 'text'))\r\n      {\r\n        ui.lastActiveControl = t;\r\n        if(ui.pluck(t, 'kmw_disable'))\r\n        {\r\n          if(ui.toolbarNode.className != 'kmw_controls_disabled')\r\n            ui.toolbarNode.className = 'kmw_controls_disabled';\r\n        }\r\n        else\r\n        {\r\n          if(ui.selectedKeyboard != null)\r\n          {\r\n            if(keymanweb['isCJK']())\r\n            {\r\n              ui.oskButtonNode.style.display = ui.oskBarNode.style.display = 'none';\r\n            }\r\n            else\r\n            {\r\n              let osk = keymanweb['osk'];\r\n              ui.oskButtonNode.className = (osk && osk['isEnabled']()) ? 'kmw_button_selected' : 'kmw_button';\r\n            }\r\n          }\r\n\r\n          if(ui.toolbarNode.className != '') ui.toolbarNode.className = '';\r\n\r\n          var offsetX, offsetY;\r\n          if(t.KMW_HelpOffsetX) offsetX = t.KMW_HelpOffsetX; else offsetX = 64;\r\n          if(t.KMW_HelpOffsetY) offsetY = t.KMW_HelpOffsetY; else offsetY = 0;\r\n          ui.helpOffsetX = util['getAbsoluteX'](t)+offsetX;\r\n          ui.helpOffsetY = util['getAbsoluteY'](t)+t.offsetHeight+offsetY;\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n    keymanweb['addEventListener']('controlfocused',ui.focusControlEvent);\r\n\r\n    /**\r\n     * Function     oncontrolblurred\r\n     * Scope        Private\r\n     * Parameters   {Object}  params  Object containing event\r\n     * @return      {boolean}\r\n     * Description  UI code to be executed on losing focus\r\n     */\r\n    ui.blurControlEvent = function(params)\r\n    {\r\n      if(!ui.init) return true;\r\n\r\n      // Must disable OSK button when not focused\r\n      if(ui.oskButtonNode.style.display != 'none') ui.oskButtonNode.className='kmw_button_disabled';\r\n\r\n      return true;\r\n    }\r\n    keymanweb['addEventListener']('controlblurred',ui.blurControlEvent);\r\n\r\n\r\n    /**\r\n     * UI action required when keyboard changed indirectly\r\n     *\r\n     * @param       {Object}  p   keyboard selection object\r\n     * @return      {boolean}\r\n     **/\r\n\r\n    ui.lastSelectedKeyboard = null;\r\n\r\n    ui.changeKeyboardEvent = function(p)\r\n    {\r\n      ui.lastSelectedKeyboard = null;\r\n      var kbName=p['internalName'],\r\n          lgName=keymanweb['util']['getLanguageCodes'](p['languageCode'])[0];\r\n      if(lgName != '' && kbName != '')\r\n      {\r\n        var lg = ui.languages[lgName];\r\n        if(lg != null)\r\n        {\r\n          for(var j=0; j<lg.keyboards.length; j++)\r\n          {\r\n            if(lg.keyboards[j]['InternalName'] == kbName)\r\n            {\r\n              ui.selectKeyboard(null, lg, lg.keyboards[j], false);\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n        ui.lastSelectedKeyboard = {...p};\r\n      }\r\n      return true;\r\n    }\r\n    keymanweb['addEventListener']('keyboardchange',ui.changeKeyboardEvent);\r\n\r\n\r\n    /**\r\n     * UI action when OSK displayed: restore to or update the saved OSK position\r\n     *\r\n     * @param       {Object}  oskPosition\r\n     * @return      {Object}\r\n     **/\r\n    ui.onShowOSK = function(oskPosition)\r\n    {\r\n      if(ui.init) ui.oskButtonNode.className = 'kmw_button_selected';\r\n      //The return valu is not currently useful, but allows for the possibility of the OSK restricting or limiting\r\n      //a UI-set position, and returning the corrected position to the UI\r\n      return oskPosition;\r\n    }\r\n\r\n    /**\r\n     * Update appearance of OSK button whenever the OSK is hidden by the user\r\n     *\r\n     * @param       {Object}  p\r\n     **/\r\n    ui.onHideOSK = function(p)\r\n    {\r\n      if(ui.init && p['HiddenByUser']) ui.oskButtonNode.className = 'kmw_button';\r\n    }\r\n\r\n\r\n    ui.registerEvents = function() {\r\n      let osk = keymanweb['osk'];\r\n      if(!osk) {\r\n        return;\r\n      }\r\n\r\n      osk['addEventListener']('show',ui.onShowOSK);\r\n      osk['addEventListener']('hide',ui.onHideOSK);\r\n    }\r\n\r\n    /**\r\n     * Function     showKeyboardsPopup\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @return      {boolean}\r\n     * Description  Update the map when displayed\r\n     **/\r\n    ui.showKeyboardsPopup = function(event)\r\n    {\r\n      // Add any newly available keyboards to the map\r\n      ui.addKeyboardsToMap();\r\n\r\n      if(ui.toolbarNode.className == 'kmw_controls_disabled') return ui.eventCapture(event);\r\n      ui.hideKeyboardsForLanguage(null);\r\n      if(ui.selectorNode.className=='kmw_over') return ui.hideKeyboardsPopup(event);\r\n      ui.selectorNode.className='kmw_over';\r\n      ui.keyboardsButtonNode.className='kmw_button_selected';\r\n\r\n      ui.SetupPopupDismissal(ui.selectorNode, ui.hideKeyboardsPopup);\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Function     hideKeyboardsPopup\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @return      {boolean}\r\n     * Description  Hide the list of keyboards for this language\r\n     **/\r\n    ui.hideKeyboardsPopup = function(event)\r\n    {\r\n      ui.selectorNode.className='';\r\n      ui.keyboardsButtonNode.className='kmw_button';\r\n      ui.CancelPopupDismissal(ui.hideKeyboardsPopup);\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Hide both language and keyboard selection popups on body click\r\n     * @param   {Object}  event\r\n     * @return  {boolean}\r\n    **/\r\n    ui.hideAllPopups = function(event)\r\n    {\r\n      var e = ui.keyboardsForLangPopup;\r\n      if((!e || (e.style.display =='none')) && (ui.selectorNode.className == '')) return true;\r\n      ui.hideKeyboardsPopup(event);\r\n      ui.hideKeyboardsForLanguage(event);\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    var dismissalCallback = null, popupElement = null, lastDismissalCallback = null;\r\n\r\n    /**\r\n     * Function     PopupDismissal\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @return      {Object}\r\n     * Description  Carry out action when popup dismissed\r\n     **/\r\n    ui.PopupDismissal = function(event)\r\n    {\r\n      var t = (event && event.target) || (window.event && window.event.srcElement);\r\n      if(t)\r\n      {\r\n        while(t.parentNode)\r\n        {\r\n          if (t == popupElement) return null;\r\n          t = t.parentNode;\r\n        }\r\n      }\r\n      if(t.nodeName == '#document') ui.hideAllPopups(event); //KMEW-41, fixed for build 356.\r\n      return dismissalCallback;\r\n    }\r\n\r\n    /**\r\n     * Function     SetupPopupDismissal\r\n     * Scope        Private\r\n     * @param       {Object}            element\r\n     * @param       {function(Object)}  callback\r\n     * Description  Prepare for callback dismissal\r\n     **/\r\n    ui.SetupPopupDismissal = function(element, callback)\r\n    {\r\n      if(ui.PopupDismissal == document.onclick)\r\n        ui.CancelPopupDismissal(dismissalCallback);\r\n      dismissalCallback = callback;\r\n      popupElement = element;\r\n      lastDismissalCallback = document.onclick;\r\n      document.onclick = ui.PopupDismissal;\r\n    }\r\n\r\n    /**\r\n     * Function     CancelPopupDismissal\r\n     * Scope        Private\r\n     * @param       {?function(Object)}  callback\r\n     * Description  Cancel callback dismissal\r\n     **/\r\n    ui.CancelPopupDismissal = function(callback)\r\n    {\r\n      if(ui.PopupDismissal == document.onclick)\r\n      {\r\n        document.onclick = lastDismissalCallback;\r\n        lastDismissalCallback = null;\r\n        dismissalCallback = null;\r\n        popupElement = null;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Load the previous state from the KeymanWeb_Keyboard and KeymanWeb_Toolbar cookies\r\n     **/\r\n    ui.loadCookie = function()\r\n    {\r\n      var currentKeyboard='',currentLgCode='',c=util['loadCookie'](\"KeymanWeb_Keyboard\");\r\n      if(c['current'] != undefined) currentKeyboard = c['current'].split(':')[0];\r\n      c=util['loadCookie'](\"KeymanWeb_Toolbar\");\r\n\r\n      if(c['region'] != undefined) ui.selectedRegion = c['region'];\r\n      if(c['maxrecent'] != undefined)\r\n      {\r\n        for(var i=0; i<c['maxrecent']; i++)\r\n        {\r\n          if(c['recent'+i] != undefined)\r\n          {\r\n            var r=c['recent'+i].split(',');\r\n            if(r.length == 2)\r\n            {\r\n              var k = ui.languages[r[0]];\r\n              if(k != null)\r\n              {\r\n                for(var j=0; j<k.keyboards.length; j++)\r\n                {\r\n                  if(k.keyboards[j]['InternalName'] == r[1])\r\n                  {\r\n                    ui.addKeyboardToList(k, k.keyboards[j]);\r\n                    if(k.keyboards[j]['InternalName'] == currentKeyboard)\r\n                    {\r\n                      ui.selectKeyboard(null, k, k.keyboards[j], true);\r\n                      window.focus(); ui.setLastFocus();\r\n                      break;\r\n                    }\r\n                    break;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      // If language list and keyboard list have not yet been saved as a cookie,\r\n      // initialize to the current (default) language and keyboard, if set by KMW\r\n      else\r\n      {\r\n        var kbName=keymanweb['getActiveKeyboard'](),\r\n            lgName=keymanweb['getActiveLanguage']();\r\n        if(lgName != '' && kbName != '')\r\n        {\r\n          var lg = ui.languages[lgName];\r\n          if(lg != null)\r\n          {\r\n            for(var j=0; j<lg.keyboards.length; j++)\r\n            {\r\n              if(lg.keyboards[j]['InternalName'] == kbName)\r\n              {\r\n                ui.selectKeyboard(null, lg, lg.keyboards[j], true);\r\n                window.focus(); ui.setLastFocus();\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Save the current UI state in the KeymanWeb_Toolbar cookie\r\n     **/\r\n    ui.saveCookie = function()\r\n    {\r\n      var vs={};\r\n      vs['region'] = ui.selectedRegion;\r\n      vs['maxrecent'] = ''+ui.listedKeyboards.length;\r\n      for(var i=0; i<ui.listedKeyboards.length; i++)\r\n        vs['recent'+i] = ui.listedKeyboards[i].lang.id+\",\"+ui.listedKeyboards[i].keyboard['InternalName'];\r\n      util['saveCookie']('KeymanWeb_Toolbar',vs);\r\n    }\r\n\r\n    // Initialize when everything defined (replaces unreliable onload event handler)\r\n    // In case the toolbar script loads a bit later than the main KMW script\r\n    // (may happen in unit testing)\r\n    ui.initToolbarUI(); // equivalent to ui.Initialize() from the other UI modules\r\n  } catch(ex){}\r\n}"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","window","keymanweb","util","dbg","init","toolbarNode","backgroundNode","browseMapNode","keyboardsButtonNode","languageButtonsNode","offButtonNode","offBarNode","oskButtonNode","oskBarNode","selectorNode","regionLanguageListNodes","regionNodes","langKeyboardNodes","langKeyboardListNodes","selectedRegion","listedKeyboards","catchAllRegion","keyboardListPriority","maxListedKeyboards","lastActiveControl","selectedKeyboard","selectedLanguage","helpOffsetX","helpOffsetY","languages","updateMap","startTimer","lgText","ui","ToolBar_Text","Keyboards","OffTitle","Off","ShowOSK","LanguageSelector","controller","document","getElementById","createNode","ui.createNode","tag","id","className","innerHTML","node","createElement","ondragstart","node.ondragstart","initToolbarUI","ui.initToolbarUI","e","body","insertBefore","firstChild","_insertedElem","style","visibility","maxHeight","regions","m","display","tbNode","href","target","appendChild","title","aNode","onclick","showKeyboardsPopup","regionsNode","imgNode","src","useMap","mapNode","name","areaNode","shape","alt","hidefocus","event","selectRegion","onmouseover","hoverRegion","onmouseout","unhoverRegion","coords","nohref","eventCapture","listNode","itemNode","offButtonClickEvent","showOSK","onmousedown","aNode.onmousedown","img","clearTimeout","setTimeout","addKeyboardsToMap","hideAllPopups","registerEvents","shutdown","ui.shutdown","root","parentNode","removeChild","ui.addKeyboardsToMap","sort","sortKeyboards","childNodes","colNode","max","count","languageCode","j","kbdRegion","bcpSubtags","Number","toFixed","x","keyboards","push","concat","langNode","lang","selectLanguage","loadCookie","enableControls","lastSelectedKeyboard","changeKeyboardEvent","ui.sortKeyboards","a","b","findListedKeyboard","ui.findListedKeyboard","addKeyboardToList","ui.addKeyboardToList","kbd","found","oldestPriority","oldestFound","priority","rk","buttonNode","slice","p1","p2","toLowerCase","indexOf","aNode.onclick","truncate","thisANode","showKeyboardsForLanguage","divNode","kbdText","replace","selectKeyboard","keyboard","ui.truncate","PName","PLen","substr","registerKeyboard","ui.registerKeyboard","keyboardsForLangPopup","hideKeyboardsForLanguage","ui.hideKeyboardsForLanguage","CancelPopupDismissal","ui.showKeyboardsForLanguage","hideKeyboardsPopup","SetupPopupDismissal","ui.selectLanguage","ui.selectKeyboard","updateKeyman","SelectedLanguage","LanguageCode","setLastFocus","saveCookie","ui.enableControls","elems","hideOskButton","ui.setLastFocus","ui.showOSK","osk","ui.offButtonClickEvent","ui.eventCapture","returnValue","cancelBubble","ui.selectRegion","region","ui.unhoverRegion","ui.hoverRegion","pluck","ui.pluck","elem","property","getAttribute","focusControlEvent","ui.focusControlEvent","params","tagName","type","offsetX","KMW_HelpOffsetX","offsetY","KMW_HelpOffsetY","offsetHeight","blurControlEvent","ui.blurControlEvent","ui.changeKeyboardEvent","kbName","lgName","lg","onShowOSK","ui.onShowOSK","oskPosition","onHideOSK","ui.onHideOSK","ui.registerEvents","ui.showKeyboardsPopup","ui.hideKeyboardsPopup","ui.hideAllPopups","dismissalCallback","popupElement","lastDismissalCallback","PopupDismissal","ui.PopupDismissal","srcElement","nodeName","ui.SetupPopupDismissal","element","callback","ui.CancelPopupDismissal","ui.loadCookie","currentKeyboard","c","undefined","split","r","k","focus","ui.saveCookie","vs","ex"],"sourceRoot":"https://s.keyman.com/kmw/engine/17.0.95/src"}