(function(){var I=Object.create;var L=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var U=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var j=function(n,e){return function(){return e||n((e={exports:{}}).exports,e),e.exports}},X=function(n,e){for(var t in e)L(n,t,{get:e[t],enumerable:!0})},w=function(n,e,t,o){if(e&&typeof e=="object"||typeof e=="function")for(var s=W(e),r=0,i=s.length,a;r<i;r++)a=s[r],!z.call(n,a)&&a!==t&&L(n,a,{get:function(h){return e[h]}.bind(null,a),enumerable:!(o=H(e,a))||o.enumerable});return n},B=function(n,e,t){return w(n,e,"default"),t&&w(t,e,"default")},P=function(n,e,t){return t=n!=null?I(U(n)):{},w(e||!n||!n.__esModule?L(t,"default",{value:n,enumerable:!0}):t,n)};var T=j(function(G,_){var x;(function(n){var e=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(o){n(t(e,t(o)))}):typeof _=="object"&&typeof _.exports=="object"?n(t(e,t(_.exports))):n(t(e));function t(o,s){return o!==e&&(typeof Object.create=="function"?Object.defineProperty(o,"__esModule",{value:!0}):o.__esModule=!0),function(r,i){return o[r]=s?s(r,i):i}}})(function(n){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(t[s]=o[s])};x=Object.assign||function(t){for(var o,s=1,r=arguments.length;s<r;s++){o=arguments[s];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])}return t},n("__assign",x)})});var m={};X(m,{tslib:function(){return A}});B(m,P(T(),1));var A=P(T(),1);var S;if(!(!((S=keyman==null?void 0:keyman.ui)===null||S===void 0)&&S.name))try{if(u=keyman,b=u.util,b.isTouchDevice())throw"";R=function(){function n(){var e=this;this.init=!1,this.toolbarNode=null,this.browseMapNode=null,this.keyboardsButtonNode=null,this.languageButtonsNode=null,this.offButtonNode=null,this.offBarNode=null,this.oskButtonNode=null,this.oskBarNode=null,this.selectorNode=null,this.regionLanguageListNodes={},this.regionsNode=null,this.regionNodes=null,this.langKeyboardNodes={},this.langKeyboardListNodes={},this.selectedRegion="as",this.listedKeyboards=[],this.catchAllRegion="un",this.keyboardListPriority=0,this.maxListedKeyboards=1,this.lastActiveControl=null,this.selectedKeyboard=null,this.selectedLanguage="",this.helpOffsetX=0,this.helpOffsetY=0,this.keyboardsForLangPopup=null,this.lastSelectedKeyboard=null,this.languages={},this.updateMap=!1,this.startTimer=0,this.lgText="",this.name="toolbar",this.ToolBar_Text={Keyboards:"Languages",OffTitle:"Turn off KeymanWeb keyboards",Off:"Off",ShowOSK:"Show On Screen Keyboard",LanguageSelector:"Select language",SelectKeyboardPre:"Select ",SelectKeyboardSuf:"keyboard",AltKeyboardsPre:"Alternate keyboards for ",AltKeyboardsSuf:"",ca:"Central America",sa:"South America",na:"Americas",eu:"Europe",af:"Africa",un:"Undetermined",as:"Asia",oc:"Oceania"},this.addKeyboardsToMap=function(){if(e.updateMap)e.updateMap=!1;else return;e.regionLanguageListNodes={};var t=u.getKeyboards();t.sort(e.sortKeyboards);var o=0;for(o=e.regionsNode.children.length;o>0;o--)e.regionsNode.children[o-1].className=="kmw_selector_region"&&e.regionsNode.removeChild(e.regionsNode.childNodes[o-1]);for(var s in e.regions){e.regionLanguageListNodes[s]=e.createNode("div",null,"kmw_selector_region");for(var r=e.createNode("div",null,"kmw_keyboard_col"),i=0,a=0,h="",l=0;l<t.length;l++){var d=t[l].RegionCode;if(e.regions[d]){if(d!=s)continue}else if(s!=e.catchAllRegion)continue;var c=u.util.getLanguageCodes(t[l].LanguageCode);c[0]!=h&&(h=c[0],i++)}i=Number(((i+3)/4).toFixed(0)),h="";for(var l=0;l<t.length;l++){var g=t[l].RegionCode;if(e.regions[g]){if(g!=s)continue}else if(s!=e.catchAllRegion)continue;var c=u.util.getLanguageCodes(t[l].LanguageCode);if(c[0]==h){var y=e.languages[h].keyboards;y.push?y.push(t[l]):e.languages[h].keyboards=y.concat(t[l]);continue}h=c[0],e.languages[h]={id:t[l].LanguageCode,name:t[l].LanguageName,keyboards:[t[l]]},a%i==0&&a>0&&(e.regionLanguageListNodes[s].appendChild(r),r=e.createNode("div",null,a/i==3?"kmw_keyboard_col_right":"kmw_keyboard_col")),a++;var f=e.createNode("div",null,"kmw_language"),p=e.createNode("a",null,null,t[l].LanguageName);p.href="#",p.onclick=function(K){return function(C){return e.selectLanguage(C,K)}}(e.languages[h]),f.appendChild(p),r.appendChild(f),o++}e.regionLanguageListNodes[s].appendChild(r),e.regionLanguageListNodes[s].appendChild(e.createNode("div",null,"kmw_clear")),e.regionsNode.appendChild(e.regionLanguageListNodes[s])}e.loadCookie(),e.selectRegion(null,e.selectedRegion),e.enableControls(),e.lastSelectedKeyboard&&e.changeKeyboardEvent(e.lastSelectedKeyboard),u.focusLastActiveElement()},this.sortKeyboards=function(t,o){return t.RegionCode<o.RegionCode?-2:t.RegionCode>o.RegionCode?2:t.LanguageName<o.LanguageName?-1:t.LanguageName>o.LanguageName?1:0},this.registerKeyboard=function(){e.updateMap=!0,e.startTimer&&clearTimeout(e.startTimer),e.startTimer=window.setTimeout(e.addKeyboardsToMap,0)},this.hideKeyboardsForLanguage=function(t){var o=e.keyboardsForLangPopup;return o&&(o.style.display="none"),e.CancelPopupDismissal(e.hideKeyboardsForLanguage),e.eventCapture(t)},this.showKeyboardsForLanguage=function(t,o){e.hideKeyboardsPopup(t);var s=e.langKeyboardListNodes[o.id];if(s){if(s.style.display=="block")return e.hideKeyboardsForLanguage(t);s.style.display="block",e.keyboardsForLangPopup=s,e.SetupPopupDismissal(s,e.hideKeyboardsForLanguage)}return e.eventCapture(t)},this.showOSK=function(t){var o=u.osk;return o?(u.activatingUI(!0),o&&u.getActiveKeyboard()!=""&&(o.isEnabled()?o.hide():o.show(!0)),e.setLastFocus(),u.activatingUI(!1),e.eventCapture(t)):!1},this.offButtonClickEvent=function(t){if(e.toolbarNode.className!="kmw_controls_disabled"){if(e.hideKeyboardsForLanguage(null),e.selectedLanguage){var o=e.findListedKeyboard(e.selectedLanguage);o!=null&&(e.listedKeyboards[o].buttonNode.className="kmw_button")}e.selectedKeyboard=null,e.selectedLanguage=null,e.offButtonNode.className="kmw_button_selected"}return e.setLastFocus(),u.setActiveKeyboard("",""),e.saveCookie(),e.enableControls(),e.eventCapture(t)},this.eventCapture=function(t){return t||(t=window.event),window.event&&(window.event.returnValue=!1),t&&(t.cancelBubble=!0),!1},this.selectRegion=function(t,o){var s=e.browseMapNode;return s&&(s.className="kmw_browsemap_"+o,typeof e.regionLanguageListNodes[o]=="undefined"&&(e.updateMap=!0,e.addKeyboardsToMap()),e.regionLanguageListNodes[o].style.display="block",e.regionNodes[o].className="selected",e.selectedRegion!=null&&e.selectedRegion!=o&&(e.regionLanguageListNodes[e.selectedRegion].style.display="none",e.regionNodes[e.selectedRegion].className=""),e.selectedRegion=o),e.eventCapture(t)},this.unhoverRegion=function(t,o){return e.browseMapNode.className=e.selectedRegion==null?"":"kmw_browsemap_"+e.selectedRegion,e.regionNodes[o].className=e.selectedRegion==o?"selected":"",e.eventCapture(t)},this.hoverRegion=function(t,o){return e.browseMapNode.className="kmw_browsemap_"+o+"_sel",e.regionNodes[o].className="hover",e.eventCapture(t)},this.focusControlEvent=function(t){if(!e.init)return!0;var o=t.target;if(o.tagName.toLowerCase()=="textarea"||o.tagName.toLowerCase()=="input"&&o.type.toLowerCase()=="text")if(e.lastActiveControl=o,e.pluck(o,"kmw_disable"))e.toolbarNode.className!="kmw_controls_disabled"&&(e.toolbarNode.className="kmw_controls_disabled");else{if(e.selectedKeyboard!=null)if(u.isCJK())e.oskButtonNode.style.display=e.oskBarNode.style.display="none";else{var s=u.osk;e.oskButtonNode.className=s&&s.isEnabled()?"kmw_button_selected":"kmw_button"}e.toolbarNode.className!=""&&(e.toolbarNode.className="");var r=void 0,i=void 0;o.KMW_HelpOffsetX?r=o.KMW_HelpOffsetX:r=64,o.KMW_HelpOffsetY?i=o.KMW_HelpOffsetY:i=0,e.helpOffsetX=b.getAbsoluteX(o)+r,e.helpOffsetY=b.getAbsoluteY(o)+o.offsetHeight+i}return!0},this.blurControlEvent=function(){return e.init&&e.oskButtonNode.style.display!="none"&&(e.oskButtonNode.className="kmw_button_disabled"),!0},this.changeKeyboardEvent=function(t){e.lastSelectedKeyboard=null;var o=t.internalName,s=u.util.getLanguageCodes(t.languageCode)[0];if(s!=""&&o!=""){var r=e.languages[s];if(r!=null){for(var i=0;i<r.keyboards.length;i++)if(r.keyboards[i].InternalName==o)return e.selectKeyboard(null,r,r.keyboards[i],!1),!0}e.lastSelectedKeyboard=(0,m.__assign)({},t)}return!0},this.onShowOSK=function(t){return e.init&&(e.oskButtonNode.className="kmw_button_selected"),t},this.onHideOSK=function(t){e.init&&t.HiddenByUser&&(e.oskButtonNode.className="kmw_button")},this.showKeyboardsPopup=function(t){return e.addKeyboardsToMap(),e.toolbarNode.className=="kmw_controls_disabled"?e.eventCapture(t):(e.hideKeyboardsForLanguage(null),e.selectorNode.className=="kmw_over"?e.hideKeyboardsPopup(t):(e.selectorNode.className="kmw_over",e.keyboardsButtonNode.className="kmw_button_selected",e.SetupPopupDismissal(e.selectorNode,e.hideKeyboardsPopup),e.eventCapture(t)))},this.hideKeyboardsPopup=function(t){return e.selectorNode.className="",e.keyboardsButtonNode.className="kmw_button",e.CancelPopupDismissal(e.hideKeyboardsPopup),e.eventCapture(t)},this.hideAllPopups=function(t){var o=e.keyboardsForLangPopup;return(!o||o.style.display=="none")&&e.selectorNode.className==""?!0:(e.hideKeyboardsPopup(t),e.hideKeyboardsForLanguage(t),e.eventCapture(t))},this.dismissalCallback=null,this.popupElement=null,this.lastDismissalCallback=null,this.PopupDismissal=function(t){var o=t&&t.target||window.event&&window.event.srcElement;if(o)for(;o.parentElement;){if(o==e.popupElement)return null;o=o.parentElement}return o.nodeName=="#document"&&e.hideAllPopups(t),e.dismissalCallback}}return n.prototype.createNode=function(e,t,o,s){var r=document.createElement(e);return t&&(r.id=t),o&&(r.className=o),s&&(r.innerHTML=s),(e=="a"||e=="area"||e=="map")&&(r.ondragstart=function(){return!1}),r},n.prototype.initialize=function(){var e=this;if(!(!u.initialized||this.init)){var t=document.getElementById("KeymanWebControl");if(!t){if(document.body==null)return;t=document.createElement("div"),t.id="KeymanWebControl",document.body.insertBefore(t,document.body.firstChild),this._insertedElem=t}if(t.style.visibility="hidden",t.style.maxHeight="35px",this.init=!0,!b.isTouchDevice()){this.regions={},this.regions.na={t:this.ToolBar_Text.na,m:"0,3,0,37,24,32,35,37,43,47,49,52,65,54,68,57,71,56,73,59,75,60,93,61,93,57,103,49,118,41,126,41,136,23,148,17,156,14,164,5,164,0,57,0,35,5,25,9,5,8,49,52,65,54,68,57,71,56,73,59,75,60,93,61,94,58,97,58,101,59,107,60,114,64,115,68,114,77,104,74,98,75,96,78,95,82,90,81,85,80,82,76,78,74,74,73,65,68,57,61,82,82,95,82,96,78,98,75,104,74,114,77,120,79,124,83,126,87,141,90,142,97,138,103,135,113,127,116,123,124,115,131,112,132,109,138,117,139,140,141,141,146,134,148,114,145,109,148,100,148,91,143,91,130,96,111,89,102,83,95,77,89"},this.regions.eu={t:this.ToolBar_Text.eu,m:"145,29,146,19,158,14,171,6,187,2,206,1,217,4,227,11,231,16,231,33,227,34,225,35,225,37,227,39,228,44,228,47,227,48,223,46,218,44,215,43,208,43,203,45,202,48,205,52,201,52,195,49,189,50,187,48,177,48,175,49,166,50,147,33"},this.regions.af={t:this.ToolBar_Text.af,m:"150,58,158,50,166,50,175,49,177,48,187,48,189,50,195,49,201,52,205,52,207,53,221,75,229,75,231,77,231,85,227,92,232,101,237,106,237,112,227,115,222,118,206,125,199,127,193,127,185,111,183,104,180,87,168,89,153,85,143,71,147,60"},this.regions.as={t:this.ToolBar_Text.as,m:"219,1,221,6,228,12,231,16,231,33,227,34,225,35,225,37,227,39,229,45,232,48,239,48,240,49,239,53,242,60,243,65,249,70,252,81,259,87,271,87,278,95,289,100,303,101,311,98,320,98,323,98,323,84,311,81,308,73,307,65,317,57,330,50,334,44,348,36,364,38,375,34,375,8,355,8,336,5,292,1,285,0,219,0"},this.regions.oc={t:this.ToolBar_Text.oc,m:"288,117,289,107,303,101,311,98,323,98,323,84,333,77,344,73,362,80,369,88,375,96,375,141,352,143,323,142,316,136,310,130,291,130"},this.regions.un={t:this.ToolBar_Text.un,m:"205,52,202,48,203,45,208,43,215,43,218,44,223,46,227,48,232,48,239,48,240,49,239,53,242,60,243,65,237,76,231,77,229,75,221,75,207,53"},this.toolbarNode=this.createNode("div","kmw_controls"),this.toolbarNode.style.display="block",b.linkStyleSheet(b.getOption("resources")+"ui/toolbar/kmwuitoolbar.css");var o=this.createNode("a","kmw_controls_start",null," ");o.href="https://keyman.com/developer/keymanweb/",o.target="_blank",this.toolbarNode.appendChild(o),this.keyboardsButtonNode=this.createNode("div","kmw_btn_keyboards","kmw_button"),this.keyboardsButtonNode.title=this.ToolBar_Text.LanguageSelector;var s=this.createNode("a",null,"kmw_button_a");s.href="#",s.onclick=this.showKeyboardsPopup,s.appendChild(this.createNode("div","kmw_img_keyboards","kmw_img")),s.appendChild(this.createNode("div",null,"kmw_a",this.ToolBar_Text.Keyboards)),s.appendChild(this.createNode("div",null,"kmw_drop")),this.keyboardsButtonNode.appendChild(s),this.selectorNode=this.createNode("div","kmw_selector"),this.regionsNode=this.createNode("div","kmw_selector_regions"),this.browseMapNode=this.createNode("div","kmw_browsemap");var r=this.createNode("img","kmw_region_browsemap");r.src=b.getOption("resources")+"ui/toolbar/blank.gif",r.useMap="#kmw_worldgrey16",this.browseMapNode.appendChild(r);var i=this.createNode("map","kmw_worldgrey16");i.name="kmw_worldgrey16";for(var a in this.regions){var h=this.createNode("area");h.shape="poly",h.alt="",h.href="#",h.title=this.regions[a].t,h.hidefocus="true",h.onclick=function(y){return function(f){return e.selectRegion(f,y)}}(a),h.onmouseover=function(y){return function(f){return e.hoverRegion(f,y)}}(a),h.onmouseout=function(y){return function(f){return e.unhoverRegion(f,y)}}(a),h.coords=this.regions[a].m,i.appendChild(h)}var l=this.createNode("area");l.shape="default",l.noHref=!0,l.alt="",l.onclick=this.eventCapture,i.appendChild(l),this.browseMapNode.appendChild(i),this.regionsNode.appendChild(this.browseMapNode),this.regionNodes={};var d=this.createNode("ul");for(var a in this.regions){var c=this.createNode("li");this.regionNodes[a]=this.createNode("a",null,null,this.regions[a].t),this.regionNodes[a].href="#",this.regionNodes[a].onclick=function(f){return function(p){return e.selectRegion(p,f)}}(a),this.regionNodes[a].onmouseover=function(f){return function(p){return e.hoverRegion(p,f)}}(a),this.regionNodes[a].onmouseout=function(f){return function(p){return e.unhoverRegion(p,f)}}(a),c.appendChild(this.regionNodes[a]),d.appendChild(c)}this.regionsNode.appendChild(d),this.selectorNode.appendChild(this.regionsNode),this.keyboardsButtonNode.appendChild(this.selectorNode),this.toolbarNode.appendChild(this.keyboardsButtonNode),this.toolbarNode.appendChild(this.offBarNode=this.createNode("div","kmw_bar_off","kmw_bar")),this.offButtonNode=this.createNode("div","kmw_btn_off","kmw_button_selected"),s=this.createNode("a",null,"kmw_button_a"),s.href="#",s.onclick=this.offButtonClickEvent,s.title=this.ToolBar_Text.OffTitle,s.appendChild(this.createNode("div","kmw_img_off","kmw_img")),s.appendChild(this.createNode("div",null,"kmw_a",this.ToolBar_Text.Off)),this.offButtonNode.appendChild(s),this.toolbarNode.appendChild(this.offButtonNode),this.toolbarNode.appendChild(this.languageButtonsNode=this.createNode("div","kmw_control_keyboards","kmw_button")),this.toolbarNode.appendChild(this.oskBarNode=this.createNode("div","kmw_bar_osk","kmw_bar")),this.oskButtonNode=this.createNode("div","kmw_btn_osk","kmw_button"),s=this.createNode("a",null,"kmw_button_a"),s.href="#",s.onclick=this.showOSK,s.onmousedown=function(){u.activatingUI(!0)},s.title=this.ToolBar_Text.ShowOSK,s.appendChild(this.createNode("div","kmw_img_osk","kmw_img")),this.oskButtonNode.appendChild(s),this.toolbarNode.appendChild(this.oskButtonNode),this.toolbarNode.appendChild(this.createNode("div","kmw_controls_end",null," "));var g=this.createNode("div");g.id="kmw_map_preload",this.toolbarNode.appendChild(g),this.toolbarNode.appendChild(this.createNode("br",null,"kmw_clear")),t.appendChild(this.toolbarNode),this.updateMap=!0,this.startTimer&&clearTimeout(this.startTimer),this.startTimer=window.setTimeout(this.addKeyboardsToMap,0),b.attachDOMEvent(document.body,"click",this.hideAllPopups,!1),this.selectedRegion="eu",this.registerEvents(),u.focusLastActiveElement()}}},n.prototype.shutdown=function(){var e=this.toolbarNode;e&&e.parentNode.removeChild(e),e=this._insertedElem,e&&e.parentNode.removeChild(e)},n.prototype.findListedKeyboard=function(e){typeof e!="string"&&(e=e.id);for(var t=0;t<this.listedKeyboards.length;t++)if(this.listedKeyboards[t].lang.id==e)return t;return null},n.prototype.addKeyboardToList=function(e,t){var o=this,s=this.findListedKeyboard(e);if(s==null){if(this.listedKeyboards.length>=this.maxListedKeyboards){for(var r=2147483647,i=null,a=0;a<this.listedKeyboards.length;a++)this.listedKeyboards[a].priority<r&&(i=a,r=this.listedKeyboards[a].priority);if(i!=null){var h=this.listedKeyboards[i];this.langKeyboardListNodes[h.lang.id]=null,this.langKeyboardNodes[h.lang.id]=null,this.languageButtonsNode.removeChild(h.buttonNode),i==0?this.listedKeyboards=this.listedKeyboards.slice(i+1):i==this.listedKeyboards.length-1?this.listedKeyboards=this.listedKeyboards.slice(0,i):this.listedKeyboards=this.listedKeyboards.slice(0,i).concat(this.listedKeyboards.slice(i+1))}}var l=this.createNode("div",null,"kmw_button"),d=this.createNode("a",null,"kmw_button_a"+(e.keyboards.length>1?" kmw_norightgap":""));d.href="#";var c=this.ToolBar_Text.SelectKeyboardPre+t.Name,g=this.ToolBar_Text.SelectKeyboardSuf;c.toLowerCase().indexOf(g.toLowerCase())<0&&(c=c+" "+g),d.title=c,d.onclick=function(N){return o.selectLanguage(N,e)},d.appendChild(this.createNode("div","kmw_img_kbd","kmw_img")),this.lgText=this.truncate(e.name,28),d.appendChild(this.createNode("div",null,"kmw_a",this.lgText)),l.appendChild(d);var y=d;if(e.keyboards.length>1){d=this.createNode("a",null,"kmw_button_a kmw_noleftgap"),d.href="#",d.title=this.ToolBar_Text.AltKeyboardsPre+e.name+this.ToolBar_Text.AltKeyboardsSuf,d.onclick=function(N){return o.showKeyboardsForLanguage(N,e)};var f=this.createNode("div",null,"kmw_a"),p=this.truncate(t.Name.replace(/\s?keyboard/i,""),40-this.lgText.length);f.appendChild(this.langKeyboardNodes[e.id]=this.createNode("span",null,"kmw_kbd",p)),d.appendChild(f),d.appendChild(this.createNode("div",null,"kmw_drop")),l.appendChild(d),this.langKeyboardListNodes[e.id]=this.createNode("ul",null,"kmw_selector_kbd"),this.langKeyboardListNodes[e.id].style.display="none";for(var k in e.keyboards){var O=this.createNode("li");p=e.keyboards[k].Name.replace(/\s?keyboard/i,""),p=p+" ["+e.keyboards[k].LanguageCode+"]",d=this.createNode("a",null,null,p),d.href="#",d.title="",d.onclick=function(N,D){return function(F){return o.selectKeyboard(F,N,D,!0)}}(e,e.keyboards[k]),O.appendChild(d),this.langKeyboardListNodes[e.id].appendChild(O)}l.appendChild(this.langKeyboardListNodes[e.id])}this.languageButtonsNode.appendChild(l);var K=e,C=l;this.listedKeyboards.push({priority:this.keyboardListPriority++,lang:K,keyboard:t,buttonNode:C,aNode:y})}else{this.listedKeyboards[s].priority=this.keyboardListPriority++,this.listedKeyboards[s].keyboard=t;var E=this.langKeyboardNodes[e.id];if(E){var M=t.Name.replace(/\s?keyboard/i,"");E.innerHTML=this.truncate(M,40-this.lgText.length)}if(this.listedKeyboards[s].aNode){var c=this.ToolBar_Text.SelectKeyboardPre+t.Name,g=this.ToolBar_Text.SelectKeyboardSuf;c.toLowerCase().indexOf(g.toLowerCase())<0&&(c=c+" "+g),this.listedKeyboards[s].aNode.title=c}}},n.prototype.truncate=function(e,t){return e.length<=t?e:e.substr(0,t-1)+"\u2026"},n.prototype.selectLanguage=function(e,t){var o=this.findListedKeyboard(t),s=null;return o==null?s=t.keyboards[0]:s=this.listedKeyboards[o].keyboard,s?this.selectKeyboard(e,t,s,!0):!1},n.prototype.selectKeyboard=function(e,t,o,s){var r=this;if(u.activatingUI(!0),this.selectedLanguage){var i=this.findListedKeyboard(this.selectedLanguage);i!=null&&(this.listedKeyboards[i].buttonNode.className="kmw_button")}return this.offButtonNode.className="kmw_button",this.selectedKeyboard=o,this.selectedLanguage=o.LanguageCode,this.addKeyboardToList(t,o),s&&u.setActiveKeyboard(o.InternalName,o.LanguageCode).then(function(){r.setLastFocus()}),this.listedKeyboards[this.findListedKeyboard(t)].buttonNode.className="kmw_button_selected",this.saveCookie(),this.enableControls(),u.activatingUI(!1),this.hideKeyboardsPopup(e)||this.hideKeyboardsForLanguage(e)},n.prototype.enableControls=function(){var e=[this.offButtonNode,this.offBarNode,this.oskButtonNode,this.oskBarNode],t=!1;if(u.isCJK(this.selectedKeyboard)?t=!0:this.selectedKeyboard==null&&(t=e[2].style.display=="none"),this.selectedKeyboard!=null||this.listedKeyboards.length>0)for(var o=0;o<e.length;o++)e[o].style.display="";else for(var o=0;o<e.length;o++)e[o].style.display="none";return t?this.oskButtonNode.style.display=this.oskBarNode.style.display="none":this.selectedKeyboard==null&&(this.oskButtonNode.className="kmw_button_disabled"),this.toolbarNode.parentElement.style.visibility="visible",!0},n.prototype.setLastFocus=function(){u.focusLastActiveElement()},n.prototype.pluck=function(e,t){return e.getAttribute&&e.getAttribute(t)||e[t]},n.prototype.registerEvents=function(){var e=u.osk;e&&(e.addEventListener("show",this.onShowOSK),e.addEventListener("hide",this.onHideOSK))},n.prototype.SetupPopupDismissal=function(e,t){this.PopupDismissal==document.onclick&&this.CancelPopupDismissal(this.dismissalCallback),this.dismissalCallback=t,this.popupElement=e,this.lastDismissalCallback=document.onclick,document.onclick=this.PopupDismissal},n.prototype.CancelPopupDismissal=function(e){this.PopupDismissal==document.onclick&&(document.onclick=this.lastDismissalCallback,this.lastDismissalCallback=null,this.dismissalCallback=null,this.popupElement=null)},n.prototype.loadCookie=function(){var e="",t=b.loadCookie("KeymanWeb_Keyboard");t.current!=null&&(e=t.current.split(":")[0]);var o=b.loadCookie("KeymanWeb_Toolbar");if(o.region!=null&&(this.selectedRegion=o.region),o.maxrecent!=null){for(var s=0;s<o.maxrecent;s++)if(o["recent".concat(s)]!=null){var r=o["recent".concat(s)].split(",");if(r.length==2){var i=this.languages[r[0]];if(i!=null){for(var a=0;a<i.keyboards.length;a++)if(i.keyboards[a].InternalName==r[1]){if(this.addKeyboardToList(i,i.keyboards[a]),i.keyboards[a].InternalName==e){this.selectKeyboard(null,i,i.keyboards[a],!0),window.focus(),this.setLastFocus();break}break}}}}}else{var h=u.getActiveKeyboard(),l=u.getActiveLanguage();if(l!=""&&h!=""){var d=this.languages[l];if(d!=null)for(var a=0;a<d.keyboards.length;a++)d.keyboards[a].InternalName==h&&(this.selectKeyboard(null,d,d.keyboards[a],!0),window.focus(),this.setLastFocus())}}},n.prototype.saveCookie=function(){var e={region:this.selectedRegion,maxrecent:this.listedKeyboards.length};e.region=this.selectedRegion,e.maxrecent=this.listedKeyboards.length;for(var t=0;t<this.listedKeyboards.length;t++)e["recent".concat(t)]=this.listedKeyboards[t].lang.id+","+this.listedKeyboards[t].keyboard.InternalName;b.saveCookie("KeymanWeb_Toolbar",e)},n}(),v=u.ui=new R,u.addEventListener("keyboardregistered",v.registerKeyboard),u.addEventListener("controlfocused",v.focusControlEvent),u.addEventListener("controlblurred",v.blurControlEvent),u.addEventListener("keyboardchange",v.changeKeyboardEvent),v.initialize()}catch(n){}var u,b,R,v;})();
//# sourceMappingURL=kmwuitoolbar.js.map
