(function(){var f=window.tavultesoft.keymanweb,j=f.osk,g=f.util;if(!g.isTouchDevice()){var a=f.ui={name:"toggle",initialized:!1,shim:null,controller:null,oskButton:null,kbdButton:null,controllerHovered:!1,keyboards:[],lastActiveKeyboard:-1,selectedMenuItem:null,updateList:!0,updateTimer:null};a.doFocus=function(b,c){if(a.initialized){window.event&&(b=window.event.srcElement);c?a.controller.style.display="block":!f.getUIState().activationPending&&!a.controllerHovered&&(a.controller.style.display="none");
var d,e,h,i;e=g.getAbsolute(b);d=e.x;e=e.y;b.parentWindow&&b.parentWindow.frameElement?(h=b.parentWindow.frameElement.clientWidth,i=b.parentWindow.frameElement.clientHeight):b.defaultView&&b.defaultView.frameElement?(h=b.defaultView.frameElement.clientWidth,i=b.defaultView.frameElement.clientHeight):(h=b.offsetWidth,i=b.offsetHeight);d+h>(window.clientWidth?window.clientWidth:window.innerWidth)+document.documentElement.scrollLeft-a.controller.offsetWidth-1?e+=i:(d+=h+2,e+=i-29);!isNaN(d)&&!isNaN(e)&&
(a.controller.style.left=d+"px",a.controller.style.top=e+"px",f.iOS&&j.show(!0))}};f.addEventListener("controlfocused",function(b){a.doFocus(b.target,!0)});f.addEventListener("controlblurred",function(b){a.doFocus(b.target,!1)});j.addEventListener("show",function(b){a.controller.style.display="block";a.oskButton._setSelected(!0);if(j.userLocated())return b;var c=f.getLastActiveElement(),d,e;if(null!=c){e=g.getAbsolute(c);d=e.x;e=e.y;var c=c.parentWindow&&c.parentWindow.frameElement?c.parentWindow.frameElement.clientHeight:
c.defaultView&&c.defaultView.frameElement?c.defaultView.frameElement.clientHeight:c.offsetHeight,h=j.getRect();d+=32;e=e+c+(h.height-h.top)>(window.clientHeight?window.clientHeight:window.innerHeight)+document.documentElement.scrollTop&&e-(h.height-h.top)>=document.documentElement.scrollTop?e-(h.height-h.top):e+c}else d=a.controller.offsetLeft,e=a.controller.offsetTop+a.controller.offsetHeight;b.x=d;b.y=e;return b});j.addEventListener("hide",function(b){b&&a.oskButton._setSelected(!1)});a.switchOsk=
function(){""==f.getActiveKeyboard()||f.isCJK()||j.show(!j.isEnabled())};a.switchSingleKbd=function(){var b=""==f.getActiveKeyboard(),c=0,d="",e="";if(b){if(0==a.keyboards.length)return;a.lastActiveKeyboard<a.keyboards.length&&0<=a.lastActiveKeyboard&&(c=a.lastActiveKeyboard);d=a.keyboards[c]._InternalName;e=a.keyboards[c]._LanguageCode;f.setActiveKeyboard(d,e);a.lastActiveKeyboard=c}else f.setActiveKeyboard("");a.kbdButton&&a.kbdButton._setSelected(b)};a.switchNextKbd=function(){var b=""==f.getActiveKeyboard(),
c="",d="";if(b){if(0==a.keyboards.length)return;c=a.keyboards[0]._InternalName;d=a.keyboards[0]._LanguageCode;f.setActiveKeyboard(c,d);a.lastActiveKeyboard=0}else a.lastActiveKeyboard==a.keyboards.length-1?(f.setActiveKeyboard(""),b=!1):(c=a.keyboards[++a.lastActiveKeyboard]._InternalName,d=a.keyboards[a.lastActiveKeyboard]._LanguageCode,f.setActiveKeyboard(c,d),b=!0);a.kbdButton&&a.kbdButton._setSelected(b)};a.button=function(b,c,d){this._elem=this._onmouseout=this._onmouseover=this._onclick=null;
this._over=this._down=!1;this._selected=d;this.getElem=function(){return this._owningObject._elem};this.__updatestyle=function(){var a=this._owningObject._elem.style;this._owningObject._over?(a.margin="0px",this._owningObject._selected?(a.border="solid 1px #ad4a28",a.background="#dfb4b4"):(a.border="solid 1px #dfb4b4",a.background="#f3e5de")):this._owningObject._selected?(a.background="#f3e5de",a.margin="0px",a.border="solid 1px #ad4a28"):(a.background="none",a.margin="1px",a.border="none")};this.__mouseover=
function(){a.controllerHovered=!0;this._owningObject._over=!0;null!=this._owningObject._onmouseover&&this._owningObject._onmouseover();this._owningObject.__updatestyle()};this.__mouseout=function(){a.controllerHovered=!1;this._owningObject._over=!1;null!=this._owningObject._onmouseout&&this._owningObject._onmouseout();this._owningObject.__updatestyle()};this.__click=function(){f.activatingUI(!1);return null!=this._owningObject._onclick?this._owningObject._onclick():!1};this.__mousedown=function(){f.activatingUI(!0);
this._owningObject._down=!0;this._owningObject.__updatestyle();return!1};this.__mouseup=function(){this._owningObject._down=!1;this._owningObject.__updatestyle()};this._setSelected=function(a){f.activatingUI(!1);this._owningObject._selected=a;this._owningObject.__updatestyle()};this._getSelected=function(){return this._owningObject._selected};this._getOver=function(){return this._owningObject._over};this._getDown=function(){return this._owningObject._down};this._owningObject=this;var d=g.getOption("resources")+
"ui/toggle/",e=g.createElement("img");this._elem=g.createElement("div");this._elem._owningObject=this;e.style.display="block";e.src=d+b;e.id="KMW_Controller_Img";this._elem.style.margin="0px";this._elem.style.width="24px";this._elem.style.height="24px";this._elem.style.zIndex="10002";this._elem.style.lineHeight="100%";this._elem.style.styleFloat=this._elem.style.cssFloat="left";e.title=c;e.alt=c;this._elem.appendChild(e);this._elem.onmouseover=this.__mouseover;this._elem.onmouseout=this.__mouseout;
this._elem.onmousedown=this.__mousedown;this._elem.onmouseup=this.__mouseup;e._owningObject=this;e.onclick=this.__click;this.__updatestyle();return this};a.initialize=a.Initialize=function(){if(f.initialized&&!g.isTouchDevice()){a.initialized?a.controller.innerHTML="":a.controller=g.createElement("div");var b=g.getOption("resources")+"ui/toggle/";a.controller.style.background="url("+b+"kmwcontroller2x.gif)";a.controller.style.padding="1px 2px";var b=g.loadCookie("KeymanWeb_Keyboard"),c=!1;"undefined"!=
typeof b.current&&(c=0<b.current.length);a.kbdButton=new a.button("kmw_logo_16.gif","Use Web Keyboard",c);a.controller.appendChild(a.kbdButton.getElem());b=g.loadCookie("KeymanWeb_OnScreenKeyboard");c=1;"undefined"!=typeof b.visible&&(c=b.visible);a.oskButton=new a.button("kmw_osk_16.gif","Show On Screen Keyboard",c);a.oskButton._onclick=a.switchOsk;a.controller.appendChild(a.oskButton.getElem());a.controller.style.display="none";a.controller.style.zIndex="10001";a.controller.style.position="absolute";
a.initialized||document.body.appendChild(a.controller);a.initialized=!0;a.updateKeyboardList()}};a.updateKeyboardList=function(){if(f.initialized||a.initialized){a.updateList=!1;var b=f.getKeyboards(),c=g.getOption("resources")+"ui/toggle/";if(1<b.length){var d=document.getElementById("KMW_Controller_Img");d.src=c+"kmw_logo_16_down.gif";d.style.width="100%";a.controller.style.background="url("+c+"kmwcontroller2x.gif)";a.kbdButton.getElem().id="kmwico";a.kbdButton.getElem().style.width="36px";a.kbdButton._onmouseover=
function(){a.keyboardMenu.className="sfhover";if(a.shim){var b=a.shim.style;b.left=a.keyboardMenu.style.left;b.top=a.keyboardMenu.style.top;b.width=a.keyboardMenu.offsetWidth+"px";b.height=a.keyboardMenu.offsetHeight+"px";b.zIndex=a.keyboardMenu.style.zIndex-1;b.display="block"}};a.kbdButton._onmouseout=function(){a.keyboardMenu.className="sfunhover";a.shim&&(a.shim.style.display="none")};a.kbdButton._onclick=null;a.createMenu()}else 1==b.length&&(d=b[0].InternalName,b=b[0].LanguageCode,a.controller.style.background=
"url("+c+"kmwcontroller2.gif)",a.keyboards.push({_InternalName:d,_LanguageCode:b,_Index:0}),a.kbdButton._onclick=a.switchSingleKbd);c=f.getSavedKeyboard().split(":");a.updateMenu(c[0],c[1])}};f.addEventListener("keyboardregistered",function(){a.updateList=!0;a.updateTimer&&clearTimeout(a.updateTimer);a.updateTimer=setTimeout(a.updateKeyboardList,200)});f.addEventListener("keyboardchange",function(b){a.updateMenu(b.internalName,b.languageCode)});a.selectKbd=function(b){var c,d;0>b?d=c="":(c=a.keyboards[b]._InternalName,
d=a.keyboards[b]._LanguageCode);f.setActiveKeyboard(c,d);f.focusLastActiveElement();a.kbdButton._setSelected(""!=c);0<=b&&(a.lastActiveKeyboard=b);return!1};a.updateMenu=function(b,c){var d,e=document.getElementById("KMWSel_$");for(d=0;d<a.keyboards.length;d++)a.keyboards[d]._InternalName==b&&a.keyboards[d]._LanguageCode==c&&(e=document.getElementById("KMWSel_"+a.keyboards[d]._InternalName+"$"+a.keyboards[d]._Index));e&&(null!=a.selectedMenuItem&&(a.selectedMenuItem.className=""),e.className="selected",
a.selectedMenuItem=e);"cmn"==c||"jpn"==c||"kor"==c?a.oskButton.getElem().style.display="none":""==b?a.oskButton.getElem().style.display="none":a.oskButton.getElem().style.display="block"};g.addStyleSheet("#KeymanWeb_KbdList {display: block;position: absolute;width: auto;"+(8>g.getIEVersion()?"200px;":"auto;")+"line-height: 100%;margin: 0;clear: both;float: none;top: auto;border: solid 2px #ad4a28;-moz-border-radius: 4px;-webkit-border-radius: 4px;border-radius: 4px;box-shadow: 4px 4px 2px rgba(136,136,136,.5);-webkit-box-shadow: 4px 4px 2px rgba(136,136,136,.5);-moz-box-shadow: 4px 4px 2px rgba(136,136,136,.5);"+
(99>g.getIEVersion()?"filter:progid:DXImageTransform.Microsoft.DropShadow(OffX=4,OffY=4,Color=#80646464);":"")+"list-style: none;padding: 0;background: white;max-height: 300px;overflow-y: scroll;overflow-x: hidden;white-space: nowrap;z-index: 10001; /* above the osk */}"+(7>g.getIEVersion()?"* html #KeymanWeb_KbdList {height: expression(this.scrollHeight > 299 ? '300px' : 'auto');}":"")+".sfunhover#KeymanWeb_KbdList {display: none; left: -999px;}.sfhover#KeymanWeb_KbdList {display: block;left: auto;}#KeymanWeb_KbdList li {float: none;width: auto;padding: 0;margin: 0;text-align: left;}#KeymanWeb_KbdList li a {display: block; padding: 2px 4px;color: #404040;font-family: Tahoma,Verdana,Arial,sans-serif;font-size: 8pt;text-decoration: none;}#KeymanWeb_KbdList li a.selected {font-weight: bold;color: black;}#KeymanWeb_KbdList li a:hover {color: white;background-color: #ad4a28;text-decoration: underline;}");
a.createMenu=function(){"undefined"==typeof a.keyboardMenu?(window.createPopup&&!("XmlHttpRequest"in window)&&(a.shim=g.createElement("iframe"),a.shim.src="",a.shim.style.display="none",a.shim.style.position="absolute",a.shim.style.filter="progidXImageTransform.Microsoft.Alpha(style=0,opacity=0)",a.shim.frameBorder="0",a.shim.scrolling="no",a.kbdButton.getElem().appendChild(a.shim)),a.keyboardMenu=g.createElement("ul"),a.keyboardMenu.id="KeymanWeb_KbdList",a.keyboardMenu.className="sfunhover"):a.keyboardMenu.innerHTML=
"";var b=g.createElement("li"),c=g.createElement("a");c.innerHTML="English";c.href="#";c.onclick=function(){return a.selectKbd(-1)};c.id="KMWSel_$";c.className="selected";b.appendChild(c);a.selectedMenuItem=c;a.keyboardMenu.appendChild(b);b=f.getKeyboards();c=[];a.keyboards=[];for(var d=0;d<b.length;d++){var e=g.createElement("li"),h=g.createElement("a");h.innerHTML=b[d].LanguageName+" - "+b[d].Name;c[b[d].InternalName]||(c[b[d].InternalName]=0);c[b[d].InternalName]++;var i=c[b[d].InternalName];a.keyboards.push({_InternalName:b[d].InternalName,
_LanguageCode:b[d].LanguageCode,_Index:i});h.href="#";h.onclick=function(b){return function(){return a.selectKbd(b)}}(a.keyboards.length-1);h.id="KMWSel_"+b[d].InternalName+"$"+i;e.appendChild(h);a.keyboardMenu.appendChild(e)}a.keyboardMenu.parentNode!=a.kbdButton.getElem()&&a.kbdButton.getElem().appendChild(a.keyboardMenu)};f.addHotKey(191,32,a.switchSingleKbd);f.addHotKey(191,48,a.switchNextKbd);f.addHotKey(191,64,a.switchOsk);f.addEventListener("loaduserinterface",a.Initialize);a.Initialize()}})();
