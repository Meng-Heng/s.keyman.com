(function(){var Hi=Object.create;var on=Object.defineProperty;var ki=Object.getOwnPropertyDescriptor;var Ni=Object.getOwnPropertyNames;var Ti=Object.getPrototypeOf,Ei=Object.prototype.hasOwnProperty;var mr=function(c,e){return function(){return e||c((e={exports:{}}).exports,e),e.exports}},xr=function(c,e){for(var t in e)on(c,t,{get:e[t],enumerable:!0})},cn=function(c,e,t,n){if(e&&typeof e=="object"||typeof e=="function")for(var r=Ni(e),i=0,o=r.length,l;i<o;i++)l=r[i],!Ei.call(c,l)&&l!==t&&on(c,l,{get:function(a){return e[a]}.bind(null,l),enumerable:!(n=ki(e,l))||n.enumerable});return c},ln=function(c,e,t){return cn(c,e,"default"),t&&cn(t,e,"default")},an=function(c,e,t){return t=c!=null?Hi(Ti(c)):{},cn(e||!c||!c.__esModule?on(t,"default",{value:c,enumerable:!0}):t,c)};var Bn=mr(function(Ua,Ze){var Xr,Vr,Zr,vr,fr,Ve,sn,Jr,Wr,ce,Sr,Lr;(function(c){var e=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(n){c(t(e,t(n)))}):typeof Ze=="object"&&typeof Ze.exports=="object"?c(t(e,t(Ze.exports))):c(t(e));function t(n,r){return n!==e&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(i,o){return n[i]=r?r(i,o):o}}})(function(c){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])};Xr=function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)},Vr=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},Zr=function(t,n,r,i){var o=arguments.length,l=o<3?n:i===null?i=Object.getOwnPropertyDescriptor(n,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,n,r,i);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(l=(o<3?a(l):o>3?a(n,r,l):a(n,r))||l);return o>3&&l&&Object.defineProperty(n,r,l),l},vr=function(t,n,r,i){function o(l){return l instanceof r?l:new r(function(a){a(l)})}return new(r||(r=Promise))(function(l,a){function s(u){try{g(i.next(u))}catch(F){a(F)}}function B(u){try{g(i.throw(u))}catch(F){a(F)}}function g(u){u.done?l(u.value):o(u.value).then(s,B)}g((i=i.apply(t,n||[])).next())})},fr=function(t,n){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},i,o,l,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(g){return function(u){return B([g,u])}}function B(g){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,g[0]&&(r=0)),r;)try{if(i=1,o&&(l=g[0]&2?o.return:g[0]?o.throw||((l=o.return)&&l.call(o),0):o.next)&&!(l=l.call(o,g[1])).done)return l;switch(o=0,l&&(g=[g[0]&2,l.value]),g[0]){case 0:case 1:l=g;break;case 4:return r.label++,{value:g[1],done:!1};case 5:r.label++,o=g[1],g=[0];continue;case 7:g=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(g[0]===6||g[0]===2)){r=0;continue}if(g[0]===3&&(!l||g[1]>l[0]&&g[1]<l[3])){r.label=g[1];break}if(g[0]===6&&r.label<l[1]){r.label=l[1],l=g;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(g);break}l[2]&&r.ops.pop(),r.trys.pop();continue}g=n.call(t,r)}catch(u){g=[6,u],o=0}finally{i=l=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},Ve=function(t){var n=typeof Symbol=="function"&&Symbol.iterator,r=n&&t[n],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},sn=function(t,n){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),o,l=[],a;try{for(;(n===void 0||n-- >0)&&!(o=i.next()).done;)l.push(o.value)}catch(s){a={error:s}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return l},Jr=function(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(sn(arguments[n]));return t},Wr=function(t,n,r){if(r||arguments.length===2)for(var i=0,o=n.length,l;i<o;i++)(l||!(i in n))&&(l||(l=Array.prototype.slice.call(n,0,i)),l[i]=n[i]);return t.concat(l||Array.prototype.slice.call(n))},ce=function(t){return this instanceof ce?(this.v=t,this):new ce(t)},Sr=function(t,n,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,n||[]),o,l=[];return o={},a("next"),a("throw"),a("return"),o[Symbol.asyncIterator]=function(){return this},o;function a(y){i[y]&&(o[y]=function(I){return new Promise(function(Q,U){l.push([y,I,Q,U])>1||s(y,I)})})}function s(y,I){try{B(i[y](I))}catch(Q){F(l[0][3],Q)}}function B(y){y.value instanceof ce?Promise.resolve(y.value.v).then(g,u):F(l[0][2],y)}function g(y){s("next",y)}function u(y){s("throw",y)}function F(y,I){y(I),l.shift(),l.length&&s(l[0][0],l[0][1])}},Lr=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t[Symbol.asyncIterator],r;return n?n.call(t):(t=typeof Ve=="function"?Ve(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(l){r[l]=t[l]&&function(a){return new Promise(function(s,B){a=t[l](a),o(s,B,a.done,a.value)})}}function o(l,a,s,B){Promise.resolve(B).then(function(g){l({value:g,done:s})},a)}},c("__extends",Xr),c("__assign",Vr),c("__decorate",Zr),c("__awaiter",vr),c("__generator",fr),c("__values",Ve),c("__read",sn),c("__spread",Jr),c("__spreadArray",Wr),c("__await",ce),c("__asyncGenerator",Sr),c("__asyncValues",Lr)})});var Hr=mr(function(ba,dn){"use strict";var Oi=Object.prototype.hasOwnProperty,K="~";function ie(){}Object.create&&(ie.prototype=Object.create(null),new ie().__proto__||(K=!1));function Yi(c,e,t){this.fn=c,this.context=e,this.once=t||!1}function Ar(c,e,t,n,r){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new Yi(t,n||c,r),o=K?K+e:e;return c._events[o]?c._events[o].fn?c._events[o]=[c._events[o],i]:c._events[o].push(i):(c._events[o]=i,c._eventsCount++),c}function ve(c,e){--c._eventsCount===0?c._events=new ie:delete c._events[e]}function z(){this._events=new ie,this._eventsCount=0}z.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)Oi.call(t,n)&&e.push(K?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};z.prototype.listeners=function(e){var t=K?K+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,o=new Array(i);r<i;r++)o[r]=n[r].fn;return o};z.prototype.listenerCount=function(e){var t=K?K+e:e,n=this._events[t];return n?n.fn?1:n.length:0};z.prototype.emit=function(e,t,n,r,i,o){var l=K?K+e:e;if(!this._events[l])return!1;var a=this._events[l],s=arguments.length,B,g;if(a.fn){switch(a.once&&this.removeListener(e,a.fn,void 0,!0),s){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,t),!0;case 3:return a.fn.call(a.context,t,n),!0;case 4:return a.fn.call(a.context,t,n,r),!0;case 5:return a.fn.call(a.context,t,n,r,i),!0;case 6:return a.fn.call(a.context,t,n,r,i,o),!0}for(g=1,B=new Array(s-1);g<s;g++)B[g-1]=arguments[g];a.fn.apply(a.context,B)}else{var u=a.length,F;for(g=0;g<u;g++)switch(a[g].once&&this.removeListener(e,a[g].fn,void 0,!0),s){case 1:a[g].fn.call(a[g].context);break;case 2:a[g].fn.call(a[g].context,t);break;case 3:a[g].fn.call(a[g].context,t,n);break;case 4:a[g].fn.call(a[g].context,t,n,r);break;default:if(!B)for(F=1,B=new Array(s-1);F<s;F++)B[F-1]=arguments[F];a[g].fn.apply(a[g].context,B)}}return!0};z.prototype.on=function(e,t,n){return Ar(this,e,t,n,!1)};z.prototype.once=function(e,t,n){return Ar(this,e,t,n,!0)};z.prototype.removeListener=function(e,t,n,r){var i=K?K+e:e;if(!this._events[i])return this;if(!t)return ve(this,i),this;var o=this._events[i];if(o.fn)o.fn===t&&(!r||o.once)&&(!n||o.context===n)&&ve(this,i);else{for(var l=0,a=[],s=o.length;l<s;l++)(o[l].fn!==t||r&&!o[l].once||n&&o[l].context!==n)&&a.push(o[l]);a.length?this._events[i]=a.length===1?a[0]:a:ve(this,i)}return this};z.prototype.removeAllListeners=function(e){var t;return e?(t=K?K+e:e,this._events[t]&&ve(this,t)):(this._events=new ie,this._eventsCount=0),this};z.prototype.off=z.prototype.removeListener;z.prototype.addListener=z.prototype.on;z.prefixed=K;z.EventEmitter=z;typeof dn!="undefined"&&(dn.exports=z)});var d={};xr(d,{tslib:function(){return Rr}});ln(d,an(Bn(),1));var Rr=an(Bn(),1);var v=an(Hr(),1);var st={modifierCodes:{LCTRL:1,RCTRL:2,LALT:4,RALT:8,SHIFT:16,CTRL:32,ALT:64,META:128,CAPS:256,NO_CAPS:512,NUM_LOCK:1024,NO_NUM_LOCK:2048,SCROLL_LOCK:4096,NO_SCROLL_LOCK:8192,VIRTUAL_KEY:16384,VIRTUAL_CHAR_KEY:32768},modifierBitmasks:{ALL:127,ALT_GR_SIM:5,CHIRAL:31,IS_CHIRAL:15,NON_CHIRAL:112,NON_LEGACY:111},stateBitmasks:{ALL:16128,CAPS:768,NUM_LOCK:3072,SCROLL_LOCK:12288},keyCodes:{K_BKSP:8,K_TAB:9,K_ENTER:13,K_SHIFT:16,K_CONTROL:17,K_ALT:18,K_PAUSE:19,K_CAPS:20,K_ESC:27,K_SPACE:32,K_PGUP:33,K_PGDN:34,K_END:35,K_HOME:36,K_LEFT:37,K_UP:38,K_RIGHT:39,K_DOWN:40,K_SEL:41,K_PRINT:42,K_EXEC:43,K_INS:45,K_DEL:46,K_HELP:47,K_0:48,K_1:49,K_2:50,K_3:51,K_4:52,K_5:53,K_6:54,K_7:55,K_8:56,K_9:57,K_A:65,K_B:66,K_C:67,K_D:68,K_E:69,K_F:70,K_G:71,K_H:72,K_I:73,K_J:74,K_K:75,K_L:76,K_M:77,K_N:78,K_O:79,K_P:80,K_Q:81,K_R:82,K_S:83,K_T:84,K_U:85,K_V:86,K_W:87,K_X:88,K_Y:89,K_Z:90,K_NP0:96,K_NP1:97,K_NP2:98,K_NP3:99,K_NP4:100,K_NP5:101,K_NP6:102,K_NP7:103,K_NP8:104,K_NP9:105,K_NPSTAR:106,K_NPPLUS:107,K_SEPARATOR:108,K_NPMINUS:109,K_NPDOT:110,K_NPSLASH:111,K_F1:112,K_F2:113,K_F3:114,K_F4:115,K_F5:116,K_F6:117,K_F7:118,K_F8:119,K_F9:120,K_F10:121,K_F11:122,K_F12:123,K_NUMLOCK:144,K_SCROLL:145,K_LSHIFT:160,K_RSHIFT:161,K_LCONTROL:162,K_RCONTROL:163,K_LALT:164,K_RALT:165,K_COLON:186,K_EQUAL:187,K_COMMA:188,K_HYPHEN:189,K_PERIOD:190,K_SLASH:191,K_BKQUOTE:192,K_LBRKT:219,K_BKSLASH:220,K_RBRKT:221,K_QUOTE:222,K_oE2:226,K_OE2:226,K_LOPT:50001,K_ROPT:50002,K_NUMERALS:50003,K_SYMBOLS:50004,K_CURRENCIES:50005,K_UPPER:50006,K_LOWER:50007,K_ALPHA:50008,K_SHIFTED:50009,K_ALTGR:50010,K_TABBACK:50011,K_TABFWD:50012},codesUS:[["0123456789",";=,-./`","[\\]'"],[")!@#$%^&*(",":+<_>?~",'{|}"']],isFrameKey:function(c){switch(c){case"K_SHIFT":case"K_LOPT":case"K_ROPT":case"K_NUMLOCK":case"K_CAPS":return!0;default:if(st.keyCodes[c]>=5e4)return!0}return!1},getModifierState:function(c){var e=0;c.indexOf("shift")>=0&&(e|=st.modifierCodes.SHIFT);var t=!1;c.indexOf("leftctrl")>=0&&(e|=st.modifierCodes.LCTRL,t=!0),c.indexOf("rightctrl")>=0&&(e|=st.modifierCodes.RCTRL,t=!0),c.indexOf("ctrl")>=0&&!t&&(e|=st.modifierCodes.CTRL);var n=!1;return c.indexOf("leftalt")>=0&&(e|=st.modifierCodes.LALT,n=!0),c.indexOf("rightalt")>=0&&(e|=st.modifierCodes.RALT,n=!0),c.indexOf("alt")>=0&&!n&&(e|=st.modifierCodes.ALT),e},getStateFromLayer:function(c){var e=0;return c.indexOf("caps")>=0?e|=st.modifierCodes.CAPS:e|=st.modifierCodes.NO_CAPS,e}},C=st;var Wt;(function(c){c.Enter="\n",c.Backspace="\b"})(Wt||(Wt={}));var wi=function(){function c(){}return c.prototype.codeForEvent=function(e){return C.keyCodes[e.kName]||e.Lcode},c.prototype.forAny=function(e,t,n){var r="";if((r=this.forSpecialEmulation(e))!=null)return r;if(!t&&(r=this.forNumpadKeys(e))!=null)return r;if((r=this.forUnicodeKeynames(e,n))!=null)return r;if((r=this.forBaseKeys(e,n))!=null)return r;var i=this.codeForEvent(e);switch(i){default:return null}},c.prototype.isCommand=function(e){var t=this.codeForEvent(e);switch(t){default:return!1}},c.prototype.applyCommand=function(e,t){},c.prototype.forSpecialEmulation=function(e){var t=this.codeForEvent(e);switch(t){case C.keyCodes.K_BKSP:return Wt.Backspace;case C.keyCodes.K_ENTER:return Wt.Enter;default:return null}},c.prototype.forNumpadKeys=function(e){if(e.Lcode>=C.keyCodes.K_NP0&&e.Lcode<=C.keyCodes.K_NPSLASH){if(e.Lcode<106)var t=e.Lcode-48;else t=e.Lcode-64;var n=String._kmwFromCharCode(t);return n}else return null},c.prototype.forUnicodeKeynames=function(e,t){var n=e.kName;if(!n||n.substr(0,2)!="U_")return null;for(var r="",i=n.substr(2).split("_"),o=0,l=i;o<l.length;o++){var a=l[o],s=parseInt(a,16);if(0<=s&&s<=31||128<=s&&s<=159||isNaN(s)){t&&(t.errorLog="Suppressing Unicode control code in "+n);continue}else r+=String.kmwFromCharCode(s)}return r||null},c.prototype.forBaseKeys=function(e,t){var n=e.Lcode,r=e.Lmodifiers;if(r==C.modifierCodes.SHIFT)r=1;else if(r!=0)return t&&(t.warningLog="KMW only defines default key output for the 'default' and 'shift' layers!"),null;try{if(n==C.keyCodes.K_SPACE)return" ";if(n>=C.keyCodes.K_0&&n<=C.keyCodes.K_9)return C.codesUS[r][0][n-C.keyCodes.K_0];if(n>=C.keyCodes.K_A&&n<=C.keyCodes.K_Z)return String.fromCharCode(n+(r?0:32));if(n>=C.keyCodes.K_COLON&&n<=C.keyCodes.K_BKQUOTE)return C.codesUS[r][1][n-C.keyCodes.K_COLON];if(n>=C.keyCodes.K_LBRKT&&n<=C.keyCodes.K_QUOTE)return C.codesUS[r][2][n-C.keyCodes.K_LBRKT];if(n==C.keyCodes.K_oE2)return r?"|":"\\"}catch(i){t&&(t.errorLog="Error detected with default mapping for key:  code = "+n+", shift state = "+(r==1?"shift":"default"))}return null},c}(),Tt=wi;var zi=new Tt,Mi=function(){function c(e){this.isSynthetic=!0;for(var t in e)e[t]!==void 0&&(this[t]=e[t])}return c.constructNullKeyEvent=function(e){var t=new c({Lcode:0,kName:"",device:e,Lstates:void 0,Lmodifiers:void 0,vkCode:void 0,LisVirtualKey:void 0});return t},Object.defineProperty(c.prototype,"isModifier",{get:function(){switch(this.Lcode){case 16:case 17:case 18:case 20:case 144:case 145:return!0;default:return!1}},enumerable:!1,configurable:!0}),c.prototype.setMnemonicCode=function(e,t){if(this.Lcode!=C.keyCodes.K_SPACE){var n=new c(this);for(var r in this)n[r]=this[r];n.kName="K_xxxx",n.Lmodifiers=e?16:0;var i=zi.forAny(n,!0);this.vkCode=this.Lcode,i?this.Lcode=i.charCodeAt(0):this.isModifier||delete this.Lcode}t&&(this.Lcode>=65&&this.Lcode<=90||this.Lcode>=97&&this.Lcode<=122)&&(this.Lmodifiers^=16,this.Lcode^=32)},c}(),Bt=Mi;var Et=function(){function c(){}return c}(),Di=function(){function c(){this.FF=new Et,this.Safari=new Et,this.Opera=new Et,this.FF.k61=187,this.FF.k59=186,this.FF.k173=189}return c}(),Pi=function(){function c(){this.se=new Et,this.se.k220=192,this.se.k187=189,this.se.k219=187,this.se.k221=219,this.se.k186=221,this.se.k191=220,this.se.k192=186,this.se.k189=191,this.uk=new Et,this.uk.k223=192,this.uk.k192=222,this.uk.k222=226,this.uk.k220=220}return c}(),Ki=function(){function c(){}return c._usCodeInit=function(){var e=new Et,t=new Et;e.k192=96,e.k49=49,e.k50=50,e.k51=51,e.k52=52,e.k53=53,e.k54=54,e.k55=55,e.k56=56,e.k57=57,e.k48=48,e.k189=45,e.k187=61,e.k81=113,e.k87=119,e.k69=101,e.k82=114,e.k84=116,e.k89=121,e.k85=117,e.k73=105,e.k79=111,e.k80=112,e.k219=91,e.k221=93,e.k220=92,e.k65=97,e.k83=115,e.k68=100,e.k70=102,e.k71=103,e.k72=104,e.k74=106,e.k75=107,e.k76=108,e.k186=59,e.k222=39,e.k90=122,e.k88=120,e.k67=99,e.k86=118,e.k66=98,e.k78=110,e.k77=109,e.k188=44,e.k190=46,e.k191=47,t.k192=126,t.k49=33,t.k50=64,t.k51=35,t.k52=36,t.k53=37,t.k54=94,t.k55=38,t.k56=42,t.k57=40,t.k48=41,t.k189=95,t.k187=43,t.k81=81,t.k87=87,t.k69=69,t.k82=82,t.k84=84,t.k89=89,t.k85=85,t.k73=73,t.k79=79,t.k80=80,t.k219=123,t.k221=125,t.k220=124,t.k65=65,t.k83=83,t.k68=68,t.k70=70,t.k71=71,t.k72=72,t.k74=74,t.k75=75,t.k76=76,t.k186=58,t.k222=34,t.k90=90,t.k88=88,t.k67=67,t.k86=86,t.k66=66,t.k78=78,t.k77=77,t.k188=60,t.k190=62,t.k191=63,c._usCharCodes=[e,t]},c._USKeyCodeToCharCode=function(e){return c.usCharCodes[e.Lmodifiers&16?1:0]["k"+e.Lcode]},Object.defineProperty(c,"usCharCodes",{get:function(){return c._usCharCodes||c._usCodeInit(),c._usCharCodes},enumerable:!1,configurable:!0}),c.browserMap=new Di,c.languageMap=new Pi,c}(),dt=Ki;function q(c){if(typeof c!="object"||!c)return c;for(var e=Array.isArray(c)?[]:{},t=Object.keys(c),n=0,r=t;n<r.length;n++){var i=r[n];c[i]!==void 0&&(e[i]=q(c[i]))}return e}var oe=function(){function c(e,t,n,r){switch(e.toLowerCase()){case c.Browser.Chrome:case c.Browser.Edge:case c.Browser.Firefox:case c.Browser.Native:case c.Browser.Opera:case c.Browser.Safari:this.browser=e.toLowerCase();break;default:this.browser=c.Browser.Other}switch(t.toLowerCase()){case c.FormFactor.Desktop:case c.FormFactor.Phone:case c.FormFactor.Tablet:this.formFactor=t.toLowerCase();break;default:throw"Invalid form factor specified for device: "+t}switch(n.toLowerCase()){case c.OperatingSystem.Windows.toLowerCase():case c.OperatingSystem.macOS.toLowerCase():case c.OperatingSystem.Linux.toLowerCase():case c.OperatingSystem.Android.toLowerCase():case c.OperatingSystem.iOS.toLowerCase():this.OS=n.toLowerCase();break;default:this.OS=c.OperatingSystem.Other}this.touchable=r}return c}();(function(c){var e;(function(r){r.Chrome="chrome",r.Edge="edge",r.Firefox="firefox",r.Native="native",r.Opera="opera",r.Safari="safari",r.Other="other"})(e=c.Browser||(c.Browser={}));var t;(function(r){r.Windows="windows",r.macOS="macosx",r.Linux="linux",r.Android="android",r.iOS="ios",r.Other="other"})(t=c.OperatingSystem||(c.OperatingSystem={}));var n;(function(r){r.Desktop="desktop",r.Phone="phone",r.Tablet="tablet"})(n=c.FormFactor||(c.FormFactor={}))})(oe||(oe={}));function gn(c){return new oe(c.browser,oe.FormFactor.Desktop,c.OS,!1)}var f=oe;var un=function(){function c(){}return c.VERSION="18.0.65",c.VERSION_RELEASE="18.0",c.VERSION_MAJOR="18",c.VERSION_MINOR="0",c.VERSION_PATCH="65",c.TIER="alpha",c.VERSION_TAG="-alpha",c.VERSION_WITH_TAG="18.0.65-alpha",c.VERSION_ENVIRONMENT="alpha",c.VERSION_GIT_TAG="release@18.0.65-alpha",c}();var St=un;var ji=function(){function c(e){if(e==null){this.components=[].concat(c.DEVELOPER_VERSION_FALLBACK.components);return}if(Array.isArray(e)){var t=e;if(t.length<2)throw new Error("Version string must have at least a major and minor component!");this.components=[].concat(t);return}var n=e.split("."),r=[];if(n.length<2)throw new Error("Version string must have at least a major and minor component!");for(var i=0;i<n.length;i++){var o=parseInt(n[i],10);if(isNaN(o))throw new Error("Version string components must be numerical!");r.push(o)}this.components=r}return Object.defineProperty(c.prototype,"major",{get:function(){return this.components[0]},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"minor",{get:function(){return this.components[1]},enumerable:!1,configurable:!0}),c.prototype.toString=function(){return this.components.join(".")},c.prototype.toJSON=function(){return this.toString()},c.prototype.equals=function(e){return this.compareTo(e)==0},c.prototype.precedes=function(e){return this.compareTo(e)<0},c.prototype.compareTo=function(e){var t=this.components.length<e.components.length,n=this.components.length<e.components.length?this.components.length:e.components.length,r;for(r=0;r<n;r++){var i=this.components[r]-e.components[r];if(i!=0)return i}var o=t?e.components:this.components;do{if(o[r]>0)return t?-1:1;r++}while(r<o.length);return 0},c.CURRENT=new c(St.VERSION_RELEASE),c.DEVELOPER_VERSION_FALLBACK=new c([9,0,0]),c.NO_DEFAULT_KEYCAPS=new c([12,0]),c.MAC_POSSIBLE_IPAD_ALIAS=new c([10,15]),c}(),$=ji;function Pt(){return typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof self!="undefined"?self:global}function le(){String.kmwFromCharCode=function(c){var e=[],t;for(t=0;t<arguments.length;t++){var n=Number(arguments[t]);if(!isFinite(n)||n<0||n>1114111||Math.floor(n)!==n)throw new RangeError("Invalid code point "+n);n<65536?e.push(n):(n-=65536,e.push((n>>10)+55296),e.push(n%1024+56320))}return String.fromCharCode.apply(void 0,e)},String.prototype.kmwCharCodeAt=function(c){var e=String(this),t=0;if(c<0||c>=e.length)return NaN;for(var n=0;n<c;n++)if(t=e.kmwNextChar(t),t===null)return NaN;var r=e.charCodeAt(t);if(r>=55296&&r<=56319&&e.length>t+1){var i=e.charCodeAt(t+1);if(i>=56320&&i<=57343)return(r-55296<<10)+(i-56320)+65536}return r},String.prototype.kmwIndexOf=function(c,e){var t=String(this),n=t.indexOf(c,e);if(n<0)return n;for(var r=0,i=0;i!==null&&i<n;i=t.kmwNextChar(i))r++;return r},String.prototype.kmwLastIndexOf=function(c,e){var t=String(this),n=t.lastIndexOf(c,e);if(n<0)return n;for(var r=0,i=0;i!==null&&i<n;i=t.kmwNextChar(i))r++;return r},String.prototype.kmwLength=function(){var c=String(this);if(c.length==0)return 0;for(var e=0,t=0;t!==null;e++)t=c.kmwNextChar(t);return e},String.prototype.kmwSlice=function(c,e){var t=String(this),n=t.kmwCodePointToCodeUnit(c),r=t.kmwCodePointToCodeUnit(e);return n===null||r===null?"":t.slice(n,r)},String.prototype.kmwSubstr=function(c,e){var t=String(this);c<0&&(c=t.kmwLength()+c),c<0&&(c=0);var n=t.kmwCodePointToCodeUnit(c),r=n;if(n===null)return"";if(arguments.length<2)r=t.length;else for(var i=0;i<e;i++)r=t.kmwNextChar(r);return r===null?t.substring(n):t.substring(n,r)},String.prototype.kmwSubstring=function(c,e){var t=String(this),n,r;if(typeof e=="undefined")n=t.kmwCodePointToCodeUnit(c),r=t.length;else{if(c>e){var i=c;c=e,e=i}n=t.kmwCodePointToCodeUnit(c),r=t.kmwCodePointToCodeUnit(e)}return(isNaN(n)||n===null)&&(n=0),(isNaN(r)||r===null)&&(r=t.length),t.substring(n,r)},String.prototype.kmwNextChar=function(c){var e=String(this);if(c===null||c<0||c>=e.length-1)return null;var t=e.charCodeAt(c);if(t>=55296&&t<=56319&&e.length>c+1){var n=e.charCodeAt(c+1);if(n>=56320&&n<=57343)return c==e.length-2?null:c+2}return c+1},String.prototype.kmwPrevChar=function(c){var e=String(this);if(c==null||c<=0||c>e.length)return null;var t=e.charCodeAt(c-1);if(t>=56320&&t<=57343&&c>1){var n=e.charCodeAt(c-2);if(n>=55296&&n<=56319)return c-2}return c-1},String.prototype.kmwCodePointToCodeUnit=function(c){if(c===null)return null;var e=String(this),t=0;if(c<0){t=e.length;for(var n=0;n>c;n--)t=e.kmwPrevChar(t);return t}if(c==e.kmwLength())return e.length;for(var n=0;n<c;n++)t=e.kmwNextChar(t);return t},String.prototype.kmwCodeUnitToCodePoint=function(c){var e=String(this);return c===null?null:c==0?0:c<0?e.substr(c).kmwLength():e.substr(0,c).kmwLength()},String.prototype.kmwCharAt=function(c){var e=String(this);return c>=0?e.kmwSubstr(c,1):""},String.prototype.kmwBMPNextChar=function(c){var e=String(this);return c<0||c>=e.length-1?null:c+1},String.prototype.kmwBMPPrevChar=function(c){var e=String(this);return c<=0||c>e.length?null:c-1},String.prototype.kmwBMPCodePointToCodeUnit=function(c){return c},String.prototype.kmwBMPCodeUnitToCodePoint=function(c){return c},String.prototype.kmwBMPLength=function(){var c=String(this);return c.length},String.prototype.kmwBMPSubstr=function(c,e){var t=String(this);return c>-1?t.substr(c,e):t.substr(t.length+c,-c)},String.kmwEnableSupplementaryPlane=function(c){var e=String.prototype;String._kmwFromCharCode=c?String.kmwFromCharCode:String.fromCharCode,e._kmwCharAt=c?e.kmwCharAt:e.charAt,e._kmwCharCodeAt=c?e.kmwCharCodeAt:e.charCodeAt,e._kmwIndexOf=c?e.kmwIndexOf:e.indexOf,e._kmwLastIndexOf=c?e.kmwLastIndexOf:e.lastIndexOf,e._kmwSlice=c?e.kmwSlice:e.slice,e._kmwSubstring=c?e.kmwSubstring:e.substring,e._kmwSubstr=c?e.kmwSubstr:e.kmwBMPSubstr,e._kmwLength=c?e.kmwLength:e.kmwBMPLength,e._kmwNextChar=c?e.kmwNextChar:e.kmwBMPNextChar,e._kmwPrevChar=c?e.kmwPrevChar:e.kmwBMPPrevChar,e._kmwCodePointToCodeUnit=c?e.kmwCodePointToCodeUnit:e.kmwBMPCodePointToCodeUnit,e._kmwCodeUnitToCodePoint=c?e.kmwCodeUnitToCodePoint:e.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}le();var _i=function(){function c(e){var t=this;this._isFulfilled=!1,this._isRejected=!1,this._promise=new Promise(function(n,r){t._resolve=function(i){t._isFulfilled=!0,n(i)},t._reject=function(i){t._isRejected=!0,r(i)},e&&e(t._resolve,t._reject)})}return Object.defineProperty(c.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isFulfilled",{get:function(){return this._isFulfilled},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isRejected",{get:function(){return this._isRejected},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isResolved",{get:function(){return this.isFulfilled||this.isRejected},enumerable:!1,configurable:!0}),c.prototype.then=function(e,t){return this._promise.then(e,t)},c.prototype.catch=function(e){return this._promise.catch(e)},c.prototype.finally=function(e){return this._promise.finally(e)},Object.defineProperty(c.prototype,"corePromise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),c}(),L=_i;var kr=function(c){(0,d.__extends)(e,c);function e(t){var n=this,r=null;n=c.call(this,function(l){var a=setTimeout(function(){n.isResolved||l(!0)},t);r=a})||this,n.timerHandle=r;var i=n._resolve;n._resolve=function(l){clearTimeout(n.timerHandle),i(l)};var o=n._reject;return n._reject=function(l){clearTimeout(n.timerHandle),o(l)},n}return e}(L),ae=kr,gt=function(c){var e=new kr(c);return e.corePromise};var qi=55296,$i=56319,to=56320,eo=57343;function fe(c){return c>=qi&&c<=$i}function Je(c){return c>=to&&c<=eo}var no=200,w=function(){function c(){}return c.buildDefaultLayout=function(e,t,n){var r,i=n;typeof c.dfltLayout[i]!="object"&&(i="desktop");var o=C.modifierBitmasks.NON_CHIRAL,l=$.CURRENT;t&&(o=t.modifierBitmask,l=t.compilerVersion),e||(e=this.DEFAULT_RAW_SPEC);var a=q(c.dfltLayout[i]),s,B=a.layer,g=e.KLS,u=e.K102,F,y,I,Q,U,h,b=(o&C.modifierBitmasks.IS_CHIRAL)!=0;if(e.F){var p=/^(?:(?:italic|bold) )* *[0-9.eE-]+(?:[a-z]+) "(.+)"$/.exec(e.F);p&&(a.font=p[1])}var X=!(typeof g=="undefined"||!g);X||(g=e.KLS=c.processLegacyDefinitions(e.BK));var x=Object.getOwnPropertyNames(g),m=[];if(x.splice(x.indexOf("default"),1),x=["default"].concat(x),t&&t.emulatesAltGr&&(x.indexOf("leftctrl-leftalt")==-1&&x.indexOf("rightalt")!=-1&&(x.push("leftctrl-leftalt"),g["leftctrl-leftalt"]=g.rightalt),x.indexOf("leftctrl-leftalt-shift")==-1&&x.indexOf("rightalt-shift")!=-1&&(x.push("leftctrl-leftalt-shift"),g["leftctrl-leftalt-shift"]=g["rightalt-shift"])),a.displayUnderlying=t?!!t.scriptObject.KDU:!1,n=="desktop")for(m=c.generateLayerIds(b),s=0;s<m.length;s++)x.indexOf(m[s])!=-1&&m.splice(s--,1);var J=x.concat(m);if(X&&n!="desktop"){var V=null;Q=B[0].row;for(var G=0;G<Q.length;G++){h=Q[G].key;for(var S=0;S<h.length;S++)U=h[S],U.id=="K_SHIFT"&&(V=U)}if(V){V.sk=[];for(var T in g)if(!(T=="default"||T=="shift")){var H=c.modifierSpecials[T],E={id:"K_".concat(H),text:H,sp:1,nextlayer:T};V.sk.push(E)}}else console.warn("Error in default layout - cannot find default Shift key!")}for(s=0;s<J.length;s++)s>0&&(B[s]=q(B[0])),B[s].id=J[s],B[s].nextlayer=J[s],c.formatDefaultLayer(B[s],b,n,!!u);for(s=0;s<B.length;s++){var W=B[s],R,V=null,A=null,k=null,at=null,nt=g[W.id],Dt=W.id=="shift"?1:0,re=W.id=="default"||Dt?1:0;for(Q=W.row,F=0;F<Q.length;F++)for(h=Q[F].key,y=0;y<h.length;y++){switch(U=h[y],R=c.dfltCodes.indexOf(U.id),(nt||re)&&(nt&&R>=0&&R<nt.length&&(U.text=nt[R]),re&&l.precedes($.NO_DEFAULT_KEYCAPS)&&U.id!="K_SPACE"&&R+65*Dt<c.dfltText.length&&U.text!==null&&(U.text=U.text||c.dfltText[R+65*Dt])),U.text!==null&&(U.text=U.text||""),U.id){case"K_SHIFT":V=U;break;case"K_CAPS":A=U;break;case"K_NUMLOCK":k=U;break;case"K_SCROLL":at=U;break}if(U.sk!=null){for(I=0;I<U.sk.length;I++)x.indexOf(U.sk[I].nextlayer)==-1&&U.sk.splice(I--,1);U.sk.length==0&&(U.sk=null)}}W.shiftKey=V,W.capsKey=A,W.numKey=k,W.scrollKey=at;var rn=B[s].id;n!="desktop"&&s>0&&V!=null&&(V.sp=2,V.sk=null,V.text=(r=c.modifierSpecials[rn])!==null&&r!==void 0?r:"*Shift*")}return a},c.getLayerId=function(e){var t=C.modifierCodes,n="";return e==0?"default":(e&t.LCTRL&&(n=(n.length>0?n+"-":"")+"leftctrl"),e&t.RCTRL&&(n=(n.length>0?n+"-":"")+"rightctrl"),e&t.LALT&&(n=(n.length>0?n+"-":"")+"leftalt"),e&t.RALT&&(n=(n.length>0?n+"-":"")+"rightalt"),e&t.SHIFT&&(n=(n.length>0?n+"-":"")+"shift"),e&t.CTRL&&(n=(n.length>0?n+"-":"")+"ctrl"),e&t.ALT&&(n=(n.length>0?n+"-":"")+"alt"),n)},c.generateLayerIds=function(e){var t,n;e?(t=32,n=1):(t=8,n=16);for(var r=[],i=0;i<t;i++)r.push(c.getLayerId(i*n));return r},c.formatDefaultLayer=function(e,t,n,r){for(var i=e.id,o=0;o<e.row.length;o++)for(var l=e.row[o],a=l.key,s=0;s<a.length;s++){var B=a[s];switch(B.id){case"K_SHIFT":case"K_LSHIFT":case"K_RSHIFT":i.indexOf("shift")!=-1&&(B.sp=2),n!="desktop"&&(i!="default"?B.nextlayer="default":B.nextlayer="shift");break;case"K_LCTRL":case"K_LCONTROL":if(t){i.indexOf("leftctrl")!=-1&&(B.sp=2);break}case"K_RCTRL":case"K_RCONTROL":if(t){i.indexOf("rightctrl")!=-1&&(B.sp=2);break}case"K_CONTROL":i.indexOf("ctrl")!=-1&&(!t||i.indexOf("leftctrl")!=-1&&i.indexOf("rightctrl")!=-1)&&(B.sp=2);break;case"K_LALT":if(t){i.indexOf("leftalt")!=-1&&(B.sp=2);break}case"K_RALT":if(t){i.indexOf("rightalt")!=-1&&(B.sp=2);break}case"K_ALT":i.indexOf("alt")!=-1&&(!t||i.indexOf("leftalt")!=-1&&i.indexOf("rightalt")!=-1)&&(B.sp=2);break;case"K_oE2":(typeof r=="undefined"||!r)&&(n=="desktop"?(a.splice(s--,1),a[0].width=no):a[s].sp=10);break}}},c.processLegacyDefinitions=function(e){for(var t=c.generateLayerIds(!1),n={},r=0;r<t.length;r++){for(var i=t[r],o=[],l=!1,a=0;a<65;a++){var s=a+65*r;o.push(e[s]),s<e.length&&e[s]!=""&&a!=c.dfltCodes.indexOf("K_SPACE")&&(l=!0)}l&&(n[i]=o)}return(typeof n.default=="undefined"||!n.default)&&(n.default=[""]),(typeof n.shift=="undefined"||!n.shift)&&(n.shift=[""]),n},c.dfltCodes=["K_BKQUOTE","K_1","K_2","K_3","K_4","K_5","K_6","K_7","K_8","K_9","K_0","K_HYPHEN","K_EQUAL","K_*","K_*","K_*","K_Q","K_W","K_E","K_R","K_T","K_Y","K_U","K_I","K_O","K_P","K_LBRKT","K_RBRKT","K_BKSLASH","K_*","K_*","K_*","K_A","K_S","K_D","K_F","K_G","K_H","K_J","K_K","K_L","K_COLON","K_QUOTE","K_*","K_*","K_*","K_*","K_*","K_oE2","K_Z","K_X","K_C","K_V","K_B","K_N","K_M","K_COMMA","K_PERIOD","K_SLASH","K_*","K_*","K_*","K_*","K_*","K_SPACE"],c.dfltText="`1234567890-=\xA7~~qwertyuiop[]\\~~~asdfghjkl;'~~~~~?zxcvbnm,./~~~~~ ~!@#$%^&*()_+\xA7~~QWERTYUIOP{}\\~~~ASDFGHJKL:\"~~~~~?ZXCVBNM<>?~~~~~ ",c.DEFAULT_RAW_SPEC={F:"Tahoma",BK:c.dfltText.split("")},c.modifierSpecials={leftalt:"*LAlt*",rightalt:"*RAlt*",alt:"*Alt*",leftctrl:"*LCtrl*",rightctrl:"*RCtrl*",ctrl:"*Ctrl*","ctrl-alt":"*AltGr*","leftctrl-leftalt":"*LAltCtrl*","rightctrl-rightalt":"*RAltCtrl*","leftctrl-leftalt-shift":"*LAltCtrlShift*","rightctrl-rightalt-shift":"*RAltCtrlShift*",shift:"*Shift*","shift-alt":"*AltShift*","shift-ctrl":"*CtrlShift*","shift-ctrl-alt":"*AltCtrlShift*","leftalt-shift":"*LAltShift*","rightalt-shift":"*RAltShift*","leftctrl-shift":"*LCtrlShift*","rightctrl-shift":"*RCtrlShift*"},c.dfltShiftToCaps={id:"T_*_MT_SHIFT_TO_CAPS",text:"*ShiftLock*",sp:1,nextlayer:"caps"},c.dfltShiftToDefault={id:"T_*_MT_SHIFT_TO_DEFAULT",text:"*Shift*",sp:1,nextlayer:"default"},c.dfltShiftToShift={id:"T_*_MT_SHIFT_TO_SHIFT",text:"*Shift*",sp:1,nextlayer:"shift"},c.dfltLayout={desktop:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:1,key:[{id:"K_BKQUOTE"},{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{id:"K_BKSP",text:"*BkSp*",sp:1,width:130}]},{id:2,key:[{id:"K_TAB",text:"*Tab*",sp:1,width:130},{id:"K_Q"},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{id:"K_BKSLASH"}]},{id:3,key:[{id:"K_CAPS",text:"*Caps*",sp:1,width:165},{id:"K_A"},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_ENTER",text:"*Enter*",sp:1,width:165}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:130},{id:"K_oE2"},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_RSHIFT",text:"*Shift*",sp:1,width:130}]},{id:5,key:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:170},{id:"K_LALT",text:"*Alt*",sp:1,width:160},{id:"K_SPACE",text:"",width:770},{id:"K_RALT",text:"*Alt*",sp:1,width:160},{id:"K_RCONTROL",text:"*Ctrl*",sp:1,width:170}]}]}]},tablet:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",sp:1,width:150},{id:"K_SPACE",text:"",width:570},{id:"K_BKSP",text:"*BkSp*",sp:1,width:150},{id:"K_ENTER",text:"*Enter*",sp:1,width:200}]}]}]},phone:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",width:150,sp:1},{id:"K_SPACE",width:570,text:""},{id:"K_BKSP",text:"*BkSp*",width:150,sp:1},{id:"K_ENTER",text:"*Enter*",width:200,sp:1}]}]}]}},c}();function pt(c,e,t){t.enumerable=!0}var Nr={id:"string",text:"string",layer:"string",nextlayer:"string",font:"string",fontsize:"string",sp:"number",pad:"number",width:"number",sk:"subkeys",flick:"flicks",multitap:"subkeys",hint:"string",default:"boolean"},Or=["n","ne","e","se","s","sw","w","nw"];function Fn(c,e){var t=Object.getPrototypeOf(e);for(var n in e)if(!c.hasOwnProperty(n)){var r=Object.getOwnPropertyDescriptor(t,n);r?Object.defineProperty(c,n,r):c[n]=e[n]}return c}var yn=function(){function c(e,t,n){var r=this;this.isMnemonic=!1,Object.assign(this,e),!this.text&&typeof this.id=="string"&&(this.text=rt.unicodeIDToText(this.id)),this.displayLayer=n,this.layer=this.layer||n,this._baseKeyEvent=function(){return r.constructBaseKeyEvent(t,n)}}return Object.defineProperty(c.prototype,"baseKeyID",{get:function(){if(typeof this.id!="undefined")return this.id},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isPadding",{get:function(){return this.sp==10},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"coreID",{get:function(){if(typeof this.id!="undefined"){var e=this.id||"";return this.displayLayer!=this.layer&&(e=e+"+"+this.layer),e}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"elementID",{get:function(){if(typeof this.id!="undefined")return this.displayLayer+"-"+this.coreID},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"baseKeyEvent",{get:function(){var e=this._baseKeyEvent;return typeof e=="function"&&(e=e()),new Bt(e)},enumerable:!1,configurable:!0}),c.unicodeIDToText=function(e,t){if(!e||e.substring(0,2)!="U_")return null;for(var n="",r=e.substring(2).split("_"),i=0,o=r;i<o.length;i++){var l=o[i],a=parseInt(l,16);if(0<=a&&a<=31||128<=a&&a<=159||isNaN(a)){t&&t(l);continue}else n+=String.kmwFromCharCode(a)}return n||null},c.sanitize=function(e){typeof e.width=="string"&&(e.width=parseInt(e.width,10)),e.width||(e.width=rt.DEFAULT_KEY_WIDTH),typeof e.pad=="string"&&(e.pad=parseInt(e.pad,10)),e.pad||(e.pad=rt.DEFAULT_PAD),typeof e.sp=="string"&&(e.sp=Number.parseInt(e.sp,10)),e.sp||(e.sp=rt.DEFAULT_KEY.sp);for(var t=0,n=Object.keys(Nr);t<n.length;t++){var r=n[t],i=Nr[r];switch(i){case"subkeys":var o=e[r];if(o===void 0)break;if(!Array.isArray(o))delete e[r];else for(var l=0;l<o.length;l++){var a=o[l];typeof a!="object"?o.splice(l--,1):rt.sanitize(a)}break;case"flicks":var s=e[r];if(s===void 0)break;if(typeof s!="object")delete e[r];else for(var B=0,g=Or;B<g.length;B++){var u=g[B],a=s[u];if(a===void 0)break;typeof a!="object"?delete s[u]:rt.sanitize(a)}break;default:var F=e[r];F!==void 0&&typeof F!=i&&delete e[r]}}e.text||(e.text=rt.DEFAULT_KEY.text)},c.prototype.constructBaseKeyEvent=function(e,t){var n=this.layer||t||"",r=this.id?this.id.toUpperCase():null,i={Lmodifiers:C.getModifierState(n),Lstates:C.getStateFromLayer(n),Lcode:r?C.keyCodes[r]:0,LisVirtualKey:!0,vkCode:0,kName:r,kLayer:n,kbdLayer:t,kNextLayer:this.nextlayer,device:null,isSynthetic:!0},o=new Bt(i);if(e.keyboard){var l=e.keyboard;l.isMnemonic&&!(e.isDefault&&e.formFactor!="desktop")?o.Lcode!=C.keyCodes.K_SPACE&&(o.vkCode=o.Lcode,this.isMnemonic=!0):o.vkCode=o.Lcode,l.definesPositionalOrMnemonic||(o.Lcode=dt._USKeyCodeToCharCode(o),o.LisVirtualKey=!1)}return o},c.DEFAULT_PAD=15,c.DEFAULT_RIGHT_MARGIN=15,c.DEFAULT_KEY_WIDTH=100,c.DEFAULT_KEY={text:"",width:c.DEFAULT_KEY_WIDTH,sp:0,pad:c.DEFAULT_PAD},(0,d.__decorate)([pt],c.prototype,"baseKeyID",null),(0,d.__decorate)([pt],c.prototype,"isPadding",null),(0,d.__decorate)([pt],c.prototype,"coreID",null),(0,d.__decorate)([pt],c.prototype,"elementID",null),(0,d.__decorate)([pt],c.prototype,"baseKeyEvent",null),(0,d.__decorate)([pt],c.prototype,"constructBaseKeyEvent",null),c}();var rt=function(c){(0,d.__extends)(e,c);function e(t,n,r){var i=c.call(this,t,n,r)||this,o=i.sk;if(o)for(var l=0;l<o.length;l++)o[l]=new se(o[l],n,r);var a=i.multitap;if(a)for(var l=0;l<a.length;l++)a[l]=new se(a[l],n,r);var s=i.flick;if(s)for(var B in s)s[B]=new se(s[B],n,r);return e.determineHint(i,n.defaultHint),i}return e.prototype.getSubkey=function(t){if(this.sk)for(var n=0,r=this.sk;n<r.length;n++){var i=r[n];if(i.coreID==t)return i}return null},e.determineHint=function(t,n){var r;if(t.hint){t.hintSrc=t;return}if(n!=null&&n.includes("flick-")){if(t.flick){var i=n.substring(6);!((r=t.flick[i])===null||r===void 0)&&r.text&&(t.hintSrc=t.flick[i])}return}switch(n){case"none":return;case"multitap":t.multitap&&(t.hintSrc=t.multitap[0]);return;case"flick":if(t.flick)for(var o=0,l=Or;o<l.length;o++){var a=l[o];if(t.flick[a]){t.hintSrc=t.flick[a];return}}return;case"longpress":t.sk&&(t.hintSrc=t.sk[0]);return;case"dot":default:t.sk&&(t.hint="\u2022",t.hintSrc=t);return}},e}(yn);var se=function(c){(0,d.__extends)(e,c);function e(){return c!==null&&c.apply(this,arguments)||this}return e}(yn);var Tr=function(){function c(){}return c.sanitize=function(e){for(var t=0,n=e.key;t<n.length;t++){var r=n[t];r==null?e.key.length=e.key.length-1:rt.sanitize(r)}typeof e.id=="string"&&(e.id=Number.parseInt(e.id,10))},c.polyfill=function(e,t,n,r,i){for(var o=e.key,l=yn.DEFAULT_KEY,a=0;a<o.length;a++){for(var s=o[a],B=Object.keys(l),g=0,u=B;g<u.length;g++){var F=u[g],y=F;typeof s[y]!="string"&&typeof s[y]!="number"&&(s[y]=l[y])}switch(s.sp){case 1:!c.SPECIAL_LABEL.test(s.text)&&s.text!=""&&(s.sp=3);break;case 2:!c.SPECIAL_LABEL.test(s.text)&&s.text!=""&&(s.sp=4);break}var I=new rt(s,t,n);o[a]=I}for(var Q=function(m,J,V,G){m.proportionalPad=J,m.proportionalWidth=V,m.proportionalX=G+J+V/2},U=0,a=0;a<o.length-1;a++){var s=o[a];Q(s,s.pad/r,s.width/r,U),U+=s.proportionalPad,U+=s.proportionalWidth}var h=rt.DEFAULT_RIGHT_MARGIN/r;if(o.length>0){var b=o[o.length-1];if(o.length==1&&b.pad<0){var p=b.width/r,X=1-(U+p+h);Q(b,X,p,U)}else{var X=b.pad/r,p=1-(U+X+h);Q(b,X,p,U)}}Fn(e,new c);var x=e;x.proportionalY=i},c.prototype.populateKeyMap=function(e){this.key.forEach(function(t){t.coreID&&(e[t.coreID]=t)})},c.SPECIAL_LABEL=/\*\w+\*/,(0,d.__decorate)([pt],c.prototype,"populateKeyMap",null),c}();var Er=function(){function c(){}return c.sanitize=function(e){for(var t=0,n=e.row;t<n.length;t++){var r=n[t];Tr.sanitize(r)}},c.polyfill=function(e,t){e.aligned=!1;for(var n=e.row,r=0,i=0,o=n;i<o.length;i++){for(var l=o[i],a=0,s=l.key,B=0,g=s;B<g.length;B++){var u=g[B];a+=u.width+u.pad}a>r&&(r=a)}t.formFactor=="desktop"?r+=5:r+=rt.DEFAULT_RIGHT_MARGIN;for(var F=e.row.length,y=0;y<F;y++){var I=(y+.5)/F;Tr.polyfill(e.row[y],t,e.id,r,I)}Fn(e,new c);var Q=e;Q.totalWidth=r,Q.defaultKeyProportionalWidth=rt.DEFAULT_KEY.width/r,Q.rowProportionalHeight=1/F,Q.keyMap=Q.constructKeyMap()},c.prototype.constructKeyMap=function(){var e={};return this.row.forEach(function(t){t.populateKeyMap(e)}),e},c.prototype.getKey=function(e){e.indexOf(this.id+"-")==0&&(e=e.replace(this.id+"-",""));var t=e.split("::");if(t.length>1){var n=this.keyMap[t[0]];return n.getSubkey(t[1])}else return this.keyMap[e]},(0,d.__decorate)([pt],c.prototype,"constructKeyMap",null),(0,d.__decorate)([pt],c.prototype,"getKey",null),c}();var We=function(){function c(){this.hasFlicks=!1,this.hasLongpresses=!1,this.hasMultitaps=!1}return c.prototype.getLayer=function(e){if(!this.layerMap[e]){var t=this.layer.find(function(n){return n.id==e});if(!t)return null;Er.sanitize(t),Er.polyfill(t,this),this.layerMap[e]=t}return this.layerMap[e]},c.correctLayerEmptyRowBug=function(e){for(var t=0;t<e.length;t++){var n=e[t],r=n.row,i=void 0;for(i=r.length-1;i>=0;i--)(!Array.isArray(r[i].key)||r[i].key.length==0)&&r.splice(i,1)}},c.sanitize=function(e){c.correctLayerEmptyRowBug(e.layer)},c.polyfill=function(e,t,n){if(e==null)throw new Error("Cannot build an ActiveLayout for a null specification.");var r={hasFlicks:!1,hasLongpresses:!1,hasMultitaps:!1};this.sanitize(e);for(var i=0,o=e.layer;i<o.length;i++)for(var l=o[i],a=0,s=l.row;a<s.length;a++)for(var B=s[a],g=0,u=B.key;g<u.length;g++){var F=u[g];r.hasLongpresses||(r.hasLongpresses=!!F.sk),r.hasFlicks||(r.hasFlicks=!!F.flick),r.hasMultitaps||(r.hasMultitaps=!!F.multitap)}var y={};Fn(e,new c);var I=e;if(I.keyboard=t,I.formFactor=n,I.layerMap=y,n!="desktop"&&e.layer.find(function(p){return p.id=="caps"})){var Q=I.getLayer("default"),U=I.getLayer("shift"),h=Q.getKey("K_SHIFT"),b=U==null?void 0:U.getKey("K_SHIFT");h&&b&&!h.multitap&&!b.multitap&&!h.sk&&!b.sk&&(r.hasMultitaps=!0,h.multitap=[(0,d.__assign)({},w.dfltShiftToCaps),(0,d.__assign)({},w.dfltShiftToDefault)],b.multitap=[(0,d.__assign)({},w.dfltShiftToCaps),(0,d.__assign)({},w.dfltShiftToShift)],h.multitap.forEach(function(p,X){return h.multitap[X]=new se(p,I,"default")}),b.multitap.forEach(function(p,X){return b.multitap[X]=new se(p,I,"shift")}))}return I.hasFlicks=r.hasFlicks,I.hasLongpresses=r.hasLongpresses,I.hasMultitaps=r.hasMultitaps,I},(0,d.__decorate)([pt],c.prototype,"getLayer",null),c}();var ro=function(){function c(){this.stores={}}return c}(),Ot;(function(c){c[c.NOT_LOADED=void 0]="NOT_LOADED",c[c.POLYFILLED=1]="POLYFILLED",c[c.CALIBRATED=2]="CALIBRATED"})(Ot||(Ot={}));var co=function(){function c(e){e?this.scriptObject=e:this.scriptObject=c.DEFAULT_SCRIPT_OBJECT,this.layoutStates={}}return c.prototype.process=function(e,t){return this.scriptObject.gs(e,t)},c.prototype.processNewContextEvent=function(e,t){return this.scriptObject.gn?this.scriptObject.gn(e,t):!1},c.prototype.processPostKeystroke=function(e,t){return this.scriptObject.gpk?this.scriptObject.gpk(e,t):!1},Object.defineProperty(c.prototype,"isHollow",{get:function(){return this.scriptObject==c.DEFAULT_SCRIPT_OBJECT},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"id",{get:function(){return this.scriptObject.KI},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"name",{get:function(){return this.scriptObject.KN},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"variableStores",{get:function(){var e=this.scriptObject.KVS,t={};if(Array.isArray(e))for(var n=0,r=e;n<r.length;n++){var i=r[n];t[i]=this.scriptObject[i]}return t},set:function(e){var t=this.scriptObject.KVS;if(Array.isArray(t))for(var n=0,r=t;n<r.length;n++){var i=r[n];typeof e[i]=="string"&&(this.scriptObject[i]=e[i])}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"_legacyLayoutSpec",{get:function(){return this.scriptObject.KV},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"_layouts",{get:function(){return this.scriptObject.KVKL},set:function(e){this.scriptObject.KVKL=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"compilerVersion",{get:function(){return new $(this.scriptObject.KVER)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isMnemonic",{get:function(){return!!this.scriptObject.KM},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"definesPositionalOrMnemonic",{get:function(){return typeof this.scriptObject.KM!="undefined"},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"helpText",{get:function(){return this.scriptObject.KH},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"hasScript",{get:function(){return!!this.scriptObject.KHF},enumerable:!1,configurable:!0}),c.prototype.embedScript=function(e){this.scriptObject.KHF(e)},Object.defineProperty(c.prototype,"oskStyling",{get:function(){return this.scriptObject.KCSS},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isCJK",{get:function(){var e;return typeof this.scriptObject.KLC!="undefined"?e=this.scriptObject.KLC:typeof this.scriptObject.LanguageCode!="undefined"&&(e=this.scriptObject.LanguageCode),e=="cmn"||e=="jpn"||e=="kor"},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isRTL",{get:function(){return!!this.scriptObject.KRTL},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"modifierBitmask",{get:function(){return this.scriptObject.KMBM||C.modifierBitmasks.NON_CHIRAL},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isChiral",{get:function(){return!!(this.modifierBitmask&C.modifierBitmasks.IS_CHIRAL)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"desktopFont",{get:function(){return this.scriptObject.KV?this.scriptObject.KV.F:null},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"cacheTag",{get:function(){var e=this.scriptObject._kmw;return e||(e=new ro,this.scriptObject._kmw=e),e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"explodedStores",{get:function(){return this.cacheTag.stores},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"emulatesAltGr",{get:function(){var e=C.modifierCodes;if(!this.isChiral||this._legacyLayoutSpec==null)return!1;var t=this._legacyLayoutSpec.KLS;if(!t)return!1;var n=e.LCTRL|e.LALT,r=t[w.getLayerId(n)],i=t[w.getLayerId(e.SHIFT|n)];if(r!=null&&r!=t[w.getLayerId(e.RALT)]||i!=null&&i!=t[w.getLayerId(e.RALT|e.SHIFT)])return!1;var o=this.modifierBitmask;return(o&n)!=n||r==null&&i==null,!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"usesSupplementaryPlaneChars",{get:function(){var e=this.scriptObject;return e&&(e.KS&&e.KS==1||e.KN=="Hieroglyphic")},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"version",{get:function(){return this.scriptObject.KBVER||""},enumerable:!1,configurable:!0}),c.prototype.usesDesktopLayoutOnDevice=function(e){return this.scriptObject.KVKL?e.formFactor==f.FormFactor.Desktop:!0},c.prototype.notify=function(e,t,n){typeof this.scriptObject.KNS=="function"&&this.scriptObject.KNS(e,t,n)},c.prototype.findOrConstructLayout=function(e){if(this._layouts){if(this._layouts[e]!==void 0)return this._layouts[e];if(e==f.FormFactor.Phone&&this._layouts[f.FormFactor.Tablet])return this._layouts[f.FormFactor.Phone]=this._layouts[f.FormFactor.Tablet];if(e==f.FormFactor.Tablet&&this._layouts[f.FormFactor.Phone])return this._layouts[f.FormFactor.Tablet]=this._layouts[f.FormFactor.Phone]}var t=null;if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.KLS)t=this._legacyLayoutSpec;else if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.BK!=null){for(var n=this._legacyLayoutSpec.BK,r=0;r<n.length;r++)if(n[r].length>0){t=this._legacyLayoutSpec;break}}if(!t&&(this.helpText==""||e!=f.FormFactor.Desktop)&&(t={F:"Tahoma",BK:w.dfltText}),this._layouts||(this._layouts={}),t){var i=this._layouts[e]=w.buildDefaultLayout(t,this,e);return i.isDefault=!0,i}else return this._layouts[e]=null,null},c.prototype.layout=function(e){var t=this.findOrConstructLayout(e);if(t)if(this.layoutStates[e]==Ot.NOT_LOADED){var n=We.polyfill(t,this,e);return this.layoutStates[e]=Ot.POLYFILLED,n}else return t;else return null},c.prototype.refreshLayouts=function(){var e=[f.FormFactor.Desktop,f.FormFactor.Phone,f.FormFactor.Tablet],t=this;e.forEach(function(n){t.layoutStates[n]=Ot.NOT_LOADED})},c.prototype.markLayoutCalibrated=function(e){this.layoutStates[e]!=Ot.NOT_LOADED&&(this.layoutStates[e]=Ot.CALIBRATED)},c.prototype.getLayoutState=function(e){return this.layoutStates[e]},c.prototype.constructNullKeyEvent=function(e,t){t=t||{K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};var n=Bt.constructNullKeyEvent(e);return this.setSyntheticEventDefaults(n,t),n},c.prototype.constructKeyEvent=function(e,t,n){var r=e.baseKeyEvent;r.device=t,this.isMnemonic&&r.setMnemonicCode(e.layer.indexOf("shift")!=-1,n.K_CAPS),this.setSyntheticEventDefaults(r,n);var i={K_CAPS:C.stateBitmasks.CAPS,K_NUMLOCK:C.stateBitmasks.NUM_LOCK,K_SCROLL:C.stateBitmasks.SCROLL_LOCK},o=i[r.kName];return o&&(r.Lstates^=o,r.LmodifierChange=!0),r},c.prototype.setSyntheticEventDefaults=function(e,t){e.device.touchable||(e.Lstates=0,e.Lstates|=t.K_CAPS?C.modifierCodes.CAPS:C.modifierCodes.NO_CAPS,e.Lstates|=t.K_NUMLOCK?C.modifierCodes.NUM_LOCK:C.modifierCodes.NO_NUM_LOCK,e.Lstates|=t.K_SCROLL?C.modifierCodes.SCROLL_LOCK:C.modifierCodes.NO_SCROLL_LOCK),e.kName&&e.kName.substr(0,2)=="U_"&&(e.LisVirtualKey=!1),typeof e.Lcode=="undefined"&&(e.Lcode=this.getVKDictionaryCode(e.kName),e.Lcode||(e.Lcode=1)),(e.Lmodifiers&C.modifierBitmasks.ALT_GR_SIM)==C.modifierBitmasks.ALT_GR_SIM&&this.emulatesAltGr&&(e.Lmodifiers&=~C.modifierBitmasks.ALT_GR_SIM,e.Lmodifiers|=C.modifierCodes.RALT)},c.prototype.getVKDictionaryCode=function(e){var t=this.scriptObject.VKDictionary||{};if(!this.scriptObject.VKDictionary){if(typeof this.scriptObject.KVKD=="string")for(var n=this.scriptObject.KVKD.split(" "),r=0;r<n.length;r++)t[n[r].toUpperCase()]=r+256;this.scriptObject.VKDictionary=t}var i=t[e.toUpperCase()];return i||0},c.DEFAULT_SCRIPT_OBJECT={gs:function(e,t){return!1},KI:"",KN:"",KV:w.DEFAULT_RAW_SPEC,KM:0},c}(),j=co;var Be={osk:C},de=function(){function c(e,t){this.loadedKeyboard=null,this._jsGlobal=e,this.keymanGlobal=t,this.install()}return c.prototype.KR=function(e){if(this.loadedKeyboard)throw new Error("Unexpected state:  the most-recently loaded keyboard field was not properly reset.");this.loadedKeyboard=new j(e)},c.prototype.KLOAD=function(e,t,n){return n},c.prototype.install=function(){this._jsGlobal.KeymanWeb=this,this._jsGlobal.keyman=this.keymanGlobal},c.prototype.uninstall=function(){this._jsGlobal.KeymanWeb==this&&delete this._jsGlobal.KeymanWeb,this._jsGlobal.keyman==this.keymanGlobal&&delete this._jsGlobal.keyman},c}();var ge=function(c){(0,d.__extends)(e,c);function e(t,n){var r=c.call(this,t)||this;return r.cause=n,r}return e}(Error);var Qn=function(c){(0,d.__extends)(e,c);function e(t,n){var r=c.call(this,t)||this;return r.cause=n,r}return e}(Error);var io=function(){function c(e){this.uri=e}return c.prototype.missingError=function(e){var t="Cannot find the keyboard at ".concat(this.uri,".");return new Qn(t,e)},c.prototype.scriptError=function(e){var t="Error registering the keyboard script at ".concat(this.uri,"; it may contain an error.");return new ge(t,e)},c}(),oo=function(){function c(e){this.stub=e}return c.prototype.missingError=function(e){var t=this.stub,n="Cannot find the ".concat(t.name," keyboard for ").concat(t.langName," at ").concat(t.filename,".");return new Qn(n,e)},c.prototype.scriptError=function(e){var t=this.stub,n="Error registering the ".concat(t.name," keyboard for ").concat(t.langName,"; keyboard script at ").concat(t.filename," may contain an error.");return new ge(n,e)},c}(),lo=function(){function c(e){this._harness=e}return Object.defineProperty(c.prototype,"harness",{get:function(){return this._harness},enumerable:!1,configurable:!0}),c.prototype.loadKeyboardFromPath=function(e){this.harness.install();var t=this.loadKeyboardInternal(e,new io(e));return t},c.prototype.loadKeyboardFromStub=function(e){this.harness.install();var t=this.loadKeyboardInternal(e.filename,new oo(e),e.id);return t},c}(),In=lo;var Un;(function(c){c.KEYBOARD="keyboard",c.LANGUAGE="language",c.LANGUAGE_KEYBOARD="languageKeyboard",c.BLANK="blank"})(Un||(Un={}));var ut=Un;function hn(c,e){if(c)return{family:c.family,path:e,files:c.filename||c.source}}var ao=function(){function c(e,t){if(typeof e!="string")if(e.KI||e.KL||e.KLC||e.KFont||e.KOskFont){var n=e;this.KI=n.KI,this.KN=n.KN,this.KL=n.KL,this.KLC=n.KLC,this.KFont=n.KFont,this.KOskFont=n.KOskFont,this._displayName=n instanceof c?n._displayName:n.displayName}else{var r=e;r.languages||(r.languages=r.language),this.KI=r.id,this.KN=r.name,this.KL=r.languages.name,this.KLC=r.languages.id,this.KFont=hn(r.languages.font,t),this.KOskFont=hn(r.languages.oskFont,t)}else this.KI=e,this.KLC=t}return Object.defineProperty(c,"spacebarTextMode",{get:function(){return typeof this.spacebarTextModeSrc=="string"?this.spacebarTextModeSrc:this.spacebarTextModeSrc()},set:function(e){this.spacebarTextModeSrc=e},enumerable:!1,configurable:!0}),c.fromMultilanguageAPIStub=function(e){var t=[];e.languages||(e.languages=e.language);for(var n=0,r=e.languages;n<r.length;n++){var i=r[n],o={id:e.id,name:e.name,languages:i};t.push(new c(o))}return t},Object.defineProperty(c.prototype,"id",{get:function(){return this.KI},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"name",{get:function(){return this.KN},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"langId",{get:function(){return this.KLC},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"langName",{get:function(){return this.KL},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"displayName",{get:function(){if(this._displayName)return this._displayName;var e=this.KN,t=this.KL;switch(c.spacebarTextMode){case ut.KEYBOARD:return e;case ut.LANGUAGE:return t;case ut.LANGUAGE_KEYBOARD:return e==t?t:t+" - "+e;case ut.BLANK:return"";default:return e}},set:function(e){this._displayName=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"textFont",{get:function(){return this.KFont},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"oskFont",{get:function(){return this.KOskFont},enumerable:!1,configurable:!0}),c.prototype.validateForOSK=function(){return this.KLC?this.displayName===void 0||c.spacebarTextMode!=ut.BLANK&&!this.displayName?new Error("A display name is missing for this keyboard and cannot be generated under current settings."):null:this.KI||this.KN?new Error("No language code was specified for use with the ".concat(this.KI||this.KN," keyboard")):new Error("No language code was specified for use with the corresponding keyboard")},c.prototype.validateForCustomKeyboard=function(){return!this.KI||!this.KN||!this.KL||!this.KLC?new Error("To use a custom keyboard, you must specify keyboard id, keyboard name, language and language code."):null},c.spacebarTextModeSrc=ut.KEYBOARD,c}(),Kt=ao;var bn=function(){function c(e,t){this.p=e,this.d=t,this.o=c.ordinalSeed++}return c.prototype.match=function(e,t){var n=this.p==e&&this.d==t;return n},c.prototype.set=function(){this.matched=1},c.prototype.reset=function(){this.matched=0},c.prototype.before=function(e){return this.o<e.o},c.prototype.clone=function(){var e=new c(this.p,this.d);return e.o=this.o,e},c.prototype.equal=function(e){return this.d==e.d&&this.p==e.d&&this.o==e.o},c.ordinalSeed=0,c.sortFunc=function(e,t){return e.p!=t.p?t.p-e.p:t.o-e.o},c}();var Yr=function(){function c(){this.dks=[]}return c.prototype.toSortedArray=function(){return this.dks=this.dks.sort(bn.sortFunc),[].concat(this.dks)},c.prototype.clone=function(){var e=new c,t=this.toSortedArray();return e.dks=[],t.forEach(function(n){e.dks.push(n.clone())}),e},c.prototype.isMatch=function(e,t,n){if(this.dks.length==0)return!1;var r=e;t=r-t;for(var i=0;i<this.dks.length;i++)if(this.dks[i].match(t,n)&&!this.dks[i].matched)return this.dks[i].set(),!0;return this.resetMatched(),!1},c.prototype.add=function(e){this.dks=this.dks.concat(e)},c.prototype.remove=function(e){var t=this.dks.indexOf(e);this.dks.splice(t,1)},c.prototype.clear=function(){this.dks=[]},c.prototype.resetMatched=function(){for(var e=0,t=this.dks;e<t.length;e++){var n=t[e];n.reset()}},c.prototype.deleteMatched=function(){for(var e=0;e<this.dks.length;e++)this.dks[e].matched&&this.dks.splice(e--,1)},c.prototype.adjustPositions=function(e,t){if(t!=0)for(var n=0,r=this.dks;n<r.length;n++){var i=r[n];i.p>e&&(i.p+=t)}},c.prototype.equal=function(e){if(this.dks.length!=e.dks.length)return!1;for(var t=e.dks,n=[],r=function(s){var B=t.find(function(g){return s.equal(g)});if(!B)return{value:!1}},i=0,o=this.dks;i<o.length;i++){var l=o[i],a=r(l);if(typeof a=="object")return a.value}return n.length==t.length},c.prototype.count=function(){return this.dks.length},c}();var wr=function(){function c(e){this.id=e}return c.prototype.set=function(e){throw new Error("System store with ID "+this.id+" may not be directly set.")},c}();var Se=function(c){(0,d.__extends)(e,c);function e(t,n){var r=c.call(this,t)||this;return r.handler=null,r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),e.prototype.matches=function(t){return this._value==t},e.prototype.set=function(t){this.handler&&this.handler(this,t)||(this._value=t)},e}(wr);var zr=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this,O.TSS_PLATFORM)||this;return n.kbdInterface=t,n}return e.prototype.matches=function(t){var n,r,i=t.split(" "),o=this.kbdInterface.activeDevice;for(n=0;n<i.length;n++)switch(r=i[n].toLowerCase(),r){case"touch":case"hardware":if(o.touchable!=(r=="touch"))return!1;break;case"macos":case"mac":r="macosx";case"macosx":case"windows":case"android":case"ios":case"linux":if(o.OS!=r)return!1;break;case"tablet":case"phone":case"desktop":if(o.formFactor!=r)return!1;break;case"web":if(o.browser=="native")return!1;break;case"native":case"chrome":case"firefox":case"safari":case"edge":case"opera":if(o.browser!=r)return!1;break;default:return!1}return!0},e}(wr);function Cn(c,e,t){var n=Math.min(c.length,e.length),r,i,o,l,a;for(t?(r=i=c.length-1,o=i-n,l=-1,a=e.length-c.length):(r=i=0,o=n,l=1,a=0);i!=o&&c.charAt(i)==e.charAt(i+a);i+=l);if(i!=r&&i!=o){var s=c.charCodeAt(i-l),B=c.charCodeAt(i),g=e.charCodeAt(i+a),u=t?Je:fe,F=t?fe:Je;if(u(s)&&(F(B)||F(g)))return i-l}return i}le();function Yt(c){var e;return c?c.insert===""&&c.deleteLeft===0&&((e=c.deleteRight)!==null&&e!==void 0?e:0)===0:!0}var so=function(){function c(e,t,n,r){this.insert=e,this.deleteLeft=t,this.deleteRight=n,this.erasedSelection=r}return c.nil=new c("",0,0,!1),c}();var Bo=function(){function c(e,t,n,r){var i=this.token=c.tokenSeed++;this.keystroke=e,this.transform=t,this.alternates=r,this.preInput=n,this.transform.id=this.token,r&&r.forEach(function(o){o.sample.id=i})}return c.tokenSeed=0,c}();var Mr=function(){function c(){this._dks=new Yr}return Object.defineProperty(c.prototype,"isSynthetic",{get:function(){return!0},enumerable:!1,configurable:!0}),c.prototype.resetContext=function(){this.deadkeys().clear()},c.prototype.deadkeys=function(){return this._dks},c.prototype.hasDeadkeyMatch=function(e,t){return this.deadkeys().isMatch(this.getDeadkeyCaret(),e,t)},c.prototype.insertDeadkeyBeforeCaret=function(e){var t=new bn(this.getDeadkeyCaret(),e);this.deadkeys().add(t)},c.prototype.adjustDeadkeys=function(e){this.deadkeys().adjustPositions(this.getDeadkeyCaret(),e)},c.prototype.setDeadkeys=function(e){this._dks=e.clone()},c.prototype.buildTransformFrom=function(e){var t=this.getTextBeforeCaret(),n=e.getTextBeforeCaret(),r=Cn(n,t,!1),i=n.substring(r)._kmwLength(),o=t.substring(r),l=this.getTextAfterCaret(),a=e.getTextAfterCaret(),s=Cn(a,l,!0),B=a.substring(0,s+1)._kmwLength();return new so(o,i,B,e.getSelectedText()&&!this.getSelectedText())},c.prototype.buildTranscriptionFrom=function(e,t,n,r){var i=this.buildTransformFrom(e);return new Bo(t,i,Y.from(e,n),r)},c.prototype.restoreTo=function(e){this.clearSelection(),this.setTextBeforeCaret(e.getTextBeforeCaret()),this.setTextAfterCaret(e.getTextAfterCaret()),this._dks=e._dks.clone()},c.prototype.apply=function(e){this.clearSelection(),e.deleteRight&&this.setTextAfterCaret(this.getTextAfterCaret()._kmwSubstr(e.deleteRight)),e.deleteLeft&&this.deleteCharsBeforeCaret(e.deleteLeft),e.insert&&this.insertTextBeforeCaret(e.insert),this._dks.clear()},c.prototype.setTextBeforeCaret=function(e){this.deleteCharsBeforeCaret(this.getTextBeforeCaret()._kmwLength()),this.insertTextBeforeCaret(e)},c.prototype.saveProperties=function(){},c.prototype.restoreProperties=function(){},c}(),pn=Mr,Y=function(c){(0,d.__extends)(e,c);function e(t,n,r){var i=c.call(this)||this;i.selForward=!0,i.text=t||"";var o=i.text._kmwLength();return i.selStart=typeof n=="number"?n:o,i.selEnd=typeof r=="number"?r:i.selStart,i.selForward=i.selEnd>=i.selStart,i}return e.from=function(t,n){var r;if(t instanceof e){var i=t;r=new e(i.text,i.selStart,i.selEnd)}else{var o=t.getText(),l=o._kmwLength(),a=l,s=0;if(t.hasSelection()){var B=t.getTextBeforeCaret(),g=t.getTextAfterCaret();a=B._kmwLength(),s=l-g._kmwLength()}r=new e(o,a,s)}return r.setDeadkeys(t.deadkeys()),r},e.prototype.clearSelection=function(){this.text=this.getTextBeforeCaret()+this.getTextAfterCaret(),this.selEnd=this.selStart,this.selForward=!0},e.prototype.invalidateSelection=function(){},e.prototype.isSelectionEmpty=function(){return this.selStart==this.selEnd},e.prototype.hasSelection=function(){return!0},e.prototype.getDeadkeyCaret=function(){return this.selStart},e.prototype.setSelection=function(t,n){if(this.selStart=t,this.selEnd=typeof n=="number"?n:t,this.selForward=n>=t,!this.selForward){var r=this.selStart;this.selStart=this.selEnd,this.selEnd=r}},e.prototype.getTextBeforeCaret=function(){return this.text.kmwSubstr(0,this.selStart)},e.prototype.getSelectedText=function(){return this.text.kmwSubstr(this.selStart,this.selEnd-this.selStart)},e.prototype.getTextAfterCaret=function(){return this.text.kmwSubstr(this.selEnd)},e.prototype.getText=function(){return this.text},e.prototype.deleteCharsBeforeCaret=function(t){t>=0&&(t>this.selStart&&(t=this.selStart),this.adjustDeadkeys(-t),this.text=this.text.kmwSubstr(0,this.selStart-t)+this.text.kmwSubstr(this.selStart),this.selStart-=t,this.selEnd-=t)},e.prototype.insertTextBeforeCaret=function(t){this.adjustDeadkeys(t._kmwLength()),this.text=this.getTextBeforeCaret()+t+this.text.kmwSubstr(this.selStart),this.selStart+=t.kmwLength(),this.selEnd+=t.kmwLength()},e.prototype.handleNewlineAtCaret=function(){this.insertTextBeforeCaret("\n")},e.prototype.setTextAfterCaret=function(t){this.text=this.getTextBeforeCaret()+t},e.prototype.isEqual=function(t){return this.text==t.text&&this.selStart==t.selStart&&this.selEnd==t.selEnd&&this.deadkeys().equal(t.deadkeys())},e.prototype.doInputEvent=function(){},e}(Mr);var go=function(){function c(){this.transcription=null,this.setStore={},this.saveStore={},this.variableStores={},this.triggersDefaultCommand=!1}return c.prototype.finalize=function(e,t,n){if(!this.transcription)throw"Cannot finalize a RuleBehavior with no transcription.";e.beepHandler&&this.beep&&e.beepHandler(t);for(var r in this.setStore){var i=e.keyboardInterface.systemStores[r];if(i)try{i.set(this.setStore[r])}catch(l){e.errorLogger&&e.errorLogger("Rule attempted to perform illegal operation - 'platform' may not be changed.")}else e.warningLogger&&e.warningLogger("Unknown store affected by keyboard rule: "+r)}if(e.keyboardInterface.applyVariableStores(this.variableStores),e.keyboardInterface.variableStoreSerializer)for(var r in this.saveStore)e.keyboardInterface.variableStoreSerializer.saveStore(e.activeKeyboard.id,r,this.saveStore[r]);if(this.triggersDefaultCommand){var o=this.transcription.keystroke;e.defaultRules.applyCommand(o,t)}e.warningLogger&&this.warningLog?e.warningLogger(this.warningLog):e.errorLogger&&this.errorLog&&e.errorLogger(this.errorLog)},c.prototype.mergeInDefaults=function(e){var t=this.transcription.keystroke,n=e.transcription.keystroke;if(t.Lcode!=n.Lcode||t.Lmodifiers!=n.Lmodifiers)throw"RuleBehavior default-merge not supported unless keystrokes are identical!";this.triggersDefaultCommand=this.triggersDefaultCommand||e.triggersDefaultCommand;var r=Y.from(this.transcription.preInput,!1);r.apply(this.transcription.transform),r.apply(e.transcription.transform),this.transcription=r.buildTranscriptionFrom(this.transcription.preInput,t,!1,this.transcription.alternates)},c}(),Ft=go;var uo=function(){function c(){}return c}();var Fo=function(){function c(){}return c.prototype.reset=function(){this._cache=[]},c.prototype.get=function(e,t){return typeof this._cache[e]=="undefined"||typeof this._cache[e][t]=="undefined"?null:this._cache[e][t]},c.prototype.set=function(e,t,n){typeof this._cache[e]=="undefined"&&(this._cache[e]=[]),this._cache[e][t]=n},c}(),yo=function(){function c(){}return c.prototype.reset=function(){this._cache=[]},c.prototype.get=function(e,t){return typeof this._cache[e]=="undefined"||typeof this._cache[e][t]=="undefined"?null:this._cache[e][t]},c.prototype.set=function(e,t,n){typeof this._cache[e]=="undefined"&&(this._cache[e]=[]),this._cache[e][t]=n},c.prototype.clone=function(){var e=new c;return e._cache=this._cache,e},c}(),O;(function(c){c[c.TSS_LAYER=33]="TSS_LAYER",c[c.TSS_PLATFORM=31]="TSS_PLATFORM",c[c.TSS_NEWLAYER=42]="TSS_NEWLAYER",c[c.TSS_OLDLAYER=43]="TSS_OLDLAYER"})(O||(O={}));var Dr=function(c){(0,d.__extends)(e,c);function e(t,n,r){r===void 0&&(r=null);var i=c.call(this,t,n)||this;return i.cachedContext=new Fo,i.cachedContextEx=new yo,i._AnyIndices=[],i.systemStores={},i.systemStores[O.TSS_PLATFORM]=new zr(i),i.systemStores[O.TSS_LAYER]=new Se(O.TSS_LAYER,"default"),i.systemStores[O.TSS_NEWLAYER]=new Se(O.TSS_NEWLAYER,""),i.systemStores[O.TSS_OLDLAYER]=new Se(O.TSS_OLDLAYER,""),i.variableStoreSerializer=r,i}return Object.defineProperty(e.prototype,"Codes",{get:function(){return C},enumerable:!1,configurable:!0}),e.prototype.saveFocus=function(){},e.prototype.registerKeyboard=function(t){var n=new j(t);this.loadedKeyboard=n},e.prototype.context=function(t,n,r){var i=this.cachedContext.get(t,n);if(i!==null)return i;var o=this.KC_(t,n,r);return this.cachedContext.set(t,n,o),o},e.prototype.KC_=function(t,n,r){var i="";return i=r.isSelectionEmpty()?r.getTextBeforeCaret():"",i._kmwLength()<t&&(i=Array(t-i._kmwLength()+1).join("\uFFFE")+i),i._kmwSubstr(-t)._kmwSubstr(0,n)},e.prototype.nul=function(t,n){var r=this.context(t+1,1,n);return r==="\uFFFE"},e.prototype.contextMatch=function(t,n,r,i){var o=this.context(t,i,n);return o===r?!0:(n.deadkeys().resetMatched(),!1)},e.prototype._BuildExtendedContext=function(t,n,r){var i=this.cachedContextEx.get(t,n);if(i!==null)return i;if(i=this.cachedContextEx.get(t,t),i===null){var o=r.deadkeys().toSortedArray(),l=0;for(i={valContext:[],deadContext:[]};i.valContext.length<t;){var a=r.getDeadkeyCaret(),s=a-l;if(o.length>0&&o[0].p>s){o.splice(0,1);continue}else if(o.length>0&&o[0].p==s)i.deadContext[t-i.valContext.length-1]=o[0],i.valContext=[o[0].d].concat(i.valContext),o.splice(0,1);else{var B=this.context(++l,1,r);i.valContext=[B].concat(i.valContext)}}this.cachedContextEx.set(t,t,i)}var g=i;g.valContext=g.valContext.slice(0,n);for(var u=0;u<g.valContext.length;u++)g.valContext[u]=="\uFFFE"&&(g.valContext.splice(0,1),g.deadContext.splice(0,1));return g.valContext.length==0&&(g.valContext=["\uFFFE"],g.deadContext=[]),this.cachedContextEx.set(t,n,g),g},e.prototype.fullContextMatch=function(t,n,r){var i=this._BuildExtendedContext(t,r.length,n);this.ruleContextEx=this.cachedContextEx.clone();for(var o=i.valContext,l=i.deadContext,a=!1,s="\uFFFE",B=function(U){throw new Error("Unexpected object in fullContextMatch specification: "+U)},g=0;g<r.length;g++)if(typeof r[g]=="string"){var u=r[g];if(u!==o[g]){a=!0;break}}else{var F=r[g];switch(F.t){case"d":F.d!==o[g]?a=!0:l[g].set();break;case"a":var y;typeof o[g]=="string"?y=o[g]:y={t:"d",d:o[g]};var I=this.any(g,y,F.a);F.n?F.n&&(I||o[g]===s)&&(a=!0):I?l[g]!==void 0&&l[g].set():a=!0;break;case"i":var Q=this._Index(F.i,F.o);Q!==void 0&&(typeof Q=="string"?Q:Q.d)!==o[g]?a=!0:l[g]!==void 0&&l[g].set();break;case"c":o[F.c-1]!==o[g]?a=!0:l[g]!==void 0&&l[g].set();break;case"n":o[g]!=s&&(a=!0);break;default:B(F)}}return a&&(n.deadkeys().resetMatched(),this._AnyIndices=[]),!a},e.prototype.isKeypress=function(t){return this.activeKeyboard.isMnemonic?!t.LisVirtualKey:!!dt._USKeyCodeToCharCode(t)},e.matchModifiersToRuleChirality=function(t,n){var r=C.modifierCodes.LALT|C.modifierCodes.RALT,i=C.modifierCodes.LCTRL|C.modifierCodes.RCTRL,o=t;if(!(n&r)){var l=o&r;l&&(o^=l|C.modifierCodes.ALT)}if(!(n&i)){var a=o&i;a&&(o^=a|C.modifierCodes.CTRL)}return o},e.prototype.keyMatch=function(t,n,r){var i=!1,o=t.Lcode==173?189:t.Lcode,l=this.activeKeyboard.modifierBitmask,a=l&C.modifierBitmasks.ALL,s=l&C.stateBitmasks.ALL,B=e.matchModifiersToRuleChirality(t.Lmodifiers,n);return t.vkCode>255&&(o=t.vkCode),t.LisVirtualKey||o>255?((n&16384)==16384||o>255)&&(i=r==o&&(n&a)==B,i=i&&this.stateMatch(t,n&s)):n&16384||(i=o==r),i||this.activeTargetOutput.deadkeys().resetMatched(),i},e.prototype.stateMatch=function(t,n){return(n&t.Lstates)==n},e.prototype.keyInformation=function(t){var n=new uo;return n.vk=t.LisVirtualKey,n.code=t.Lcode,n.modifiers=t.Lmodifiers,n},e.prototype.deadkeyMatch=function(t,n,r){return n.hasDeadkeyMatch(t,r)},e.prototype.beep=function(t){this.resetContextCache(),this.ruleBehavior.beep=!0},e.prototype._ExplodeStore=function(t){if(typeof t=="string"){var n=this.activeKeyboard.explodedStores;if(n[t])return n[t];for(var r=[],i=0;i<t._kmwLength();i++)r.push(t._kmwCharAt(i));return n[t]=r,r}else return t},e.prototype.any=function(t,n,r){if(n=="")return!1;r=this._ExplodeStore(r);for(var i=-1,o=0;o<r.length;o++){var l=r[o];if(typeof l=="string"){if(r[o]==n){i=o;break}}else if(l.d===n.d){i=o;break}}return this._AnyIndices[t]=i,i>=0},e.prototype._Index=function(t,n){return t=this._ExplodeStore(t),this._AnyIndices[n-1]<t.length?t[this._AnyIndices[n-1]]:(console.warn("Unmatched contextual index() statement detected in rule with index "+n+"!"),"")},e.prototype.indexOutput=function(t,n,r,i){this.resetContextCache();var o=function(a){throw new Error("Unexpected object in fullContextMatch specification: "+a)},l=this._Index(n,r);if(l!=="")if(typeof l=="string")this.output(t,i,l);else if(l.t)switch(l.t){case"b":this.beep(i);break;case"d":this.deadkeyOutput(t,i,l.d);break;default:o(l)}else this.deadkeyOutput(t,i,l.d)},e.prototype.deleteContext=function(t,n){var r;if(t>0){r=this._BuildExtendedContext(t,t,n);for(var i=0,o=0;o<r.valContext.length;o++){var l=r.deadContext[o];l?(n.deadkeys().remove(l),t--):r.valContext[o]=="\uFFFE"&&i++}var a=r.valContext.length-i;t>a&&(t=a)}n.deadkeys().resetMatched(),this.output(t,n,"")},e.prototype.output=function(t,n,r){this.resetContextCache(),n.saveProperties(),n.clearSelection(),n.deadkeys().deleteMatched(),t>=0&&n.deleteCharsBeforeCaret(t),n.insertTextBeforeCaret(r),n.restoreProperties()},e.prototype.contextExOutput=function(t,n,r,i){this.resetContextCache(),t>=0&&this.output(t,n,"");var o=this.ruleContextEx.get(r,r),l=o.deadContext[i-1],a=o.valContext[i-1];if(l)n.insertDeadkeyBeforeCaret(l.d);else if(typeof a=="string")this.output(-1,n,a);else throw new Error("contextExOutput: should never be a numeric valContext with no corresponding deadContext")},e.prototype.deadkeyOutput=function(t,n,r){this.resetContextCache(),t>=0&&this.output(t,n,""),n.insertDeadkeyBeforeCaret(r)},e.prototype.ifStore=function(t,n,r){var i=!0,o=this.systemStores[t];return o&&(i=o.matches(n)),i},e.prototype.setStore=function(t,n,r){return this.resetContextCache(),t==O.TSS_LAYER&&this.activeDevice.touchable?(this.ruleBehavior.setStore[t]=n,!0):!1},e.prototype.loadStore=function(t,n,r){if(this.resetContextCache(),this.variableStoreSerializer){var i=this.variableStoreSerializer.loadStore(t,n);return i[n]||r}else return r},e.prototype.saveStore=function(t,n){this.resetContextCache();var r=this.activeKeyboard;if(!r||typeof r.id=="undefined"||r.id=="")return!1;var i={};return i[t]=n,this.ruleBehavior?this.ruleBehavior.saveStore[t]=i:this.variableStoreSerializer.saveStore(this.activeKeyboard.id,t,i),!0},e.prototype.resetContextCache=function(){this.cachedContext.reset(),this.cachedContextEx.reset()},e.prototype.defaultBackspace=function(t){t.isSelectionEmpty()?this.output(1,t,""):this.output(0,t,"")},e.prototype.processNewContextEvent=function(t,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processNewContextEvent.bind(this.activeKeyboard),t,n,!0)},e.prototype.processPostKeystroke=function(t,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processPostKeystroke.bind(this.activeKeyboard),t,n,!0)},e.prototype.processKeystroke=function(t,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.process.bind(this.activeKeyboard),t,n,!1)},e.prototype.process=function(t,n,r,i){if(n)if(this.activeKeyboard){if(!t)throw"No callee for keystroke processing!"}else throw"No active keyboard for keystroke processing!";else throw"No target specified for keyboard output!";n.invalidateSelection(),n.deadkeys().resetMatched(),this.resetContextCache();var o=Y.from(n,!0),l=this.activeKeyboard.variableStores;this.ruleBehavior=new Ft,this.activeDevice=r.device,this.activeTargetOutput=n;var a=t(n,r);this.activeTargetOutput=null,this.ruleBehavior.transcription=n.buildTranscriptionFrom(o,r,i),this.ruleBehavior.variableStores=this.activeKeyboard.variableStores,this.activeKeyboard.variableStores=l,this.ruleBehavior.triggerKeyDefault=!a;var s=this.ruleBehavior;return this.ruleBehavior=null,s},e.prototype.applyVariableStores=function(t){this.activeKeyboard.variableStores=t},e.__publishShorthandAPI=function(){var t=this.prototype,n=function(r,i){t[i]&&(t[r]=t[i])};n("KSF","saveFocus"),n("KBR","beepReset"),n("KT","insertText"),n("KR","registerKeyboard"),n("KRS","registerStub"),n("KC","context"),n("KN","nul"),n("KCM","contextMatch"),n("KFCM","fullContextMatch"),n("KIK","isKeypress"),n("KKM","keyMatch"),n("KSM","stateMatch"),n("KKI","keyInformation"),n("KDM","deadkeyMatch"),n("KB","beep"),n("KA","any"),n("KDC","deleteContext"),n("KO","output"),n("KDO","deadkeyOutput"),n("KCXO","contextExOutput"),n("KIO","indexOutput"),n("KIFS","ifStore"),n("KSETS","setStore"),n("KLOAD","loadStore"),n("KSAVE","saveStore")},e.GLOBAL_NAME="KeymanWeb",e}(de),ue=Dr;(function(){Dr.__publishShorthandAPI()})();var Qo=function(c){(0,d.__extends)(e,c);function e(t,n){var r=c.call(this)||this;return r.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1},r.modStateFlags=0,n||(n=e.DEFAULT_OPTIONS),r.contextDevice=t,r.baseLayout=n.baseLayout||e.DEFAULT_OPTIONS.baseLayout,r.keyboardInterface=n.keyboardInterface||new ue(Pt(),Be),r.defaultRules=n.defaultOutputRules||e.DEFAULT_OPTIONS.defaultOutputRules,r}return Object.defineProperty(e.prototype,"activeKeyboard",{get:function(){return this.keyboardInterface.activeKeyboard},set:function(t){this.keyboardInterface.activeKeyboard=t,this.resetContext()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerStore",{get:function(){return this.keyboardInterface.systemStores[O.TSS_LAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newLayerStore",{get:function(){return this.keyboardInterface.systemStores[O.TSS_NEWLAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldLayerStore",{get:function(){return this.keyboardInterface.systemStores[O.TSS_OLDLAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerId",{get:function(){return this.layerStore.value},set:function(t){this.layerStore.set(t)},enumerable:!1,configurable:!0}),e.prototype.defaultRuleBehavior=function(t,n,r){var i=Y.from(n,r),o=new Ft,l=!1,a="",s;if(t.isSynthetic||n.isSynthetic)if(l=!0,this.defaultRules.isCommand(t))o.triggersDefaultCommand=!0;else if((s=this.defaultRules.forSpecialEmulation(t))!=null)switch(s){case Wt.Backspace:this.keyboardInterface.defaultBackspace(n);break;case Wt.Enter:n.handleNewlineAtCaret();break;default:o.errorLog="Unexpected 'special emulation' character (\\u"+s.kmwCharCodeAt(0).toString(16)+") went unhandled!"}else l=!1;var B=this.activeKeyboard&&this.activeKeyboard.isMnemonic;if(!l)if((a=this.defaultRules.forAny(t,B))!=null)if(s=this.defaultRules.forSpecialEmulation(t),s==Wt.Backspace)this.keyboardInterface.defaultBackspace(n);else{if(s||this.defaultRules.isCommand(t))return null;this.keyboardInterface.output(0,n,a)}else return null;if(o.errorLog)return o;var g=n.buildTranscriptionFrom(i,t,r);return o.transcription=g,o},e.prototype.processNewContextEvent=function(t,n){return this.activeKeyboard?this.keyboardInterface.processNewContextEvent(n,this.activeKeyboard.constructNullKeyEvent(t,this.stateKeys)):null},e.prototype.processPostKeystroke=function(t,n){return this.activeKeyboard?this.keyboardInterface.processPostKeystroke(n,this.activeKeyboard.constructNullKeyEvent(t,this.stateKeys)):null},e.prototype.processKeystroke=function(t,n){var r,i=n.getTextBeforeCaret().kmwLength()==0&&n.isSelectionEmpty();if(this.activeKeyboard&&t.Lcode!=0&&(r=this.keyboardInterface.processKeystroke(n,t)),i&&t.Lcode==C.keyCodes.K_BKSP&&r.triggerKeyDefault)r=this.defaultRuleBehavior(t,n,!1),r.triggerKeyDefault=!0,r.transcription.transform.deleteLeft=1;else if(!r||r.triggerKeyDefault){t.Lcode=t.vkCode||t.Lcode,this.keyboardInterface.activeTargetOutput=n;var o=this.defaultRuleBehavior(t,n,!1);o&&(r?r.mergeInDefaults(o):r=o,r.triggerKeyDefault=!1),this.keyboardInterface.activeTargetOutput=null}return r},e.prototype._UpdateVKShift=function(t){var n=0,r=["CAPS","NUM_LOCK","SCROLL_LOCK"],i=["K_CAPS","K_NUMLOCK","K_SCROLL"];if(!this.activeKeyboard)return!0;if(t){n=t.Lmodifiers,this.activeKeyboard.isChiral&&this.activeKeyboard.emulatesAltGr&&(this.modStateFlags&C.modifierBitmasks.ALT_GR_SIM)==C.modifierBitmasks.ALT_GR_SIM&&(n|=C.modifierBitmasks.ALT_GR_SIM,n&=~C.modifierCodes.RALT);for(var o=!1,l=0;l<r.length;l++)t.Lstates&C.stateBitmasks[r[l]]&&(this.stateKeys[i[l]]=!!(t.Lstates&C.modifierCodes[r[l]]),o=!0);o&&this.emit("statekeychange",this.stateKeys)}return this.updateStates(),this.activeKeyboard.isMnemonic&&this.stateKeys.K_CAPS&&(!t||!t.isModifier)&&(n^=C.modifierCodes.SHIFT),this.layerId=this.getLayerId(n),!0},e.prototype.updateStates=function(){for(var t=["CAPS","NUM_LOCK","SCROLL_LOCK"],n=["K_CAPS","K_NUMLOCK","K_SCROLL"],r=0;r<n.length;r++){var i=n[r],o=this.stateKeys[i],l=t[r],a="NO_"+t[r];o?(this.modStateFlags|=C.modifierCodes[l],this.modStateFlags&=~C.modifierCodes[a]):(this.modStateFlags&=~C.modifierCodes[l],this.modStateFlags|=C.modifierCodes[a])}},e.prototype.getLayerId=function(t){return w.getLayerId(t)},e.prototype.selectLayer=function(t){var n=t.kName,r=t.kNextLayer,i=this.activeKeyboard&&this.activeKeyboard.isChiral;if(typeof r=="number"&&(r=this.getLayerId(r*16)),!r)switch(n){case"K_LSHIFT":case"K_RSHIFT":case"K_SHIFT":r="shift";break;case"K_LCONTROL":case"K_LCTRL":if(i){r="leftctrl";break}case"K_RCONTROL":case"K_RCTRL":if(i){r="rightctrl";break}case"K_CTRL":r="ctrl";break;case"K_LMENU":case"K_LALT":if(i){r="leftalt";break}case"K_RMENU":case"K_RALT":if(i){r="rightalt";break}case"K_ALT":r="alt";break;case"K_ALTGR":i?r="leftctrl-rightalt":r="ctrl-alt";break;case"K_CURRENCIES":case"K_NUMERALS":case"K_SHIFTED":case"K_UPPER":case"K_LOWER":case"K_SYMBOLS":r="default";break}return r?(this.updateLayer(t,r),!0):!1},e.prototype.updateLayer=function(t,n){var r=this.layerId,i=r;if(!(n==r&&t.device.formFactor!=f.FormFactor.Desktop)){var o=n,l;if(t.device.formFactor==f.FormFactor.Desktop){var a=["leftctrl","rightctrl","ctrl","leftalt","rightalt","alt","shift"];for(l=0;l<a.length;l++)o=o.replace(a[l]+"-",""),o=o.replace(a[l],"");if(r=="default"||r=="numeric"||r=="symbol"||r=="currency"||o!="")i=n;else{var s=C.getModifierState(i);for(l=0;l<a.length;l++)i=i.replace(a[l]+"-",""),i=i.replace(a[l],"");switch(n){case"shift":s^=C.modifierCodes.SHIFT;break;case"leftctrl":s^=C.modifierCodes.LCTRL;break;case"rightctrl":s^=C.modifierCodes.RCTRL;break;case"ctrl":s^=C.modifierCodes.CTRL;break;case"leftalt":s^=C.modifierCodes.LALT;break;case"rightalt":s^=C.modifierCodes.RALT;break;case"alt":s^=C.modifierCodes.ALT;break;default:i=n}i!="default"&&(i==""?i=this.getLayerId(s):i=this.getLayerId(s)+"-"+i)}i==""&&(i="default")}else i=n;var B=this.activeKeyboard.layout(t.device.formFactor);B.getLayer(i)?this.layerId=i:this.layerId="default";var g=C.getModifierState(this.layerId);this.modStateFlags=g|t.Lstates}},e.prototype.doModifierPress=function(t,n,r){return this.activeKeyboard?t.isModifier?(this.activeKeyboard.notify(t.Lcode,n,r?1:0),t.device.touchable?!0:this._UpdateVKShift(t)):(t.LmodifierChange&&(this.activeKeyboard.notify(0,n,1),t.device.touchable||this._UpdateVKShift(t)),!1):!1},e.prototype.performNewContextEvent=function(t){var n=this.processNewContextEvent(this.contextDevice,t);return n&&n.finalize(this,t,!0),n},e.prototype.resetContext=function(t){this.layerId="default",t==null||t.resetContext(),this.keyboardInterface.resetContextCache(),t&&this.performNewContextEvent(t),this.contextDevice.touchable||this._UpdateVKShift(null)},e.prototype.setNumericLayer=function(t){if(this.activeKeyboard){var n=this.activeKeyboard.layout(t.formFactor);n.getLayer("numeric")&&(this.layerId="numeric")}},e.DEFAULT_OPTIONS={baseLayout:"us",defaultOutputRules:new Tt},e}(v.default),Gn=Qo;var Pr=function(c){return c.substring(c.length-1)!="/"?c+"/":c},Io=function(){function c(e,t){t=Pr(t),this.sourcePath=t,this.protocol=t.replace(/(.{3,5}:)(.*)/,"$1"),this.updateFromOptions(e)}return c.prototype.updateFromOptions=function(e){var t=this.sourcePath.replace(/(https?:\/\/)([^\/]*)(.*)/,"$1$2/");this._root=t,e.root!=""?this._root=this.fixPath(e.root):this._root=this.fixPath(t);var n=e.resources;n==""&&(n=this.sourcePath),this._resources=this.fixPath(n),this._keyboards=this.fixPath(e.keyboards),this._fonts=this.fixPath(e.fonts)},c.prototype.fixPath=function(e){return e.length==0||(e=Pr(e),e.replace(/^(http)s?:.*/,"$1")=="http"||e.replace(/^(file):.*/,"$1")=="file")?e:e.substring(0,2)=="//"?this.protocol+e:e.substring(0,1)=="/"?this.root+e.substring(1):this.sourcePath+e},Object.defineProperty(c.prototype,"fonts",{get:function(){return this._fonts},enumerable:!1,configurable:!0}),c.prototype.updateFontPath=function(e){this._fonts=this.fixPath(e)},Object.defineProperty(c.prototype,"root",{get:function(){return this._root},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"resources",{get:function(){return this._resources},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"keyboards",{get:function(){return this._keyboards},enumerable:!1,configurable:!0}),c}(),mn=Io;var xn={root:"",resources:"",keyboards:"",fonts:""};var Uo=function(){function c(e){e.OS==f.OperatingSystem.Android?this.popupCanvasBackgroundColor="#999":this.popupCanvasBackgroundColor=c.prefersDarkMode()?"#0f1319":"#ffffff"}return c.prefersDarkMode=function(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches},c}(),Kr=Uo;var Le=function(){function c(){this.touchable="ontouchstart"in window,this.OS="",this.formFactor="desktop",this.browser="",this.dyPortrait=0,this.dyLandscape=0,this.version="0",this.orientation=window.orientation}return c.prototype.getDPI=function(){var e=document.createElement("DIV"),t=e.style,n=96;return document.readyState!=="complete"||(e.id="calculateDPI",t.position="absolute",t.display="block",t.visibility="hidden",t.left="10px",t.top="10px",t.width="1in",t.height="10px",document.body.appendChild(e),n=typeof window.devicePixelRatio=="undefined"?e.offsetWidth:e.offsetWidth*window.devicePixelRatio,document.body.removeChild(e)),n},c.prototype.detect=function(){var e=!1;if(navigator&&navigator.userAgent){var t=navigator.userAgent;if(t.indexOf("iPad")>=0)this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;else if(t.indexOf("iPhone")>=0)this.OS="iOS",this.formFactor="phone",this.dyPortrait=this.dyLandscape=25;else if(t.indexOf("Android")>=0){this.OS="Android",this.formFactor="phone",this.dyPortrait=75,this.dyLandscape=25;try{var n=new RegExp("(?:Android\\s+)(\\d+\\.\\d+\\.\\d+)");this.version=t.match(n)[1]}catch(y){}}else if(t.indexOf("Linux")>=0)this.OS="Linux";else if(t.indexOf("Macintosh")>=0){var r=/Intel Mac OS X (\d+(?:[_\.]\d+)+)/i,i=r.exec(t);if(!i)console.warn("KMW could not properly parse the user agent string.A suboptimal keyboard layout may result."),this.OS="MacOSX";else if(i.length>1&&i[1]){var o=i[1].replace("_","."),l=new $(o);e=$.MAC_POSSIBLE_IPAD_ALIAS.compareTo(l)<=0,this.OS="MacOSX"}}else t.indexOf("Windows NT")>=0&&(this.OS="Windows",t.indexOf("Touch")>=0&&(this.formFactor="phone"),typeof navigator.msMaxTouchPoints=="number"&&navigator.msMaxTouchPoints>0&&(this.touchable=!0))}var a=Math.min(screen.width,screen.height),s=Math.max(screen.width,screen.height),B=a/s;this.OS!="iOS"&&this.formFactor=="phone"&&(a>=600&&B>.5625||B>=.625)&&(this.formFactor="tablet");var g=navigator.platform=="Win32"||navigator.platform=="MacIntel";this.OS=="iOS"&&!("ongesturestart"in window)&&!g&&(this.OS="Android"),this.browser="web",(this.OS=="iOS"||this.OS.toLowerCase()=="macosx")&&(this.browser="safari");var u=/Firefox|Chrome|OPR|Safari|Edge/;if(u.test(navigator.userAgent)&&(navigator.userAgent.indexOf("Firefox")>=0&&"onmozorientationchange"in screen?this.browser="firefox":navigator.userAgent.indexOf("OPR")>=0?this.browser="opera":navigator.userAgent.indexOf(" Edge/")>=0?this.browser="edge":navigator.userAgent.indexOf("Chrome")>=0?this.browser="chrome":navigator.userAgent.indexOf("Safari")>=0&&(this.browser="safari")),e&&this.browser=="safari"&&window.TouchEvent){this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;var F=screen.height/screen.width;F<1&&(F=1/F),F>1.6&&(this.formFactor="phone",this.dyPortrait=this.dyLandscape=25)}return this.colorScheme=Kr.prefersDarkMode()?"dark":"light",this.coreSpec},Object.defineProperty(c.prototype,"coreSpec",{get:function(){return new f(this.browser,this.formFactor,this.OS,this.touchable)},enumerable:!1,configurable:!0}),c}();var Xn=function(c){(0,d.__extends)(e,c);function e(t,n){var r=c.call(this)||this;if(r.applyCacheBusting=!1,!n){var i=new Le;i.detect(),n=i.coreSpec}return r.sourcePath=t,r.hostDevice=n,r.deferForInitialization=new L,r}return e.prototype.initialize=function(t){var n=this;this._paths?this._paths.updateFromOptions(t):this._paths=new mn(t,this.sourcePath),typeof t.setActiveOnRegister=="boolean"?this.activateFirstKeyboard=t.setActiveOnRegister:this.activateFirstKeyboard=!0,this._spacebarText=t.spacebarText,Kt.spacebarTextMode=function(){return n.spacebarText}},e.prototype.finalizeInit=function(){this.deferForInitialization.resolve()},Object.defineProperty(e.prototype,"paths",{get:function(){return this._paths},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"spacebarText",{get:function(){return this._spacebarText},set:function(t){this._spacebarText!=t&&(this._spacebarText=t,this.emit("spacebartext",t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"softDevice",{get:function(){return this.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hardDevice",{get:function(){return gn(this.hostDevice)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stubNamespacer",{get:function(){return this._stubNamespacer},set:function(t){this._stubNamespacer=t},enumerable:!1,configurable:!0}),e.prototype.debugReport=function(){return{hostDevice:this.hostDevice,initialized:this.deferForInitialization.isResolved}},e.prototype.onRuleFinalization=function(t,n){},e}(v.default);var Vn=(0,d.__assign)({setActiveOnRegister:!0,spacebarText:ut.LANGUAGE_KEYBOARD},xn);var Zn=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.pendingActivations=[],n.engineConfig=t,n}return Object.defineProperty(e.prototype,"predictionContext",{get:function(){return this._predictionContext},enumerable:!1,configurable:!0}),e.prototype.configure=function(t){this._resetContext=t.resetContext,this._predictionContext=t.predictionContext,this.keyboardCache=t.keyboardCache},e.prototype.insertText=function(t,n,r){var i=this.activeTarget;return i!=null?(n!=null&&t.output(0,i,n),typeof r!="undefined"&&r!==null&&t.deadkeyOutput(0,i,r),i.invalidateSelection(),!0):!1},e.prototype.resetContext=function(){this._resetContext(this.activeTarget),this.predictionContext.resetContext()},e.prototype.findAndPopActivation=function(t){var n;for(n=0;n<this.pendingActivations.length&&this.pendingActivations[n].target!=t;n++);return n==this.pendingActivations.length?null:this.pendingActivations.splice(n,1)[0]},e.prototype.deferredKeyboardActivation=function(t,n,r){return(0,d.__awaiter)(this,void 0,void 0,function(){var i,o;return(0,d.__generator)(this,function(l){switch(l.label){case 0:return i={target:r,keyboard:t,stub:n},this.findAndPopActivation(r),this.pendingActivations.push(i),[4,t];case 1:return l.sent(),o=this.findAndPopActivation(r),o==i?[2,i]:o?(this.pendingActivations.push(o),[2,null]):[2,null]}})})},e.prototype.activateKeyboard=function(t,n,r){return(0,d.__awaiter)(this,void 0,void 0,function(){var i,o,l,a,s;return(0,d.__generator)(this,function(B){switch(B.label){case 0:return i=!this.activeKeyboard,this.findAndPopActivation(this.currentKeyboardSrcTarget()),o=this.prepareKeyboardForActivation(t,n),l=this.currentKeyboardSrcTarget(),[4,o.keyboard];case 1:return a=B.sent(),a==null&&o.metadata?[2,!1]:(this.currentKeyboardSrcTarget()==l&&this.emit("beforekeyboardchange",o.metadata),s=null,a&&(s={keyboard:a,metadata:o.metadata}),this.activateKeyboardForTarget(s,l),this.currentKeyboardSrcTarget()==l&&(!i||a)&&this.emit("keyboardchange",this.activeKeyboard),[2,!0])}})})},e.prototype.prepareKeyboardForActivation=function(t,n){var r=this,i;n||(n="");var o=null;if(t?o=this.keyboardCache.getStub(t,n):n=="",!o){if(t)throw new Error("No matching stub has been registered.");return{keyboard:Promise.resolve(null),metadata:null}}if(!((i=this.activeKeyboard)===null||i===void 0)&&i.metadata&&t==this.activeKeyboard.metadata.id){var l=this.activeKeyboard.keyboard;return{keyboard:Promise.resolve(l),metadata:o}}var a;if(a=this.keyboardCache.getKeyboardForStub(o))return{keyboard:Promise.resolve(a),metadata:o};this.emit("beforekeyboardchange",o);var s=this.engineConfig.deferForInitialization.then(function(){var g=new L;r.emit("keyboardasyncload",o,g.corePromise);var u=r.keyboardCache.fetchKeyboardForStub(o),F=new Promise(function(I,Q){var U="Sorry, the ".concat(o.name," keyboard for ").concat(o.langName," is not currently available.");window.setTimeout(function(){return Q(new Error(U))},e.TIMEOUT_THRESHOLD)}),y=Promise.race([u,F]);return y.then(function(){g.resolve(null),F.catch(function(){})}),y.catch(function(I){throw g.resolve(I),I}),y}),B=this.deferredKeyboardActivation(s,o,this.currentKeyboardSrcTarget());return{keyboard:B.then(function(g){return(0,d.__awaiter)(r,void 0,void 0,function(){return(0,d.__generator)(this,function(u){return g?[2,s]:[2,Promise.resolve(null)]})})}),metadata:o}},e.TIMEOUT_THRESHOLD=1e4,e}(v.default);var ho=function(c){(0,d.__extends)(e,c);function e(){return c!==null&&c.apply(this,arguments)||this}return e}(v.default),vn=ho;function fn(c,e,t){var n=C.modifierCodes;if(e&&e.isMnemonic&&c.setMnemonicCode(!!(c.Lmodifiers&n.SHIFT),!!(c.Lmodifiers&n.CAPS)),e&&!e.isMnemonic){var r=dt.languageMap[t];r&&r["k"+c.Lcode]&&(c.Lcode=r["k"+c.Lcode]),!e.definesPositionalOrMnemonic&&!(c.Lmodifiers&C.modifierBitmasks.NON_LEGACY)&&!c.isModifier&&(c=new Bt({Lcode:dt._USKeyCodeToCharCode(c),Lmodifiers:0,LisVirtualKey:!1,vkCode:c.Lcode,Lstates:c.Lstates,kName:"",device:c.device,isSynthetic:!1}))}return c}var Re="Keyboard_";function _(c){return c.startsWith(Re)?c:Re+c}function xt(c){return c.startsWith(Re)?c.substring(Re.length):c}var bo=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.stubSetTable={},n.keyboardTable={},n.keyboardLoader=t,n}return e.prototype.getKeyboardForStub=function(t){return t?this.getKeyboard(t.KI):null},e.prototype.getKeyboard=function(t){if(!t)return null;var n=this.keyboardTable[_(t)];return n instanceof Promise?null:n},Object.defineProperty(e.prototype,"defaultStub",{get:function(){function t(r){var i=Object.keys(r);if(i.length!=0)return r[i[0]]}var n=t(this.stubSetTable);if(n)return t(n)},enumerable:!1,configurable:!0}),e.prototype.addKeyboard=function(t){var n=_(t.id);this.keyboardTable[n]=t,this.emit("keyboardadded",t)},e.prototype.fetchKeyboardForStub=function(t){return this.fetchKeyboard(t.KI)},e.prototype.isFetchingKeyboard=function(t){if(!t)throw new Error("Keyboard ID must be specified");t=_(t);var n=this.keyboardTable[t];return n instanceof Promise},e.prototype.fetchKeyboard=function(t){var n=this;if(!t)throw new Error("Keyboard ID must be specified");if(!this.keyboardLoader)throw new Error("Cannot load keyboards; this cache was configured without a loader");t=_(t);var r=this.keyboardTable[t];if(r instanceof j)return Promise.resolve(r);if(r instanceof Promise)return r;var i=this.getStub(t,null);if(!i)throw new Error("No stub for ".concat(xt(t)," has been registered"));if(!i.filename)throw new Error("The registered stub for ".concat(xt(t)," lacks a path to the main keyboard file"));var o=this.keyboardLoader.loadKeyboardFromStub(i);return this.keyboardTable[t]=o,o.then(function(l){l.scriptObject.KI=t,n.addKeyboard(l)}).catch(function(l){throw delete n.keyboardTable[t],l}),o},e.prototype.addStub=function(t){var n,r=_(t.KI),i=this.stubSetTable[r]=(n=this.stubSetTable[r])!==null&&n!==void 0?n:{};i[t.KLC]=t,this.emit("stubadded",t)},e.prototype.findMatchingStub=function(t){return this.getStub(t.KI,t.KLC)},e.prototype.getStub=function(t,n){var r,i,o=n||"---";t instanceof j?i=t.id:i=t,i&&(i=_(i));var l=(r=this.stubSetTable[i])!==null&&r!==void 0?r:{};if(o!="---")return l[o];var a=Object.keys(l);return a.length==0?null:l[a[0]]},e.prototype.forgetKeyboard=function(t,n){n===void 0&&(n=!1);var r=t instanceof j?t.id:_(t);this.stubSetTable[r]&&delete this.stubSetTable[r],n&&this.keyboardTable[r]&&delete this.keyboardTable[r]},e.prototype.getStubList=function(){for(var t=[],n=Object.keys(this.stubSetTable),r=0,i=n;r<i.length;r++)for(var o=i[r],l=this.stubSetTable[o],a=Object.keys(l),s=0,B=a;s<B.length;s++){var g=B[s];t.push(l[g])}return t},e}(v.default),Jn=bo;var Wn=["World","Africa","Asia","Europe","South America","North America","Oceania","Central America","Middle East"],Sn=["un","af","as","eu","sa","na","oc","ca","me"],Co=RegExp("^(([\\.]/)|([\\.][\\.]/)|(/))|(:)");function jr(c,e){return e=e||"",c&&!Co.test(c)?e+c:c}var po=function(c){(0,d.__extends)(e,c);function e(t,n,r){var i=this;if(typeof t!="string")if(t.id!==void 0){var o=t;o.id=_(o.id),i=c.call(this,o,r)||this,i.KF=jr(o.filename,n),i.mapRegion(o.languages)}else{var l=t;return l.KI=_(l.KI),i=c.call(this,l,r)||this,i.KF=jr(l.KF,n),i.KP=l.KP,i.KR=l.KR,i.KRC=l.KRC,i}else i=c.call(this,_(t),n)||this;return i}return e.prototype.mapRegion=function(t){var n=t.region,r=0;if(typeof n=="number")n<1||n>9?r=0:r=n-1;else if(typeof n=="string"){for(var i=n.length==2?Sn:Wn,o=0;o<i.length;o++)if(n.toLowerCase()==i[o].toLowerCase()){r=o;break}}this.KR=Wn[r],this.KRC=Sn[r]},Object.defineProperty(e.prototype,"region",{get:function(){return this.KR},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"regionCode",{get:function(){return this.KRC},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filename",{get:function(){return this.KF},enumerable:!1,configurable:!0}),e.toStubs=function(t,n,r){var i="";if(typeof t.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),t.languages||(t.languages=t.language),t?t.id?t.languages||(i="KeyboardStub has undefined languages"):i="KeyboardStub has undefined id":i="Stub undefined",i!="")return[{error:new Error(i)}];var o=[];Array.isArray(t.languages)?o=o.concat(t.languages):o.push(t.languages);var l=[];return o.forEach(function(a){var s=(0,d.__assign)((0,d.__assign)({},t),{languages:a,language:void 0}),B=new e(s,n,r);l.push(B)}),l},e.prototype.merge=function(t){this.KL||(this.KL=t.KL),this.KR||(this.KR=t.KR),this.KRC||(this.KRC=t.KRC),this.KN||(this.KN=t.KN),this.KF||(this.KF=t.KF),this.KFont||(this.KFont=t.KFont),this.KOskFont||(this.KOskFont=t.KOskFont),t._displayName&&(this._displayName||(this._displayName=t._displayName))},e.prototype.validateForCustomKeyboard=function(){return c.prototype.validateForCustomKeyboard.call(this)||!this.KF||!this.KR?new Error("To use a custom keyboard, you must specify file name, keyboard id, keyboard name, language, language code, and region."):null},e}(Kt),ct=po;function Fe(c,e){if(e.length==0)return Promise.resolve(c);if(c.length==0)return Promise.reject(e);var t=c;return Promise.resolve(t.concat(e))}var _r="The Cloud API request timed out.",Ln="Could not find a keyboard with that ID.",qr="The Cloud API failed to find an appropriate keyboard.",Go="Error occurred while registering keyboards: ",mo=function(c){return c+" keyboard not found."},xo=function(c){(0,d.__extends)(e,c);function e(t,n){var r=c.call(this)||this;return r.cloudResolutionPromises=new Map,r.languageFetchStarted=!1,r.registerFromCloud=function(i){var o=Number.parseInt(i.timerid),l;try{l=r._registerCore(i)}catch(s){l=new Error(Go+s)}if(o){var a=r.cloudResolutionPromises.get(o);if(a)try{l instanceof Error?a.reject(l):a.resolve(l)}finally{r.cloudResolutionPromises.delete(o)}else{r.emit("unboundregister",l);return}}else{r.emit("unboundregister",l);return}},r.requestEngine=t,r.pathConfig=n,r._languageListPromise=new L,r}return Object.defineProperty(e.prototype,"languageListPromise",{get:function(){var t=this;return this.languageFetchStarted||(this.languageFetchStarted=!0,this.keymanCloudRequest("",!0).catch(function(n){t.languageFetchStarted=!1,t._languageListPromise.reject(n),t._languageListPromise=new L})),this._languageListPromise.corePromise},enumerable:!1,configurable:!0}),e.prototype.keymanCloudRequest=function(t,n){var r=this,i="https://api.keyman.com/cloud/4.0/"+(arguments.length>1&&n?"languages":"keyboards"),o="?jsonp=keyman.register&languageidtype=bcp47&version="+$.CURRENT.toString(),l=i+o+t,a=this.requestEngine.request(l),s=a.promise,B=a.queryId;return this.cloudResolutionPromises.set(B,s),s.finally(function(){r.cloudResolutionPromises.delete(B)}),s.corePromise},e.prototype._registerCore=function(t){var n=t.options,r=n.fontBaseUri;if(this.pathConfig.fonts!=""?r=this.pathConfig.fonts:this.pathConfig.updateFontPath(r),typeof t.error=="string"){var i="";if(typeof t.options.keyboardid=="string"){var o=t.options.keyboardid;i=o.substring(0,1).toUpperCase()+o.substring(1)}return new Error(mo(i))}if(typeof n=="undefined"||typeof n.context=="undefined")return new Error(Ln);var l=[];if(n.context=="keyboard"){var a=void 0,s=t.keyboard;if(Array.isArray(s))for(a=0;a<s.length;a++)l=l.concat(e.registerLanguagesForKeyboard(s[a],n,a));else l=l.concat(e.registerLanguagesForKeyboard(s,n,0))}else if(n.context=="language"){var B=t.languages;return this._languageListPromise.resolve(B),B}return l},e.registerLanguagesForKeyboard=function(t,n,r){var i="";if(typeof t=="undefined")return[];if(typeof n.keyboardid=="string"&&(i=n.keyboardid.split(",")[r]),Array.isArray(t))if(t.length==1||i.substr(-1,1)=="$"||i==""){for(var o=[],l=0;l<t.length;l++)o=o.concat(this.registerLanguagesForKeyboard(t[l],n,r));return o}else{for(var a=0,l=0;l<t.length;l++){var s=t[l].id.toLowerCase();if(s=="us"&&(s="english"),Array.isArray(t[l].languages)){for(var B=t[l].languages,g=0;g<B.length;g++)if(s==B[g].name.toLowerCase()){a=l;break}}}return this.registerLanguagesForKeyboard(t[a],n,r)}else{var u=n.fontBaseUri||"",F=ct.toStubs(t,n.keyboardBaseUri,u),y=i.split("@")[1];if(F.length==1&&typeof F[0].error!="undefined")throw F[0].error;return typeof y!="string"?F:(y=y.replace(/\$$/,""),[F.find(function(I){return I.KLC==y})])}},e.prototype.fetchCloudStubs=function(t){return(0,d.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,l,a,s;return(0,d.__generator)(this,function(B){switch(B.label){case 0:if(t.length==0)return[2,Promise.resolve([])];for(n="&keyboardid=",r="",i=0;i<t.length;i++)n=n+r+t[i].toString(),r=",";o=[],B.label=1;case 1:return B.trys.push([1,3,,4]),[4,this.keymanCloudRequest(n,!1)];case 2:return l=B.sent(),[2,Fe(l,o)];case 3:return a=B.sent(),console.error(a),s={error:a},o.push(s),[2,Promise.reject(o)];case 4:return[2]}})})},e}(v.default),Rn=xo;var Xo=function(){function c(e,t){this.id=e,this.language=t}return c.prototype.toString=function(){var e=this.id;return this.language?(e=e+"@"+this.language,this.version&&(e=e+"@"+this.version)):this.version&&(e=e+"@@"+this.version),e},c}();function An(c,e){return{keyboard:{id:c.id,name:c.name},error:typeof e=="string"?new Error(e):e}}function $r(c,e,t){var n=new Xo(c,e);return t&&(n.version=t),n}function tc(c,e,t){if(c.getStub(t.id,t.language)==null){for(var n=0;n<e.length;n++)if(e[n].id==t.id&&e[n].language==t.language)return!1;return!0}else return!1}var Vo=function(){function c(e,t,n){var r=this;this.pathConfig=n,this.cache=new Jn(e),this.cloudQueryEngine=new Rn(t,this.pathConfig),this.cloudQueryEngine.on("unboundregister",function(i){Array.isArray(i)&&i.forEach(function(o){o instanceof ct&&r.cache.addStub(o)})})}return c.prototype.addKeyboardArray=function(e){for(var t=this,n=[],r=[],i=[],o=[],l=[],a=0,s=e;a<s.length;a++){var B=s[a];if(typeof B=="string")B.length>0&&o.push(B);else if(B.KI||B.KL||B.KLC||B.KFont||B.KOskFont)i.push(new ct(B));else{var g=B;if(typeof g.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),g.languages||(g.languages=g.language),typeof g.languages=="undefined"){var u="To use keyboard '"+g.id+"', you must specify languages.";l.push(An(g,u))}else if(Array.isArray(g.languages))for(var F=ct.toStubs(g,this.pathConfig.keyboards,this.pathConfig.fonts),y=0,I=F;y<I.length;y++){var Q=I[y];Q instanceof ct?i.push(Q):l.push(Q)}else{var U=g;i.push(new ct(U,this.pathConfig.keyboards,this.pathConfig.fonts))}}}for(var h=0,b=i;h<b.length;h++){var Q=b[h];if(Q.KF){var p=Q.validateForCustomKeyboard();p?l.push(An(Q,p)):n.push(Q)}else r.push(Q)}for(var X=[],x=0,m=r;x<m.length;x++){var J=m[x];if(!J.KI&&!J.KLC){l.push(An(J,"Cannot fetch keyboard information without a keyboard ID or language code."));continue}var V=$r(xt(J.id),J.langId);tc(this.cache,X,V)&&X.push(V)}for(var G=0,S=o;G<S.length;G++){var T=S[G],H=T.split("@"),E=[""];H[0].toLowerCase()=="english"&&(H[0]="us"),H.length>1&&(E=H[1].split(","));for(var W=0;W<E.length;W++)if(!(W>0&&E[W]=="")){var V=$r(H[0],E[W],H[2]);tc(this.cache,X,V)&&X.push(V)}}n.forEach(function(A){return t.cache.addStub(A)});var R=this.cloudQueryEngine.fetchCloudStubs(X.map(function(A){return A.toString()}));return R.then(function(A){for(var k=0,at=A;k<at.length;k++){var nt=at[k];nt instanceof ct?(t.cache.addStub(nt),n.push(nt)):l.push(nt)}return[].concat(l).concat(n)})},c.prototype.addLanguageKeyboards=function(e){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o,l,a,s,B,g,u,F=this;return(0,d.__generator)(this,function(y){switch(y.label){case 0:t=[],n=[],y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this.cloudQueryEngine.languageListPromise];case 2:return n=y.sent(),[3,4];case 3:return r=y.sent(),console.error(r),t.push({error:r}),[2,t];case 4:for(i=n,o="",l=0;l<e.length;l++){for(a=e[l].toLowerCase(),s=a.substr(-1,1)=="$",s&&(a=a.substr(0,a.length-1)),B=!1,g=0;g<i.length;g++)if(a==i[g].name.toLowerCase()){o!=""&&(o=o+","),o=o+"@"+i[g].id,s&&(o=o+"$"),B=!0;break}B||(u={language:{name:a},error:new Error(this.alertLanguageUnavailable(a))},t.push(u))}return o==""?[2,Promise.reject(t)]:[2,this.cloudQueryEngine.keymanCloudRequest("&keyboardid="+o,!1).then(function(I){return(0,d.__awaiter)(F,void 0,void 0,function(){var Q,U,h,b;return(0,d.__generator)(this,function(p){switch(p.label){case 0:return[4,Fe(I,t)];case 1:for(Q=p.sent(),U=0,h=Q;U<h.length;U++)b=h[U],typeof b.error=="undefined"&&this.cache.addStub(b);return[2,Q]}})})},function(I){console.error(I);var Q={error:I};return t.push(Q),Promise.reject(t)})]}})})},c.prototype.fetchCloudCatalog=function(){return(0,d.__awaiter)(this,void 0,void 0,function(){var e,t,n=this;return(0,d.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.cloudQueryEngine.keymanCloudRequest("",!1)];case 1:return e=r.sent(),e.forEach(function(i){return n.cache.addStub(i)}),[2,e];case 2:return t=r.sent(),[2,Promise.reject([{error:t}])];case 3:return[2]}})})},c.prototype.alertLanguageUnavailable=function(e){var t="No keyboards are available for "+e+". Does it have another language name?";return t},c}(),Hn=Vo;var Zo=function(){function c(){this.registeredModels={},this.languageModelMap={}}return c.prototype.modelForLanguage=function(e){return this.languageModelMap[e]},c.prototype.register=function(e){if(e.id=e.id.toLowerCase(),JSON.stringify(e)!=JSON.stringify(this.registeredModels[e.id])){this.registeredModels[e.id]=e;var t=this;e.languages.forEach(function(n){if(!n){console.warn("Null / undefined language codes are not permitted for registration.");return}t.languageModelMap[n]=e})}},c.prototype.unregister=function(e){var t;if(e=e.toLowerCase(),this.registeredModels[e])t=this.registeredModels[e],delete this.registeredModels[e];else return null;var n=this;return t.languages.forEach(function(r){n.languageModelMap[r].id==e&&delete n.languageModelMap[r]}),t},c.prototype.isRegistered=function(e){return!!this.registeredModels[e.id.toLowerCase()]},c}(),kn=Zo;function Ae(c){for(var e=[],t=0;t<c.length;t++)e.push(c[t]);return e}function N(c){var e=document.createElement(c);return e.style.userSelect="none",e.style.webkitUserSelect="none",e}var yt=function(){function c(e,t){if(this.fontStyleDefinitions={},this.linkedSheets=[],this.fontPromises=[],!e){var n=document.getElementsByTagName("HEAD");n.length>0?e=n[0]:e=document.body}this.linkNode=e,this.doCacheBusting=t||!1}return Object.defineProperty(c.prototype,"sheets",{get:function(){return this.linkedSheets.map(function(e){return e.sheet})},enumerable:!1,configurable:!0}),c.prototype.linkStylesheet=function(e){if(!(!(e instanceof HTMLLinkElement)&&!e.innerHTML)){var t=new L;e instanceof HTMLLinkElement?e.onload=function(){return t.resolve()}:t.resolve(),this.linkedSheets.push({sheet:e,load:t}),this.linkNode.appendChild(e)}},c.prototype.allLoadedPromise=function(){return(0,d.__awaiter)(this,void 0,void 0,function(){var e;return(0,d.__generator)(this,function(t){switch(t.label){case 0:return e=this.linkedSheets.map(function(n){return n.load.corePromise}),Promise.allSettled?[4,Promise.allSettled(e)]:[3,2];case 1:return t.sent(),[3,4];case 2:return[4,Promise.all(e)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},c.prototype.addStyleSheetForFont=function(e,t,n){var r=this;if(!e||typeof e.files=="undefined")return null;var i=e.family,o,l,a="",s="",B=[],g="";n||(n=f.OperatingSystem.Other);var u=this.fontStyleDefinitions[n]=this.fontStyleDefinitions[n]||{};if(u[i]){var F=u[i];return F.parentNode||this.linkStylesheet(F),null}for(typeof e.files=="string"?B[0]=e.files:B=e.files,l=0;l<B.length;l++)B[l].toLowerCase().indexOf("data:font")==0&&(g=B[l]),B[l].toLowerCase().indexOf(".otf")>0&&(a=B[l]),B[l].toLowerCase().indexOf(".ttf")>0&&(a=B[l]),B[l].toLowerCase().indexOf(".woff")>0&&(s=B[l]);a!=""&&a.indexOf("/")<0&&(a=t+a),s!=""&&s.indexOf("/")<0&&(s=t+s);var y="@font-face {\nfont-family:"+e.family+";\nfont-style:normal;\nfont-weight:normal;\n";if(g){var I=10,Q=g.substring(I,g.indexOf(";",I));y+="src:url('".concat(g,"'), format('").concat(Q,"');")}else n==f.OperatingSystem.iOS?a!=""&&(this.doCacheBusting&&(a=this.cacheBust(a)),o="url('"+encodeURI(a)+"') format('truetype')"):(s!=""&&(o="url('"+encodeURI(s)+"') format('woff')"),a!=""&&(o="url('"+encodeURI(a)+"') format('truetype')"));if(!o)return null;y+="src:"+o+";",y=y+"\n}\n";var U=Lt(y);u[i]=U;var h=new FontFace(e.family,o),b=h.load(),p=function(){r.fontPromises=r.fontPromises.filter(function(X){return X!=b})};return this.fontPromises.push(b.then(p).catch(p)),this.linkStylesheet(U),U},c.prototype.cacheBust=function(e){return e+"?v="+new Date().getTime()},c.prototype.linkExternalSheet=function(e,t){try{if(!t&&document.querySelector("link[href="+JSON.stringify(e)+"]")!=null)return null}catch(r){return null}var n=document.createElement("link");return n.type="text/css",n.rel="stylesheet",n.href=e,this.linkStylesheet(n),n},c.prototype.unlink=function(e){var t=this.linkedSheets.findIndex(function(r){return r.sheet==e});if(t>-1){var n=this.linkedSheets.splice(t,1);return n[0].load.resolve(),e.parentNode.removeChild(e),!0}return!1},c.prototype.unlinkAll=function(){for(var e=0,t=this.linkedSheets;e<t.length;e++){var n=t[e],r=n.sheet;r.parentNode&&r.parentNode.removeChild(r),n.load.resolve()}this.linkedSheets.splice(0,this.linkedSheets.length)},c}();function Lt(c){var e=document.createElement("style");return e.type="text/css",e.appendChild(document.createTextNode(c)),e}function it(){var c;return typeof window.orientation!="undefined"?c=window.orientation:typeof window.screen.orientation!="undefined"&&(c=window.screen.orientation.angle),c!==void 0?Math.abs(c/90)==1:!1}var vo=function(){function c(e){this.name=e}return c.prototype.load=function(e){return this.loadCookie(this.name,e||function(t){return t})},c.prototype.save=function(e,t){this.saveCookie(this.name,e,t||function(n){return n})},c.prototype._loadRawCookies=function(){var e={};if(typeof document.cookie!="undefined"&&document.cookie!="")for(var t=document.cookie.split(/;\s*/),n=0;n<t.length;n++){var r=t[n].split("=");r.length==2&&(e[r[0]]=r[1])}return e},c.prototype.loadCookie=function(e,t){var n={},r=this._loadRawCookies(),i=r[e];if(i)for(var o=decodeURIComponent(i).split(";"),l=0;l<o.length&&!(l==o.length-1&&!o[l]);l++){var a=o[l].split("=");if(a.length>1){var s=a[0],B=a[1];n[s]=t(B,s)}else n[a[0]]=""}return n},c.prototype.saveCookie=function(e,t,n){var r="";for(var i in t)r+=i+"="+n(t[i],i)+";";var o=new Date(new Date().valueOf()+1e3*60*60*24*30).toUTCString(),l=" path=/; expires="+o;document.cookie="".concat(e,"=").concat(encodeURIComponent(r),"; ").concat(l)},c}(),Qt=vo;function M(c){var e;if(!c)return 0;var t=c.offsetLeft?c.offsetLeft:0;if(e=c,e.offsetParent){for(;e.offsetParent;)e=e.offsetParent,t+=e.offsetLeft;var n=e.ownerDocument;e.style.position=="fixed"&&n&&n.scrollingElement&&(t+=n.scrollingElement.scrollLeft)}if(e&&e.ownerDocument&&c.ownerDocument!=window.document){var r=e.ownerDocument;if(r&&r.defaultView&&r.defaultView.frameElement)return t+M(r.defaultView.frameElement)-r.documentElement.scrollLeft}return t}function D(c){var e;if(!c)return 0;var t=c.offsetTop?c.offsetTop:0;if(e=c,e.ownerDocument&&e instanceof e.ownerDocument.defaultView.HTMLElement){for(;e.offsetParent;)e=e.offsetParent,t+=e.offsetTop;var n=e.ownerDocument;e.style.position=="fixed"&&n&&n.scrollingElement&&(t+=n.scrollingElement.scrollTop)}if(e&&e.ownerDocument&&c.ownerDocument!=window.document){var r=e.ownerDocument;if(r&&r.defaultView&&r.defaultView.frameElement)return t+D(r.defaultView.frameElement)}return t}var ec=function(c){(0,d.__extends)(e,c);function e(t,n){return c.call(this,"KeymanWeb_".concat(t,"_Option_").concat(n))||this}return e.prototype.load=function(){return c.prototype.load.call(this,decodeURIComponent)},e.prototype.save=function(t){c.prototype.save.call(this,t,encodeURIComponent)},e}(Qt),Nn=function(){function c(){}return c.prototype.loadStore=function(e,t){var n=new ec(e,t);return n.load()},c.prototype.saveStore=function(e,t,n){var r=new ec(e,t);r.save(n)},c}();var nc=function(c){(0,d.__extends)(e,c);function e(t,n,r){var i=c.call(this,t,n,new Nn)||this;return i.insertText=function(o,l){i.resetContextCache(),i.engine.contextManager.insertText(i,o,l)},i.KT=i.insertText,i.engine=n,i.stubNamespacer=r,i}return e.prototype.preserveID=function(t){var n;if(document.currentScript)n=document.currentScript.id;else{var r=document.getElementsByTagName("script"),i=r[r.length-1];n=i.id}if(n)n.indexOf(xt(t.KI))!=-1?t.KI=n:console.error("Error when registering keyboard:  current SCRIPT tag's ID does not match!");else return},e.prototype.registerKeyboard=function(t){var n=this;c.prototype.registerKeyboard.call(this,t);var r=this.loadedKeyboard;this.preserveID(t),this.engine.config.deferForInitialization.then(function(){n.engine.keyboardRequisitioner.cache.isFetchingKeyboard(r.id)||(n.engine.keyboardRequisitioner.cache.addKeyboard(r),n.loadedKeyboard=null)})},e.prototype.registerStub=function(t){var n=this,r;this.stubNamespacer&&this.stubNamespacer(t);var i=function(){var l=n.engine.config.paths;return new ct(t,l.keyboards,l.fonts)};if(!this.engine.config.deferForInitialization.isResolved)this.engine.config.deferForInitialization.then(function(){return n.engine.keyboardRequisitioner.cache.addStub(i())});else{var o=i();if(!((r=this.engine.keyboardRequisitioner)===null||r===void 0)&&r.cache.findMatchingStub(o))return 1;this.engine.keyboardRequisitioner.cache.addStub(o)}return null},e}(ue),Tn=nc;(function(){nc.__publishShorthandAPI()})();var rc=function(c){(0,d.__extends)(e,c);function e(t,n){var r=this;return t&&t._jsGlobal!=window&&(t._jsGlobal.String=window.String),t?r=c.call(this,t)||this:r=c.call(this,new de(window,Be))||this,r.performCacheBusting=n||!1,r}return e.prototype.loadKeyboardInternal=function(t,n,r){var i=this,o=new L;this.performCacheBusting&&(t=this.cacheBust(t));try{var l=this.harness._jsGlobal.document,a=l.createElement("script");r&&(a.id=r),l.head.appendChild(a),a.onerror=function(s){o.reject(n.missingError(s))},a.onload=function(){if(i.harness.loadedKeyboard){var s=i.harness.loadedKeyboard;i.harness.loadedKeyboard=null,o.resolve(s)}else o.reject(n.scriptError())},o.then(function(){a.remove()}).catch(function(){a.remove()}),a.src=t}catch(s){return Promise.reject(s)}return o.corePromise},e.prototype.cacheBust=function(t){return t+"?v="+new Date().getTime()},e}(In);function He(c,e){var t=new Map;return e.keys.forEach(function(n){var r=Math.abs(c.x-n.centerX),i=Math.abs(c.y-n.centerY),o,l;r>.5*n.width?(o=r-.5*n.width,r=.5):(o=0,r/=n.width),i>.5*n.height?(l=i-.5*n.height,i=.5):(l=0,i/=n.height),o*=e.kbdScaleRatio,o+=r*n.height,l+=i*n.height;var a=o*o+l*l;t.set(n.keySpec,a)}),t}function Rt(c){var e,t,n,r,i,o,l,a=new Map,s=0;Array.isArray(c)||(c=[c]);try{for(var B=(0,d.__values)(c),g=B.next();!g.done;g=B.next()){var u=g.value;try{for(var F=(n=void 0,(0,d.__values)(u.keys())),y=F.next();!y.done;y=F.next()){var I=y.value,Q=1/(Math.pow(u.get(I),2)+3e-5);s+=Q,a.set(I,(l=a.get(I))!==null&&l!==void 0?l:0+Q)}}catch(p){n={error:p}}finally{try{y&&!y.done&&(r=F.return)&&r.call(F)}finally{if(n)throw n.error}}}}catch(p){e={error:p}}finally{try{g&&!g.done&&(t=B.return)&&t.call(B)}finally{if(e)throw e.error}}var U=[];try{for(var h=(0,d.__values)(a.keys()),b=h.next();!b.done;b=h.next()){var I=b.value;U.push({keySpec:I,p:a.get(I)/s})}}catch(p){i={error:p}}finally{try{b&&!b.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return U.sort(function(p,X){return X.p-p.p})}var fo=function(){function c(e,t,n){this.keySpec=n,this.centerX=n.proportionalX,this.centerY=t.proportionalY,this.width=n.proportionalWidth,this.height=e.rowProportionalHeight}return c}();function Jo(c){return c.baseKeyID?C.isFrameKey(c.baseKeyID)?!1:!c.isPadding:!1}function cc(c,e){return{keys:c.row.map(function(t){return t.key.map(function(n){return new fo(c,t,n)})}).reduce(function(t,n){return t.concat(n)},[]).filter(function(t){return Jo(t.keySpec)}),kbdScaleRatio:e}}var Wo=function(){function c(e,t,n){this.left=e.getTextBeforeCaret(),this.startOfBuffer=this.left._kmwLength()<=t.leftContextCodePoints,this.startOfBuffer||(this.left=this.left._kmwSubstr(-t.leftContextCodePoints)),this.right=e.getTextAfterCaret(),this.endOfBuffer=this.right._kmwLength()<=t.rightContextCodePoints,this.endOfBuffer||(this.right=this.right._kmwSubstr(0,t.rightContextCodePoints)),this.casingForm=n=="shift"?"initial":n=="caps"?"upper":null}return c.prototype.toMock=function(){var e=this.left._kmwLength();return new Y(this.left+(this.right||""),e)},c.ENGINE_RULE_WINDOW={leftContextCodePoints:64,rightContextCodePoints:32},c}(),Xt=Wo;var So=function(){function c(){this._promises=new Map}return Object.defineProperty(c.prototype,"length",{get:function(){return this._promises.size},enumerable:!1,configurable:!0}),c.prototype.make=function(e,t,n){if(this._promises.has(e))return n("Existing request with token ".concat(e));this._promises.set(e,{reject:n,resolve:t})},c.prototype.keep=function(e,t){var n=this._promises.get(e);if(!n)throw new Error("No promise associated with token: ".concat(e));var r=n.resolve;return this._promises.delete(e),r(t)},c.prototype.break=function(e,t){var n=this._promises.get(e);if(!n)throw new Error("No promise associated with token: ".concat(e));this._promises.delete(e),n.reject(t)},c}(),ye=So;var Lo=function(){function c(e,t,n){this._worker=t,this._worker.onmessage=this.onMessage.bind(this),this._declareLMLayerReady=null,this._predictPromises=new ye,this._wordbreakPromises=new ye,this._acceptPromises=new ye,this._revertPromises=new ye,this._nextToken=Number.MIN_SAFE_INTEGER,this.sendConfig(e,!!n)}return c.prototype.sendConfig=function(e,t){this._worker.postMessage({message:"config",capabilities:e,testMode:t})},c.prototype.loadModel=function(e,t){var n=this;return t===void 0&&(t="file"),new Promise(function(r,i){n._declareLMLayerReady=r;var o={type:t};t=="file"?o.file=e:o.code=e,n._worker.postMessage({message:"load",source:o})})},c.prototype.unloadModel=function(){this._worker.postMessage({message:"unload"})},c.prototype.predict=function(e,t){var n=this,r=this._nextToken++;return new Promise(function(i,o){n._predictPromises.make(r,i,o),n._worker.postMessage({message:"predict",token:r,transform:e,context:t})})},c.prototype.wordbreak=function(e){var t=this,n=this._nextToken++;return new Promise(function(r,i){t._wordbreakPromises.make(n,r,i),t._worker.postMessage({message:"wordbreak",token:n,context:e})})},c.prototype.acceptSuggestion=function(e,t,n){var r=this,i=this._nextToken++;return new Promise(function(o,l){r._acceptPromises.make(i,o,l),r._worker.postMessage({message:"accept",token:i,suggestion:e,context:t,postTransform:n})})},c.prototype.revertSuggestion=function(e,t){var n=this,r=this._nextToken++;return new Promise(function(i,o){n._revertPromises.make(r,i,o),n._worker.postMessage({message:"revert",token:r,reversion:e,context:t})})},c.prototype.resetContext=function(e){this._worker.postMessage({message:"reset-context",context:e})},c.prototype.onMessage=function(e){var t=e.data;if(t.message==="error")console.error(t.log),t.error&&console.error(t.error);else if(t.message==="ready")this._declareLMLayerReady(e.data.configuration);else if(t.message==="suggestions")this._predictPromises.keep(t.token,t.suggestions);else if(t.message==="currentword")this._wordbreakPromises.keep(t.token,t.word);else if(t.message==="postaccept")this._acceptPromises.keep(t.token,t.reversion);else if(t.message==="postrevert")this._revertPromises.keep(t.token,t.suggestions);else throw new Error("Message not implemented: ".concat(t.message))},c.prototype.shutdown=function(){this._worker.terminate()},c}(),En=Lo;function ke(c){return c}var ic='"use strict";/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){"use strict";var R=function(){try{var P={},N=Object.defineProperty,x=N(P,P,P)&&N}catch(M){}return x}(),T=function(P){if(this==null)throw TypeError();var N=String(this),x=N.length,M=P?Number(P):0;if(M!=M&&(M=0),!(M<0||M>=x)){var j=N.charCodeAt(M),D;return j>=55296&&j<=56319&&x>M+1&&(D=N.charCodeAt(M+1),D>=56320&&D<=57343)?(j-55296)*1024+D-56320+65536:j}};R?R(String.prototype,"codePointAt",{value:T,configurable:!0,writable:!0}):String.prototype.codePointAt=T}(),function(){if(!Array.from){var P=function(x){return x=x.charCodeAt(0),x>=55296&&x<=56319},N=function(x){return x=x.charCodeAt(0),x>=56320&&x<=57343},R=P,T=N;Array.from=function(x){if(Array.isArray(x))return x.slice();if(typeof x=="string"){for(var M=x.split(""),j=[],D;M.length>0;){var K=M.shift();P(K)&&N(M[0]||"")&&(K=K+M.shift(),console.log(K)),j.push(K)}return j}else throw"Unexpected + nonpolyfilled use of Array.from encountered; aborting"}}}(),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(R){if(this==null)throw new TypeError("this is null or not defined");for(var T=Object(this),P=T.length>>>0,N=arguments[1],x=N>>0,M=x<0?Math.max(P+x,0):Math.min(x,P),j=arguments[2],D=j===void 0?P:j>>0,K=D<0?Math.max(P+D,0):Math.min(D,P);M<K;)T[M]=R,M++;return T}});/**\n* Array.prototype.findIndex() polyfill\n* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex\n* @license MIT\n*/Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(R){if(this==null)throw new TypeError(\'"this" is null or not defined\');var T=Object(this),P=T.length>>>0;if(typeof R!="function")throw new TypeError("predicate must be a function");for(var N=arguments[1],x=0;x<P;){var M=T[x];if(R.call(N,M,x,T))return x;x++}return-1},configurable:!0,writable:!0}),Array.prototype.includes||(Array.prototype.includes=function(R){return!!~this.indexOf(R)}),Object.keys||(Object.keys=function(){"use strict";var R=Object.prototype.hasOwnProperty,T=!{toString:null}.propertyIsEnumerable("toString"),P=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],N=P.length;return function(x){if(typeof x!="function"&&(typeof x!="object"||x===null))throw new TypeError("Object.keys called on non-object");var M=[],j,D;for(j in x)R.call(x,j)&&M.push(j);if(T)for(D=0;D<N;D++)R.call(x,P[D])&&M.push(P[D]);return M}}());var reduce=Function.bind.call(Function.call,Array.prototype.reduce),isEnumerable=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),concat=Function.bind.call(Function.call,Array.prototype.concat),keys=Object.keys;Object.values||(Object.values=function(T){return reduce(keys(T),function(P,N){return concat(P,typeof N=="string"&&isEnumerable(T,N)?[T[N]]:[])},[])}),Object.entries||(Object.entries=function(T){return reduce(keys(T),function(P,N){return concat(P,typeof N=="string"&&isEnumerable(T,N)?[[N,T[N]]]:[])},[])}),self.Symbol||function(R,T){"use strict";typeof module=="object"&&typeof module.exports=="object"?module.exports=T(R):T(R)}(typeof window!="undefined"?window:self||global,function(R){"use strict";var T=Object.defineProperty,P=Object.defineProperties,N=0,x=[],M=Array.prototype.slice,j=typeof R.ES6=="object"?R.ES6:R.ES6={},D=Array.isArray,K=Object.prototype.toString,Re=Array.prototype.push,ke=function(){},xe=function(p){return p},_=function(p){return typeof p=="function"},me=function(){},H=function(p,y){this._array=p,this._flag=y,this._nextIndex=0},oe=function(p,y){this._string=p,this._flag=y,this._nextIndex=0},se=function(p){return p!==null&&(typeof p=="object"||typeof p=="function")},De=function(p,y){return P(p,{_description:{value:y},_isSymbol:{value:!0},_id:{value:N++}}),p},Te=function(p,y){if(typeof p.length=="number"&&p.length>=0&&typeof y.length=="number"&&y.length>=0){var q=Math.floor(p.length),A=Math.floor(y.length),U=0;for(p.length=q+A;U<A;++U)y.hasOwnProperty(U)&&(p[q+U]=y[U])}},le=function(p,y){if(typeof p!="function"||typeof y!="function")throw new TypeError("Child and Parent must be function type");p.prototype=Object.create(y.prototype),p.prototype.constructor=p},E=function p(y){if(y=y===void 0?"":String(y),this instanceof p)throw new TypeError("Symbol is not a constructor");return De(Object.create(p.prototype),y)};P(E,{for:{value:function(p){p=String(p);for(var y,q=x.length,A=0;A<q;++A)if((y=x[A]).key===p)return y.symbol;return y={key:p,symbol:E(p)},x.push(y),y.symbol},writable:!0,configurable:!0},keyFor:{value:function(p){if(!j.isSymbol(p))throw new TypeError(String(p)+" is not a symbol");for(var y,q=x.length,A=0;A<q;++A)if((y=x[A]).symbol===p)return y.key},writable:!0,configurable:!0},hasInstance:{value:E("Symbol.hasInstance")},isConcatSpreadable:{value:E("Symbol.isConcatSpreadable")},iterator:{value:E("Symbol.iterator")},toStringTag:{value:E("Symbol.toStringTag")}}),E.prototype.toString=function(){return"@@_____"+this._id+"_____"},E.prototype.valueOf=function(){return this},T(me.prototype,E.iterator.toString(),{value:function(){return this},writable:!0,configurable:!0}),le(H,me),le(oe,me),T(H.prototype,E.toStringTag.toString(),{value:"Array Iterator",configurable:!0}),T(oe.prototype,E.toStringTag.toString(),{value:"String Iterator",configurable:!0}),H.prototype.next=function(){if(!(this instanceof H))throw new TypeError("Method Array Iterator.prototype.next called on incompatible receiver "+String(this));var p;return this._nextIndex===-1?{done:!0,value:void 0}:typeof this._array.length=="number"&&this._array.length>=0&&this._nextIndex<Math.floor(this._array.length)?(this._flag===1?p=[this._nextIndex,this._array[this._nextIndex]]:this._flag===2?p=this._array[this._nextIndex]:this._flag===3&&(p=this._nextIndex),this._nextIndex++,{done:!1,value:p}):(this._nextIndex=-1,{done:!0,value:void 0})},oe.prototype.next=function(){if(!(this instanceof oe))throw new TypeError("Method String Iterator.prototype.next called on incompatible receiver "+String(this));var p,y=new String(this._string);return this._nextIndex===-1?{done:!0,value:void 0}:this._nextIndex<y.length?(p=y[this._nextIndex],this._nextIndex++,{done:!1,value:p}):(this._nextIndex=-1,{done:!0,value:void 0})};var G=function(p,y){this._target=p,this._values=[],this._thisArg=y};return G.prototype.spread=function(){var p=this;return M.call(arguments).forEach(function(y){j.forOf(y,function(q){p._values.push(q)})}),p},G.prototype.add=function(){var p=this;return M.call(arguments).forEach(function(y){p._values.push(y)}),p},G.prototype.call=function(p){if(typeof this._target!="function")throw new TypeError("Target is not a function");return p=arguments.length<=0?this._thisArg:p,this._target.apply(p,this._values)},G.prototype.new=function(){if(typeof this._target!="function")throw new TypeError("Target is not a constructor");var p,y;return p=Object.create(this._target.prototype),y=this._target.apply(p,this._values),se(y)?y:p},G.prototype.array=function(){if(!D(this._target))throw new TypeError("Target is not a array");return Re.apply(this._target,this._values),this._target},P(j,{isSymbol:{value:function(p){return p instanceof E&&function(y){return y._isSymbol===!0&&typeof y._id=="number"&&typeof y._description=="string"}(p)},writable:!0,configurable:!0},instanceOf:{value:function(p,y){if(!se(y))throw new TypeError("Right-hand side of \'instanceof\' is not an object");var q=y[E.hasInstance];if(q===void 0)return p instanceof y;if(typeof q!="function")throw new TypeError(typeof q+" is not a function");return q.call(y,p)},writable:!0,configurable:!0},forOf:{value:function(p,y,q){if(y=typeof y!="function"?ke:y,typeof p[E.iterator]!="function")throw new TypeError("Iterable[Symbol.iterator] is not a function");var A,U=p[E.iterator]();if(typeof U.next!="function")throw new TypeError(".iterator.next is not a function");for(;;){if(A=U.next(),!se(A))throw new TypeError("Iterator result "+A+" is not an object");if(A.done)break;y.call(q,A.value)}},writable:!0,configurable:!0},spreadOperator:{value:function(p,y){if(typeof p!="function"&&!D(p))throw new TypeError("Spread operator only supports on array and function objects at this moment");return new G(p,y)},writable:!0,configurable:!0}}),T(R,"Symbol",{value:E,writable:!0,configurable:!0}),T(Function.prototype,E.hasInstance.toString(),{value:function(p){return typeof this=="function"&&p instanceof this}}),T(Array.prototype,"concat",{value:function(){if(this===void 0||this===null)throw new TypeError("Array.prototype.concat called on null or undefined");var p=Object(this),y=M.call(arguments),q=[];return y.unshift(p),y.forEach(function(A){se(A)?A[E.isConcatSpreadable]!==void 0?A[E.isConcatSpreadable]?Te(q,A):q.push(A):D(A)?Te(q,A):q.push(A):q.push(A)}),q},writable:!0,configurable:!0}),T(Object.prototype,"toString",{value:function(){return this===void 0||this===null?K.call(this):typeof this[E.toStringTag]=="string"?"[object "+this[E.toStringTag]+"]":K.call(this)},writable:!0,configurable:!0}),T(Array.prototype,E.iterator.toString(),{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var p=Object(this);return new H(p,2)},writable:!0,configurable:!0}),T(Array,"from",{value:function(p,y,q){var A,U,X,ce=0;if(A=_(this)?this:Array,p==null)throw new TypeError("Cannot convert undefined or null to object");if(p=Object(p),y===void 0)y=xe;else if(!_(y))throw new TypeError(y+" is not a function");if(p[E.iterator]===void 0){if(!(typeof p.length=="number"&&p.length>=0))return(X=new A(0)).length=0,X;for(U=Math.floor(p.length),(X=new A(U)).length=U;ce<U;++ce)X[ce]=y.call(q,p[ce])}else(X=new A).length=0,j.forOf(p,function(z){X.length++,X[X.length-1]=y.call(q,z)});return X},writable:!0,configurable:!0}),T(Array.prototype,"entries",{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var p=Object(this);return new H(p,1)},writable:!0,configurable:!0}),T(Array.prototype,"keys",{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var p=Object(this);return new H(p,3)},writable:!0,configurable:!0}),T(String.prototype,E.iterator.toString(),{value:function(){if(this===void 0||this===null)throw new TypeError("String.prototype[Symbol.iterator] called on null or undefined");return new oe(String(this),0)},writable:!0,configurable:!0}),j}),function(){var R=Object.create,T=Object.defineProperty,P=Object.getOwnPropertyDescriptor,N=Object.getOwnPropertyNames,x=Object.getPrototypeOf,M=Object.prototype.hasOwnProperty,j=function(r,e){return function(){return e||(0,r[N(r)[0]])((e={exports:{}}).exports,e),e.exports}},D=function(r,e){for(var t in e)T(r,t,{get:e[t],enumerable:!0})},K=function(r,e,t,n){if(e&&typeof e=="object"||typeof e=="function")for(var i=N(e),o=0,a=i.length,u;o<a;o++)u=i[o],!M.call(r,u)&&u!==t&&T(r,u,{get:function(s){return e[s]}.bind(null,u),enumerable:!(n=P(e,u))||n.enumerable});return r},Re=function(r,e,t){return K(r,e,"default"),t&&K(t,e,"default")},ke=function(r,e,t){return t=r!=null?R(x(r)):{},K(e||!r||!r.__esModule?T(t,"default",{value:r,enumerable:!0}):t,r)},xe=j({"../../../node_modules/tslib/tslib.js":function(r,e){var t,n,i,o,a,u,s,c,f;(function(l){var d=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(g){l(h(d,h(g)))}):typeof e=="object"&&typeof e.exports=="object"?l(h(d,h(e.exports))):l(h(d));function h(g,v){return g!==d&&(typeof Object.create=="function"?Object.defineProperty(g,"__esModule",{value:!0}):g.__esModule=!0),function(S,b){return g[S]=v?v(S,b):b}}})(function(l){var d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,g){h.__proto__=g}||function(h,g){for(var v in g)Object.prototype.hasOwnProperty.call(g,v)&&(h[v]=g[v])};t=function(h,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");d(h,g);function v(){this.constructor=h}h.prototype=g===null?Object.create(g):(v.prototype=g.prototype,new v)},n=Object.assign||function(h){for(var g,v=1,S=arguments.length;v<S;v++){g=arguments[v];for(var b in g)Object.prototype.hasOwnProperty.call(g,b)&&(h[b]=g[b])}return h},i=function(h,g,v,S){function b(m){return m instanceof v?m:new v(function(C){C(m)})}return new(v||(v=Promise))(function(m,C){function k(F){try{w(S.next(F))}catch(B){C(B)}}function O(F){try{w(S.throw(F))}catch(B){C(B)}}function w(F){F.done?m(F.value):b(F.value).then(k,O)}w((S=S.apply(h,g||[])).next())})},o=function(h,g){var v={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},S,b,m,C;return C={next:k(0),throw:k(1),return:k(2)},typeof Symbol=="function"&&(C[Symbol.iterator]=function(){return this}),C;function k(w){return function(F){return O([w,F])}}function O(w){if(S)throw new TypeError("Generator is already executing.");for(;C&&(C=0,w[0]&&(v=0)),v;)try{if(S=1,b&&(m=w[0]&2?b.return:w[0]?b.throw||((m=b.return)&&m.call(b),0):b.next)&&!(m=m.call(b,w[1])).done)return m;switch(b=0,m&&(w=[w[0]&2,m.value]),w[0]){case 0:case 1:m=w;break;case 4:return v.label++,{value:w[1],done:!1};case 5:v.label++,b=w[1],w=[0];continue;case 7:w=v.ops.pop(),v.trys.pop();continue;default:if(m=v.trys,!(m=m.length>0&&m[m.length-1])&&(w[0]===6||w[0]===2)){v=0;continue}if(w[0]===3&&(!m||w[1]>m[0]&&w[1]<m[3])){v.label=w[1];break}if(w[0]===6&&v.label<m[1]){v.label=m[1],m=w;break}if(m&&v.label<m[2]){v.label=m[2],v.ops.push(w);break}m[2]&&v.ops.pop(),v.trys.pop();continue}w=g.call(h,v)}catch(F){w=[6,F],b=0}finally{S=m=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}},a=function(h){var g=typeof Symbol=="function"&&Symbol.iterator,v=g&&h[g],S=0;if(v)return v.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&S>=h.length&&(h=void 0),{value:h&&h[S++],done:!h}}};throw new TypeError(g?"Object is not iterable.":"Symbol.iterator is not defined.")},u=function(h,g){var v=typeof Symbol=="function"&&h[Symbol.iterator];if(!v)return h;var S=v.call(h),b,m=[],C;try{for(;(g===void 0||g-- >0)&&!(b=S.next()).done;)m.push(b.value)}catch(k){C={error:k}}finally{try{b&&!b.done&&(v=S.return)&&v.call(S)}finally{if(C)throw C.error}}return m},s=function(h){return this instanceof s?(this.v=h,this):new s(h)},c=function(h,g,v){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var S=v.apply(h,g||[]),b,m=[];return b={},C("next"),C("throw"),C("return"),b[Symbol.asyncIterator]=function(){return this},b;function C(L){S[L]&&(b[L]=function(Q){return new Promise(function(J,ae){m.push([L,Q,J,ae])>1||k(L,Q)})})}function k(L,Q){try{O(S[L](Q))}catch(J){B(m[0][3],J)}}function O(L){L.value instanceof s?Promise.resolve(L.value.v).then(w,F):B(m[0][2],L)}function w(L){k("next",L)}function F(L){k("throw",L)}function B(L,Q){L(Q),m.shift(),m.length&&k(m[0][0],m[0][1])}},f=function(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g=h[Symbol.asyncIterator],v;return g?g.call(h):(h=typeof a=="function"?a(h):h[Symbol.iterator](),v={},S("next"),S("throw"),S("return"),v[Symbol.asyncIterator]=function(){return this},v);function S(m){v[m]=h[m]&&function(C){return new Promise(function(k,O){C=h[m](C),b(k,O,C.done,C.value)})}}function b(m,C,k,O){Promise.resolve(O).then(function(w){m({value:w,done:k})},C)}},l("__extends",t),l("__assign",n),l("__awaiter",i),l("__generator",o),l("__values",a),l("__read",u),l("__await",s),l("__asyncGenerator",c),l("__asyncValues",f)})}}),_={};D(_,{tslib:function(){return me}}),Re(_,ke(xe(),1));var me=ke(xe(),1);function H(){String.kmwFromCharCode=function(r){var e=[],t;for(t=0;t<arguments.length;t++){var n=Number(arguments[t]);if(!isFinite(n)||n<0||n>1114111||Math.floor(n)!==n)throw new RangeError("Invalid code point "+n);n<65536?e.push(n):(n-=65536,e.push((n>>10)+55296),e.push(n%1024+56320))}return String.fromCharCode.apply(void 0,e)},String.prototype.kmwCharCodeAt=function(r){var e=String(this),t=0;if(r<0||r>=e.length)return NaN;for(var n=0;n<r;n++)if(t=e.kmwNextChar(t),t===null)return NaN;var i=e.charCodeAt(t);if(i>=55296&&i<=56319&&e.length>t+1){var o=e.charCodeAt(t+1);if(o>=56320&&o<=57343)return(i-55296<<10)+(o-56320)+65536}return i},String.prototype.kmwIndexOf=function(r,e){var t=String(this),n=t.indexOf(r,e);if(n<0)return n;for(var i=0,o=0;o!==null&&o<n;o=t.kmwNextChar(o))i++;return i},String.prototype.kmwLastIndexOf=function(r,e){var t=String(this),n=t.lastIndexOf(r,e);if(n<0)return n;for(var i=0,o=0;o!==null&&o<n;o=t.kmwNextChar(o))i++;return i},String.prototype.kmwLength=function(){var r=String(this);if(r.length==0)return 0;for(var e=0,t=0;t!==null;e++)t=r.kmwNextChar(t);return e},String.prototype.kmwSlice=function(r,e){var t=String(this),n=t.kmwCodePointToCodeUnit(r),i=t.kmwCodePointToCodeUnit(e);return n===null||i===null?"":t.slice(n,i)},String.prototype.kmwSubstr=function(r,e){var t=String(this);r<0&&(r=t.kmwLength()+r),r<0&&(r=0);var n=t.kmwCodePointToCodeUnit(r),i=n;if(n===null)return"";if(arguments.length<2)i=t.length;else for(var o=0;o<e;o++)i=t.kmwNextChar(i);return i===null?t.substring(n):t.substring(n,i)},String.prototype.kmwSubstring=function(r,e){var t=String(this),n,i;if(typeof e=="undefined")n=t.kmwCodePointToCodeUnit(r),i=t.length;else{if(r>e){var o=r;r=e,e=o}n=t.kmwCodePointToCodeUnit(r),i=t.kmwCodePointToCodeUnit(e)}return(isNaN(n)||n===null)&&(n=0),(isNaN(i)||i===null)&&(i=t.length),t.substring(n,i)},String.prototype.kmwNextChar=function(r){var e=String(this);if(r===null||r<0||r>=e.length-1)return null;var t=e.charCodeAt(r);if(t>=55296&&t<=56319&&e.length>r+1){var n=e.charCodeAt(r+1);if(n>=56320&&n<=57343)return r==e.length-2?null:r+2}return r+1},String.prototype.kmwPrevChar=function(r){var e=String(this);if(r==null||r<=0||r>e.length)return null;var t=e.charCodeAt(r-1);if(t>=56320&&t<=57343&&r>1){var n=e.charCodeAt(r-2);if(n>=55296&&n<=56319)return r-2}return r-1},String.prototype.kmwCodePointToCodeUnit=function(r){if(r===null)return null;var e=String(this),t=0;if(r<0){t=e.length;for(var n=0;n>r;n--)t=e.kmwPrevChar(t);return t}if(r==e.kmwLength())return e.length;for(var n=0;n<r;n++)t=e.kmwNextChar(t);return t},String.prototype.kmwCodeUnitToCodePoint=function(r){var e=String(this);return r===null?null:r==0?0:r<0?e.substr(r).kmwLength():e.substr(0,r).kmwLength()},String.prototype.kmwCharAt=function(r){var e=String(this);return r>=0?e.kmwSubstr(r,1):""},String.prototype.kmwBMPNextChar=function(r){var e=String(this);return r<0||r>=e.length-1?null:r+1},String.prototype.kmwBMPPrevChar=function(r){var e=String(this);return r<=0||r>e.length?null:r-1},String.prototype.kmwBMPCodePointToCodeUnit=function(r){return r},String.prototype.kmwBMPCodeUnitToCodePoint=function(r){return r},String.prototype.kmwBMPLength=function(){var r=String(this);return r.length},String.prototype.kmwBMPSubstr=function(r,e){var t=String(this);return r>-1?t.substr(r,e):t.substr(t.length+r,-r)},String.kmwEnableSupplementaryPlane=function(r){var e=String.prototype;String._kmwFromCharCode=r?String.kmwFromCharCode:String.fromCharCode,e._kmwCharAt=r?e.kmwCharAt:e.charAt,e._kmwCharCodeAt=r?e.kmwCharCodeAt:e.charCodeAt,e._kmwIndexOf=r?e.kmwIndexOf:e.indexOf,e._kmwLastIndexOf=r?e.kmwLastIndexOf:e.lastIndexOf,e._kmwSlice=r?e.kmwSlice:e.slice,e._kmwSubstring=r?e.kmwSubstring:e.substring,e._kmwSubstr=r?e.kmwSubstr:e.kmwBMPSubstr,e._kmwLength=r?e.kmwLength:e.kmwBMPLength,e._kmwNextChar=r?e.kmwNextChar:e.kmwBMPNextChar,e._kmwPrevChar=r?e.kmwPrevChar:e.kmwBMPPrevChar,e._kmwCodePointToCodeUnit=r?e.kmwCodePointToCodeUnit:e.kmwBMPCodePointToCodeUnit,e._kmwCodeUnitToCodePoint=r?e.kmwCodeUnitToCodePoint:e.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}H();var oe=function(){function r(e){var t=this;this._isFulfilled=!1,this._isRejected=!1,this._promise=new Promise(function(n,i){t._resolve=function(o){t._isFulfilled=!0,n(o)},t._reject=function(o){t._isRejected=!0,i(o)},e&&e(t._resolve,t._reject)})}return Object.defineProperty(r.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isFulfilled",{get:function(){return this._isFulfilled},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isRejected",{get:function(){return this._isRejected},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isResolved",{get:function(){return this.isFulfilled||this.isRejected},enumerable:!1,configurable:!0}),r.prototype.then=function(e,t){return this._promise.then(e,t)},r.prototype.catch=function(e){return this._promise.catch(e)},r.prototype.finally=function(e){return this._promise.finally(e)},Object.defineProperty(r.prototype,"corePromise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),r}(),se=oe,De=function(r){(0,_.__extends)(e,r);function e(t){var n=this,i=null;n=r.call(this,function(u){var s=setTimeout(function(){n.isResolved||u(!0)},t);i=s})||this,n.timerHandle=i;var o=n._resolve;n._resolve=function(u){clearTimeout(n.timerHandle),o(u)};var a=n._reject;return n._reject=function(u){clearTimeout(n.timerHandle),a(u)},n}return e}(se),Te=function(r){var e=new De(r);return e.corePromise},le={};D(le,{DummyModel:function(){return Wt},PriorityQueue:function(){return z},QuoteBehavior:function(){return Oe},SENTINEL_CODE_UNIT:function(){return E},TrieModel:function(){return Rt},applyTransform:function(){return G},buildMergedTransform:function(){return p},defaultApplyCasing:function(){return X},getLastPreCaretToken:function(){return Fe},isHighSurrogate:function(){return y},isLowSurrogate:function(){return q},isSentinel:function(){return A},tokenize:function(){return Ae},transformToSuggestion:function(){return U},wordbreak:function(){return je}}),H();var E="\\uFDD0";function G(r,e){var t,n,i=e.left||"",o=i.kmwLength(),a=o<r.deleteLeft?o:r.deleteLeft,u=i.kmwSubstr(0,o-a)+(r.insert||""),s=e.right||"",c=s.kmwLength(),f=c<((t=r.deleteRight)!==null&&t!==void 0?t:0)?c:(n=r.deleteRight)!==null&&n!==void 0?n:0,l=s.kmwSubstr(f);return{left:u,right:l,startOfBuffer:e.startOfBuffer,endOfBuffer:e.endOfBuffer,casingForm:e.casingForm}}function p(r,e){var t=r.insert,n=e.deleteLeft;if(e.deleteLeft){var i=r.insert.kmwLength();i<=e.deleteLeft?(t="",n=e.deleteLeft-i):(t=r.insert.kmwSubstr(0,i-e.deleteLeft),n=0)}return{insert:t+e.insert,deleteLeft:r.deleteLeft+n,deleteRight:(r.deleteRight||0)+(e.deleteRight||0)}}function y(r){return typeof r=="string"&&(r=r.charCodeAt(0)),r>=55296&&r<=56319}function q(r){return typeof r=="string"&&(r=r.charCodeAt(0)),r>=56320&&r<=57343}function A(r){return r==E}function U(r,e){var t={transform:r,transformId:r.id,displayAs:r.insert};return(e===0||e)&&(t.p=e),t}function X(r,e){switch(r){case"lower":return e.toLowerCase();case"upper":return e.toUpperCase();case"initial":var t=1;return e.length>1&&y(e.charAt(0))&&q(e.charCodeAt(1))&&(t=2),e.substring(0,t).toUpperCase().concat(e.substring(t))}}var ce=function(){function r(e,t){if(typeof e!="function"){this.comparator=e.comparator,this.heap=[].concat(e.heap);return}var n=e;this.comparator=n,this.heap=(t!=null?t:[]).slice(0),this.heapify()}return r.leftChildIndex=function(e){return e*2+1},r.rightChildIndex=function(e){return e*2+2},r.parentIndex=function(e){return Math.floor((e-1)/2)},r.prototype.heapify=function(e,t){if(e==null||t==null){this.heapify(0,this.count-1);return}for(var n=[],i=-1,o=t;o>=e;o--){var a=r.parentIndex(o);this.siftDown(o)&&a<e&&i!=a&&(n.push(a),i=a)}for(i=-1;n.length>0;){var u=n.shift(),a=r.parentIndex(u);this.siftDown(u)&&a>=0&&i!=a&&(n.push(a),i=a)}},Object.defineProperty(r.prototype,"count",{get:function(){return this.heap.length},enumerable:!1,configurable:!0}),r.prototype.peek=function(){return this.heap[0]},r.prototype.enqueue=function(e){var t=this.heap.length;this.heap.push(e);for(var n=r.parentIndex,i=n(t);t!==0&&this.comparator(this.heap[t],this.heap[i])<0;){var o=this.heap[t];this.heap[t]=this.heap[i],this.heap[i]=o,t=i,i=n(t)}},r.prototype.enqueueAll=function(e){if(e.length!=0){var t=this.count;this.heap=this.heap.concat(e);var n=r.parentIndex(t);this.heapify(n>=0?n:0,r.parentIndex(this.count-1))}},r.prototype.dequeue=function(){if(this.count!=0){var e=this.heap[0],t=this.heap.pop();return this.heap.length>0&&(this.heap[0]=t,this.siftDown(0)),e}},r.prototype.siftDown=function(e){var t=r.leftChildIndex(e),n=r.rightChildIndex(e),i=e;if(t<this.heap.length&&this.comparator(this.heap[t],this.heap[i])<0&&(i=t),n<this.heap.length&&this.comparator(this.heap[n],this.heap[i])<0&&(i=n),i!=e){var o=this.heap[e];return this.heap[e]=this.heap[i],this.heap[i]=o,this.siftDown(i),!0}else return!1},r.prototype.toArray=function(){return this.heap.slice(0)},r}(),z=ce,we;(function(r){r.noQuotes="no-quotes",r.useQuotes="use-quotes",r.default="default-quotes"})(we||(we={})),function(r){function e(t,n,i,o){if(o==r.default||!o)throw"Specified quote behavior may be ambiguous - default behavior not specified (may not be .default)";switch(t==r.default&&(t=o),t){case r.noQuotes:return n;case r.useQuotes:var a=i.quotesForKeepSuggestion,u=a.open,s=a.close;return u+n+s;default:throw"Unsupported quote behavior state detected; implementation missing!"}}r.apply=e}(we||(we={}));var Oe=we;function Ae(r,e){e=e||{left:void 0,startOfBuffer:void 0,endOfBuffer:void 0};var t=r(e.left||"")||[],n=r(e.right||"")||[],i;if(t.length>0&&(i=t[t.length-1]),t.length>1){var o=t[t.length-2];if(o.end==i.start&&i.text=="\'"){var a={text:o.text+i.text,start:o.start,end:i.end,length:o.length+i.length};t.pop(),t.pop(),t.push(a),i=a}}var u={left:t.map(function(l){return l.text}),right:n.map(function(l){return l.text}),caretSplitsToken:!1};if(t.length>0&&n.length>0){var s=n[0],c=i.end!=e.left.length,f=s.start!=0;if(c||f)return u;r(i.text+s.text).length==1&&(u.caretSplitsToken=!0)}return u}function Fe(r,e){var t=Ae(r,e);return t.left.length>0?t.left.pop():""}function je(r,e){return Fe(r,e)}var Ue={};D(Ue,{ascii:function(){return At},default:function(){return fe},defaultWordbreaker:function(){return fe},placeholder:function(){return Ot}});function Ot(r){var e=0;return r.split(/\\s+/).map(function(t){var n={start:e,end:e+t.length,text:t,length:t.length};return e=n.end,n})}function At(r){for(var e=/[A-Za-z0-9\']+/g,t=[],n;(n=e.exec(r))!==null;)t.push(new Pt(n[0],n.index));return t}var Pt=function(){function r(e,t){this.text=e,this.start=t}return Object.defineProperty(r.prototype,"length",{get:function(){return this.text.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"end",{get:function(){return this.start+this.text.length},enumerable:!1,configurable:!0}),r}(),Et=["Other","LF","Newline","CR","WSegSpace","Double_Quote","Single_Quote","MidNum","MidNumLet","Numeric","MidLetter","ALetter","ExtendNumLet","Format","Extend","Hebrew_Letter","ZWJ","Katakana","Regional_Indicator","sot","eot"],We=[[0,0],[10,1],[11,2],[13,3],[14,0],[32,4],[33,0],[34,5],[35,0],[39,6],[40,0],[44,7],[45,0],[46,8],[47,0],[48,9],[58,10],[59,7],[60,0],[65,11],[91,0],[95,12],[96,0],[97,11],[123,0],[133,2],[134,0],[170,11],[171,0],[173,13],[174,0],[181,11],[182,0],[183,10],[184,0],[186,11],[187,0],[192,11],[215,0],[216,11],[247,0],[248,11],[728,0],[734,11],[768,14],[880,11],[885,0],[886,11],[888,0],[890,11],[894,7],[895,11],[896,0],[902,11],[903,10],[904,11],[907,0],[908,11],[909,0],[910,11],[930,0],[931,11],[1014,0],[1015,11],[1154,0],[1155,14],[1162,11],[1328,0],[1329,11],[1367,0],[1369,11],[1373,0],[1374,11],[1375,10],[1376,11],[1417,7],[1418,11],[1419,0],[1425,14],[1470,0],[1471,14],[1472,0],[1473,14],[1475,0],[1476,14],[1478,0],[1479,14],[1480,0],[1488,15],[1515,0],[1519,15],[1523,11],[1524,10],[1525,0],[1536,13],[1542,0],[1548,7],[1550,0],[1552,14],[1563,0],[1564,13],[1565,0],[1568,11],[1611,14],[1632,9],[1642,0],[1643,9],[1644,7],[1645,0],[1646,11],[1648,14],[1649,11],[1748,0],[1749,11],[1750,14],[1757,13],[1758,0],[1759,14],[1765,11],[1767,14],[1769,0],[1770,14],[1774,11],[1776,9],[1786,11],[1789,0],[1791,11],[1792,0],[1807,13],[1808,11],[1809,14],[1810,11],[1840,14],[1867,0],[1869,11],[1958,14],[1969,11],[1970,0],[1984,9],[1994,11],[2027,14],[2036,11],[2038,0],[2040,7],[2041,0],[2042,11],[2043,0],[2045,14],[2046,0],[2048,11],[2070,14],[2074,11],[2075,14],[2084,11],[2085,14],[2088,11],[2089,14],[2094,0],[2112,11],[2137,14],[2140,0],[2144,11],[2155,0],[2208,11],[2229,0],[2230,11],[2248,0],[2259,14],[2274,13],[2275,14],[2308,11],[2362,14],[2365,11],[2366,14],[2384,11],[2385,14],[2392,11],[2402,14],[2404,0],[2406,9],[2416,0],[2417,11],[2433,14],[2436,0],[2437,11],[2445,0],[2447,11],[2449,0],[2451,11],[2473,0],[2474,11],[2481,0],[2482,11],[2483,0],[2486,11],[2490,0],[2492,14],[2493,11],[2494,14],[2501,0],[2503,14],[2505,0],[2507,14],[2510,11],[2511,0],[2519,14],[2520,0],[2524,11],[2526,0],[2527,11],[2530,14],[2532,0],[2534,9],[2544,11],[2546,0],[2556,11],[2557,0],[2558,14],[2559,0],[2561,14],[2564,0],[2565,11],[2571,0],[2575,11],[2577,0],[2579,11],[2601,0],[2602,11],[2609,0],[2610,11],[2612,0],[2613,11],[2615,0],[2616,11],[2618,0],[2620,14],[2621,0],[2622,14],[2627,0],[2631,14],[2633,0],[2635,14],[2638,0],[2641,14],[2642,0],[2649,11],[2653,0],[2654,11],[2655,0],[2662,9],[2672,14],[2674,11],[2677,14],[2678,0],[2689,14],[2692,0],[2693,11],[2702,0],[2703,11],[2706,0],[2707,11],[2729,0],[2730,11],[2737,0],[2738,11],[2740,0],[2741,11],[2746,0],[2748,14],[2749,11],[2750,14],[2758,0],[2759,14],[2762,0],[2763,14],[2766,0],[2768,11],[2769,0],[2784,11],[2786,14],[2788,0],[2790,9],[2800,0],[2809,11],[2810,14],[2816,0],[2817,14],[2820,0],[2821,11],[2829,0],[2831,11],[2833,0],[2835,11],[2857,0],[2858,11],[2865,0],[2866,11],[2868,0],[2869,11],[2874,0],[2876,14],[2877,11],[2878,14],[2885,0],[2887,14],[2889,0],[2891,14],[2894,0],[2901,14],[2904,0],[2908,11],[2910,0],[2911,11],[2914,14],[2916,0],[2918,9],[2928,0],[2929,11],[2930,0],[2946,14],[2947,11],[2948,0],[2949,11],[2955,0],[2958,11],[2961,0],[2962,11],[2966,0],[2969,11],[2971,0],[2972,11],[2973,0],[2974,11],[2976,0],[2979,11],[2981,0],[2984,11],[2987,0],[2990,11],[3002,0],[3006,14],[3011,0],[3014,14],[3017,0],[3018,14],[3022,0],[3024,11],[3025,0],[3031,14],[3032,0],[3046,9],[3056,0],[3072,14],[3077,11],[3085,0],[3086,11],[3089,0],[3090,11],[3113,0],[3114,11],[3130,0],[3133,11],[3134,14],[3141,0],[3142,14],[3145,0],[3146,14],[3150,0],[3157,14],[3159,0],[3160,11],[3163,0],[3168,11],[3170,14],[3172,0],[3174,9],[3184,0],[3200,11],[3201,14],[3204,0],[3205,11],[3213,0],[3214,11],[3217,0],[3218,11],[3241,0],[3242,11],[3252,0],[3253,11],[3258,0],[3260,14],[3261,11],[3262,14],[3269,0],[3270,14],[3273,0],[3274,14],[3278,0],[3285,14],[3287,0],[3294,11],[3295,0],[3296,11],[3298,14],[3300,0],[3302,9],[3312,0],[3313,11],[3315,0],[3328,14],[3332,11],[3341,0],[3342,11],[3345,0],[3346,11],[3387,14],[3389,11],[3390,14],[3397,0],[3398,14],[3401,0],[3402,14],[3406,11],[3407,0],[3412,11],[3415,14],[3416,0],[3423,11],[3426,14],[3428,0],[3430,9],[3440,0],[3450,11],[3456,0],[3457,14],[3460,0],[3461,11],[3479,0],[3482,11],[3506,0],[3507,11],[3516,0],[3517,11],[3518,0],[3520,11],[3527,0],[3530,14],[3531,0],[3535,14],[3541,0],[3542,14],[3543,0],[3544,14],[3552,0],[3558,9],[3568,0],[3570,14],[3572,0],[3633,14],[3634,0],[3636,14],[3643,0],[3655,14],[3663,0],[3664,9],[3674,0],[3761,14],[3762,0],[3764,14],[3773,0],[3784,14],[3790,0],[3792,9],[3802,0],[3840,11],[3841,0],[3864,14],[3866,0],[3872,9],[3882,0],[3893,14],[3894,0],[3895,14],[3896,0],[3897,14],[3898,0],[3902,14],[3904,11],[3912,0],[3913,11],[3949,0],[3953,14],[3973,0],[3974,14],[3976,11],[3981,14],[3992,0],[3993,14],[4029,0],[4038,14],[4039,0],[4139,14],[4159,0],[4160,9],[4170,0],[4182,14],[4186,0],[4190,14],[4193,0],[4194,14],[4197,0],[4199,14],[4206,0],[4209,14],[4213,0],[4226,14],[4238,0],[4239,14],[4240,9],[4250,14],[4254,0],[4256,11],[4294,0],[4295,11],[4296,0],[4301,11],[4302,0],[4304,11],[4347,0],[4348,11],[4681,0],[4682,11],[4686,0],[4688,11],[4695,0],[4696,11],[4697,0],[4698,11],[4702,0],[4704,11],[4745,0],[4746,11],[4750,0],[4752,11],[4785,0],[4786,11],[4790,0],[4792,11],[4799,0],[4800,11],[4801,0],[4802,11],[4806,0],[4808,11],[4823,0],[4824,11],[4881,0],[4882,11],[4886,0],[4888,11],[4955,0],[4957,14],[4960,0],[4992,11],[5008,0],[5024,11],[5110,0],[5112,11],[5118,0],[5121,11],[5741,0],[5743,11],[5760,4],[5761,11],[5787,0],[5792,11],[5867,0],[5870,11],[5881,0],[5888,11],[5901,0],[5902,11],[5906,14],[5909,0],[5920,11],[5938,14],[5941,0],[5952,11],[5970,14],[5972,0],[5984,11],[5997,0],[5998,11],[6001,0],[6002,14],[6004,0],[6068,14],[6100,0],[6109,14],[6110,0],[6112,9],[6122,0],[6155,14],[6158,13],[6159,0],[6160,9],[6170,0],[6176,11],[6265,0],[6272,11],[6277,14],[6279,11],[6313,14],[6314,11],[6315,0],[6320,11],[6390,0],[6400,11],[6431,0],[6432,14],[6444,0],[6448,14],[6460,0],[6470,9],[6480,0],[6608,9],[6618,0],[6656,11],[6679,14],[6684,0],[6741,14],[6751,0],[6752,14],[6781,0],[6783,14],[6784,9],[6794,0],[6800,9],[6810,0],[6832,14],[6849,0],[6912,14],[6917,11],[6964,14],[6981,11],[6988,0],[6992,9],[7002,0],[7019,14],[7028,0],[7040,14],[7043,11],[7073,14],[7086,11],[7088,9],[7098,11],[7142,14],[7156,0],[7168,11],[7204,14],[7224,0],[7232,9],[7242,0],[7245,11],[7248,9],[7258,11],[7294,0],[7296,11],[7305,0],[7312,11],[7355,0],[7357,11],[7360,0],[7376,14],[7379,0],[7380,14],[7401,11],[7405,14],[7406,11],[7412,14],[7413,11],[7415,14],[7418,11],[7419,0],[7424,11],[7616,14],[7674,0],[7675,14],[7680,11],[7958,0],[7960,11],[7966,0],[7968,11],[8006,0],[8008,11],[8014,0],[8016,11],[8024,0],[8025,11],[8026,0],[8027,11],[8028,0],[8029,11],[8030,0],[8031,11],[8062,0],[8064,11],[8117,0],[8118,11],[8125,0],[8126,11],[8127,0],[8130,11],[8133,0],[8134,11],[8141,0],[8144,11],[8148,0],[8150,11],[8156,0],[8160,11],[8173,0],[8178,11],[8181,0],[8182,11],[8189,0],[8192,4],[8199,0],[8200,4],[8203,0],[8204,14],[8205,16],[8206,13],[8208,0],[8216,8],[8218,0],[8228,8],[8229,0],[8231,10],[8232,2],[8234,13],[8239,12],[8240,0],[8255,12],[8257,0],[8260,7],[8261,0],[8276,12],[8277,0],[8287,4],[8288,13],[8293,0],[8294,13],[8304,0],[8305,11],[8306,0],[8319,11],[8320,0],[8336,11],[8349,0],[8400,14],[8433,0],[8450,11],[8451,0],[8455,11],[8456,0],[8458,11],[8468,0],[8469,11],[8470,0],[8473,11],[8478,0],[8484,11],[8485,0],[8486,11],[8487,0],[8488,11],[8489,0],[8490,11],[8494,0],[8495,11],[8506,0],[8508,11],[8512,0],[8517,11],[8522,0],[8526,11],[8527,0],[8544,11],[8585,0],[9398,11],[9450,0],[11264,11],[11311,0],[11312,11],[11359,0],[11360,11],[11493,0],[11499,11],[11503,14],[11506,11],[11508,0],[11520,11],[11558,0],[11559,11],[11560,0],[11565,11],[11566,0],[11568,11],[11624,0],[11631,11],[11632,0],[11647,14],[11648,11],[11671,0],[11680,11],[11687,0],[11688,11],[11695,0],[11696,11],[11703,0],[11704,11],[11711,0],[11712,11],[11719,0],[11720,11],[11727,0],[11728,11],[11735,0],[11736,11],[11743,0],[11744,14],[11776,0],[11823,11],[11824,0],[12288,4],[12289,0],[12293,11],[12294,0],[12330,14],[12336,0],[12337,17],[12342,0],[12347,11],[12349,0],[12441,14],[12443,17],[12445,0],[12448,17],[12539,0],[12540,17],[12544,0],[12549,11],[12592,0],[12593,11],[12687,0],[12704,11],[12736,0],[12784,17],[12800,0],[13008,17],[13055,0],[13056,17],[13144,0],[40960,11],[42125,0],[42192,11],[42238,0],[42240,11],[42509,0],[42512,11],[42528,9],[42538,11],[42540,0],[42560,11],[42607,14],[42611,0],[42612,14],[42622,0],[42623,11],[42654,14],[42656,11],[42736,14],[42738,0],[42760,11],[42944,0],[42946,11],[42955,0],[42997,11],[43010,14],[43011,11],[43014,14],[43015,11],[43019,14],[43020,11],[43043,14],[43048,0],[43052,14],[43053,0],[43072,11],[43124,0],[43136,14],[43138,11],[43188,14],[43206,0],[43216,9],[43226,0],[43232,14],[43250,11],[43256,0],[43259,11],[43260,0],[43261,11],[43263,14],[43264,9],[43274,11],[43302,14],[43310,0],[43312,11],[43335,14],[43348,0],[43360,11],[43389,0],[43392,14],[43396,11],[43443,14],[43457,0],[43471,11],[43472,9],[43482,0],[43493,14],[43494,0],[43504,9],[43514,0],[43520,11],[43561,14],[43575,0],[43584,11],[43587,14],[43588,11],[43596,14],[43598,0],[43600,9],[43610,0],[43643,14],[43646,0],[43696,14],[43697,0],[43698,14],[43701,0],[43703,14],[43705,0],[43710,14],[43712,0],[43713,14],[43714,0],[43744,11],[43755,14],[43760,0],[43762,11],[43765,14],[43767,0],[43777,11],[43783,0],[43785,11],[43791,0],[43793,11],[43799,0],[43808,11],[43815,0],[43816,11],[43823,0],[43824,11],[43882,0],[43888,11],[44003,14],[44011,0],[44012,14],[44014,0],[44016,9],[44026,0],[44032,11],[55204,0],[55216,11],[55239,0],[55243,11],[55292,0],[64256,11],[64263,0],[64275,11],[64280,0],[64285,15],[64286,14],[64287,15],[64297,0],[64298,15],[64311,0],[64312,15],[64317,0],[64318,15],[64319,0],[64320,15],[64322,0],[64323,15],[64325,0],[64326,15],[64336,11],[64434,0],[64467,11],[64830,0],[64848,11],[64912,0],[64914,11],[64968,0],[65008,11],[65020,0],[65024,14],[65040,7],[65041,0],[65043,10],[65044,7],[65045,0],[65056,14],[65072,0],[65075,12],[65077,0],[65101,12],[65104,7],[65105,0],[65106,8],[65107,0],[65108,7],[65109,10],[65110,0],[65136,11],[65141,0],[65142,11],[65277,0],[65279,13],[65280,0],[65287,8],[65288,0],[65292,7],[65293,0],[65294,8],[65295,0],[65296,9],[65306,10],[65307,7],[65308,0],[65313,11],[65339,0],[65343,12],[65344,0],[65345,11],[65371,0],[65382,17],[65438,14],[65440,11],[65471,0],[65474,11],[65480,0],[65482,11],[65488,0],[65490,11],[65496,0],[65498,11],[65501,0],[65529,13],[65532,0],[65536,11],[65548,0],[65549,11],[65575,0],[65576,11],[65595,0],[65596,11],[65598,0],[65599,11],[65614,0],[65616,11],[65630,0],[65664,11],[65787,0],[65856,11],[65909,0],[66045,14],[66046,0],[66176,11],[66205,0],[66208,11],[66257,0],[66272,14],[66273,0],[66304,11],[66336,0],[66349,11],[66379,0],[66384,11],[66422,14],[66427,0],[66432,11],[66462,0],[66464,11],[66500,0],[66504,11],[66512,0],[66513,11],[66518,0],[66560,11],[66718,0],[66720,9],[66730,0],[66736,11],[66772,0],[66776,11],[66812,0],[66816,11],[66856,0],[66864,11],[66916,0],[67072,11],[67383,0],[67392,11],[67414,0],[67424,11],[67432,0],[67584,11],[67590,0],[67592,11],[67593,0],[67594,11],[67638,0],[67639,11],[67641,0],[67644,11],[67645,0],[67647,11],[67670,0],[67680,11],[67703,0],[67712,11],[67743,0],[67808,11],[67827,0],[67828,11],[67830,0],[67840,11],[67862,0],[67872,11],[67898,0],[67968,11],[68024,0],[68030,11],[68032,0],[68096,11],[68097,14],[68100,0],[68101,14],[68103,0],[68108,14],[68112,11],[68116,0],[68117,11],[68120,0],[68121,11],[68150,0],[68152,14],[68155,0],[68159,14],[68160,0],[68192,11],[68221,0],[68224,11],[68253,0],[68288,11],[68296,0],[68297,11],[68325,14],[68327,0],[68352,11],[68406,0],[68416,11],[68438,0],[68448,11],[68467,0],[68480,11],[68498,0],[68608,11],[68681,0],[68736,11],[68787,0],[68800,11],[68851,0],[68864,11],[68900,14],[68904,0],[68912,9],[68922,0],[69248,11],[69290,0],[69291,14],[69293,0],[69296,11],[69298,0],[69376,11],[69405,0],[69415,11],[69416,0],[69424,11],[69446,14],[69457,0],[69552,11],[69573,0],[69600,11],[69623,0],[69632,14],[69635,11],[69688,14],[69703,0],[69734,9],[69744,0],[69759,14],[69763,11],[69808,14],[69819,0],[69821,13],[69822,0],[69837,13],[69838,0],[69840,11],[69865,0],[69872,9],[69882,0],[69888,14],[69891,11],[69927,14],[69941,0],[69942,9],[69952,0],[69956,11],[69957,14],[69959,11],[69960,0],[69968,11],[70003,14],[70004,0],[70006,11],[70007,0],[70016,14],[70019,11],[70067,14],[70081,11],[70085,0],[70089,14],[70093,0],[70094,14],[70096,9],[70106,11],[70107,0],[70108,11],[70109,0],[70144,11],[70162,0],[70163,11],[70188,14],[70200,0],[70206,14],[70207,0],[70272,11],[70279,0],[70280,11],[70281,0],[70282,11],[70286,0],[70287,11],[70302,0],[70303,11],[70313,0],[70320,11],[70367,14],[70379,0],[70384,9],[70394,0],[70400,14],[70404,0],[70405,11],[70413,0],[70415,11],[70417,0],[70419,11],[70441,0],[70442,11],[70449,0],[70450,11],[70452,0],[70453,11],[70458,0],[70459,14],[70461,11],[70462,14],[70469,0],[70471,14],[70473,0],[70475,14],[70478,0],[70480,11],[70481,0],[70487,14],[70488,0],[70493,11],[70498,14],[70500,0],[70502,14],[70509,0],[70512,14],[70517,0],[70656,11],[70709,14],[70727,11],[70731,0],[70736,9],[70746,0],[70750,14],[70751,11],[70754,0],[70784,11],[70832,14],[70852,11],[70854,0],[70855,11],[70856,0],[70864,9],[70874,0],[71040,11],[71087,14],[71094,0],[71096,14],[71105,0],[71128,11],[71132,14],[71134,0],[71168,11],[71216,14],[71233,0],[71236,11],[71237,0],[71248,9],[71258,0],[71296,11],[71339,14],[71352,11],[71353,0],[71360,9],[71370,0],[71453,14],[71468,0],[71472,9],[71482,0],[71680,11],[71724,14],[71739,0],[71840,11],[71904,9],[71914,0],[71935,11],[71943,0],[71945,11],[71946,0],[71948,11],[71956,0],[71957,11],[71959,0],[71960,11],[71984,14],[71990,0],[71991,14],[71993,0],[71995,14],[71999,11],[72e3,14],[72001,11],[72002,14],[72004,0],[72016,9],[72026,0],[72096,11],[72104,0],[72106,11],[72145,14],[72152,0],[72154,14],[72161,11],[72162,0],[72163,11],[72164,14],[72165,0],[72192,11],[72193,14],[72203,11],[72243,14],[72250,11],[72251,14],[72255,0],[72263,14],[72264,0],[72272,11],[72273,14],[72284,11],[72330,14],[72346,0],[72349,11],[72350,0],[72384,11],[72441,0],[72704,11],[72713,0],[72714,11],[72751,14],[72759,0],[72760,14],[72768,11],[72769,0],[72784,9],[72794,0],[72818,11],[72848,0],[72850,14],[72872,0],[72873,14],[72887,0],[72960,11],[72967,0],[72968,11],[72970,0],[72971,11],[73009,14],[73015,0],[73018,14],[73019,0],[73020,14],[73022,0],[73023,14],[73030,11],[73031,14],[73032,0],[73040,9],[73050,0],[73056,11],[73062,0],[73063,11],[73065,0],[73066,11],[73098,14],[73103,0],[73104,14],[73106,0],[73107,14],[73112,11],[73113,0],[73120,9],[73130,0],[73440,11],[73459,14],[73463,0],[73648,11],[73649,0],[73728,11],[74650,0],[74752,11],[74863,0],[74880,11],[75076,0],[77824,11],[78895,0],[78896,13],[78905,0],[82944,11],[83527,0],[92160,11],[92729,0],[92736,11],[92767,0],[92768,9],[92778,0],[92880,11],[92910,0],[92912,14],[92917,0],[92928,11],[92976,14],[92983,0],[92992,11],[92996,0],[93008,9],[93018,0],[93027,11],[93048,0],[93053,11],[93072,0],[93760,11],[93824,0],[93952,11],[94027,0],[94031,14],[94032,11],[94033,14],[94088,0],[94095,14],[94099,11],[94112,0],[94176,11],[94178,0],[94179,11],[94180,14],[94181,0],[94192,14],[94194,0],[110592,17],[110593,0],[110948,17],[110952,0],[113664,11],[113771,0],[113776,11],[113789,0],[113792,11],[113801,0],[113808,11],[113818,0],[113821,14],[113823,0],[113824,13],[113828,0],[119141,14],[119146,0],[119149,14],[119155,13],[119163,14],[119171,0],[119173,14],[119180,0],[119210,14],[119214,0],[119362,14],[119365,0],[119808,11],[119893,0],[119894,11],[119965,0],[119966,11],[119968,0],[119970,11],[119971,0],[119973,11],[119975,0],[119977,11],[119981,0],[119982,11],[119994,0],[119995,11],[119996,0],[119997,11],[120004,0],[120005,11],[120070,0],[120071,11],[120075,0],[120077,11],[120085,0],[120086,11],[120093,0],[120094,11],[120122,0],[120123,11],[120127,0],[120128,11],[120133,0],[120134,11],[120135,0],[120138,11],[120145,0],[120146,11],[120486,0],[120488,11],[120513,0],[120514,11],[120539,0],[120540,11],[120571,0],[120572,11],[120597,0],[120598,11],[120629,0],[120630,11],[120655,0],[120656,11],[120687,0],[120688,11],[120713,0],[120714,11],[120745,0],[120746,11],[120771,0],[120772,11],[120780,0],[120782,9],[120832,0],[121344,14],[121399,0],[121403,14],[121453,0],[121461,14],[121462,0],[121476,14],[121477,0],[121499,14],[121504,0],[121505,14],[121520,0],[122880,14],[122887,0],[122888,14],[122905,0],[122907,14],[122914,0],[122915,14],[122917,0],[122918,14],[122923,0],[123136,11],[123181,0],[123184,14],[123191,11],[123198,0],[123200,9],[123210,0],[123214,11],[123215,0],[123584,11],[123628,14],[123632,9],[123642,0],[124928,11],[125125,0],[125136,14],[125143,0],[125184,11],[125252,14],[125259,11],[125260,0],[125264,9],[125274,0],[126464,11],[126468,0],[126469,11],[126496,0],[126497,11],[126499,0],[126500,11],[126501,0],[126503,11],[126504,0],[126505,11],[126515,0],[126516,11],[126520,0],[126521,11],[126522,0],[126523,11],[126524,0],[126530,11],[126531,0],[126535,11],[126536,0],[126537,11],[126538,0],[126539,11],[126540,0],[126541,11],[126544,0],[126545,11],[126547,0],[126548,11],[126549,0],[126551,11],[126552,0],[126553,11],[126554,0],[126555,11],[126556,0],[126557,11],[126558,0],[126559,11],[126560,0],[126561,11],[126563,0],[126564,11],[126565,0],[126567,11],[126571,0],[126572,11],[126579,0],[126580,11],[126584,0],[126585,11],[126589,0],[126590,11],[126591,0],[126592,11],[126602,0],[126603,11],[126620,0],[126625,11],[126628,0],[126629,11],[126634,0],[126635,11],[126652,0],[127280,11],[127306,0],[127312,11],[127338,0],[127344,11],[127370,0],[127462,18],[127488,0],[127995,14],[128e3,0],[130032,9],[130042,0],[917505,13],[917506,0],[917536,14],[917632,0],[917760,14],[918e3,0]];function fe(r,e){var t=Nt(r,e);if(t.length==0)return[];for(var n=[],i=0;i<t.length-1;i++){var o=t[i],a=t[i+1],u=new at(r,o,a);It(u.text,e)?n.push(u):i==t.length-2&&(u=new at(r,a,a),n.push(u))}return n}var at=function(){function r(e,t,n){this._source=e,this.start=t,this.end=n}return Object.defineProperty(r.prototype,"text",{get:function(){return this._source.substring(this.start,this.end)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"length",{get:function(){return this.end-this.start},enumerable:!1,configurable:!0}),r}(),Mt=function(){function r(e,t,n,i,o,a){this.lookbehind=19,this.left=19,this.right=19,this.text=e,this.options=t,arguments.length==3?this.lookahead=this.wordbreakPropertyAt(n):(this.lookbehind=n,this.left=i,this.right=o,this.lookahead=a)}return r.prototype.next=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.left,this.right,this.lookahead,t)},r.prototype.ignoringRight=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.lookbehind,this.left,this.lookahead,t)},r.prototype.ignoringLookahead=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.lookbehind,this.left,this.right,t)},r.prototype.wordbreakPropertyAt=function(e){return e<0?19:e>=this.text.length?20:ut(this.text[e])?Be(this.text[e]+this.text[e+1]):Be(this.text[e],this.options)},r.prototype.match=function(e,t,n,i){var o,a,u,s,c=(o=e==null?void 0:e.includes(this.lookbehind))!==null&&o!==void 0?o:!0;return c=c&&((a=t==null?void 0:t.includes(this.left))!==null&&a!==void 0?a:!0),c=c&&((u=n==null?void 0:n.includes(this.right))!==null&&u!==void 0?u:!0),c&&((s=i==null?void 0:i.includes(this.lookahead))!==null&&s!==void 0?s:!0)},r.prototype.propertyMatch=function(e,t,n,i){var o=this,a=function(u){return st(u,o.options)};return this.match(e==null?void 0:e.map(a),t==null?void 0:t.map(a),n==null?void 0:n.map(a),i==null?void 0:i.map(a))},r}();function It(r,e){return!r.split("").map(function(t){return Be(t,e)}).every(function(t){return t===3||t===1||t===2||t===4})}function Nt(r,e){var t,n,i;if(r.length===0)return[];e&&!e.rules&&(e.rules=[]);var o=[],a,u=0,s=new Mt(r,e,u),c=0;do{if(a=u,u=O(u),s=s.next(u),s.match(null,[19],null,null)){o.push(a);continue}if(s.match(null,null,[20],null)){o.push(a);break}if(!s.match(null,[3],[1],null)){var f=[2,3,1];if(s.match(null,f,null,null)){o.push(a);continue}if(s.match(null,null,f,null)){o.push(a);continue}if(!s.match(null,[4],[4],null)){for(var l=[13,14,16];s.match(null,null,l,null);)t=(0,_.__read)([u,O(u)],2),a=t[0],u=t[1],s=s.ignoringRight(u);if(s.right===20){o.push(a);break}for(;s.match(null,null,null,l);)u=O(u),s=s.ignoringLookahead(u);var d=[11,15],h=[8,6];if(e!=null&&e.rules){var g=!1;try{for(var v=(n=void 0,(0,_.__values)(e.rules)),S=v.next();!S.done;S=v.next()){var b=S.value;if(g=b.match(s),g){b.breakIfMatch&&o.push(a);break}}}catch(w){n={error:w}}finally{try{S&&!S.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}if(g)continue}if(!s.match(null,d,d,null)){var m=[10].concat(h);if(!s.match(null,d,m,d)&&!s.match(d,m,d,null)&&!s.match(null,[15],[6],null)&&!s.match(null,[15],[5],[15])&&!s.match([15],[5],[15],null)&&!s.match(null,[9],[9],null)&&!s.match(null,d,[9],null)&&!s.match(null,[9],d,null)){var C=[7].concat(h);if(!s.match([9],C,[9],null)&&!s.match(null,[9],C,[9])&&!s.match(null,[17],[17],null)){var k=[17,9].concat(d);if(!s.match(null,k,[12],null)&&!s.match(null,[12],[12],null)&&!s.match(null,[12],k,null)){if(s.right===18){if(c+=1,c%2==1)continue}else c=0;o.push(a)}}}}}}}while(a<r.length);return o;function O(w){return w>=r.length?r.length:ut(r[w])?w+2:w+1}}function ut(r){var e=r.charCodeAt(0);return e>=55296&&e<=56319}function Be(r,e){if(e!=null&&e.propertyMapping){var t=e.propertyMapping(r);if(t)return st(t,e)}var n=r.codePointAt(0);return Qe(n,0,We.length-1)}function st(r,e){var t,n,i=function(a){return a.toLowerCase()==r.toLowerCase()},o=(n=(t=e==null?void 0:e.customProperties)===null||t===void 0?void 0:t.findIndex(i))!==null&&n!==void 0?n:-1;return o!=-1?-o-1:Et.findIndex(i)}function Qe(r,e,t){if(t<e)return 0;var n=e+~~((t-e)/2),i=We[n],o=We[n+1],a=o?o[0]:1/0;return r<i[0]?Qe(r,e,n-1):r>=a?Qe(r,n+1,t):i[1]}H();var lt=12,qt=function(){function r(e,t){this.root=e,this.prefix=t}return r.prototype.children=function(){var e,t,n,i,o,a,u,s,c,f,l,d,h,g,v,S,b,m;return(0,_.__generator)(this,function(C){switch(C.label){case 0:if(e=this.root,e.type!="internal")return[3,9];t=function(k){var O,w,F,B,L,Q,J,ae,be,ue,$,pe;return(0,_.__generator)(this,function(V){switch(V.label){case 0:if(O=e.children[k],!y(k))return[3,12];if(O.type!="internal")return[3,9];w=O,F=function(ve){var ne;return(0,_.__generator)(this,function(ie){switch(ie.label){case 0:return ne=n.prefix+k+ve,[4,{char:k+ve,traversal:function(){return new r(w.children[ve],ne)}}];case 1:return ie.sent(),[2]}})},V.label=1;case 1:V.trys.push([1,6,7,8]),B=($=void 0,(0,_.__values)(w.values)),L=B.next(),V.label=2;case 2:return L.done?[3,5]:(Q=L.value,[5,F(Q)]);case 3:V.sent(),V.label=4;case 4:return L=B.next(),[3,2];case 5:return[3,8];case 6:return J=V.sent(),$={error:J},[3,8];case 7:try{L&&!L.done&&(pe=B.return)&&pe.call(B)}finally{if($)throw $.error}return[7];case 8:return[3,11];case 9:return ae=O.entries[0].key,k=k+ae[n.prefix.length+1],be=n.prefix+k,[4,{char:k,traversal:function(){return new r(O,be)}}];case 10:V.sent(),V.label=11;case 11:return[3,16];case 12:return A(k)?[2,"continue"]:[3,13];case 13:return k?[3,14]:[2,"continue"];case 14:return ue=n.prefix+k,[4,{char:k,traversal:function(){return new r(O,ue)}}];case 15:V.sent(),V.label=16;case 16:return[2]}})},n=this,C.label=1;case 1:C.trys.push([1,6,7,8]),i=(0,_.__values)(e.values),o=i.next(),C.label=2;case 2:return o.done?[3,5]:(a=o.value,[5,t(a)]);case 3:C.sent(),C.label=4;case 4:return o=i.next(),[3,2];case 5:return[3,8];case 6:return u=C.sent(),v={error:u},[3,8];case 7:try{o&&!o.done&&(S=i.return)&&S.call(i)}finally{if(v)throw v.error}return[7];case 8:return[2];case 9:s=this.prefix,c=e.entries.filter(function(k){return k.key!=s&&s.length<k.key.length}),f=function(k){var O;return(0,_.__generator)(this,function(w){switch(w.label){case 0:return O=k[s.length],y(O)&&(O=O+k[s.length+1]),[4,{char:O,traversal:function(){return new r(e,s+O)}}];case 1:return w.sent(),[2]}})},C.label=10;case 10:C.trys.push([10,15,16,17]),l=(0,_.__values)(c),d=l.next(),C.label=11;case 11:return d.done?[3,14]:(h=d.value.key,[5,f(h)]);case 12:C.sent(),C.label=13;case 13:return d=l.next(),[3,11];case 14:return[3,17];case 15:return g=C.sent(),b={error:g},[3,17];case 16:try{d&&!d.done&&(m=l.return)&&m.call(l)}finally{if(b)throw b.error}return[7];case 17:return[2]}})},Object.defineProperty(r.prototype,"entries",{get:function(){if(this.root.type=="leaf"){var e=this.prefix,t=this.root.entries.filter(function(i){return i.key==e});return t.map(function(i){return i.content})}else{var n=this.root.children[E];return n&&n.type=="leaf"?n.entries.map(function(i){return i.content}):[]}},enumerable:!1,configurable:!0}),r}(),Lt=function(){function r(e,t){t===void 0&&(t={}),this.languageUsesCasing=t.languageUsesCasing,this.applyCasing=t.applyCasing,this._trie=new Dt(e.root,e.totalWeight,t.searchTermToKey||jt),this.breakWords=t.wordBreaker||fe,this.punctuation=t.punctuation}return r.prototype.configure=function(e){var t;return this.configuration={leftContextCodePoints:e.maxLeftContextCodePoints,rightContextCodePoints:(t=e.maxRightContextCodePoints)!==null&&t!==void 0?t:0}},r.prototype.toKey=function(e){return this._trie.toKey(e)},r.prototype.predict=function(e,t){if(!e.insert&&!t.left&&!t.right&&t.startOfBuffer&&t.endOfBuffer)return a(this._trie.firstN(lt).map(function(u){var s=u.text,c=u.p;return{transform:{insert:s,deleteLeft:0},displayAs:s,p:c}}));var n=G(e,t),i=e.deleteLeft-e.insert.kmwLength(),o=Fe(this.breakWords,n);return a(this._trie.lookup(o).map(function(u){var s=u.text,c=u.p;return U({insert:s,deleteLeft:i+o.kmwLength()},c)}));function a(u){var s,c,f=[];try{for(var l=(0,_.__values)(u),d=l.next();!d.done;d=l.next()){var h=d.value;f.push({sample:h,p:h.p})}}catch(g){s={error:g}}finally{try{d&&!d.done&&(c=l.return)&&c.call(l)}finally{if(s)throw s.error}}return f}},Object.defineProperty(r.prototype,"wordbreaker",{get:function(){return this.breakWords},enumerable:!1,configurable:!0}),r.prototype.traverseFromRoot=function(){return new qt(this._trie.root,"")},r}(),Rt=Lt,Dt=function(){function r(e,t,n){this.root=e,this.toKey=n,this.totalWeight=t}return r.prototype.lookup=function(e){var t=this.toKey(e),n=ct(this.root,t);return n===null?[]:ft(n,t,this.totalWeight)},r.prototype.firstN=function(e){return ft(this.root,"",this.totalWeight,e)},r}();function ct(r,e,t){if(t===void 0&&(t=0),r.type==="leaf"||t===e.length)return r;var n=e[t];return r.children[n]?ct(r.children[n],e,t+1):null}function ft(r,e,t,n){var i,o;n===void 0&&(n=lt);var a=new z(function(S,b){return(b?b.weight:0)-(S?S.weight:0)}),u=[];if(r.type==="leaf")try{for(var s=(0,_.__values)(r.entries),c=s.next();!c.done;c=s.next()){var f=c.value;if(f.key.indexOf(e)==0){var l=f.content,d=f.weight;if(u.push({text:l,p:d/t}),u.length>=n)return u}}}catch(S){i={error:S}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}else{a.enqueue(r);for(var h=void 0,g=function(){if(Ft(h))if(h.type==="leaf")a.enqueueAll(h.entries);else{var S=h;a.enqueueAll(h.values.map(function(b){return S.children[b]}))}else if(u.push({text:h.content,p:h.weight/t}),u.length>=n)return{value:u}};h=a.dequeue();){var v=g();if(typeof v=="object")return v.value}}return u}function Ft(r){return"type"in r}function jt(r){return r.normalize("NFD").replace(/[\\u0300-\\u036f]/g,"").toLowerCase()}var Ut=function(){function r(e){e=e||{},this._futureSuggestions=e.futureSuggestions?e.futureSuggestions.slice():[],e.punctuation&&(this.punctuation=e.punctuation)}return r.prototype.configure=function(e){return this.configuration={leftContextCodePoints:e.maxLeftContextCodePoints,rightContextCodePoints:e.maxRightContextCodePoints},this.configuration},r.prototype.predict=function(e,t,n){var i=function(a){var u,s,c=[];try{for(var f=(0,_.__values)(a),l=f.next();!l.done;l=f.next()){var d=l.value;c.push({sample:d,p:1})}}catch(h){u={error:h}}finally{try{l&&!l.done&&(s=f.return)&&s.call(f)}finally{if(u)throw u.error}}return c};if(n)return i(n);var o=this._futureSuggestions.shift();return o?i(o):[]},r}(),Wt=Ut,Ke={};D(Ke,{ClassicalDistanceCalculation:function(){return Ge},ContextTracker:function(){return gt},ExecutionBucket:function(){return He},ExecutionSpan:function(){return Se},ExecutionTimer:function(){return pt},QUEUE_NODE_COMPARATOR:function(){return Pe},STANDARD_TIME_BETWEEN_DEFERS:function(){return Ve},SearchNode:function(){return vt},SearchResult:function(){return ze},SearchSpace:function(){return ee},TrackedContextState:function(){return Ee},TrackedContextSuggestion:function(){return Kt},TrackedContextToken:function(){return re}});var Ge=function(){function r(e){if(this.diagonalWidth=2,this.inputSequence=[],this.matchSequence=[],e){var t=e.resolvedDistances.length;this.resolvedDistances=Array(t);for(var n=0;n<t;n++)this.resolvedDistances[n]=e.resolvedDistances[n].slice(0);this.inputSequence=e.inputSequence.slice(0),this.matchSequence=e.matchSequence.slice(0),this.diagonalWidth=e.diagonalWidth}else this.resolvedDistances=[]}return r.prototype.getTrueIndex=function(e,t,n){var i={row:e,col:t-e+n,sparse:!1};return(i.col<0||i.col>2*n)&&(i.sparse=!0),i},r.prototype.getCostAt=function(e,t,n){if(n===void 0&&(n=this.diagonalWidth),e<0||t<0)return e==-1&&t>=-1?t+1:t==-1&&e>=-1?e+1:Number.MAX_VALUE;var i=this.getTrueIndex(e,t,n);return i.sparse?Number.MAX_VALUE:this.resolvedDistances[i.row][i.col]},r.prototype.getFinalCost=function(){for(var e=this,t=e.getHeuristicFinalCost();t>e.diagonalWidth;)e=e.increaseMaxDistance(),t=e.getHeuristicFinalCost();return t},r.prototype.getHeuristicFinalCost=function(){return this.getCostAt(this.inputSequence.length-1,this.matchSequence.length-1)},r.prototype.hasFinalCostWithin=function(e){var t=this,n=t.getHeuristicFinalCost(),i=this.diagonalWidth;do{if(n<=e)return!0;if(i<e)t=t.increaseMaxDistance(),i++,n=t.getHeuristicFinalCost();else break}while(!0);return!1},r.prototype.editPath=function(e,t){e===void 0&&(e=this.inputSequence.length-1),t===void 0&&(t=this.matchSequence.length-1);var n=this.getCostAt(e,t),i=null,o=null,a=this.getCostAt(e,t-1),u=this.getCostAt(e-1,t),s=this.getCostAt(e-1,t-1),c=(0,_.__read)(r.getTransposeParent(this,e,t),2),f=c[0],l=c[1];if(f>=0&&l>=0){var d=1;if(i=["transpose-start"],f!=e-1){var h=e-f-1;i=i.concat(Array(h).fill("transpose-delete")),d+=h}else{var h=t-l-1;i=i.concat(Array(h).fill("transpose-insert")),d+=h}i.push("transpose-end"),this.getCostAt(f-1,l-1)!=n-d&&(i=null),o=[f-1,l-1]}return i||(s==n-1?(i=["substitute"],o=[e-1,t-1]):a==n-1?(i=["insert"],o=[e,t-1]):u==n-1?(i=["delete"],o=[e-1,t]):(i=["match"],o=[e-1,t-1])),o[0]>=0&&o[1]>=0?this.editPath(o[0],o[1]).concat(i):o[0]>-1?Array(o[0]+1).fill("delete").concat(i):o[1]>-1?Array(o[1]+1).fill("insert").concat(i):i},r.getTransposeParent=function(e,t,n){if(t<0||n<0||e.inputSequence[t].key==e.matchSequence[n].key)return[-1,-1];for(var i=-1,o=t-1;o>=0;o--)if(e.inputSequence[o].key==e.matchSequence[n].key){i=o;break}for(var a=-1,o=n-1;o>=0;o--)if(e.matchSequence[o].key==e.inputSequence[t].key){a=o;break}return[i,a]},r.initialCostAt=function(e,t,n,i,o){var a=e.inputSequence[t].key==e.matchSequence[n].key?0:1,u=e.getCostAt(t-1,n-1)+a,s=i||e.getCostAt(t,n-1)+1,c=o||e.getCostAt(t-1,n)+1,f=Number.MAX_VALUE;if(t>0&&n>0){var l=(0,_.__read)(r.getTransposeParent(e,t,n),2),d=l[0],h=l[1];f=e.getCostAt(d-1,h-1)+(t-d-1)+1+(n-h-1)}return Math.min(u,c,s,f)},r.prototype.getSubset=function(e,t){var n=new r(this);if(e>this.inputSequence.length||t>this.matchSequence.length)throw"Invalid dimensions specified for trim operation";n.inputSequence.splice(e),n.matchSequence.splice(t),n.resolvedDistances.splice(e);for(var i=this.getTrueIndex(e-1,t-1,this.diagonalWidth),o=i.col;o<=2*this.diagonalWidth;o++){var a=i.row-(o-i.col);if(a<0)break;if(o<0)n.resolvedDistances[a]=Array(2*n.diagonalWidth+1).fill(Number.MAX_VALUE);else{var u=2*this.diagonalWidth-o,s=n.resolvedDistances[a].splice(0,o+1),c=Array(u).fill(Number.MAX_VALUE);n.resolvedDistances[a]=s.concat(c)}}return n},r.forDiagonalOfAxis=function(e,t,n,i){for(var o=n-t<e?n-t+e:2*e,a=t-e,u=a<0?0:a,s=u-a;s<=o;s++)i(a+s,s)},r.prototype.addInputChar=function(e){var t=new r(this),n=t.inputSequence.length;t.inputSequence.push(e);var i=Array(2*t.diagonalWidth+1).fill(Number.MAX_VALUE);return t.resolvedDistances[n]=i,t.matchSequence.length==0||r.forDiagonalOfAxis(t.diagonalWidth,n,t.matchSequence.length-1,function(o,a){i[a]=r.initialCostAt(t,n,o)}),t},r.prototype.addMatchChar=function(e){var t=new r(this),n=t.matchSequence.length;return t.matchSequence.push(e),t.inputSequence.length==0||r.forDiagonalOfAxis(t.diagonalWidth,n,t.inputSequence.length-1,function(i,o){var a=t.resolvedDistances[i];a[2*t.diagonalWidth-o]=r.initialCostAt(t,i,n)}),t},r.prototype.increaseMaxDistance=function(){var e=new r(this);if(e.diagonalWidth++,e.inputSequence.length<1||e.matchSequence.length<1)return e;function t(u,s,c,f){var l=2*(e.diagonalWidth-1),d=c.length-1;l=l<d-u?l:d-u;for(var h=0;h<=l;h++)s==c[u+h].key&&f(u+h,h)}for(var n=function(u){var s=Number.MAX_VALUE,c=u-e.diagonalWidth;if(c>=0){var f=c==0?u+2:Number.MAX_VALUE;s=r.initialCostAt(e,u,c,f,void 0);var l=s;if(c<e.matchSequence.length-1){r.propagateUpdateFrom(e,u,c+1,l+1,0);var d=u+2;if(u+2<i.inputSequence.length){var h=e.inputSequence[u+1].key;t(c+3,h,e.matchSequence,function(C,k){r.propagateUpdateFrom(e,d,C,l+k+2,k)})}}}var g=Number.MAX_VALUE;if(c=u+e.diagonalWidth,c<e.matchSequence.length){var v=u==0?c+2:Number.MAX_VALUE;o=e.getCostAt(u,c-1,i.diagonalWidth)+1,g=r.initialCostAt(e,u,c,o,v);var S=g;if(u<e.inputSequence.length-1){r.propagateUpdateFrom(e,u+1,c,S+1,2*i.diagonalWidth);var b=c+2;if(c+2<i.matchSequence.length){var m=e.matchSequence[u+1].key;t(u+3,m,e.inputSequence,function(C,k){var O=2*(e.diagonalWidth-1)-k;r.propagateUpdateFrom(e,C,b,S+k+2,O)})}}}e.resolvedDistances[u]=[s].concat(e.resolvedDistances[u],g)},i=this,o,a=0;a<e.inputSequence.length;a++)n(a);return e},r.propagateUpdateFrom=function(e,t,n,i,o){if(i<e.resolvedDistances[t][o])e.resolvedDistances[t][o]=i;else return;var a=t<e.inputSequence.length-1,u=n<e.matchSequence.length-1;if(o<2*(e.diagonalWidth-1)&&u){var s=i+1;this.propagateUpdateFrom(e,t,n+1,s,o+1)}if(o>0&&a){var s=i+1;this.propagateUpdateFrom(e,t+1,n,s,o-1)}if(a&&u){var s=i+(e.inputSequence[t+1].key==e.matchSequence[n+1].key?0:1);this.propagateUpdateFrom(e,t+1,n+1,s,o);for(var c=-1,f=t+2;f<e.inputSequence.length;f++)if(e.inputSequence[f].key==e.matchSequence[n+1].key){c=f;break}for(var l=-1,f=n+2;f<e.matchSequence.length;f++)if(e.matchSequence[f].key==e.inputSequence[t+1].key){l=f;break}if(c>0&&l>0){var d=i+(c-t-2)+1+(l-n-2);this.propagateUpdateFrom(e,c,l,d,e.diagonalWidth-1+l-c)}}},Object.defineProperty(r.prototype,"mapKey",{get:function(){var e=this.inputSequence.map(function(n){return n.key}).join(""),t=this.matchSequence.map(function(n){return n.key}).join("");return e+E+t+E+this.diagonalWidth},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastInputEntry",{get:function(){return this.inputSequence[this.inputSequence.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastMatchEntry",{get:function(){return this.matchSequence[this.matchSequence.length-1]},enumerable:!1,configurable:!0}),r.computeDistance=function(e,t,n){n===void 0&&(n=1);var i=new r;n=n||1,i.diagonalWidth=n;for(var o=0;o<e.length;o++)i=i.addInputChar(e[o]);for(var a=0;a<t.length;a++)i=i.addMatchChar(t[a]);return i},r}(),Bt=1,ht=5,Ve=5,He=function(){function r(e){this.timeSpent=0,this.eventCount=0,this.timeSquared=0,this.nearOutliers=[],this.outliers=[],this.preventOutliers=!1,this.preventOutliers=!!e}return r.prototype.add=function(e){if(e<0)throw new Error("time may not be negative");this.eventCount++,this.timeSpent+=e,this.timeSquared+=e*e,e>=Bt&&(this.nearOutliers.length<ht||this.nearOutliers[ht-1]<e)&&(this.nearOutliers.push(e),this.nearOutliers.sort(function(t,n){return n-t})),this.checkForOutlier()},r.prototype.checkForOutlier=function(){if(!(this.preventOutliers||this.eventCount<4||this.nearOutliers.length==0)){var e=this.nearOutliers[0];this.timeSpent-=e,this.timeSquared-=e*e,this.eventCount--;var t=this.average,n=e-t,i=this.variance,o=n*n/i;o>=49||this.eventCount>=8&&o>=9?(this.nearOutliers.shift(),this.outliers.push(e)):(this.timeSpent+=e,this.timeSquared+=e*e,this.eventCount++)}},Object.defineProperty(r.prototype,"average",{get:function(){return this.timeSpent/this.eventCount},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"variance",{get:function(){var e=this.eventCount;return e<=1?NaN:this.timeSquared/e-this.timeSpent*this.timeSpent/(e*e)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outlierTime",{get:function(){for(var e=0,t=0;t<this.outliers.length;t++)e+=this.outliers[t];return e},enumerable:!1,configurable:!0}),r}(),Se=function(){function r(e,t){this.bucket=e,this.finalizer=t,this.start=performance.now()}return r.prototype.end=function(){var e,t;this.finish=performance.now(),(e=this.bucket)===null||e===void 0||e.add(this.duration),(t=this.finalizer)===null||t===void 0||t.call(this)},Object.defineProperty(r.prototype,"duration",{get:function(){var e;return((e=this.finish)!==null&&e!==void 0?e:performance.now())-this.start},enumerable:!1,configurable:!0}),r}(),pt=function(){function r(e,t){this.buckets={},this.deferBucket=new He(!0),this.activeSpan=null,this.spanSinceLastDefer=null,this.trueStart=performance.now(),this.maxExecutionTime=e,this.maxTrueTime=t,this.spanSinceLastDefer=new Se}return r.prototype.validateStart=function(){if(this.activeSpan)throw new Error("illegal state - span-based timer still pending")},r.prototype.getBucket=function(e){e!=null||(e=-1);var t=this.buckets[e];return t||(t=this.buckets[e]=new He),t},Object.defineProperty(r.prototype,"executionTime",{get:function(){var e,t,n=Object.values(this.buckets),i=0;try{for(var o=(0,_.__values)(n),a=o.next();!a.done;a=o.next()){var u=a.value;i+=u.timeSpent}}catch(s){e={error:s}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"deferredTime",{get:function(){var e,t,n=Object.values(this.buckets),i=0;try{for(var o=(0,_.__values)(n),a=o.next();!a.done;a=o.next()){var u=a.value;i+=u.outlierTime}}catch(s){e={error:s}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return i+=this.deferBucket.timeSpent,i},enumerable:!1,configurable:!0}),r.prototype.time=function(e,t){this.validateStart();var n=performance.now(),i=e(),o=performance.now()-n,a=this.getBucket(t);return a.add(o),i},r.prototype.defer=function(e){return(0,_.__awaiter)(this,void 0,void 0,function(){var t=this;return(0,_.__generator)(this,function(n){switch(n.label){case 0:return this.validateStart(),e!=null||(e=0),this.activeSpan=new Se(this.deferBucket,function(){return t.activeSpan=null}),[4,Te(e)];case 1:return n.sent(),this.activeSpan.end(),this.spanSinceLastDefer=new Se,[2]}})})},Object.defineProperty(r.prototype,"timeSinceLastDefer",{get:function(){return this.spanSinceLastDefer.duration},enumerable:!1,configurable:!0}),r.prototype.start=function(e){var t=this;this.validateStart();var n=this.getBucket(e);return this.activeSpan=new Se(n,function(){t.activeSpan=null}),this.activeSpan},r.prototype.terminate=function(){this.maxTrueTime=0},Object.defineProperty(r.prototype,"elapsed",{get:function(){var e=performance.now();return e-this.trueStart>=this.maxTrueTime?!0:this.executionTime>=this.maxExecutionTime},enumerable:!1,configurable:!0}),r}(),Pe=function(r,e){return r.currentCost-e.currentCost},he;(function(r){r[r.CACHED_RESULT=0]="CACHED_RESULT",r[r.PREDICTING=1]="PREDICTING",r[r.CORRECTING=2]="CORRECTING"})(he||(he={}));var vt=function(){function r(e,t){if(this.toKey=function(i){return i},t=t||function(i){return i},e instanceof r){var n=e;this.calculation=n.calculation,this.currentTraversal=n.currentTraversal,this.priorInput=n.priorInput,this.toKey=n.toKey}else this.calculation=new Ge,this.currentTraversal=e,this.priorInput=[],this.toKey=t}return Object.defineProperty(r.prototype,"knownCost",{get:function(){return this.calculation.getHeuristicFinalCost()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputSamplingCost",{get:function(){if(this._inputCost!==void 0)return this._inputCost;var e=ee.MIN_KEYSTROKE_PROBABILITY;return this._inputCost=this.priorInput.map(function(t){return t.p>e?t.p:e}).reduce(function(t,n){return t-Math.log(n)},0),this._inputCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentCost",{get:function(){return ee.EDIT_DISTANCE_COST_SCALE*this.knownCost+this.inputSamplingCost},enumerable:!1,configurable:!0}),r.prototype.buildInsertionEdges=function(){var e,t,n=[];try{for(var i=(0,_.__values)(this.currentTraversal.children()),o=i.next();!o.done;o=i.next()){var a=o.value,u=a.traversal(),s={key:a.char,traversal:u},c=this.calculation.addMatchChar(s),f=new r(this);f.calculation=c,f.priorInput=this.priorInput,f.currentTraversal=u,n.push(f)}}catch(l){e={error:l}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.buildDeletionEdges=function(e){var t,n,i=[];try{for(var o=(0,_.__values)(e),a=o.next();!a.done;a=o.next()){var u=a.value;if(u.p<e[0].p*Math.exp(-ee.EDIT_DISTANCE_COST_SCALE))break;var s=this.calculation,c=u.sample;c.deleteLeft&&(s=s.getSubset(s.inputSequence.length-c.deleteLeft,s.matchSequence.length));var f=this.priorInput.slice(0);f.push(u);for(var l=0;l<c.insert.length;l++){var d=c.insert[l];y(d)&&(l++,d=d+c.insert[l]);var h=this.toKey(d);h&&(s=s.addInputChar({key:h}))}var g=new r(this);g.calculation=s,g.priorInput=f,i.push(g)}}catch(v){t={error:v}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},r.prototype.buildSubstitutionEdges=function(e){var t,n,i,o,a=this.buildDeletionEdges(e),u=[];try{for(var s=(0,_.__values)(this.currentTraversal.children()),c=s.next();!c.done;c=s.next()){var f=c.value;try{for(var l=(i=void 0,(0,_.__values)(a)),d=l.next();!d.done;d=l.next()){var h=d.value,g=f.traversal(),v={key:f.char,traversal:g},S=h.calculation.addMatchChar(v),b=new r(this);b.calculation=S,b.priorInput=h.priorInput,b.currentTraversal=g,u.push(b)}}catch(m){i={error:m}}finally{try{d&&!d.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}}}catch(m){t={error:m}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return u},Object.defineProperty(r.prototype,"pathKey",{get:function(){var e=this.priorInput.map(function(n){return"+"+n.sample.insert+"-"+n.sample.deleteLeft}).join(""),t=this.calculation.matchSequence.map(function(n){return n.key}).join("");return e+E+t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"resultKey",{get:function(){return this.calculation.matchSequence.map(function(e){return e.key}).join("")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isFullReplacement",{get:function(){return this.knownCost&&this.knownCost==this.priorInput.length},enumerable:!1,configurable:!0}),r}(),Xe=function(){function r(e,t){if(this.processed=[],typeof e=="number"){this.index=e,this.correctionQueue=new z(Pe,t);return}else this.index=e.index,this.processed=[].concat(e.processed),this.correctionQueue=new z(e.correctionQueue)}return r.prototype.increaseMaxEditDistance=function(){var e=this.correctionQueue.toArray();e.forEach(function(t){t.calculation=t.calculation.increaseMaxDistance()}),this.correctionQueue=new z(Pe,e)},r}(),ze=function(){function r(e){this.resultNode=e}return Object.defineProperty(r.prototype,"inputSequence",{get:function(){return this.resultNode.priorInput},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"matchSequence",{get:function(){return this.resultNode.calculation.matchSequence},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"matchString",{get:function(){return this.resultNode.resultKey},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"knownCost",{get:function(){return this.resultNode.knownCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputSamplingCost",{get:function(){return this.resultNode.inputSamplingCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"totalCost",{get:function(){return this.resultNode.currentCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"finalTraversal",{get:function(){return this.resultNode.currentTraversal},enumerable:!1,configurable:!0}),r}(),ee=function(){function r(e){if(this.tierOrdering=[],this.inputSequence=[],this.minInputCost=[],this.returnedValues={},this.processedEdgeSet={},this.buildQueueSpaceComparator(),e instanceof r){this.inputSequence=[].concat(e.inputSequence),this.minInputCost=[].concat(e.minInputCost),this.rootNode=e.rootNode,this.completedPaths=[].concat(e.completedPaths),this.returnedValues=(0,_.__assign)({},e.returnedValues),this.processedEdgeSet=(0,_.__assign)({},e.processedEdgeSet),this.tierOrdering=e.tierOrdering.map(function(i){return new Xe(i)}),this.selectionQueue=new z(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering);return}var t=e;if(t){if(!t.traverseFromRoot)throw"The provided model does not implement the `traverseFromRoot` function, which is needed to support robust correction searching."}else throw"The LexicalModel parameter must not be null / undefined.";this.selectionQueue=new z(this.QUEUE_SPACE_COMPARATOR),this.rootNode=new vt(t.traverseFromRoot(),t.toKey?t.toKey.bind(t):null),this.completedPaths=[this.rootNode];var n=new Xe(0,[this.rootNode]);this.tierOrdering.push(n),this.selectionQueue.enqueue(n)}return r.prototype.buildQueueSpaceComparator=function(){var e=this;this.QUEUE_SPACE_COMPARATOR=function(t,n){var i=t.correctionQueue.peek(),o=n.correctionQueue.peek(),a=t.index,u=n.index,s=0,c=1;if(u<a){var f=u;u=a,a=f,c=-1}for(var l=a;l<u;l++)s=s+e.minInputCost[l];return i&&o?i.currentCost-o.currentCost+c*s:o?1:-1}},r.prototype.increaseMaxEditDistance=function(){this.tierOrdering.forEach(function(e){e.increaseMaxEditDistance()})},r.prototype.addInput=function(e){this.inputSequence.push(e),this.minInputCost.push(-Math.log(e[0].p));var t=[],n=this.completedPaths.map(function(o){var a=o.buildDeletionEdges(e),u=o.buildSubstitutionEdges(e);return a.concat(u)});this.completedPaths=[],this.returnedValues={},n.forEach(function(o){t=t.concat(o)});var i=new Xe(this.tierOrdering.length,t);this.tierOrdering.push(i),this.selectionQueue.enqueue(i)},r.prototype.removeLastInput=function(){},r.prototype.hasNextMatchEntry=function(){var e=this.selectionQueue.peek();return e?e.correctionQueue.count>0:!1},r.prototype.handleNextNode=function(){if(!this.hasNextMatchEntry())return{type:"none"};var e=this.selectionQueue.dequeue(),t=e.correctionQueue.dequeue(),n={type:"intermediate",cost:t.currentCost};if(this.processedEdgeSet[t.pathKey])return this.selectionQueue.enqueue(e),n;this.processedEdgeSet[t.pathKey]=!0;var i=!1;if(t.knownCost>2)return n;t.knownCost==2&&(i=!0);for(var o=0,a=0;a<=e.index;a++)o+=this.minInputCost[a];if(t.currentCost>o+2.5*r.EDIT_DISTANCE_COST_SCALE)return n;if(!i){var u=t.buildInsertionEdges();e.correctionQueue.enqueueAll(u)}if(e.index==this.tierOrdering.length-1)return this.completedPaths.push(t),this.selectionQueue.enqueue(e),{type:"complete",cost:t.currentCost,finalNode:t};var s=this.tierOrdering[e.index+1],c=s.index,f=[];i||(f=t.buildDeletionEdges(this.inputSequence[c-1]));var l=t.buildSubstitutionEdges(this.inputSequence[c-1]);return s.correctionQueue.enqueueAll(f.concat(l)),this.selectionQueue=new z(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering),n},r.prototype.getBestMatches=function(e){return(0,_.__asyncGenerator)(this,arguments,function(){var n,i,o,a,s,u,s,c=this;return(0,_.__generator)(this,function(f){switch(f.label){case 0:if(n={},i=Object.values(this.returnedValues),!(i.length>0))return[3,6];o=new z(Pe,i),f.label=1;case 1:return o.count>0?(a=e.time(function(){var l=o.dequeue();return l.isFullReplacement?null:(n[l.resultKey]=l,new ze(l))},he.CACHED_RESULT),a?(s=e.start(he.PREDICTING),[4,(0,_.__await)(a)]):[3,5]):[3,6];case 2:return[4,f.sent()];case 3:return f.sent(),s.end(),e.timeSinceLastDefer>Ve?[4,(0,_.__await)(e.defer())]:[3,5];case 4:f.sent(),f.label=5;case 5:return[3,1];case 6:return u=e.time(function(){var l,d,h=c.handleNextNode();if(h.type=="none")return null;if(h.type=="complete"){var g=h.finalNode;if(g.isFullReplacement)return null;var v=h.finalNode;if(((d=(l=n[v.resultKey])===null||l===void 0?void 0:l.currentCost)!==null&&d!==void 0?d:Number.MAX_VALUE)>v.currentCost)return n[v.resultKey]=v,c.returnedValues[v.resultKey]=v,new ze(v)}return null},he.CORRECTING),u?(s=e.start(he.PREDICTING),[4,(0,_.__await)(u)]):[3,9];case 7:return[4,f.sent()];case 8:f.sent(),s.end(),f.label=9;case 9:return e.timeSinceLastDefer>Ve?[4,(0,_.__await)(e.defer())]:[3,11];case 10:f.sent(),f.label=11;case 11:if(!e.elapsed&&this.hasNextMatchEntry())return[3,6];f.label=12;case 12:return[4,(0,_.__await)(null)];case 13:return[2,f.sent()]}})})},r.EDIT_DISTANCE_COST_SCALE=5,r.MIN_KEYSTROKE_PROBABILITY=1e-4,r.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL=33,r}(),Qt=function(){function r(){}return r.isWhitespace=function(e){var t=/^[\\u0009\\u000A\\u000D\\u0020\\u00a0\\u1680\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u200b\\u2028\\u2029\\u202f\\u205f\\u3000]+$/i;return e.insert.match(t)!=null},r.isBackspace=function(e){return e.insert==""&&e.deleteLeft>0&&!e.deleteRight},r.isEmpty=function(e){return e.insert==""&&e.deleteLeft==0&&!e.deleteRight},r}(),te=Qt;function dt(r,e){for(var t=[],n=0;n<r.kmwLength();n++){var i=r.kmwCharAt(n),o={insert:i,deleteLeft:0,id:e};t.push(o)}return t}var Kt=function(){function r(){}return r}(),re=function(){function r(){this.transformDistributions=[],this.activeReplacementId=-1}return Object.defineProperty(r.prototype,"currentText",{get:function(){return this.replacementText===void 0||this.replacementText===null?this.raw:this.replacementText},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"replacement",{get:function(){var e=this.activeReplacementId;return this.replacements.find(function(t){return t.suggestion.id==e})},enumerable:!1,configurable:!0}),r.prototype.revert=function(){delete this.activeReplacementId},r}(),Ee=function(){function r(e){if(this.searchSpace=[],e instanceof r){var t=e;this.tokens=t.tokens.map(function(i){var o=new re;return o.raw=i.raw,o.replacements=[].concat(i.replacements),o.activeReplacementId=i.activeReplacementId,o.transformDistributions=[].concat(i.transformDistributions),i.replacementText&&(o.replacementText=i.replacementText),o}),this.indexOffset=0;var n=this.model=e.model;this.taggedContext=e.taggedContext,n!=null&&n.traverseFromRoot&&(this.searchSpace=e.searchSpace.map(function(i){return new ee(i)}))}else{var n=e;this.tokens=[],this.indexOffset=Number.MIN_SAFE_INTEGER,this.model=n,n&&n.traverseFromRoot&&(this.searchSpace=[new ee(n)])}}return Object.defineProperty(r.prototype,"head",{get:function(){return this.tokens[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tail",{get:function(){return this.tokens[this.tokens.length-1]},enumerable:!1,configurable:!0}),r.prototype.popHead=function(){this.tokens.splice(0,2),this.indexOffset-=1},r.prototype.pushTail=function(e){this.model&&this.model.traverseFromRoot?this.searchSpace=[new ee(this.model)]:this.searchSpace=[],this.tokens.push(e);var t=this;t.searchSpace.length>0&&e.transformDistributions.forEach(function(n){return t.searchSpace[0].addInput(n)})},r.prototype.pushWhitespaceToTail=function(e){e===void 0&&(e=null);var t=new re;t.transformDistributions=e?[e]:[],t.raw=null,this.tokens.push(t)},r.prototype.replaceTailForBackspace=function(e,t){this.tokens.pop();var n=dt(e,t).map(function(o){return[{sample:o,p:1}]}),i=new re;i.raw=e,i.transformDistributions=n,this.pushTail(i)},r.prototype.updateTail=function(e,t){var n=this.tail;t=t||(t===""?"":n.raw),e&&e.length>0&&(n.transformDistributions.push(e),this.searchSpace&&this.searchSpace.forEach(function(i){return i.addInput(e)})),n.raw=t},r.prototype.toRawTokenization=function(){var e,t,n=[];try{for(var i=(0,_.__values)(this.tokens),o=i.next();!o.done;o=i.next()){var a=o.value;a.currentText!==null&&n.push(a.currentText)}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r}(),Gt=function(){function r(e){e===void 0&&(e=r.DEFAULT_ARRAY_SIZE),this.currentHead=0,this.currentTail=0,this.circle=Array(e)}return Object.defineProperty(r.prototype,"count",{get:function(){var e=this.currentHead-this.currentTail;return e<0&&(e=e+this.circle.length),e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxCount",{get:function(){return this.circle.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"oldest",{get:function(){if(this.count!=0)return this.item(0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"newest",{get:function(){if(this.count!=0)return this.item(this.count-1)},enumerable:!1,configurable:!0}),r.prototype.enqueue=function(e){var t=null,n=(this.currentHead+1)%this.maxCount;return n==this.currentTail&&(t=this.circle[this.currentTail],this.currentTail=(this.currentTail+1)%this.maxCount),this.circle[this.currentHead]=e,this.currentHead=n,t},r.prototype.dequeue=function(){if(this.currentTail==this.currentHead)return null;var e=this.circle[this.currentTail];return this.currentTail=(this.currentTail+1)%this.maxCount,e},r.prototype.popNewest=function(){if(this.currentTail==this.currentHead)return null;var e=this.circle[this.currentHead];return this.currentHead=(this.currentHead-1+this.maxCount)%this.maxCount,e},r.prototype.item=function(e){if(e>=this.count)throw"Invalid array index";var t=(this.currentTail+e)%this.maxCount;return this.circle[t]},r.DEFAULT_ARRAY_SIZE=5,r}(),gt=function(r){(0,_.__extends)(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.attemptMatchContext=function(t,n,i){var o=n.toRawTokenization(),a=Ge.computeDistance(o.map(function(F){return{key:F}}),t.map(function(F){return{key:F}}),1),u=a.editPath(),s=!1,c=!1;if(u.length>1){if(u[0]=="insert"&&!(u[1]=="substitute"&&u.length==2)||u[0].indexOf("transpose")>=0)return null;u[0]=="delete"&&(s=!0)}var f=u.length-1,l=!1;if(u[f]=="delete"||u[0].indexOf("transpose")>=0||(u[f]=="insert"?c=!0:f>0&&u[f-1]=="insert"&&u[f]=="substitute"&&(c=!0,l=!0),f>0&&u[f-1]=="delete"&&u[f]=="substitute"))return null;for(var d=1;d<u.length-(l?2:1);d++)if(u[d]!="match")return null;var h;c?(l&&(n.tail.replacementText=t[t.length-2]),h=new Ee(n)):h=i?new Ee(n):n;var g=i&&Array.isArray(i),v=g?i[0].sample:null;v&&v.insert==""&&v.deleteLeft==0&&!v.deleteRight&&(v=null);var S=v&&te.isWhitespace(v),b=v&&te.isBackspace(v),m=t[t.length-1];function C(){S&&u[f]=="match"||(b?h.replaceTailForBackspace(m,v.id):h.updateTail(v?i:null,m))}if(u.length>1)if(s&&h.popHead(),c){var k=t[t.length-1],O=new re;O.raw=k,S||!v?(h.pushWhitespaceToTail(i!=null?i:[]),O.transformDistributions=[]):(h.pushWhitespaceToTail(),O.transformDistributions=i?[i]:[]),h.pushTail(O)}else C();else if(u[f]=="insert"){var w=new re;w.raw=t[0],w.transformDistributions=[i],h.pushTail(w)}else C();return h},e.modelContextState=function(t,n,i){var o=t.map(function(s){var c=new re;return c.raw=s,c.raw?c.transformDistributions=dt(c.raw).map(function(f){return[{sample:f,p:1}]}):c.transformDistributions=[],c}),a=new Ee(i);for(o.length>0&&a.pushTail(o.splice(0,1)[0]);o.length>0;)a.pushWhitespaceToTail(),a.pushTail(o.splice(0,1)[0]);if(a.tokens.length==0){var u=new re;u.raw="",a.pushTail(u)}return a},e.prototype.analyzeState=function(t,n,i){if(!t.traverseFromRoot)throw"This lexical model does not provide adequate data for correction algorithms and context reuse";var o=Ae(t.wordbreaker||fe,n);if(o.left.length>0)for(var a=this.count-1;a>=0;a--){var u=this.item(a),s=u.taggedContext;if(s&&i&&i.length>0){var c=G(i[0].sample,s);if(c.left!=n.left)continue}else if((s==null?void 0:s.left)!=n.left)continue;var f=e.attemptMatchContext(o.left,this.item(a),i);if(f)return this.newest!=f&&this.newest!=u&&this.enqueue(u),f.taggedContext=n,f!=this.item(a)&&this.enqueue(f),f}var l=e.modelContextState(o.left,i,t);return l.taggedContext=n,this.enqueue(l),l},e.prototype.clearCache=function(){for(;this.count>0;)this.dequeue()},e}(Gt),Vt=function(){function r(e,t){this.SUGGESTION_ID_SEED=0,this.testMode=!1,this.lexicalModel=e,e.traverseFromRoot&&(this.contextTracker=new gt),this.punctuation=r.determinePunctuationFromModel(e),this.testMode=!!t}return r.prototype.predictFromCorrections=function(e,t){var n,i,o=[],a=function(l){var d=u.lexicalModel.predict(l.sample,t),h=d.map(function(g){var v=l.sample,S=l.p;v.id!==void 0&&(g.sample.transformId=v.id);var b={sample:g.sample,p:g.p*S};return b},u);o=o.concat(h)},u=this;try{for(var s=(0,_.__values)(e),c=s.next();!c.done;c=s.next()){var f=c.value;a(f)}}catch(l){n={error:l}}finally{try{c&&!c.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o},r.prototype.predict=function(e,t){return(0,_.__awaiter)(this,void 0,void 0,function(){var n,i,o,a,u,s,c,f,l,d,h,g,v,S,b,m,C,k,O,w,F,B,L,Q,J,ae,be,ue,$,pe,V,ve,ne,ie,mt,Ce,de,Y,ge,Me,Ie,_e,wt,Ye,_e,Ze,St,bt,ye,Ne,Je,Ct,$e,et,_t,kt,tt;return(0,_.__generator)(this,function(Z){switch(Z.label){case 0:return n=[],i=this.lexicalModel,o=this.punctuation,(tt=this.activeTimer)===null||tt===void 0||tt.terminate(),e instanceof Array?e.length==0&&e.push({sample:{insert:"",deleteLeft:0},p:1}):e=[{sample:e,p:1}],a=e.sort(function(I,W){return W.p-I.p})[0].sample,u=te.isWhitespace(a),s=te.isBackspace(a),c=G(a,t),f=this.wordbreak(c),l=null,d=[],g=null,this.contextTracker?[3,1]:(v=void 0,u?(v=[{sample:a,p:1}],h=a):v=e.map(function(I){var W=I.sample;return te.isWhitespace(W)&&!u||te.isBackspace(W)&&!s?null:I}),v=v.filter(function(I){return!!I}),d=this.predictFromCorrections(v,t),[3,14]);case 1:S=this.contextTracker.analyzeState(this.lexicalModel,t,null),g=this.contextTracker.analyzeState(this.lexicalModel,c,te.isEmpty(a)?null:e),b=g.searchSpace[0],m=0,C=g.tokens,k=C.length,O=C.length-S.tokens.length,k==0||O>0?(m=0,te.isWhitespace(a)&&(h=a,t=c,S=g)):O<0?m=this.wordbreak(c).kmwLength()+a.deleteLeft:m=this.wordbreak(t).kmwLength(),w=C[C.length-1],F=w.transformDistributions.length<=1,B=ee.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL,L=this.activeTimer=new pt(this.testMode?Number.MAX_VALUE:B,this.testMode?Number.MAX_VALUE:B*1.5),Q=void 0,J={},Z.label=2;case 2:Z.trys.push([2,7,8,13]),ae=function(){kt=pe.value,ue=!1;var I=kt,W=I.matchString,qe={insert:W,deleteLeft:m,id:a.id},Le=I.totalCost;F&&(Le*=r.SINGLE_CHAR_KEY_PROB_EXPONENT);var xt={sample:qe,p:Math.exp(-Le)},rt=be.predictFromCorrections([xt],t);rt.length>0&&Q===void 0&&(Q=-Math.log(xt.p));var Tt=J[I.matchString];Tt&&(d=d.filter(function(it){return!Tt.find(function(ot){return it==ot})})),J[I.matchString]=rt,d=d.concat(rt);var nt=I.totalCost;if(nt>=Q+8)return"break";if(d.length>=r.MAX_SUGGESTIONS){if(nt>=Q+4)return"break";if(d.sort(function(it,ot){return ot.p-it.p}),d[r.MAX_SUGGESTIONS-1].p>Math.exp(-nt))return"break"}},be=this,ue=!0,$=(0,_.__asyncValues)(b.getBestMatches(L)),Z.label=3;case 3:return[4,$.next()];case 4:if(pe=Z.sent(),$e=pe.done,!!$e)return[3,6];if(V=ae(),V==="break")return[3,6];Z.label=5;case 5:return ue=!0,[3,3];case 6:return[3,13];case 7:return ve=Z.sent(),et={error:ve},[3,13];case 8:return Z.trys.push([8,,11,12]),!ue&&!$e&&(_t=$.return)?[4,_t.call($)]:[3,10];case 9:Z.sent(),Z.label=10;case 10:return[3,12];case 11:if(et)throw et.error;return[7];case 12:return[7];case 13:this.activeTimer==L&&(this.activeTimer=null),Z.label=14;case 14:ne={},ie=null,i.languageUsesCasing&&(ie=this.detectCurrentCasing(c)),mt=this.wordbreak(t);try{for(Ce=(0,_.__values)(d),de=Ce.next();!de.done;de=Ce.next())Y=de.value,ge=Y.sample.displayAs,Me=ge==f,this.lexicalModel.languageUsesCasing&&(Me=Me||ge==this.lexicalModel.applyCasing("lower",f)),Me?l?l.p&&Y.p&&(l.p+=Y.p):(Ie=Y.sample.transform,_e={insert:f,deleteLeft:Ie.deleteLeft,deleteRight:Ie.deleteRight,id:Ie.id},wt=U(_e,Y.p),l=this.toAnnotatedSuggestion(wt,"keep",Oe.noQuotes),l.matchesModel=!0,l.transformId=Y.sample.transformId):(ie&&ie!="lower"&&(this.applySuggestionCasing(Y.sample,mt,ie),ge=Y.sample.displayAs),Ye=ne[ge],Ye?Ye.p+=Y.p:ne[ge]=Y)}catch(I){Je={error:I}}finally{try{de&&!de.done&&(Ct=Ce.return)&&Ct.call(Ce)}finally{if(Je)throw Je.error}}!l&&f!=""&&(_e=(0,_.__assign)({},a),Ze=U(_e,1),Ze.displayAs=f,l=this.toAnnotatedSuggestion(Ze,"keep"),l.matchesModel=!1);for(St in ne)bt=ne[St],n.push(bt);return n=n.sort(function(I,W){return W.p-I.p}),ye=n.splice(0,r.MAX_SUGGESTIONS).map(function(I){var W=I.sample;return W.p&&(W["lexical-p"]=W.p,W["correction-p"]=I.p/W.p,W.p=I.p),W}),l&&(ye=[l].concat(ye)),Ne=this,ye.forEach(function(I){var W=Ne.tokenize(t);if(W&&W.caretSplitsToken?I.transform.insert+=o.insertAfterWord:t.right?o.insertAfterWord!=""&&t.right.indexOf(o.insertAfterWord)!=0&&(I.transform.insert+=o.insertAfterWord):I.transform.insert+=o.insertAfterWord,h){var qe=p(h,I.transform);qe.id=I.transformId;var Le=I;Le.transform=qe}I.id=Ne.SUGGESTION_ID_SEED,Ne.SUGGESTION_ID_SEED++}),g&&(g.tail.replacements=ye.map(function(I){return{suggestion:I,tokenWidth:1}})),[2,ye]}})})},r.prototype.applySuggestionCasing=function(e,t,n){var i=t.kmwLength()-e.transform.deleteLeft;i>0&&(e.transform.deleteLeft+=i,e.transform.insert=t.kmwSubstr(0,i)+e.transform.insert),e.transform.insert=this.lexicalModel.applyCasing(n,e.transform.insert),e.displayAs=this.lexicalModel.applyCasing(n,e.displayAs)},r.prototype.toAnnotatedSuggestion=function(e,t,n){n===void 0&&(n=Oe.default);var i=Oe,o=i.noQuotes;return(t=="keep"||t=="revert")&&(o=i.useQuotes),{transform:e.transform,transformId:e.transformId,displayAs:i.apply(n,e.displayAs,this.punctuation,o),tag:t,p:e.p}},r.determinePunctuationFromModel=function(e){var t=Xt;if(!e.punctuation)return t;var n=e.punctuation,i=n.insertAfterWord;i!==""&&!i&&(i=t.insertAfterWord);var o=n.quotesForKeepSuggestion;o||(o=t.quotesForKeepSuggestion);var a=n.isRTL;return{insertAfterWord:i,quotesForKeepSuggestion:o,isRTL:a}},r.prototype.acceptSuggestion=function(e,t,n){var i=e.transform,o=t.left.kmwSubstr(-i.deleteLeft,i.deleteLeft),a=i.insert.kmwLength(),u={insert:o,deleteLeft:a},s=t;n&&(u=p(u,n),s=G(n,s));var c,f=this.tokenize(s);f?(f.left.length>0?c=f.left[f.left.length-1]:c="",c+=f.caretSplitsToken?f.right[0]:""):c=this.wordbreak(s);var l=U(u);l.displayAs=c;var d=this.toAnnotatedSuggestion(l,"revert");if(e.transformId!=null&&(d.transformId=-e.transformId),e.id!=null?d.id=-e.id:(d.id=-this.SUGGESTION_ID_SEED,this.SUGGESTION_ID_SEED++),this.contextTracker){var h=this.contextTracker.newest;h||(h=this.contextTracker.analyzeState(this.lexicalModel,t)),h.tail.activeReplacementId=e.id;var g=G(e.transform,t);this.contextTracker.analyzeState(this.lexicalModel,g)}return d},r.prototype.applyReversion=function(e,t){return(0,_.__awaiter)(this,void 0,void 0,function(){var n,i,o,a,u,s;return(0,_.__generator)(this,function(c){if(n=this,i=function(){return(0,_.__awaiter)(this,void 0,void 0,function(){var f,l;return(0,_.__generator)(this,function(d){switch(d.label){case 0:return f=G(e.transform,t),[4,n.predict({insert:"",deleteLeft:0},f)];case 1:return l=d.sent(),l.forEach(function(h){h.transformId=-e.transformId}),[2,l]}})})},!this.contextTracker)return[2,i()];for(o=!1,a=this.contextTracker.count-1;a>=0;a--)if(u=this.contextTracker.item(a),u.tail.activeReplacementId==-e.id){o=!0;break}if(!o)return[2,i()];for(;this.contextTracker.newest.tail.activeReplacementId!=-e.id;)this.contextTracker.popNewest();return this.contextTracker.newest.tail.revert(),s=this.contextTracker.newest.tail.replacements.map(function(f){return f.suggestion}),s.forEach(function(f){f.transformId=-e.transformId}),[2,s]})})},r.prototype.wordbreak=function(e){var t=this.lexicalModel;if(t.wordbreaker||!t.wordbreak){var n=t.wordbreaker||fe;return je(n,e)}else return t.wordbreak(e)},r.prototype.tokenize=function(e){var t=this.lexicalModel;return t.wordbreaker?Ae(t.wordbreaker,e):null},r.prototype.resetContext=function(e){var t;(t=this.activeTimer)===null||t===void 0||t.terminate(),this.contextTracker&&(this.contextTracker.clearCache(),this.contextTracker.analyzeState(this.lexicalModel,e,null))},r.prototype.detectCurrentCasing=function(e){var t,n=this.lexicalModel,i=this.wordbreak(e);if(!n.languageUsesCasing)throw"Invalid attempt to detect casing: languageUsesCasing is set to false";if(!n.applyCasing)throw"Invalid LMLayer state:  languageUsesCasing is set to true, but no applyCasing function exists";return e.casingForm=="upper"||e.casingForm=="initial"?e.casingForm:n.applyCasing("lower",i)==i?"lower":n.applyCasing("upper",i)==i?i.kmwLength()>1?"upper":"initial":n.applyCasing("initial",i)==i?"initial":(t=e.casingForm)!==null&&t!==void 0?t:null},r.MAX_SUGGESTIONS=12,r.SINGLE_CHAR_KEY_PROB_EXPONENT=16,r}(),Ht=Vt,Xt={quotesForKeepSuggestion:{open:"\\u201C",close:"\\u201D"},insertAfterWord:" "};H();var zt=function(){function r(e){e===void 0&&(e={importScripts:null,postMessage:null}),this._testMode=!1,this._postMessage=e.postMessage||postMessage,this._importScripts=e.importScripts||importScripts,this.setupConfigState()}return r.prototype.error=function(e,t){this.cast("error",{log:e,error:t&&t.stack?t.stack:void 0})},r.prototype.onMessage=function(e){var t=e.data.message;if(!t)throw new Error("Missing required \'message\' property: ".concat(e.data));var n=e.data;if(n.message=="load"){var i=n,o=!1;if(this._currentModelSource&&i.source.type==this._currentModelSource.type&&(i.source.type=="file"&&i.source.file==this._currentModelSource.file||i.source.type=="raw"&&i.source.code==this._currentModelSource.code)&&(o=!0),o){typeof console!="undefined"&&console.warn("Duplicate model load message detected - squashing!");return}else this._currentModelSource=i.source}else n.message=="unload"&&(this._currentModelSource=null);this.state.handleMessage(n)},r.prototype.cast=function(e,t){var n=this._postMessage;n((0,_.__assign)({message:e},t))},r.prototype.loadModel=function(e){try{var t=e.configure(this._platformCapabilities);t.leftContextCodePoints||(t.leftContextCodePoints=t.leftContextCodeUnits),t.rightContextCodePoints||(t.rightContextCodePoints=t.rightContextCodeUnits),t.leftContextCodePoints||(t.leftContextCodePoints=this._platformCapabilities.maxLeftContextCodePoints),t.rightContextCodePoints||(t.rightContextCodePoints=this._platformCapabilities.maxRightContextCodePoints||0),e.languageUsesCasing&&!e.applyCasing&&(e.applyCasing=X);var n=this.transitionToReadyState(e);t.wordbreaksAfterSuggestions===void 0&&(t.wordbreaksAfterSuggestions=n.punctuation.insertAfterWord!=""),this.cast("ready",{configuration:t})}catch(i){this.error("loadModel failed!",i)}},r.prototype.loadModelFile=function(e){try{this._importScripts(e)}catch(t){this.error("Error occurred when attempting to load dictionary",t)}},r.prototype.unloadModel=function(){this.transitionToLoadingState()},r.prototype.setupConfigState=function(){var e=this;this.state={name:"unconfigured",handleMessage:function(t){if(t.message!=="config")throw new Error("invalid message; expected \'config\' but got ".concat(t.message));e._platformCapabilities=t.capabilities,e._testMode=!!t.testMode,e.transitionToLoadingState()}}},r.prototype.transitionToLoadingState=function(){var e=this;this.state={name:"modelless",handleMessage:function(t){if(t.message!=="load")throw new Error("invalid message; expected \'load\' but got ".concat(t.message));if(t.source.type=="file")e.loadModelFile(t.source.file);else{var n=t.source.code,i=new Function("LMLayerWorker","models","correction","wordBreakers",n);i(e,le,Ke,Ue)}}}},r.prototype.transitionToReadyState=function(e){var t=this,n=new Ht(e,this._testMode);return this.state={name:"ready",handleMessage:function(i){switch(i.message){case"predict":var o=i.transform,f=i.context;n.predict(o,f).then(function(l){t.cast("suggestions",{token:i.token,suggestions:l})});break;case"wordbreak":var a=je(e.wordbreaker||fe,i.context);t.cast("currentword",{token:i.token,word:a});break;case"unload":t.unloadModel();break;case"accept":var u=i.suggestion,f=i.context,s=i.postTransform,c=n.acceptSuggestion(u,f,s);t.cast("postaccept",{token:i.token,reversion:c});break;case"revert":var c=i.reversion,f=i.context;n.applyReversion(c,f).then(function(l){t.cast("postrevert",{token:i.token,suggestions:l})});break;case"reset-context":var f=i.context;n.resetContext(f);break;default:throw new Error("invalid message; expected one of {\'predict\', \'wordbreak\', \'accept\', \'revert\', \'reset-context\', \'unload\'} but got ".concat(i.message))}},compositor:n},n},r.install=function(e){var t=new r({postMessage:e.postMessage,importScripts:e.importScripts.bind(e)});return e.onmessage=t.onMessage.bind(t),t.self=e,e.LMLayerWorker=t,e.models=le,e.correction=Ke,e.wordBreakers=Ue,t},r}(),yt=zt;typeof self!="undefined"&&"postMessage"in self&&"importScripts"in self?yt.install(self):window.LMLayerWorker=yt}();\n',oc="";var Ro=function(){function c(){}return c.constructInstance=function(){return new Worker(this.asBlobURI(ic))},c.asBlobURI=function(e){var t=ke(e);t+="\n"+oc;var n=new Blob([t],{type:"text/javascript"});return URL.createObjectURL(n)},c}(),On=Ro;var lc=function(){function c(e,t){this.suggestions=e,this.transcriptionID=t}return c}();var Ao=function(c){(0,d.__extends)(e,c);function e(t,n,r){r===void 0&&(r=!1);var i=c.call(this)||this;i._mayPredict=!0,i._mayCorrect=!0,i._state="inactive",i.recentTranscriptions=n;var o={maxLeftContextCodePoints:64,maxRightContextCodePoints:r?0:64};return t&&(i.lmEngine=new En(o,t)),i}return Object.defineProperty(e.prototype,"activeModel",{get:function(){return this.currentModel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConfigured",{get:function(){return!!this.configuration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),e.prototype.unloadModel=function(){this.lmEngine.unloadModel(),delete this.currentModel,delete this.configuration,this._state="inactive",this.emit("statechange","inactive")},e.prototype.loadModel=function(t){var n=this;if(!t)throw new Error("Null reference not allowed.");var r=t.path?"file":"raw",i=r=="file"?t.path:t.code;return this.currentModel=t,this.mayPredict&&(this._state="active",this.emit("statechange","active")),this.lmEngine.loadModel(i,r).then(function(o){n.configuration=o,n.mayPredict&&(n._state="configured",n.emit("statechange","configured"))}).catch(function(o){var l;o instanceof Error?l=o.message:l=String(o),console.error("Could not load model '"+t.id+"': "+l),n.currentModel=null,n._state="inactive",n.emit("statechange","inactive")})},e.prototype.invalidateContext=function(t,n){if(this.emit("invalidatesuggestions","context"),!this.currentModel||!this.configuration)return Promise.resolve([]);if(this.isActive)if(t){var r=t.buildTranscriptionFrom(t,null,!1);return this.predict_internal(r,!0,n)}else return Promise.resolve([]);else return Promise.resolve([])},e.prototype.wordbreak=function(t,n){if(!this.isActive)return null;var r=new Xt(Y.from(t,!1),this.configuration,n);return this.lmEngine.wordbreak(r)},e.prototype.predict=function(t,n){return!this.isActive||!this.currentModel||!this.configuration?null:(this.emit("invalidatesuggestions","new"),this.predict_internal(t,!1,n))},e.prototype.applySuggestion=function(t,n,r){var i=this;if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";if(!this.isConfigured)return console.warn("Could not apply suggestion; the corresponding model has been unloaded"),null;var o=this.getPredictionState(t.transformId);if(o){var l=Y.from(o.preInput,!1);l.apply(t.transform);var a=l.buildTransformFrom(n);n.apply(a),this.emit("suggestionapplied",n);var s=Y.from(o.preInput,!1);s.apply(o.transform);var B=new Xt(o.preInput,this.configuration,r()),g=this.lmEngine.acceptSuggestion(t,B,o.transform);return g=g.then(function(u){var F={transform:o.transform,transformId:-o.token,displayAs:u.displayAs,id:u.id,tag:u.tag};return i.predictFromTarget(n,r()),F}),g}else return console.warn("Could not apply the Suggestion!"),null},e.prototype.applyReversion=function(t,n){var r=this;if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";var i=this.getPredictionState(-t.transformId);if(!i)return console.warn("Could not apply the Suggestion!"),Promise.resolve([]);var o=Y.from(i.preInput,!1);o.apply(t.transform);var l=o.buildTransformFrom(n);n.apply(l);var a=this.lmEngine.revertSuggestion(t,new Xt(i.preInput,this.configuration,null));return a.then(function(s){var B=new lc(s,l.id);return r.emit("suggestionsready",B),r.currentPromise=null,s})},e.prototype.predictFromTarget=function(t,n){if(!t)return null;var r=t.buildTranscriptionFrom(t,null,!1);return this.predict(r,n)},e.prototype.predict_internal=function(t,n,r){var i=this;if(!t)return null;var o=new Xt(t.preInput,this.configuration,r);this.recordTranscription(t),n&&this.lmEngine.resetContext(o);var l=t.alternates;(!l||l.length==0)&&(l=[{sample:t.transform,p:1}]);var a=t.transform,s=this.currentPromise=this.lmEngine.predict(l,o);return s.then(function(B){if(s==i.currentPromise){var g=new lc(B,a.id);i.emit("suggestionsready",g),i.currentPromise=null}return B})},e.prototype.recordTranscription=function(t){this.recentTranscriptions.save(t)},e.prototype.getPredictionState=function(t){return this.recentTranscriptions.get(t)},e.prototype.shutdown=function(){this.lmEngine.shutdown()},Object.defineProperty(e.prototype,"isActive",{get:function(){return this.canEnable()?(this.activeModel||!1)&&this._mayPredict:(this._mayPredict=!1,!1)},enumerable:!1,configurable:!0}),e.prototype.canEnable=function(){return!!this.lmEngine},Object.defineProperty(e.prototype,"mayPredict",{get:function(){return this._mayPredict},set:function(t){if(this.canEnable()){var n=this._mayPredict;if(this._mayPredict=t,n!=t&&this.activeModel){var r=t?"active":"inactive";this._state=r,this.emit("statechange",r),t&&this.isConfigured&&(this._state="configured",this.emit("statechange","configured"))}}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mayCorrect",{get:function(){return this._mayCorrect},set:function(t){this._mayCorrect=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wordbreaksAfterSuggestions",{get:function(){return this.configuration.wordbreaksAfterSuggestions},enumerable:!1,configurable:!0}),e.prototype.tryAcceptSuggestion=function(t){return this.emit("tryaccept",t),!1},e.prototype.tryRevertSuggestion=function(){return this.emit("tryrevert"),!1},e}(v.default),Yn=Ao;var Ho=10,wn=function(){function c(){this.map=new Map}return c.prototype.get=function(e){var t=this.map.get(e);return t&&this.save(t),t},c.prototype.save=function(e){var t=e.token>=0?e.token:-e.token;this.map.delete(t),this.map.set(t,e),this.map.size>Ho&&this.map.delete(this.map.keys().next().value)},c}();var ko=function(){function c(e,t,n){if(this.contextCache=new wn,!e)throw new Error("device must be defined");n||(n=c.DEFAULT_OPTIONS),this.contextDevice=e,this.kbdProcessor=new Gn(e,n),this.lngProcessor=new Yn(t,this.contextCache)}return Object.defineProperty(c.prototype,"languageProcessor",{get:function(){return this.lngProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"keyboardProcessor",{get:function(){return this.kbdProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"keyboardInterface",{get:function(){return this.keyboardProcessor.keyboardInterface},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"activeKeyboard",{get:function(){return this.keyboardInterface.activeKeyboard},set:function(e){this.keyboardInterface.activeKeyboard=e,this.resetContext()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"activeModel",{get:function(){return this.languageProcessor.activeModel},enumerable:!1,configurable:!0}),c.prototype.processKeyEvent=function(e,t){var n=e.srcKeyboard&&this.activeKeyboard!=e.srcKeyboard,r=this.activeKeyboard;try{if(n&&(this.keyboardInterface.activeKeyboard=e.srcKeyboard),e.baseTranscriptionToken){var i=this.contextCache.get(e.baseTranscriptionToken);i?(!Yt(i.transform)||!i.preInput.isEqual(Y.from(t)))&&t.restoreTo(i.preInput):console.warn("The base context for the multitap could not be found")}return this._processKeyEvent(e,t)}finally{n&&(this.keyboardInterface.activeKeyboard=r)}},c.prototype._processKeyEvent=function(e,t){var n,r=e.device.formFactor,i=e.isSynthetic;if((r==f.FormFactor.Desktop||!this.activeKeyboard||this.activeKeyboard.usesDesktopLayoutOnDevice(e.device))&&i&&this.keyboardProcessor.selectLayer(e))return new Ft;if(this.keyboardProcessor.doModifierPress(e,t,!i)&&!i)return new Ft;if(this.languageProcessor.isActive){if((e.kName=="K_BKSP"||e.Lcode==C.keyCodes.K_BKSP)&&this.languageProcessor.tryRevertSuggestion())return new Ft;if((e.kName=="K_SPACE"||e.Lcode==C.keyCodes.K_SPACE)&&this.languageProcessor.tryAcceptSuggestion("space"))return new Ft}var o=Y.from(t,!0),l=this.keyboardProcessor.layerId,a=this.keyboardProcessor.processKeystroke(e,t);e.kNextLayer&&this.keyboardProcessor.selectLayer(e);var s=C.isFrameKey(e.kName);Yt((n=a==null?void 0:a.transcription)===null||n===void 0?void 0:n.transform)&&e.kNextLayer&&(s=!0);var B=a!=null;if(B){var g=s?null:this.buildAlternates(a,e,o);a.finalize(this.keyboardProcessor,t,!1),g&&g.length>0&&(a.transcription.alternates=g)}else a=new Ft,a.transcription=t.buildTranscriptionFrom(t,null,!1),a.triggersDefaultCommand=!0;this.contextCache.save(a.transcription);var u=a.setStore[O.TSS_LAYER]||e.kNextLayer;this.keyboardProcessor.newLayerStore.set(u?this.keyboardProcessor.layerId:""),this.keyboardProcessor.oldLayerStore.set(u?l:"");var F=this.keyboardProcessor.processPostKeystroke(this.contextDevice,t);return F&&F.finalize(this.keyboardProcessor,t,!0),a.predictionPromise=this.languageProcessor.predict(a.transcription,this.keyboardProcessor.layerId),a.triggersDefaultCommand||t.doInputEvent(),B?a:null},c.prototype.buildAlternates=function(e,t,n){var r,i,o;if(this.languageProcessor.isActive&&!e.triggersDefaultCommand){var l=t.keyDistribution,a=new Xt(n,Xt.ENGINE_RULE_WINDOW,this.keyboardProcessor.layerId),s=a.toMock();if(this.languageProcessor.isActive&&l&&t.kbdLayer){var B=Number.MAX_VALUE,g=Pt(),u=void 0;g.performance&&g.performance.now&&(u=function(){return g.performance.now()},B=u()+16);var F=Math.exp(-5);l.sort(function(m,J){return J.p-m.p}),o=[];var y=0;try{for(var I=(0,d.__values)(l),Q=I.next();!Q.done;Q=I.next()){var U=Q.value;if(U.p<F){y+=U.p;break}else if(u&&u()>=B)break;var h=Y.from(s,!1),b=U.keySpec;if(!b){console.warn("Internal error:  failed to properly filter set of keys for corrections");continue}var p=this.keyboardProcessor.activeKeyboard.constructKeyEvent(b,t.device,this.keyboardProcessor.stateKeys),X=this.keyboardProcessor.processKeystroke(p,h);if(X&&!X.beep&&U.p>0){var x=X.transcription.transform;x.id=e.transcription.token,o.push({sample:x,p:U.p}),y+=U.p}}}catch(m){r={error:m}}finally{try{Q&&!Q.done&&(i=I.return)&&i.call(I)}finally{if(r)throw r.error}}o.forEach(function(m){m.p/=y})}}return o},c.prototype.resetContext=function(e){this.keyboardProcessor.resetContext(e),this.languageProcessor.invalidateContext(e,this.keyboardProcessor.layerId)},c.DEFAULT_OPTIONS={baseLayout:"us"},c}(),zn=ko;var No=function(c){(0,d.__extends)(e,c);function e(t,n){var r=c.call(this)||this;r.initNewContext=!0,r._currentSuggestions=[],r.recentAccept=!1,r.swallowPrediction=!1,r.doRevert=!1,r.recentRevert=!1,r.doTryAccept=function(o){!r.recentAccept&&r.selected?r.accept(r.selected):r.recentAccept&&o=="space"&&(r.recentAccept=!1)},r.doTryRevert=function(){r.doRevert?(r.doRevert=!1,r.recentAccept=!1):r.recentAccept&&(r.showRevert(),r.swallowPrediction=!0)},r.invalidateSuggestions=function(o){r.initNewContext=!1,(!r.swallowPrediction||o=="context")&&(r.recentAccept=!1,r.doRevert=!1,r.recentRevert=!1,o=="context"&&(r.swallowPrediction=!1,r.initNewContext=!0)),o!="new"&&r.clearSuggestions()},r.updateSuggestions=function(o){var l,a,s=o.suggestions;r._currentSuggestions=s,r.keepSuggestion=null;try{for(var B=(0,d.__values)(s),g=B.next();!g.done;g=B.next()){var u=g.value;u.tag=="keep"&&(r.keepSuggestion=u)}}catch(F){l={error:F}}finally{try{g&&!g.done&&(a=B.return)&&a.call(B)}finally{if(l)throw l.error}}r.keepSuggestion&&r._currentSuggestions.splice(r._currentSuggestions.indexOf(r.keepSuggestion),1),r.swallowPrediction?r.swallowPrediction=!1:(r.recentAccept=!1,r.doRevert=!1,r.recentRevert=!1),r.sendUpdateEvent()},r.onModelStateChange=function(o){(o=="configured"||o=="inactive")&&r.resetContext()},r.langProcessor=t,r.kbdProcessor=n;var i=function(){return r.currentTarget&&t.state=="configured"};return r.suggestionApplier=function(o){return i()?t.applySuggestion(o,r.currentTarget,function(){return n.layerId}):null},r.suggestionReverter=function(o){i()&&t.applyReversion(o,r.currentTarget)},r.postApplicationHandler=function(){var o;n.newLayerStore.set(""),n.oldLayerStore.set(""),(o=n.processPostKeystroke(n.contextDevice,r.currentTarget))===null||o===void 0||o.finalize(n,r.currentTarget,!0)},r.connect(),r}return Object.defineProperty(e.prototype,"currentTarget",{get:function(){return this._currentTarget},enumerable:!1,configurable:!0}),e.prototype.setCurrentTarget=function(t){var n=this._currentTarget;return this._currentTarget=t,n!=t?this.resetContext():Promise.resolve([])},Object.defineProperty(e.prototype,"modelState",{get:function(){return this.langProcessor.state},enumerable:!1,configurable:!0}),e.prototype.connect=function(){this.langProcessor.addListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.addListener("suggestionsready",this.updateSuggestions),this.langProcessor.addListener("tryaccept",this.doTryAccept),this.langProcessor.addListener("tryrevert",this.doTryRevert),this.langProcessor.addListener("statechange",this.onModelStateChange),this.langProcessor.addListener("suggestionapplied",this.postApplicationHandler)},e.prototype.disconnect=function(){this.langProcessor.removeListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.removeListener("suggestionsready",this.updateSuggestions),this.langProcessor.removeListener("tryaccept",this.doTryAccept),this.langProcessor.removeListener("tryrevert",this.doTryRevert),this.langProcessor.removeListener("statechange",this.onModelStateChange),this.langProcessor.removeListener("suggestionapplied",this.postApplicationHandler),this.clearSuggestions()},Object.defineProperty(e.prototype,"currentSuggestions",{get:function(){var t=[];return this.activateKeep()&&this.keepSuggestion&&this.keepSuggestion.matchesModel?t.push(this.keepSuggestion):this.doRevert&&t.push(this.revertSuggestion),t.concat(this._currentSuggestions)},enumerable:!1,configurable:!0}),e.prototype.acceptInternal=function(t){return t?t.tag=="revert"?(this.suggestionReverter(t),null):this.suggestionApplier(t):null},e.prototype.accept=function(t){var n=this;return this.selected=null,this.doRevert=!1,this.revertAcceptancePromise=this.acceptInternal(t),this.revertAcceptancePromise?(this.revertAcceptancePromise.then(function(r){r&&(n.revertSuggestion=r)}),this.recentAccept=!0,this.recentRevert=!1,this.swallowPrediction=!0,this.revertAcceptancePromise):(t&&t.tag=="revert"&&(this.recentAccept=!1,this.recentRevert=!0),Promise.resolve(null))},e.prototype.showRevert=function(){this.doRevert=!0,this.sendUpdateEvent()},e.prototype.clearSuggestions=function(){this.updateSuggestions({suggestions:[],transcriptionID:0})},e.prototype.activateKeep=function(){return!this.recentAccept&&!this.recentRevert&&!this.initNewContext},e.prototype.sendUpdateEvent=function(){this.emit("update",this.currentSuggestions)},e.prototype.resetContext=function(){var t=this.currentTarget;return t?this.langProcessor.invalidateContext(t,this.kbdProcessor.layerId):Promise.resolve([])},e}(v.default),Mn=No;var ac=function(){function c(e,t,n,r){this.Pelem=e,this.Peventname=t.toLowerCase(),this.Phandler=n,this.PuseCapture=r}return c.prototype.equals=function(e){return this.Pelem==e.Pelem&&this.Peventname==e.Peventname&&this.Phandler==e.Phandler&&this.PuseCapture==e.PuseCapture},c}(),Vt=function(){function c(){this.domEvents=[]}return c.prototype.attachDOMEvent=function(e,t,n,r){this.detachDOMEvent(e,t,n,r),e.addEventListener(t,n,!!r);var i=new ac(e,t,n,r);this.domEvents.push(i)},c.prototype.detachDOMEvent=function(e,t,n,r){e.removeEventListener(t,n,r);for(var i=new ac(e,t,n,r),o=0;o<this.domEvents.length;o++)if(this.domEvents[o].equals(i)){this.domEvents.splice(o,1);break}},c.prototype.shutdown=function(){for(var e=0,t=this.domEvents;e<t.length;e++){var n=t[e];this.detachDOMEvent(n.Pelem,n.Peventname,n.Phandler,n.PuseCapture)}},c}();var Ne=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this)||this;return t instanceof v.default?(t.on=n.listenerRegistrationSpy("listeneradded",t,t.on),t.addListener=n.listenerRegistrationSpy("listeneradded",t,t.addListener),t.off=n.listenerRegistrationSpy("listenerremoved",t,t.off),t.removeListener=n.listenerRegistrationSpy("listenerremoved",t,t.off)):(t.addEventListener=n.listenerRegistrationSpy("listeneradded",t,t.addEventListener),t.removeEventListener=n.listenerRegistrationSpy("listenerremoved",t,t.removeEventListener)),n}return e.prototype.listenerRegistrationSpy=function(t,n,r){var i=this;return function(o,l){var a=r.apply(n,[o,l]);return i.emit(t,o),a}},e}(v.default);var Te=function(){function c(){this.events={},this.currentEvents=[]}return c.prototype.addEventListener=function(e,t){return this._removeEventListener(e,t),this.events[e].push(t),!0},c.prototype.removeEventListener=function(e,t){return this._removeEventListener(e,t)},c.prototype._removeEventListener=function(e,t){typeof this.events[e]=="undefined"&&(this.events[e]=[]);for(var n=0;n<this.events[e].length;n++)if(this.events[e][n]==t)return this.events[e].splice(n,1),!0;return!1},c.prototype.callEvent=function(e,t){if(typeof this.events[e]=="undefined")return!0;if(this.currentEvents.indexOf(e)!=-1)return!1;this.currentEvents.push(e);for(var n=0;n<this.events[e].length;n++){var r=this.events[e][n],i=!1;try{i=r(t)}catch(o){console.error(o),i=!1}if(i===!1)return this.currentEvents.pop(),!1}return this.currentEvents.pop(),!0},c.prototype.listenerCount=function(e){var t=this.events[e];return t?t.length:0},c.prototype.shutdown=function(){this.events={}},c}();var To=function(){function c(e){e===void 0&&(e=!1),this.fileLocal=e}return c.prototype.request=function(e){var t=new L,n=window.setTimeout(function(){t.reject(new Error(_r))},1e4),r="&timerid="+n,i=e+r,o=document.createElement("script");o.onload=function(l){window.clearTimeout(n),t.isResolved||t.reject(new Error(qr))},o.onerror=function(l,a,s,B,g){window.clearTimeout(n);var u=Ln;g&&(u=u+": "+g.message),t.reject(new Error(u))},this.fileLocal?o.src=e:o.src=i;try{document.body.appendChild(o)}catch(l){document.getElementsByTagName("head")[0].appendChild(o)}return t.finally(function(){clearTimeout(n)}),{promise:t,queryId:n}},c}(),sc=To;function Eo(){return typeof window.KeymanWeb_BaseLayout!="undefined"?window.KeymanWeb_BaseLayout:"us"}var Oo=function(){function c(e,t,n,r){var i=this;this.legacyAPIEvents=new Te,this.keyEventListener=function(l,a){var s,B=i.contextManager.activeTarget;if(!i.contextManager.activeKeyboard||!B){a&&a(null,null);return}if(i.keyEventRefocus&&i.keyEventRefocus(),B.invalidateSelection(),B.deadkeys().deleteMatched(),l.isSynthetic){var g=i.osk.vkbd.layerId;g&&g!=i.core.keyboardProcessor.layerId&&(i.core.keyboardProcessor.layerId=g)}var u=i.core.processKeyEvent(l,B);u&&(!((s=u.transcription)===null||s===void 0)&&s.transform)&&i.config.onRuleFinalization(u,i.contextManager.activeTarget),a&&a(u,null)},this.config=t,this.contextManager=n;var o=r(this);o.baseLayout=Eo(),this.interface=o.keyboardInterface,this.core=new zn(t.hostDevice,e,o),this.core.languageProcessor.on("statechange",function(l){var a,s;(a=i.osk)===null||a===void 0||a.bannerController.selectBanner(l),(s=i.osk)===null||s===void 0||s.refreshLayout()}),this.core.keyboardProcessor.on("statekeychange",function(l){var a,s;(s=(a=i.osk)===null||a===void 0?void 0:a.vkbd)===null||s===void 0||s.updateStateKeys(l)}),this.contextManager.on("beforekeyboardchange",function(l){i.legacyAPIEvents.callEvent("beforekeyboardchange",{internalName:l==null?void 0:l.id,languageCode:l==null?void 0:l.langId})}),this.contextManager.on("keyboardchange",function(l){l||i.osk.startHide(!1);var a=function(){var s,B;i.refreshModel(),i.core.activeKeyboard=l==null?void 0:l.keyboard,i.legacyAPIEvents.callEvent("keyboardchange",{internalName:(s=l==null?void 0:l.metadata.id)!==null&&s!==void 0?s:"",languageCode:(B=l==null?void 0:l.metadata.langId)!==null&&B!==void 0?B:""})};i.osk?i.osk.batchLayoutAfter(function(){a(),i.osk.activeKeyboard=l,i.contextManager.resetContext(),i.osk.present()}):(a(),i.contextManager.resetContext())}),this.contextManager.on("keyboardasyncload",function(l){var a,s;i.config.hostDevice.touchable&&(!((a=i.osk)===null||a===void 0)&&a.activationModel)&&(i.osk.activationModel.enabled=!0),(s=i.osk)===null||s===void 0||s.startHide(!1)})}return c.prototype.init=function(e){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,n,r,i=this;return(0,d.__generator)(this,function(o){return t=this.config,t.deferForInitialization.isResolved?[2,Promise.resolve()]:(t.initialize(e),String.kmwEnableSupplementaryPlane(!0),n=new rc(this.interface,t.applyCacheBusting),this.keyboardRequisitioner=new Hn(n,new sc,this.config.paths),this.modelCache=new kn,r=this.keyboardRequisitioner.cache,this.contextManager.configure({resetContext:function(l){i.osk?i.osk.batchLayoutAfter(function(){i.core.resetContext(l)}):i.core.resetContext(l)},predictionContext:new Mn(this.core.languageProcessor,this.core.keyboardProcessor),keyboardCache:this.keyboardRequisitioner.cache}),this.config.on("spacebartext",function(){var l;(l=i.osk)===null||l===void 0||l.refreshLayout()}),r.on("stubadded",function(l){var a=function(){i.legacyAPIEvents.callEvent("keyboardregistered",{internalName:l.KI,language:l.KL,keyboardName:l.KN,languageCode:l.KLC,package:l.KP}),i.config.activateFirstKeyboard&&i.keyboardRequisitioner.cache.defaultStub==l&&i.contextManager.activateKeyboard(l.id,l.langId,!0)};i.config.deferForInitialization.isResolved?a():i.config.deferForInitialization.then(a)}),r.on("keyboardadded",function(l){var a=function(){i.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:l.id})};i.config.deferForInitialization.isResolved?a():i.config.deferForInitialization.then(a)}),this.keyboardRequisitioner.cache.on("keyboardadded",function(l){i.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:l.id})}),[2])})})},Object.defineProperty(c.prototype,"build",{get:function(){return Number.parseInt(St.VERSION_PATCH,10)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"version",{get:function(){return St.VERSION_RELEASE},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"hardKeyboard",{get:function(){return this._hardKeyboard},set:function(e){this._hardKeyboard&&this._hardKeyboard.off("keyevent",this.keyEventListener),this._hardKeyboard=e,e.on("keyevent",this.keyEventListener)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"osk",{get:function(){return this._osk},set:function(e){var t;this._osk&&(this._osk.off("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=this.osk.layerChangeHandler),this._osk=e,this.core.keyboardProcessor.contextDevice=(t=e.targetDevice)!==null&&t!==void 0?t:this.config.softDevice,e&&(this.contextManager.activeKeyboard&&(e.activeKeyboard=this.contextManager.activeKeyboard),e.on("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=e.layerChangeHandler)},enumerable:!1,configurable:!0}),c.prototype.getDebugInfo=function(){var e,t,n,r,i,o,l,a,s,B,g,u,F,y,I=(e=this.contextManager)===null||e===void 0?void 0:e.activeKeyboard,Q={configReport:(t=this.config)===null||t===void 0?void 0:t.debugReport(),keyboard:{id:xt((r=(n=I==null?void 0:I.metadata)===null||n===void 0?void 0:n.id)!==null&&r!==void 0?r:""),langId:((i=I==null?void 0:I.metadata)===null||i===void 0?void 0:i.langId)||"",version:(l=(o=I==null?void 0:I.keyboard)===null||o===void 0?void 0:o.version)!==null&&l!==void 0?l:""},model:{id:((s=(a=this.core)===null||a===void 0?void 0:a.activeModel)===null||s===void 0?void 0:s.id)||""},osk:{banner:(u=(g=(B=this.osk)===null||B===void 0?void 0:B.banner)===null||g===void 0?void 0:g.banner.type)!==null&&u!==void 0?u:"",layer:((y=(F=this.osk)===null||F===void 0?void 0:F.vkbd)===null||y===void 0?void 0:y.layerId)||""}};return Q},c.prototype.refreshModel=function(){var e=this.contextManager.activeKeyboard,t=this.modelCache.modelForLanguage(e==null?void 0:e.metadata.langId);return this.core.activeModel!=t&&(this.core.activeModel&&this.core.languageProcessor.unloadModel(),t)?this.core.languageProcessor.loadModel(t).then(function(){return t}):Promise.resolve(t)},c.prototype.addEventListener=function(e,t){this.legacyAPIEvents.addEventListener(e,t)},c.prototype.removeEventListener=function(e,t){this.legacyAPIEvents.removeEventListener(e,t)},c.prototype.shutdown=function(){var e;this.legacyAPIEvents.shutdown(),(e=this.osk)===null||e===void 0||e.shutdown()},c.prototype.addModel=function(e){var t;this.modelCache.register(e);var n=(t=this.contextManager.activeKeyboard)===null||t===void 0?void 0:t.metadata;return n&&e.languages.indexOf(n.langId)!=-1?this.refreshModel().then(function(){}):Promise.resolve()},c.prototype.removeModel=function(e){this.modelCache.unregister(e),this.core.activeModel&&this.core.activeModel.id==e&&this.core.languageProcessor.unloadModel()},c.prototype.setActiveKeyboard=function(e,t){return(0,d.__awaiter)(this,void 0,void 0,function(){return(0,d.__generator)(this,function(n){return[2,this.contextManager.activateKeyboard(e,t,!0)]})})},c.prototype.getActiveKeyboard=function(){var e,t;return(t=(e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata.id)!==null&&t!==void 0?t:""},c.prototype.getActiveLanguage=function(e){var t,n,r,i=(t=this.contextManager.activeKeyboard)===null||t===void 0?void 0:t.metadata;return e?(r=i==null?void 0:i.langName)!==null&&r!==void 0?r:"":(n=i==null?void 0:i.langId)!==null&&n!==void 0?n:""},c.prototype.isChiral=function(e){var t;if(e){if(typeof e=="string"){var n=this.keyboardRequisitioner.cache.getKeyboard(e);if(n)e=n;else throw new Error("Keyboard '".concat(e,"' has not been loaded."))}t=e}else t=this.core.activeKeyboard;return t.isChiral},c.prototype.resetContext=function(){this.contextManager.resetContext()},c.prototype.setNumericLayer=function(){this.core.keyboardProcessor.setNumericLayer(this.config.softDevice)},c}(),Dn=Oo;var It=function(){function c(e){var t=N("div");t.id=c.BANNER_ID,t.className=c.BANNER_CLASS,this.div=t,this.height=e,this.update()}return Object.defineProperty(c.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e>0?e:0,this.update()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e,this.update()},enumerable:!1,configurable:!0}),c.prototype.update=function(){var e=this.div.style,t=e.height,n=e.display;return this._height>0?(e.height=this._height+"px",e.display="block"):(e.height="0px",e.display="none"),t!==e.height||n!==e.display},c.prototype.appendStyleSheet=function(){},c.prototype.getDiv=function(){return this.div},c.prototype.configureForKeyboard=function(e,t){},c.prototype.shutdown=function(){},c.DEFAULT_HEIGHT=37,c.BANNER_CLASS="kmw-banner-bar",c.BANNER_ID="kmw-banner-bar",c}();var Z=function(){function c(e){var t=typeof e=="string"?c.parseLengthStyle(e):e;this.val=t.val,this.absolute=t.absolute,t.special&&(this.special=t.special)}return Object.defineProperty(c.prototype,"styleString",{get:function(){return this.absolute?this.val+"px":this.special?this.val+this.special:this.val*100+"%"},enumerable:!1,configurable:!0}),c.prototype.scaledBy=function(e){return new c({val:e*this.val,absolute:this.absolute})},c.inPixels=function(e){return new c({val:e,absolute:!0})},c.inPercent=function(e){return new c({val:e/100,absolute:!1})},c.forScalar=function(e){return new c({val:e,absolute:!1})},c.special=function(e,t){return new c({val:e,absolute:!1,special:t})},c.parseLengthStyle=function(e){if(e=="")return Bc;var t=parseFloat(e);return isNaN(t)?(console.error("Could not properly parse specified length style info: '"+e+"'."),Bc):e.indexOf("px")!=-1?{val:t,absolute:!0}:e.indexOf("pt")!=-1?{val:4*t/3,absolute:!0}:e.indexOf("%")!=-1?{val:t/100,absolute:!1}:e.indexOf("rem")!=-1?{val:t,absolute:!1,special:"rem"}:e.indexOf("em")!=-1?{val:t,absolute:!1,special:"em"}:{val:4*t/3,absolute:!0}},c}();var Bc=new Z("1em");var jt=function(c){(0,d.__extends)(e,c);function e(){var t=c.call(this,0)||this;return t.type="blank",t}return e}(It);var dc=function(){function c(){this._activeBannerHeight=It.DEFAULT_HEIGHT,this.events=new v.default,this.constructContainer()}return c.prototype.constructContainer=function(){var e=N("div");return e.id="keymanweb_banner_container",e.className="kmw-banner-container",this.bannerContainer=e},Object.defineProperty(c.prototype,"element",{get:function(){return this.bannerContainer},enumerable:!1,configurable:!0}),c.prototype.appendStyles=function(){this.currentBanner&&this.currentBanner.appendStyleSheet()},Object.defineProperty(c.prototype,"banner",{get:function(){return this.currentBanner},set:function(e){if(this.currentBanner){if(e==this.currentBanner)return;var t=this.currentBanner;this.currentBanner=e,this.bannerContainer.replaceChild(e.getDiv(),t.getDiv()),t.shutdown()}else this.currentBanner=e,e&&this.bannerContainer.appendChild(e.getDiv());e instanceof jt||(e.height=this.activeBannerHeight),this.events.emit("bannerchange")},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"height",{get:function(){return this.currentBanner?this.currentBanner.height:0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"activeBannerHeight",{get:function(){return this._activeBannerHeight},set:function(e){this._activeBannerHeight=e,this.currentBanner&&!(this.currentBanner instanceof jt)&&(this.currentBanner.height=e)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"layoutHeight",{get:function(){return Z.inPixels(this.height)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"width",{get:function(){var e;return(e=this.currentBanner)===null||e===void 0?void 0:e.width},set:function(e){this.currentBanner&&(this.currentBanner.width=e)},enumerable:!1,configurable:!0}),c.prototype.refreshLayout=function(){var e,t;(t=(e=this.currentBanner).refreshLayout)===null||t===void 0||t.call(e)},c}();var gc=function(c){(0,d.__extends)(e,c);function e(t,n){var r=this;t.length>0?(r=c.call(this)||this,n&&(r.height=n)):r=c.call(this,0)||this,r.type="image",t.indexOf("base64")>=0?console.log("Loading img from base64 data"):console.log("Loading img with src '"+t+"'"),r.img=document.createElement("img"),r.img.setAttribute("src",t);var i=r.img.style;return i.width="100%",i.height="100%",r.getDiv().appendChild(r.img),console.log("Image loaded."),r}return e.prototype.setImagePath=function(t){this.img&&this.img.setAttribute("src",t)},e}(It);function Gt(c,e){e instanceof Error?console.error("".concat(c,": ").concat(e.message,"\n\n").concat(e.stack)):(console.error(c),console.error(e))}var uc=function(){function c(e){this.queue=[],this.defaultWaitFactory=e||function(){return gt(0)}}return Object.defineProperty(c.prototype,"defaultWait",{get:function(){return this.defaultWaitFactory()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"ready",{get:function(){return this.queue.length==0&&!this.waitLock},enumerable:!1,configurable:!0}),c.prototype.triggerNextClosure=function(){return(0,d.__awaiter)(this,void 0,void 0,function(){var e,t,n;return(0,d.__generator)(this,function(r){switch(r.label){case 0:if(this.queue.length==0)return[2];e=this.queue.shift(),this.waitLock=Promise.resolve();try{t=e()}catch(i){Gt("Error from queued closure",i)}t=t!=null?t:this.defaultWaitFactory(),this.waitLock=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t];case 2:return r.sent(),[3,4];case 3:return n=r.sent(),Gt("Async error from queued closure",n),[3,4];case 4:return this.waitLock=null,this.triggerNextClosure(),[2]}})})},c.prototype.runAsync=function(e){var t=this.ready;this.queue.push(e),t&&this.triggerNextClosure()},c}();function Fc(c){return"targetX"in c&&"targetY"in c&&"t"in c}var At=function(){function c(e){if(this.rawLinearSums={x:0,y:0,t:0},this.coordArcSum=0,this._sampleCount=0,!!e)if(e instanceof c)Object.assign(this,e),this.rawLinearSums=(0,d.__assign)({},e.rawLinearSums);else if(Fc(e))Object.assign(this,this.extend(e));else throw new Error("A constructor for this input pattern has not yet been implemented")}return c.prototype.extend=function(e){return this._extend(new c(this),e)},c.prototype._extend=function(e,t){e._initialSample||(e._initialSample=t,e.baseSample=t);var n=e.baseSample;this.followingSample=t;var r=t.targetX-n.targetX,i=t.targetY-n.targetY,o=t.t-n.t;if(e.rawLinearSums.x+=r,e.rawLinearSums.y+=i,e.rawLinearSums.t+=o,this.lastSample){var l=t.targetX-this.lastSample.targetX,a=t.targetY-this.lastSample.targetY,s=l*l+a*a,B=Math.sqrt(s);e.coordArcSum+=B}return e._lastSample=t,e.sampleCount=this.sampleCount+1,e},c.prototype.deaccumulate=function(e){var t=new c(this);return this._deaccumulate(t,e)},c.prototype._deaccumulate=function(e,t){if(!t)return e;if(!t.followingSample||!t.lastSample)throw"Invalid argument:  stats missing necessary tracking variable.";for(var n in e.rawLinearSums){var r=n;e.rawLinearSums[r]-=t.rawLinearSums[r]}if(t.followingSample&&t.lastSample){var i=t.followingSample.targetX-t.lastSample.targetX,o=t.followingSample.targetY-t.lastSample.targetY,l=i*i+o*o,a=Math.sqrt(l);e.coordArcSum-=a,e.coordArcSum-=t.coordArcSum}return e.sampleCount-=t.sampleCount,e._initialSample=t.followingSample,e},c.prototype.translateCoordSystem=function(e){var t=new c(this);return this._translateCoordSystem(t,e)},c.prototype._translateCoordSystem=function(e,t){if(this.sampleCount==0)return e;var n=e.initialSample==e.lastSample;return e._initialSample=t(e.initialSample),e.baseSample=t(e.baseSample),e._lastSample=n?e._initialSample:t(e.lastSample),e},c.prototype.replaceInitialSample=function(e){var t=new c(this);return this._replaceInitialSample(t,e)},c.prototype._replaceInitialSample=function(e,t){if(this.sampleCount==0)throw new Error("no sample available to replace");var n=e.initialSample;if(e._initialSample=t,this.sampleCount>1){var r=t.targetX-n.targetX,i=t.targetY-n.targetY,o=t.t-n.t;e.rawLinearSums.x+=r,e.rawLinearSums.y+=i,e.rawLinearSums.t+=o;var l=r*r+i*i,a=Math.sqrt(l);e.coordArcSum+=a}else e._lastSample=t;return e},Object.defineProperty(c.prototype,"lastSample",{get:function(){return this._lastSample},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastTimestamp",{get:function(){var e;return(e=this.lastSample)===null||e===void 0?void 0:e.t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"sampleCount",{get:function(){return this._sampleCount},set:function(e){this._sampleCount=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"initialSample",{get:function(){return this._initialSample},enumerable:!1,configurable:!0}),c.prototype.mappingConstant=function(e){if(this.baseSample)return e=="t"?this.baseSample.t:e=="x"?this.baseSample.targetX:e=="y"?this.baseSample.targetY:0},c.prototype.mean=function(e){return this.rawLinearSums[e]/this.sampleCount+this.mappingConstant(e)},Object.defineProperty(c.prototype,"netDistance",{get:function(){if(!this.lastSample||!this.initialSample)return 0;var e=this.lastSample.targetX-this.initialSample.targetX,t=this.lastSample.targetY-this.initialSample.targetY;return Math.sqrt(e*e+t*t)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"duration",{get:function(){return!this.lastSample||!this.initialSample?0:this.lastSample.t-this.initialSample.t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"angle",{get:function(){if(!(this.sampleCount==1||!this.lastSample||!this.initialSample)&&!(this.netDistance<1)){var e=this.lastSample.targetX-this.initialSample.targetX,t=this.lastSample.targetY-this.initialSample.targetY,n=Math.acos(-t/this.netDistance);return e<0?2*Math.PI-n:n}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"angleInDegrees",{get:function(){return this.angle*180/Math.PI},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"cardinalDirection",{get:function(){if(!(this.sampleCount==1||!this.lastSample||!this.initialSample)&&!(isNaN(this.angle)||this.angle===null||this.angle===void 0)){var e=["n","ne","e","se","s","sw","w","nw","n"],t=Math.ceil((this.angleInDegrees-22.5)/45);return e[t]}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"speed",{get:function(){return this.duration?this.netDistance/this.duration:0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"rawDistance",{get:function(){return this.coordArcSum},enumerable:!1,configurable:!0}),c.prototype.toJSON=function(){return{angle:this.angle,cardinal:this.cardinalDirection,netDistance:this.netDistance,duration:this.duration,sampleCount:this.sampleCount,rawDistance:this.rawDistance}},c}();var yc=function(){function c(){}return c.prototype.getBoundingClientRect=function(){return new DOMRect(0,0,Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0))},c}();var Ut=function(){function c(e,t){Array.isArray(e)&&(t=e,e=new yc),this.root=e,t=t||[0,0,0,0],this.updatePadding(t)}return Object.defineProperty(c.prototype,"edgePadding",{get:function(){return this._edgePadding},enumerable:!1,configurable:!0}),c.prototype.updatePadding=function(e){switch(e.length){case 1:var t=e[0];this._edgePadding={x:t,y:t,w:2*t,h:2*t};break;case 2:this._edgePadding={x:e[1],y:e[0],w:2*e[1],h:2*e[0]};break;case 3:this._edgePadding={x:e[1],y:e[0],w:2*e[1],h:e[0]+e[2]};break;case 4:this._edgePadding={x:e[3],y:e[0],w:e[1]+e[3],h:e[0]+e[2]};break;default:throw new Error("Invalid values for PaddedZoneSource's edgePadding - must be between 1 to 4 `number` values.")}},c.prototype.getBoundingClientRect=function(){var e=this.root.getBoundingClientRect();return new DOMRect(e.left+this.edgePadding.x,e.top+this.edgePadding.y,e.width-this.edgePadding.w,e.height-this.edgePadding.h)},c}();function Ee(c){var e,t,n,r,i,o,l,a=(0,d.__assign)({},c);if(a.mouseEventRoot=(e=a.mouseEventRoot)!==null&&e!==void 0?e:a.targetRoot,a.touchEventRoot=(t=a.touchEventRoot)!==null&&t!==void 0?t:a.targetRoot,a.inputStartBounds=(n=a.inputStartBounds)!==null&&n!==void 0?n:a.targetRoot,a.maxRoamingBounds=(r=a.maxRoamingBounds)!==null&&r!==void 0?r:a.targetRoot,a.safeBounds=(i=a.safeBounds)!==null&&i!==void 0?i:new Ut([2]),a.itemIdentifier=(o=a.itemIdentifier)!==null&&o!==void 0?o:function(){return null},a.recordingMode=!!a.recordingMode,a.historyLength=((l=a.historyLength)!==null&&l!==void 0?l:0)>0?a.historyLength:0,c.paddedSafeBounds)delete a.safeBoundPadding;else{var s=c.safeBoundPadding;typeof s=="number"&&(s=[s]),s=s!=null?s:[3],a.paddedSafeBounds=new Ut(a.safeBounds,s)}return a}var Oe=function(c){(0,d.__extends)(e,c);function e(){var t=c.call(this)||this;return t._isComplete=!1,t._stats=new At,t}return Object.defineProperty(e.prototype,"stats",{get:function(){return this._stats},enumerable:!1,configurable:!0}),e.prototype.clone=function(){var t=new e;return t._isComplete=this._isComplete,t._wasCancelled=this._wasCancelled,t._stats=new At(this._stats),t},Object.defineProperty(e.prototype,"isComplete",{get:function(){return this._isComplete},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wasCancelled",{get:function(){return this._wasCancelled},enumerable:!1,configurable:!0}),e.prototype.translateCoordSystem=function(t){this._stats=this._stats.translateCoordSystem(t)},e.prototype.replaceInitialSample=function(t){this._stats=this._stats.replaceInitialSample(t)},e.prototype.extend=function(t){if(this._isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this._stats=this._stats.extend(t),this.emit("step",t)},e.prototype.terminate=function(t){t===void 0&&(t=!1),!this._isComplete&&(this._wasCancelled=t,this._isComplete=!0,t?this.emit("invalidated"):this.emit("complete"),this.removeAllListeners())},e.prototype.toJSON=function(){return{stats:this.stats,wasCancelled:this.wasCancelled}},e}(v.default);var _t=function(c){(0,d.__extends)(e,c);function e(){var t=c!==null&&c.apply(this,arguments)||this;return t.samples=[],t}return e.prototype.clone=function(){var t=new e;return t.samples=[].concat(this.samples),t._isComplete=this._isComplete,t._wasCancelled=this._wasCancelled,t._stats=new At(this._stats),t},e.deserialize=function(t){var n=new e;n.samples=[].concat(t.coords.map(function(i){return(0,d.__assign)({},i)})),n._isComplete=!0,n._wasCancelled=t.wasCancelled;var r=n.samples.reduce(function(i,o){return i.extend(o)},new At);return n._stats=r,n},e.prototype.extend=function(t){if(this.isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this.samples.push(t),c.prototype.extend.call(this,t)},e.prototype.translateCoordSystem=function(t){c.prototype.translateCoordSystem.call(this,t);for(var n=0;n<this.samples.length;n++)this.samples[n]=t(this.samples[n])},Object.defineProperty(e.prototype,"coords",{get:function(){return this.samples},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){for(var t={coords:[].concat(this.samples.map(function(o){return{targetX:o.targetX,targetY:o.targetY,t:o.t,item:o.item}})),wasCancelled:this.wasCancelled,stats:this.stats},n=0,r=t.coords;n<r.length;n++){var i=r[n];delete i.clientX,delete i.clientY,i.item===void 0&&delete i.item}return t},e}(Oe);var mt=function(){function c(e,t,n,r){this.stateToken=null,this.rawIdentifier=e,this.isFromTouch=n,this._path=r?new r:new Oe,this.recognizerConfigStack=Array.isArray(t)?t:[t]}return Object.defineProperty(c.prototype,"path",{get:function(){return this._path},enumerable:!1,configurable:!0}),c.prototype.setGestureMatchInspector=function(e){if(this._matchInspectionClosure)throw new Error("Invalid state:  the match-inspection closure has already been set");this._matchInspectionClosure=e},c.prototype.update=function(e){this.path.extend(e),this._baseItem||(this._baseItem=e.item)},Object.defineProperty(c.prototype,"baseItem",{get:function(){return this._baseItem},set:function(e){this._baseItem=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"currentSample",{get:function(){return this.path.stats.lastSample},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"potentialModelMatchIds",{get:function(){return this._matchInspectionClosure(this)},enumerable:!1,configurable:!0}),c.prototype.constructSubview=function(e,t,n){return new ot(this,this.recognizerConfigStack,e,t,n)},c.prototype.terminate=function(e){this.path.terminate(e)},Object.defineProperty(c.prototype,"isPathComplete",{get:function(){return this.path.isComplete},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"identifier",{get:function(){var e=this.isFromTouch?"touch":"mouse";return"".concat(e,":").concat(this.rawIdentifier)},enumerable:!1,configurable:!0}),c.prototype.pushRecognizerConfig=function(e){var t=(0,d.__assign)((0,d.__assign)({},e),{mouseEventRoot:this.recognizerConfigStack[0].mouseEventRoot,touchEventRoot:this.recognizerConfigStack[0].touchEventRoot});this.recognizerConfigStack.push(Ee(t))},c.prototype.popRecognizerConfig=function(){if(this.recognizerConfigStack.length==1)throw new Error("Cannot 'pop' the original recognizer-configuration for this GestureSource.");return this.recognizerConfigStack.pop()},Object.defineProperty(c.prototype,"currentRecognizerConfig",{get:function(){return this.recognizerConfigStack[this.recognizerConfigStack.length-1]},enumerable:!1,configurable:!0}),c.prototype.toJSON=function(){var e={identifier:this.identifier,isFromTouch:this.isFromTouch,path:this.path.toJSON(),stateToken:this.stateToken};return e},c}();var ot=function(c){(0,d.__extends)(e,c);function e(t,n,r,i,o){var l=this,a=0,s=t.path.stats.sampleCount;t instanceof e&&(a=t._baseStartIndex),l=c.call(this,t.rawIdentifier,n,t.isFromTouch,Object.getPrototypeOf(t.path).constructor)||this;var B=l._baseSource=t instanceof e?t._baseSource:t;l.stateToken=o!=null?o:t.stateToken;var g=function(Q){var U=l.recognizerTranslation,h=(0,d.__assign)((0,d.__assign)({},Q),{targetX:Q.targetX-U.x,targetY:Q.targetY-U.y});return l.stateToken&&(h.stateToken=l.stateToken),(l.stateToken!=B.stateToken||l.stateToken!=t.stateToken)&&(h.item=l.currentRecognizerConfig.itemIdentifier(h,null)),h},u=t.path.stats.lastSample;r?(l._baseStartIndex=a=Math.max(a+s-1,0),s=s>0?1:0):l._baseStartIndex=a,r?t.path.stats.sampleCount&&l._path.extend(t.path.stats.lastSample):l._path=t.path.clone(),l._path.translateCoordSystem(g),i?l._baseItem=t.baseItem:l._baseItem=u==null?void 0:u.item;var F=function(){return l.path.terminate(!1)},y=function(){return l.path.terminate(!0)},I=function(Q){c.prototype.update.call(l,g(Q))};return B.path.on("complete",F),B.path.on("invalidated",y),B.path.on("step",I),l.subviewDisconnector=function(){B.path.off("complete",F),B.path.off("invalidated",y),B.path.off("step",I)},B.isPathComplete&&(l.path.terminate(B.path.wasCancelled),l.disconnect()),l}return Object.defineProperty(e.prototype,"recognizerTranslation",{get:function(){if(this.recognizerConfigStack.length==1||!this.currentRecognizerConfig)return{x:0,y:0};var t=this.currentRecognizerConfig,n=t.targetRoot.getBoundingClientRect(),r=this.recognizerConfigStack[0].targetRoot.getBoundingClientRect();return{x:n.left-r.left,y:n.top-r.top}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"baseSource",{get:function(){return this._baseSource},enumerable:!1,configurable:!0}),e.prototype.disconnect=function(){this.subviewDisconnector&&(this.subviewDisconnector(),this.subviewDisconnector=null)},e.prototype.pushRecognizerConfig=function(t){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")},e.prototype.popRecognizerConfig=function(){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")},e.prototype.update=function(t){throw new Error("Updates should be provided through the base GestureSource.")},e.prototype.terminate=function(t){this.baseSource.terminate(t)},e}(mt);var Qc=function(c){(0,d.__extends)(e,c);function e(t,n,r){var i=c.call(this,t,n,r,_t)||this;return i.stateToken=null,i}return e.prototype.initPath=function(){return new _t},e.deserialize=function(t,n){var r=n!==void 0?n:this._jsonIdSeed++,i=t.isFromTouch,o=_t.deserialize(t.path),l=new e(r,null,i);return l._path=o,l},e}(mt);var Ic=function(c){(0,d.__extends)(e,c);function e(t){var n,r=c.call(this)||this;return r._activeTouchpoints=[],r.identifierMap={},r.config=t,r.sourceConstructor=!((n=t==null?void 0:t.recordingMode)!==null&&n!==void 0)||n?Qc:mt,r}return e.prototype.createTouchpoint=function(t,n){var r=e.IDENTIFIER_SEED++;this.identifierMap[t]=r;var i=new this.sourceConstructor(r,this.config,n);return i.stateToken=this.stateToken,i},e.prototype.fulfillInputStart=function(t){},e.prototype.maintainTouchpoints=function(t){t||(t=[]),this._activeTouchpoints.filter(function(n){return!t.includes(n)}).forEach(function(n){return n.terminate(!0)})},e.prototype.hasActiveTouchpoint=function(t){return this.identifierMap[t]!==void 0},e.prototype.getTouchpointWithId=function(t){var n=this.identifierMap[t];return this._activeTouchpoints.find(function(r){return r.rawIdentifier==n})},e.prototype.getConfigForId=function(t){return this.getTouchpointWithId(t).currentRecognizerConfig},e.prototype.getStateTokenForId=function(t){var n;return(n=this.getTouchpointWithId(t).stateToken)!==null&&n!==void 0?n:null},e.prototype.dropTouchpoint=function(t){var n=t.rawIdentifier;this._activeTouchpoints=this._activeTouchpoints.filter(function(a){return t!=a});for(var r=0,i=Object.keys(this.identifierMap);r<i.length;r++){var o=i[r],l=Number.parseInt(o,10);this.identifierMap[l]==n&&delete this.identifierMap[l]}},e.prototype.addTouchpoint=function(t){this._activeTouchpoints.push(t)},Object.defineProperty(e.prototype,"activeSources",{get:function(){return[].concat(this._activeTouchpoints)},enumerable:!1,configurable:!0}),e.IDENTIFIER_SEED=0,e}(v.default);function Pn(c,e,t){var n=c.targetRoot.getBoundingClientRect();return{clientX:e,clientY:t,targetX:e-n.left,targetY:t-n.top}}var Ye=function(c){(0,d.__extends)(e,c);function e(){return c!==null&&c.apply(this,arguments)||this}return e.prototype.buildSampleFor=function(t,n,r,i,o){var l,a,s=(0,d.__assign)((0,d.__assign)({},Pn(this.config,t,n)),{t:i,stateToken:(l=o==null?void 0:o.stateToken)!==null&&l!==void 0?l:this.stateToken}),B=(a=o==null?void 0:o.currentRecognizerConfig.itemIdentifier)!==null&&a!==void 0?a:this.config.itemIdentifier,g=B(s,r);return s.item=g,s},e.prototype.onInputStart=function(t,n,r,i){var o=this,l=this.createTouchpoint(t,i);l.update(n),this.addTouchpoint(l),l.path.on("invalidated",function(){o.dropTouchpoint(l)}),l.path.on("complete",function(){o.dropTouchpoint(l)});try{this.emit("pointstart",l)}catch(a){Gt("Engine-internal error while initializing gesture matching for new source",a)}return l},e.prototype.onInputMove=function(t,n,r){if(t)try{t.update(n)}catch(i){Gt("Error occurred while updating source",i)}},e.prototype.onInputMoveCancel=function(t,n,r){if(t)try{t.update(n),t.path.terminate(!0)}catch(i){Gt("Error occurred while cancelling further input for source",i)}},e.prototype.onInputEnd=function(t,n){if(t)try{t.path.terminate(!1)}catch(r){Gt("Error occurred while finalizing input for source",r)}},e}(Ic);var Ht=function(){function c(){}return c.getCoordZoneBitmask=function(e,t){var n=t.getBoundingClientRect(),r=0;return r|=e.clientX<n.left?c.FAR_LEFT:0,r|=e.clientX>n.right?c.FAR_RIGHT:0,r|=e.clientY<n.top?c.FAR_TOP:0,r|=e.clientY>n.bottom?c.FAR_BOTTOM:0,r},c.inputStartOutOfBoundsCheck=function(e,t){return!!this.getCoordZoneBitmask(e,t.inputStartBounds)},c.inputStartSafeBoundProximityCheck=function(e,t){return this.getCoordZoneBitmask(e,t.paddedSafeBounds)},c.inputMoveCancellationCheck=function(e,t,n){if(n=n||0,this.getCoordZoneBitmask(e,t.maxRoamingBounds))return!0;var r=this.getCoordZoneBitmask(e,t.safeBounds);return!!(r&~n)},c.FAR_TOP=8,c.FAR_LEFT=4,c.FAR_BOTTOM=2,c.FAR_RIGHT=1,c}();var Uc=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this,t)||this;return n.hasActiveClick=!1,n.disabledSafeBounds=0,n.currentSource=null,n.activeIdentifier=0,n._mouseStart=function(r){return n.onMouseStart(r)},n._mouseMove=function(r){return n.onMouseMove(r)},n._mouseEnd=function(r){return n.onMouseEnd(r)},n}return Object.defineProperty(e.prototype,"eventRoot",{get:function(){return this.config.mouseEventRoot},enumerable:!1,configurable:!0}),e.prototype.registerEventHandlers=function(){this.eventRoot.addEventListener("mousedown",this._mouseStart,!0),this.eventRoot.addEventListener("mousemove",this._mouseMove,!1),this.eventRoot.addEventListener("mouseup",this._mouseEnd,!0)},e.prototype.unregisterEventHandlers=function(){this.eventRoot.removeEventListener("mousedown",this._mouseStart,!0),this.eventRoot.removeEventListener("mousemove",this._mouseMove,!1),this.eventRoot.removeEventListener("mouseup",this._mouseEnd,!0)},e.prototype.preventPropagation=function(t){t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,typeof t.stopImmediatePropagation=="function"?t.stopImmediatePropagation():typeof t.stopPropagation=="function"&&t.stopPropagation()},e.prototype.buildSampleFromEvent=function(t){return this.buildSampleFor(t.clientX,t.clientY,t.target,performance.now(),this.currentSource)},e.prototype.onMouseStart=function(t){var n=this;if(this.config.targetRoot.contains(t.target)){this.preventPropagation(t);var r=this.buildSampleFromEvent(t);Ht.inputStartOutOfBoundsCheck(r,this.config)||(this.disabledSafeBounds=Ht.inputStartSafeBoundProximityCheck(r,this.config));var i=this.onInputStart(this.activeIdentifier,r,t.target,!1);this.currentSource=i;var o=function(){n.currentSource=null};i.path.on("complete",o),i.path.on("invalidated",o)}},e.prototype.onMouseMove=function(t){var n=this.currentSource;if(n){var r=this.buildSampleFromEvent(t);if(!t.buttons){this.hasActiveClick&&(this.hasActiveClick=!1,this.onInputMoveCancel(n,r,t.target));return}this.preventPropagation(t);var i=n.currentRecognizerConfig;Ht.inputMoveCancellationCheck(r,i,this.disabledSafeBounds)?this.onInputMoveCancel(n,r,t.target):this.onInputMove(n,r,t.target)}},e.prototype.onMouseEnd=function(t){var n=this.currentSource;n&&(t.buttons||(this.hasActiveClick=!1),this.onInputEnd(n,t.target))},e}(Ye);function hc(c){for(var e=[],t=0;t<c.length;t++)e.push(c.item(t));return e}var bc=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this,t)||this;return n.eventDispatcher=new uc,n.safeBoundMaskMap={},n.pendingSourcePromises=new Map,n.inputStartSignalMap=new Map,n._touchStart=function(r){return n.onTouchStart(r)},n._touchMove=function(r){return n.onTouchMove(r)},n._touchEnd=function(r){return n.onTouchEnd(r)},n}return Object.defineProperty(e.prototype,"eventRoot",{get:function(){return this.config.touchEventRoot},enumerable:!1,configurable:!0}),e.prototype.registerEventHandlers=function(){this.eventRoot.addEventListener("touchstart",this._touchStart,{capture:!0,passive:!1}),this.eventRoot.addEventListener("touchmove",this._touchMove,{capture:!1,passive:!1}),this.eventRoot.addEventListener("touchend",this._touchEnd,{capture:!0,passive:!1})},e.prototype.unregisterEventHandlers=function(){this.eventRoot.removeEventListener("touchstart",this._touchStart,!0),this.eventRoot.removeEventListener("touchmove",this._touchMove,!1),this.eventRoot.removeEventListener("touchend",this._touchEnd,!0)},e.prototype.preventPropagation=function(t){t.cancelable&&t.preventDefault(),typeof t.stopImmediatePropagation=="function"?t.stopImmediatePropagation():typeof t.stopPropagation=="function"&&t.stopPropagation()},e.prototype.dropTouchpoint=function(t){c.prototype.dropTouchpoint.call(this,t);for(var n=0,r=Object.keys(this.safeBoundMaskMap);n<r.length;n++){var i=r[n],o=Number.parseInt(i,10);this.getTouchpointWithId(o)==t&&delete this.safeBoundMaskMap[o]}},e.prototype.fulfillInputStart=function(t){var n=this.inputStartSignalMap.get(t);n&&(this.inputStartSignalMap.delete(t),n.resolve())},e.prototype.hasActiveTouchpoint=function(t){var n=c.prototype.hasActiveTouchpoint.call(this,t);return n||!!this.pendingSourcePromises.has(t)},e.prototype.buildSampleFromTouch=function(t,n,r){return this.buildSampleFor(t.clientX,t.clientY,t.target,n,r)},e.prototype.onTouchStart=function(t){var n=this;if(this.config.targetRoot.contains(t.target)){this.preventPropagation(t);var r=hc(t.touches),i=hc(t.changedTouches),o=r.filter(function(u){return i.findIndex(function(F){return u.identifier==F.identifier})==-1}),l=o.map(function(u){return n.pendingSourcePromises.get(u.identifier)});this.eventDispatcher.runAsync(function(){return(0,d.__awaiter)(n,void 0,void 0,function(){var u;return(0,d.__generator)(this,function(F){switch(F.label){case 0:return[4,Promise.all(l)];case 1:return u=F.sent(),this.maintainTouchpoints(u),[2,this.eventDispatcher.defaultWait]}})})});for(var a=new Map,s=0;s<t.changedTouches.length;s++){var B=t.changedTouches.item(s),g=new L;this.pendingSourcePromises.set(B.identifier,g),a.set(B.identifier,g)}this.eventDispatcher.runAsync(function(){for(var u=performance.now(),F=null,y=function(U){var h=t.changedTouches.item(U),b=h.identifier,p=n.buildSampleFromTouch(h,u,null);if(!Ht.inputStartOutOfBoundsCheck(p,n.config))n.safeBoundMaskMap[b]=Ht.inputStartSafeBoundProximityCheck(p,n.config);else{var X=a.get(b);return X.resolve(null),"continue"}F=n.onInputStart(b,p,t.target,!0);var x=a.get(b);x.resolve(F);var m=function(){n.pendingSourcePromises.get(b)==x&&n.pendingSourcePromises.delete(b)};F.path.on("complete",m),F.path.on("invalidated",m)},I=0;I<t.changedTouches.length;I++)y(I);if(F){var Q=new L;return n.inputStartSignalMap.set(F,Q),Q.corePromise}else return Promise.resolve()})}},e.prototype.onTouchMove=function(t){for(var n=this,r,i=0;i<t.touches.length;i++){var o=t.touches.item(i);if(this.hasActiveTouchpoint(o.identifier)){this.preventPropagation(t);break}}for(var l=new Map,i=0;i<t.touches.length;i++){var a=t.touches.item(i).identifier;l.set(a,(r=this.pendingSourcePromises.get(a))===null||r===void 0?void 0:r.corePromise)}this.eventDispatcher.runAsync(function(){return(0,d.__awaiter)(n,void 0,void 0,function(){var s;return(0,d.__generator)(this,function(B){switch(B.label){case 0:return[4,Promise.all(l.values())];case 1:return s=B.sent(),this.maintainTouchpoints(s),[2,this.eventDispatcher.defaultWait]}})})}),this.eventDispatcher.runAsync(function(){return(0,d.__awaiter)(n,void 0,void 0,function(){var s,B,g,u,F,y,I;return(0,d.__generator)(this,function(Q){switch(Q.label){case 0:s=performance.now(),B=0,Q.label=1;case 1:return B<t.touches.length?(g=t.touches.item(B),u=g.identifier,[4,l.get(u)]):[3,4];case 2:if(F=Q.sent(),!F||F.isPathComplete)return[3,3];y=F.currentRecognizerConfig,I=this.buildSampleFromTouch(g,s,F),Ht.inputMoveCancellationCheck(I,y,this.safeBoundMaskMap[u])?this.onInputMoveCancel(F,I,g.target):this.onInputMove(F,I,g.target),Q.label=3;case 3:return B++,[3,1];case 4:return[2,this.eventDispatcher.defaultWait]}})})})},e.prototype.onTouchEnd=function(t){for(var n=this,r,i=0;i<t.changedTouches.length;i++){var o=t.changedTouches.item(i);if(this.hasActiveTouchpoint(o.identifier)){this.preventPropagation(t);break}}for(var l=new Map,i=0;i<t.changedTouches.length;i++){var a=t.changedTouches.item(i).identifier,s=(r=this.pendingSourcePromises.get(a))===null||r===void 0?void 0:r.corePromise;l.set(a,s)}this.eventDispatcher.runAsync(function(){return(0,d.__awaiter)(n,void 0,void 0,function(){var B,g,u;return(0,d.__generator)(this,function(F){switch(F.label){case 0:B=0,F.label=1;case 1:return B<t.changedTouches.length?(g=t.changedTouches.item(B),[4,l.get(g.identifier)]):[3,4];case 2:if(u=F.sent(),!u||u.isPathComplete)return[3,3];this.onInputEnd(u,t.target),F.label=3;case 3:return B++,[3,1];case 4:return[2,this.eventDispatcher.defaultWait]}})})})},e}(Ye);var Cc=function(){function c(e,t,n){var r=this;if(!e||!t)throw new Error("A gesture-path source and contact-path model must be specified.");if(this.model=e,this.publishedPromise=new L,this.source=t,this.inheritedStats=n,this.lastStats=null,e.timer){var i=e.timer.inheritElapsed?Math.min(t.path.stats.duration,e.timer.duration):0;this.timerPromise=new ae(e.timer.duration-i),this.publishedPromise.then(function(){r.timerPromise.resolve(!1)}),this.timerPromise.then(function(o){var l=t instanceof ot?t.baseSource:t,a=performance.now();!l.isPathComplete&&l.currentSample.t!=a&&l.path.extend((0,d.__assign)((0,d.__assign)({},l.currentSample),{t:a})),o!=e.timer.expectedResult&&r.finalize(!1,"timer"),r.finalize(!0,"timer")})}}return Object.defineProperty(c.prototype,"promise",{get:function(){return this.publishedPromise.corePromise},enumerable:!1,configurable:!0}),c.prototype.finalize=function(e,t){if(this.publishedPromise.isFulfilled)return this._result;var n=this.model;n.validateItem&&e&&(e=n.validateItem(this.source.path.stats.lastSample.item,this.baseItem));var r;return e?r={type:n.pathResolutionAction,cause:t}:r={type:"reject",cause:t},this.publishedPromise.resolve(r),this._result=r,r},Object.defineProperty(c.prototype,"stats",{get:function(){return this.source.path.stats},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"baseItem",{get:function(){return this.source.baseItem},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastItem",{get:function(){return this.source.currentSample.item},enumerable:!1,configurable:!0}),c.prototype.update=function(){var e=this.model,t=this.source;if(t.path.wasCancelled)return this.finalize(!1,"path");if(e.itemChangeAction&&t.path.stats.sampleCount>0&&t.currentSample.item!=t.baseItem){var n=e.itemChangeAction=="resolve";return this.finalize(n,"item")}else{var n=e.pathModel.evaluate(t.path,this.lastStats,t.baseItem,this.inheritedStats)||"continue";return this.lastStats=t.path.stats,n!="continue"?this.finalize(n=="resolve","path"):t.path.isComplete?this.finalize(!1,"path"):{type:"continue"}}},c}();var Kn=function(){function c(e,t){var n=this,r;if(this._isCancelled=!1,!e||!t)throw new Error("Construction of GestureMatcher requires a gesture-model spec and a source for related contact points.");if(!e.sustainTimer&&!t)throw new Error("If the provided gesture-model spec lacks a sustain timer, there must be an active contact point.");var i=t instanceof mt?null:t,o=i?null:t;this.predecessor=i,this.publishedPromise=new L,this.model=e,e.sustainTimer&&(this.sustainTimerPromise=new ae(e.sustainTimer.duration),this.sustainTimerPromise.then(function(I){var Q=e.sustainTimer.expectedResult==I;n.finalize(Q,"timer")})),this.pathMatchers=[];var l=o?[o]:i.sources,a=l.map(function(I){return o&&I==o?o:I.isPathComplete?null:I}).reduce(function(I,Q){return Q?I.concat(Q):I},[]);if(e.sustainTimer&&a.length>0){this.finalize(!1,"path");return}else!e.sustainTimer&&a.length==0&&this.finalize(!1,"path");for(var s=0;s<a.length;s++){var B=a[s];B instanceof ot&&B.disconnect();var g=e.contacts[s];if(!g)throw new Error('No contact model for inherited path: gesture "'.concat(e.id,"', entry ").concat(s));var u=(r=g==null?void 0:g.model.pathInheritance)!==null&&r!==void 0?r:"chop",F=!1,y=void 0;switch(u){case"reject":this.finalize(!1,"path");return;case"full":y=B.constructSubview(!1,!0),this.addContactInternal(y,B.path.stats,!0);continue;case"partial":F=!0;case"chop":y=B.constructSubview(!0,F),this.addContactInternal(y,B.path.stats,!0);break}}}return Object.defineProperty(c.prototype,"sources",{get:function(){var e=this;return this.pathMatchers.map(function(t,n){if(!e.model.contacts[n].resetOnInstantFulfill)return t.source}).filter(function(t){return!!t})},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"promise",{get:function(){return this.publishedPromise.corePromise},enumerable:!1,configurable:!0}),c.prototype.cancel=function(){this._isCancelled=!0,this._result||this.finalize(!1,"cancelled")},Object.defineProperty(c.prototype,"isCancelled",{get:function(){return this._isCancelled},enumerable:!1,configurable:!0}),c.prototype.finalize=function(e,t){var n,r;if(this.publishedPromise.isFulfilled)return this._result;try{var i=void 0;e?i=this.model.resolutionAction:(t!="cancelled"&&(!((n=this.model.rejectionActions)===null||n===void 0)&&n[t])&&(i=this.model.rejectionActions[t],i.item="none"),i=i||{type:"none",item:"none"});var o=void 0,l=(r=i.item)!==null&&r!==void 0?r:"current";switch(l){case"none":o=null;break;case"base":o=this.primaryPath.baseItem;break;case"current":o=this.primaryPath.currentSample.item;break}var a={matched:e,action:(0,d.__assign)((0,d.__assign)({},i),{item:o})};return this.publishedPromise.resolve(a),this._result=a,a}catch(s){return this.publishedPromise.reject(s),{matched:!1,action:{type:"none",item:null}}}},c.prototype.finalizeSources=function(){if(!this._result)throw Error("Invalid state for source-finalization - the matcher's evaluation of the gesture model is not yet complete");for(var e=this._result.matched,t=0;t<this.pathMatchers.length;t++){var n=this.pathMatchers[t],r=this.model.contacts[t];n.source.isPathComplete||(e&&r.endOnResolve||!e&&r.endOnReject)&&n.source.terminate(!1)}},Object.defineProperty(c.prototype,"primaryPath",{get:function(){for(var e,t=Number.NEGATIVE_INFINITY,n=0,r=this.pathMatchers;n<r.length;n++){var i=r[n];i.model.itemPriority>t&&(t=i.model.itemPriority,e=i)}return!e&&this.predecessor?this.predecessor.primaryPath:e==null?void 0:e.source},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"baseItem",{get:function(){return this.primaryPath.baseItem},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"currentItem",{get:function(){return this.primaryPath.currentSample.item},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"allSourceIds",{get:function(){var e=this.sources.map(function(n){return n.identifier}),t=this.predecessor?this.predecessor.allSourceIds:[];return e=e.filter(function(n){return t.indexOf(n)==-1}),e.concat(t)},enumerable:!1,configurable:!0}),c.prototype.mayAddContact=function(){return this.pathMatchers.length<this.model.contacts.length},c.prototype.addContact=function(e){var t=this.pathMatchers.length;if(!this.mayAddContact())throw new Error("The specified gesture model does not support more than ".concat(t," contact points."));this.addContactInternal(e.constructSubview(!1,!0),null)},Object.defineProperty(c.prototype,"result",{get:function(){return this._result},enumerable:!1,configurable:!0}),c.prototype.addContactInternal=function(e,t,n){var r=this,i,o=this.pathMatchers.length,l=this.model.contacts[o],a=new Cc(l.model,e,new At(t));this.pathMatchers.push(a);var s=null,B=null;if(!o&&this.predecessor&&this.model.sustainTimer){s=this.predecessor.primaryPath;var g=(i=this.model.sustainTimer.baseItem)!==null&&i!==void 0?i:"result",u=void 0;switch(g){case"none":B=null;break;case"base":B=this.predecessor.primaryPath.baseItem,u=this.predecessor.primaryPath.stateToken;break;case"result":B=this.predecessor.result.action.item,u=this.predecessor.primaryPath.currentSample.stateToken;break}e.baseItem=B!=null?B:e.baseItem,e.stateToken=u,e.currentSample.stateToken=u,e.currentRecognizerConfig&&(e.currentSample.item=e.currentRecognizerConfig.itemIdentifier(e.currentSample,null))}else B=this.primaryPath.baseItem,s=this.primaryPath;if(l.model.baseCoordReplacer){var F=e.path.stats,y=l.model.baseCoordReplacer(F,B);if(y){var I=(0,d.__assign)((0,d.__assign)({},Pn(e.currentRecognizerConfig,y.clientX,y.clientY)),{t:y.t||y.t===0?y.t:F.initialSample.t,item:B,stateToken:e.stateToken});e.path.replaceInitialSample(I)}}if(l.model.allowsInitialState){var Q=l.model.allowsInitialState(e.currentSample,s.currentSample,B,s.stateToken);if(!Q){this.pathMatchers.pop(),this.finalize(!1,"cancelled");return}}var U=a.update();if((U==null?void 0:U.type)=="reject"){this.finalize(!1,n?"cancelled":"path");return}a.promise.then(function(h){r.finalize(h.type=="resolve",h.cause)})},c.prototype.update=function(){var e=this;this.pathMatchers.forEach(function(t){try{t.update()}catch(n){console.error(n),e.finalize(!1,"cancelled")}})},c}();var we=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this)||this;return n._sourceSelector=[],n.potentialMatchers=[],n.sustainMode=!1,n.attemptSynchronousUpdate=function(){var r=n._sourceSelector.filter(function(l){return!l.source.isPathComplete}),i=r.map(function(l){return l.source.currentSample.t}),o=i[0];i.find(function(l){return o!=l})||n.potentialMatchers.forEach(function(l){return l.update()})},n.baseGestureSetId=t||"default",n}return e.prototype.potentialMatchersForSource=function(t){return this.potentialMatchers.filter(function(n){return n.allSourceIds.find(function(r){return r==t.identifier})})},e.prototype.cascadeTermination=function(){var t=this,n=this.potentialMatchers,r=n.filter(function(a){return!a.model.sustainWhenNested}),i=n.filter(function(a){return a.model.sustainWhenNested});this.potentialMatchers=i;var o=i.map(function(a){return a.allSourceIds}).reduce(function(a,s){for(var B=0,g=s;B<g.length;B++){var u=g[B];a.indexOf(u)==-1&&a.push(u)}return a},[]),l=this._sourceSelector.filter(function(a){return!o.find(function(s){return s==a.source.identifier})});return l.forEach(function(a){a.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}});var s=t._sourceSelector.indexOf(a);s>-1&&t._sourceSelector.splice(s,1)}),r.forEach(function(a){return a.cancel()}),this.sustainMode=!0,this._sourceSelector.map(function(a){return a.source})},e.prototype.matchGesture=function(t,n){return(0,d.__awaiter)(this,void 0,void 0,function(){var r,i,o,l,a,s,B,g,u,F,y,I,Q,U,h,b,p,X,x,m,J=this;return(0,d.__generator)(this,function(V){switch(V.label){case 0:return r=t instanceof mt,i=function(G){var S=G.sources.map(function(T){return T.baseSource});return S&&S.length>0?S:G.predecessor?i(G.predecessor):[]},o=r?[t instanceof ot?t.baseSource:t]:i(t),l=r?t:null,a=r?null:t,this.pendingMatchSetup?(s=this.pendingMatchSetup,B=new L,this.pendingMatchSetup=B.corePromise,[4,s]):[3,2];case 1:V.sent(),this.pendingMatchSetup==B.corePromise&&(this.pendingMatchSetup=null),B.resolve(),V.label=2;case 2:return r&&l.path.on("invalidated",function(){J.dropSourcesWithIds([l.identifier])}),g=new L,u=o.map(function(G){var S={source:G,matchPromise:g,preserve:!0};return J._sourceSelector.push(S),S}),F=u.map(function(G){return G.matchPromise}),r?(y=this.potentialMatchers.filter(function(G){return G.mayAddContact()}),y.forEach(function(G){G.addContact(l),G.promise.then(J.matcherSelectionFilter(G,F))}),y.length>0?(I=this.stateToken,Q=new L,this.pendingMatchSetup=Q.corePromise,[4,gt(0)]):[3,5]):[3,5];case 3:return V.sent(),[4,gt(0)];case 4:if(V.sent(),this.pendingMatchSetup==Q.corePromise&&(this.pendingMatchSetup=null),Q.resolve(),U=this.stateToken,I!=U&&(h=l.currentSample,l.stateToken=U,h.stateToken=U,h.item=t.currentRecognizerConfig.itemIdentifier(h,null),l.baseItem=h.item),b=y.find(function(G){return G.result}),b&&b.allSourceIds.includes(t.identifier))return g.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),[2,{selectionPromise:g.corePromise}];V.label=5;case 5:if(u.forEach(function(G){G.preserve=!1}),this.sustainMode&&l)return g.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),[2,{selectionPromise:g.corePromise,sustainModeWithoutMatch:!0}];for(p=n.map(function(G){try{return new Kn(G,l||a)}catch(S){return console.error(S),null}}).filter(function(G){return!!G}),p=p.filter(function(G){return!G.result||G.result.matched!==!1}),X=0,x=p;X<x.length;X++)m=x[X],m.promise.then(this.matcherSelectionFilter(m,F));return p.length>0?this.potentialMatchers=this.potentialMatchers.concat(p):g.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),this.potentialMatchers.sort(function(G,S){return S.model.resolutionPriority-G.model.resolutionPriority}),this.resetSourceHooks(),[2,{selectionPromise:g.corePromise}]}})})},e.prototype.resetSourceHooks=function(){var t=this,n=function(r){var i=r;i.path.off("step",t.attemptSynchronousUpdate),i.path.off("complete",t.attemptSynchronousUpdate),i.path.off("invalidated",t.attemptSynchronousUpdate),i.path.on("step",t.attemptSynchronousUpdate),i.path.on("complete",t.attemptSynchronousUpdate),i.path.on("invalidated",t.attemptSynchronousUpdate)};this._sourceSelector.forEach(function(r){return n(r.source)})},e.prototype.dropSourcesWithIds=function(t){for(var n=function(a){var s=r._sourceSelector.findIndex(function(g){return g.source.identifier==a});if(s>-1){var B=r._sourceSelector.splice(s,1)[0];B.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"none",item:null}}})}},r=this,i=0,o=t;i<o.length;i++){var l=o[i];n(l)}},e.prototype.matchersForSource=function(t){return this.potentialMatchers.filter(function(n){return!!n.sources.find(function(r){return r.identifier==t.identifier})})},e.prototype.matcherSelectionFilter=function(t,n){var r=this;return function(i){return(0,d.__awaiter)(r,void 0,void 0,function(){var o,l,a,s,B,g,u,F,y,I=this;return(0,d.__generator)(this,function(Q){if(t.isCancelled?i={matched:!1,action:{type:"none",item:null}}:t.finalizeSources(),o=t.allSourceIds,l=o.map(function(U){return I._sourceSelector.find(function(h){return h.source.identifier==U})}).filter(function(U){return!!U}),a=this.potentialMatchers.indexOf(t),a==-1)return[2];if(this.potentialMatchers.splice(a,1),i.action.type=="none")return this.finalizeMatcherlessTrackers(l),[2];if(i.matched)for(B=function(U){var h=g.matchersForSource(U.source);g.potentialMatchers=g.potentialMatchers.filter(function(b){return!h.find(function(p){return b==p})}),h.forEach(function(b){b.cancel()}),g._sourceSelector=g._sourceSelector.filter(function(b){return!l.find(function(p){return b==p})}),U.matchPromise.resolve({matcher:t,result:i})},g=this,u=0,F=l;u<F.length;u++)y=F[u],B(y);else return s=function(U){if(I.sustainMode&&!U.sustainWhenNested){I.finalizeMatcherlessTrackers(l);return}var h=new Kn(U,t);if(h.result&&h.result.matched==!1){I.finalizeMatcherlessTrackers(l);return}h.promise.then(I.matcherSelectionFilter(h,l.map(function(b){return b.matchPromise}))),I.potentialMatchers.push(h),I.resetSourceHooks()},this.emit("rejectionwithaction",{matcher:t,result:i},s),[2];return[2]})})}},e.prototype.finalizeMatcherlessTrackers=function(t){for(var n=this,r=t.map(function(a){return{tracker:a,pendingCount:n.potentialMatchers.filter(function(s){return!!s.allSourceIds.find(function(B){return a.source.identifier==B})}).length}}),i=0,o=r;i<o.length;i++){var l=o[i];l.pendingCount==0&&!l.tracker.preserve&&l.tracker.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}})}},e}(v.default);function qt(c,e){var t=c.gestures.find(function(n){return n.id==e});if(!t)throw new Error("Could not find spec for gesture with id '".concat(e,"'"));return t}function pc(c,e){var t=c.sets[e];if(!t)throw new Error("Could not find a defined gesture-set with id '".concat(e,"'"));var n=c.gestures.filter(function(i){return!!t.find(function(o){return i.id==o})}),r=t.filter(function(i){return!n.find(function(o){return o.id==i})});if(r.length>0)throw new Error("Set '".concat(e,"' cannot find definitions for gestures with ids ").concat(r));return n}var Gc={gestures:[],sets:{default:[]}};var Yo=function(){function c(e,t){var n,r,i=e.matcher,o=e.result;this.gestureSetId=t,this.matchedId=i==null?void 0:i.model.id,this.linkType=o.action.type,this.item=o.action.item,this.sources=i==null?void 0:i.sources,(n=this.sources)===null||n===void 0||n.forEach(function(l){return l.disconnect()}),(r=this.sources)===null||r===void 0||r.sort(function(l,a){return(i==null?void 0:i.primaryPath)==l?-1:(i==null?void 0:i.primaryPath)==a?1:0}),this.allSourceIds=(i==null?void 0:i.allSourceIds)||[]}return c}();var mc=function(c){(0,d.__extends)(e,c);function e(t,n,r,i){var o=c.call(this)||this;return o.markedComplete=!1,o.selectionHandler=function(l){return(0,d.__awaiter)(o,void 0,void 0,function(){var a,s,B,g,u,F,y,I,Q,U,h,b,p,X=this,x,m,J,V,G,S,T,H,E,W;return(0,d.__generator)(this,function(R){switch(R.label){case 0:return a=((x=this.pushedSelector)===null||x===void 0?void 0:x.baseGestureSetId)||((m=this.selector)===null||m===void 0?void 0:m.baseGestureSetId),s=new Yo(l,a),l.matcher&&this.stageReports.push(s),B=(J=l.matcher)!==null&&J!==void 0?J:this.stageReports[this.stageReports.length-1],g=(V=B==null?void 0:B.sources.map(function(A){return A instanceof ot?A.baseSource:A}))!==null&&V!==void 0?V:[],u=l.result.action.type,(u=="complete"||u=="none")&&(g.forEach(function(A){A.isPathComplete||A.terminate(u=="none")}),!l.result.matched)?(this.markedComplete||(this.markedComplete=!0,this.emit("complete")),[2]):u=="complete"&&this.touchpointCoordinator&&this.pushedSelector?(F=(G=this.touchpointCoordinator)===null||G===void 0?void 0:G.sustainSelectorSubstack(this.pushedSelector),y=F.map(function(A){var k=new L;return A.path.on("invalidated",function(){return k.resolve()}),A.path.on("complete",function(){return k.resolve()}),k.corePromise}),y.length>0&&l.result.action.awaitNested?[4,Promise.all(y)]:[3,3]):[3,4];case 1:return R.sent(),[4,gt(0)];case 2:R.sent(),R.label=3;case 3:(S=this.touchpointCoordinator)===null||S===void 0||S.popSelector(this.pushedSelector),this.pushedSelector=null,R.label=4;case 4:return this.emit("stage",s,function(A){A.type=="pop"?g.forEach(function(k){return k.popRecognizerConfig()}):g.forEach(function(k){return k.pushRecognizerConfig(A.config)})}),I=!1,this.touchpointCoordinator&&(I=!this.touchpointCoordinator.selectorStackIncludes(this.selector)),Q=wo(l.result.action,this.gestureConfig,this.baseGestureSetId),I&&(Q=Q.filter(function(A){return A.sustainWhenNested})),Q.length>0?(u=="chain"&&l.result.action.selectionMode==((T=this.pushedSelector)===null||T===void 0?void 0:T.baseGestureSetId)||(this.pushedSelector&&(this.pushedSelector.off("rejectionwithaction",this.modelResetHandler),(H=this.touchpointCoordinator)===null||H===void 0||H.popSelector(this.pushedSelector),this.pushedSelector=null),u=="chain"&&(U=l.result.action.selectionMode,U&&(h=new we(U),h.on("rejectionwithaction",this.modelResetHandler),this.pushedSelector=h,(E=this.touchpointCoordinator)===null||E===void 0||E.pushSelector(h)))),b=(W=this.pushedSelector)!==null&&W!==void 0?W:this.selector,p=b.matchGesture(l.matcher,Q),p.then(function(A){return(0,d.__awaiter)(X,void 0,void 0,function(){var k;return(0,d.__generator)(this,function(at){switch(at.label){case 0:return k=this.selectionHandler,[4,A.selectionPromise];case 1:return[2,k.apply(this,[at.sent()])]}})})})):this.markedComplete||(this.markedComplete=!0,this.emit("complete")),[2]}})})},o.modelResetHandler=function(l,a){var s=l.matcher.allSourceIds;if(!o.allSourceIds.find(function(B){return s.indexOf(B)==-1}))if(l.result.action.type=="replace")a(qt(o.gestureConfig,l.result.action.replace));else throw new Error("Missed a case in implementation!")},o.stageReports=[],o.selector=r,o.selector.on("rejectionwithaction",o.modelResetHandler),o.once("complete",function(){var l;o.pushedSelector&&((l=o.touchpointCoordinator)===null||l===void 0||l.popSelector(o.pushedSelector),o.pushedSelector=null),o.selector.off("rejectionwithaction",o.modelResetHandler),o.selector.dropSourcesWithIds(o.allSourceIds),o.selector=null}),o.gestureConfig=n,o.touchpointCoordinator=i,Promise.resolve().then(function(){return o.selectionHandler(t)}),o}return Object.defineProperty(e.prototype,"allSourceIds",{get:function(){var t,n;return(n=(t=this.stageReports[this.stageReports.length-1])===null||t===void 0?void 0:t.allSourceIds)!==null&&n!==void 0?n:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"baseGestureSetId",{get:function(){var t,n;return(n=(t=this.selector)===null||t===void 0?void 0:t.baseGestureSetId)!==null&&n!==void 0?n:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"potentialModelMatchIds",{get:function(){if(!this.selector)return[];var t=[this.selector];this.pushedSelector&&t.push(this.pushedSelector);var n=this.stageReports[this.stageReports.length-1],r=n.sources,i=r.map(function(o){return t.map(function(l){return l.potentialMatchersForSource(o).map(function(a){return a.model.id})})}).reduce(function(o,l){return o.concat(l)}).reduce(function(o,l){for(var a=0,s=l;a<s.length;a++){var B=s[a];o.indexOf(B)==-1&&o.push(B)}return o},[]);return i},enumerable:!1,configurable:!0}),e.prototype.cancel=function(){var t=this.stageReports[this.stageReports.length-1].sources;t.forEach(function(n){return n.baseSource.isPathComplete||n.baseSource.terminate(!0)}),this.markedComplete||(this.markedComplete=!0,this.emit("complete"))},e.prototype.toJSON=function(){return this.stageReports},e}(v.default);function wo(c,e,t){switch(c.type){case"none":case"complete":return[];case"replace":return[qt(e,c.replace)];case"chain":return[qt(e,c.next)];default:throw new Error("Unexpected case arose within `processGestureAction` method")}}var xc=function(c){(0,d.__extends)(e,c);function e(t,n,r){var i=c.call(this)||this;if(i.selectorStack=[new we],i._activeSources=[],i._activeGestures=[],i._history=[],i.modelResetHandler=function(s,B){var g=s.matcher.allSourceIds;if(!i.activeGestures.find(function(u){return u.allSourceIds.find(function(F){return g.indexOf(F)!=-1})}))if(s.result.action.type=="replace")B(qt(i.gestureModelDefinitions,s.result.action.replace));else throw new Error("Missed a case in implementation!")},i.onNewTrackedPath=function(s){return(0,d.__awaiter)(i,void 0,void 0,function(){var B,g,u,F,y,I,Q,U,h,b,p,X,x,m,J=this;return(0,d.__generator)(this,function(V){switch(V.label){case 0:this.addSimpleSourceHooks(s),B=this.gestureModelDefinitions,V.label=1;case 1:return g=this.currentSelector,F=g.matchGesture(s,pc(B,g.baseGestureSetId)),[4,F];case 2:return y=V.sent(),y.sustainModeWithoutMatch?(I=function(G){G.stateToken=J.stateToken,G.item=s.currentRecognizerConfig.itemIdentifier(G,null)},s.path instanceof _t&&s.path.coords.forEach(I),s.stateToken=this.stateToken,s.baseItem=s.path.stats.initialSample.item,I(s.path.stats.initialSample),I(s.path.stats.lastSample),[3,3]):(u=y.selectionPromise,[3,4]);case 3:if(g!=this.currentSelector)return[3,1];V.label=4;case 4:Q=this.currentSelector,s.setGestureMatchInspector(this.buildGestureMatchInspector(Q)),U=function(){J.recordHistory(s)};try{s.path.on("invalidated",U),this.emit("inputstart",s)}catch(G){Gt("Error from 'inputstart' event listener",G)}return this.inputEngines.forEach(function(G){G.fulfillInputStart(s)}),[4,u];case 5:if(h=V.sent(),!h||h.result.matched==!1)return[2];for(b=h.matcher.allSourceIds,p=0,X=this._activeGestures;p<X.length;p++)if(x=X[p],x.allSourceIds.find(function(G){return!!b.find(function(S){return G==S})}))return[2];return m=new mc(h,B,this.currentSelector,this),this._activeGestures.push(m),m.on("complete",function(){var G=J._activeGestures.indexOf(m);G!=-1&&J._activeGestures.splice(G,1)}),s.path.wasCancelled||(s.path.off("invalidated",U),m.on("complete",function(){return J.recordHistory(m)})),this.emit("recognizedgesture",m),[2]}})})},i.historyMax=r>0?r:0,i.gestureModelDefinitions=t,i.inputEngines=[],n)for(var o=0,l=n;o<l.length;o++){var a=l[o];i.addEngine(a)}return i.selectorStack[0].on("rejectionwithaction",i.modelResetHandler),i}return e.prototype.pushSelector=function(t){this.selectorStack.push(t),t.on("rejectionwithaction",this.modelResetHandler)},e.prototype.sustainSelectorSubstack=function(t){if(!t)return[];var n=this.selectorStack.indexOf(t);if(n==-1)return[];if(this.selectorStack.length<=1)throw new Error("May not force the original, base gesture selector into sustain mode.");for(var r=[],i=n;i<this.selectorStack.length;i++)t=this.selectorStack[i],r=r.concat(t.cascadeTermination());return r},e.prototype.popSelector=function(t){if(t){var n=this.selectorStack.indexOf(t);if(n!=-1){if(this.selectorStack.length<=1)throw new Error("May not pop the original, base gesture selector.");for(;n<this.selectorStack.length;)t=this.selectorStack[n],t.off("rejectionwithaction",this.modelResetHandler),this.selectorStack.splice(n,1);this.currentSelector.stateToken=this.stateToken}}},e.prototype.selectorStackIncludes=function(t){return this.selectorStack.includes(t)},Object.defineProperty(e.prototype,"currentSelector",{get:function(){return this.selectorStack[this.selectorStack.length-1]},enumerable:!1,configurable:!0}),e.prototype.buildGestureMatchInspector=function(t){var n=this;return function(r){var i=n.selectorStack.indexOf(t),o=n.selectorStack.slice(i);return o.map(function(l){return l.potentialMatchersForSource(r).map(function(a){return a.model.id})}).reduce(function(l,a){return l.concat(a)})}},e.prototype.addEngine=function(t){t.on("pointstart",this.onNewTrackedPath),this.inputEngines.push(t)},e.prototype.recordHistory=function(t){var n=this.historyMax;n>0&&(this._history.length==n&&this._history.shift(),this._history.push(t))},Object.defineProperty(e.prototype,"activeGestures",{get:function(){return[].concat(this._activeGestures)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeSources",{get:function(){return[].concat(this.inputEngines.map(function(t){return t.activeSources}).reduce(function(t,n){return t.concat(n)},[]))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"history",{get:function(){return this._history},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"historyJSON",{get:function(){var t=function(n,r){return n=="item"?r==null?void 0:r.id:r};return JSON.stringify(this.history,t,2)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stateToken",{get:function(){return this._stateToken},set:function(t){this._stateToken=t,this.inputEngines.forEach(function(n){return n.stateToken=t}),this.currentSelector.stateToken=t},enumerable:!1,configurable:!0}),e.prototype.addSimpleSourceHooks=function(t){var n=this;t.path.on("invalidated",function(){var r=n.activeGestures.find(function(o){return o.allSourceIds.includes(t.identifier)});r&&r.cancel();var i=n._activeSources.indexOf(t);n._activeSources=n._activeSources.splice(i,1)}),t.path.on("complete",function(){var r=n._activeSources.indexOf(t);n._activeSources=n._activeSources.splice(r,1)})},e}(v.default);var Qe=function(c){(0,d.__extends)(e,c);function e(t,n){var r=this,i=Ee(n);return t=t||Gc,r=c.call(this,t,null,i.historyLength)||this,r.config=i,r.mouseEngine=new Uc(r.config),r.touchEngine=new bc(r.config),r.mouseEngine.registerEventHandlers(),r.touchEngine.registerEventHandlers(),r.addEngine(r.mouseEngine),r.addEngine(r.touchEngine),r}return e.prototype.destroy=function(){this.activeGestures.forEach(function(t){return t.cancel()}),this.activeSources.forEach(function(t){return t.terminate(!0)}),this.mouseEngine.unregisterEventHandlers(),this.touchEngine.unregisterEventHandlers(),this.mouseEngine=null,this.touchEngine=null},e}(xc);var jn=["n","ne","e","se","s","sw","w","nw"],Xc=Math.PI,_n=function(){for(var c=new Map,e=Xc/4,t=0;t<jn.length;t++)c.set(jn[t],[e*t,1]);return c}();function ze(c){return Math.PI/4*jn.indexOf(c)}function Ie(c,e){var t=ze(e),n=c.initialSample,r=c.lastSample.targetX-n.targetX,i=c.lastSample.targetY-n.targetY,o=Math.max(0,-i*Math.cos(t)),l=Math.max(0,r*Math.sin(t));return l+o}function zo(c,e,t,n){return function(r){var i=ze(e),o=n.flick.triggerDist-n.flick.dirLockDist,l=Math.max(0,Ie(c.path.stats,e)-n.flick.dirLockDist),a=.7,s=Math.min(1,a*l/o),B=Math.sin(i)*s,g=-Math.cos(i)*s;t==null||t.scrollFlickPreview(B,g)}}var Me=Math.PI/3,Mo=function(){function c(e,t,n,r,i,o){var l=this;this.directlyEmitsKeys=!0,this.sequence=e,this.gestureParams=i,this.baseSpec=r.key.spec,this.baseKeyDistances=n.getSimpleTapCorrectionDistances(e.stageReports[0].sources[0].path.stats.initialSample,this.baseSpec);var a=e.stageReports[0].sources[0].baseSource,s=a;e.on("complete",function(){o==null||o.cancel()}),this.sequence.on("stage",function(g){var u,F=s.path.stats;l.computedFlickDistribution=l.flickDistribution(F,!0);var y=l.computedFlickDistribution[0].keySpec;if(g.matchedId=="flick-restart"){s.path.replaceInitialSample(g.sources[0].path.stats.initialSample);return}if(g.matchedId=="flick-reset-centering"){s=a.constructSubview(!0,!0);return}else if(g.matchedId=="flick-reset-end"){l.emitKey(n,l.baseSpec,s.path.stats);return}else if(g.matchedId=="flick-reset"){l.flickScroller&&(l.flickScroller(s.currentSample),s.path.off("step",l.flickScroller)),l.lockedDir=null,l.lockedSelectable=null,s instanceof ot&&s.disconnect();return}else if(g.matchedId=="flick-mid"){if(y==l.baseSpec)return;var I=Object.keys(l.baseSpec.flick).find(function(U){return l.baseSpec.flick[U]==y});l.lockedDir=I,l.lockedSelectable=y,l.flickScroller&&s.path.off("step",l.flickScroller),l.flickScroller=zo(s,I,o,l.gestureParams),l.flickScroller(s.currentSample),s.path.on("step",l.flickScroller);return}var Q=(u=l.lockedSelectable)!==null&&u!==void 0?u:y;l.emitKey(n,Q,F)});var B=this.buildPopupRecognitionConfig(n);t({type:"push",config:B})}return c.prototype.emitKey=function(e,t,n){var r,i=Ie(n,this.lockedDir);i>this.gestureParams.flick.triggerDist?r=e.keyEventFromSpec(t):r=e.keyEventFromSpec(this.baseSpec),r.keyDistribution=this.currentStageKeyDistribution(this.baseKeyDistances),e.raiseKeyEvent(r,null)},c.prototype.buildPopupRecognitionConfig=function(e){var t={getBoundingClientRect:function(){var n=Number.MAX_SAFE_INTEGER;return new DOMRect(-n,-n,2*n,2*n)}};return(0,d.__assign)((0,d.__assign)({},e.gestureEngine.config),{maxRoamingBounds:t,safeBounds:t})},c.prototype.cancel=function(){},c.prototype.flickDistribution=function(e,t){var n=this.baseSpec.flick,r=[{spec:this.baseSpec,coord:[NaN,0]}];r=r.concat(Object.keys(n).map(function(u){return{spec:n[u],coord:_n.get(u)}}));var i=e.angle,o=this.gestureParams.flick.triggerDist,l=Math.min(o,t?o:e.netDistance),a=l/o,s=0,B=r.map(function(u){var F=0,y=u.coord;if(!isNaN(y[0])){var I=i-y[0],Q=2*Xc+y[0]-i;F=Math.min(I*I,Q*Q)}var U=Me*(y[1]-a),h=U*U,b=1/(F+h+1e-6);return s+=b,{keySpec:u.spec,p:b}}),g=1/s;return B.forEach(function(u){return u.p*=g}),B.sort(function(u,F){return F.p-u.p})},c.prototype.currentStageKeyDistribution=function(e){var t=this.baseSpec,n=this.baseKeyDistances,r=this.computedFlickDistribution,i=n.get(t);if(!i){var o=r[0];return[{keySpec:o.keySpec,p:1}]}var l=r.findIndex(function(B){return B.keySpec==t}),a=r.splice(l,1)[0].p,s=Rt(n);return r.concat(s.map(function(B){return{keySpec:B.keySpec,p:B.p*a}}))},c}(),Vc=Mo;var qn={longpress:{permitsFlick:function(){return!0},flickDistStart:8,flickDistFinal:40,waitLength:500,noiseTolerance:10},multitap:{waitLength:300,holdLength:150},flick:{startDist:10,dirLockDist:25,triggerDist:40}};function Zc(c){var e=c.getBoundingClientRect();return{clientX:e.left+e.width/2,clientY:e.top+e.height/2}}function vc(c){var e=Zc(c);return function(t){var n=t.lastSample.clientX-e.clientX,r=t.lastSample.clientY-e.clientY;return Math.sqrt(n*n+r*r)}}function Ue(c){var e,t,n=c.key.spec;if(n.sk)return!1;var r=["K_SHIFT","K_ALT","K_CTRL","K_NUMERALS","K_SYMBOLS","K_CURRENCIES"];try{for(var i=(0,d.__values)(r),o=i.next();!o.done;o=i.next()){var l=o.value;if(n.id==l)return!0}}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}if(n.nextlayer)switch(n.sp){case 1:case 2:case 3:case 4:return!0;default:return!1}else return!1}function $n(c,e){var t=function(u,F){if(!u)return!1;var y=u.key.spec;switch(F){case"modipress-start":return Ue(u);case"special-key-start":return["K_LOPT","K_ROPT","K_BKSP"].indexOf(y.baseKeyID)!=-1;case"longpress":return!0;case"multitap-start":case"modipress-multitap-start":return c.hasMultitaps?!!y.multitap:!1;case"flick-start":return!!y.flick;default:return!0}},n=e.roamingEnabled||(e.roamingEnabled=!c.hasFlicks),r=q(n?dl(e):Rc(e)),i=q(n?er(e):Ac(e)),o=q(Sc(e,!0,n));function l(u,F){u=q(u);var y=u.id;return typeof F=="number"&&(F=[F]),u.contacts.forEach(function(I,Q){var U;if(F.indexOf(Q)!=-1){var h=(U=I.model.allowsInitialState)!==null&&U!==void 0?U:function(){return!0};I.model=(0,d.__assign)((0,d.__assign)({},I.model),{allowsInitialState:function(b,p,X){return t(X,y)&&h(b,p,X)}})}}),u}var a=$o(),s=ul(),B=[l(o,0),l(sl(e),0),Bl(e),r,i,l(a,0),tl(e),gl(),l(s,0),Fl(e),Ql(),yl(),l(Il(e),0),Ul(e),hl()],g=[o.id,r.id,s.id,a.id];return n?(B.push(l(el(e),0)),B.push(nl())):(B.push(l(Lc(e),0)),B.push(cl(e)),B.push(il(e)),B.push(ol(e)),B.push(rl(e)),B.push(ll()),B.push(al(e)),g.push("flick-start")),{gestures:B,sets:{default:g,modipress:g.filter(function(u){return u!=s.id}),none:[]}}}function tr(){return{itemPriority:0,pathResolutionAction:"reject",pathModel:{evaluate:function(c){return"resolve"}}}}function Zt(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:function(c){return"resolve"}}}}function Do(c){var e=c.flick;return{itemPriority:1,pathModel:{evaluate:function(t,n,r){var i=t.stats,o=r==null?void 0:r.key.spec;if(o&&o.sk){var l=o.flick,a=l.nw||l.n||l.ne;if(!a){var s=i.netDistance,B=i.angle,g=s*Math.cos(B);if(g>c.longpress.flickDistStart)return"reject"}}return i.netDistance>e.startDist?"resolve":null}},pathResolutionAction:"resolve",pathInheritance:"partial"}}function fc(c,e){var t,n,r=e.key.spec.flick,i=Object.keys(r),o,l=0;try{for(var a=(0,d.__values)(i),s=a.next();!s.done;s=a.next()){var B=s.value,g=Ie(c,B);g>l&&(l=g,o=B)}}catch(u){t={error:u}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return{dir:o,dist:l}}function Po(c){return{itemPriority:1,pathModel:{evaluate:function(e,t,n){var r=fc(e.stats,n),i=r.dir,o=r.dist;if(o>c.flick.dirLockDist){var l=e.stats.angle,a=ze(i),s=Math.abs(l-a),B=Math.abs(2*Math.PI+a-l);if(s<=Me||B<=Me)return"resolve"}else if(e.isComplete)return"reject"}},pathResolutionAction:"resolve",pathInheritance:"full"}}function Ko(c){return{itemPriority:1,pathModel:{evaluate:function(e,t,n,r){if(e.isComplete)return"resolve";var i=fc(r,n).dir;if(Ie(e.stats,i)<c.flick.dirLockDist)return"reject"}},pathResolutionAction:"resolve",pathInheritance:"full"}}function jo(c,e,t){var n=c.longpress;return{itemPriority:0,pathResolutionAction:"resolve",timer:{duration:n.waitLength,expectedResult:!0},validateItem:function(r,i){return!!(i!=null&&i.key.spec.sk)},pathModel:{evaluate:function(r){var i,o,l=r.stats;if(e&&n.permitsFlick(l.lastSample.item)&&((o=((i=l.cardinalDirection)===null||i===void 0?void 0:i.indexOf("n"))!=-1)!==null&&o!==void 0&&o)){var a=l.netDistance,s=l.angle,B=a*Math.cos(s);if(B>n.flickDistFinal)return"resolve"}else if(t){if(l.rawDistance>n.noiseTolerance||l.lastSample.item!=l.initialSample.item)return"reject"}else if(l.lastSample.item!=l.initialSample.item)return"reject";return r.isComplete?"reject":null}}}}function Jc(){return{itemPriority:-1,pathResolutionAction:"resolve",pathModel:{evaluate:function(c){return"resolve"}}}}function _o(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:function(c){if(c.isComplete)return"reject"}}}}function Wc(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:function(c){if(c.isComplete)return"resolve"}}}}function De(c,e){var t,n=(t=c==null?void 0:c.roamingEnabled)!==null&&t!==void 0?t:!0;return{itemPriority:0,itemChangeAction:n?"reject":void 0,pathResolutionAction:"resolve",pathInheritance:!n&&e?"full":"chop",pathModel:{evaluate:function(r){if(r.isComplete&&!r.wasCancelled)return"resolve"}}}}function qo(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:function(c){if(c.isComplete&&!c.wasCancelled)return"resolve"}}}}function $o(){return{id:"special-key-start",resolutionPriority:0,contacts:[{model:(0,d.__assign)({},Zt()),endOnResolve:!1}],resolutionAction:{type:"chain",next:"special-key-end",item:"current"}}}function tl(c){return{id:"special-key-end",resolutionPriority:0,contacts:[{model:(0,d.__assign)((0,d.__assign)({},De(c)),{itemChangeAction:"resolve"}),endOnResolve:!0}],resolutionAction:{type:"complete",item:"none"}}}function Sc(c,e,t){var n={id:"longpress",resolutionPriority:4,contacts:[{model:(0,d.__assign)((0,d.__assign)({},jo(c,e,t)),{itemPriority:1,pathInheritance:"chop"}),endOnResolve:!1},{model:tr(),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"subkey-select",selectionMode:"none",item:"none"}};return t?(0,d.__assign)((0,d.__assign)({},n),{rejectionActions:{path:{type:"replace",replace:"longpress-roam"},timer:{type:"replace",replace:"longpress-roam-restore"}}}):n}function el(c){var e=Sc(c,!1,!0);return(0,d.__assign)((0,d.__assign)({},e),{id:"longpress-roam"})}function nl(){return{id:"longpress-roam-restore",contacts:[{model:{pathModel:{evaluate:function(c){return null}},itemChangeAction:"reject",pathInheritance:"full",pathResolutionAction:"reject",itemPriority:0}}],resolutionPriority:-1,rejectionActions:{item:{type:"replace",replace:"longpress-roam"}},resolutionAction:{type:"chain",next:"longpress-roam"}}}function Lc(c){return{id:"flick-start",resolutionPriority:3,contacts:[{model:Do(c)}],resolutionAction:{type:"chain",item:"none",next:"flick-mid"}}}function rl(c){var e=Lc(c);return(0,d.__assign)((0,d.__assign)({},e),{contacts:[(0,d.__assign)((0,d.__assign)({},e.contacts[0]),{model:(0,d.__assign)((0,d.__assign)({},e.contacts[0].model),{baseCoordReplacer:function(t,n){var r=Zc(n),i=vc(n),o=t.initialSample,l=i(t);if(l>c.flick.triggerDist)return r;var a=c.flick.dirLockDist;if(l<a)return o;var s=a/l,B=o.clientX-r.clientX,g=o.clientY-r.clientY;return{clientX:r.clientX+B*s,clientY:r.clientY+g*s}}})})],id:"flick-restart",sustainWhenNested:!0,rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}}})}function cl(c){return{id:"flick-mid",resolutionPriority:0,contacts:[{model:Po(c),endOnReject:!0},{model:tr(),resetOnInstantFulfill:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}},resolutionAction:{type:"chain",item:"none",next:"flick-end"},sustainWhenNested:!0}}function il(c){return{id:"flick-reset",resolutionPriority:1,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Zt()),{pathInheritance:"partial"})}],resolutionAction:{type:"chain",next:"flick-reset-centering"},sustainWhenNested:!0}}function ol(c){return{id:"flick-reset-centering",resolutionPriority:1,contacts:[{model:{pathModel:{evaluate:function(e,t,n){t||(t=e.stats);var r=vc(n),i=r(e.stats),o=r(t);if(o<i)return"resolve"}},itemPriority:0,pathResolutionAction:"resolve",pathInheritance:"full"}}],resolutionAction:{type:"chain",next:"flick-restart"},sustainWhenNested:!0}}function ll(){return{id:"flick-reset-end",resolutionPriority:1,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"complete",item:"base"},sustainWhenNested:!0}}function al(c){return{id:"flick-end",resolutionPriority:0,contacts:[{model:Ko(c)},{model:Zt(),resetOnInstantFulfill:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset"}},resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}function sl(c){return{id:"multitap-start",resolutionPriority:2,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Zt()),{itemPriority:1,pathInheritance:"reject",allowsInitialState:function(e,t,n){return e.item==n}})}],sustainTimer:{duration:c.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"multitap-end",item:"current"}}}function Bl(c){return{id:"multitap-end",resolutionPriority:2,contacts:[{model:(0,d.__assign)((0,d.__assign)({},De(c)),{itemPriority:1,timer:{duration:c.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Zt(),resetOnInstantFulfill:!0}],rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"none"}}}function Rc(c){return{id:"initial-tap",resolutionPriority:1,contacts:[{model:(0,d.__assign)((0,d.__assign)({},De(c)),{pathInheritance:"chop",itemPriority:1,timer:{duration:c.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Zt(),resetOnInstantFulfill:!0}],sustainWhenNested:!0,rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"base"}}}function Ac(c){return{id:"simple-tap",resolutionPriority:1,contacts:[{model:(0,d.__assign)((0,d.__assign)({},De(c,!0)),{itemPriority:1}),endOnResolve:!0},{model:Zt(),resetOnInstantFulfill:!0}],sustainWhenNested:!0,resolutionAction:{type:"complete",item:"base"}}}function dl(c){var e=Rc(c);return(0,d.__assign)((0,d.__assign)({},e),{rejectionActions:(0,d.__assign)((0,d.__assign)({},e.rejectionActions),{item:{type:"replace",replace:"initial-tap"}})})}function er(c){var e=Ac(c);return(0,d.__assign)((0,d.__assign)({},e),{rejectionActions:(0,d.__assign)((0,d.__assign)({},e.rejectionActions),{item:{type:"replace",replace:"simple-tap"}})})}function gl(){return{id:"subkey-select",resolutionPriority:0,contacts:[{model:(0,d.__assign)((0,d.__assign)({},qo()),{pathInheritance:"full",itemPriority:1}),endOnResolve:!0,endOnReject:!0}],resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}function ul(){return{id:"modipress-start",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Jc()),{allowsInitialState:function(c,e,t){return Ue(t)},itemChangeAction:"reject",itemPriority:1})}],resolutionAction:{type:"chain",next:"modipress-hold",selectionMode:"modipress",item:"current"}}}function Fl(c){return{id:"modipress-hold",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},_o()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:c.multitap.holdLength,expectedResult:!0,inheritElapsed:!0}})},{model:(0,d.__assign)({},Zt()),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"},rejectionActions:{path:{type:"replace",replace:"modipress-end-multitap-transition"}}}}function yl(){return{id:"modipress-end-multitap-transition",resolutionPriority:5,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"}}}function Ql(){return{id:"modipress-end",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Wc()),{itemChangeAction:"reject",pathInheritance:"full"})}],resolutionAction:{type:"complete",item:"none",awaitNested:!0}}}function Il(c){return{id:"modipress-multitap-start",resolutionPriority:6,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Jc()),{pathInheritance:"reject",allowsInitialState:function(e,t,n){return e.item!=n?!1:Ue(n)},itemChangeAction:"reject",itemPriority:1})}],sustainTimer:{duration:c.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"modipress-multitap-end",selectionMode:"modipress",item:"current"}}}function Ul(c){return{id:"modipress-multitap-end",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Wc()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:c.multitap.holdLength,expectedResult:!1}})},{model:(0,d.__assign)({},tr()),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"},rejectionActions:{timer:{type:"replace",replace:"modipress-multitap-lock-transition"},path:{type:"replace",replace:"modipress-multitap-lock-transition"}}}}function hl(){return{id:"modipress-multitap-lock-transition",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Zt()),{pathResolutionAction:"resolve"})}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"}}}var Hc=(0,d.__assign)((0,d.__assign)({},q(er(null))),{resolutionAction:{type:"complete",item:"current"}}),kc={gestures:[Hc],sets:{default:[Hc.id]}};function Pe(c){var e;return typeof c=="string"?e=c:(e=c.style.fontSize,e||(e=getComputedStyle(c).fontSize)),new Z(e)}function Nc(c,e,t){if(c.touchable){var n=c.formFactor=="phone"?1.6*(t?.65:.6)*1.2:2;return Z.special(n,"em")}else return e?Z.inPixels(e/8):void 0}var he;function Ke(c,e,t){t={fontFamily:t.fontFamily,fontSize:t.fontSize},t.fontFamily||(t.fontFamily=getComputedStyle(document.body).fontFamily),(!t.fontSize||t.fontSize=="")&&(t.fontSize="1em");var n=t.fontFamily,r=Pe(t.fontSize),i;r.absolute?i=r.val+"px":i=r.val*e+"px",he=he!=null?he:document.createElement("canvas");var o=he.getContext("2d");o.font=i+" "+n;var l=o.measureText(c);return l}var bl=10,Tc=function(){function c(e,t){this.totalLength=0,this.baseCoord=e,this.curCoord=e,this.baseScrollLeft=t,this.totalLength=0}return c.prototype.updateTo=function(e){var t=this.curCoord;this.curCoord=e;var n=this.baseCoord.targetX-this.curCoord.targetX+this.baseScrollLeft;return this.totalLength+=Math.abs(this.curCoord.targetX-t.targetX),n},Object.defineProperty(c.prototype,"hasScrolled",{get:function(){return this.totalLength>bl},enumerable:!1,configurable:!0}),c}();var Ec="kmw-suggest-touched",Cl="kmw-suggest-banner-scroller",Oc=.666,Yc="swallow-fade-transition",pl=function(){function c(e,t){this.index=e,this.rtl=t!=null?t:!1,this.constructRoot();var n=this.display=N("span");n.className="kmw-suggestion-text",this.container.appendChild(n)}return Object.defineProperty(c.prototype,"computedStyle",{get:function(){return getComputedStyle(this.display)},enumerable:!1,configurable:!0}),c.prototype.constructRoot=function(){var e=this.div=N("div");e.className="kmw-suggest-option",e.id=c.BASE_ID+this.index,this.div.suggestion=this;var t=this.container=document.createElement("div");t.className="kmw-suggestion-container";var n=100-kt.MARGIN*(kt.LONG_SUGGESTION_DISPLAY_LIMIT-1),r=n/kt.LONG_SUGGESTION_DISPLAY_LIMIT;t.style.minWidth=r+"%",e.appendChild(t)},c.prototype.matchKeyboardProperties=function(e){var t=this.div;if(e){e.KLC&&(t.lang=e.KLC);var n=e.KFont;n&&n.family&&n.family!=""&&(t.style.fontFamily=n.family)}},Object.defineProperty(c.prototype,"suggestion",{get:function(){return this._suggestion},enumerable:!1,configurable:!0}),c.prototype.update=function(e,t){this._suggestion=e;var n=this.generateSuggestionText(this.rtl);if(this.container.replaceChild(n,this.display),this.display=n,t.minWidth!==void 0&&(this._minWidth=t.minWidth),this._paddingWidth=t.paddingWidth,this._collapsedWidth=t.collapsedWidth,e&&e.displayAs){var r=Ke(e.displayAs,t.emSize,t.styleForFont);this._textWidth=r.width}else this._textWidth=0;this.currentWidth=this.collapsedWidth,this.updateLayout()},c.prototype.updateLayout=function(){if(!this.suggestion&&this.index!=0){this.div.style.width="0px";return}else this.div.style.width="";var e=this.container.style;e.minWidth=this.collapsedWidth+"px",this.rtl?e.marginRight=this.collapsedWidth-this.expandedWidth+"px":e.marginLeft=this.collapsedWidth-this.expandedWidth+"px",this.updateFade()},c.prototype.updateFade=function(){var e=this;this.div.classList.add(Yc),window.requestAnimationFrame(function(){e.div.classList.remove(Yc)}),this.div.classList.add("kmw-hide-fade-".concat(this.rtl?"left":"right"));var t="kmw-hide-fade-".concat(this.rtl?"right":"left");this.expandedWidth-this.collapsedWidth?this.div.classList.remove(t):this.div.classList.add(t)},Object.defineProperty(c.prototype,"targetCollapsedWidth",{get:function(){return this._collapsedWidth},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"textWidth",{get:function(){return this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"paddingWidth",{get:function(){return this._paddingWidth},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"minWidth",{get:function(){return this._minWidth},set:function(e){this._minWidth=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"expandedWidth",{get:function(){return this.minWidth>this.spanWidth?this.minWidth:this.spanWidth},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"spanWidth",{get:function(){var e,t,n=(e=this.textWidth)!==null&&e!==void 0?e:0;return n&&(n+=(t=this.paddingWidth)!==null&&t!==void 0?t:0),n},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"collapsedWidth",{get:function(){var e=this.spanWidth<this.targetCollapsedWidth?this.spanWidth:this.targetCollapsedWidth,t=e<this.expandedWidth?e:this.expandedWidth;return this.minWidth>t?this.minWidth:t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"currentWidth",{get:function(){return this.div.offsetWidth},set:function(e){e<this.collapsedWidth?e=this.collapsedWidth:e>this.expandedWidth&&(e=this.expandedWidth),this.rtl?this.container.style.marginRight="".concat(e-this.expandedWidth,"px"):this.container.style.marginLeft="".concat(e-this.expandedWidth,"px")},enumerable:!1,configurable:!0}),c.prototype.highlight=function(e){var t=this.div;e?t.classList.add(Ec):t.classList.remove(Ec)},c.prototype.isEmpty=function(){return!this._suggestion},c.prototype.generateSuggestionText=function(e){var t=this._suggestion,n,r=N("span");if(r.className="kmw-suggestion-text",t==null)return r;if(t.displayAs==null||t.displayAs=="")n="\xA0";else{var i=e?8238:8237;n=String.fromCharCode(i)+t.displayAs}return r.innerHTML=n,r},c.BASE_ID="kmw-suggestion-",c}();var kt=function(c){(0,d.__extends)(e,c);function e(t,n){var r=c.call(this,n||It.DEFAULT_HEIGHT)||this;return r.type="suggestion",r.currentSuggestions=[],r.options=[],r.separators=[],r.isRTL=!1,r.onSuggestionUpdate=function(i){var o;r.currentSuggestions=i,(o=r.highlightAnimation)===null||o===void 0||o.cancel();for(var l=r.options[0].computedStyle,a={fontSize:l.fontSize,fontFamily:l.fontFamily},s=getComputedStyle(document.body).fontSize,B=Pe(s).val,g=getComputedStyle(r.options[0].container.firstChild),u=r.width/e.LONG_SUGGESTION_DISPLAY_LIMIT,F=new Z(g.paddingLeft||"4px"),y=new Z(g.paddingRight||"4px"),I={paddingWidth:F.val+y.val,emSize:B,styleForFont:a,collapsedWidth:u,minWidth:0},Q=0;Q<e.SUGGESTION_LIMIT;Q++){var U=r.options[Q];if(i.length>Q){var h=i[Q];U.update(h,I)}else U.update(null,I)}r.refreshLayout()},r.refreshLayout=function(){for(var i=[],o=0,l=Math.min(r.currentSuggestions.length,8),a=0;a<l;a++){var s=r.options[a];s.minWidth=0,o+=s.collapsedWidth,s.collapsedWidth<s.expandedWidth&&i.push(s)}if(l=l||1,o<r.width){for(var B=r.width*.01*(l-1),g=function(){var y=(r.width-o-B)/i.length;i.sort(function(h,b){return h.expandedWidth-b.expandedWidth});var I=i[0],Q=I.expandedWidth-I.collapsedWidth,U=Math.min(Q,y);U>0&&(i.forEach(function(h){return h.minWidth=h.collapsedWidth+U}),o+=U*i.length),i.splice(0,1)};o<r.width&&i.length>0;)g();for(var u=(r.width-o-B)/l,a=0;a<l;a++){var F=r.options[a];F.minWidth=F.collapsedWidth+u,F.updateLayout()}}for(var a=0;a<e.SUGGESTION_LIMIT-1;a++)r.separators[a].style.display=a<l-1?"":"none"},r.getDiv().className=r.getDiv().className+" "+e.BANNER_CLASS,r.container=document.createElement("div"),r.container.className=Cl,r.getDiv().appendChild(r.container),r.buildInternals(!1),r.gestureEngine=r.setupInputHandling(),r}return e.prototype.shutdown=function(){this.gestureEngine.destroy()},e.prototype.buildInternals=function(t){this.isRTL=t,this.options.length>0&&(this.options=[],this.separators=[]);for(var n=0;n<e.SUGGESTION_LIMIT;n++){var r=new pl(n,t);this.options[n]=r}for(var n=0;n<e.SUGGESTION_LIMIT;n++){var i=t?e.SUGGESTION_LIMIT-n-1:n;if(this.container.appendChild(this.options[i].div),t&&(this.container.scrollLeft=this.container.scrollWidth),n!=e.SUGGESTION_LIMIT-1){var o=N("div");o.className="kmw-banner-separator";var l=o.style;l.marginLeft="calc(".concat(e.MARGIN/2,"% - 0.5px)"),l.marginRight="calc(".concat(e.MARGIN/2,"% - 0.5px)"),this.container.appendChild(o),this.separators[i-(t?1:0)]=o}}},e.prototype.setupInputHandling=function(){var t=this,n=new Ut(this.getDiv(),[-Number.MAX_SAFE_INTEGER]);this.selectionBounds=new Ut(this.getDiv(),[-Oc*this.height,-Number.MAX_SAFE_INTEGER]);var r={targetRoot:this.getDiv(),maxRoamingBounds:n,safeBounds:n,itemIdentifier:function(s){var B,g,u=t.selectionBounds.getBoundingClientRect();if(s.clientX<u.left||s.clientX>u.right||s.clientY<u.top||s.clientY>u.bottom)return null;var F=null,y=Number.MAX_VALUE;try{for(var I=(0,d.__values)(t.options),Q=I.next();!Q.done;Q=I.next()){var U=Q.value,h=U.div.getBoundingClientRect();if(h.left<=s.clientX&&s.clientX<h.right)return U.suggestion?U:null;var b=(s.clientX<h.left?-1:1)*(s.clientX-h.left);b<y&&(y=b,F=U)}}catch(p){B={error:p}}finally{try{Q&&!Q.done&&(g=I.return)&&g.call(I)}finally{if(B)throw B.error}}return F.suggestion?F:null}},i=new Qe(kc,r),o={source:null,scrollingHandler:null,suggestion:null},l=function(s){s.highlight(!0),t.highlightAnimation&&(t.highlightAnimation.cancel(),t.highlightAnimation.decouple()),t.highlightAnimation=new wc(t.container,s,!1),t.highlightAnimation.expand()},a=function(s){s.highlight(!1),t.highlightAnimation||(t.highlightAnimation=new wc(t.container,s,!1)),t.highlightAnimation.collapse()};return i.on("inputstart",function(s){if(o.source){s.terminate(!0);return}t.scrollState=new Tc(s.currentSample,t.container.scrollLeft);var B=s.baseItem;o.source=s,o.scrollingHandler=function(u){var F,y=t.scrollState.updateTo(u);(F=t.highlightAnimation)===null||F===void 0||F.setBaseScroll(y);var I=u.item?B:null;I!=o.suggestion&&(o.suggestion&&a(o.suggestion),o.suggestion=I,I&&l(I))},o.suggestion=s.currentSample.item,o.suggestion&&l(o.suggestion);var g=function(){o.suggestion&&(a(o.suggestion),o.suggestion=null),o.source=null,o.scrollingHandler=null};s.path.on("complete",g),s.path.on("invalidated",g),s.path.on("step",o.scrollingHandler)}),i.on("recognizedgesture",function(s){s.once("stage",function(B){var g=B.item;g&&!t.scrollState.hasScrolled&&t.predictionContext.accept(g.suggestion).then(function(){t.container.scrollLeft=t.isRTL?t.container.scrollWidth:0}),t.scrollState=null})}),i},e.prototype.update=function(){var t,n=c.prototype.update.call(this);return(t=this.selectionBounds)===null||t===void 0||t.updatePadding([-Oc*this.height,-Number.MAX_SAFE_INTEGER]),n},e.prototype.configureForKeyboard=function(t,n){var r=t.isRTL;this.container.textContent="",this.buildInternals(r),this.options.forEach(function(i){return i.matchKeyboardProperties(n)}),this.onSuggestionUpdate(this.currentSuggestions)},Object.defineProperty(e.prototype,"predictionContext",{get:function(){return this._predictionContext},set:function(t){this._predictionContext&&this._predictionContext.off("update",this.onSuggestionUpdate),this._predictionContext=t,t&&(t.on("update",this.onSuggestionUpdate),this.onSuggestionUpdate(t.currentSuggestions))},enumerable:!1,configurable:!0}),e.SUGGESTION_LIMIT=8,e.LONG_SUGGESTION_DISPLAY_LIMIT=3,e.MARGIN=1,e}(It);var wc=function(){function c(e,t,n){var r=this;this.setScrollOffset=function(){if(r.scrollContainer){var i=r.option.currentWidth-r.option.collapsedWidth,o=r.option.rtl,l=Math.max(r.rootScrollOffset-r.option.div.offsetLeft,0),a=Math.max(r.option.div.offsetLeft+r.option.collapsedWidth-(r.rootScrollOffset+r.scrollContainer.offsetWidth)),s=Math.max(o?a:l,0),B=Math.max(r.collapsedScrollOffset+(o?0:1)*i,0)+(o?0:-1)*s,g=Math.max(r.rootScrollOffset+(o?0:1)*i,0)+(o?0:-1)*s,u=o?Math.max(B,g):Math.min(B,g),F=Math.max(o?r.option.div.offsetLeft+r.option.currentWidth-(u+r.scrollContainer.offsetWidth):u-r.option.div.offsetLeft,0),y=Math.min(i,F),I=B+(o?1:-1)*y+(o?0:1)*s;if(r.scrollContainer.scrollLeft=I,r.pendingAnimation){var Q=r.scrollContainer.scrollLeft-I;r.option.currentWidth+=Q}}},this._expand=function(i){if(r.startTimestamp!==void 0){var o=i-r.startTimestamp,l=o>c.TRANSITION_TIME;l&&(o=c.TRANSITION_TIME);var a=r.option.expandedWidth-r.option.collapsedWidth,s=o/c.TRANSITION_TIME,B=a*s;r.option.currentWidth=B+r.option.collapsedWidth,l?r.clear():r.pendingAnimation=window.requestAnimationFrame(r._expand),r.setScrollOffset()}},this._collapse=function(i){if(r.startTimestamp!==void 0){var o=i-r.startTimestamp,l=o>c.TRANSITION_TIME;l&&(o=c.TRANSITION_TIME);var a=r.option.expandedWidth-r.option.collapsedWidth,s=1-o/c.TRANSITION_TIME,B=a*s;r.option.currentWidth=B+r.option.collapsedWidth,l?r.clear():r.pendingAnimation=window.requestAnimationFrame(r._collapse),r.setScrollOffset()}},this.scrollContainer=e,this.option=t,this.collapsedScrollOffset=e.scrollLeft,this.rootScrollOffset=e.scrollLeft}return c.prototype.setBaseScroll=function(e){this.collapsedScrollOffset=e,this.option.rtl?e>this.rootScrollOffset&&(this.rootScrollOffset=e):e<this.rootScrollOffset&&(this.rootScrollOffset=e),window.requestAnimationFrame(this.setScrollOffset)},c.prototype.decouple=function(){this.cancel(),this.scrollContainer=null},c.prototype.clear=function(){this.startTimestamp=null,window.cancelAnimationFrame(this.pendingAnimation),this.pendingAnimation=null},c.prototype.cancel=function(){this.clear(),this.option.currentWidth=this.option.collapsedWidth},c.prototype.expand=function(){this.clear(),this.startTimestamp=performance.now();var e=this.option.currentWidth-this.option.collapsedWidth,t=this.option.expandedWidth-this.option.collapsedWidth;e!=0&&(this.startTimestamp-=e/t*c.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._expand)},c.prototype.collapse=function(){this.clear(),this.startTimestamp=performance.now();var e=this.option.expandedWidth-this.option.currentWidth,t=this.option.expandedWidth-this.option.collapsedWidth;e!=0&&(this.startTimestamp-=e/t*c.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._collapse)},c.TRANSITION_TIME=250,c}();var zc=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this)||this;n.type="html";var r=n.getDiv(),i=document.createElement("div");return i.style.userSelect="none",i.style.height="100%",i.style.width="100%",r.appendChild(i),n.container=i.attachShadow?i.attachShadow({mode:"closed"}):i,n.container.innerHTML=t,n}return Object.defineProperty(e.prototype,"innerHTML",{get:function(){return this.container.innerHTML},set:function(t){this.container.innerHTML=t},enumerable:!1,configurable:!0}),e}(It);var nr=function(){function c(e,t,n){this.ImageBanner=gc,this.HTMLBanner=zc,this.hostDevice=t,this.container=e,this.predictionContext=n,this.inactiveBanner=new jt}return Object.defineProperty(c.prototype,"inactiveBanner",{get:function(){return this._inactiveBanner},set:function(e){this._inactiveBanner=e!=null?e:new jt,this.container.banner instanceof kt||(this.container.banner=this._inactiveBanner)},enumerable:!1,configurable:!0}),c.prototype.activateBanner=function(e){var t=this.container.banner;if(t instanceof kt&&(t.predictionContext=null),!e)this.container.banner=this.inactiveBanner;else{var n=new kt(this.hostDevice,this.container.activeBannerHeight);n.predictionContext=this.predictionContext,this.container.banner=n}},c.prototype.selectBanner=function(e){this.activateBanner(e=="active"||e=="configured"),this.keyboard&&this.container.banner.configureForKeyboard(this.keyboard,this.keyboardStub)},c.prototype.configureForKeyboard=function(e,t){this.keyboard=e,this.keyboardStub=t,this.container.banner.configureForKeyboard(e,t)},c.prototype.shutdown=function(){this.container.banner instanceof kt&&(this.container.banner.predictionContext=null)},c}();var Gl=function(){function c(){var e=this.element=document.createElement("div");e.style.userSelect="none",e.className="kmw-osk-none"}return c.prototype.postInsert=function(){},c.prototype.updateState=function(){},c.prototype.refreshLayout=function(){},Object.defineProperty(c.prototype,"layoutHeight",{get:function(){return Z.inPixels(0)},enumerable:!1,configurable:!0}),c}(),be=Gl;var ml=function(){function c(e){this.kbd=e;var t=this.element=document.createElement("div");t.style.userSelect="none",t.className="kmw-osk-static",t.id=c.ID,t.innerHTML=e.helpText}return c.prototype.postInsert=function(){if(!this.element.parentElement||!document.getElementById(c.ID))throw new Error("The HelpPage root element has not yet been inserted into the DOM.");this.kbd.hasScript&&this.kbd.embedScript(this.element.parentElement)},c.prototype.updateState=function(){},c.prototype.refreshLayout=function(){},Object.defineProperty(c.prototype,"layoutHeight",{get:function(){return Z.inPercent(100)},enumerable:!1,configurable:!0}),c.ID="kmw-osk-help-page",c}(),Mc=ml;var xl={"*Shift*":8,"*Enter*":5,"*Tab*":6,"*BkSp*":4,"*Menu*":11,"*Hide*":10,"*Alt*":25,"*Ctrl*":1,"*Caps*":3,"*ABC*":16,"*abc*":17,"*123*":19,"*Symbol*":21,"*Currency*":20,"*Shifted*":9,"*AltGr*":2,"*TabLeft*":7,"*LAlt*":86,"*RAlt*":87,"*LCtrl*":88,"*RCtrl*":89,"*LAltCtrl*":96,"*RAltCtrl*":97,"*LAltCtrlShift*":98,"*RAltCtrlShift*":99,"*AltShift*":100,"*CtrlShift*":101,"*AltCtrlShift*":102,"*LAltShift*":103,"*RAltShift*":104,"*LCtrlShift*":105,"*RCtrlShift*":112,"*LTREnter*":5,"*LTRBkSp*":4,"*RTLEnter*":113,"*RTLBkSp*":114,"*ShiftLock*":115,"*ShiftedLock*":116,"*ZWNJ*":117,"*ZWNJiOS*":117,"*ZWNJAndroid*":118,"*ZWNJGeneric*":121,"*Sp*":128,"*NBSp*":130,"*NarNBSp*":131,"*EnQ*":132,"*EmQ*":133,"*EnSp*":134,"*EmSp*":135,"*PunctSp*":140,"*ThSp*":141,"*HSp*":142,"*ZWSp*":129,"*ZWJ*":119,"*WJ*":120,"*CGJ*":122,"*LTRM*":144,"*RTLM*":145,"*SH*":161,"*HTab*":162},rr=xl;var Xl=["default","shift","shift-on","special","special-on","","","","deadkey","blank","hidden"],wt=Xl;function zt(c,e){switch(c){case"*ZWNJ*":c=e.device.OS==f.OperatingSystem.Android?"*ZWNJAndroid*":"*ZWNJiOS*";break;case"*Enter*":c=e.isRTL?"*RTLEnter*":"*LTREnter*";break;case"*BkSp*":c=e.isRTL?"*RTLBkSp*":"*LTRBkSp*";break;default:}var t=rr[c],n=57344+t;return t?String.fromCharCode(n):c}var Vl=function(){function c(e,t){this.spec=e,this.layer=t}return c.prototype.setButtonClass=function(){var e,t=this.spec,n=this.btn,r=0;typeof t.dk=="string"&&t.dk=="1"&&(r=8),r=(e=t.sp)!==null&&e!==void 0?e:r,(r<0||r>10)&&(r=0),n.className="kmw-key kmw-key-"+wt[r]},c.prototype.setToggleState=function(e){var t;switch(t=this.spec.sp,wt[t]){case"shift":case"shift-on":e===void 0&&(e=wt[t]=="shift"),this.spec.sp=1+(e?1:0);break;case"special":case"special-on":e===void 0&&(e=wt[t]=="special"),this.spec.sp=3+(e?1:0);break;default:return}this.setButtonClass()},c.prototype.isFrameKey=function(){var e=this.spec.sp||0;switch(wt[e]){case"default":case"deadkey":return!1;default:return!0}},c.prototype.allowsKeyTip=function(){return this.isFrameKey()?!1:!this.btn.classList.contains("kmw-spacebar")},c.prototype.highlight=function(e){var t=this.btn.classList;e?t.contains(c.HIGHLIGHT_CLASS)||t.add(c.HIGHLIGHT_CLASS):t.remove(c.HIGHLIGHT_CLASS)},c.prototype.getIdealFontSize=function(e,t,n){if(!this._fontFamily)return new Z("1em");n!=null||(n=1);var r=t.keyWidth,i=t.keyHeight,o=t.baseEmFontSize.scaledBy(t.layoutFontSize.val),l=this._fontSize;l.absolute||(l=o.scaledBy(l.val));var a={fontFamily:this._fontFamily,fontSize:l.styleString,height:t.keyHeight},s=Ke(e,o.scaledBy(n).val,a),B=.9,g=.9,u=2,F;s.fontBoundingBoxAscent&&(F=s.fontBoundingBoxAscent+s.fontBoundingBoxDescent);var y=F!=null?F:0,I=r*B/(s.width+u),Q=y&&i?i*g/y:void 0,U=I;return Q&&Q<I&&(U=Q),Z.forScalar(n*Math.min(U,1))},Object.defineProperty(c.prototype,"keyText",{get:function(){var e=this.spec,t="\xA0",n=null;return e.text==null||e.text==""?n=t:(n=e.text,n=="*Tab*"&&this.layer=="shift"&&(n="*TabLeft*")),n},enumerable:!1,configurable:!0}),c.prototype.generateKeyText=function(e){var t=this.spec,n=document.createElement("span"),r=n.style;n.className="kmw-key-text";var i=this.keyText,o=zt(i,e);o!=i&&(i=o,t.font="SpecialOSK"),typeof t.font=="string"&&t.font!=""&&(r.fontFamily=t.font),typeof t.fontsize=="string"&&t.fontsize!=""&&(r.fontSize=t.fontsize);var l={fontSize:r.fontSize};return r.fontFamily?l.fontFamily=r.fontFamily:l.fontFamily=e.fontFamily,e.isRTL&&(i="\u200F"+i),n.innerText=i,n},c.prototype.resetFontPrecalc=function(){this._fontFamily=void 0,this._fontSize=void 0,this.label.style.fontSize=""},c.prototype.detectStyles=function(e){if(!(this.spec.sp==10||this.spec.sp==9)&&this._fontFamily===void 0){var t=getComputedStyle(this.label);if(!t.fontFamily)return;this._fontFamily=t.fontFamily;var n=new Z(t.fontSize),r=e.layoutFontSize;if(r.absolute)this._fontSize=n;else{var i=e.baseEmFontSize,o=r.scaledBy(i.val),l=n.val/o.val;this._fontSize=Z.forScalar(l)}}},c.prototype.refreshLayout=function(e){if(this.label)if(this.label.classList.contains("kmw-spacebar-caption")){var n=this.getIdealFontSize(this.keyText,e);this.label.style.setProperty("font-size",n.styleString,"important")}else{var t=this.label.textContent,n=this.getIdealFontSize(t,e);this.label.style.fontSize=n.styleString}},c.specialCharacters=rr,c.BUTTON_CLASSES=wt,c.HIGHLIGHT_CLASS="kmw-key-touched",c}(),Nt=Vl;var je=function(){function c(e,t){this.key=e,this.keyId=t}return c}();function _e(c,e){var t=c;for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n]);return t}function Zl(c){return c&&"key"in c&&c.key instanceof Nt}function qe(c){return Zl(c)?c:null}var vl=function(c){(0,d.__extends)(e,c);function e(t,n,r){var i=c.call(this,t,n)||this;return i.row=r,i}return e.prototype.getId=function(){return this.spec.elementID},e.prototype.getCoreId=function(){return this.spec.coreID},e.prototype.getBaseId=function(){return this.spec.baseKeyID},e.prototype.generateKeyCapLabel=function(){var t=C.keyCodes[this.spec.baseKeyID];switch(t){case 186:t=59;break;case 187:t=61;break;case 188:t=44;break;case 189:t=45;break;case 190:t=46;break;case 191:t=47;break;case 192:t=96;break;case 219:t=91;break;case 220:t=92;break;case 221:t=93;break;case 222:t=39;break;default:(t<48||t>90)&&(t=0)}var n=document.createElement("div");return n.className="kmw-key-label",t>0&&(n.innerText=String.fromCharCode(t)),n},e.prototype.processSubkeys=function(t,n){var r,i=t.subKeys=this.spec.sk;for(r=0;r<i.length;r++){if(i[r].sp==1||i[r].sp==2){var o=i[r].text;i[r].text=zt(o,n)}i[r].layer||(i[r].layer=t.key.layer)}},e.prototype.construct=function(t){var n=this.spec,r=document.createElement("div");r.className="kmw-key-square";var i=document.createElement("div"),o=this.btn=_e(i,new je(this,n.id));this.setButtonClass();var l=this.capLabel=this.generateKeyCapLabel();o.appendChild(l),o.id=this.getId(),o.appendChild(this.label=this.generateKeyText(t)),typeof n.sk!="undefined"&&n.sk!=null?this.processSubkeys(o,t):o.subKeys=null;var a=this.generateHint(t);return o.appendChild(a),r.appendChild(o),this.preview=document.createElement("div"),this.preview.style.display="none",o.appendChild(this.preview),this.square=r},e.prototype.generateHint=function(t){var n=document.createElement("div");n.className="kmw-key-popup-icon";var r=this.spec.hintSrc;if(!r)return n;if(r.font&&r.font!="SpecialOSK"?n.style.fontFamily=r.font:n.classList.add("kmw-key-text"),r.fontsize){var i=new Z(r.fontsize);n.style.fontSize=i.scaledBy(.5).styleString}var o=r==this.spec?this.spec.hint:r.text,l=zt(o,t);return l=="\u2022"&&(n.style.fontWeight="bold"),o!=l&&(n.style.fontFamily="SpecialOSK"),n.textContent=l,n},e.prototype.setPreview=function(t){var n=this,r=this.preview;t?(this.previewHost=t,this.preview=this.previewHost.element):(this.previewHost=null,this.preview=document.createElement("div"),this.preview.style.display="none"),t==null||t.setCancellationHandler(function(){n.setPreview(null)}),this.btn.replaceChild(this.preview,r)},e.prototype.refreshLayout=function(t){c.prototype.refreshLayout.call(this,t);var n=t.baseEmFontSize;n.val<12?this.capLabel.style.fontSize="6px":this.capLabel.style.fontSize=Z.forScalar(.5).styleString},Object.defineProperty(e.prototype,"displaysKeyCap",{get:function(){return this.capLabel&&this.capLabel.style.display=="block"},set:function(t){if(!this.capLabel)throw new Error("Key element not yet constructed; cannot display key cap");this.capLabel.style.display=t?"block":"none"},enumerable:!1,configurable:!0}),e}(Nt),Dc=vl;var $e=.15,fl=function(){function c(e,t,n){var r=this.element=document.createElement("div");r.className="kmw-key-row",this.heightFraction=1/t.row.length;var i=n.key;this.spec=n,this.keys=[];for(var o=0;o<i.length;o++){var l=i[o],a=new Dc(l,t.id,this),s=a.construct(e);this.keys.push(a),r.appendChild(s)}}return Object.defineProperty(c.prototype,"displaysKeyCaps",{get:function(){if(this.keys.length>0)return this.keys[0].displaysKeyCap},set:function(e){var t,n;try{for(var r=(0,d.__values)(this.keys),i=r.next();!i.done;i=r.next()){var o=i.value;o.displaysKeyCap=e}}catch(l){t={error:l}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},enumerable:!1,configurable:!0}),c.prototype.refreshLayout=function(e){var t=this.element.style,n=e.heightStyle.scaledBy(this.heightFraction);t.maxHeight=t.lineHeight=t.height=n.styleString;var r=e.heightStyle.absolute?n:Z.forScalar(1),i=r.scaledBy($e/2),o=r.scaledBy(1-$e);this.keys.forEach(function(l){var a=l.square,s=l.btn,B=a.style;B.height=B.minHeight=r.styleString;var g=s.style;g.top=i.styleString,g.height=g.lineHeight=g.minHeight=o.styleString})},c.prototype.buildKeyLayout=function(e,t){var n=e.widthStyle.scaledBy(t.spec.proportionalWidth),r=e.heightStyle.scaledBy(this.heightFraction).scaledBy(1-$e),i={keyWidth:n.val*(n.absolute?1:e.keyboardWidth),keyHeight:r.val*(r.absolute?1:e.keyboardHeight),baseEmFontSize:e.baseEmFontSize,layoutFontSize:e.layoutFontSize};return i},c.prototype.detectStyles=function(e){var t=this;this.keys.forEach(function(n){n.detectStyles(t.buildKeyLayout(e,n))})},c.prototype.refreshKeyLayouts=function(e){var t=this;this.keys.forEach(function(n){var r,i=n.btn,o=e.widthStyle,l=e.heightStyle,a=o.scaledBy(n.spec.proportionalWidth),s=o.scaledBy(n.spec.proportionalPad),B=l.scaledBy(t.heightFraction).scaledBy(1-$e),g=l.absolute?B.styleString:"100%",u=t.buildKeyLayout(e,n);(r=i.key)===null||r===void 0||r.refreshLayout(u),n.square.style.width=a.styleString,n.square.style.marginLeft=s.styleString,n.btn.style.width=o.absolute?a.styleString:"100%",n.square.style.height=g})},c}(),Pc=fl;var Jl=function(){function c(e,t,n){this.spec=n;var r=this.element=document.createElement("div"),i=r.style;r.className="kmw-key-layer";var o=n.row.length;o>4&&e.device.formFactor=="phone"&&(r.className=r.className+" kmw-5rows"),i.fontFamily="font"in t?t.font:"",this.nextlayer=n.id,r.layer=n.id,typeof n.nextlayer=="string"&&(r.nextLayer=this.nextlayer=n.nextlayer);var l=n.row;this.rows=[];for(var a=0;a<l.length;a++){var s=new Pc(e,n,l[a]);s.displaysKeyCaps=t.displayUnderlying,r.appendChild(s.element),this.rows.push(s)}if(e.device.touchable&&(this.globeKey=this.findKey("K_LOPT"),this.hideKey=this.findKey("K_ROPT")),this.spaceBarKey=this.findKey("K_SPACE"),this.capsKey=this.findKey("K_CAPS"),this.numKey=this.findKey("K_NUMLOCK"),this.scrollKey=this.findKey("K_SCROLL"),this.spaceBarKey){var B=this.spaceBarKey.label,g=this.spaceBarKey.btn;typeof g.className=="undefined"||g.className==""?g.className="kmw-spacebar":g.className.indexOf("kmw-spacebar")==-1&&(g.className+=" kmw-spacebar"),B.className!="kmw-spacebar-caption"&&(B.className="kmw-spacebar-caption")}}return Object.defineProperty(c.prototype,"rowHeight",{get:function(){return this._rowHeight},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"id",{get:function(){return this.spec.id},enumerable:!1,configurable:!0}),c.prototype.findKey=function(e){var t,n,r,i;try{for(var o=(0,d.__values)(this.rows),l=o.next();!l.done;l=o.next()){var a=l.value;try{for(var s=(r=void 0,(0,d.__values)(a.keys)),B=s.next();!B.done;B=s.next()){var g=B.value;if(g.getBaseId()==e)return g}}catch(u){r={error:u}}finally{try{B&&!B.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}}catch(u){t={error:u}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return null},c.prototype.showLanguage=function(e){if(this.spaceBarKey)try{var t=this.spaceBarKey.label;this.spaceBarKey.spec.text=e,(t.innerText!=e||e=="")&&(t.innerText=e)}catch(n){}},c.prototype.refreshLayout=function(e){var t,n;this.rows.forEach(function(y){return y.detectStyles(e)});var r=e.keyboardHeight,i=this.rows.length,o=this._rowHeight=Math.floor(r/(i==0?1:i)),l=e.widthStyle.absolute;l&&(this.element.style.height=r+"px"),this.showLanguage(e.spacebarText);for(var a=0;a<i;a++){var s=this.rows[a],B=(i-a-1)*o+1;l&&(this.spec.row[a].proportionalY=(r-B-o/2)/r),s.refreshLayout(e),a==i-1&&(s.element.style.bottom="1px")}try{for(var g=(0,d.__values)(this.rows),u=g.next();!u.done;u=g.next()){var F=u.value;F.refreshKeyLayouts(e)}}catch(y){t={error:y}}finally{try{u&&!u.done&&(n=g.return)&&n.call(g)}finally{if(t)throw t.error}}},c}(),Kc=Jl;var Wl=.06,Sl=function(){function c(e,t,n){this._layers={},this._activeLayerId="default";var r=t.layout(n);this.spec=r,this.vkbd=e;var i=this.element=document.createElement("div"),o=i.style;if(i.className="kmw-key-layer-group",r!=null){var l=r.fontsize;typeof l=="undefined"||l==null||l==""?o.fontSize="1em":o.fontSize=r.fontsize,o.width="100%",o.height="100%",this.activeLayerId="default"}}return c.prototype.buildLayer=function(e){var t=this.spec,n=t.getLayer(e);if(!n)return null;var r=new Kc(this.vkbd,t,n);return this._layers[e]=r,this.element.appendChild(r.element),r},c.prototype.getLayer=function(e){var t=this._layers[e];return t||(t=this.buildLayer(e),t&&(this._layers[e]=t,t.element.style.display="none")),t},Object.defineProperty(c.prototype,"activeLayer",{get:function(){return this.activeLayerId?this._layers[this.activeLayerId]:null},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"layers",{get:function(){var e,t,n=this.spec.layer,r=n.map(function(a){return a.id});try{for(var i=(0,d.__values)(r),o=i.next();!o.done;o=i.next()){var l=o.value;this.buildLayer(l)}}catch(a){e={error:a}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return this._layers},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"activeLayerId",{get:function(){return this._activeLayerId},set:function(e){var t,n;this._activeLayerId=e,this.getLayer(e);try{for(var r=(0,d.__values)(Object.keys(this._layers)),i=r.next();!i.done;i=r.next()){var o=i.value,l=this._layers[o],a=l.element;l.id==e?a.style.display="block":a.style.display="none"}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},enumerable:!1,configurable:!0}),c.prototype.findNearestKey=function(e){if(!e)return null;var t=e.stateToken;if(!t)throw new Error("Layer id not set for input coordinate");var n=this._layers[t];if(!n)throw new Error("Layer id ".concat(t," could not be found"));return this.nearestKey(e,n)},c.prototype.blinkLayer=function(e){var t=this;if(typeof e=="string"){var n=e;if(e=this.getLayer(n),!e)throw new Error("Layer id ".concat(n," could not be found"))}var r=e;if(r.element.style.display!="block")for(var i in this._layers){if(this._layers[i].element.style.display=="block"){var o=this._layers[i];o.element.style.display="none"}this._layers[i].element.style.display="none"}r.element.style.display="block",Promise.resolve().then(function(){var l=t._layers[t._activeLayerId];(r.element.style.display=="block"||l.element.style.display!="block")&&(r.element.style.display="none",l.element.style.display="block")})},c.prototype.nearestKey=function(e,t){var n,r;if(t.rows.length==0)return null;var i={x:e.targetX/this.computedWidth,y:e.targetY/this.computedHeight};if(!isFinite(i.x)||!isFinite(i.y))return null;var o=Math.max(0,Math.min(t.rows.length-1,Math.floor(i.y*t.rows.length))),l=t.rows[o],a=null,s=Number.MAX_VALUE;try{for(var B=(0,d.__values)(l.keys),g=B.next();!g.done;g=B.next()){var u=g.value,F=u.spec;if(!(F.sp==9||F.sp==10)){var y=F.proportionalWidth/2,I=Math.abs(i.x-F.proportionalX);if(I-y<=0)return u.btn;var Q=I-y;Q<s&&(s=Q,a=u)}}}catch(U){n={error:U}}finally{try{g&&!g.done&&(r=B.return)&&r.call(B)}finally{if(n)throw n.error}}return s<=Wl?a.btn:null},c.prototype.resetPrecalcFontSizes=function(){var e,t,n,r,i,o;try{for(var l=(0,d.__values)(Object.values(this._layers)),a=l.next();!a.done;a=l.next()){var s=a.value;try{for(var B=(n=void 0,(0,d.__values)(s.rows)),g=B.next();!g.done;g=B.next()){var u=g.value;try{for(var F=(i=void 0,(0,d.__values)(u.keys)),y=F.next();!y.done;y=F.next()){var I=y.value;I.resetFontPrecalc()}}catch(Q){i={error:Q}}finally{try{y&&!y.done&&(o=F.return)&&o.call(F)}finally{if(i)throw i.error}}}}catch(Q){n={error:Q}}finally{try{g&&!g.done&&(r=B.return)&&r.call(B)}finally{if(n)throw n.error}}}}catch(Q){e={error:Q}}finally{try{a&&!a.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}this._heightPadding=void 0},c.prototype.refreshLayout=function(e){if(!(isNaN(e.keyboardWidth)||isNaN(e.keyboardHeight))){if(this.computedWidth=e.keyboardWidth,this.computedHeight=e.keyboardHeight,this._heightPadding===void 0){var t=getComputedStyle(this.element),n=parseInt(t.paddingTop,10)||0,r=parseInt(t.paddingBottom,10)||0;this._heightPadding=n+r}this.activeLayer&&this.activeLayer.refreshLayout(e)}},Object.defineProperty(c.prototype,"verticalPadding",{get:function(){var e;return(e=this._heightPadding)!==null&&e!==void 0?e:0},enumerable:!1,configurable:!0}),c}(),jc=Sl;var _c="kmw-",qc="top",Ll=function(){function c(e,t){var n=this;this.state=!1,this.orientation=qc,this.vkbd=e;var r=this.element=document.createElement("div");r.className="kmw-keytip",r.id="kmw-keytip",r.style.pointerEvents="none",r.style.display="none",r.appendChild(this.tip=document.createElement("div")),r.appendChild(this.cap=document.createElement("div")),this.tip.appendChild(this.preview=document.createElement("div")),this.tip.className="kmw-keytip-tip",this.cap.className="kmw-keytip-cap",this.constrain=t,this.reorient=function(i){n.orientation=i,n.show(n.key,n.state,n.previewHost)}}return c.prototype.show=function(e,t,n){var r=this,i,o=this.vkbd;if(t&&o.layerGroup.blinkLayer(e.key.spec.displayLayer),t&&e.offsetParent){var l=e.key.row.element,a=e.getClientRects()[0],s=l.getClientRects()[0],B=a.left-s.left,g=a.width,u=a.height,F=1.8,y=this.element.style,I=o.topContainer,Q=I.getBoundingClientRect(),U=e.getBoundingClientRect(),h=void 0,b=this.orientation,p=U.bottom-Q.top;h=p+(b=="top"?1:-1);var X=h-Math.floor(h),x=g+Math.ceil(g*.3)*2,m=Math.ceil(2.3*u)+X;b=="bottom"&&(h+=m-u),y.top="auto";var J=b=="top"?"bottom":"top";this.tip.classList.remove("".concat(_c).concat(J)),this.tip.classList.add("".concat(_c).concat(b)),y.bottom=Math.floor(Q.height-h)+"px",y.textAlign="center",y.overflow="visible",y.width=x+"px",y.height=m+"px";var V=this.vkbd.currentLayer.element.style.fontFamily,G=getComputedStyle(o.element);y.fontFamily=e.key.spec.font||V||G.fontFamily;var S=parseInt(G.fontSize,10);if(S==Number.NaN&&(S=0),S!=0){var T={keyWidth:1.6*g,keyHeight:1.6*u,baseEmFontSize:o.getKeyEmFontSize(),layoutFontSize:new Z(o.kbdDiv.style.fontSize)};y.fontSize=e.key.getIdealFontSize(e.key.keyText,T,F).styleString}var H=(x-g)/2;B<H?(this.cap.style.left="1px",B+=H-1):B>window.innerWidth-g-H?(this.cap.style.left=x-g-1+"px",B-=H-1):this.cap.style.left=H+"px",y.left=B-H+"px";var E=getComputedStyle(this.element),W=Q.height,R=parseFloat(E.bottom),A=parseFloat(E.height),k=Math.ceil(m/2);this.cap.style.width=g+"px",this.tip.style.height=k+"px";var at=3,nt=k-at+"px";b=="top"?(this.cap.style.top=nt,this.cap.style.bottom=""):(this.cap.style.top="",this.cap.style.bottom=nt);var Dt=p-Math.floor(h)+m-(b=="top"?k:-at*2);if(this.cap.style.height=Dt+"px",this.constrain&&A+R>W){var re=A+R-W;y.height=m-re+"px";var rn=Math.max(0,m-re-m/2+2);this.cap.style.height=rn+"px"}else R<0&&(y.bottom="0px",this.cap.style.height=Math.max(0,Dt+R)+"px");if(y.display="block",this.previewHost==n)return;var Ri=this.preview;this.previewHost&&this.previewHost.off("preferredOrientation",this.reorient),this.previewHost=n,n&&(this.previewHost.on("preferredOrientation",this.reorient),this.preview=this.previewHost.element,this.tip.replaceChild(this.preview,Ri),n.setCancellationHandler(function(){return r.show(null,!1,null)}),n.on("startFade",function(){r.element.classList.remove("kmw-preview-fade"),r.element.offsetWidth,r.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",(i=this.previewHost)===null||i===void 0||i.off("preferredOrientation",this.reorient),this.previewHost=null;var Ai=this.preview;this.preview=document.createElement("div"),this.tip.replaceChild(this.preview,Ai),this.element.classList.remove("kmw-preview-fade"),this.orientation=qc}this.key=e,this.state=t},c}(),$c=Ll;var cr="kmw-keypreview",Rl="kmw-preview-overlay",Al="kmw-keytip",ti=function(){function c(e){this.state=!1,this.vkbd=e;var t=this.element=document.createElement("div");t.className=cr,t.id="kmw-keytip",t.style.pointerEvents="none",t.style.display="none",this.preview=document.createElement("div"),t.appendChild(this.preview)}return c.prototype.show=function(e,t,n){var r=this,i=this.vkbd,o=e==null?void 0:e.key.spec.displayLayer;if(t&&i.layerGroup.blinkLayer(o),t&&(e!=null&&e.offsetParent)){var l=this.vkbd.topContainer.getBoundingClientRect(),a=e.getBoundingClientRect(),s=o!=i.layerId?Rl:"";this.element.className="".concat(cr," ").concat(e.className," ").concat(s),this.element.id="".concat(Al,"-").concat(e.id);var B=this.element.style,g=this.vkbd.currentLayer.element.style.fontFamily;if(B.fontFamily=e.key.spec.font||g,B.left=a.left-l.left+"px",B.top=a.top-l.top+"px",B.width=a.width+"px",B.height=a.height+"px",this.element.style.display="block",this.previewHost==n)return;var u=this.preview;this.previewHost=n,n&&(this.preview=this.previewHost.element,this.element.replaceChild(this.preview,u),n.setCancellationHandler(function(){return r.show(null,!1,null)}),n.on("startFade",function(){r.element.classList.remove("kmw-preview-fade"),r.element.offsetWidth,r.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",this.element.className=cr,this.previewHost=null;var F=this.preview;this.preview=document.createElement("div"),this.element.replaceChild(this.preview,F),this.element.classList.remove("kmw-preview-fade")}this.key=e,this.state=t},c}();function ht(c){try{if(c=="desktop")return 1;var e=document.documentElement.clientWidth;if(screen.width>e)return 1;var t=screen.width;return it()?screen.width<screen.height&&(t=screen.height):screen.width>screen.height&&(t=screen.height),Math.round(100*t/e)/100}catch(n){return 1}}var ei=function(){function c(e,t){var n=this;this.directlyEmitsKeys=!0,this.hasModalVisualization=!1,this.deleteRepeater=function(){n.repeatClosure(),n.timerHandle=window.setTimeout(n.deleteRepeater,c.REPEAT_DELAY)},this.source=e;var r=e.stageReports[0].item;r.key.highlight(!0),this.repeatClosure=function(){t(),r.key.highlight(!0)},this.timerHandle=window.setTimeout(this.deleteRepeater,c.INITIAL_DELAY),this.source.on("complete",function(){window.clearTimeout(n.timerHandle),n.timerHandle=void 0,r.key.highlight(!1)})}return c.prototype.cancel=function(){this.deleteRepeater(),this.source.cancel()},c.prototype.currentStageKeyDistribution=function(){return null},c.INITIAL_DELAY=500,c.REPEAT_DELAY=100,c}();var Hl=function(c){(0,d.__extends)(e,c);function e(t,n){if(typeof n!="string"||n=="")throw"The 'layer' parameter for subkey construction must be properly defined.";return c.call(this,t,n)||this}return e.prototype.getId=function(){return"popup-"+this.spec.elementID},e.prototype.construct=function(t,n,r,i){var o=this.spec,l=document.createElement("div"),a=l.style;l.className="kmw-key-square-ex",i&&(a.marginTop="5px"),a.width=r+"px",a.height=n.offsetHeight+"px";var s=document.createElement("div"),B=this.btn=_e(s,new je(this,o.id));this.setButtonClass(),B.id=this.getId();var g=B.style;return g.height=a.height,g.lineHeight=n.style.lineHeight,g.width=a.width,g.position="absolute",B.appendChild(this.label=this.generateKeyText(t)),l.appendChild(B),this.square=l},e.prototype.allowsKeyTip=function(){return!1},e}(Nt),ni=Hl;var ri=.2,kl=1.2,ii=3,$t=5,ci=6+ii,Nl=function(){function c(e,t,n,r,i){var o=this,l;this.directlyEmitsKeys=!0,this.shouldLockLayer=!1,this.baseKey=r,this.source=e,this.gestureParams=i,n.layerLocked&&(this.shouldLockLayer=!0),e.on("complete",function(){var V;(V=o.currentSelection)===null||V===void 0||V.key.highlight(!1),o.clear()}),e.on("stage",function(){var V=o.currentSelection;if(V){var G=n.keyEventFromSpec(V.key.spec);G.keyDistribution=o.currentStageKeyDistribution(),n.raiseKeyEvent(G,V)}});var a=e.stageReports[0].sources[0].constructSubview(!0,!1);a.path.on("step",function(V){var G,S;a.path.stats.netDistance>=4&&((G=o.currentSelection)===null||G===void 0||G.key.highlight(!1),(S=V.item)===null||S===void 0||S.key.highlight(!0),o.currentSelection=V.item)}),this.currentSelection=r,r.key.highlight(!0);var s=r.subKeys,B=this.element=document.createElement("div");B.id="kmw-popup-keys";var g=B.style;g.fontFamily=n.fontFamily;var u=getComputedStyle(r);g.fontSize=u.fontSize,g.visibility="hidden";var F=r.key.layer;(typeof F!="string"||F=="")&&(F=n.layerId);var y=s.length,I=Math.ceil(y/9),Q=Math.ceil(y/I);this.subkeys=[];for(var U=$t,h=0,b=0,p=0;b<y;b++,p++){var X=typeof s[b].width!="undefined"?s[b].width*r.offsetWidth/100:r.offsetWidth;X>n.width-2*$t&&(X=n.width-2*$t),(U+X+$t>n.width||p>=Q)&&(h++,p=0,U=$t);var x=new ni(s[b],F),m=x.construct(n,r,X,h>0);U+=X+$t,this.menuWidth=Math.max((l=this.menuWidth)!==null&&l!==void 0?l:0,U),this.subkeys.push(m.firstChild),B.appendChild(m)}g.width=this.menuWidth+"px",this.shim=document.createElement("div"),this.shim.id="kmw-popup-shim",n.device.formFactor==f.FormFactor.Phone&&this.selectDefaultSubkey(r,B),n.element.appendChild(this.element),n.topContainer.appendChild(this.shim),this.reposition(n);var J=this.buildPopupRecognitionConfig(n);t({type:"push",config:J})}return c.prototype.buildPopupRecognitionConfig=function(e){var t=this,n=this.element.getBoundingClientRect(),r=this.baseKey.getBoundingClientRect(),i=this.subkeys[0].style,o=Number.parseInt(i.height,10),l=-.666*o,a=3,s=r.bottom-n.bottom,B=new Ut(this.element,[l*a,l,-s<l?-s:l]),g={getBoundingClientRect:function(){var u=Number.MAX_SAFE_INTEGER;return new DOMRect(-u,-u,2*u,2*u)}};return{targetRoot:this.element,inputStartBounds:e.element,maxRoamingBounds:g,safeBounds:g,itemIdentifier:function(u,F){var y,I,Q=B.getBoundingClientRect(),U=null,h=Number.MAX_VALUE,b=Number.MAX_VALUE;if(u.clientX<Q.left||u.clientX>Q.right||u.clientY<Q.top||u.clientY>Q.bottom)return null;try{for(var p=(0,d.__values)(t.subkeys),X=p.next();!X.done;X=p.next()){var x=X.value,m=x.getBoundingClientRect(),J=Number.MAX_VALUE,V=Number.MAX_VALUE;if(m.left<=u.clientX&&u.clientX<m.right?J=0:J=m.left>=u.clientX?m.left-u.clientX:u.clientX-m.right,m.top<=u.clientY&&u.clientY<m.bottom?V=0:V=m.top>=u.clientY?m.top-u.clientY:u.clientY-m.bottom,J==0&&V==0)return x;(J<b||J==b&&V<h)&&(b=J,U=x,h=V)}}catch(G){y={error:G}}finally{try{X&&!X.done&&(I=p.return)&&I.call(p)}finally{if(y)throw y.error}}return U}}},c.prototype.reposition=function(e){var t=this.element,n=this.baseKey,r=e.topContainer,i=n.key.row.element,o=t.style,l=n.offsetParent?n.offsetParent.offsetLeft:0,a=n.offsetLeft+l+.5*(n.offsetWidth-t.offsetWidth),s=e.width-t.offsetWidth;a>s&&(a=s),a<0&&(a=0),o.left=a+"px";var B=r.getBoundingClientRect(),g=i.getBoundingClientRect();o.top=g.top-B.top-t.offsetHeight-ii+"px",o.visibility="visible";var u=e.isEmbedded,F=getComputedStyle(t),y=parseFloat(F.top),I=0,Q=0;y<I&&u&&(Q=I-y,o.top=I+"px"),this.callout=this.addCallout(n,Q,e.element,e.topContainer,e.device.formFactor=="tablet")},c.prototype.addCallout=function(e,t,n,r,i){t=t||0;var o=getComputedStyle(this.element),l=Math.max(Number.parseInt(o.borderRadius),0),a=e.getBoundingClientRect(),s=r.getBoundingClientRect(),B=Math.floor(Number.parseInt(o.top,10)+Number.parseInt(o.height,10)+Number.parseInt(o.paddingTop,10)/2+Number.parseInt(o.paddingBottom,10)),g=ri*(a.height-t),u=ri*a.height,F=g+ci,y=F/(u+ci),I=a.bottom-s.top-B-1,Q=I<F?I:F;if(Q>0){var U=document.createElement("div"),h=U.style;U.id="kmw-popup-callout",n.appendChild(U),h.top=B+"px",h.borderTopWidth=Q+"px";var b=kl*y,p=a.width*b,X=this.menuWidth-2*l,x=X<p?X:p,m=a.left-s.left-(x-a.width)/2,J=Math.max(0,m+x-(s.right-l)),V=Math.max(0,l-m);return h.left=a.left-s.left-(x-a.width)/2+V+"px",h.borderLeftWidth=x/2-V+"px",h.borderRightWidth=x/2-J+"px",U}else return null},c.prototype.selectDefaultSubkey=function(e,t){for(var n,r,i=e.subKeys,o=0;o<i.length;o++){var l=i[o],a=t.childNodes[o].firstChild;if(l.default){r=a;break}else if(!e.key||!e.key.spec)continue;l.elementID==e.key.spec.elementID&&(r=a)}r&&((n=this.currentSelection)===null||n===void 0||n.key.highlight(!1),this.currentSelection=r,r.key.highlight(!0))},Object.defineProperty(c.prototype,"hasModalVisualization",{get:function(){return this.element.style.visibility=="visible"},enumerable:!1,configurable:!0}),c.prototype.buildCorrectiveLayout=function(){var e=this.element.getBoundingClientRect(),t=e.width/e.height,n=this.subkeys.map(function(r){var i=r.getBoundingClientRect(),o={keySpec:r.key.spec,centerX:(i.right-i.width/2-e.left)/e.width,centerY:(i.bottom-i.height/2-e.top)/e.height,width:i.width/e.width,height:i.height/e.height};return o});return{keys:n,kbdScaleRatio:t}},c.prototype.currentStageKeyDistribution=function(){var e=this,t=this.source.stageReports[this.source.stageReports.length-1],n=this.source.stageReports[0],r=t.sources[0],i=r.currentSample,o=this.element.getBoundingClientRect(),l={x:i.targetX/o.width,y:i.targetY/o.height};l.x=l.x<0?0:l.x>1?1:l.x,l.y=l.y<0?0:l.y>1?1:l.y;var a=He(l,this.buildCorrectiveLayout()),s=a.get(i.item.key.spec),B=Math.min(r.path.stats.duration-n.sources[0].path.stats.duration,this.gestureParams.longpress.waitLength)/(2*this.gestureParams.longpress.waitLength),g=Math.min(r.path.stats.rawDistance,this.gestureParams.longpress.noiseTolerance*4)/(this.gestureParams.longpress.noiseTolerance*8),u=Math.min(B*B,g*g),F=s+u,y=new Map,I=this.subkeys.find(function(Q){return Q.keyId==e.baseKey.keyId});return I?y.set(I.key.spec,F):y.set(this.baseKey.key.spec,F),Rt([a,y])},c.prototype.cancel=function(){this.clear(),this.source.cancel()},c.prototype.clear=function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.shim.parentNode&&this.shim.parentNode.removeChild(this.shim),this.callout&&this.callout.parentNode&&this.callout.parentNode.removeChild(this.callout)},c}(),ir=Nl;var Tl=function(){function c(e,t,n){var r=this;this.directlyEmitsKeys=!0,this.shouldRestore=!1,this.hasModalVisualization=!1;var i=e.stageReports[0];this.originalLayer=i.sources[0].stateToken,this.source=e,this.completionCallback=function(){t.lockLayer(!1),r.shouldRestore&&(t.layerId=r.originalLayer,t.updateState()),n==null||n()},t.lockLayer(!0),e.on("stage",function(o){var l=o.matchedId;l.includes("modipress")&&l.includes("-end")?r.clear():l.includes("modipress")&&l.includes("-hold")&&(r.shouldRestore=!0)}),e.on("complete",function(){return r.cancel()})}return Object.defineProperty(c.prototype,"isLocked",{get:function(){return this.shouldRestore},enumerable:!1,configurable:!0}),c.prototype.setLocked=function(){this.shouldRestore=!0},Object.defineProperty(c.prototype,"completed",{get:function(){return this.completionCallback===null},enumerable:!1,configurable:!0}),c.prototype.clear=function(){var e=this.completionCallback;this.completionCallback=null,e==null||e()},c.prototype.cancel=function(){this.clear(),this.source.cancel()},c.prototype.currentStageKeyDistribution=function(e){return null},c}(),Ce=Tl;var El=function(){function c(e,t,n,r,i){var o=this;this.directlyEmitsKeys=!0,this.hasModalVisualization=!1,this.tapIndex=0,this.baseKey=n,this.baseContextToken=r,this.multitaps=[n.key.spec].concat(n.key.spec.multitap),this.sequence=e;var l=function(u){var F;(F=o.modipress)===null||F===void 0||F.clear();var y=new Ce(e,t,function(){o.modipress=t.activeModipress=null});o.modipress=t.activeModipress=y};this.originalLayer=t.layerId;var a=function(u){return(o.tapIndex+u)%o.multitaps.length},s=function(){i==null||i.setMultitapHint(o.multitaps[a(0)],o.multitaps[a(1)],t)};e.on("complete",function(){var u;(u=o.modipress)===null||u===void 0||u.cancel(),o.clear()});var B=function(u){var F;switch(u.matchedId){case"modipress-hold":o.clear(),e.off("stage",B);return;case"modipress-end-multitap-transition":case"modipress-multitap-end":case"modipress-end":case"multitap-end":case"simple-tap":return;case"modipress-multitap-lock-transition":(F=o.modipress)===null||F===void 0||F.setLocked();return;case"modipress-multitap-start":case"multitap-start":break;default:throw new Error("Unsupported gesture state encountered during multitap: ".concat(u.matchedId))}o.tapIndex=a(1);var y=o.multitaps[o.tapIndex];s();var I=t.keyEventFromSpec(y);I.baseTranscriptionToken=o.baseContextToken;var Q=u.sources[0].currentSample,U=t.getSimpleTapCorrectionDistances(Q,o.baseKey.key.spec);if(Q.stateToken!=t.layerId&&!u.matchedId.includes("modipress")){var h=t.layerGroup.findNearestKey((0,d.__assign)((0,d.__assign)({},Q),{stateToken:t.layerId})),b=U.get(h.key.spec);b==null&&console.warn("Could not find current layer's key"),U.delete(h.key.spec),U.set(Q.item.key.spec,b)}I.keyDistribution=o.currentStageKeyDistribution(U),I.kNextLayer||(I.kNextLayer=o.originalLayer),t.raiseKeyEvent(I,null),u.matchedId=="modipress-multitap-start"&&l(u)};e.on("stage",B);var g=e.stageReports[0];g.matchedId=="modipress-start"&&l(e.stageReports[0]),s()}return c.prototype.currentStageKeyDistribution=function(e){var t=this,n=Rt(e),r=n.findIndex(function(I){return I.keySpec==t.baseKey.key.spec});if(r==-1)return Ue(this.baseKey)||console.warn("Could not find base key's probability for multitap correction"),n;for(var i=n.splice(r,1)[0].p,o=0,l=[],a=0;a<this.multitaps.length;a++){var s=this.multitaps[a],B=Math.abs(a-this.tapIndex)%this.multitaps.length,g=(a+this.multitaps.length-this.tapIndex)%this.multitaps.length,u=B<g?B:g,F=1/((1+u)*(1+u));o+=F,l.push({keySpec:s,p:F})}var y=i/o;return l.forEach(function(I){I.p=y*I.p}),n.concat(l).sort(function(I,Q){return Q.p-I.p})},c.prototype.cancel=function(){this.clear(),this.sequence.cancel()},c.prototype.clear=function(){},c}(),oi=El;var pe=1.4142,or=function(c){return Math.abs(c)<1e-10?0:c},li=function(c){(0,d.__extends)(e,c);function e(t,n,r,i){var o,l=c.call(this)||this;l.flickPreviews=new Map,l.orientation="top";var a=t.key.spec,s=l.flickEdgeLength=Math.max(r,i),B=l.div=document.createElement("div");B.className=B.id="kmw-gesture-preview",B.style.pointerEvents="none";var g=l.previewImgContainer=document.createElement("div");l.previewImgContainer.id="kmw-preview-img-container";var u=l.label=document.createElement("span");if(u.className="kmw-gesture-base-label kmw-key-text",u.id="kmw-gesture-base-label",g.appendChild(u),u.textContent=t.key.label.textContent,l.div.appendChild(l.previewImgContainer),a.flick){var F=a.flick||{};Object.keys(F).forEach(function(I){var Q=document.createElement("div");Q.className="kmw-flick-preview kmw-key-text",Q.textContent=F[I].text;var U=Q.style,h=_n.get(I),b=or(-Math.sin(h[0])),p=or(Math.cos(h[0]));U.width="100%",U.textAlign="center",b<0?U.right=-b*pe*s+"px":b>0?U.left=b*pe*s+"px":U.left="0px",U.height="100%",U.lineHeight="100%",p<0?U.bottom=-p*pe*s+"px":p>0?U.top=p*pe*s+"px":U.top="0px",l.flickPreviews.set(I,Q),g.appendChild(Q)})}var y=l.hintLabel=document.createElement("div");return y.className="kmw-key-popup-icon",n||(y.textContent=a==a.hintSrc?a.hint:(o=a.hintSrc)===null||o===void 0?void 0:o.text,y.style.fontWeight=y.textContent=="\u2022"?"bold":""),B.appendChild(y),l}return Object.defineProperty(e.prototype,"element",{get:function(){return this.div},enumerable:!1,configurable:!0}),e.prototype.refreshLayout=function(){var t=getComputedStyle(this.div),n=Number.parseInt(t.height,10);this.flickPreviews.forEach(function(r){r.style.lineHeight=r.style.height="".concat(n,"px")})},e.prototype.cancel=function(){var t;(t=this.onCancel)===null||t===void 0||t.call(this),this.onCancel=null},e.prototype.setCancellationHandler=function(t){this.onCancel=t},e.prototype.setMultitapHint=function(t,n,r){var i,o,l=zt(t.text,r),a=zt(n.text,r);this.label.textContent=l,this.hintLabel.textContent=a,this.label.style.fontFamily=l!=t.text?"SpecialOSK":(i=t.font)!==null&&i!==void 0?i:this.label.style.fontFamily,this.hintLabel.style.fontFamily=a!=n.text?"SpecialOSK":(o=n.font)!==null&&o!==void 0?o:this.hintLabel.style.fontFamily,this.emit("startFade"),this.clearFlick()},e.prototype.scrollFlickPreview=function(t,n){this.clearHint();var r=this.previewImgContainer.style,i=this.flickEdgeLength*pe;r.marginLeft="".concat(i*t,"px"),r.marginTop="".concat(i*n,"px");var o=or(n)<0?"bottom":"top";this.orientation!=o&&(this.orientation=o,this.emit("preferredOrientation",o))},e.prototype.clearFlick=function(){this.previewImgContainer.style.marginTop="0px",this.previewImgContainer.style.marginLeft="0px",this.previewImgContainer.classList.add("kmw-flick-clear")},e.prototype.clearHint=function(){this.hintLabel.classList.add("kmw-hint-clear")},e.prototype.clearAll=function(){this.clearFlick()},e}(v.default);var ai=St.TIER!="stable"||St.VERSION_ENVIRONMENT!="",Ol=ai?10:0,Yl=function(c){(0,d.__extends)(e,c);function e(t){var n,r,i=c.call(this)||this;i.gestureParams=(0,d.__assign)({},qn),i.layerLocked=!1,i.layerIndex=0,i.isStatic=!1,i._fixedWidthScaling=!1,i._fixedHeightScaling=!0,i._borderWidth=0,i.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1},i.activeGestures=[],i.activeModipress=null,i.repeatDelete=function(){this.deleting&&(this.modelKeyClick(this.deleteKey),this.deleting=window.setTimeout(this.repeatDelete,100))}.bind(i),i.config=t,i.config.device=t.device||t.hostDevice,i.config.isEmbedded=t.isEmbedded||!1,t.isStatic&&(i.isStatic=t.isStatic),i._fixedWidthScaling=i.device.touchable&&!i.isStatic,i._fixedHeightScaling=i.device.touchable&&!i.isStatic;var o=document.createElement("div");i.config.styleSheetManager=t.styleSheetManager||new yt(o);var l;if(t.keyboard)l=i.kbdLayout=t.keyboard.layout(t.device.formFactor),i.layoutKeyboardProperties=t.keyboardMetadata,i.isRTL=t.keyboard.isRTL;else{var a=w.buildDefaultLayout(null,null,t.device.formFactor);l=i.kbdLayout=We.polyfill(a,null,t.device.formFactor),i.layoutKeyboardProperties=null,i.isRTL=!1}"font"in l?i.fontFamily=l.font:i.fontFamily="";var s=t.device.formFactor;i.layoutKeyboard=t.keyboard,i.layoutKeyboard||(i.layoutKeyboard=new j(null)),i.layerGroup=new jc(i,i.layoutKeyboard,s),i.layoutKeyboard.markLayoutCalibrated(s),o.appendChild(i.layerGroup.element),i.kbdDiv=o,i.isStatic||(i.gestureEngine=i.constructGestureEngine()),o.classList.add(t.device.formFactor,"kmw-osk-inner-frame");var B=(r=(n=i.layoutKeyboard)===null||n===void 0?void 0:n.id.replace("Keyboard_",""))!==null&&r!==void 0?r:"",g=B.indexOf("::");g!=-1&&(B=B.substring(g+2));var u="kmw-keyboard-"+B;return i.element.classList.add(u),i}return Object.defineProperty(e.prototype,"layerId",{get:function(){var t,n;return(n=(t=this.layerGroup)===null||t===void 0?void 0:t.activeLayerId)!==null&&n!==void 0?n:"default"},set:function(t){var n=t!=this.layerId;if(this.layerGroup.getLayer(t))this.layerGroup.activeLayerId=t,this.gestureEngine&&(this.gestureEngine.stateToken=t);else throw new Error("Keyboard ".concat(this.layoutKeyboard.id," does not have a layer with id ").concat(t));n&&!this.deferLayout&&(this.updateState(),this.layerGroup.refreshLayout(this.constructLayoutParams()))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentLayer",{get:function(){var t;return(t=this.layerGroup)===null||t===void 0?void 0:t.activeLayer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lgKey",{get:function(){var t,n;return(n=(t=this.currentLayer)===null||t===void 0?void 0:t.globeKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hkKey",{get:function(){var t,n;return(n=(t=this.currentLayer)===null||t===void 0?void 0:t.hideKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"spaceBar",{get:function(){var t,n;return(n=(t=this.currentLayer)===null||t===void 0?void 0:t.spaceBarKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),e.prototype.constructGestureEngine=function(){var t=this,n={targetRoot:this.element,mouseEventRoot:document.body,maxRoamingBounds:new Ut(this.topContainer,[NaN]),itemIdentifier:function(a,s){return t.layerGroup.findNearestKey(a)},recordingMode:ai,historyLength:Ol};this.gestureParams.longpress.permitsFlick=function(a){var s=a==null?void 0:a.key.spec.flick;return!s||!(s.n||s.nw||s.ne)};var r=new Qe($n(this.kbdLayout,this.gestureParams),n);r.stateToken=this.layerId;var i={},o=function(a){var s,B;try{for(var g=(0,d.__values)(Object.keys(i)),u=g.next();!u.done;u=g.next()){var F=u.value;if(F!=a){var y=i[F];y.source.terminate(!0)}}}catch(I){s={error:I}}finally{try{u&&!u.done&&(B=g.return)&&B.call(g)}finally{if(s)throw s.error}}},l=new Map;return r.on("inputstart",function(a){var s,B=t.highlightKey(a.currentSample.item,!0);B&&((s=t.gesturePreviewHost)===null||s===void 0||s.cancel(),t.gesturePreviewHost=B),i[a.identifier]={source:a,roamingHighlightHandler:null,key:a.currentSample.item,previewHost:B};var g=i[a.identifier],u=function(){gt(0).then(function(){var F=g.previewHost;F&&(F.cancel(),t.gesturePreviewHost=null,g.previewHost=null),g.key&&(t.highlightKey(g.key,!1),g.key=null)})};g.roamingHighlightHandler=function(F){var y,I=F.item,Q=i[a.identifier].key;if(!t.kbdLayout.hasFlicks&&I!=Q){t.highlightKey(Q,!1),(y=t.gesturePreviewHost)===null||y===void 0||y.cancel(),t.gesturePreviewHost=null,g.previewHost=null;var U=t.highlightKey(I,!0);U&&(t.gesturePreviewHost=U,g.previewHost=U),i[a.identifier].key=I}},a.path.on("invalidated",u),a.path.on("complete",u),a.path.on("step",g.roamingHighlightHandler)}),r.on("recognizedgesture",function(a){var s;(s=t.activeModipress)===null||s===void 0||s.setLocked(),a.on("complete",function(){var B,g,u;try{for(var F=(0,d.__values)(a.allSourceIds),y=F.next();!y.done;y=F.next()){var I=y.value;!((u=i[I])===null||u===void 0)&&u.previewHost&&(t.gesturePreviewHost=null,i[I].previewHost.cancel()),delete i[I]}}catch(Q){B={error:Q}}finally{try{y&&!y.done&&(g=F.return)&&g.call(F)}finally{if(B)throw B.error}}}),a.on("stage",function(B,g){var u,F,y=a.allSourceIds.map(function(W){var R;return(R=i[W])===null||R===void 0?void 0:R.previewHost}).find(function(W){return!!W}),I=function(){y&&(y.cancel(),t.gesturePreviewHost=null)},Q=l.get(a);!Q&&y&&!B.matchedId.includes("flick")&&y.clearFlick();var U,h=function(W){var R=function(k){k.key&&(t.highlightKey(k.key,!1),k.key=null),k.source.path.off("step",k.roamingHighlightHandler)};if(U=i[W],U)R(U);else{var A=W;gt(0).then(function(){var k=i[A];k&&R(k)})}};try{for(var b=(0,d.__values)(B.allSourceIds),p=b.next();!p.done;p=b.next()){var X=p.value;h(X)}}catch(W){u={error:W}}finally{try{p&&!p.done&&(F=b.return)&&F.call(b)}finally{if(u)throw u.error}}var x=B.item,m=B.sources[0],J=m?m.currentSample:null,V=null;if(x&&!(Q&&Q[0].directlyEmitsKeys)){var G=void 0,S=t.getSimpleTapCorrectionDistances(m.currentSample,x.key.spec);Q&&(G=Q[0].currentStageKeyDistribution(S)),G||(G=Rt(S));var T=!t.layerLocked&&Q&&Q[0]instanceof ir&&Q[0].shouldLockLayer;try{T&&t.lockLayer(!0),V=t.modelKeyClick(B.item,J,G)}finally{T&&t.lockLayer(!1)}}if(!(a.stageReports.length>1&&B.matchedId!="modipress-end")){var H=a.stageReports[0].item;if(B.matchedId=="special-key-start")x.key.spec.baseKeyID=="K_BKSP"?(I(),Q=[new ei(a,function(){return t.modelKeyClick(x,J)})]):x.key.spec.baseKeyID=="K_LOPT"&&(a.on("complete",function(){x.key.highlight(!1),t.emit("globekey",x,!1)}),o(m.identifier),x.key.highlight(!0));else if(B.matchedId.indexOf("longpress")>-1)I(),Q=[new ir(a,g,t,a.stageReports[0].sources[0].baseItem,t.gestureParams)];else if(H!=null&&H.key.spec.multitap&&(B.matchedId=="initial-tap"||B.matchedId=="multitap"||B.matchedId=="modipress-start"))U.previewHost=null,a.on("complete",function(){I()}),Q=[new oi(a,t,H,V.contextToken,y)];else if(B.matchedId.indexOf("flick")>-1)Q=[new Vc(a,g,t,a.stageReports[0].sources[0].baseItem,t.gestureParams,y)];else if(B.matchedId.includes("modipress")&&B.matchedId.includes("-start"))if(I(),t.layerLocked)console.warn("Unexpected state:  modipress start attempt during an active modipress");else{Q||(Q=[]);var E=new Ce(a,t,function(){var W=Q.indexOf(E);W>-1&&Q.splice(W,1),t.activeModipress=null});Q.push(E),t.activeModipress=E}else I();Q&&(t.activeGestures=t.activeGestures.concat(Q),l.set(a,Q),a.on("complete",function(){var W=t.activeGestures.filter(function(R){return Q.includes(R)});t.activeGestures=t.activeGestures.filter(function(R){return!Q.includes(R)}),W.forEach(function(R){R instanceof Ce&&R.cancel()})}))}})}),r},Object.defineProperty(e.prototype,"element",{get:function(){return this.kbdDiv},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"device",{get:function(){return this.config.device},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hostDevice",{get:function(){return this.config.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontRootPath",{get:function(){return this.config.pathConfig.fonts},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"styleSheetManager",{get:function(){return this.config.styleSheetManager},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topContainer",{get:function(){return this.config.topContainer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmbedded",{get:function(){return this.config.isEmbedded},enumerable:!1,configurable:!0}),e.prototype.postInsert=function(){},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layoutWidth",{get:function(){if(this.usesFixedWidthScaling){var t=this.width;return t-=this._borderWidth*2,Z.inPixels(t)}else return Z.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layoutHeight",{get:function(){if(this.usesFixedHeightScaling){var t=this.height;return t-=this._borderWidth*2,Z.inPixels(t)}else return Z.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"internalHeight",{get:function(){return this.usesFixedHeightScaling?Z.inPixels(this.layoutHeight.val-this._borderWidth*2-this.layerGroup.verticalPadding):Z.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize||(this._fontSize=new Z("1em")),this._fontSize},set:function(t){this._fontSize=t,this.kbdDiv.style.fontSize=t.styleString},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"usesFixedWidthScaling",{get:function(){return this._fixedWidthScaling},set:function(t){this._fixedWidthScaling=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"usesFixedHeightScaling",{get:function(){return this._fixedHeightScaling},set:function(t){this._fixedHeightScaling=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"usesFixedPositioning",{get:function(){for(var t=this.element;t;){if(getComputedStyle(t).position=="fixed")return!0;t=t.offsetParent}return!1},enumerable:!1,configurable:!0}),e.prototype.setSize=function(t,n,r){this._width=t,this._height=n,this.kbdDiv&&(this.kbdDiv.style.width=t?this._width+"px":"",this.kbdDiv.style.height=n?this._height+"px":"",!this.device.touchable&&n&&(this.fontSize=new Z(this._height/8+"px")),r||this.refreshLayout())},e.prototype.getTouchCoordinatesOnKeyboard=function(t){var n={x:t.targetX,y:t.targetY};return n.x/=this.layerGroup.element.offsetWidth,n.y/=this.kbdDiv.offsetHeight,n},e.prototype.getSimpleTapCorrectionDistances=function(t,n){var r=this.getTouchCoordinatesOnKeyboard(t),i=this.layerGroup.element,o=i.offsetWidth,l=this.kbdDiv.offsetHeight;if(!o||!l)return new Map;var a=o/l,s=cc(this.kbdLayout.getLayer(this.layerId),a);return He(r,s)},e.prototype.keyTarget=function(t){var n=t;try{if(n){if(n.classList.contains("kmw-key"))return qe(n);if(n.parentNode&&n.parentNode.classList.contains("kmw-key"))return qe(n.parentNode);if(n.firstChild&&n.firstChild.classList.contains("kmw-key"))return qe(n.firstChild)}}catch(r){}return null},e.prototype.cancelDelete=function(){this.deleting&&window.clearTimeout(this.deleting),this.deleting=0},e.prototype.modelKeyClick=function(t,n,r){var i=this.initKeyEvent(t);return n&&(i.source=n),r&&(i.keyDistribution=r),this.raiseKeyEvent(i,t)},e.prototype.initKeyEvent=function(t){this.highlightKey(t,!1);var n=t.key?t.key.spec:null;return n?this.keyEventFromSpec(n):null},e.prototype.keyEventFromSpec=function(t){var n=this.layoutKeyboard.constructKeyEvent(t,this.device,this.stateKeys);return n.srcKeyboard=this.layoutKeyboard,n},e.prototype._UpdateVKShiftStyle=function(t){var n,r;t||(t=this.layerId);var i=this.layerGroup.getLayer(t);if(i&&(this.gestureEngine&&(this.gestureEngine.stateToken=t),!!(!((n=this.layoutKeyboard)===null||n===void 0)&&n.usesDesktopLayoutOnDevice(this.device)))){var o=["K_CAPS","K_NUMLOCK","K_SCROLL"],l=[i.capsKey,i.numKey,i.scrollKey];for(r=0;r<l.length;r++)l[r]!=null&&l[r].setToggleState(this.stateKeys[o[r]])}},e.prototype.updateStateKeys=function(t){var n,r;try{for(var i=(0,d.__values)(Object.keys(this.stateKeys)),o=i.next();!o.done;o=i.next()){var l=o.value;this.stateKeys[l]=t[l]}}catch(a){n={error:a}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}this._UpdateVKShiftStyle()},e.prototype.highlightKey=function(t,n){if(!t||!t.key||t.className==""||t.className.indexOf("kmw-key-row")>=0)return null;var r=t.key.allowsKeyTip(),i=this.activeGestures.find(function(o){return o.hasModalVisualization});return n=i?!1:n,t.key.highlight(n),n&&r?this.gesturePreviewHost?null:this.showGesturePreview(t):null},e.prototype.getKeyEmFontSize=function(){if(!this.fontSize)return new Z("0px");if(this.device.formFactor=="desktop"){var t=.8;return this.fontSize.scaledBy(t)}else{var n=getComputedStyle(document.body).fontSize,r=new Z(n),i=1;if(!this.isStatic){if(this.fontSize.absolute)return this.fontSize;i=this.fontSize.val}return r.scaledBy(i)}},e.prototype.updateState=function(){this.currentLayer&&(this.nextLayer=this.layerId,this.currentLayer.nextlayer&&(this.nextLayer=this.currentLayer.nextlayer),this.layerGroup.activeLayerId=this.layerId,this._UpdateVKShiftStyle())},e.prototype.refreshLayout=function(){if(!this.deferLayout){var t=this.device,n=1;t.OS==f.OperatingSystem.iOS&&!this.isEmbedded&&(n=n/ht(this.device.formFactor));var r=this.kbdDiv.style;this.usesFixedHeightScaling&&this.height&&(r.height=r.maxHeight=this.height+"px"),r.fontSize=this.fontSize.scaledBy(n).styleString;var i=this.width&&this.height,o=getComputedStyle(this.kbdDiv),l=getComputedStyle(this.layerGroup.element),a=o.height!=""&&o.height!="auto";if(o.border&&(this._borderWidth=new Z(o.borderWidth).val),i)this._computedWidth=this.width,this._computedHeight=this.height;else if(a)this._computedWidth=parseInt(o.width,10),this._computedWidth||(this._computedWidth=parseInt(l.width,10)),this._computedHeight=parseInt(o.height,10);else return;if(this.layerGroup.refreshLayout(this.constructLayoutParams()),!this.isStatic){var s=this.gestureEngine.config.maxRoamingBounds;s.updatePadding([-.333*this.currentLayer.rowHeight]),this.gestureParams.longpress.flickDistStart=.24*this.currentLayer.rowHeight,this.gestureParams.flick.startDist=.3*this.currentLayer.rowHeight,this.gestureParams.flick.dirLockDist=.35*this.currentLayer.rowHeight,this.gestureParams.flick.triggerDist=.75*this.currentLayer.rowHeight,this.gestureParams.longpress.flickDistFinal=.75*this.currentLayer.rowHeight}}},e.prototype.constructLayoutParams=function(){var t,n;return{keyboardWidth:this._computedWidth-2*this._borderWidth,keyboardHeight:this._computedHeight-2*this._borderWidth-this.layerGroup.verticalPadding,widthStyle:this.layoutWidth,heightStyle:this.internalHeight,baseEmFontSize:this.getKeyEmFontSize(),layoutFontSize:new Z(this.layerGroup.element.style.fontSize),spacebarText:(n=(t=this.layoutKeyboardProperties)===null||t===void 0?void 0:t.displayName)!==null&&n!==void 0?n:"(System keyboard)"}},e.prototype.computedAdjustedOskHeight=function(t){if(!this.layerGroup)return t;var n=this.layerGroup.spec.layer,r=0;for(var i in n){var o=n[i],l=o.row.length,a=Math.floor(t/(l==0?1:l)),s=l*a;s>r&&(r=s)}var B=0,g=r+B;return g},e.prototype.appendStyleSheet=function(){var t=this,n=this.layoutKeyboard,r=this.layoutKeyboardProperties;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet);var i=r==null?void 0:r.textFont,o=r==null?void 0:r.oskFont;this.styleSheetManager.addStyleSheetForFont(i,this.fontRootPath,this.device.OS),this.styleSheetManager.addStyleSheetForFont(o,this.fontRootPath,this.device.OS),this.config.specialFont&&this.styleSheetManager.addStyleSheetForFont(this.config.specialFont,"",this.device.OS);var l=this.addFontStyle(i,o);n!=null&&typeof n.oskStyling=="string"&&(l=l+n.oskStyling),l&&(this.styleSheet=Lt(l),this.styleSheetManager.linkStylesheet(this.styleSheet)),this.styleSheetManager.allLoadedPromise().then(function(){t.layerGroup.resetPrecalcFontSizes(),t.refreshLayout()})},e.prototype.addFontStyle=function(t,n){var r="",i=function(o){return o.family.replace(/\u0022/g,"").replace(/,/g,'","')};return(t||n)&&(r='\n.kmw-key-text {\n  font-family: "'.concat(i(n||t),'";\n}\n\n.kmw-suggestion-text {\n  font-family: "').concat(i(t||n),'";\n}\n')),r},e.buildDocumentationKeyboard=function(t,n,r,i,o,l){var a,s,B=this;if(!t)return null;var g=typeof i=="undefined"?"desktop":i,u=typeof o=="undefined"?"default":o,F={};F.formFactor=g,g!="desktop"?(F.OS=f.OperatingSystem.iOS,F.touchable=!0):(F.OS=f.OperatingSystem.Windows,F.touchable=!1);var y=t.layout(g),I=new f("other",F.formFactor,F.OS,F.touchable),Q=new e({keyboard:t,keyboardMetadata:n,hostDevice:I,isStatic:!0,topContainer:null,pathConfig:r,styleSheetManager:null,specialFont:{family:"SpecialOSK",files:["".concat(r.resources,"/osk/keymanweb-osk.ttf")],path:""}});Q.layerGroup.element.className=Q.kbdDiv.className,Q.layerGroup.element.classList.add(F.formFactor+"-static");var U=Q.kbdDiv.childNodes[0],h=document.createElement("div");h.classList.add(F.OS.toLowerCase(),F.formFactor),y!=null?(Q.layerId=u,Q.layerGroup.activeLayerId=u,Q.setSize(800,l),Q.fontSize=Nc(I,l,!1),h.style.fontSize=Q.element.style.fontSize,Q.refreshLayout(),U.style.height=Q.kbdDiv.style.height,U.style.maxHeight=Q.kbdDiv.style.maxHeight):U.innerHTML="<p style='color:#c40; font-size:0.5em;margin:10px;'>No "+g+" layout is defined for "+t.name+".</p>",U.style.border="1px solid #ccc",Q.updateState();var b=function(){return(0,d.__awaiter)(B,void 0,void 0,function(){var G,S,T,H,E,W,R;return(0,d.__generator)(this,function(A){switch(A.label){case 0:if(!document.contains(U))return[3,4];A.label=1;case 1:return A.trys.push([1,,3,4]),[4,Q.styleSheetManager.allLoadedPromise()];case 2:A.sent(),G=Q.styleSheet,G&&U.appendChild(G),S=[].concat(Q.styleSheetManager.sheets);try{for(T=(0,d.__values)(S),H=T.next();!H.done;H=T.next())E=H.value,E!=G&&(E.href||(Q.styleSheetManager.unlink(E),document.head.appendChild(E)))}catch(k){W={error:k}}finally{try{H&&!H.done&&(R=T.return)&&R.call(T)}finally{if(W)throw W.error}}return Q.refreshLayout(),Q.styleSheet=null,Q.shutdown(),[3,4];case 3:return p.disconnect(),[7];case 4:return[2]}})})},p=new MutationObserver(b);p.observe(document.body,{childList:!0,subtree:!0}),h.append(U);try{for(var X=(0,d.__values)(ft.STYLESHEET_FILES),x=X.next();!x.done;x=X.next()){var m=x.value,J="".concat(r.resources,"/osk/").concat(m),V=Q.styleSheetManager.linkExternalSheet(J,!0);V.parentNode.removeChild(V),h.appendChild(V)}}catch(G){a={error:G}}finally{try{x&&!x.done&&(s=X.return)&&s.call(X)}finally{if(a)throw a.error}}return Q.appendStyleSheet(),h},e.prototype.onHide=function(){this.hkKey&&this.highlightKey(this.hkKey,!1)},e.prototype.optionKey=function(t,n,r){n.indexOf("K_LOPT")>=0?this.emit("globekey",t,r):n.indexOf("K_ROPT")>=0&&r&&this.emit("hiderequested",t)},e.prototype.showGesturePreview=function(t){var n=this.keytip,r=this.constructLayoutParams(),i=r.keyboardWidth*t.key.spec.proportionalWidth,o=r.keyboardHeight/this.currentLayer.rows.length,l=new li(t,this.device.formFactor=="phone",i,o);if(n==null){var a=t.key;a.setPreview(l)}else n.show(t,!0,l);return l.refreshLayout(),l},e.prototype.createKeyTip=function(){if(this.keytip==null)if(this.device.formFactor=="phone"){var t=this.isEmbedded;this.keytip=new $c(this,t)}else this.keytip=new ti(this);this.keytip&&this.keytip.element&&this.element.appendChild(this.keytip.element)},e.prototype.createGlobeHint=function(){return this.config.embeddedGestureConfig.createGlobeHint?this.config.embeddedGestureConfig.createGlobeHint(this):null},e.prototype.shutdown=function(){var t;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet),this.activeGestures.forEach(function(n){return n.cancel()}),this.gestureEngine&&this.gestureEngine.destroy(),this.deleting&&window.clearTimeout(this.deleting),(t=this.keytip)===null||t===void 0||t.show(null,!1,null)},e.prototype.lockLayer=function(t){this.layerLocked=t},e.prototype.raiseKeyEvent=function(t,n){if(t.kName=="K_LOPT"||t.kName=="K_ROPT")return this.optionKey(n,t.kName,!0),{};var r={},i=function(o,l){var a,s;r.contextToken=(a=o==null?void 0:o.transcription)===null||a===void 0?void 0:a.token;var B=(s=o==null?void 0:o.transcription)===null||s===void 0?void 0:s.transform;r.alteredText=o&&(!B||Yt(B))};return this.layerLocked&&(t.kNextLayer=this.layerId),this.emit("keyevent",t,i),r},e.specialCharacters=Nt.specialCharacters,e}(v.default),vt=Yl;var si=function(c){(0,d.__extends)(e,c);function e(){return c!==null&&c.apply(this,arguments)||this}return e}(v.default),Ge=si,me=function(c){(0,d.__extends)(e,c);function e(){return c!==null&&c.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"enabled",{get:function(){return!0},set:function(t){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activate",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conditionsMet",{get:function(){return!0},enumerable:!1,configurable:!0}),e}(si);var wl=function(){function c(){this.map=new Map}return c.prototype.promiseForTouchpoint=function(e){return this.map.get(e)||this.map.set(e,new L),this.map.get(e)},c.prototype.maintainTouches=function(e){for(var t,n,r=Array.from(this.map.keys()),i=0;i<e.length;i++){var o=r.indexOf(e.item(i).identifier);o!=-1&&r.splice(o,1)}try{for(var l=(0,d.__values)(r),a=l.next();!a.done;a=l.next()){var s=a.value;this.map.get(s).resolve(),this.map.delete(s)}}catch(B){t={error:B}}finally{try{a&&!a.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}},c}(),Bi=wl;function di(c){var e="osk/";return c.isEmbedded&&(e=""),"".concat(c.pathConfig.resources,"/").concat(e)}var zl=function(c){(0,d.__extends)(e,c);function e(t){var n,r,i,o=c.call(this)||this;o.legacyEvents=new Te,o.needsLayout=!0,o.touchEventPromiseManager=new Bi,o.activationListener=function(F){if(!o.mayDisable&&!o.activationModel.enabled){o.activationModel.off("activate",o.activationListener);try{o.activationModel.enabled=!0}finally{o.activationModel.on("activate",o.activationListener)}}o.commonCheckAndDisplay()},o.layerChangeHandler=function(F,y){var I,Q;return o.vkbd&&o.vkbd._UpdateVKShiftStyle(y),(o.vkbd&&o.vkbd.layerId!=y||F.value!=y)&&!((I=o.vkbd)===null||I===void 0)&&I.layerGroup.getLayer(y)&&!(!((Q=o.vkbd)===null||Q===void 0)&&Q.layerLocked)&&(o.vkbd.layerId=y),!1},o._Visible=!1,o.config=t=(0,d.__assign)({},t),o.config.allowHideAnimations===void 0&&(o.config.allowHideAnimations=!0),o.config.device=t.device||t.hostDevice,o.config.isEmbedded=t.isEmbedded||!1,o.config.embeddedGestureConfig=t.embeddedGestureConfig||{},o.config.activator.on("activate",o.activationListener),o._Box=N("div"),o.kbdStyleSheetManager=new yt(o._Box,o.config.doCacheBusting||!1),o.uiStyleSheetManager=new yt(o._Box),o.bannerView=new dc,o.bannerView.events.on("bannerchange",function(){return o.refreshLayout()}),o._Box.appendChild(o.bannerView.element),o._bannerController=new nr(o.bannerView,o.hostDevice,o.config.predictionContextManager),o.keyboardView=new be,o._Box.appendChild(o.keyboardView.element);var l=di(o.config);try{for(var a=(0,d.__values)(e.STYLESHEET_FILES),s=a.next();!s.done;s=a.next()){var B=s.value,g="".concat(l).concat(B);o.uiStyleSheetManager.linkExternalSheet(g)}}catch(F){n={error:F}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}o.activeKeyboard=o.config.keyboardToActivate;var u=(i=o.config.predictionContextManager)===null||i===void 0?void 0:i.modelState;return u&&o.bannerController.selectBanner(u),o.setBaseMouseEventListeners(),o.hostDevice.touchable&&o.setBaseTouchEventListeners(),o._Box.style.display="none",o.initialized=!0,o}return Object.defineProperty(e.prototype,"keyCodes",{get:function(){return C.keyCodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"modifierCodes",{get:function(){return C.modifierCodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"modifierBitmasks",{get:function(){return C.modifierBitmasks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stateBitmasks",{get:function(){return C.stateBitmasks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"configuration",{get:function(){return this.config},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bannerController",{get:function(){return this._bannerController},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hostDevice",{get:function(){return this.config.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontRootPath",{get:function(){return this.config.pathConfig.fonts},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmbedded",{get:function(){return this.config.isEmbedded},enumerable:!1,configurable:!0}),e.prototype.setBaseMouseEventListeners=function(){var t=this;this._Box.onmouseenter=function(n){t.mouseEnterPromise&&t.mouseEnterPromise.resolve(),t.mouseEnterPromise=new L,t.emit("pointerinteraction",t.mouseEnterPromise.corePromise)},this._Box.onmouseleave=function(n){t.mouseEnterPromise.resolve(),t.mouseEnterPromise=null}},e.prototype.removeBaseMouseEventListeners=function(){this._Box.onmouseenter=null,this._Box.onmouseleave=null},e.prototype.setBaseTouchEventListeners=function(){var t=this,n=function(r){return r.cancelable&&r.preventDefault(),r.stopPropagation(),!1};this._boxBaseTouchEventCancel=function(r){return t.touchEventPromiseManager.maintainTouches(r.touches),n(r)},this._boxBaseTouchStart=function(r){for(var i=0;i<r.changedTouches.length;i++){var o=t.touchEventPromiseManager.promiseForTouchpoint(r.changedTouches[i].identifier);t.emit("pointerinteraction",o.corePromise)}return t.touchEventPromiseManager.maintainTouches(r.touches),n(r)},this._Box.addEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.addEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchcancel",this._boxBaseTouchEventCancel,!1)},e.prototype.removeBaseTouchEventListeners=function(){this._boxBaseTouchEventCancel&&(this._Box.removeEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.removeEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchcancel",this._boxBaseTouchEventCancel,!1),this._boxBaseTouchEventCancel=null,this._boxBaseTouchStart=null)},Object.defineProperty(e.prototype,"targetDevice",{get:function(){return this.config.device},set:function(t){this.allowsDeviceChange(t)?(this.config.device=t,this.loadActiveKeyboard()):console.error("May not change target device for this OSKView type.")},enumerable:!1,configurable:!0}),e.prototype.allowsDeviceChange=function(t){return!1},Object.defineProperty(e.prototype,"activationModel",{get:function(){return this.config.activator},set:function(t){if(!t)throw new Error("The activation model may not be set to null or undefined!");this.config.activator.off("activate",this.activationListener),t.on("activate",this.activationListener),this.config.activator=t,this.commonCheckAndDisplay()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mayDisable",{get:function(){var t;return!(this.hostDevice.touchable||!((t=this.activeKeyboard)===null||t===void 0)&&t.keyboard.isCJK)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displayIfActive",{get:function(){return this.activationModel.enabled},enumerable:!1,configurable:!0}),e.prototype.commonCheckAndDisplay=function(){this.activationModel.activate&&this.activeKeyboard?this.present():this.startHide(!1)},Object.defineProperty(e.prototype,"vkbd",{get:function(){return this.keyboardView instanceof vt?this.keyboardView:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"banner",{get:function(){return this.bannerView},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"computedWidth",{get:function(){return this.needsLayout&&this.refreshLayout(),this._computedWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"computedHeight",{get:function(){return this.needsLayout&&this.refreshLayout(),this._computedHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"baseFontSize",{get:function(){var t;return((t=this.parsedBaseFontSize)===null||t===void 0?void 0:t.styleString)||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parsedBaseFontSize",{get:function(){return this._baseFontSize||(this._baseFontSize=e.defaultFontSize(this.targetDevice,this.computedHeight,this.isEmbedded)),this._baseFontSize},enumerable:!1,configurable:!0}),e.defaultFontSize=function(t,n,r){if(t.touchable){var i=t.formFactor=="phone"?1.6*(r?.65:.6)*1.2:2;return Z.special(i,"em")}else return n?Z.inPixels(n/8):void 0},Object.defineProperty(e.prototype,"activeKeyboard",{get:function(){return this.keyboardData},set:function(t){var n,r,i;this.initialized&&((n=this.keyboardData)===null||n===void 0?void 0:n.keyboard)==(t==null?void 0:t.keyboard)&&((r=this.keyboardData)===null||r===void 0?void 0:r.metadata)==(t==null?void 0:t.metadata)||(this.keyboardData=t,this.loadActiveKeyboard(),!((i=this.keyboardData)===null||i===void 0)&&i.keyboard.isCJK&&(this.activationModel.enabled=!0))},enumerable:!1,configurable:!0}),e.prototype.computeFrameHeight=function(){var t,n;return(((t=this.headerView)===null||t===void 0?void 0:t.layoutHeight.val)||0)+(((n=this.footerView)===null||n===void 0?void 0:n.layoutHeight.val)||0)},e.prototype.setSize=function(t,n,r){var i=!1,o,l;!t&&t!==0||!n&&n!==0||(Number.isFinite(t)?o=Z.inPixels(t):o=new Z(t),Number.isFinite(n)?l=Z.inPixels(n):l=new Z(n),t&&n&&(i=!this._width||!this._height,i=i||o.styleString!=this._width.styleString,i=i||l.styleString!=this._height.styleString,this._width=o,this._height=l),this.needsLayout=this.needsLayout||i,this.refreshLayoutIfNeeded(r))},e.prototype.setNeedsLayout=function(){this.needsLayout=!0},e.prototype.batchLayoutAfter=function(t){if(this.deferLayout){t();return}try{this.deferLayout=!0,this.vkbd&&(this.vkbd.deferLayout=!0),t()}finally{this.deferLayout=!1,this.vkbd&&(this.vkbd.deferLayout=!1),this.refreshLayout()}},e.prototype.refreshLayout=function(t){var n,r;if(!(!this.keyboardView||this.deferLayout)){var i=this.width&&this.height;if(i){var o=this.width.absolute&&this.height.absolute,l=getComputedStyle(this._Box),a=l.height!=""&&l.height!="auto";if(o)this._computedWidth=this.width.val,this._computedHeight=this.height.val;else if(a){var s=this._Box.parentElement;this._computedWidth=this.width.val*(this.width.absolute?1:s.offsetWidth),this._computedHeight=this.height.val*(this.height.absolute?1:s.offsetHeight)}else{console.warn("Unable to properly perform layout - specification uses a relative spec, thus relies upon insertion into the DOM for layout.");return}if(this.needsLayout=!1,this.banner.element.style.fontSize=this.baseFontSize,this.vkbd&&(this.vkbd.fontSize=this.parsedBaseFontSize),t||((n=this.headerView)===null||n===void 0||n.refreshLayout(),this.bannerView.width=this.computedWidth,this.bannerView.refreshLayout(),(r=this.footerView)===null||r===void 0||r.refreshLayout()),this.vkbd){var B=this.computedHeight-this.computeFrameHeight();this.bannerView.height>0&&(B-=this.bannerView.height+5),this.vkbd.setSize(this.computedWidth,B,t);var g=this._Box.style;g.width=g.maxWidth=this.computedWidth+"px",g.height=g.maxHeight=this.computedHeight+"px"}else{var g=this._Box.style;g.width="auto",g.height="auto",g.maxWidth=g.maxHeight=""}}}},e.prototype.refreshLayoutIfNeeded=function(t){this.needsLayout&&this.refreshLayout(t)},e.prototype.postKeyboardLoad=function(){this._Visible=!1,this.postKeyboardAdjustments(),this.displayIfActive&&this.present()},e.prototype.loadActiveKeyboard=function(){var t,n,r,i,o;this.setBoxStyling(),this.needsLayout=!0;var l=this.keyboardView,a=this.kbdStyleSheetManager;this.kbdStyleSheetManager=new yt(this._Box,this.config.doCacheBusting||!1);var s=this.keyboardView=this._GenerateKeyboardView((t=this.keyboardData)===null||t===void 0?void 0:t.keyboard,(n=this.keyboardData)===null||n===void 0?void 0:n.metadata);if(this._Box.replaceChild(s.element,l.element),s.postInsert(),(r=this.bannerController)===null||r===void 0||r.configureForKeyboard((i=this.keyboardData)===null||i===void 0?void 0:i.keyboard,(o=this.keyboardData)===null||o===void 0?void 0:o.metadata),l instanceof vt&&l.shutdown(),a.unlinkAll(),this.banner.appendStyles(),this.vkbd){this.vkbd.createKeyTip();var B=this.vkbd.createGlobeHint();B&&this._Box.appendChild(B.element),this.vkbd.appendStyleSheet()}this.postKeyboardLoad()},e.prototype._GenerateKeyboardView=function(t,n){var r=this.targetDevice;return this._Box.className="",t==null&&!r.touchable?new be:t&&t.layout(r.formFactor)?this._GenerateVisualKeyboard(t,n):!t||!n?this._GenerateVisualKeyboard(null,null):new Mc(t)},e.prototype._GenerateVisualKeyboard=function(t,n){var r=this,i=this.targetDevice,o=di(this.config),l=new vt({keyboard:t,keyboardMetadata:n,device:i,hostDevice:this.hostDevice,topContainer:this._Box,styleSheetManager:this.kbdStyleSheetManager,pathConfig:this.config.pathConfig,embeddedGestureConfig:this.config.embeddedGestureConfig,isEmbedded:this.config.isEmbedded,specialFont:{family:"SpecialOSK",files:["".concat(o,"/keymanweb-osk.ttf")],path:""}});return l.on("keyevent",function(a,s){return r.emit("keyevent",a,s)}),l.on("globekey",function(a,s){return r.emit("globekey",a,s)}),l.on("hiderequested",function(a){r.doHide(!0),r.emit("hiderequested",a)}),this._Box.className=i.formFactor+" "+i.OS.toLowerCase()+" kmw-osk-frame",l},e.prototype.present=function(){if(this.mayShow()){if(this.keyboardView.updateState(),this._Box.style.display="block",this.refreshLayoutIfNeeded(),this._Visible=!0,this._Box.style.opacity="1",this._Box.style.visibility=="hidden"){var t=this;window.setTimeout(function(){t._Box.style.visibility="visible"},0)}this.setDisplayPositioning()}},e.prototype.startHide=function(t){if(this.mayHide(t)){t&&(this.activationModel.enabled=!!(this.keyboardData.keyboard.isCJK||this.hostDevice.touchable));var n=null;this._Box&&this.hostDevice.touchable&&!(this.keyboardView instanceof be)&&this.config.allowHideAnimations?n=this.useHideAnimation():n=Promise.resolve(!0);var r=this;n.then(function(i){i&&r.finalizeHide()}),this.doHide(t)}},e.prototype.finalizeHide=function(){if(!(document.body.className.indexOf("osk-always-visible")>=0&&this.hostDevice.formFactor=="desktop")){if(this._Box){var t=this._Box.style;t.display="none",t.transition="",t.opacity="1",this._Visible=!1}this.vkbd&&this.vkbd.onHide()}},e.prototype.mayShow=function(){return!(!this.activationModel.conditionsMet||!this.keyboardView||this.keyboardView instanceof be||!this.activationModel.enabled||!this._Box)},e.prototype.mayHide=function(t){return!(this.activationModel.conditionsMet&&!this.mayDisable||this.activationModel instanceof me||!t&&this.hostDevice.formFactor=="desktop"&&document.body.className.indexOf("osk-always-visible")>=0)},e.prototype.useHideAnimation=function(){var t=this._Box.style,n=this;return new Promise(function(r){var i=function(){return n._Box.removeEventListener("transitionend",i,!1),n._Box.removeEventListener("webkitTransitionEnd",i,!1),n._Box.removeEventListener("transitioncancel",i,!1),n._Box.removeEventListener("webkitTransitionCancel",i,!1),n._animatedHideTimeout!=0&&window.clearTimeout(n._animatedHideTimeout),n._animatedHideTimeout=0,n._Visible&&n.activationModel.conditionsMet?(t.transition="",t.opacity="1",r(!1),!1):(r(!0),!0)},o=function(){n._Box.removeEventListener("transitionrun",o,!1),n._Box.removeEventListener("webkitTransitionRun",o,!1),n._Box.addEventListener("transitionend",i,!1),n._Box.addEventListener("webkitTransitionEnd",i,!1),n._Box.addEventListener("transitioncancel",i,!1),n._Box.addEventListener("webkitTransitionCancel",i,!1)};n._Box.addEventListener("transitionrun",o,!1),n._Box.addEventListener("webkitTransitionRun",o,!1),t.transition="opacity 0.5s linear 0",t.opacity="0",n._animatedHideTimeout=window.setTimeout(i,200)})},e.prototype.hideNow=function(){if(!(!this.mayHide(!1)||!this._Box)){this._animatedHideTimeout&&(window.clearTimeout(this._animatedHideTimeout),this._animatedHideTimeout=0);var t=this._Box.style;t.transition="",t.opacity="0",this.finalizeHide()}},e.prototype.shutdown=function(){this.removeBaseMouseEventListeners(),this.removeBaseTouchEventListeners();var t=this._Box;t.parentElement&&t.parentElement.removeChild(t),this.kbdStyleSheetManager.unlinkAll(),this.uiStyleSheetManager.unlinkAll(),this.bannerController.shutdown()},e.prototype.getRect=function(){var t={};return t.left=t.left=M(this._Box),t.top=t.top=D(this._Box),t.width=this.computedWidth,t.height=this.computedHeight,t},e.prototype.isEnabled=function(){return this.displayIfActive},e.prototype.isVisible=function(){return this._Visible},e.prototype.hide=function(){this.activationModel.enabled=!1,this.startHide(!0)},e.prototype.show=function(t){arguments.length>0?this.activationModel.enabled=t:this.activationModel.conditionsMet&&(this.activationModel.enabled=!this.activationModel.enabled)},e.prototype.doShow=function(t){this.legacyEvents.callEvent("show",t)},e.prototype.doHide=function(t){var n={HiddenByUser:t};this.legacyEvents.callEvent("hide",n)},e.prototype.addEventListener=function(t,n){this.legacyEvents.addEventListener(t,n)},e.prototype.removeEventListener=function(t,n){this.legacyEvents.removeEventListener(t,n)},e.STYLESHEET_FILES=["kmwosk.css","globe-hint.css"],e}(v.default),ft=zl;var Ml=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.mouseCancellingHandler=function(r){return r.preventDefault(),r.cancelBubble=!0,!1},n._element=n.buildTitleBar(),n.helpEnabled=!1,n.configEnabled=!1,t&&(n.element.onmousedown=t.mouseDownHandler),n}return Object.defineProperty(e.prototype,"helpEnabled",{get:function(){return this._helpEnabled},set:function(t){this._helpEnabled=t,this._helpButton.style.display=t?"inline":"none"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"configEnabled",{get:function(){return this._configEnabled},set:function(t){this._configEnabled=t,this._configButton.style.display=t?"inline":"none"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layoutHeight",{get:function(){return e.DISPLAY_HEIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),e.prototype.setPinCJKOffset=function(){this._unpinButton.style.left="15px"},e.prototype.showPin=function(t){this._unpinButton.style.display=t?"block":"none"},e.prototype.setTitle=function(t){this._caption.innerHTML=t},e.prototype.setTitleFromKeyboard=function(t){var n="<span style='font-weight:bold'>"+(t==null?void 0:t.name)+"</span>";this._caption.innerHTML=n},e.prototype.buildTitleBar=function(){var t=this,n=N("div");n.id="keymanweb_title_bar",n.className="kmw-title-bar";var r=this._caption=N("span");r.className="kmw-title-bar-caption",r.style.color="#fff",n.appendChild(r);var i=this._closeButton=this.buildCloseButton();return this._closeButton.onclick=function(){return t.emit("close"),!1},n.appendChild(i),i=this._helpButton=this.buildHelpButton(),this._helpButton.onclick=function(){return t.emit("help"),!1},n.appendChild(i),i=this._configButton=this.buildConfigButton(),this._configButton.onclick=function(){return t.emit("config"),!1},n.appendChild(i),i=this._unpinButton=this.buildUnpinButton(),this._unpinButton.onclick=function(){return t.emit("unpin"),!1},n.appendChild(i),n},e.prototype.buildCloseButton=function(){var t=N("div");return t.id="kmw-close-button",t.className="kmw-title-bar-image",t.onmousedown=this.mouseCancellingHandler,t},e.prototype.buildHelpButton=function(){var t=N("div");return t.id="kmw-help-image",t.className="kmw-title-bar-image",t.title="KeymanWeb Help",t.onmousedown=this.mouseCancellingHandler,t},e.prototype.buildConfigButton=function(){var t=N("div");return t.id="kmw-config-image",t.className="kmw-title-bar-image",t.title="KeymanWeb Configuration Options",t.onmousedown=this.mouseCancellingHandler,t},e.prototype.buildUnpinButton=function(){var t=N("div");return t.id="kmw-pin-image",t.className="kmw-title-bar-image",t.title="Pin the On Screen Keyboard to its default location on the active text box",t.onmousedown=this.mouseCancellingHandler,t},e.prototype.refreshLayout=function(){},e.DISPLAY_HEIGHT=Z.inPixels(20),e}(v.default),lr=Ml;var Dl=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.mouseCancellingHandler=function(r){return r.preventDefault(),r.cancelBubble=!0,!1},n._element=n.buildResizeBar(),t&&(n._resizeHandle.onmousedown=t.mouseDownHandler),n}return Object.defineProperty(e.prototype,"layoutHeight",{get:function(){return e.DISPLAY_HEIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"handle",{get:function(){return this._resizeHandle},enumerable:!1,configurable:!0}),e.prototype.allowResizing=function(t){this._resizeHandle.style.display=t?"block":"none"},e.prototype.buildResizeBar=function(){var t=this,n=N("div");n.className="kmw-footer",n.onmousedown=this.mouseCancellingHandler;var r=N("div");r.className="kmw-footer-caption",r.innerHTML='<a href="https://keyman.com/developer/keymanweb/">KeymanWeb</a>',r.id="keymanweb-osk-footer-caption",r.addEventListener("dblclick",function(o){return t.emit("showbuild"),!1},!1),n.appendChild(r);var i=N("div");return i.className="kmw-footer-resize",n.appendChild(i),this._resizeHandle=i,n},e.prototype.refreshLayout=function(){},e.DISPLAY_HEIGHT=Z.inPixels(16),e}(v.default),gi=Dl;var ui=function(){function c(e,t,n){this.x=e,this.y=t}return c.fromEvent=function(e){var t;if(window.TouchEvent&&e instanceof TouchEvent||e.changedTouches?t=e.changedTouches[0]:t=e,t.pageX)return new c(t.pageX,t.pageY,e);if(t.clientX){var n=t.clientX+document.body.scrollLeft,r=t.clientY+document.body.scrollTop;return new c(n,r,e)}else return new c(null,null,e)},c}(),Pl=function(){function c(e){this._VPreviousMouseMove=document.onmousemove,this._VPreviousMouseUp=document.onmouseup,this._VPreviousCursor=document.body.style.cursor,this._VPreviousMouseButton=typeof e.which=="undefined"?e.button:e.which}return c.prototype.restore=function(){document.onmousemove=this._VPreviousMouseMove,document.onmouseup=this._VPreviousMouseUp,document.body.style.cursor&&(document.body.style.cursor=this._VPreviousCursor)},c.prototype.matchesCausingClick=function(e){return this._VPreviousMouseButton==(typeof e.which=="undefined"?e.button:e.which)},c}(),Kl=function(){function c(e){this.startHandler=this._VMoveMouseDown.bind(this),this.cursorType=e}return Object.defineProperty(c.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isActive",{get:function(){return!!this._mouseStartSnapshot},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"mouseDownHandler",{get:function(){return this.startHandler},enumerable:!1,configurable:!0}),c.prototype._VMoveMouseDown=function(e){return!e||!this._enabled?!0:(this._mouseStartSnapshot||(this._mouseStartSnapshot=new Pl(e)),this._startCoord=ui.fromEvent(e),document.onmousemove=this._VMoveMouseMove.bind(this),document.onmouseup=this._VMoveMouseUp.bind(this),document.body.style.cursor&&(document.body.style.cursor=this.cursorType),e.preventDefault(),e.cancelBubble=!0,this.onDragStart(),!1)},c.prototype._VMoveMouseMove=function(e){if(!e||!this.enabled)return!0;if(e.preventDefault(),e.cancelBubble=!0,this._mouseStartSnapshot.matchesCausingClick(e)){var t=ui.fromEvent(e),n=t.x-this._startCoord.x,r=t.y-this._startCoord.y;return this.onDragMove(n,r),!1}else return this._VMoveMouseUp(e)},c.prototype._VMoveMouseUp=function(e){return e?(this._mouseStartSnapshot.restore(),this._mouseStartSnapshot=null,e.preventDefault(),e.cancelBubble=!0,this.onDragRelease(),!1):!0},c}(),ar=Kl;var jl=function(c){(0,d.__extends)(e,c);function e(){var t=c.apply(this,(0,d.__spreadArray)([],(0,d.__read)(arguments),!1))||this;return t._enabled=!0,t.actValue=null,t}return Object.defineProperty(e.prototype,"activate",{get:function(){return this._enabled&&!!this.actValue},enumerable:!1,configurable:!0}),e.prototype.checkState=function(t){this.activate!=t&&this.emit("activate",this.activate)},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){var n=this.activate;this._enabled=t,this.checkState(n)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activationTrigger",{get:function(){return this.actValue},set:function(t){var n=this.activate,r=this.actValue;this.actValue=t,this.checkState(n),r!=t&&this.emit("triggerchange",t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conditionsMet",{get:function(){return!!this.activationTrigger},enumerable:!1,configurable:!0}),e}(Ge),xe=jl;var Fi=function(c){(0,d.__extends)(e,c);function e(){return c.call(this,"KeymanWeb_OnScreenKeyboard")||this}return e.prototype.loadWithDefaults=function(t){return(0,d.__assign)((0,d.__assign)({},t),this.load())},e.prototype.load=function(){var t=c.prototype.load.call(this,function(n,r){switch(r){case"version":return n;default:return Number.parseInt(n,10)}});return t.width||delete t.width,t.height||delete t.height,t},e.prototype.save=function(t){c.prototype.save.call(this,t)},e}(Qt);var _l=function(c){(0,d.__extends)(e,c);function e(t){var n,r,i=this;t.activator=t.activator||new xe,i=c.call(this,t)||this,i.userPositioned=!1,i.specifiedPosition=!1,i.noDrag=!1,i.layoutSerializer=new Fi,i.restorePosition=function(u){var F=this._Visible,y=new L;this.emit("dragmove",y.corePromise),this.loadPersistedLayout(),this.userPositioned=!1,u||(delete this.dfltX,delete this.dfltY),this.savePersistedLayout(),F&&this.present(),this.titleBar.showPin(!1),y.resolve(),this.doResizeMove()}.bind(i),i.typedActivationModel.on("triggerchange",function(){return i.setDisplayPositioning()}),document.body.appendChild(i._Box),i.titleBar=new lr(i.titleDragHandler),i.titleBar.on("help",function(){i.legacyEvents.callEvent("helpclick",{})}),i.titleBar.on("config",function(){i.legacyEvents.callEvent("configclick",{})}),i.titleBar.on("close",function(){return i.startHide(!0)}),i.titleBar.on("unpin",function(){return i.restorePosition(!0)}),i.resizeBar=new gi(i.resizeDragHandler),i.resizeBar.on("showbuild",function(){return i.emit("showbuild")}),i.headerView=i.titleBar,i._Box.insertBefore(i.headerView.element,i._Box.firstChild);var o=function(u){var F=i.headerView;if(F&&F instanceof lr)switch(u){case"configclick":F.configEnabled=i.legacyEvents.listenerCount("configclick")>0;break;case"helpclick":F.helpEnabled=i.legacyEvents.listenerCount("helpclick")>0;break;default:return}},l=new Ne(i),a=new Ne(i.legacyEvents);try{for(var s=(0,d.__values)([l,a]),B=s.next();!B.done;B=s.next()){var g=B.value;g.on("listeneradded",o),g.on("listenerremoved",o)}}catch(u){n={error:u}}finally{try{B&&!B.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i.activeKeyboard&&i.postKeyboardAdjustments(),i.loadPersistedLayout(),i}return Object.defineProperty(e.prototype,"typedActivationModel",{get:function(){return this.activationModel},enumerable:!1,configurable:!0}),e.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},e.prototype.setBoxStyling=function(){var t=this._Box.style;t.zIndex="9999",t.display="none",t.width="auto",t.position="absolute"},e.prototype.postKeyboardAdjustments=function(){this.titleBar&&(this.enableMoveResizeHandlers(),this.activeKeyboard&&this.titleBar.setTitleFromKeyboard(this.activeKeyboard.keyboard),this.vkbd?(this.footerView=this.resizeBar,this._Box.appendChild(this.footerView.element)):(this.footerView&&this._Box.removeChild(this.footerView.element),this.footerView=null),this.loadPersistedLayout(),this.setNeedsLayout())},e.prototype.isEnabled=function(){return this.displayIfActive},e.prototype.isVisible=function(){return this._Visible},e.prototype.savePersistedLayout=function(){var t=this.getPos(),n={visible:this.displayIfActive?1:0,userSet:this.userPositioned?1:0,left:t.left,top:t.top,_version:$.CURRENT.toString()};this.vkbd&&(n.width=this.width.val,n.height=this.height.val),this.layoutSerializer.save(n)},e.prototype.loadPersistedLayout=function(){if(this.layoutSerializer){var t=this.layoutSerializer.loadWithDefaults({visible:1,userSet:0,left:-1,top:-1,_version:void 0,width:.3*screen.width,height:.15*screen.height});this.activationModel.enabled=t.visible==1,this.userPositioned=t.userSet==1,this.x=t.left,this.y=t.top;var n=t._version,r=n===void 0,i=t.width,o=t.height;i<.2*screen.width&&(i=.2*screen.width),o<.1*screen.height&&(o=.1*screen.height),i>.9*screen.width&&(i=.9*screen.width),o>.5*screen.height&&(o=.5*screen.height),(r||!n)&&(this.headerView&&this.headerView.layoutHeight.absolute&&(o+=this.headerView.layoutHeight.val),this.footerView&&this.footerView.layoutHeight.absolute&&(o+=this.footerView.layoutHeight.val)),this.setSize(i,o),(this.x==-1||this.y==-1||!this._Box)&&(this.userPositioned=!1),this.x<window.pageXOffset-.8*i&&(this.x=window.pageXOffset-.8*i),this.y<0&&(this.x=-1,this.y=-1,this.userPositioned=!1),this.userPositioned&&this._Box&&this.setPos({left:this.x,top:this.y})}},e.prototype.getDefaultKeyboardHeight=function(){if(this.configuration.heightOverride)return this.configuration.heightOverride();var t=Math.floor(Math.min(screen.availHeight,screen.availWidth)/2),n=t;if(this.targetDevice.formFactor=="phone"){var r=Math.min(screen.height,screen.width),i=Math.max(screen.height,screen.width);it()?n=n*(i/r)/1.6:n=Math.floor(Math.max(screen.availHeight,screen.availWidth)/3)}return this.targetDevice.OS==f.OperatingSystem.iOS&&(n=n/ht(this.targetDevice.formFactor)),n},e.prototype.getDefaultWidth=function(){if(this.configuration.widthOverride)return this.configuration.widthOverride();var t;if(this.targetDevice.OS==f.OperatingSystem.iOS)t=window.innerWidth;else if(this.targetDevice.OS==f.OperatingSystem.Android)try{t=document.documentElement.clientWidth}catch(n){t=screen.availWidth}else t=screen.width;return t},e.prototype.doResizeMove=function(t){this.legacyEvents.callEvent("resizemove",t)},e.prototype.setRect=function(t){if(!(this._Box==null||this.targetDevice.formFactor!="desktop")){var n=this._Box,r=n.style;if("left"in t&&(this.x=t.left-M(n)+n.offsetLeft,r.left=this.x+"px",this.dfltX=r.left),"top"in t&&(this.y=t.top-D(n)+n.offsetTop,r.top=this.y+"px",this.dfltY=r.top),this.vkbd!=null){var i=this.vkbd.kbdDiv,o=i.style;if("width"in t){var l=t.width-(n.offsetWidth-i.offsetWidth);l<.2*screen.width&&(l=.2*screen.width),l>.9*screen.width&&(l=.9*screen.width),o.width=l+"px",this.setSize(l,this.computedHeight,!0)}if("height"in t){var a=t.height-(n.offsetHeight-i.offsetHeight);a<.1*screen.height&&(a=.1*screen.height),a>.5*screen.height&&(a=.5*screen.height),o.height=a+"px",o.fontSize=a/8+"px",this.setSize(this.computedWidth,a,!0)}"nosize"in t&&(this.resizingEnabled=!t.nosize)}"nomove"in t&&(this.noDrag=t.nomove,this.movementEnabled=!this.noDrag),this.savePersistedLayout()}},e.prototype.getPos=function(){var t=this._Box,n={left:this._Visible?t.offsetLeft:this.x,top:this._Visible?t.offsetTop:this.y};return n},e.prototype.setPos=function(t){if(typeof this._Box!="undefined"){if(this.userPositioned){var n=t.left,r=t.top;typeof n!="undefined"&&(n<-.8*this._Box.offsetWidth&&(n=-.8*this._Box.offsetWidth),this.userPositioned&&(this._Box.style.left=n+"px",this.x=n)),typeof r!="undefined"&&(r<0&&(r=0),this.userPositioned&&(this._Box.style.top=r+"px",this.y=r))}this.titleBar.showPin(this.userPositioned)}},e.prototype.setDisplayPositioning=function(){var t=this._Box.style;if(t.position="absolute",this.activationModel.activate&&(t.display="block"),t.left="0px",this.specifiedPosition||this.userPositioned)t.left=this.x+"px",t.top=this.y+"px";else{var n=this.typedActivationModel.activationTrigger||null;this.dfltX?t.left=this.dfltX:typeof n!="undefined"&&n!=null&&(t.left=M(n)+"px"),this.dfltY?t.top=this.dfltY:typeof n!="undefined"&&n!=null&&(t.top=D(n)+n.offsetHeight+"px")}this.specifiedPosition=!1},e.prototype.presentAtPosition=function(t,n){this.mayShow()&&(this.specifiedPosition=t>=0||n>=0,this.specifiedPosition&&(this.x=t,this.y=n),this.specifiedPosition=this.specifiedPosition||this.userPositioned,this.present())},e.prototype.present=function(){this.mayShow()&&(this.titleBar.showPin(this.userPositioned),c.prototype.present.call(this),this.doShow({x:this._Box.offsetLeft,y:this._Box.offsetTop,userLocated:this.userPositioned}))},e.prototype.startHide=function(t){c.prototype.startHide.call(this,t),t&&this.savePersistedLayout()},e.prototype.show=function(t){t!==void 0?c.prototype.show.call(this,t):c.prototype.show.call(this),this.savePersistedLayout()},e.prototype.userLocated=function(){return this.userPositioned},Object.defineProperty(e.prototype,"movementEnabled",{get:function(){return this.titleDragHandler.enabled},set:function(t){this.titleDragHandler.enabled=t,this.titleBar.showPin(t&&this.userPositioned)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resizingEnabled",{get:function(){return this.resizeDragHandler.enabled},set:function(t){this.resizeDragHandler.enabled=t,this.resizeBar.allowResizing(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBeingMoved",{get:function(){return this.titleDragHandler.isActive},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBeingResized",{get:function(){return this.resizeDragHandler.isActive},enumerable:!1,configurable:!0}),e.prototype.enableMoveResizeHandlers=function(){this.titleDragHandler.enabled=!this.noDrag,this.resizeDragHandler.enabled=!0},Object.defineProperty(e.prototype,"titleDragHandler",{get:function(){var t=this;return this._moveHandler?this._moveHandler:(this._moveHandler=new(function(n){(0,d.__extends)(r,n);function r(){return n.call(this,"move")||this}return r.prototype.onDragStart=function(){this.startX=t._Box.offsetLeft,this.startY=t._Box.offsetTop,t.activeKeyboard.keyboard.isCJK&&t.titleBar.setPinCJKOffset(),this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new L,t.emit("dragmove",this.dragPromise.corePromise)},r.prototype.onDragMove=function(i,o){t.titleBar.showPin(!0),t.userPositioned=!0,t._Box.style.left=this.startX+i+"px",t._Box.style.top=this.startY+o+"px";var l=t.getRect();t.setSize(l.width,l.height,!0),t.x=l.left,t.y=l.top},r.prototype.onDragRelease=function(){t.vkbd&&(t.vkbd.currentKey=null),this.dragPromise.resolve(),this.dragPromise.then(function(){t.userPositioned=!0,t.doResizeMove(),t.savePersistedLayout()}),this.dragPromise=null},r}(ar)),this._moveHandler)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resizeDragHandler",{get:function(){var t=this;return this._resizeHandler?this._resizeHandler:(this._resizeHandler=new(function(n){(0,d.__extends)(r,n);function r(){return n.call(this,"se-resize")||this}return r.prototype.onDragStart=function(){this.startWidth=t.computedWidth,this.startHeight=t.computedHeight,this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new L,t.emit("resizemove",this.dragPromise.corePromise)},r.prototype.onDragMove=function(i,o){var l=this.startWidth+i,a=this.startHeight+o;l<.2*screen.width&&(l=.2*screen.width),a<.1*screen.height&&(a=.1*screen.height),l>.9*screen.width&&(l=.9*screen.width),a>.5*screen.height&&(a=.5*screen.height),t.setSize(l,a,!0)},r.prototype.onDragRelease=function(){t.vkbd&&(t.vkbd.currentKey=null),t.vkbd&&(this.startWidth=t.computedWidth,this.startHeight=t.computedHeight),t.refreshLayout(),this.dragPromise.resolve(),this.dragPromise.then(function(){t.doResizeMove(),t.savePersistedLayout()}),this.dragPromise=null},r}(ar)),this._resizeHandler)},enumerable:!1,configurable:!0}),e}(ft),te=_l;var ql=function(c){(0,d.__extends)(e,c);function e(t){var n=this;return t.isEmbedded?t.activator=t.activator||new me:t.activator=t.activator||new xe,n=c.call(this,t)||this,n.isResizing=!1,n.restorePosition=function(r){}.bind(n),document.body.appendChild(n._Box),n}return e.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},e.prototype.setBoxStyling=function(){var t=this._Box.style;t.zIndex="9999",t.display="none",t.width="100%",t.position="fixed"},e.prototype.refreshLayout=function(t){if(!this.isResizing){try{this.isResizing=!0,this.doResize()}finally{this.isResizing=!1}c.prototype.refreshLayout.call(this,t)}},e.prototype.doResize=function(){if(this.vkbd){var t=this.getDefaultKeyboardHeight();this.setSize(this.getDefaultWidth(),t+this.banner.height)}},e.prototype.postKeyboardAdjustments=function(){this.doResize()},e.prototype.getDefaultKeyboardHeight=function(){var t,n,r=this.targetDevice;if(this.configuration.heightOverride)return this.configuration.heightOverride();var i=(t=document==null?void 0:document.documentElement)===null||t===void 0?void 0:t.clientWidth,o=(n=document==null?void 0:document.documentElement)===null||n===void 0?void 0:n.clientHeight;if(typeof i=="undefined"&&(i=Math.min(screen.height,screen.width),o=Math.max(screen.height,screen.width),it())){var l=i;i=o,o=l}var a=Math.floor(Math.min(o,i)/2),s=a;return r.formFactor=="phone"&&(it()?s=Math.floor(o/1.6):s=Math.floor(o/2.4)),this.targetDevice.OS==f.OperatingSystem.iOS&&(s=s/ht(this.targetDevice.formFactor)),s},e.prototype.getDefaultWidth=function(){var t,n=this.targetDevice;if(this.configuration.widthOverride)return this.configuration.widthOverride();var r;return r=(t=document==null?void 0:document.documentElement)===null||t===void 0?void 0:t.clientWidth,typeof r=="undefined"&&(this.targetDevice.OS==f.OperatingSystem.iOS?r=window.innerWidth:n.OS==f.OperatingSystem.Android?r=screen.availWidth:r=screen.width),r},e.prototype.setRect=function(t){},e.prototype.getPos=function(){var t=this._Box,n={left:this._Visible?t.offsetLeft:this.x,top:this._Visible?t.offsetTop:this.y};return n},e.prototype.setPos=function(t){},e.prototype.setDisplayPositioning=function(){var t=this._Box.style;this.vkbd&&(t.position="fixed",t.left=t.bottom="0px",t.border="none",t.borderTop="1px solid gray")},e.prototype.present=function(){c.prototype.present.call(this),this.legacyEvents.callEvent("show",{})},e}(ft),sr=ql;var $l=function(c){(0,d.__extends)(e,c);function e(){var t=c.apply(this,(0,d.__spreadArray)([],(0,d.__read)(arguments),!1))||this;return t.flag=!0,t}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this.flag},set:function(t){this.activate=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activate",{get:function(){return this.flag},set:function(t){this.flag!=t&&(this.flag=t,this.emit("activate",t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conditionsMet",{get:function(){return!0},enumerable:!1,configurable:!0}),e}(Ge),Br=$l;var ta=function(c){(0,d.__extends)(e,c);function e(t){var n=this;return t.activator=t.activator||new Br,n=c.call(this,t)||this,n.restorePosition=function(r){}.bind(n),n}return Object.defineProperty(e.prototype,"element",{get:function(){return this._Box},enumerable:!1,configurable:!0}),e.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},e.prototype.setBoxStyling=function(){var t=this._Box.style;t.display="none",t.position="relative"},e.prototype.postKeyboardAdjustments=function(){},e.prototype.getDefaultKeyboardHeight=function(){return this.keyboardView instanceof vt?this.keyboardView.height:this.computedHeight},e.prototype.getDefaultWidth=function(){return this.computedWidth},e.prototype.setRect=function(t){},e.prototype.getPos=function(){var t=this._Box,n={left:this._Visible?t.offsetLeft:void 0,top:this._Visible?t.offsetTop:void 0};return n},e.prototype.setPos=function(t){},e.prototype.present=function(){c.prototype.present.call(this),this.legacyEvents.callEvent("show",{})},e.prototype.setDisplayPositioning=function(){},e.prototype.allowsDeviceChange=function(t){return!0},e}(ft),dr=ta;var yr={};xr(yr,{AnchoredOSKView:function(){return ur},FloatingOSKView:function(){return Fr},InlinedOSKView:function(){return ea}});function gr(c){return{hostDevice:c.config.hostDevice,pathConfig:c.config.paths,predictionContextManager:c.contextManager.predictionContext,isEmbedded:!1}}var ur=function(c){(0,d.__extends)(e,c);function e(t,n){var r=(0,d.__assign)((0,d.__assign)({},gr(t)),n||{});return c.call(this,r)||this}return e}(sr),Fr=function(c){(0,d.__extends)(e,c);function e(t,n){var r=(0,d.__assign)((0,d.__assign)({},gr(t)),n||{});return c.call(this,r)||this}return e}(te),ea=function(c){(0,d.__extends)(e,c);function e(t,n){var r=(0,d.__assign)((0,d.__assign)({},gr(t)),n||{});return c.call(this,r)||this}return e}(dr);var na=function(c){(0,d.__extends)(e,c);function e(){var t=c!==null&&c.apply(this,arguments)||this;return t.events=new v.default,t.changed=!1,t}return e.prototype.focus=function(){var t=this.getElement();t.focus&&t.focus()},e.prototype.isForcingScroll=function(){return!1},e.prototype.dispatchInputEventOn=function(t){var n;window.InputEvent&&(n=new InputEvent("input",{bubbles:!0,cancelable:!1})),t&&n&&t.dispatchEvent(n)},e}(pn),tt=na;var ra=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.root=t,n._cachedSelectionStart=-1,n}return Object.defineProperty(e.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),e.isSupportedType=function(t){return t=="email"||t=="search"||t=="text"||t=="url"},e.prototype.getElement=function(){return this.root},e.prototype.clearSelection=function(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)},e.prototype.isSelectionEmpty=function(){return this.root.selectionStart==this.root.selectionEnd},e.prototype.hasSelection=function(){return!0},e.prototype.invalidateSelection=function(){this._cachedSelectionStart=-1},e.prototype.getCaret=function(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart},e.prototype.getDeadkeyCaret=function(){return this.getCaret()},e.prototype.setCaret=function(t){this.setSelection(t,t,"none")},e.prototype.setSelection=function(t,n,r){var i=this.root.value._kmwCodePointToCodeUnit(t),o=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(i,o,r),this.processedSelectionStart=t,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(i,o,r)},e.prototype.forceScroll=function(){var t=this.getElement(),n=t.selectionStart,r=t.selectionEnd;this._activeForcedScroll=!0;try{t.blur(),t.focus()}finally{t.selectionStart=n,t.selectionEnd=r,this._activeForcedScroll=!1}},e.prototype.isForcingScroll=function(){return this._activeForcedScroll},e.prototype.getSelectionDirection=function(){return this.root.selectionDirection},e.prototype.getTextBeforeCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)},e.prototype.getSelectedText=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)},e.prototype.setTextBeforeCaret=function(t){this.getCaret();var n=this.processedSelectionEnd-this.processedSelectionStart,r=this.getSelectionDirection(),i=t._kmwLength();this.root.value=t+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(i,i+n,r)},e.prototype.setTextAfterCaret=function(t){var n=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+t,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,n)},e.prototype.getTextAfterCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)},e.prototype.getText=function(){return this.root.value},e.prototype.deleteCharsBeforeCaret=function(t){if(t>0){var n=this.getTextBeforeCaret(),r=this.processedSelectionStart;t>r&&(t=r),this.adjustDeadkeys(-t),this.setTextBeforeCaret(n.kmwSubstring(0,r-t)),this.setCaret(r-t)}},e.prototype.insertTextBeforeCaret=function(t){if(t){var n=this.getCaret(),r=this.getTextBeforeCaret(),i=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(t._kmwLength()),this.root.value=r+t+i,this.setCaret(n+t._kmwLength())}},e.prototype.handleNewlineAtCaret=function(){var t=this.root;t&&(t.type=="search"||t.type=="submit")?(t.disabled=!1,t.form.submit()):this.events.emit("unhandlednewline",t)},e.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},e}(tt),ee=ra;var ca=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.root=t,n._cachedSelectionStart=-1,n}return Object.defineProperty(e.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.getElement=function(){return this.root},e.prototype.clearSelection=function(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)},e.prototype.isSelectionEmpty=function(){return this.root.selectionStart==this.root.selectionEnd},e.prototype.hasSelection=function(){return!0},e.prototype.invalidateSelection=function(){this._cachedSelectionStart=-1},e.prototype.getCaret=function(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart},e.prototype.getDeadkeyCaret=function(){return this.getCaret()},e.prototype.setCaret=function(t){this.setSelection(t,t,"none")},e.prototype.setSelection=function(t,n,r){var i=this.root.value._kmwCodePointToCodeUnit(t),o=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(i,o,r),this.processedSelectionStart=t,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(i,o,r)},e.prototype.forceScroll=function(){var t=this.getElement(),n=t.selectionStart,r=t.selectionEnd;this._activeForcedScroll=!0;try{t.blur(),t.focus()}finally{t.selectionStart=n,t.selectionEnd=r,this._activeForcedScroll=!1}},e.prototype.isForcingScroll=function(){return this._activeForcedScroll},e.prototype.getSelectionDirection=function(){return this.root.selectionDirection},e.prototype.getTextBeforeCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)},e.prototype.setTextBeforeCaret=function(t){this.getCaret();var n=this.processedSelectionEnd-this.processedSelectionStart,r=this.getSelectionDirection(),i=t._kmwLength();this.root.value=t+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(i,i+n,r)},e.prototype.setTextAfterCaret=function(t){var n=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+t,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,n)},e.prototype.getTextAfterCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)},e.prototype.getSelectedText=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)},e.prototype.getText=function(){return this.root.value},e.prototype.deleteCharsBeforeCaret=function(t){if(t>0){var n=this.getTextBeforeCaret(),r=this.processedSelectionStart;t>r&&(t=r),this.adjustDeadkeys(-t),this.setTextBeforeCaret(n.kmwSubstring(0,r-t)),this.setCaret(r-t)}},e.prototype.insertTextBeforeCaret=function(t){if(t){var n=this.getCaret(),r=this.getTextBeforeCaret(),i=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(t._kmwLength()),this.root.value=r+t+i,this.setCaret(n+t._kmwLength())}},e.prototype.handleNewlineAtCaret=function(){this.insertTextBeforeCaret("\n")},e.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},e}(tt),Qr=ca;var Ir=function(){function c(e,t){this.node=e,this.offset=t}return c}(),Ur=function(){function c(e,t){this.start=e,this.end=t}return c}(),bt=function(){function c(e,t){this.cmd=e,this.stateType=t}return c}(),ia=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this)||this;if(n.root=t,t.contentWindow&&t.contentWindow.document&&t.contentWindow.document.designMode=="on")n.doc=t.contentWindow.document,n.docRoot=t.contentWindow.document.documentElement;else throw"Specified IFrame is not in design-mode!";return n}return Object.defineProperty(e.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.getElement=function(){return this.root},e.prototype.focus=function(){this.doc.defaultView.focus()},e.prototype.isSelectionEmpty=function(){return this.hasSelection()?this.doc.getSelection().isCollapsed:!0},e.prototype.hasSelection=function(){var t=this.doc.getSelection(),n=document.getSelection();return n.anchorNode==t.anchorNode&&n.focusNode==t.focusNode,!0},e.prototype.clearSelection=function(){if(this.hasSelection()){var t=this.doc.getSelection();t.isCollapsed||t.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")},e.prototype.invalidateSelection=function(){},e.prototype.getCarets=function(){var t=this.doc.getSelection(),n=t.anchorNode.compareDocumentPosition(t.focusNode);if(t.isCollapsed){var r=new Ir(t.anchorNode,t.anchorOffset);return new Ur(r,r)}else{var i=new Ir(t.anchorNode,t.anchorOffset),o=new Ir(t.focusNode,t.focusOffset);return i.node==o.node&&(n=o.offset-i.offset>0?2:4),n&2?new Ur(i,o):new Ur(o,i)}},e.prototype.getDeadkeyCaret=function(){return this.getTextBeforeCaret().kmwLength()},e.prototype.getTextBeforeCaret=function(){if(!this.hasSelection())return this.getText();var t=this.getCarets().start;return t.node.nodeType!=3?"":t.node.textContent.substr(0,t.offset)},e.prototype.getSelectedText=function(){return""},e.prototype.getTextAfterCaret=function(){if(!this.hasSelection())return"";var t=this.getCarets().end;return t.node.nodeType!=3?"":t.node.textContent.substr(t.offset)},e.prototype.getText=function(){return this.docRoot.innerText},e.prototype.deleteCharsBeforeCaret=function(t){if(!(!this.hasSelection()||t<=0)){var n=this.getCarets().start;if(t>n.offset&&(t=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}var r=this.doc.createRange(),i=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-t).length;r.setStart(n.node,i),r.setEnd(n.node,n.offset),this.adjustDeadkeys(-t),r.deleteContents()}},e.prototype.insertTextBeforeCaret=function(t){if(this.hasSelection()){var n=this.getCarets().start,r=t._kmwLength(),i=this.doc.getSelection();if(r!=0){this.adjustDeadkeys(r);var o=this.root.ownerDocument.createRange();if(n.node.nodeType==3){var l=n.node;l.insertData(n.offset,t),o.setStart(l,n.offset+t.length)}else{var a=this.doc.createTextNode(t),s=this.doc.createRange();s.setStart(n.node,n.offset),s.collapse(!0),s.insertNode(a),o.setStart(a,t.length)}o.collapse(!0),i.removeAllRanges();try{i.addRange(o)}catch(B){n.node.parentElement.scrollIntoView(),i.addRange(o)}i.collapseToEnd()}}},e.prototype.handleNewlineAtCaret=function(){},e.prototype.setTextAfterCaret=function(t){if(this.hasSelection()){var n=this.getCarets().end,r=t._kmwLength();if(r!=0)if(n.node.nodeType==3){var i=n.node;i.replaceData(n.offset,i.length,t)}else{var o=n.node.ownerDocument.createTextNode(t),l=this.root.ownerDocument.createRange();l.setStart(n.node,n.offset),l.collapse(!0),l.insertNode(o)}}},e.prototype.saveProperties=function(){var t=[new bt("backcolor",1),new bt("fontname",1),new bt("fontsize",1),new bt("forecolor",1),new bt("bold",0),new bt("italic",0),new bt("strikethrough",0),new bt("subscript",0),new bt("superscript",0),new bt("underline",0)];this.doc.defaultView&&t.push(new bt("hilitecolor",1));for(var n=0;n<t.length;n++){var r=t[n];r.stateType==1?r.cache=this.doc.queryCommandValue(r.cmd):r.cache=this.doc.queryCommandState(r.cmd)}this.commandCache=t},e.prototype.restoreProperties=function(t){this.commandCache||console.error("No command cache exists to restore!");for(var n=0;n<this.commandCache.length;n++){var r=this.commandCache[n];r.stateType==1?this.doc.queryCommandValue(r.cmd)!=r.cache&&(t&&t(),this.doc.execCommand(r.cmd,!1,r.cache)):this.doc.queryCommandState(r.cmd)!=r.cache&&(t&&t(),this.doc.execCommand(r.cmd,!1,null))}},e.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},e}(tt),et=ia;var hr=function(){function c(e,t){this.node=e,this.offset=t}return c}(),br=function(){function c(e,t){this.start=e,this.end=t}return c}(),oa=function(c){(0,d.__extends)(e,c);function e(t){var n=this;if(t.isContentEditable)n=c.call(this)||this,n.root=t;else throw"Specified element is not already content-editable!";return n}return Object.defineProperty(e.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.getElement=function(){return this.root},e.prototype.isSelectionEmpty=function(){return this.hasSelection()?this.root.ownerDocument.getSelection().isCollapsed:!0},e.prototype.hasSelection=function(){var t=this.root.ownerDocument.getSelection();return!(this.root!=t.anchorNode&&!this.root.contains(t.anchorNode)||this.root!=t.focusNode&&!this.root.contains(t.focusNode))},e.prototype.clearSelection=function(){if(this.hasSelection()){var t=this.root.ownerDocument.getSelection();t.isCollapsed||t.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")},e.prototype.invalidateSelection=function(){},e.prototype.getCarets=function(){var t=this.root.ownerDocument.getSelection(),n=t.anchorNode.compareDocumentPosition(t.focusNode);if(t.isCollapsed){var r=new hr(t.anchorNode,t.anchorOffset);return new br(r,r)}else{var i=new hr(t.anchorNode,t.anchorOffset),o=new hr(t.focusNode,t.focusOffset);return i.node==o.node&&(n=o.offset-i.offset>0?2:4),n&2?new br(i,o):new br(o,i)}},e.prototype.getDeadkeyCaret=function(){return this.getTextBeforeCaret().kmwLength()},e.prototype.getTextBeforeCaret=function(){if(!this.hasSelection())return this.getText();var t=this.getCarets().start;return t.node.nodeType!=3?"":t.node.textContent.substr(0,t.offset)},e.prototype.getSelectedText=function(){return""},e.prototype.getTextAfterCaret=function(){if(!this.hasSelection())return"";var t=this.getCarets().end;return t.node.nodeType!=3?"":t.node.textContent.substr(t.offset)},e.prototype.getText=function(){return this.root.innerText},e.prototype.deleteCharsBeforeCaret=function(t){if(!(!this.hasSelection()||t<=0)){var n=this.getCarets().start;if(t>n.offset&&(t=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}var r=this.root.ownerDocument.createRange(),i=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-t).length;r.setStart(n.node,i),r.setEnd(n.node,n.offset),this.adjustDeadkeys(-t),r.deleteContents()}},e.prototype.insertTextBeforeCaret=function(t){if(this.hasSelection()){var n=this.getCarets().start,r=t._kmwLength(),i=this.root.ownerDocument.getSelection();if(r!=0){this.adjustDeadkeys(r);var o=this.root.ownerDocument.createRange();if(n.node.nodeType==3){var l=n.node;l.insertData(n.offset,t),o.setStart(l,n.offset+t.length)}else{var a=n.node.ownerDocument.createTextNode(t),s=this.root.ownerDocument.createRange();s.setStart(n.node,n.offset),s.collapse(!0),s.insertNode(a),o.setStart(a,t.length)}o.collapse(!0),i.removeAllRanges();try{i.addRange(o)}catch(B){n.node.parentElement.scrollIntoView(),i.addRange(o)}i.collapseToEnd()}}},e.prototype.handleNewlineAtCaret=function(){},e.prototype.setTextAfterCaret=function(t){if(this.hasSelection()){var n=this.getCarets().end,r=t._kmwLength();if(r!=0)if(n.node.nodeType==3){var i=n.node;i.replaceData(n.offset,i.length,t)}else{var o=n.node.ownerDocument.createTextNode(t),l=this.root.ownerDocument.createRange();l.setStart(n.node,n.offset),l.collapse(!0),l.insertNode(o)}}},e.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},e}(tt),tn=oa;function P(c,e){var t;return c?c.Window?e=="Window":(c.defaultView?t=c.defaultView[e]:c.ownerDocument&&(t=c.ownerDocument.defaultView[e]),t?c instanceof t:!1):!1}function en(c){if(P(c,"HTMLInputElement"))return new ee(c);if(P(c,"HTMLTextAreaElement"))return new Qr(c);if(P(c,"HTMLIFrameElement")){var e=c;return e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.designMode=="on"?new et(e):c.isContentEditable?new tn(c):null}else if(c.isContentEditable)return new tn(c);return null}var ne=function(){function c(){var e=this;this.pending=!1;var t=this.bg=document.createElement("div"),n=document.createElement("div"),r=this.lt=document.createElement("div"),i=this.gr=document.createElement("div"),o=this.bx=document.createElement("div");t.className="kmw-wait-background",n.className="kmw-wait-box",this.dismiss=null,r.className="kmw-wait-text",i.className="kmw-wait-graphic",o.className="kmw-alert-close";var l=n.onmousedown=n.onclick=function(s){o.style.display=="block"&&(t.style.display="none",e.dismiss&&e.dismiss())};n.addEventListener("touchstart",l,!1);var a=t.onmousedown=t.onclick=function(s){s.preventDefault(),s.stopPropagation()};t.addEventListener("touchstart",a,!1),n.appendChild(o),n.appendChild(r),n.appendChild(i),t.appendChild(n),document.body.appendChild(t)}return Object.defineProperty(c.prototype,"rootElement",{get:function(){return this.bg},enumerable:!1,configurable:!0}),c.prototype.wait=function(e){var t=this,n=this.bg;typeof n=="undefined"||n==null||(e?(this.pending=!0,window.setTimeout(function(){t.pending&&(window.scrollTo(0,0),t.bx.style.display="none",t.lt.className="kmw-wait-text",t.lt.innerHTML=e,t.gr.style.display="block",n.style.display="block")},1e3)):this.pending&&(this.lt.innerHTML="",this.pending=!1,n.style.display="none"))},c.prototype.alert=function(e,t){var n=this.bg;this.bx.style.display="block",this.lt.className="kmw-alert-text",this.lt.innerHTML=e,this.gr.style.display="none",n.style.display="block",this.dismiss=arguments.length>1?t:null},c.prototype.shutdown=function(){this.bg.parentNode.removeChild(this.bg)},c}();function Xe(){return document.readyState==="complete"?Promise.resolve():new Promise(function(c,e){var t=function(){window.removeEventListener("load",t),c()};window.addEventListener("load",t)})}var yi=function(c){(0,d.__extends)(e,c);function e(){return c!==null&&c.apply(this,arguments)||this}return e.prototype.initialize=function(t){var n=this;this._options?this._options=(0,d.__assign)((0,d.__assign)({},this._options),t):this._options=(0,d.__assign)({},t),c.prototype.initialize.call(this,t),this._options=t,this._ui=t.ui,this._attachType=t.attachType,Xe().then(function(){var r;t.useAlerts&&!n.alertHost?n._alertHost=new ne:!t.useAlerts&&n.alertHost&&((r=n._alertHost)===null||r===void 0||r.shutdown(),n._alertHost=null)})},Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attachType",{get:function(){return this._attachType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alertHost",{get:function(){return this._alertHost},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"signalUser",{set:function(t){(!t||t!=this.alertHost)&&this.alertHost.shutdown(),this._alertHost=t},enumerable:!1,configurable:!0}),e.prototype.debugReport=function(){var t=c.prototype.debugReport.call(this);return t.attachType=this.attachType,t.ui=this._ui,t.keymanEngine="app/browser",t},e.prototype.onRuleFinalization=function(t,n){var r=t.transcription.transform;Yt(r)||n instanceof tt&&(n.changed=!0)},e}(Xn);var Qi=(0,d.__assign)({ui:"",attachType:"",useAlerts:!0},Vn);var Cr=function(){function c(e,t,n){this.interface=e,this.keyboard=t}return c}();function Jt(c){var e=c==null?void 0:c.target;return Ct(e)}function Ct(c){var e;if(c==null)return null;if(c.body&&(c=c.body),c.nodeType==3&&(c=c.parentNode),P(c,"HTMLInputElement")){var t=c.type.toLowerCase();if(!(t=="text"||t=="search"))return null}return(e=c._kmwAttachment)===null||e===void 0?void 0:e.interface}var pr=function(c){(0,d.__extends)(e,c);function e(t,n){var r=this;if(!t)throw new Error("Cannot attach to a null/undefined document");return r=c.call(this)||this,r.baseFont="",r.appliedFont="",r.embeddedPageContexts=[],r._inputList=[],r._sortedInputs=[],r._InputModeObserverCore=function(i){r.disableInputModeObserver();try{for(var o=0,l=i;o<l.length;o++){var a=l[o],s=a.target;r.isAttached(s)&&(s._kmwAttachment.inputMode=s.inputMode,r.device.touchable&&(s.inputMode="none"))}}finally{r.enableInputModeObserver()}},r._EnablementMutationObserverCore=function(i){for(var o=0;o<i.length;o++){var l=i[o],a=l.oldValue?l.oldValue.indexOf("kmw-disabled")>=0:!1,s=l.target.className.indexOf("kmw-disabled")>=0;if(a&&!s?r._EnableControl(l.target):!a&&s&&r._DisableControl(l.target),!s&&l.attributeName=="readonly"){var B=l.oldValue?l.oldValue!=null:!1,g=l.target;if(g instanceof g.ownerDocument.defaultView.HTMLInputElement||g instanceof g.ownerDocument.defaultView.HTMLTextAreaElement){var u=g.readOnly;B&&!u?r._EnableControl(l.target):!B&&u&&r._DisableControl(l.target)}}}},r._AutoAttachObserverCore=function(i){for(var o=[],l=[],a=0;a<i.length;a++){for(var s=i[a],B=0;B<s.addedNodes.length;B++)o=o.concat(r._GetDocumentEditables(s.addedNodes[B]));for(B=0;B<s.removedNodes.length;B++)l=l.concat(r._GetDocumentEditables(s.removedNodes[B]))}for(var g=0;g<o.length;g++)r.isKMWInput(o[g])&&r._MutationAdditionObserved(o[g]);for(g=0;g<l.length;g++){var u=!1,F=l[g];if(F instanceof F.ownerDocument.defaultView.HTMLIFrameElement){for(var y=0;y<r.embeddedPageContexts.length;y++)if(r.embeddedPageContexts[y].options.owner==F){r.embeddedPageContexts[y].shutdown(),r.embeddedPageContexts.splice(y,1),u=!0;break}if(!u){for(var I=0;I<r._inputList.length;I++)if(r._inputList[I]==F){r.detachFromControl(F),r._inputList[I]==F&&r._inputList.splice(I,1);break}}}else r.isKMWInput(F)&&r._MutationRemovalObserved(F)}(o.length||l.length)&&(r.device.touchable?r.device.touchable&&window.setTimeout(function(){r.listInputs()},1):r.listInputs())},r._MutationAdditionObserved=function(i){if(i instanceof i.ownerDocument.defaultView.HTMLIFrameElement){var o=function(){window.setTimeout(function(){r.attachToControl(i)},1)};i.addEventListener("load",o)}else r.attachToControl(i)},r._MutationRemovalObserved=function(i){r.detachFromControl(i)},r.options=n,r.document=t,r.stylesheetManager=new yt(r.document.body),r}return Object.defineProperty(e.prototype,"device",{get:function(){return this.options.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"window",{get:function(){return this.document.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inputList",{get:function(){var t=this.embeddedPageContexts.map(function(n){return n.inputList}).reduce(function(n,r){return n.concat(r)},[]);return[].concat(this._inputList).concat(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sortedInputs",{get:function(){return this._sortedInputs},enumerable:!1,configurable:!0}),e.prototype.install=function(t){this.manualAttach=t,this.baseFont=this.getBaseFont(),this.manualAttach||(this._SetupDocument(this.document.documentElement),this.listInputs()),this.options.owner||this.initMutationObservers(this.document,t)},e.prototype.setupElementAttachment=function(t){if(!t._kmwAttachment){var n=en(t);n||P(t,"HTMLIFrameElement")||console.warn("Could not create processing interface for newly-attached element!"),t._kmwAttachment=new Cr(n,null,this.device.touchable)}},e.prototype.clearElementAttachment=function(t){t._kmwAttachment=null},e.prototype.isKMWInput=function(t){if(t instanceof t.ownerDocument.defaultView.HTMLTextAreaElement)return!0;if(t instanceof t.ownerDocument.defaultView.HTMLInputElement){if(ee.isSupportedType(t.type))return!0}else if(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)try{if(t.contentWindow){var n=t.contentWindow.document;if(n)return!(this.device.touchable&&n.designMode.toLowerCase()=="on")}else return!!t._kmwAttachment}catch(r){console.warn("Error during attachment to / detachment from iframe: "),console.warn(r)}else if(t.isContentEditable)return!0;return!1},e.prototype.isAttached=function(t){if(t._kmwAttachment)return!0;if(P(t,"HTMLIFrameElement")){var n=t;if(n.contentDocument==this.document)return!0;for(var r=0,i=this.embeddedPageContexts;r<i.length;r++){var o=i[r];if(o.isAttached(t))return!0}}return!1},e.prototype.isKMWDisabled=function(t){var n=t.className;return t.readOnly?!0:!!(n&&n.indexOf("kmw-disabled")>=0)},e.prototype.enableInputElement=function(t){var n;this.isKMWDisabled(t)||(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement?this._AttachToIframe(t):(this.setupElementAttachment(t),t._kmwAttachment.inputMode=(n=t.inputMode)!==null&&n!==void 0?n:"text",this.disableInputModeObserver(),t.inputMode="none",this.enableInputModeObserver(),t.classList.add("keymanweb-font"),this._inputList.push(t),this.emit("enabled",t)))},e.prototype.disableInputElement=function(t){var n;if(t)if(t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLIFrameElement||t instanceof HTMLIFrameElement)this._DetachFromIframe(t);else{if(this.isAttached(t)){var r=(n=t._kmwAttachment)===null||n===void 0?void 0:n.inputMode;this.disableInputModeObserver(),t.inputMode=r,this.enableInputModeObserver()}var i=t.className.indexOf("keymanweb-font");i>=0&&(t.className=t.className.replace("keymanweb-font","").trim());var o=this.inputList.indexOf(t);o>-1&&this._inputList.splice(o,1),this.emit("disabled",t)}},e.prototype.enableTouchElement=function(t){return this.isKMWDisabled(t)?(this.emit("disabled",t),!1):(this.isAttached(t)||this.setupElementAttachment(t),this.enableInputElement(t),!0)},e.prototype.disableTouchElement=function(t){if(this.isAttached(t)){var n=t._kmwAttachment.inputMode;this.disableInputModeObserver(),t.inputMode=n,this.enableInputModeObserver()}},e.prototype._AttachToIframe=function(t){var n=this;try{var r=t.contentWindow.document;if(r){if(r.designMode.toLowerCase()=="on")this.setupElementAttachment(t),r.body._kmwAttachment=t._kmwAttachment,this._inputList.push(t),this.emit("enabled",t);else if(this.embeddedPageContexts.filter(function(o){return o.document==r}).length==0){var i=new e(r,(0,d.__assign)((0,d.__assign)({},this.options),{owner:t}));this.embeddedPageContexts.push(i),i.on("enabled",function(o){return n.emit("enabled",o)}),i.on("disabled",function(o){return n.emit("disabled",o)}),i.install(this.manualAttach)}}}catch(o){}},e.prototype._DetachFromIframe=function(t){var n=this,r=function(){n.clearElementAttachment(t);var a=n._inputList.indexOf(t);a!=-1&&n._inputList.splice(a,1),n.emit("disabled",t)};try{var i=t.contentWindow.document;if(i){if(i.designMode.toLowerCase()=="on")i.body._kmwAttachment=null,r();else for(var o=0;o<this.embeddedPageContexts.length;o++)if(this.embeddedPageContexts[o].document==i){var l=this.embeddedPageContexts.splice(o,1)[0];l._ClearDocument(i.body),l.shutdown(),this.embeddedPageContexts.splice(o,1);break}}}catch(a){t._kmwAttachment&&r()}},e.prototype.attachToControl=function(t){var n=this.device.touchable;this.isAttached(t)&&!(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(t)?this.isKMWDisabled(t)?this.emit("disabled",t):n?this.enableTouchElement(t):this.enableInputElement(t):n&&this.emit("disabled",t))},e.prototype.detachFromControl=function(t){(this.isAttached(t)||t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)&&(this.isKMWInput(t)&&(this.isKMWDisabled(t)||this._DisableControl(t)),this.clearElementAttachment(t))},e.prototype._DisableControl=function(t){(this.isAttached(t)||t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)&&(this.device.touchable&&this.disableTouchElement(t),this.listInputs(),this.disableInputElement(t))},e.prototype._EnableControl=function(t){this.isAttached(t)?(this.device.touchable?this.enableTouchElement(t):this.enableInputElement(t),this.listInputs()):P(t,"HTMLIFrameElement")&&this._AttachToIframe(t)},e.prototype.disableControl=function(t){this.isAttached(t)||console.warn("KeymanWeb is not attached to element "+t);var n=t.className;n.indexOf("kmw-disabled")<0&&(t.className=n?n+" kmw-disabled":"kmw-disabled")},e.prototype.enableControl=function(t){!this.isAttached(t)&&!P(t,"HTMLIFrameElement")&&console.warn("KeymanWeb is not attached to element "+t);var n=t.className,r=n.indexOf("kmw-disabled");r>=0&&(t.className=n.replace("kmw-disabled","").trim())},e.prototype.listInputs=function(){for(var t=[],n=document.getElementsByTagName("input"),r=document.getElementsByTagName("textarea"),i=0;i<n.length;i++)ee.isSupportedType(n[i].type)&&n[i].className.indexOf("kmw-disabled")<0&&t.push({ip:n[i],x:M(n[i]),y:D(n[i])});for(var i=0;i<r.length;i++)r[i].className.indexOf("kmw-disabled")<0&&t.push({ip:r[i],x:M(r[i]),y:D(r[i])});t.sort(function(l,a){return l.y!=a.y?l.y-a.y:l.x-a.x});for(var o=[],i=0;i<t.length;i++)o.push(t[i].ip);this._sortedInputs=o},e.prototype.findNeighboringInput=function(t,n){var r,i=this.sortedInputs;if(i.length==0)return null;for(r=0;r<i.length&&i[r]!=t;r++);return r==i.length&&!n&&r--,r=n?r-1:r+1,r=r>=i.length?r-i.length:r,r=r<0?r+i.length:r,i[r]},e.prototype._GetDocumentEditables=function(t){var n=[];if(t.ownerDocument&&t instanceof t.ownerDocument.defaultView.HTMLElement){var r=t.ownerDocument.defaultView;(t instanceof r.HTMLInputElement||t instanceof r.HTMLTextAreaElement||t instanceof r.HTMLIFrameElement)&&n.push(t)}if(t.getElementsByTagName){var i=function(o){return Ae(t.getElementsByTagName(o))};n=n.concat(i("INPUT"),i("TEXTAREA"),i("IFRAME"))}return t.querySelectorAll&&(n=n.concat(Ae(t.querySelectorAll("[contenteditable]")))),t.ownerDocument&&t instanceof t.ownerDocument.defaultView.HTMLElement&&t.isContentEditable&&n.push(t),n},e.prototype._SetupDocument=function(t){for(var n=this._GetDocumentEditables(t),r=0;r<n.length;r++)this.attachToControl(n[r])},e.prototype._ClearDocument=function(t){for(var n=this._GetDocumentEditables(t),r=0;r<n.length;r++)this.detachFromControl(n[r])},e.prototype.initMutationObservers=function(t,n){if(typeof MutationObserver=="function"){var r=t.querySelector("body"),i;n||(i={childList:!0,subtree:!0},this.attachmentObserver=new MutationObserver(this._AutoAttachObserverCore),this.attachmentObserver.observe(r,i)),i={subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["class","readonly"]},this.enablementObserver=new MutationObserver(this._EnablementMutationObserverCore),this.enablementObserver.observe(r,i),this.inputModeObserver=new MutationObserver(this._InputModeObserverCore),this.enableInputModeObserver()}else console.warn("Your browser is outdated and does not support MutationObservers, a web feature needed by KeymanWeb to support dynamically-added elements.")},e.prototype.enableInputModeObserver=function(){var t,n=document.querySelector("body"),r={subtree:!0,attributes:!0,attributeFilter:["inputmode"]};(t=this.inputModeObserver)===null||t===void 0||t.observe(n,r)},e.prototype.disableInputModeObserver=function(){var t;(t=this.inputModeObserver)===null||t===void 0||t.disconnect()},e.prototype.getBaseFont=function(){var t=document.getElementsByTagName("input"),n=document.getElementsByTagName("textarea"),r=0,i,o="Arial,sans-serif";if(t.length==0&&n.length==0)r=0;else if(t.length>0&&n.length==0)r=1;else if(t.length==0&&n.length>0)r=2;else{var l=t[0],a=n[0];l.offsetTop<a.offsetTop?r=1:l.offsetTop>a.offsetTop?r=2:l.offsetLeft<a.offsetLeft?r=1:l.offsetLeft>a.offsetLeft&&(r=2)}switch(r){case 0:i=o;break;case 1:i=getComputedStyle(t[0]).fontFamily||"";break;case 2:i=getComputedStyle(n[0]).fontFamily||"";break}return(typeof i=="undefined"||i=="monospace")&&(i=o),i},e.prototype.buildAttachmentFontStyle=function(t){var n=t,r=this.baseFont;n&&typeof n.family!="undefined"&&(r=n.family),r=r.replace(/\u0022/g,"");var i=new RegExp("\\s?"+r+",?"),o=this.appliedFont.replace(/\u0022/g,"");o=o.replace(i,""),o=o.replace(/,$/,""),o==""?o=r:o=r+","+o,o='"'+o.replace(/\,\s?/g,'","')+'"';var l=".keymanweb-font{\nfont-family:"+o+" !important;\n}\n";return this.appliedFont=o,l},e.prototype.setAttachmentFont=function(t,n,r){this.stylesheetManager.unlinkAll(),this.stylesheetManager.addStyleSheetForFont(t,n,r),this.stylesheetManager.linkStylesheet(Lt(this.buildAttachmentFontStyle(t)))},e.prototype.shutdown=function(){var t,n,r,i;try{(t=this.enablementObserver)===null||t===void 0||t.disconnect(),(n=this.attachmentObserver)===null||n===void 0||n.disconnect(),(r=this.inputModeObserver)===null||r===void 0||r.disconnect(),(i=this.stylesheetManager)===null||i===void 0||i.unlinkAll(),this.inputModeObserver=null,this.embeddedPageContexts.forEach(function(s){try{s.shutdown()}catch(B){}});for(var o=0,l=this.inputList;o<l.length;o++){var a=l[o];try{this.detachFromControl(a)}catch(s){this.emit("disabled",a)}}this._inputList=[]}catch(s){console.error("Error occurred during shutdown"),console.error(s)}},e}(v.default);var la=function(){function c(e,t){this.activationPending=e,this.activated=t}return c}();var Ii=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this)||this;return n._maintainingFocus=!1,n.restoringFocus=!1,n._IgnoreNextSelChange=0,n.isTargetForcingScroll=t,n}return Object.defineProperty(e.prototype,"maintainingFocus",{get:function(){return this._maintainingFocus},set:function(t){var n=this._maintainingFocus;this._maintainingFocus=t,n&&!t&&this.emit("maintainingfocusend")},enumerable:!1,configurable:!0}),e.prototype.getUIState=function(){return new la(this.maintainingFocus,this.restoringFocus)},e.prototype.setMaintainingFocus=function(t){this.maintainingFocus=!!t},e.prototype.setFocusTimer=function(){var t=this;this.focusing=!0,this.focusTimer=window.setTimeout(function(){t.focusing=!1},50)},e}(v.default);function Ui(c,e){var t=e!=null&&e.isRTL?"rtl":"ltr";c&&(c instanceof c.ownerDocument.defaultView.HTMLInputElement||c instanceof c.ownerDocument.defaultView.HTMLTextAreaElement?c.value.length==0&&(c.dir=t):typeof c.textContent=="string"&&c.textContent.length==0&&(c.dir=t))}var aa=function(c){(0,d.__extends)(e,c);function e(t,n){var r=c.call(this,t)||this;return r.cookieManager=new Qt("KeymanWeb_Keyboard"),r.focusAssistant=new Ii(function(){var i;return(i=r.activeTarget)===null||i===void 0?void 0:i.isForcingScroll()}),r.domEventTracker=new Vt,r._ControlFocus=function(i){var o=Jt(i);return o&&r.setActiveTarget(o,!0),!0},r._ControlBlur=function(i){if(r.focusAssistant._IgnoreNextSelChange)return r.focusAssistant._IgnoreNextSelChange--,i.cancelBubble=!0,i.stopPropagation(),!0;if(r.focusAssistant.isTargetForcingScroll())return i.cancelBubble=!0,i.stopPropagation(),!0;var o=Jt(i);if(o==null)return!0;r.lastActiveTarget&&r._BlurKeyboardSettings(r.lastActiveTarget.getElement());var l=r.activeTarget;r.currentTarget=null,(l||r.lastActiveTarget)&&(r.mostRecentTarget=o),r.focusAssistant.restoringFocus=!1;var a=r.activeKeyboard,s=r.focusAssistant.maintainingFocus;return!s&&a&&a.keyboard.notify(0,o,0),l&&!r.activeTarget&&r.emit("targetchange",null),r.apiEvents.callEvent("controlblurred",{target:o.getElement(),event:i,isActivating:s}),r.doChangeEvent(o),r.resetContext(),!0},r._Click=function(i){return r.resetContext(),!0},r.nonKMWTouchHandler=function(i){r.focusAssistant.focusing=!1,clearTimeout(r.focusAssistant.focusTimer),r.forgetActiveTarget()},r._eventsObj=n,r.page=new pr(window.document,{hostDevice:r.engineConfig.hostDevice}),r.focusAssistant.on("maintainingfocusend",function(){!r.activeTarget&&r.mostRecentTarget&&r.emit("targetchange",r.activeTarget)}),r}return Object.defineProperty(e.prototype,"apiEvents",{get:function(){return this._eventsObj()},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){var t=this;this.on("keyboardasyncload",function(n,r){var i;(i=t.engineConfig.alertHost)===null||i===void 0||i.wait("Installing keyboard<br/>"+n.name),r.then(function(){var o;(o=t.engineConfig.alertHost)===null||o===void 0||o.wait()})}),this.engineConfig.deferForInitialization.then(function(){var n=t.engineConfig.hostDevice,r=function(i){return i.stopPropagation()};t.page.on("enabled",function(i){if(!(i._kmwAttachment.interface instanceof et))n.touchable&&(t.domEventTracker.detachDOMEvent(i,"touchstart",t.nonKMWTouchHandler),t.domEventTracker.attachDOMEvent(i,"touchmove",r,!1),t.domEventTracker.attachDOMEvent(i,"touchend",r,!1)),t.domEventTracker.attachDOMEvent(i,"focus",t._ControlFocus),t.domEventTracker.attachDOMEvent(i,"blur",t._ControlBlur),t.domEventTracker.attachDOMEvent(i,"click",t._Click);else{var o=i.contentWindow.document;n.browser=="firefox"?(t.domEventTracker.attachDOMEvent(o,"focus",t._ControlFocus),t.domEventTracker.attachDOMEvent(o,"blur",t._ControlBlur)):(t.domEventTracker.attachDOMEvent(o.body,"focus",t._ControlFocus),t.domEventTracker.attachDOMEvent(o.body,"blur",t._ControlBlur))}i.ownerDocument.activeElement==i&&t.setActiveTarget(Ct(i),!0)}),t.page.on("disabled",function(i){var o;if(!P(i,"HTMLIFrameElement"))n.touchable&&t.domEventTracker.attachDOMEvent(i,"touchstart",t.nonKMWTouchHandler,!1),t.domEventTracker.detachDOMEvent(i,"focus",t._ControlFocus),t.domEventTracker.detachDOMEvent(i,"blur",t._ControlBlur),t.domEventTracker.detachDOMEvent(i,"click",t._Click);else{var l=i.contentWindow.document;n.browser=="firefox"?(t.domEventTracker.detachDOMEvent(l,"focus",t._ControlFocus),t.domEventTracker.detachDOMEvent(l,"blur",t._ControlBlur)):(t.domEventTracker.detachDOMEvent(l.body,"focus",t._ControlFocus),t.domEventTracker.detachDOMEvent(l.body,"blur",t._ControlBlur))}var a=(o=t.mostRecentTarget)===null||o===void 0?void 0:o.getElement();a&&a==i&&t.forgetActiveTarget()}),t.page.install(t.engineConfig.attachType=="manual")})},Object.defineProperty(e.prototype,"activeTarget",{get:function(){var t=this.focusAssistant.maintainingFocus;return this.currentTarget||(t?this.mostRecentTarget:null)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastActiveTarget",{get:function(){return this.mostRecentTarget},enumerable:!1,configurable:!0}),e.prototype.deactivateCurrentTarget=function(){var t=this.activeTarget||this.lastActiveTarget;t&&this.page.isAttached(t.getElement())&&this._BlurKeyboardSettings(t.getElement()),this.activeTarget||this.setActiveTarget(null,!0)},e.prototype.forgetActiveTarget=function(){this.focusAssistant.maintainingFocus=!1,this.focusAssistant.restoringFocus=!1;var t=this.activeTarget||this.mostRecentTarget;t&&this._BlurKeyboardSettings(t.getElement()),this.setActiveTarget(null,!0),t==this.lastActiveTarget&&(this.mostRecentTarget=null)},e.prototype.setActiveTarget=function(t,n){var r,i=this.mostRecentTarget,o=this.activeTarget;if(t==o){o&&(this.currentTarget=o);return}var l=!!i;if(this.currentTarget=this.mostRecentTarget=t,this.predictionContext.setCurrentTarget(t),this.focusAssistant.restoringFocus?this._BlurKeyboardSettings(t.getElement()):t&&this._FocusKeyboardSettings(t.getElement(),!l),!this._CommonFocusHelper(t)){var a=t==null?void 0:t.getElement();if(t instanceof et&&(a=t.docRoot),a&&a.ownerDocument&&a instanceof a.ownerDocument.defaultView.HTMLElement&&Ui(a,(r=this.activeKeyboard)===null||r===void 0?void 0:r.keyboard),t!=o&&this.emit("targetchange",t),n){var s=i==null?void 0:i.getElement();i instanceof et&&(s=i.docRoot),a?this.apiEvents.callEvent("controlfocused",{target:a,activeControl:s}):s&&this.apiEvents.callEvent("controlblurred",{target:s,event:null,isActivating:this.focusAssistant.maintainingFocus})}}},Object.defineProperty(e.prototype,"activeKeyboard",{get:function(){return this._activeKeyboard},enumerable:!1,configurable:!0}),e.prototype.restoreLastActiveTarget=function(){this.mostRecentTarget&&(this.focusAssistant.restoringFocus=!0,this.mostRecentTarget.focus(),this.focusAssistant.restoringFocus=!1)},e.prototype.insertText=function(t,n,r){this.restoreLastActiveTarget();var i=this.activeTarget;return i==null&&this.mostRecentTarget&&(i=this.activeTarget),i!=null?c.prototype.insertText.call(this,t,n,r):!1},e.prototype.currentKeyboardSrcTarget=function(){var t=this.currentTarget||this.mostRecentTarget;return this.isTargetKeyboardIndependent(t)?t:null},e.prototype.isTargetKeyboardIndependent=function(t){var n=t==null?void 0:t.getElement()._kmwAttachment;return!!(n!=null&&n.keyboard||(n==null?void 0:n.keyboard)==="")},e.prototype.activateKeyboardForTarget=function(t,n){var r,i,o=n==null?void 0:n.getElement()._kmwAttachment;if(o?(o.keyboard=(r=t==null?void 0:t.metadata.id)!==null&&r!==void 0?r:"",o.languageCode=(i=t==null?void 0:t.metadata.langId)!==null&&i!==void 0?i:""):this.globalKeyboard=t,this.currentKeyboardSrcTarget()==n){this._activeKeyboard=t;var l=t==null?void 0:t.metadata;this.page.setAttachmentFont(l==null?void 0:l.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS)}},e.prototype.setKeyboardForTarget=function(t,n,r){if(t instanceof et){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}var i=t.getElement()._kmwAttachment,o=this.currentKeyboardSrcTarget()==t;if(i){if(i.keyboard=n||null,i.languageCode=r||null,o||this.currentKeyboardSrcTarget()==t){var l=this.globalKeyboard.metadata;this.activateKeyboard(i.keyboard||l.id,i.languageCode||l.langId,!0)}}else return},e.prototype.getKeyboardStubForTarget=function(t){if(this.isTargetKeyboardIndependent(t)){var n=t.getElement()._kmwAttachment;return this.keyboardCache.getStub(n.keyboard,n.languageCode)}else return this.globalKeyboard.metadata},e.prototype.getFallbackStubKey=function(){var t={id:"",langId:""};return this.engineConfig.hostDevice.touchable&&this.keyboardCache.defaultStub||t},e.prototype.activateKeyboard=function(t,n,r){return(0,d.__awaiter)(this,void 0,void 0,function(){var i,o,l,a,s,B=this,g,u,F,y,I,Q;return(0,d.__generator)(this,function(U){switch(U.label){case 0:return r||(r=!1),i=this.currentKeyboardSrcTarget(),this.engineConfig.deferForInitialization.isFulfilled?[3,2]:[4,this.engineConfig.deferForInitialization.corePromise];case 1:U.sent(),U.label=2;case 2:t||(t=this.getFallbackStubKey().id,n=this.getFallbackStubKey().langId),U.label=3;case 3:return U.trys.push([3,5,,9]),[4,c.prototype.activateKeyboard.call(this,t,n,r)];case 4:return o=U.sent(),(g=this.engineConfig.alertHost)===null||g===void 0||g.wait(),r&&!i&&this.cookieManager.save({current:"".concat(t,":").concat(n)}),i==this.currentKeyboardSrcTarget()&&(Ui((u=this.currentTarget)===null||u===void 0?void 0:u.getElement(),this.keyboardCache.getKeyboard(t)),this.page.setAttachmentFont((y=(F=this.activeKeyboard)===null||F===void 0?void 0:F.metadata)===null||y===void 0?void 0:y.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS),this.restoreLastActiveTarget()),[2,o];case 5:return l=U.sent(),a=function(){return(0,d.__awaiter)(B,void 0,void 0,function(){var h;return(0,d.__generator)(this,function(b){switch(b.label){case 0:return h=this.getFallbackStubKey(),h.id==t?[3,2]:[4,this.activateKeyboard(h.id,h.langId,!0).catch(function(){})];case 1:b.sent(),b.label=2;case 2:return[2]}})})},(I=this.engineConfig.alertHost)===null||I===void 0||I.wait(),s=(l==null?void 0:l.message)||"Sorry, the "+t+" keyboard for "+n+" is not currently available.",l instanceof ge?console.error(l||s):console.warn(l||s),this.engineConfig.alertHost?((Q=this.engineConfig.alertHost)===null||Q===void 0||Q.alert(s,a),[3,8]):[3,6];case 6:return[4,a()];case 7:U.sent(),U.label=8;case 8:throw l;case 9:return[2]}})})},e.prototype._BlurKeyboardSettings=function(t,n,r){var i,o=this.activeKeyboard?this.activeKeyboard.keyboard.id:"",l=(i=this.activeKeyboard)===null||i===void 0?void 0:i.metadata.langId;n!==void 0&&r!==void 0&&(o=n,l=r),t&&t._kmwAttachment.keyboard!=null?(t._kmwAttachment.keyboard=o,t._kmwAttachment.languageCode=l):this.globalKeyboard=this.activeKeyboard},e.prototype._FocusKeyboardSettings=function(t,n){var r,i=t._kmwAttachment,o=this.globalKeyboard;i.keyboard!=null?this.activateKeyboard(i.keyboard,i.languageCode,!0):!n&&(o==null?void 0:o.metadata)!=((r=this._activeKeyboard)===null||r===void 0?void 0:r.metadata)&&this.activateKeyboard(o==null?void 0:o.metadata.id,o==null?void 0:o.metadata.langId,!0)},e.prototype._CommonFocusHelper=function(t){var n,r=this.focusAssistant,i=(n=this.activeKeyboard)===null||n===void 0?void 0:n.keyboard;return r.restoringFocus||(t==null||t.deadkeys().clear(),i==null||i.notify(0,t,1)),!r.restoringFocus&&this.mostRecentTarget!=t&&(r.maintainingFocus=!1),r.restoringFocus=!1,this.resetContext(),!1},e.prototype.doChangeEvent=function(t){if(t.changed){var n=new Event("change",{bubbles:!0,cancelable:!1});t.getElement().dispatchEvent(n)}t.changed=!1},e.prototype.getSavedKeyboardRaw=function(){var t=new Qt("KeymanWeb_Keyboard"),n=t.load(decodeURIComponent);return typeof n.current!="string"||n.current=="Keyboard_us:eng"?"Keyboard_us:en":n.current},e.prototype.getSavedKeyboard=function(){for(var t=this.getSavedKeyboardRaw(),n=this.keyboardCache.getStubList(),r,i=0;i<n.length;i++)if(r=n[i].KI+":"+n[i].KLC,r==t)return r;for(var i=0;i<n.length;i++)if(r=n[i].KI+":"+n[i].KLC,r=="Keyboard_us:en")return r;return n.length>0?n[0].KI+":"+n[0].KLC:"Keyboard_us:en"},e.prototype.restoreSavedKeyboard=function(t){var n=t,r=n.split(":");r.length<2&&(r[1]="");var i=this.keyboardCache.getStub(r[0],r[1])||this.keyboardCache.defaultStub;return i?this.activateKeyboard(i.id,i.langId):null},e.prototype.shutdown=function(){this.page.shutdown(),this.domEventTracker.shutdown()},e}(Zn),hi=aa;var sa=function(c){(0,d.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.contextManager=t,n}return e.prototype.isCommand=function(t){var n=this.codeForEvent(t);switch(n){case C.keyCodes.K_TAB:case C.keyCodes.K_TABBACK:case C.keyCodes.K_TABFWD:return!0;default:return c.prototype.isCommand.call(this,t)}},e.prototype.applyCommand=function(t,n){var r=this,i=this.codeForEvent(t),o=function(l){var a,s=r.contextManager,B=(a=s.activeTarget)===null||a===void 0?void 0:a.getElement(),g=s.page.findNeighboringInput(B,l);g==null||g.focus()};switch(i){case C.keyCodes.K_TAB:o((t.Lmodifiers&C.modifierCodes.SHIFT)!=0);break;case C.keyCodes.K_TABBACK:o(!0);break;case C.keyCodes.K_TABFWD:o(!1);break}c.prototype.applyCommand.call(this,t,n)},e}(Tt),bi=sa;function Gr(c){return c.keyCode?c.keyCode:c.which?c.which:null}function nn(c,e,t){if(c.cancelBubble===!0)return null;var n=Gr(c);if(n==null)return null;var r=e.modStateFlags,i=0,o=!1,l=!1,a=C.keyCodes;switch(n){case a.K_CTRL:case a.K_LCTRL:case a.K_RCTRL:case a.K_CONTROL:case a.K_LCONTROL:case a.K_RCONTROL:o=!0;break;case a.K_LMENU:case a.K_RMENU:case a.K_ALT:case a.K_LALT:case a.K_RALT:l=!0;break}i|=c.getModifierState("Shift")?16:0;var s=C.modifierCodes;c.getModifierState("Control")&&(i|=c.location!=0&&o?c.location==1?s.LCTRL:s.RCTRL:r&3),c.getModifierState("Alt")&&(i|=c.location!=0&&l?c.location==1?s.LALT:s.RALT:r&12);var B=0;B|=c.getModifierState("CapsLock")?s.CAPS:s.NO_CAPS,B|=c.getModifierState("NumLock")?s.NUM_LOCK:s.NO_NUM_LOCK,B|=c.getModifierState("ScrollLock")?s.SCROLL_LOCK:s.NO_SCROLL_LOCK,i|=B;var g=e.modStateFlags!=i;e.modStateFlags=i;var u=s.RALT|s.LCTRL;(r&u)==u&&(i&u)!=u&&(i&=~u),i&s.RALT&&(i&=~s.LCTRL);var F=C.modifierBitmasks,y=e.activeKeyboard,I;y&&y.isChiral?(I=i&F.CHIRAL,y.emulatesAltGr&&(I&F.ALT_GR_SIM)==F.ALT_GR_SIM&&(I^=F.ALT_GR_SIM,I|=s.RALT)):I=i&16|(i&(s.LCTRL|s.RCTRL)?32:0)|(i&(s.LALT|s.RALT)?64:0),I|=c.metaKey?s.META:0,t.browser==f.Browser.Firefox&&dt.browserMap.FF["k"+n]&&(n=dt.browserMap.FF["k"+n]);var Q=new Bt({device:t,kName:"",Lcode:n,Lmodifiers:I,Lstates:B,LmodifierChange:g,isSynthetic:!1}),U=typeof c.charCode!="undefined"&&c.charCode!=null&&(c.charCode==0||(I&111)!=0);Q.LisVirtualKey=U||c.type!="keypress",Q=fn(Q,y,e.baseLayout);var h=new Bt(Q);return h.source=c,h}var Ba=function(c){(0,d.__extends)(e,c);function e(t,n,r){var i=c.call(this)||this;i.domEventTracker=new Vt,i.swallowKeypress=!1,i._KeyDown=function(a){var s,B=i.contextManager.activeKeyboard,g=Jt(a);if(!g||B==null)return!0;var u=g.getElement();return((s=u==null?void 0:u.getAttribute("class"))===null||s===void 0?void 0:s.indexOf("kmw-disabled"))>=0?!0:i.keyDown(a)},i._KeyPress=function(a){var s,B=Jt(a);return!B||((s=i.contextManager.activeKeyboard)===null||s===void 0?void 0:s.keyboard)==null?!0:i.keyPress(a)},i._KeyUp=function(a){var s=Jt(a),B=nn(a,i.processor,i.hardDevice);if(B==null||s==null)return!0;var g=s.getElement();if(B.Lcode==13){var u=!1;if(P(g,"HTMLTextAreaElement")&&(u=!0),!u){if(g instanceof g.ownerDocument.defaultView.HTMLInputElement)if(g.form&&(g.type=="search"||g.type=="submit"))g.form.submit();else{var F=i.contextManager.page.findNeighboringInput(g,!1);F.focus()}return!0}}return i.keyUp(a)},i.hardDevice=t,i.contextManager=r,i.processor=n;var o=r.page,l=i.domEventTracker;return o.on("enabled",function(a){var s=Ct(a);if(!(s instanceof et))l.attachDOMEvent(a,"keypress",i._KeyPress),l.attachDOMEvent(a,"keydown",i._KeyDown),l.attachDOMEvent(a,"keyup",i._KeyUp);else{var B=s.getElement().contentDocument;l.attachDOMEvent(B.body,"keydown",i._KeyDown),l.attachDOMEvent(B.body,"keypress",i._KeyPress),l.attachDOMEvent(B.body,"keyup",i._KeyUp)}}),o.on("disabled",function(a){var s=Ct(a);if(!(s instanceof et))l.detachDOMEvent(a,"keypress",i._KeyPress),l.detachDOMEvent(a,"keydown",i._KeyDown),l.detachDOMEvent(a,"keyup",i._KeyUp);else{var B=s.getElement().contentDocument;l.detachDOMEvent(B.body,"keydown",i._KeyDown),l.detachDOMEvent(B.body,"keypress",i._KeyPress),l.detachDOMEvent(B.body,"keyup",i._KeyUp)}}),i}return e.prototype.keyDown=function(t){var n=this;this.swallowKeypress=!1;var r=nn(t,this.processor,this.hardDevice);if(r==null)return!0;var i={LeventMatched:!1};return this.emit("keyevent",r,function(o,l){i.LeventMatched=o&&!o.triggerKeyDefault,i.LeventMatched?(t&&t.preventDefault&&(t.preventDefault(),t.stopPropagation()),n.swallowKeypress=!!r.Lcode,r.Lcode==8&&(n.swallowKeypress=!1)):n.swallowKeypress=!1}),!i.LeventMatched},e.prototype.keyUp=function(t){var n=nn(t,this.processor,this.hardDevice);if(n==null)return!0;var r=Jt(t);return this.processor.doModifierPress(n,r,!1)},e.prototype.keyPress=function(t){var n,r=nn(t,this.processor,this.hardDevice);if(r==null||r.LisVirtualKey)return!0;if(!(!((n=this.contextManager.activeKeyboard)===null||n===void 0)&&n.keyboard.isMnemonic))return!this.swallowKeypress||r.Lcode<32||this.hardDevice.browser==f.Browser.Safari&&r.Lcode>63232&&r.Lcode<63744;var i={};return this.swallowKeypress||this.emit("keyevent",r,function(o,l){i.preventDefaultKeystroke=!!o}),this.swallowKeypress||i.preventDefaultKeystroke?(this.swallowKeypress=!1,t&&t.preventDefault&&(t.preventDefault(),t.stopPropagation()),!1):(this.swallowKeypress=!1,!0)},e.prototype.shutdown=function(){this.domEventTracker.shutdown()},e}(vn),Ci=Ba;var pi=function(){function c(){this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}return c.prototype.equals=function(e){return this.innerWidth==e.innerWidth&&this.innerHeight==e.innerHeight},c}(),Gi=function(){function c(e){this.idlePermutationCounter=c.IDLE_PERMUTATION_CAP,this.keyman=e}return c.prototype.resolve=function(){var e=this,t,n=this.keyman.osk;(t=this.keyman.touchLanguageMenu)===null||t===void 0||t.hide(),this.keyman.touchLanguageMenu=null,n.setNeedsLayout(),this.oskVisible&&n.present(),this.isActive=!1,this.updateTimer&&(window.clearInterval(this.updateTimer),this.rotState=null);var r=this.keyman.contextManager.activeTarget;r&&window.setTimeout(function(){e.keyman.ensureElementVisibility(r.getElement())},0)},c.prototype.initNewRotation=function(){this.oskVisible=this.keyman.osk.isVisible(),this.keyman.osk.hideNow(),this.isActive=!0},c.prototype.init=function(){var e=this,t=this.keyman.config.hostDevice.OS,n=this.keyman.util;t=="ios"?(n.attachDOMEvent(window,"orientationchange",function(){return e.iOSEventHandler(),!1}),n.attachDOMEvent(window,"resize",function(){return e.iOSEventHandler(),!1})):t=="android"&&("onmozorientationchange"in screen?n.attachDOMEvent(screen,"mozorientationchange",function(){return e.initNewRotation(),!1}):n.attachDOMEvent(window,"orientationchange",function(){return e.initNewRotation(),!1}),n.attachDOMEvent(window,"resize",function(){return e.resolve(),!1}))},c.prototype.iOSEventHandler=function(){this.isActive||(this.initNewRotation(),this.rotState=new pi,this.updateTimer=window.setInterval(this.iOSEventUpdate.bind(this),c.UPDATE_INTERVAL)),this.idlePermutationCounter=0},c.prototype.iOSEventUpdate=function(){var e=new pi;this.rotState.equals(e)?++this.idlePermutationCounter==c.IDLE_PERMUTATION_CAP&&this.resolve():(this.rotState=e,this.idlePermutationCounter=0)},c.IDLE_PERMUTATION_CAP=15,c.UPDATE_INTERVAL=20,c}();var mi=function(){function c(e,t){var n=this;this.domEventTracker=new Vt,this.suppressFocusCheck=function(r){return n.focusAssistant.isTargetForcingScroll()&&(r.stopPropagation(),r.cancelBubble=!0),!0},this.pageFocusHandler=function(){var r;return!n.focusAssistant.maintainingFocus&&(!((r=n.engine.osk)===null||r===void 0)&&r.vkbd)&&(n.engine.contextManager.deactivateCurrentTarget(),n.engine.contextManager.resetContext()),!1},this.touchStartActivationHandler=function(r){var i,o,l=n.engine.osk;if(!l)return!1;var a=n.engine.config.hostDevice;if(n.deactivateOnRelease=!0,n.touchY=r.touches[0].screenY,n.deactivateOnScroll=!1,a.OS=="android"&&a.browser=="chrome"){if(typeof l._Box=="undefined"||typeof l._Box.style=="undefined")return!1;var s=r.target.parentElement;if(typeof s!="undefined"&&s!=null&&(((i=s.getAttribute("class"))===null||i===void 0?void 0:i.indexOf("kmw-key-"))>=0||typeof s.parentElement!="undefined"&&s.parentElement!=null&&(s=s.parentElement,((o=s.getAttribute("class"))===null||o===void 0?void 0:o.indexOf("kmw-key-"))>=0)))return!1;n.deactivateOnScroll=!0}return!1},this.touchMoveActivationHandler=function(r){n.deactivateOnScroll&&(n.focusAssistant.focusing=!1,n.engine.contextManager.deactivateCurrentTarget());var i=r.touches[0].screenY,o=n.touchY;return(i-o>5||o-i<5)&&(n.deactivateOnRelease=!1),!1},this.touchEndActivationHandler=function(r){return n.deactivateOnRelease&&!n.engine.touchLanguageMenu&&!n.focusAssistant.focusing&&n.engine.contextManager.deactivateCurrentTarget(),n.deactivateOnRelease=!1,!1},this._WindowLoad=function(){document.body.scrollTop=0,typeof document.documentElement!="undefined"&&(document.documentElement.scrollTop=0)},this._WindowUnload=function(){n.engine.shutdown()},this.window=e,this.engine=t,this.attachHandlers(),t.config.hostDevice.touchable&&(this.buildPageTrailer(),this.rotationProcessor=new Gi(this.engine),this.rotationProcessor.init())}return c.prototype.buildPageTrailer=function(){var e=this.mobilePageTrailer=document.createElement("div"),t=e.style;t.width="100%",t.height=screen.width/2+"px",document.body.appendChild(e)},Object.defineProperty(c.prototype,"focusAssistant",{get:function(){return this.engine.contextManager.focusAssistant},enumerable:!1,configurable:!0}),c.prototype.attachHandlers=function(){var e=this.domEventTracker,t=this.engine.config.hostDevice,n=this.window.document.body;e.attachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),e.attachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),e.attachDOMEvent(n,"focus",this.suppressFocusCheck,!0),e.attachDOMEvent(n,"blur",this.suppressFocusCheck,!0),t.touchable&&(e.attachDOMEvent(n,"touchstart",this.touchStartActivationHandler,!1),e.attachDOMEvent(n,"touchmove",this.touchMoveActivationHandler,!1),e.attachDOMEvent(n,"touchend",this.touchEndActivationHandler,!1)),e.attachDOMEvent(window,"load",this._WindowLoad,!1),e.attachDOMEvent(window,"unload",this._WindowUnload,!1),e.attachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)},c.prototype.shutdown=function(){var e,t=this.domEventTracker,n=this.engine.config.hostDevice,r=this.window.document.body;t.detachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),t.detachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),t.detachDOMEvent(r,"focus",this.suppressFocusCheck,!0),t.detachDOMEvent(r,"blur",this.suppressFocusCheck,!0),n.touchable&&(t.detachDOMEvent(r,"touchstart",this.touchStartActivationHandler,!1),t.detachDOMEvent(r,"touchmove",this.touchMoveActivationHandler,!1),t.detachDOMEvent(r,"touchend",this.touchEndActivationHandler,!1),(e=this.mobilePageTrailer)===null||e===void 0||e.parentElement.removeChild(this.mobilePageTrailer)),t.detachDOMEvent(window,"load",this._WindowLoad,!1),t.detachDOMEvent(window,"unload",this._WindowUnload,!1),t.detachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)},c}();function lt(c){var e=document.createElement(c);return e.style.userSelect="none",e.style.MozUserSelect="none",e.style.KhtmlUserSelect="none",e.style.UserSelect="none",e.style.WebkitUserSelect="none",e}function Mt(c,e){try{if(c&&typeof window.getComputedStyle!="undefined")return window.getComputedStyle(c,"").getPropertyValue(e)}catch(t){}return""}var xi=function(){function c(e){this.keyman=e,this.scrolling=!1,this.shim=this.constructShim()}return c.prototype.constructShim=function(){var e=this,t=this,n=lt("div"),r=this.keyman.osk;return n.id="kmw-language-menu-background",n.addEventListener("touchstart",function(i){if(i.preventDefault(),t.hide(),i.touches.length>2){var o=i.touches[1].pageX,l=i.touches[1].pageY,a=r.vkbd.spaceBar;o>a.offsetLeft&&o<a.offsetLeft+a.offsetWidth&&l>a.offsetTop&&l<a.offsetTop+a.offsetHeight&&e.keyman.osk.emit("showbuild")}},!1),n},c.prototype.show=function(){var e=this.keyman.config.hostDevice,t=this.keyman.keyboardRequisitioner.cache.getStubList(),n=t.length;if(!(n<1)){var r=this.lgList=lt("div");this.lgList.id="kmw-language-menu";var i=this;document.body.appendChild(this.shim);var o=lt("div"),l=o.style,a=lt("div");o.id="kmw-menu-scroll-container",a.id="kmw-menu-scroller","WebkitOverflowScrolling"in l&&(l.WebkitOverflowScrolling="touch"),o.appendChild(a),r.appendChild(o);var s,B=lt("div");B.id="kmw-menu-index";for(var g=1;g<=26;g++)s=lt("p"),s.innerHTML=String.fromCharCode(g+64),B.appendChild(s);if(B.addEventListener("touchstart",function(p){i.scrollToLanguage(p,o,a)},!1),B.addEventListener("touchend",function(p){p.stopPropagation()},!1),r.appendChild(B),r.addEventListener("scroll",function(p){i.scrolling=!0},!1),o.addEventListener("scroll",function(p){o.scrollTop<1&&(o.scrollTop=1),o.scrollTop>o.scrollHeight-o.offsetHeight-1&&(o.scrollTop=o.scrollHeight-o.offsetHeight-1)},!1),this.activeLgNo=this.addLanguages(a,t),this.lgList.style.visibility="hidden",document.body.appendChild(this.lgList),e.OS=="android"&&"devicePixelRatio"in window&&(this.lgList.style.fontSize=2/window.devicePixelRatio+"em"),e.OS=="android"&&e.formFactor=="tablet"&&"devicePixelRatio"in window){var u=parseInt(Mt(r,"width"),10),F=r.style;isNaN(u)||(F.width=F.maxWidth=2*u/window.devicePixelRatio+"px"),u=parseInt(Mt(o,"width"),10),F=o.style,isNaN(u)||(F.width=F.maxWidth=2*u/window.devicePixelRatio+"px"),u=parseInt(Mt(a,"width"),10),F=a.style,isNaN(u)||(F.width=F.maxWidth=2*u/window.devicePixelRatio+"px")}this.adjust(0);var y=B.childNodes[1].offsetTop-B.childNodes[0].offsetTop,I=Math.floor(r.offsetHeight/26),Q=Math.round(100*I/y)/100,U=Q>.6?1:2;Q>1.25&&(Q=1.25);for(var g=0;g<26;g++){var h=B.childNodes[g].style;U==2&&g%2==1?h.display="none":(h.fontSize=Q*U+"em",h.lineHeight=I*U+"px")}var b=o.offsetWidth;o.scrollHeight>o.offsetHeight+3?b=b+B.offsetWidth:B.style.display="none",r.style.width=b+"px",this.lgList.style.visibility="",this.scrollToIndex(this.activeLgNo,o,a)}},c.prototype.adjust=function(e){var t=this.keyman.osk,n=this.keyman.config.hostDevice,r=this.lgList,i=r.firstChild,o=i.firstChild,l=0,a=r.style,s=r.childNodes[1],B=window.innerHeight-t.vkbd.lgKey.offsetHeight-16,g=o.childNodes.length+e-1,u=o.firstChild.firstChild.offsetHeight,F=g*u;n.OS=="ios"&&(n.formFactor=="phone"?(l=it()?36:0,B=(window.innerHeight-l-16)*ht(n.formFactor)):n.formFactor=="tablet"&&(l=it()?16:0,B=B-l)),a.left=M(t.vkbd.lgKey)+"px",F>B&&(F=B),a.height=F+"px",a.bottom="0px",s.style.height=i.style.height=a.height},c.prototype.scrollToLanguage=function(e,t,n){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();var r=e.touches[0].target;if(r.nodeName=="P"){var i,o,l=r.innerHTML.charCodeAt(0),a=n.childNodes;try{for(i=0;i<a.length-1&&(o=a[i].firstChild.innerHTML.toUpperCase().charCodeAt(0),!(o>=l));i++);}catch(s){}this.scrollToIndex(i,t,n)}},c.prototype.scrollToIndex=function(e,t,n){var r,i=.5;try{r=n.firstChild.getBoundingClientRect().height*(e-i)+1,t.scrollTop=r}catch(o){r=0}try{t.scrollTop<0&&(t.scrollTop=0),t.scrollTop>t.scrollHeight-t.offsetHeight-1&&(t.scrollTop=t.scrollHeight-t.offsetHeight-1)}catch(o){}},c.prototype.addLanguages=function(e,t){for(var n,r=t.length,i=this.keyman.config.hostDevice,o=[],l=0;l<r;l++){var a=t[l].KL;o.indexOf(a)==-1&&o.push(a)}o.sort();for(var s=Math.round(100/ht(i.formFactor))/100,B=-1,g=function(Q){var U=lt("div");U.className="kbd-list-closed";var h=lt("p");h.kList=[];for(var b=0;b<r;b++)t[b].KL==o[Q]&&h.kList.push(t[b]);i.OS=="ios"&&(h.style.fontSize=s+"em"),U.appendChild(h),e.appendChild(U),o[Q]==((n=u.keyman.contextManager.activeKeyboard)===null||n===void 0?void 0:n.metadata.langName)&&(B=Q);var p=u;if(h.kList.length>1){h.className="kbd-list",h.innerHTML=o[Q]+"...",h.scrolled=!1,h.ontouchend=function(m){m.stopPropagation(),h.scrolled?h.scrolled=!1:h.parentElement.className=h.parentElement.className=="kbd-list-closed"?"kbd-list-open":"kbd-list-closed",p.adjust(h.parentElement.className=="kbd-list-closed"?0:h.kList.length)},h.addEventListener("touchstart",function(m){m.stopPropagation()},!1),h.addEventListener("touchmove",function(m){h.scrolled=!0,m.stopPropagation()},!1);for(var X=0;X<h.kList.length;X++){var x=lt("p");x.className="kbd-list-entry",i.OS=="ios"&&(x.style.fontSize=s+"em"),u.addKeyboard(h.kList[X],x,!1),U.appendChild(x)}}else h.innerHTML=o[Q],h.className="kbd-single-entry",u.addKeyboard(h.kList[0],h,!0);Q==B&&(h.className=h.className+" current")},u=this,F=0;F<o.length;F++)g(F);var y=lt("div");y.id="kmw-menu-footer";var I=function(Q){Q.cancelable&&Q.preventDefault(),Q.stopPropagation()};return y.addEventListener("touchstart",I,!1),y.addEventListener("touchmove",I,!1),y.addEventListener("touchend",I,!1),e.appendChild(y),B},c.prototype.addKeyboard=function(e,t,n){var r=this;t.kn=e.KI,t.kc=e.KLC,t.innerHTML=n?e.KL:e.KN.replace(" Keyboard","");var i=this,o=function(){if(r.originalBodyStyle)return console.error("Unexpected state:  `originalBodyStyle` was not cleared by a previous `unlockBodyScroll()` call"),!1;r.originalBodyStyle={};var u=r.originalBodyStyle,F=document.body.style;return u.overflowY=F.overflowY,u.height=F.height,F.overflowY="hidden",F.height="100%",!0},l=function(){if(!r.originalBodyStyle){console.error("Unexpected state:  `originalBodyStyle` is unset; cannot restore original body style");return}var u=r.originalBodyStyle,F=document.body.style;F.overflowY=u.overflowY,F.height=u.height,r.originalBodyStyle=null},a=function(u){u.stopPropagation(),this.className.indexOf("selected")<=0&&(this.className=this.className+" selected"),i.scrolling=!1,i.y0=u.touches[0].pageY,o()},s=function(u){u.stopImmediatePropagation();var F=i.lgList.childNodes[0],y=F.scrollHeight-F.offsetHeight,I,Q;if(typeof u.pageY!="undefined")I=u.pageY;else if(typeof u.touches!="undefined")I=u.touches[0].pageY;else return!1;if(Q=I-i.y0,Q<0)F.scrollTop>=y-1&&(i.y0=I);else if(Q>0)F.scrollTop<2&&(i.y0=I);else return!1;return(Q<-5||Q>5)&&(i.scrolling=!0,this.className=this.className.replace(/\s*selected/,""),i.y0=I),!0},B=function(u){var F=this;return typeof u.stopImmediatePropagation!="undefined"?u.stopImmediatePropagation():u.stopPropagation(),i.scrolling?this.className=this.className.replace(/\s*selected/,""):(i.keyman.contextManager.focusAssistant.setFocusTimer(),i.lgList.style.display="none",i.keyman.contextManager.activateKeyboard(F.kn,F.kc,!0),i.keyman.contextManager.restoreLastActiveTarget(),i.hide()),l(),!0},g=function(u){l()};t.addEventListener("touchstart",a,!1),t.addEventListener("touchmove",s,!1),t.addEventListener("touchend",B,!1),t.addEventListener("touchcancel",g,!1)},c.prototype.hide=function(){var e=this,t=this.keyman.osk;this.lgList&&(t.vkbd.highlightKey(t.vkbd.lgKey,!1),this.lgList.style.visibility="hidden",window.setTimeout(function(){e.shim.parentElement&&(document.body.removeChild(e.shim),document.body.removeChild(e.lgList))},500)),this.keyman.touchLanguageMenu=null},c}();function Xi(c,e,t){var n=this,r=t.focusAssistant;e.on("globekey",function(i,o){o&&e.hostDevice.touchable&&(c.touchLanguageMenu=new xi(c),c.touchLanguageMenu.show()),e.vkbd&&e.vkbd.highlightKey(i,!1)}),e.on("hiderequested",function(i){e&&(e.startHide(!0),t.forgetActiveTarget())}),e.addEventListener("hide",function(i){var o;i!=null&&i.HiddenByUser&&((o=t.activeTarget)===null||o===void 0||o.focus())}),e.on("showbuild",function(){var i;(i=c.config.alertHost)===null||i===void 0||i.alert("KeymanWeb Version "+un.VERSION+'<br /><br /><span style="font-size:0.8em">Copyright &copy; 2007-2023 SIL International</span>')}),e.on("dragmove",function(i){return(0,d.__awaiter)(n,void 0,void 0,function(){return(0,d.__generator)(this,function(o){switch(o.label){case 0:return r.restoringFocus=!0,[4,i];case 1:return o.sent(),t.restoreLastActiveTarget(),r.restoringFocus=!1,r.setMaintainingFocus(!1),[2]}})})}),e.on("resizemove",function(i){return(0,d.__awaiter)(n,void 0,void 0,function(){return(0,d.__generator)(this,function(o){switch(o.label){case 0:return r.restoringFocus=!0,[4,i];case 1:return o.sent(),t.restoreLastActiveTarget(),r.restoringFocus=!1,r.setMaintainingFocus(!1),[2]}})})}),e.on("pointerinteraction",function(i){return(0,d.__awaiter)(n,void 0,void 0,function(){return(0,d.__generator)(this,function(o){switch(o.label){case 0:return r.setMaintainingFocus(!0),[4,i];case 1:return o.sent(),r.setMaintainingFocus(!1),[2]}})})})}function ga(c){var e=document.createElement(c);return e.style.userSelect="none",e}var Vi=function(){function c(e){this.getAbsoluteX=M,this.getAbsoluteY=D,this._GetAbsoluteX=M,this._GetAbsoluteY=D,this._GetAbsolute=this.getAbsolute,this.toNzString=this.nzString,this.createElement=ga,this.getStyleValue=Mt,this.config=e,this.stylesheetManager=new yt(document.body,e.applyCacheBusting),this.domEventTracker=new Vt}return c.prototype.isTouchDevice=function(){return this.config.hostDevice.touchable},c.prototype.getAbsolute=function(e){return{x:M(e),y:D(e)}},c.prototype.getOption=function(e,t){return e in this.config.paths?this.config.paths[e]:e in this.config.options?this.config.options[e]:arguments.length>1?t:""},c.prototype.setOption=function(e,t){switch(e){case"attachType":break;case"ui":break;case"useAlerts":this.config.signalUser=t?new ne:null;break;case"setActiveOnRegister":this.config.activateFirstKeyboard=!!t;break;case"spacebarText":this.config.spacebarText=t;break;default:throw new Error("Path-related options may not be changed after the engine has initialized.")}},c.prototype.loadCookie=function(e){var t=new Qt(e);return t.load(decodeURIComponent)},c.prototype.saveCookie=function(e,t){var n=new Qt(e);n.save(t,encodeURIComponent)},c.prototype.addStyleSheet=function(e){var t=Lt(e);return this.stylesheetManager.linkStylesheet(t),t},c.prototype.removeStyleSheet=function(e){return this.stylesheetManager.unlink(e)},c.prototype.linkStyleSheet=function(e){this.stylesheetManager.linkExternalSheet(e)},c.prototype.getLanguageCodes=function(e){return e.indexOf("-")==-1?[e]:e.split("-")},c.prototype.attachDOMEvent=function(e,t,n,r){this.domEventTracker.attachDOMEvent(e,t,n,r)},c.prototype.detachDOMEvent=function(e,t,n,r){this.domEventTracker.detachDOMEvent(e,t,n,r)},Object.defineProperty(c.prototype,"alertHost",{get:function(){return this.config.alertHost?this.config.alertHost:(this._alertHost||(this._alertHost=new ne),this._alertHost)},enumerable:!1,configurable:!0}),c.prototype.alert=function(e,t){this.alertHost.alert(e,t)},c.prototype.nzString=function(e,t){var n="";return arguments.length>1&&(n=t),typeof e=="undefined"||e==null||e==0||e==""?n:""+e},c.prototype.toNumber=function(e,t){var n=parseInt(e,10);return isNaN(n)?t:n},c.prototype.toFloat=function(e,t){var n=parseFloat(e);return isNaN(n)?t:n},c.prototype.rgba=function(e,t,n,r,i){var o="transparent";try{o="rgba("+t+","+n+","+r+","+i+")"}catch(l){o="rgb("+t+","+n+","+r+")"}return o},c.prototype.shutdown=function(){var e,t,n;(e=this.stylesheetManager)===null||e===void 0||e.unlinkAll(),(t=this.domEventTracker)===null||t===void 0||t.shutdown(),(n=this._alertHost)===null||n===void 0||n.shutdown()},c}();var ua=function(){function c(e,t,n){this.code=e,this.shift=t,this.handler=n}return c.prototype.matches=function(e,t){return this.code==e&&this.shift==t},c}(),Zi=function(){function c(){var e=this;this.hotkeys=[],this._Process=function(t){t||(t=window.event);var n=Gr(t);if(n==null)return!1;for(var r=(t.shiftKey?16:0)|(t.ctrlKey?32:0)|(t.altKey?64:0),i=0;i<e.hotkeys.length;i++)if(e.hotkeys[i].matches(n,r))return e.hotkeys[i].handler(),t.returnValue=!1,t&&t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,!1;return!0}}return c.prototype.addHotKey=function(e,t,n){for(var r=0;r<this.hotkeys.length;r++)if(this.hotkeys[r].code==e&&this.hotkeys[r].shift==t){this.hotkeys[r].handler=n;return}this.hotkeys.push(new ua(e,t,n))},c.prototype.removeHotkey=function(e,t){for(var n=0;n<this.hotkeys.length;n++)if(this.hotkeys[n].matches(e,t)){this.hotkeys.splice(n,1);return}},c}();var Fa=function(){function c(e){this.e=e,this.c=e.style.backgroundColor}return c.prototype.reset=function(){this.e.style.backgroundColor=this.c},c}(),vi=function(){function c(e){var t=this;this._BeepObjects=[],this._BeepTimeout=0,this.reset=function(){t.keyboardInterface.resetContextCache();var n;for(t._BeepTimeout=0,n=0;n<t._BeepObjects.length;n++)t._BeepObjects[n].reset();t._BeepObjects=[]},this.keyboardInterface=e}return c.prototype.beep=function(e){if(e instanceof tt){var t=e.getElement();if(e instanceof et&&(t=e.docRoot),!!t&&!(!t.style||typeof t.style.backgroundColor=="undefined")){for(var n=0;n<this._BeepObjects.length;n++)if(this._BeepObjects[n].e==t)return;this._BeepObjects.push(new Fa(t)),t.style.backgroundColor="#000000",this._BeepTimeout==0&&(this._BeepTimeout=1,window.setTimeout(this.reset,50))}}},c}();var fi=function(c){(0,d.__extends)(e,c);function e(t,n){var r=c.call(this,t,n)||this;return r.GetLastActiveElement=r.getLastActiveElement,r.FocusLastActiveElement=r.focusLastActiveElement,r.HideHelp=r.hideHelp,r.ShowHelp=r.showHelp,r.ShowPinnedHelp=r.showPinnedHelp,r}return e.prototype.saveFocus=function(){this.engine.contextManager.focusAssistant._IgnoreNextSelChange=1},e.prototype.getLastActiveElement=function(){return this.engine.contextManager.lastActiveTarget},e.prototype.focusLastActiveElement=function(){this.engine.contextManager.restoreLastActiveTarget()},e.prototype.hideHelp=function(){var t=this.engine.osk;t.startHide(!0)},e.prototype.showHelp=function(t,n){var r=this.engine.osk;r instanceof te?r.presentAtPosition(t,n):r.present()},e.prototype.showPinnedHelp=function(){var t=this.engine.osk;t instanceof te&&(!t.activeKeyboard.keyboard.isCJK||!this.ruleBehavior)&&(t.userPositioned=!0),t.present()},e}(Tn),Ji=fi;(function(){fi.__publishShorthandAPI()})();var ya=function(c){(0,d.__extends)(e,c);function e(t,n){var r=this,i=new yi(n);return r=c.call(this,t,i,new hi(i,function(){return r.legacyAPIEvents}),function(o){return{keyboardInterface:new Ji(window,o),defaultOutputRules:new bi(o.contextManager)}})||this,r._initialized=0,r.hotkeyManager=new Zi,r.getOskHeight=null,r.getOskWidth=null,r.helpURL="https://help.keyman.com/go",r.keyEventRefocus=function(){r.contextManager.restoreLastActiveTarget()},r._GetKeyboardDetail=function(o,l){var a={Name:o.KN,InternalName:o.KI,LanguageName:o.KL,LanguageCode:o.KLC,RegionName:o.KR,RegionCode:o.KRC,CountryName:o.KC,CountryCode:o.KCC,KeyboardID:o.KD,Font:o.KFont,OskFont:o.KOskFont,HasLoaded:!!l,IsRTL:l?l.isRTL:null};return a},r._util=new Vi(i),r.beepHandler=new vi(r.core.keyboardInterface),r.core.keyboardProcessor.beepHandler=function(){return r.beepHandler.beep(r.contextManager.activeTarget)},r.hardKeyboard=new Ci(i.hardDevice,r.core.keyboardProcessor,r.contextManager),r.contextManager.on("targetchange",function(o){var l=o==null?void 0:o.getElement();r.osk&&(r.osk.activationModel.activationTrigger=l),r.config.hostDevice.touchable&&o&&r.ensureElementVisibility(l)}),r}return e.prototype.ensureElementVisibility=function(t){if(!(!t||!this.osk)){var n=D(t),r=window.pageYOffset,i=n-r;n>=r&&(i-=window.innerHeight-this.osk._Box.offsetHeight-t.offsetHeight-2,i<0&&(i=0)),i!=0&&window.scrollTo(0,i+r)}},Object.defineProperty(e.prototype,"util",{get:function(){return this._util},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"views",{get:function(){return yr},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"initialized",{get:function(){return this._initialized},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ui",{get:function(){return this._ui},set:function(t){this._ui&&this._ui.shutdown(),this._ui=t,this.config.deferForInitialization.isFulfilled&&t.initialize()},enumerable:!1,configurable:!0}),e.prototype.init=function(t){return(0,d.__awaiter)(this,void 0,void 0,function(){var n,r,i,o,l,a,s,B,g=this;return(0,d.__generator)(this,function(u){switch(u.label){case 0:return n=new Le,r=n.detect(),i=(0,d.__assign)((0,d.__assign)({},Qi),t),this.config.hostDevice=r,this.config.initialize(i),this._initialized=1,[4,Xe()];case 1:return u.sent(),this.config.deferForInitialization.isResolved?[2,Promise.resolve()]:[4,c.prototype.init.call(this,i)];case 2:return u.sent(),this.keyboardRequisitioner.cloudQueryEngine.once("unboundregister",function(){var F;!((F=g.contextManager.activeKeyboard)===null||F===void 0)&&F.keyboard||g.setActiveKeyboard("","")}),this.contextManager.initialize(),o=this.contextManager.getSavedKeyboardRaw(),this.pageIntegration=new mi(window,this),this.config.finalizeInit(),this.ui&&(this.ui.initialize(),this.legacyAPIEvents.callEvent("loaduserinterface",{})),this._initialized=2,[4,this.config.deferForInitialization];case 3:u.sent(),l=this.contextManager.restoreSavedKeyboard(o),u.label=4;case 4:return u.trys.push([4,6,,7]),[4,l];case 5:return u.sent(),[3,7];case 6:return a=u.sent(),[3,7];case 7:return s={keyboardToActivate:this.contextManager.activeKeyboard},B=r.touchable?new ur(this,s):new Fr(this,s),Xi(this,B,this.contextManager),this.osk=B,[2]}})})},Object.defineProperty(e.prototype,"register",{get:function(){return this.keyboardRequisitioner.cloudQueryEngine.registerFromCloud},enumerable:!1,configurable:!0}),e.prototype.getUIState=function(){return this.contextManager.focusAssistant.getUIState()},e.prototype.activatingUI=function(t){this.contextManager.focusAssistant.setMaintainingFocus(!!t)},e.prototype.setKeyboardForControl=function(t,n,r){if(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}if(!this.isAttached(t)){console.error("KeymanWeb is not attached to element "+t);return}var i=null;if(n&&(i=this.keyboardRequisitioner.cache.getStub(n,r),!i))throw new Error("No keyboard has been registered with id ".concat(n," and language code ").concat(r,"."));this.contextManager.setKeyboardForTarget(t._kmwAttachment.interface,n,r)},e.prototype.getKeyboardForControl=function(t){var n=Ct(t);return this.contextManager.getKeyboardStubForTarget(n).id},e.prototype.getLanguageForControl=function(t){var n=Ct(t);return this.contextManager.getKeyboardStubForTarget(n).langId},e.prototype.isAttached=function(t){return this.contextManager.page.isAttached(t)},e.prototype.addKeyboards=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return this.config.deferForInitialization.then(function(){if(!n||!n[0]||n[0].length==0)return t.keyboardRequisitioner.fetchCloudCatalog().catch(function(o){return console.error(o[0].error),o});var i=[];return Array.isArray(n[0])?i=i.concat(n[0]):Array.isArray(n)&&(i=i.concat(n)),t.keyboardRequisitioner.addKeyboardArray(i)})},e.prototype.addKeyboardsForLanguage=function(t){var n=this;return this.config.deferForInitialization.then(function(){return typeof t=="string"?n.keyboardRequisitioner.addLanguageKeyboards(t.split(",").map(function(r){return r.trim()})):n.keyboardRequisitioner.addLanguageKeyboards(t)})},e.prototype.isCJK=function(t){var n;if(t){var r=t;r.KeyboardID?n=this.keyboardRequisitioner.cache.getKeyboard(r.KeyboardID):n=new j(t)}else n=this.core.activeKeyboard;return n&&n.isCJK},e.prototype.getKeyboard=function(t,n){var r=this.keyboardRequisitioner.cache.getStub(t,n),i=this.keyboardRequisitioner.cache.getKeyboardForStub(r);return r&&this._GetKeyboardDetail(r,i)},e.prototype.getKeyboards=function(){for(var t=[],n=this.keyboardRequisitioner.cache,r=n.getStubList(),i=0;i<r.length;i++){var o=r[i],l=n.getKeyboardForStub(o),a=this._GetKeyboardDetail(o,l);t.push(a)}return t},e.prototype.removeKeyboards=function(){for(var t,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i=0;i<n.length;i++)this.keyboardRequisitioner.cache.forgetKeyboard(n[i],!0),((t=this.contextManager.activeKeyboard)===null||t===void 0?void 0:t.metadata.id)==_(n[i])&&this.contextManager.activateKeyboard("","");return!0},e.prototype.getSavedKeyboard=function(){return this.contextManager.getSavedKeyboard()},e.prototype.focusLastActiveElement=function(){var t;(t=this.contextManager.lastActiveTarget)===null||t===void 0||t.focus()},e.prototype.getLastActiveElement=function(){var t;return(t=this.contextManager.lastActiveTarget)===null||t===void 0?void 0:t.getElement()},e.prototype.setActiveElement=function(t,n){if(typeof t=="string"){var r=t;if(t=document.getElementById(t),!t)throw new Error("Could not find the specified element (id: ".concat(r))}var i=Ct(t);if(!i)throw new Error("KMW is not attached to the specified element (id: ".concat(t.id,")."));this.contextManager.setActiveTarget(i,n)},e.prototype.moveToElement=function(t){typeof t=="string"&&(t=document.getElementById(t)),t.focus()},e.prototype.addHotKey=function(t,n,r){this.hotkeyManager.addHotKey(t,n,r)},e.prototype.removeHotKey=function(t,n){this.hotkeyManager.removeHotkey(t,n)},e.prototype.attachToControl=function(t){this.contextManager.page.attachToControl(t)},e.prototype.detachFromControl=function(t){this.contextManager.page.detachFromControl(t)},e.prototype.disableControl=function(t){this.contextManager.page.disableControl(t)},e.prototype.enableControl=function(t){this.contextManager.page.enableControl(t)},e.prototype.BuildVisualKeyboard=function(t,n,r,i){var o=null;t!=null&&(o=this.keyboardRequisitioner.cache.getKeyboard(t)),o=o||this.core.activeKeyboard;var l=this.keyboardRequisitioner.cache.getStub(o),a=this.getOskHeight,s=(typeof a=="function"?a():null)||this.osk.computedHeight||200;return vt.buildDocumentationKeyboard(o,l,this.config.paths,r,i,s)},e.prototype.shutdown=function(){var t,n;this.pageIntegration.shutdown(),this.contextManager.shutdown(),(t=this.osk)===null||t===void 0||t.shutdown(),this.core.languageProcessor.shutdown(),this.hardKeyboard.shutdown(),this.util.shutdown(),this.legacyAPIEvents.callEvent("unloaduserinterface",{}),(n=this.ui)===null||n===void 0||n.shutdown()},e}(Dn),Wi=ya;var Si=document.getElementsByTagName("script"),Li=Si[Si.length-1].src,Qa=Li.substr(0,Li.lastIndexOf("/")+1);window.keyman=new Wi(On.constructInstance(),Qa);})();
//# sourceMappingURL=keymanweb.es5.js.map
