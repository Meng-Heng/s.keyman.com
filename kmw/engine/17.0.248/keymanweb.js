"use strict";(()=>{var Xl=Object.create;var gn=Object.defineProperty,Vl=Object.defineProperties,Bs=Object.getOwnPropertyDescriptor,Ll=Object.getOwnPropertyDescriptors,Zl=Object.getOwnPropertyNames,os=Object.getOwnPropertySymbols,ds=Object.getPrototypeOf,gs=Object.prototype.hasOwnProperty,Sl=Object.prototype.propertyIsEnumerable,Jl=Reflect.get;var as=(o,n,e)=>n in o?gn(o,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[n]=e,C=(o,n)=>{for(var e in n||(n={}))gs.call(n,e)&&as(o,e,n[e]);if(os)for(var e of os(n))Sl.call(n,e)&&as(o,e,n[e]);return o},X=(o,n)=>Vl(o,Ll(n)),a=(o,n)=>gn(o,"name",{value:n,configurable:!0});var Rl=(o,n)=>()=>(n||o((n={exports:{}}).exports,n),n.exports),Fs=(o,n)=>{for(var e in n)gn(o,e,{get:n[e],enumerable:!0})},Al=(o,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of Zl(n))!gs.call(o,i)&&i!==e&&gn(o,i,{get:()=>n[i],enumerable:!(t=Bs(n,i))||t.enumerable});return o};var A=(o,n,e)=>(e=o!=null?Xl(ds(o)):{},Al(n||!o||!o.__esModule?gn(e,"default",{value:o,enumerable:!0}):e,o));var Ve=(o,n,e,t)=>{for(var i=t>1?void 0:t?Bs(n,e):n,c=o.length-1,s;c>=0;c--)(s=o[c])&&(i=(t?s(n,e,i):s(i))||i);return t&&i&&gn(n,e,i),i};var Ti=(o,n,e)=>Jl(ds(o),e,n);var Z=(o,n,e)=>new Promise((t,i)=>{var c=r=>{try{l(e.next(r))}catch(B){i(B)}},s=r=>{try{l(e.throw(r))}catch(B){i(B)}},l=r=>r.done?t(r.value):Promise.resolve(r.value).then(c,s);l((e=e.apply(o,n)).next())});var R=Rl((Jr,Vc)=>{"use strict";var Hl=Object.prototype.hasOwnProperty,ie="~";function qn(){}a(qn,"Events");Object.create&&(qn.prototype=Object.create(null),new qn().__proto__||(ie=!1));function El(o,n,e){this.fn=o,this.context=n,this.once=e||!1}a(El,"EE");function Qs(o,n,e,t,i){if(typeof e!="function")throw new TypeError("The listener must be a function");var c=new El(e,t||o,i),s=ie?ie+n:n;return o._events[s]?o._events[s].fn?o._events[s]=[o._events[s],c]:o._events[s].push(c):(o._events[s]=c,o._eventsCount++),o}a(Qs,"addListener");function Mi(o,n){--o._eventsCount===0?o._events=new qn:delete o._events[n]}a(Mi,"clearEvent");function O(){this._events=new qn,this._eventsCount=0}a(O,"EventEmitter");O.prototype.eventNames=a(function(){var n=[],e,t;if(this._eventsCount===0)return n;for(t in e=this._events)Hl.call(e,t)&&n.push(ie?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},"eventNames");O.prototype.listeners=a(function(n){var e=ie?ie+n:n,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var i=0,c=t.length,s=new Array(c);i<c;i++)s[i]=t[i].fn;return s},"listeners");O.prototype.listenerCount=a(function(n){var e=ie?ie+n:n,t=this._events[e];return t?t.fn?1:t.length:0},"listenerCount");O.prototype.emit=a(function(n,e,t,i,c,s){var l=ie?ie+n:n;if(!this._events[l])return!1;var r=this._events[l],B=arguments.length,d,g;if(r.fn){switch(r.once&&this.removeListener(n,r.fn,void 0,!0),B){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,e),!0;case 3:return r.fn.call(r.context,e,t),!0;case 4:return r.fn.call(r.context,e,t,i),!0;case 5:return r.fn.call(r.context,e,t,i,c),!0;case 6:return r.fn.call(r.context,e,t,i,c,s),!0}for(g=1,d=new Array(B-1);g<B;g++)d[g-1]=arguments[g];r.fn.apply(r.context,d)}else{var F=r.length,Q;for(g=0;g<F;g++)switch(r[g].once&&this.removeListener(n,r[g].fn,void 0,!0),B){case 1:r[g].fn.call(r[g].context);break;case 2:r[g].fn.call(r[g].context,e);break;case 3:r[g].fn.call(r[g].context,e,t);break;case 4:r[g].fn.call(r[g].context,e,t,i);break;default:if(!d)for(Q=1,d=new Array(B-1);Q<B;Q++)d[Q-1]=arguments[Q];r[g].fn.apply(r[g].context,d)}}return!0},"emit");O.prototype.on=a(function(n,e,t){return Qs(this,n,e,t,!1)},"on");O.prototype.once=a(function(n,e,t){return Qs(this,n,e,t,!0)},"once");O.prototype.removeListener=a(function(n,e,t,i){var c=ie?ie+n:n;if(!this._events[c])return this;if(!e)return Mi(this,c),this;var s=this._events[c];if(s.fn)s.fn===e&&(!i||s.once)&&(!t||s.context===t)&&Mi(this,c);else{for(var l=0,r=[],B=s.length;l<B;l++)(s[l].fn!==e||i&&!s[l].once||t&&s[l].context!==t)&&r.push(s[l]);r.length?this._events[c]=r.length===1?r[0]:r:Mi(this,c)}return this},"removeListener");O.prototype.removeAllListeners=a(function(n){var e;return n?(e=ie?ie+n:n,this._events[e]&&Mi(this,e)):(this._events=new qn,this._eventsCount=0),this},"removeAllListeners");O.prototype.off=O.prototype.removeListener;O.prototype.addListener=O.prototype.on;O.prefixed=ie;O.EventEmitter=O;typeof Vc!="undefined"&&(Vc.exports=O)});var xs=A(R(),1);var Ce={modifierCodes:{LCTRL:1,RCTRL:2,LALT:4,RALT:8,SHIFT:16,CTRL:32,ALT:64,META:128,CAPS:256,NO_CAPS:512,NUM_LOCK:1024,NO_NUM_LOCK:2048,SCROLL_LOCK:4096,NO_SCROLL_LOCK:8192,VIRTUAL_KEY:16384,VIRTUAL_CHAR_KEY:32768},modifierBitmasks:{ALL:127,ALT_GR_SIM:5,CHIRAL:31,IS_CHIRAL:15,NON_CHIRAL:112},stateBitmasks:{ALL:16128,CAPS:768,NUM_LOCK:3072,SCROLL_LOCK:12288},keyCodes:{K_BKSP:8,K_TAB:9,K_ENTER:13,K_SHIFT:16,K_CONTROL:17,K_ALT:18,K_PAUSE:19,K_CAPS:20,K_ESC:27,K_SPACE:32,K_PGUP:33,K_PGDN:34,K_END:35,K_HOME:36,K_LEFT:37,K_UP:38,K_RIGHT:39,K_DOWN:40,K_SEL:41,K_PRINT:42,K_EXEC:43,K_INS:45,K_DEL:46,K_HELP:47,K_0:48,K_1:49,K_2:50,K_3:51,K_4:52,K_5:53,K_6:54,K_7:55,K_8:56,K_9:57,K_A:65,K_B:66,K_C:67,K_D:68,K_E:69,K_F:70,K_G:71,K_H:72,K_I:73,K_J:74,K_K:75,K_L:76,K_M:77,K_N:78,K_O:79,K_P:80,K_Q:81,K_R:82,K_S:83,K_T:84,K_U:85,K_V:86,K_W:87,K_X:88,K_Y:89,K_Z:90,K_NP0:96,K_NP1:97,K_NP2:98,K_NP3:99,K_NP4:100,K_NP5:101,K_NP6:102,K_NP7:103,K_NP8:104,K_NP9:105,K_NPSTAR:106,K_NPPLUS:107,K_SEPARATOR:108,K_NPMINUS:109,K_NPDOT:110,K_NPSLASH:111,K_F1:112,K_F2:113,K_F3:114,K_F4:115,K_F5:116,K_F6:117,K_F7:118,K_F8:119,K_F9:120,K_F10:121,K_F11:122,K_F12:123,K_NUMLOCK:144,K_SCROLL:145,K_LSHIFT:160,K_RSHIFT:161,K_LCONTROL:162,K_RCONTROL:163,K_LALT:164,K_RALT:165,K_COLON:186,K_EQUAL:187,K_COMMA:188,K_HYPHEN:189,K_PERIOD:190,K_SLASH:191,K_BKQUOTE:192,K_LBRKT:219,K_BKSLASH:220,K_RBRKT:221,K_QUOTE:222,K_oE2:226,K_OE2:226,K_LOPT:50001,K_ROPT:50002,K_NUMERALS:50003,K_SYMBOLS:50004,K_CURRENCIES:50005,K_UPPER:50006,K_LOWER:50007,K_ALPHA:50008,K_SHIFTED:50009,K_ALTGR:50010,K_TABBACK:50011,K_TABFWD:50012},codesUS:[["0123456789",";=,-./`","[\\]'"],[")!@#$%^&*(",":+<_>?~",'{|}"']],isKnownOSKModifierKey(o){switch(o){case"K_SHIFT":case"K_LOPT":case"K_ROPT":case"K_NUMLOCK":case"K_CAPS":return!0;default:if(Ce.keyCodes[o]>=5e4)return!0;let n=Ce[o];if(n>5e4&&n<50011)return!0}return!1},getModifierState(o){var n=0;o.indexOf("shift")>=0&&(n|=Ce.modifierCodes.SHIFT);var e=!1;o.indexOf("leftctrl")>=0&&(n|=Ce.modifierCodes.LCTRL,e=!0),o.indexOf("rightctrl")>=0&&(n|=Ce.modifierCodes.RCTRL,e=!0),o.indexOf("ctrl")>=0&&!e&&(n|=Ce.modifierCodes.CTRL);var t=!1;return o.indexOf("leftalt")>=0&&(n|=Ce.modifierCodes.LALT,t=!0),o.indexOf("rightalt")>=0&&(n|=Ce.modifierCodes.RALT,t=!0),o.indexOf("alt")>=0&&!t&&(n|=Ce.modifierCodes.ALT),n},getStateFromLayer(o){var n=0;return o.indexOf("caps")>=0?n|=Ce.modifierCodes.CAPS:n|=Ce.modifierCodes.NO_CAPS,n}},h=Ce;var Le=class{constructor(){}codeForEvent(n){return h.keyCodes[n.kName]||n.Lcode}forAny(n,e,t){var i="";if((i=this.forSpecialEmulation(n))!=null)return i;if(!e&&(i=this.forNumpadKeys(n))!=null)return i;if((i=this.forUnicodeKeynames(n,t))!=null)return i;if((i=this.forBaseKeys(n,t))!=null)return i;switch(this.codeForEvent(n)){default:return null}}isCommand(n){switch(this.codeForEvent(n)){default:return!1}}applyCommand(n,e){}forSpecialEmulation(n){switch(this.codeForEvent(n)){case h.keyCodes.K_BKSP:return"\b";case h.keyCodes.K_ENTER:return`
`;default:return null}}forNumpadKeys(n){if(n.Lcode>=h.keyCodes.K_NP0&&n.Lcode<=h.keyCodes.K_NPSLASH){if(n.Lcode<106)var e=n.Lcode-48;else e=n.Lcode-64;return String._kmwFromCharCode(e)}else return null}forUnicodeKeynames(n,e){let t=n.kName;if(!t||t.substr(0,2)!="U_")return null;let i="",c=t.substr(2).split("_");for(let s of c){let l=parseInt(s,16);if(0<=l&&l<=31||128<=l&&l<=159||isNaN(l)){e&&(e.errorLog="Suppressing Unicode control code in "+t);continue}else i+=String.kmwFromCharCode(l)}return i||null}forBaseKeys(n,e){let t=n.Lcode,i=n.Lmodifiers;if(i==h.modifierCodes.SHIFT)i=1;else if(i!=0)return e&&(e.warningLog="KMW only defines default key output for the 'default' and 'shift' layers!"),null;try{if(t==h.keyCodes.K_SPACE)return" ";if(t>=h.keyCodes.K_0&&t<=h.keyCodes.K_9)return h.codesUS[i][0][t-h.keyCodes.K_0];if(t>=h.keyCodes.K_A&&t<=h.keyCodes.K_Z)return String.fromCharCode(t+(i?0:32));if(t>=h.keyCodes.K_COLON&&t<=h.keyCodes.K_BKQUOTE)return h.codesUS[i][1][t-h.keyCodes.K_COLON];if(t>=h.keyCodes.K_LBRKT&&t<=h.keyCodes.K_QUOTE)return h.codesUS[i][2][t-h.keyCodes.K_LBRKT];if(t==h.keyCodes.K_oE2)return i?"|":"\\"}catch(c){e&&(e.errorLog="Error detected with default mapping for key:  code = "+t+", shift state = "+(i==1?"shift":"default"))}return null}};a(Le,"DefaultRules");var vl=new Le,M=class{constructor(n){this.isSynthetic=!0;for(let e in n)n[e]!==void 0&&(this[e]=n[e])}static constructNullKeyEvent(n){return new M({Lcode:0,kName:"",device:n,Lstates:void 0,Lmodifiers:void 0,vkCode:void 0,LisVirtualKey:void 0})}get isModifier(){switch(this.Lcode){case 16:case 17:case 18:case 20:case 144:case 145:return!0;default:return!1}}setMnemonicCode(n,e){if(this.Lcode!=h.keyCodes.K_SPACE){let i=new M(this);for(let c in this)i[c]=this[c];i.kName="K_xxxx",i.Lmodifiers=n?16:0;var t=vl.forAny(i,!0);this.vkCode=this.Lcode,t?this.Lcode=t.charCodeAt(0):this.isModifier||delete this.Lcode}e&&(this.Lcode>=65&&this.Lcode<=90||this.Lcode>=97&&this.Lcode<=122)&&(this.Lmodifiers^=16,this.Lcode^=32)}};a(M,"KeyEvent");var Ae=class{};a(Ae,"KeyMap");var Yi=class{constructor(){this.FF=new Ae;this.Safari=new Ae;this.Opera=new Ae;this.FF.k61=187,this.FF.k59=186,this.FF.k173=189}};a(Yi,"BrowserKeyMaps");var wi=class{constructor(){this.se=new Ae,this.se.k220=192,this.se.k187=189,this.se.k219=187,this.se.k221=219,this.se.k186=221,this.se.k191=220,this.se.k192=186,this.se.k189=191,this.uk=new Ae,this.uk.k223=192,this.uk.k192=222,this.uk.k222=226,this.uk.k220=220}};a(wi,"LanguageKeyMaps");var Gt=class{constructor(){}static _usCodeInit(){var n=new Ae,e=new Ae;n.k192=96,n.k49=49,n.k50=50,n.k51=51,n.k52=52,n.k53=53,n.k54=54,n.k55=55,n.k56=56,n.k57=57,n.k48=48,n.k189=45,n.k187=61,n.k81=113,n.k87=119,n.k69=101,n.k82=114,n.k84=116,n.k89=121,n.k85=117,n.k73=105,n.k79=111,n.k80=112,n.k219=91,n.k221=93,n.k220=92,n.k65=97,n.k83=115,n.k68=100,n.k70=102,n.k71=103,n.k72=104,n.k74=106,n.k75=107,n.k76=108,n.k186=59,n.k222=39,n.k90=122,n.k88=120,n.k67=99,n.k86=118,n.k66=98,n.k78=110,n.k77=109,n.k188=44,n.k190=46,n.k191=47,e.k192=126,e.k49=33,e.k50=64,e.k51=35,e.k52=36,e.k53=37,e.k54=94,e.k55=38,e.k56=42,e.k57=40,e.k48=41,e.k189=95,e.k187=43,e.k81=81,e.k87=87,e.k69=69,e.k82=82,e.k84=84,e.k89=89,e.k85=85,e.k73=73,e.k79=79,e.k80=80,e.k219=123,e.k221=125,e.k220=124,e.k65=65,e.k83=83,e.k68=68,e.k70=70,e.k71=71,e.k72=72,e.k74=74,e.k75=75,e.k76=76,e.k186=58,e.k222=34,e.k90=90,e.k88=88,e.k67=67,e.k86=86,e.k66=66,e.k78=78,e.k77=77,e.k188=60,e.k190=62,e.k191=63,Gt._usCharCodes=[n,e]}static _USKeyCodeToCharCode(n){return Gt.usCharCodes[n.Lmodifiers&16?1:0]["k"+n.Lcode]}static get usCharCodes(){return Gt._usCharCodes||Gt._usCodeInit(),Gt._usCharCodes}},P=Gt;a(P,"KeyMapping"),P.browserMap=new Yi,P.languageMap=new wi;function Ie(o,n){var e=n||{};for(var t in o)typeof o[t]=="object"&&o[t]!=null?(e[t]=o[t].constructor===Array?[]:{},Ie(o[t],e[t])):e[t]=o[t];return e}a(Ie,"deepCopy");var H=class{constructor(n,e,t,i){switch(n.toLowerCase()){case H.Browser.Chrome:case H.Browser.Edge:case H.Browser.Firefox:case H.Browser.Native:case H.Browser.Opera:case H.Browser.Safari:this.browser=n.toLowerCase();break;default:this.browser=H.Browser.Other}switch(e.toLowerCase()){case H.FormFactor.Desktop:case H.FormFactor.Phone:case H.FormFactor.Tablet:this.formFactor=e.toLowerCase();break;default:throw"Invalid form factor specified for device: "+e}switch(t.toLowerCase()){case H.OperatingSystem.Windows.toLowerCase():case H.OperatingSystem.macOS.toLowerCase():case H.OperatingSystem.Linux.toLowerCase():case H.OperatingSystem.Android.toLowerCase():case H.OperatingSystem.iOS.toLowerCase():this.OS=t.toLowerCase();break;default:this.OS=H.OperatingSystem.Other}this.touchable=i}};a(H,"DeviceSpec");(t=>{let o;(g=>(g.Chrome="chrome",g.Edge="edge",g.Firefox="firefox",g.Native="native",g.Opera="opera",g.Safari="safari",g.Other="other"))(o=t.Browser||(t.Browser={}));let n;(d=>(d.Windows="windows",d.macOS="macosx",d.Linux="linux",d.Android="android",d.iOS="ios",d.Other="other"))(n=t.OperatingSystem||(t.OperatingSystem={}));let e;(l=>(l.Desktop="desktop",l.Phone="phone",l.Tablet="tablet"))(e=t.FormFactor||(t.FormFactor={}))})(H||(H={}));function Lc(o){return new H(o.browser,"desktop",o.OS,!1)}a(Lc,"physicalKeyDeviceAlias");var G=H;var j=class{};a(j,"KEYMAN_VERSION"),j.VERSION="17.0.248",j.VERSION_RELEASE="17.0",j.VERSION_MAJOR="17",j.VERSION_MINOR="0",j.VERSION_PATCH="248",j.TIER="alpha",j.VERSION_TAG="-alpha",j.VERSION_WITH_TAG="17.0.248-alpha",j.VERSION_ENVIRONMENT="alpha",j.VERSION_GIT_TAG="release@17.0.248-alpha";var $n=j;var pt=class{constructor(n){if(n==null){this.components=[].concat(pt.DEVELOPER_VERSION_FALLBACK.components);return}if(Array.isArray(n)){let i=n;if(i.length<2)throw new Error("Version string must have at least a major and minor component!");this.components=[].concat(i);return}let e=n.split("."),t=[];if(e.length<2)throw new Error("Version string must have at least a major and minor component!");for(let i=0;i<e.length;i++){let c=parseInt(e[i],10);if(isNaN(c))throw new Error("Version string components must be numerical!");t.push(c)}this.components=t}get major(){return this.components[0]}get minor(){return this.components[1]}toString(){return this.components.join(".")}toJSON(){return this.toString()}equals(n){return this.compareTo(n)==0}precedes(n){return this.compareTo(n)<0}compareTo(n){var e=this.components.length<n.components.length,t=this.components.length<n.components.length?this.components.length:n.components.length,i;for(i=0;i<t;i++){let s=this.components[i]-n.components[i];if(s!=0)return s}var c=e?n.components:this.components;do{if(c[i]>0)return e?-1:1;i++}while(i<c.length);return 0}},f=pt;a(f,"Version"),f.CURRENT=new pt($n.VERSION_RELEASE),f.DEVELOPER_VERSION_FALLBACK=new pt([9,0,0]),f.NO_DEFAULT_KEYCAPS=new pt([12,0]),f.MAC_POSSIBLE_IPAD_ALIAS=new pt([10,15]);function Fn(){return typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof self!="undefined"?self:global}a(Fn,"getGlobalObject");function ei(){String.kmwFromCharCode=function(o){var n=[],e;for(e=0;e<arguments.length;e++){var t=Number(arguments[e]);if(!isFinite(t)||t<0||t>1114111||Math.floor(t)!==t)throw new RangeError("Invalid code point "+t);t<65536?n.push(t):(t-=65536,n.push((t>>10)+55296),n.push(t%1024+56320))}return String.fromCharCode.apply(void 0,n)},String.prototype.kmwCharCodeAt=function(o){var n=String(this),e=0;if(o<0||o>=n.length)return NaN;for(var t=0;t<o;t++)if(e=n.kmwNextChar(e),e===null)return NaN;var i=n.charCodeAt(e);if(i>=55296&&i<=56319&&n.length>e+1){var c=n.charCodeAt(e+1);if(c>=56320&&c<=57343)return(i-55296<<10)+(c-56320)+65536}return i},String.prototype.kmwIndexOf=function(o,n){var e=String(this),t=e.indexOf(o,n);if(t<0)return t;for(var i=0,c=0;c!==null&&c<t;c=e.kmwNextChar(c))i++;return i},String.prototype.kmwLastIndexOf=function(o,n){var e=String(this),t=e.lastIndexOf(o,n);if(t<0)return t;for(var i=0,c=0;c!==null&&c<t;c=e.kmwNextChar(c))i++;return i},String.prototype.kmwLength=function(){var o=String(this);if(o.length==0)return 0;for(var n=0,e=0;e!==null;n++)e=o.kmwNextChar(e);return n},String.prototype.kmwSlice=function(o,n){var e=String(this),t=e.kmwCodePointToCodeUnit(o),i=e.kmwCodePointToCodeUnit(n);return t===null||i===null?"":e.slice(t,i)},String.prototype.kmwSubstr=function(o,n){var e=String(this);o<0&&(o=e.kmwLength()+o),o<0&&(o=0);var t=e.kmwCodePointToCodeUnit(o),i=t;if(t===null)return"";if(arguments.length<2)i=e.length;else for(var c=0;c<n;c++)i=e.kmwNextChar(i);return i===null?e.substring(t):e.substring(t,i)},String.prototype.kmwSubstring=function(o,n){var e=String(this),t,i;if(typeof n=="undefined")t=e.kmwCodePointToCodeUnit(o),i=e.length;else{if(o>n){var c=o;o=n,n=c}t=e.kmwCodePointToCodeUnit(o),i=e.kmwCodePointToCodeUnit(n)}return(isNaN(t)||t===null)&&(t=0),(isNaN(i)||i===null)&&(i=e.length),e.substring(t,i)},String.prototype.kmwNextChar=function(o){var n=String(this);if(o===null||o<0||o>=n.length-1)return null;var e=n.charCodeAt(o);if(e>=55296&&e<=56319&&n.length>o+1){var t=n.charCodeAt(o+1);if(t>=56320&&t<=57343)return o==n.length-2?null:o+2}return o+1},String.prototype.kmwPrevChar=function(o){var n=String(this);if(o==null||o<=0||o>n.length)return null;var e=n.charCodeAt(o-1);if(e>=56320&&e<=57343&&o>1){var t=n.charCodeAt(o-2);if(t>=55296&&t<=56319)return o-2}return o-1},String.prototype.kmwCodePointToCodeUnit=function(o){if(o===null)return null;var n=String(this),e=0;if(o<0){e=n.length;for(var t=0;t>o;t--)e=n.kmwPrevChar(e);return e}if(o==n.kmwLength())return n.length;for(var t=0;t<o;t++)e=n.kmwNextChar(e);return e},String.prototype.kmwCodeUnitToCodePoint=function(o){var n=String(this);return o===null?null:o==0?0:o<0?n.substr(o).kmwLength():n.substr(0,o).kmwLength()},String.prototype.kmwCharAt=function(o){var n=String(this);return o>=0?n.kmwSubstr(o,1):""},String.prototype.kmwBMPNextChar=function(o){var n=String(this);return o<0||o>=n.length-1?null:o+1},String.prototype.kmwBMPPrevChar=function(o){var n=String(this);return o<=0||o>n.length?null:o-1},String.prototype.kmwBMPCodePointToCodeUnit=function(o){return o},String.prototype.kmwBMPCodeUnitToCodePoint=function(o){return o},String.prototype.kmwBMPLength=function(){var o=String(this);return o.length},String.prototype.kmwBMPSubstr=function(o,n){var e=String(this);return o>-1?e.substr(o,n):e.substr(e.length+o,-o)},String.kmwEnableSupplementaryPlane=function(o){var n=String.prototype;String._kmwFromCharCode=o?String.kmwFromCharCode:String.fromCharCode,n._kmwCharAt=o?n.kmwCharAt:n.charAt,n._kmwCharCodeAt=o?n.kmwCharCodeAt:n.charCodeAt,n._kmwIndexOf=o?n.kmwIndexOf:n.indexOf,n._kmwLastIndexOf=o?n.kmwLastIndexOf:n.lastIndexOf,n._kmwSlice=o?n.kmwSlice:n.slice,n._kmwSubstring=o?n.kmwSubstring:n.substring,n._kmwSubstr=o?n.kmwSubstr:n.kmwBMPSubstr,n._kmwLength=o?n.kmwLength:n.kmwBMPLength,n._kmwNextChar=o?n.kmwNextChar:n.kmwBMPNextChar,n._kmwPrevChar=o?n.kmwPrevChar:n.kmwBMPPrevChar,n._kmwCodePointToCodeUnit=o?n.kmwCodePointToCodeUnit:n.kmwBMPCodePointToCodeUnit,n._kmwCodeUnitToCodePoint=o?n.kmwCodeUnitToCodePoint:n.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}a(ei,"extendString");ei();var L=class{constructor(n){this._isFulfilled=!1;this._isRejected=!1;this._promise=new Promise((e,t)=>{this._resolve=i=>{this._isFulfilled=!0,e(i)},this._reject=i=>{this._isRejected=!0,t(i)},n&&n(this._resolve,this._reject)})}get resolve(){return this._resolve}get reject(){return this._reject}get isFulfilled(){return this._isFulfilled}get isRejected(){return this._isRejected}get isResolved(){return this.isFulfilled||this.isRejected}then(n,e){return this._promise.then(n,e)}catch(n){return this._promise.catch(n)}finally(n){return this._promise.finally(n)}get corePromise(){return this._promise}};a(L,"ManagedPromise");var He=class extends L{constructor(e){let t=null;super(s=>{t=setTimeout(()=>{this.isResolved||s(!0)},e)});this.timerHandle=t;let i=this._resolve;this._resolve=s=>{clearTimeout(this.timerHandle),i(s)};let c=this._reject;this._reject=s=>{clearTimeout(this.timerHandle),c(s)}}};a(He,"TimeoutPromise");var Me=a(o=>new He(o).corePromise,"timedPromise");var Xt={};Fs(Xt,{PRIVATE_USE_IDS:()=>Wl,TouchLayoutKeySp:()=>ys});var Wl=["T_*_MT_SHIFT_TO_SHIFT","T_*_MT_SHIFT_TO_CAPS","T_*_MT_SHIFT_TO_DEFAULT"],ys=(r=>(r[r.normal=0]="normal",r[r.special=1]="special",r[r.specialActive=2]="specialActive",r[r.customSpecial=3]="customSpecial",r[r.customSpecialActive=4]="customSpecialActive",r[r.deadkey=8]="deadkey",r[r.blank=9]="blank",r[r.spacer=10]="spacer",r))(ys||{});var _=Xt.TouchLayoutKeySp;var fl=200,Y=class{static buildDefaultLayout(n,e,t){var i=t;typeof Y.dfltLayout[i]!="object"&&(i="desktop");let c=h.modifierBitmasks.NON_CHIRAL,s=f.CURRENT;e&&(c=e.modifierBitmask,s=e.compilerVersion),n||(n=this.DEFAULT_RAW_SPEC);var l=Ie(Y.dfltLayout[i]),r,B=l.layer,d=n.KLS,g=n.K102,F,Q,y,u,I,b,U,x,m=(c&h.modifierBitmasks.IS_CHIRAL)!=0;if(n.F){let Ni=/^(?:(?:italic|bold) )* *[0-9.eE-]+(?:[a-z]+) "(.+)"$/.exec(n.F);Ni&&(l.font=Ni[1])}var V=!(typeof d=="undefined"||!d);V||(d=n.KLS=Y.processLegacyDefinitions(n.BK));var J=/\*\w+\*/,W=Object.getOwnPropertyNames(d),Xe=[];if(W.splice(W.indexOf("default"),1),W=["default"].concat(W),e&&e.emulatesAltGr&&(W.indexOf("leftctrl-leftalt")==-1&&W.indexOf("rightalt")!=-1&&(W.push("leftctrl-leftalt"),d["leftctrl-leftalt"]=d.rightalt),W.indexOf("leftctrl-leftalt-shift")==-1&&W.indexOf("rightalt-shift")!=-1&&(W.push("leftctrl-leftalt-shift"),d["leftctrl-leftalt-shift"]=d["rightalt-shift"])),l.displayUnderlying=e?!!e.scriptObject.KDU:!1,t=="desktop")for(Xe=Y.generateLayerIds(m),r=0;r<Xe.length;r++)W.indexOf(Xe[r])!=-1&&Xe.splice(r--,1);var ae=W.concat(Xe);if(V&&t!="desktop"){var ye=null;b=B[0].row;for(var Kn=0;Kn<b.length;Kn++){x=b[Kn].key;for(var dn=0;dn<x.length;dn++)U=x[dn],U.id=="K_SHIFT"&&(ye=U)}if(ye){ye.sk=[];for(var xt in d){if(xt=="default"||xt=="shift")continue;var On=Y.modifierSpecials[xt];let Ni={id:`K_${On}`,text:On,sp:1,nextlayer:xt};ye.sk.push(Ni)}}else console.warn("Error in default layout - cannot find default Shift key!")}for(r=0;r<ae.length;r++)r>0&&(B[r]=Ie(B[0])),B[r].id=ae[r],B[r].nextlayer=ae[r],Y.formatDefaultLayer(B[r],m,t,!!g);for(r=0;r<B.length;r++){var ue=B[r],Ne,ye=null,Pn=null,Xc="",jn=null,_n=null,ki=null,Te=d[ue.id],mt=ue.id=="shift"?1:0,rs=ue.id=="default"||mt?1:0;for(b=ue.row,F=0;F<b.length;F++)for(x=b[F].key,Q=0;Q<x.length;Q++){switch(U=x[Q],Ne=Y.dfltCodes.indexOf(U.id),(Te||rs)&&(Te&&Ne>=0&&Ne<Te.length&&(U.text=Te[Ne]),rs&&s.precedes(f.NO_DEFAULT_KEYCAPS)&&U.id!="K_SPACE"&&Ne+65*mt<Y.dfltText.length&&U.text!==null&&(U.text=U.text||Y.dfltText[Ne+65*mt])),U.text!==null&&(U.text=U.text||""),U.id){case"K_SHIFT":ye=U;break;case"K_TAB":Pn=U;break;case"K_CAPS":jn=U;break;case"K_NUMLOCK":_n=U;break;case"K_SCROLL":ki=U;break}if(U.sk!=null){for(y=0;y<U.sk.length;y++)W.indexOf(U.sk[y].nextlayer)==-1&&U.sk.splice(y--,1);U.sk.length==0&&(U.sk=null)}}ue.shiftKey=ye,ue.capsKey=jn,ue.numKey=_n,ue.scrollKey=ki,t!="desktop"&&r>0&&ye!=null&&(ye.sp=_.specialActive,ye.sk=null,ye.text=Y.modifierSpecials[B[r].id]?Y.modifierSpecials[B[r].id]:"*Shift*")}return l}static getLayerId(n){let e=h.modifierCodes;var t="";return n==0?"default":(n&e.LCTRL&&(t=(t.length>0?t+"-":"")+"leftctrl"),n&e.RCTRL&&(t=(t.length>0?t+"-":"")+"rightctrl"),n&e.LALT&&(t=(t.length>0?t+"-":"")+"leftalt"),n&e.RALT&&(t=(t.length>0?t+"-":"")+"rightalt"),n&e.SHIFT&&(t=(t.length>0?t+"-":"")+"shift"),n&e.CTRL&&(t=(t.length>0?t+"-":"")+"ctrl"),n&e.ALT&&(t=(t.length>0?t+"-":"")+"alt"),t)}static generateLayerIds(n){var e,t;n?(e=32,t=1):(e=8,t=16);for(var i=[],c=0;c<e;c++)i.push(Y.getLayerId(c*t));return i}static formatDefaultLayer(n,e,t,i){for(var c=n.id,s=0;s<n.row.length;s++)for(var l=n.row[s],r=l.key,B=0;B<r.length;B++){var d=r[B];switch(d.id){case"K_SHIFT":case"K_LSHIFT":case"K_RSHIFT":c.indexOf("shift")!=-1&&(d.sp=_.specialActive),t!="desktop"&&(c!="default"?d.nextlayer="default":d.nextlayer="shift");break;case"K_LCTRL":case"K_LCONTROL":if(e){c.indexOf("leftctrl")!=-1&&(d.sp=_.specialActive);break}case"K_RCTRL":case"K_RCONTROL":if(e){c.indexOf("rightctrl")!=-1&&(d.sp=_.specialActive);break}case"K_CONTROL":c.indexOf("ctrl")!=-1&&(!e||c.indexOf("leftctrl")!=-1&&c.indexOf("rightctrl")!=-1)&&(d.sp=_.specialActive);break;case"K_LALT":if(e){c.indexOf("leftalt")!=-1&&(d.sp=_.specialActive);break}case"K_RALT":if(e){c.indexOf("rightalt")!=-1&&(d.sp=_.specialActive);break}case"K_ALT":c.indexOf("alt")!=-1&&(!e||c.indexOf("leftalt")!=-1&&c.indexOf("rightalt")!=-1)&&(d.sp=_.specialActive);break;case"K_oE2":(typeof i=="undefined"||!i)&&(t=="desktop"?(r.splice(B--,1),r[0].width=fl):r[B].sp=_.spacer);break}}}static processLegacyDefinitions(n){for(var e=Y.generateLayerIds(!1),t={},i=0;i<e.length;i++){for(var c=e[i],s=[],l=!1,r=0;r<65;r++){var B=r+65*i;s.push(n[B]),B<n.length&&n[B]!=""&&r!=Y.dfltCodes.indexOf("K_SPACE")&&(l=!0)}l&&(t[c]=s)}return(typeof t.default=="undefined"||!t.default)&&(t.default=[""]),(typeof t.shift=="undefined"||!t.shift)&&(t.shift=[""]),t}},S=Y;a(S,"Layouts"),S.dfltCodes=["K_BKQUOTE","K_1","K_2","K_3","K_4","K_5","K_6","K_7","K_8","K_9","K_0","K_HYPHEN","K_EQUAL","K_*","K_*","K_*","K_Q","K_W","K_E","K_R","K_T","K_Y","K_U","K_I","K_O","K_P","K_LBRKT","K_RBRKT","K_BKSLASH","K_*","K_*","K_*","K_A","K_S","K_D","K_F","K_G","K_H","K_J","K_K","K_L","K_COLON","K_QUOTE","K_*","K_*","K_*","K_*","K_*","K_oE2","K_Z","K_X","K_C","K_V","K_B","K_N","K_M","K_COMMA","K_PERIOD","K_SLASH","K_*","K_*","K_*","K_*","K_*","K_SPACE"],S.dfltText="`1234567890-=\xA7~~qwertyuiop[]\\~~~asdfghjkl;'~~~~~?zxcvbnm,./~~~~~ ~!@#$%^&*()_+\xA7~~QWERTYUIOP{}\\~~~ASDFGHJKL:\"~~~~~?ZXCVBNM<>?~~~~~ ",S.DEFAULT_RAW_SPEC={F:"Tahoma",BK:Y.dfltText},S.modifierSpecials={leftalt:"*LAlt*",rightalt:"*RAlt*",alt:"*Alt*",leftctrl:"*LCtrl*",rightctrl:"*RCtrl*",ctrl:"*Ctrl*","ctrl-alt":"*AltGr*","leftctrl-leftalt":"*LAltCtrl*","rightctrl-rightalt":"*RAltCtrl*","leftctrl-leftalt-shift":"*LAltCtrlShift*","rightctrl-rightalt-shift":"*RAltCtrlShift*",shift:"*Shift*","shift-alt":"*AltShift*","shift-ctrl":"*CtrlShift*","shift-ctrl-alt":"*AltCtrlShift*","leftalt-shift":"*LAltShift*","rightalt-shift":"*RAltShift*","leftctrl-shift":"*LCtrlShift*","rightctrl-shift":"*RCtrlShift*"},S.dfltShiftToCaps={id:"T_*_MT_SHIFT_TO_CAPS",text:"*ShiftLock*",sp:1,nextlayer:"caps"},S.dfltShiftToDefault={id:"T_*_MT_SHIFT_TO_DEFAULT",text:"*Shift*",sp:1,nextlayer:"default"},S.dfltShiftToShift={id:"T_*_MT_SHIFT_TO_SHIFT",text:"*Shift*",sp:1,nextlayer:"shift"},S.dfltLayout={desktop:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:1,key:[{id:"K_BKQUOTE"},{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{id:"K_BKSP",text:"*BkSp*",sp:1,width:130}]},{id:2,key:[{id:"K_TAB",text:"*Tab*",sp:1,width:130},{id:"K_Q"},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{id:"K_BKSLASH"}]},{id:3,key:[{id:"K_CAPS",text:"*Caps*",sp:1,width:165},{id:"K_A"},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_ENTER",text:"*Enter*",sp:1,width:165}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:130},{id:"K_oE2"},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_RSHIFT",text:"*Shift*",sp:1,width:130}]},{id:5,key:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:170},{id:"K_LALT",text:"*Alt*",sp:1,width:160},{id:"K_SPACE",text:"",width:770},{id:"K_RALT",text:"*Alt*",sp:1,width:160},{id:"K_RCONTROL",text:"*Ctrl*",sp:1,width:170}]}]}]},tablet:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",sp:1,width:150},{id:"K_SPACE",text:"",width:570},{id:"K_BKSP",text:"*BkSp*",sp:1,width:150},{id:"K_ENTER",text:"*Enter*",sp:1,width:200}]}]}]},phone:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",width:150,sp:1},{id:"K_SPACE",width:570,text:""},{id:"K_BKSP",text:"*BkSp*",width:150,sp:1},{id:"K_ENTER",text:"*Enter*",width:200,sp:1}]}]}]}};function Ee(o,n,e){e.enumerable=!0}a(Ee,"Enumerable");var us={id:"string",text:"string",layer:"string",nextlayer:"string",font:"string",fontsize:"string",sp:"number",pad:"number",width:"number",sk:"subkeys",flick:"flicks",multitap:"subkeys",hint:"string",default:"boolean"},Is=["n","ne","e","se","s","sw","w","nw"],Qn=class{constructor(){this.isMnemonic=!1}get baseKeyID(){if(typeof this.id!="undefined")return this.id}get isPadding(){return this.sp==_.spacer}get coreID(){if(typeof this.id=="undefined")return;let n=this.id||"";return this.displayLayer!=this.layer&&(n=n+"+"+this.layer),n}get elementID(){if(typeof this.id!="undefined")return this.displayLayer+"-"+this.coreID}get baseKeyEvent(){return new M(this._baseKeyEvent)}static unicodeIDToText(n,e){if(!n||n.substring(0,2)!="U_")return null;let t="",i=n.substring(2).split("_");for(let c of i){let s=parseInt(c,16);if(0<=s&&s<=31||128<=s&&s<=159||isNaN(s)){e&&e(c);continue}else t+=String.kmwFromCharCode(s)}return t||null}static sanitize(n){typeof n.width=="string"&&(n.width=parseInt(n.width,10)),n.width||(n.width=k.DEFAULT_KEY_WIDTH),typeof n.pad=="string"&&(n.pad=parseInt(n.pad,10)),n.pad||(n.pad=k.DEFAULT_PAD),typeof n.sp=="string"&&(n.sp=Number.parseInt(n.sp,10)),n.sp||(n.sp=k.DEFAULT_KEY.sp);for(let e of Object.keys(us)){let t=us[e];switch(t){case"subkeys":let i=n[e];if(!Array.isArray(i))delete n[e];else for(let l=0;l<i.length;l++){let r=i[l];typeof r!="object"?i.splice(l--,1):k.sanitize(r)}break;case"flicks":let c=n[e];if(typeof c!="object")delete n[e];else for(let l of Is){let r=c[l];typeof r!="object"?delete c[l]:k.sanitize(r)}break;default:typeof n[e]!=t&&delete n[e]}}n.text||(n.text=k.DEFAULT_KEY.text)}static polyfill(n,e,t,i,c){c||(c={hasFlicks:!1,hasLongpresses:!1,hasMultitaps:!1});let s=new Qn,l=Object.getPrototypeOf(s);for(let B in s)if(!n.hasOwnProperty(B)){let d=Object.getOwnPropertyDescriptor(l,B);d?Object.defineProperty(n,B,d):n[B]=s[B]}if(!n.text&&typeof n.id=="string"&&(n.text=k.unicodeIDToText(n.id)),n.sk){c.hasLongpresses=!0;for(let B of n.sk)it.polyfill(B,e,t,i,c)}if(n.multitap){c.hasMultitaps=!0;for(let B of n.multitap)it.polyfill(B,e,t,i,c)}if(n.flick){c.hasFlicks=!0;for(let B in n.flick)it.polyfill(n.flick[B],e,t,i,c)}let r=n;r.displayLayer=i,r.layer=r.layer||i,Qn.determineHint(r,t.defaultHint),r.constructBaseKeyEvent(e,t,i)}static determineHint(n,e){var t;if(n.hint){n.hintSrc=n;return}if(e!=null&&e.includes("flick-")){if(n.flick){let i=e.substring(6);(t=n.flick[i])!=null&&t.text&&(n.hintSrc=n.flick[i])}return}switch(e){case"none":return;case"multitap":n.multitap&&(n.hintSrc=n.multitap[0]);return;case"flick":if(n.flick){for(let i of Is)if(n.flick[i]){n.hintSrc=n.flick[i];return}}return;case"longpress":n.sk&&(n.hintSrc=n.sk[0]);return;case"dot":default:n.sk&&(n.hint="\u2022",n.hintSrc=n);return}}constructBaseKeyEvent(n,e,t){let i=this.layer||t||"",c=this.id?this.id.toUpperCase():null,s={Lmodifiers:h.getModifierState(i),Lstates:h.getStateFromLayer(i),Lcode:c?h.keyCodes[c]:0,LisVirtualKey:!0,vkCode:0,kName:c,kLayer:i,kbdLayer:t,kNextLayer:this.nextlayer,device:null,isSynthetic:!0},l=new M(s);if(e.keyboard){let r=e.keyboard;r.isMnemonic&&!(e.isDefault&&e.formFactor!="desktop")?l.Lcode!=h.keyCodes.K_SPACE&&(l.vkCode=l.Lcode,this.isMnemonic=!0):l.vkCode=l.Lcode,r.definesPositionalOrMnemonic||(l.Lcode=P._USKeyCodeToCharCode(l),l.LisVirtualKey=!1)}this._baseKeyEvent=l}},ce=Qn;a(ce,"ActiveKeyBase"),ce.DEFAULT_PAD=15,ce.DEFAULT_RIGHT_MARGIN=15,ce.DEFAULT_KEY_WIDTH=100,ce.DEFAULT_KEY={text:"",width:Qn.DEFAULT_KEY_WIDTH,sp:_.normal,pad:Qn.DEFAULT_PAD},Ve([Ee],ce.prototype,"baseKeyID",1),Ve([Ee],ce.prototype,"isPadding",1),Ve([Ee],ce.prototype,"coreID",1),Ve([Ee],ce.prototype,"elementID",1),Ve([Ee],ce.prototype,"baseKeyEvent",1),Ve([Ee],ce.prototype,"constructBaseKeyEvent",1);var k=class extends ce{getSubkey(n){if(this.sk){for(let e of this.sk)if(e.coreID==n)return e}return null}};a(k,"ActiveKey");var it=class extends ce{};a(it,"ActiveSubKey");var ti=class{constructor(){}static sanitize(n){for(let e of n.key)e==null?n.key.length=n.key.length-1:k.sanitize(e);typeof n.id=="string"&&(n.id=Number.parseInt(n.id,10))}static polyfill(n,e,t,i,c,s,l){let r=n.key;for(let u=0;u<r.length;u++){let I=r[u];for(var B in k.DEFAULT_KEY)typeof I[B]!="string"&&typeof I[B]!="number"&&(I[B]=k.DEFAULT_KEY[B]);switch(I.sp){case _.special:!ti.SPECIAL_LABEL.test(I.text)&&I.text!=""&&(I.sp=_.customSpecial);break;case _.specialActive:!ti.SPECIAL_LABEL.test(I.text)&&I.text!=""&&(I.sp=_.customSpecialActive);break}k.polyfill(I,e,t,i,l)}let d=a(function(u,I,b,U){u.proportionalPad=I,u.proportionalWidth=b,u.proportionalX=U+I+b/2},"setProportions"),g=0;for(let u=0;u<r.length-1;u++){let I=r[u];d(I,I.pad/c,I.width/c,g),g+=I.proportionalPad,g+=I.proportionalWidth}let F=k.DEFAULT_RIGHT_MARGIN/c;if(r.length>0){let u=r[r.length-1];if(r.length==1&&u.pad<0){let I=u.width/c,b=1-(g+I+F);d(u,b,I,g)}else{let I=u.pad/c,b=1-(g+I+F);d(u,I,b,g)}}let Q=new ti;for(let u in Q)n.hasOwnProperty(u)||(n[u]=Q[u]);let y=n;y.proportionalY=s}populateKeyMap(n){this.key.forEach(function(e){e.coreID&&(n[e.coreID]=e)})}},Vt=ti;a(Vt,"ActiveRow"),Vt.SPECIAL_LABEL=/\*\w+\*/,Ve([Ee],Vt.prototype,"populateKeyMap",1);var Zc=class{constructor(){}static sanitize(n){for(let e of n.row)Vt.sanitize(e)}static polyfill(n,e,t,i){n.aligned=!1;let c=n.row,s=0;for(let d of c){let g=0,F=d.key;for(let Q of F)g+=Q.width+Q.pad;g>s&&(s=g)}t.formFactor=="desktop"?s+=5:s+=k.DEFAULT_RIGHT_MARGIN;let l=n.row.length;for(let d=0;d<l;d++){let g=(d+.5)/l;Vt.polyfill(n.row[d],e,t,n.id,s,g,i)}let r=new Zc;for(let d in r)n.hasOwnProperty(d)||(n[d]=r[d]);let B=n;B.totalWidth=s,B.defaultKeyProportionalWidth=k.DEFAULT_KEY.width/s,B.rowProportionalHeight=1/l,B.keyMap=B.constructKeyMap()}constructKeyMap(){let n={};return this.row.forEach(function(e){e.populateKeyMap(n)}),n}getKey(n){n.indexOf(this.id+"-")==0&&(n=n.replace(this.id+"-",""));let e=n.split("::");return e.length>1?this.keyMap[e[0]].getSubkey(e[1]):this.keyMap[n]}},Lt=Zc;a(Lt,"ActiveLayer"),Ve([Ee],Lt.prototype,"constructKeyMap",1),Ve([Ee],Lt.prototype,"getKey",1);var Di=class{constructor(){this.hasFlicks=!1;this.hasLongpresses=!1;this.hasMultitaps=!1}getLayer(n){return this.layerMap[n]}static correctLayerEmptyRowBug(n){for(let e=0;e<n.length;e++){let i=n[e].row,c;for(c=i.length-1;c>=0;c--)(!Array.isArray(i[c].key)||i[c].key.length==0)&&i.splice(c,1)}}static sanitize(n){Di.correctLayerEmptyRowBug(n.layer);for(let e of n.layer)Lt.sanitize(e)}static polyfill(n,e,t){if(n==null)throw new Error("Cannot build an ActiveLayout for a null specification.");let i={hasFlicks:!1,hasLongpresses:!1,hasMultitaps:!1};this.sanitize(n);var c;let s={},l=n.layer,r=new Di;for(let d in r)n.hasOwnProperty(d)||(n[d]=r[d]);let B=n;for(B.keyboard=e,B.formFactor=t,c=0;c<l.length;c++)Lt.polyfill(l[c],e,B,i),s[l[c].id]=l[c];if(t!="desktop"&&!!n.layer.find(d=>d.id=="caps")){let d=n.layer.find(y=>y.id=="default"),g=n.layer.find(y=>y.id=="shift"),F=d.getKey("K_SHIFT"),Q=g==null?void 0:g.getKey("K_SHIFT");F&&Q&&!F.multitap&&!Q.multitap&&!F.sk&&!Q.sk&&(i.hasMultitaps=!0,F.multitap=[C({},S.dfltShiftToCaps),C({},S.dfltShiftToDefault)],Q.multitap=[C({},S.dfltShiftToCaps),C({},S.dfltShiftToShift)],F.multitap.forEach(y=>it.polyfill(y,e,B,"default")),Q.multitap.forEach(y=>it.polyfill(y,e,B,"shift")))}return B.hasFlicks=i.hasFlicks,B.hasLongpresses=i.hasLongpresses,B.hasMultitaps=i.hasMultitaps,B.layerMap=s,B}},nt=Di;a(nt,"ActiveLayout"),Ve([Ee],nt.prototype,"getLayer",1);var zi=class{constructor(){this.stores={}}};a(zi,"CacheTag");var Ki=(t=>(t[t.NOT_LOADED=void 0]="NOT_LOADED",t[t.POLYFILLED=1]="POLYFILLED",t[t.CALIBRATED=2]="CALIBRATED",t))(Ki||{}),Oi=class{constructor(n){n?this.scriptObject=n:this.scriptObject=Oi.DEFAULT_SCRIPT_OBJECT,this.layoutStates={}}process(n,e){return this.scriptObject.gs(n,e)}processNewContextEvent(n,e){return this.scriptObject.gn?this.scriptObject.gn(n,e):!1}processPostKeystroke(n,e){return this.scriptObject.gpk?this.scriptObject.gpk(n,e):!1}get isHollow(){return this.scriptObject==Oi.DEFAULT_SCRIPT_OBJECT}get id(){return this.scriptObject.KI}get name(){return this.scriptObject.KN}get variableStores(){let n=this.scriptObject.KVS,e={};if(Array.isArray(n))for(let t of n)e[t]=this.scriptObject[t];return e}set variableStores(n){let e=this.scriptObject.KVS;if(Array.isArray(e))for(let t of e)typeof n[t]=="string"&&(this.scriptObject[t]=n[t])}get _legacyLayoutSpec(){return this.scriptObject.KV}get _layouts(){return this.scriptObject.KVKL}set _layouts(n){this.scriptObject.KVKL=n}get compilerVersion(){return new f(this.scriptObject.KVER)}get isMnemonic(){return!!this.scriptObject.KM}get definesPositionalOrMnemonic(){return typeof this.scriptObject.KM!="undefined"}get helpText(){return this.scriptObject.KH}get hasScript(){return!!this.scriptObject.KHF}embedScript(n){this.scriptObject.KHF(n)}get oskStyling(){return this.scriptObject.KCSS}get isCJK(){var n;return typeof this.scriptObject.KLC!="undefined"?n=this.scriptObject.KLC:typeof this.scriptObject.LanguageCode!="undefined"&&(n=this.scriptObject.LanguageCode),n=="cmn"||n=="jpn"||n=="kor"}get isRTL(){return!!this.scriptObject.KRTL}get modifierBitmask(){return this.scriptObject.KMBM||h.modifierBitmasks.NON_CHIRAL}get isChiral(){return!!(this.modifierBitmask&h.modifierBitmasks.IS_CHIRAL)}get desktopFont(){return this.scriptObject.KV?this.scriptObject.KV.F:null}get cacheTag(){let n=this.scriptObject._kmw;return n||(n=new zi,this.scriptObject._kmw=n),n}get explodedStores(){return this.cacheTag.stores}get emulatesAltGr(){let n=h.modifierCodes;if(!this.isChiral||this._legacyLayoutSpec==null)return!1;let e=this._legacyLayoutSpec.KLS;if(!e)return!1;var t=n.LCTRL|n.LALT,i=e[S.getLayerId(t)],c=e[S.getLayerId(n.SHIFT|t)];if(i!=null&&i!=e[S.getLayerId(n.RALT)]||c!=null&&c!=e[S.getLayerId(n.RALT|n.SHIFT)])return!1;var s=this.modifierBitmask;return(s&t)!=t||i==null&&c==null,!0}get usesSupplementaryPlaneChars(){let n=this.scriptObject;return n&&(n.KS&&n.KS==1||n.KN=="Hieroglyphic")}get version(){return this.scriptObject.KBVER||""}usesDesktopLayoutOnDevice(n){return this.scriptObject.KVKL?n.formFactor==G.FormFactor.Desktop:!0}notify(n,e,t){typeof this.scriptObject.KNS=="function"&&this.scriptObject.KNS(n,e,t)}findOrConstructLayout(n){if(this._layouts){if(this._layouts[n]!==void 0)return this._layouts[n];if(n==G.FormFactor.Phone&&this._layouts[G.FormFactor.Tablet])return this._layouts[G.FormFactor.Phone]=this._layouts[G.FormFactor.Tablet];if(n==G.FormFactor.Tablet&&this._layouts[G.FormFactor.Phone])return this._layouts[G.FormFactor.Tablet]=this._layouts[G.FormFactor.Phone]}let e=null;if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.KLS)e=this._legacyLayoutSpec;else if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.BK!=null){for(var t=this._legacyLayoutSpec.BK,i=0;i<t.length;i++)if(t[i].length>0){e=this._legacyLayoutSpec;break}}if(!e&&(this.helpText==""||n!=G.FormFactor.Desktop)&&(e={F:"Tahoma",BK:S.dfltText}),this._layouts||(this._layouts={}),e){let c=this._layouts[n]=S.buildDefaultLayout(e,this,n);return c.isDefault=!0,c}else return this._layouts[n]=null,null}layout(n){let e=this.findOrConstructLayout(n);return e?(this.layoutStates[n]==Ki.NOT_LOADED&&(e=nt.polyfill(e,this,n),this.layoutStates[n]=1),e):null}refreshLayouts(){let n=[G.FormFactor.Desktop,G.FormFactor.Phone,G.FormFactor.Tablet],e=this;n.forEach(function(t){e.layoutStates[t]=Ki.NOT_LOADED})}markLayoutCalibrated(n){this.layoutStates[n]!=Ki.NOT_LOADED&&(this.layoutStates[n]=2)}getLayoutState(n){return this.layoutStates[n]}constructNullKeyEvent(n,e){e=e||{K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};let t=M.constructNullKeyEvent(n);return this.setSyntheticEventDefaults(t,e),t}constructKeyEvent(n,e,t){let i=n.baseKeyEvent;i.device=e,this.isMnemonic&&i.setMnemonicCode(n.layer.indexOf("shift")!=-1,t.K_CAPS),this.setSyntheticEventDefaults(i,t);let s={K_CAPS:h.stateBitmasks.CAPS,K_NUMLOCK:h.stateBitmasks.NUM_LOCK,K_SCROLL:h.stateBitmasks.SCROLL_LOCK}[i.kName];return s&&(i.Lstates^=s,i.LmodifierChange=!0),i}setSyntheticEventDefaults(n,e){n.device.touchable||(n.Lstates=0,n.Lstates|=e.K_CAPS?h.modifierCodes.CAPS:h.modifierCodes.NO_CAPS,n.Lstates|=e.K_NUMLOCK?h.modifierCodes.NUM_LOCK:h.modifierCodes.NO_NUM_LOCK,n.Lstates|=e.K_SCROLL?h.modifierCodes.SCROLL_LOCK:h.modifierCodes.NO_SCROLL_LOCK),n.kName&&n.kName.substr(0,2)=="U_"&&(n.LisVirtualKey=!1),typeof n.Lcode=="undefined"&&(n.Lcode=this.getVKDictionaryCode(n.kName),n.Lcode||(n.Lcode=1)),(n.Lmodifiers&h.modifierBitmasks.ALT_GR_SIM)==h.modifierBitmasks.ALT_GR_SIM&&this.emulatesAltGr&&(n.Lmodifiers&=~h.modifierBitmasks.ALT_GR_SIM,n.Lmodifiers|=h.modifierCodes.RALT)}getVKDictionaryCode(n){if(!this.scriptObject.VKDictionary){let i=[];if(typeof this.scriptObject.KVKD=="string"){let c=this.scriptObject.KVKD.split(" ");for(var e=0;e<c.length;e++)i[c[e].toUpperCase()]=e+256}this.scriptObject.VKDictionary=i}let t=this.scriptObject.VKDictionary[n.toUpperCase()];return t||0}},N=Oi;a(N,"Keyboard"),N.DEFAULT_SCRIPT_OBJECT={gs:function(n,e){return!1},KI:"",KN:"",KV:S.DEFAULT_RAW_SPEC,KM:0};var ni={osk:h},ct=class{constructor(n,e){this.loadedKeyboard=null;this._jsGlobal=n,this.keymanGlobal=e,this.install()}KR(n){if(this.loadedKeyboard)throw new Error("Unexpected state:  the most-recently loaded keyboard field was not properly reset.");this.loadedKeyboard=new N(n)}install(){this._jsGlobal.KeymanWeb=this,this._jsGlobal.keyman=this.keymanGlobal}uninstall(){this._jsGlobal.KeymanWeb==this&&delete this._jsGlobal.KeymanWeb,this._jsGlobal.keyman==this.keymanGlobal&&delete this._jsGlobal.keyman}};a(ct,"KeyboardHarness");var st=class extends Error{constructor(e,t){super(e);this.cause=t}};a(st,"KeyboardScriptError");var yn=class extends Error{constructor(e,t){super(e);this.cause=t}};a(yn,"KeyboardMissingError");var Pi=class{constructor(n){this.uri=n}missingError(n){let e=`Cannot find the keyboard at ${this.uri}.`;return new yn(e,n)}scriptError(n){let e=`Error registering the keyboard script at ${this.uri}; it may contain an error.`;return new st(e,n)}};a(Pi,"UriBasedErrorBuilder");var ji=class{constructor(n){this.stub=n}missingError(n){let e=this.stub,t=`Cannot find the ${e.name} keyboard for ${e.langName} at ${e.filename}.`;return new yn(t,n)}scriptError(n){let e=this.stub,t=`Error registering the ${e.name} keyboard for ${e.langName}; keyboard script at ${e.filename} may contain an error.`;return new st(t,n)}};a(ji,"StubBasedErrorBuilder");var Zt=class{get harness(){return this._harness}constructor(n){this._harness=n}loadKeyboardFromPath(n){return this.harness.install(),this.loadKeyboardInternal(n,new Pi(n))}loadKeyboardFromStub(n){return this.harness.install(),this.loadKeyboardInternal(n.filename,new ji(n),n.id)}};a(Zt,"KeyboardLoaderBase");var Us=(i=>(i.KEYBOARD="keyboard",i.LANGUAGE="language",i.LANGUAGE_KEYBOARD="languageKeyboard",i.BLANK="blank",i))(Us||{}),Ze=Us;function Sc(o,n){if(o)return{family:o.family,path:n,files:o.filename||o.source}}a(Sc,"internalizeFont");var un=class{static get spacebarTextMode(){return typeof this.spacebarTextModeSrc=="string"?this.spacebarTextModeSrc:this.spacebarTextModeSrc()}static set spacebarTextMode(n){this.spacebarTextModeSrc=n}constructor(n,e){if(typeof n!="string")if(n.KI||n.KL||n.KLC||n.KFont||n.KOskFont){let t=n;this.KI=t.KI,this.KN=t.KN,this.KL=t.KL,this.KLC=t.KLC,this.KFont=t.KFont,this.KOskFont=t.KOskFont,this._displayName=t instanceof un?t._displayName:t.displayName}else{let t=n;t.languages||(t.languages=t.language),this.KI=t.id,this.KN=t.name,this.KL=t.languages.name,this.KLC=t.languages.id,this.KFont=Sc(t.languages.font,e),this.KOskFont=Sc(t.languages.oskFont,e)}else this.KI=n,this.KLC=e}static fromMultilanguageAPIStub(n){let e=[];n.languages||(n.languages=n.language);for(let t of n.languages){let i={id:n.id,name:n.name,languages:t};e.push(new un(i))}return e}get id(){return this.KI}get name(){return this.KN}get langId(){return this.KLC}get langName(){return this.KL}get displayName(){if(this._displayName)return this._displayName;let n=this.KN,e=this.KL;switch(un.spacebarTextMode){case Ze.KEYBOARD:return n;case Ze.LANGUAGE:return e;case Ze.LANGUAGE_KEYBOARD:return n==e?e:e+" - "+n;case Ze.BLANK:return"";default:return n}}set displayName(n){this._displayName=n}get textFont(){return this.KFont}get oskFont(){return this.KOskFont}validateForOSK(){return this.KLC?this.displayName===void 0||un.spacebarTextMode!=Ze.BLANK&&!this.displayName?new Error("A display name is missing for this keyboard and cannot be generated under current settings."):null:this.KI||this.KN?new Error(`No language code was specified for use with the ${this.KI||this.KN} keyboard`):new Error("No language code was specified for use with the corresponding keyboard")}validateForCustomKeyboard(){return!this.KI||!this.KN||!this.KL||!this.KLC?new Error("To use a custom keyboard, you must specify keyboard id, keyboard name, language and language code."):null}},Se=un;a(Se,"KeyboardProperties"),Se.spacebarTextModeSrc=Ze.KEYBOARD;var _i=class{constructor(n,e){this.p=n,this.d=e,this.o=_i.ordinalSeed++}match(n,e){var t=this.p==n&&this.d==e;return t}set(){this.matched=1}reset(){this.matched=0}before(n){return this.o<n.o}clone(){let n=new _i(this.p,this.d);return n.o=this.o,n}},lt=_i;a(lt,"Deadkey"),lt.ordinalSeed=0,lt.sortFunc=a(function(n,e){return n.p!=e.p?e.p-n.p:e.o-n.o},"sortFunc");var St=class{constructor(){this.dks=[]}toSortedArray(){return this.dks=this.dks.sort(lt.sortFunc),[].concat(this.dks)}clone(){let n=new St,e=this.toSortedArray();return n.dks=[],e.forEach(function(t){n.dks.push(t.clone())}),n}isMatch(n,e,t){if(this.dks.length==0)return!1;var i=n;e=i-e;for(var c=0;c<this.dks.length;c++)if(this.dks[c].match(e,t)&&!this.dks[c].matched)return this.dks[c].set(),!0;return this.resetMatched(),!1}add(n){this.dks=this.dks.concat(n)}remove(n){var e=this.dks.indexOf(n);this.dks.splice(e,1)}clear(){this.dks=[]}resetMatched(){for(let n of this.dks)n.reset()}deleteMatched(){for(var n=0;n<this.dks.length;n++)this.dks[n].matched&&this.dks.splice(n--,1)}adjustPositions(n,e){if(e!=0)for(let t of this.dks)t.p>n&&(t.p+=e)}count(){return this.dks.length}};a(St,"DeadkeyTracker");var ii=class{constructor(n){this.id=n}set(n){throw new Error("System store with ID "+this.id+" may not be directly set.")}};a(ii,"SystemStore");var Jt=class extends ii{constructor(e,t){super(e);this.handler=null;this._value=t}get value(){return this._value}matches(e){return this._value==e}set(e){this.handler&&this.handler(this,e)||(this._value=e)}};a(Jt,"MutableSystemStore");var ci=class extends ii{constructor(e){super(31);this.kbdInterface=e}matches(e){var t,i,c=e.split(" ");let s=this.kbdInterface.activeDevice;for(t=0;t<c.length;t++)switch(i=c[t].toLowerCase(),i){case"touch":case"hardware":if(s.touchable!=(i=="touch"))return!1;break;case"macos":case"mac":i="macosx";case"macosx":case"windows":case"android":case"ios":case"linux":if(s.OS!=i)return!1;break;case"tablet":case"phone":case"desktop":if(s.formFactor!=i)return!1;break;case"web":if(s.browser=="native")return!1;break;case"native":case"chrome":case"firefox":case"safari":case"edge":case"opera":if(s.browser!=i)return!1;break;default:return!1}return!0}};a(ci,"PlatformSystemStore");ei();function In(o){var n;return o?o.insert===""&&o.deleteLeft===0&&((n=o.deleteRight)!=null?n:0)===0:!1}a(In,"isEmptyTransform");var Jc=class{constructor(n,e,t){this.insert=n,this.deleteLeft=e,this.deleteRight=t||0}},si=Jc;a(si,"TextTransform"),si.nil=new Jc("",0,0);var Rc=class{constructor(n,e,t,i){let c=this.token=Rc.tokenSeed++;this.keystroke=n,this.transform=e,this.alternates=i,this.preInput=t,this.transform.id=this.token,i&&i.forEach(function(s){s.sample.id=c})}},li=Rc;a(li,"Transcription"),li.tokenSeed=0;var rt=class{constructor(){this._dks=new St}get isSynthetic(){return!0}resetContext(){this.deadkeys().clear()}deadkeys(){return this._dks}hasDeadkeyMatch(n,e){return this.deadkeys().isMatch(this.getDeadkeyCaret(),n,e)}insertDeadkeyBeforeCaret(n){var e=new lt(this.getDeadkeyCaret(),n);this.deadkeys().add(e)}adjustDeadkeys(n){this.deadkeys().adjustPositions(this.getDeadkeyCaret(),n)}setDeadkeys(n){this._dks=n.clone()}buildTransformFrom(n){let e=this.getText(),t=n.getText(),i=n.getDeadkeyCaret(),c=this.getDeadkeyCaret(),s=i<c?i:c,l=e._kmwCodePointToCodeUnit(s),r=0,B=l;for(;r<B;){let b=Math.floor((B+r+1)/2),U=t.substr(r,b-r),x=e.substr(r,b-r);U==x?r=b:B=b-1}if(B>0&&B<l){let b=t.charCodeAt(B-1),U=t.charCodeAt(B),x=e.charCodeAt(B);if(b>=55296&&b<=56319){let m=U>=56320&&U<=57343;m=m||x>=56320&&x<=57343,m&&(B=B-1)}}let d=t._kmwCodeUnitToCodePoint(B),g=i-d,F=c-d,Q=e._kmwSubstr(d,F),y=e._kmwLength()-c,I=t._kmwLength()-i-y;return I<0&&(Q=Q+e._kmwSubstr(c,-I),I=0),new si(Q,g,I)}buildTranscriptionFrom(n,e,t,i){let c=this.buildTransformFrom(n);return new li(e,c,E.from(n,t),i)}restoreTo(n){this.setTextBeforeCaret(n.getTextBeforeCaret()),this.setTextAfterCaret(n.getTextAfterCaret()),this._dks=n._dks.clone()}apply(n){n.deleteRight&&this.setTextAfterCaret(this.getTextAfterCaret()._kmwSubstr(n.deleteRight)),n.deleteLeft&&this.deleteCharsBeforeCaret(n.deleteLeft),n.insert&&this.insertTextBeforeCaret(n.insert),this._dks.clear()}setTextBeforeCaret(n){this.deleteCharsBeforeCaret(this.getTextBeforeCaret()._kmwLength()),this.insertTextBeforeCaret(n)}saveProperties(){}restoreProperties(){}};a(rt,"OutputTarget");var E=class extends rt{constructor(e,t,i){super();this.selForward=!0;this.text=e||"";var c=this.text._kmwLength();this.selStart=typeof t=="number"?t:c,this.selEnd=typeof i=="number"?i:this.selStart,this.selForward=this.selEnd>=this.selStart}static from(e,t){let i;if(e instanceof E){let c=e;i=new E(c.text,c.selStart,c.selEnd)}else{let c=e.getText(),s=c._kmwLength(),l=s,r=0;if(e.hasSelection()){let B=e.getTextBeforeCaret(),d=e.getTextAfterCaret();l=B._kmwLength(),r=s-d._kmwLength()}i=new E(c,l,r)}return i.setDeadkeys(e.deadkeys()),i}clearSelection(){this.text=this.getTextBeforeCaret()+this.getTextAfterCaret(),this.selEnd=this.selStart,this.selForward=!0}invalidateSelection(){}isSelectionEmpty(){return this.selStart==this.selEnd}hasSelection(){return!0}getDeadkeyCaret(){return this.selStart}setSelection(e,t){if(this.selStart=e,this.selEnd=typeof t=="number"?t:e,this.selForward=t>=e,!this.selForward){let i=this.selStart;this.selStart=this.selEnd,this.selEnd=i}}getTextBeforeCaret(){return this.text.kmwSubstr(0,this.selStart)}getSelectedText(){return this.text.kmwSubstr(this.selStart,this.selEnd-this.selStart)}getTextAfterCaret(){return this.text.kmwSubstr(this.selEnd)}getText(){return this.text}deleteCharsBeforeCaret(e){e>=0&&(e>this.selStart&&(e=this.selStart),this.adjustDeadkeys(-e),this.text=this.text.kmwSubstr(0,this.selStart-e)+this.text.kmwSubstr(this.selStart),this.selStart-=e,this.selEnd-=e)}insertTextBeforeCaret(e){this.adjustDeadkeys(e._kmwLength()),this.text=this.getTextBeforeCaret()+e+this.text.kmwSubstr(this.selStart),this.selStart+=e.kmwLength(),this.selEnd+=e.kmwLength()}handleNewlineAtCaret(){this.insertTextBeforeCaret(`
`)}setTextAfterCaret(e){this.text=this.getTextBeforeCaret()+e}doInputEvent(){}};a(E,"Mock");var se=class{constructor(){this.transcription=null;this.setStore={};this.saveStore={};this.variableStores={};this.triggersDefaultCommand=!1}finalize(n,e,t){if(!this.transcription)throw"Cannot finalize a RuleBehavior with no transcription.";n.beepHandler&&this.beep&&n.beepHandler(e);for(let i in this.setStore){let c=n.keyboardInterface.systemStores[i];if(c)try{c.set(this.setStore[i])}catch(s){n.errorLogger&&n.errorLogger("Rule attempted to perform illegal operation - 'platform' may not be changed.")}else n.warningLogger&&n.warningLogger("Unknown store affected by keyboard rule: "+i)}if(n.keyboardInterface.applyVariableStores(this.variableStores),n.keyboardInterface.variableStoreSerializer)for(let i in this.saveStore)n.keyboardInterface.variableStoreSerializer.saveStore(n.activeKeyboard.id,i,this.saveStore[i]);if(this.triggersDefaultCommand){let i=this.transcription.keystroke;n.defaultRules.applyCommand(i,e)}n.warningLogger&&this.warningLog?n.warningLogger(this.warningLog):n.errorLogger&&this.errorLog&&n.errorLogger(this.errorLog)}mergeInDefaults(n){let e=this.transcription.keystroke,t=n.transcription.keystroke;if(e.Lcode!=t.Lcode||e.Lmodifiers!=t.Lmodifiers)throw"RuleBehavior default-merge not supported unless keystrokes are identical!";this.triggersDefaultCommand=this.triggersDefaultCommand||n.triggersDefaultCommand;let i=E.from(this.transcription.preInput,!1);i.apply(this.transcription.transform),i.apply(n.transcription.transform),this.transcription=i.buildTranscriptionFrom(this.transcription.preInput,e,!1,this.transcription.alternates)}};a(se,"RuleBehavior");var qi=class{};a(qi,"KeyInformation");var $i=class{reset(){this._cache=[]}get(n,e){return typeof this._cache[n]=="undefined"||typeof this._cache[n][e]=="undefined"?null:this._cache[n][e]}set(n,e,t){typeof this._cache[n]=="undefined"&&(this._cache[n]=[]),this._cache[n][e]=t}};a($i,"CachedContext");var Un=class{reset(){this._cache=[]}get(n,e){return typeof this._cache[n]=="undefined"||typeof this._cache[n][e]=="undefined"?null:this._cache[n][e]}set(n,e,t){typeof this._cache[n]=="undefined"&&(this._cache[n]=[]),this._cache[n][e]=t}clone(){let n=new Un;return n._cache=this._cache,n}};a(Un,"CachedContextEx");var Ac=class extends ct{constructor(e,t,i=null){super(e,t);this.cachedContext=new $i;this.cachedContextEx=new Un;this._AnyIndices=[];this.systemStores={},this.systemStores[31]=new ci(this),this.systemStores[33]=new Jt(33,"default"),this.systemStores[42]=new Jt(42,""),this.systemStores[43]=new Jt(43,""),this.variableStoreSerializer=i}get Codes(){return h}saveFocus(){}registerKeyboard(e){let t=new N(e);this.loadedKeyboard=t}context(e,t,i){var c=this.cachedContext.get(e,t);if(c!==null)return c;var s=this.KC_(e,t,i);return this.cachedContext.set(e,t,s),s}KC_(e,t,i){var c="";return c=i.isSelectionEmpty()?i.getTextBeforeCaret():"",c._kmwLength()<e&&(c=Array(e-c._kmwLength()+1).join("\uFFFE")+c),c._kmwSubstr(-e)._kmwSubstr(0,t)}nul(e,t){var i=this.context(e+1,1,t);return i==="\uFFFE"}contextMatch(e,t,i,c){var s=this.context(e,c,t);return s===i?!0:(t.deadkeys().resetMatched(),!1)}_BuildExtendedContext(e,t,i){var c=this.cachedContextEx.get(e,t);if(c!==null)return c;if(c=this.cachedContextEx.get(e,e),c===null){let F=i.deadkeys().toSortedArray();var s=0;for(c={valContext:[],deadContext:[]};c.valContext.length<e;){var l=i.getDeadkeyCaret(),r=l-s;if(F.length>0&&F[0].p>r){F.splice(0,1);continue}else if(F.length>0&&F[0].p==r)c.deadContext[e-c.valContext.length-1]=F[0],c.valContext=[F[0].d].concat(c.valContext),F.splice(0,1);else{var B=this.context(++s,1,i);c.valContext=[B].concat(c.valContext)}}this.cachedContextEx.set(e,e,c)}var d=c;d.valContext=d.valContext.slice(0,t);for(var g=0;g<d.valContext.length;g++)d[g]=="\uFFFE"&&(d.valContext.splice(0,1),d.deadContext.splice(0,1));return d.valContext.length==0&&(d.valContext=["\uFFFE"],d.deadContext=[]),this.cachedContextEx.set(e,t,d),d}fullContextMatch(e,t,i){var c=this._BuildExtendedContext(e,i.length,t);this.ruleContextEx=this.cachedContextEx.clone();var s=c.valContext,l=c.deadContext,r=!1;let B="\uFFFE";for(var d=a(function(b){throw new Error("Unexpected object in fullContextMatch specification: "+b)},"assertNever"),g=0;g<i.length;g++)if(typeof i[g]=="string"){var F=i[g];if(F!==s[g]){r=!0;break}}else{var Q=i[g];switch(Q.t){case"d":Q.d!==s[g]?r=!0:l[g].set();break;case"a":var y;typeof s[g]=="string"?y=s[g]:y={t:"d",d:s[g]};var u=this.any(g,y,Q.a);Q.n?Q.n&&(u||s[g]===B)&&(r=!0):u?l[g]!==void 0&&l[g].set():r=!0;break;case"i":var I=this._Index(Q.i,Q.o);I!==void 0&&(typeof I=="string"?I:I.d)!==s[g]?r=!0:l[g]!==void 0&&l[g].set();break;case"c":s[Q.c-1]!==s[g]?r=!0:l[g]!==void 0&&l[g].set();break;case"n":s[g]!=B&&(r=!0);break;default:d(Q)}}return r&&(t.deadkeys().resetMatched(),this._AnyIndices=[]),!r}isKeypress(e){return this.activeKeyboard.isMnemonic?!e.LisVirtualKey:!!P._USKeyCodeToCharCode(e)}static matchModifiersToRuleChirality(e,t){let i=h.modifierCodes.LALT|h.modifierCodes.RALT,c=h.modifierCodes.LCTRL|h.modifierCodes.RCTRL,s=e;if(!(t&i)){let l=s&i;l&&(s^=l|h.modifierCodes.ALT)}if(!(t&c)){let l=s&c;l&&(s^=l|h.modifierCodes.CTRL)}return s}keyMatch(e,t,i){var c=!1,s=e.Lcode==173?189:e.Lcode;let l=this.activeKeyboard.modifierBitmask;var r=l&h.modifierBitmasks.ALL,B=l&h.stateBitmasks.ALL;let d=Ac.matchModifiersToRuleChirality(e.Lmodifiers,t);return e.vkCode>255&&(s=e.vkCode),e.LisVirtualKey||s>255?((t&16384)==16384||s>255)&&(c=i==s&&(t&r)==d,c=c&&this.stateMatch(e,t&B)):(t&16384)==0&&(c=s==i),c||this.activeTargetOutput.deadkeys().resetMatched(),c}stateMatch(e,t){return(t&e.Lstates)==t}keyInformation(e){var t=new qi;return t.vk=e.LisVirtualKey,t.code=e.Lcode,t.modifiers=e.Lmodifiers,t}deadkeyMatch(e,t,i){return t.hasDeadkeyMatch(e,i)}beep(e){this.resetContextCache(),this.ruleBehavior.beep=!0}_ExplodeStore(e){if(typeof e=="string"){let c=this.activeKeyboard.explodedStores;if(c[e])return c[e];for(var t=[],i=0;i<e._kmwLength();i++)t.push(e._kmwCharAt(i));return c[e]=t,t}else return e}any(e,t,i){if(t=="")return!1;i=this._ExplodeStore(i);for(var c=-1,s=0;s<i.length;s++)if(typeof i[s]=="string"){if(i[s]==t){c=s;break}}else if(i[s].d===t.d){c=s;break}return this._AnyIndices[e]=c,c>=0}_Index(e,t){return e=this._ExplodeStore(e),this._AnyIndices[t-1]<e.length?e[this._AnyIndices[t-1]]:(console.warn("Unmatched contextual index() statement detected in rule with index "+t+"!"),"")}indexOutput(e,t,i,c){this.resetContextCache();var s=a(function(B){throw new Error("Unexpected object in fullContextMatch specification: "+B)},"assertNever"),l=this._Index(t,i);if(l!=="")if(typeof l=="string")this.output(e,c,l);else if(l.t){var r=l;switch(r.t){case"b":this.beep(c);break;case"d":this.deadkeyOutput(e,c,l.d);break;default:s(r)}}else this.deadkeyOutput(e,c,l.d)}deleteContext(e,t){var i;if(e>0){i=this._BuildExtendedContext(e,e,t);let l=0;for(var c=0;c<i.valContext.length;c++){var s=i.deadContext[c];s?(t.deadkeys().remove(s),e--):i.valContext[c]=="\uFFFE"&&l++}let r=i.valContext.length-l;e>r&&(e=r)}t.deadkeys().resetMatched(),this.output(e,t,"")}output(e,t,i){this.resetContextCache(),t.saveProperties(),t.clearSelection(),t.deadkeys().deleteMatched(),e>=0&&t.deleteCharsBeforeCaret(e),t.insertTextBeforeCaret(i),t.restoreProperties()}contextExOutput(e,t,i,c){this.resetContextCache(),e>=0&&this.output(e,t,"");let s=this.ruleContextEx.get(i,i),l=s.deadContext[c-1],r=s.valContext[c-1];if(l)t.insertDeadkeyBeforeCaret(l.d);else if(typeof r=="string")this.output(-1,t,r);else throw new Error("contextExOutput: should never be a numeric valContext with no corresponding deadContext")}deadkeyOutput(e,t,i){this.resetContextCache(),e>=0&&this.output(e,t,""),t.insertDeadkeyBeforeCaret(i)}ifStore(e,t,i){var c=!0;let s=this.systemStores[e];return s&&(c=s.matches(t)),c}setStore(e,t,i){if(this.resetContextCache(),e==33&&this.activeDevice.touchable)this.ruleBehavior.setStore[e]=t;else return!1}loadStore(e,t,i){return this.resetContextCache(),this.variableStoreSerializer&&this.variableStoreSerializer.loadStore(e,t)[t]||i}saveStore(e,t){this.resetContextCache();var i=this.activeKeyboard;if(!i||typeof i.id=="undefined"||i.id=="")return!1;let c={};return c[e]=t,this.ruleBehavior?this.ruleBehavior.saveStore[e]=c:this.variableStoreSerializer.saveStore(this.activeKeyboard.id,e,c),!0}resetContextCache(){this.cachedContext.reset(),this.cachedContextEx.reset()}defaultBackspace(e){e.isSelectionEmpty()?this.output(1,e,""):this.output(0,e,"")}processNewContextEvent(e,t){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processNewContextEvent.bind(this.activeKeyboard),e,t,!0)}processPostKeystroke(e,t){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processPostKeystroke.bind(this.activeKeyboard),e,t,!0)}processKeystroke(e,t){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.process.bind(this.activeKeyboard),e,t,!1)}process(e,t,i,c){if(t)if(this.activeKeyboard){if(!e)throw"No callee for keystroke processing!"}else throw"No active keyboard for keystroke processing!";else throw"No target specified for keyboard output!";t.invalidateSelection(),t.deadkeys().resetMatched(),this.resetContextCache();let s=E.from(t,!0),l=this.activeKeyboard.variableStores;this.ruleBehavior=new se,this.activeDevice=i.device,this.activeTargetOutput=t;var r=e(t,i);this.activeTargetOutput=null,this.ruleBehavior.transcription=t.buildTranscriptionFrom(s,i,c),this.ruleBehavior.variableStores=this.activeKeyboard.variableStores,this.activeKeyboard.variableStores=l,this.ruleBehavior.triggerKeyDefault=!r;let B=this.ruleBehavior;return this.ruleBehavior=null,B}applyVariableStores(e){this.activeKeyboard.variableStores=e}static __publishShorthandAPI(){let e=this.prototype;var t=a(function(i,c){e[c]&&(e[i]=e[c])},"exportKBCallback");t("KSF","saveFocus"),t("KBR","beepReset"),t("KT","insertText"),t("KR","registerKeyboard"),t("KRS","registerStub"),t("KC","context"),t("KN","nul"),t("KCM","contextMatch"),t("KFCM","fullContextMatch"),t("KIK","isKeypress"),t("KKM","keyMatch"),t("KSM","stateMatch"),t("KKI","keyInformation"),t("KDM","deadkeyMatch"),t("KB","beep"),t("KA","any"),t("KDC","deleteContext"),t("KO","output"),t("KDO","deadkeyOutput"),t("KCXO","contextExOutput"),t("KIO","indexOutput"),t("KIFS","ifStore"),t("KSETS","setStore"),t("KLOAD","loadStore"),t("KSAVE","saveStore")}},Je=Ac;a(Je,"KeyboardInterface"),Je.GLOBAL_NAME="KeymanWeb";(function(){Je.__publishShorthandAPI()})();var bs=A(R(),1);var ri=class extends bs.default{constructor(e,t){super();this.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};this.modStateFlags=0;t||(t=ri.DEFAULT_OPTIONS),this.contextDevice=e,this.baseLayout=t.baseLayout||ri.DEFAULT_OPTIONS.baseLayout,this.keyboardInterface=t.keyboardInterface||new Je(Fn(),ni),this.defaultRules=t.defaultOutputRules||ri.DEFAULT_OPTIONS.defaultOutputRules}get activeKeyboard(){return this.keyboardInterface.activeKeyboard}set activeKeyboard(e){this.keyboardInterface.activeKeyboard=e,this.resetContext()}get layerStore(){return this.keyboardInterface.systemStores[33]}get newLayerStore(){return this.keyboardInterface.systemStores[42]}get oldLayerStore(){return this.keyboardInterface.systemStores[43]}get layerId(){return this.layerStore.value}set layerId(e){this.layerStore.set(e)}defaultRuleBehavior(e,t,i){let c=E.from(t,i),s=new se,l=!1;var r="",B;if(e.isSynthetic||t.isSynthetic)if(l=!0,this.defaultRules.isCommand(e))s.triggersDefaultCommand=!0;else if((B=this.defaultRules.forSpecialEmulation(e))!=null)switch(B){case"\b":this.keyboardInterface.defaultBackspace(t);break;case`
`:t.handleNewlineAtCaret();break;default:s.errorLog="Unexpected 'special emulation' character (\\u"+B.kmwCharCodeAt(0).toString(16)+") went unhandled!"}else l=!1;let d=this.activeKeyboard&&this.activeKeyboard.isMnemonic;if(!l)if((r=this.defaultRules.forAny(e,d))!=null)if(B=this.defaultRules.forSpecialEmulation(e),B=="\b")this.keyboardInterface.defaultBackspace(t);else{if(B||this.defaultRules.isCommand(e))return null;this.keyboardInterface.output(0,t,r)}else return null;if(s.errorLog)return s;let g=t.buildTranscriptionFrom(c,e,i);return s.transcription=g,s}processNewContextEvent(e,t){return this.activeKeyboard?this.keyboardInterface.processNewContextEvent(t,this.activeKeyboard.constructNullKeyEvent(e,this.stateKeys)):null}processPostKeystroke(e,t){return this.activeKeyboard?this.keyboardInterface.processPostKeystroke(t,this.activeKeyboard.constructNullKeyEvent(e,this.stateKeys)):null}processKeystroke(e,t){var i;if(this.activeKeyboard&&e.Lcode!=0&&(i=this.keyboardInterface.processKeystroke(t,e)),!i||i.triggerKeyDefault){e.Lcode=e.vkCode||e.Lcode,this.keyboardInterface.activeTargetOutput=t;let c=this.defaultRuleBehavior(e,t,!1);c&&(i?i.mergeInDefaults(c):i=c,i.triggerKeyDefault=!1),this.keyboardInterface.activeTargetOutput=null}return i}_UpdateVKShift(e){let t=0,i=["CAPS","NUM_LOCK","SCROLL_LOCK"],c=["K_CAPS","K_NUMLOCK","K_SCROLL"];if(!this.activeKeyboard)return!0;if(e){t=e.Lmodifiers,this.activeKeyboard.isChiral&&this.activeKeyboard.emulatesAltGr&&(this.modStateFlags&h.modifierBitmasks.ALT_GR_SIM)==h.modifierBitmasks.ALT_GR_SIM&&(t|=h.modifierBitmasks.ALT_GR_SIM,t&=~h.modifierCodes.RALT);let s=!1;for(let l=0;l<i.length;l++)e.Lstates&h.stateBitmasks[i[l]]&&(this.stateKeys[c[l]]=!!(e.Lstates&h.modifierCodes[i[l]]),s=!0);s&&this.emit("statekeychange",this.stateKeys)}return this.updateStates(),this.activeKeyboard.isMnemonic&&this.stateKeys.K_CAPS&&(!e||!e.isModifier)&&(t^=h.modifierCodes.SHIFT),this.layerId=this.getLayerId(t),!0}updateStates(){var e=["CAPS","NUM_LOCK","SCROLL_LOCK"],t=["K_CAPS","K_NUMLOCK","K_SCROLL"];for(let i=0;i<t.length;i++){let c=t[i],s=this.stateKeys[c],l=e[i],r="NO_"+e[i];s?(this.modStateFlags|=h.modifierCodes[l],this.modStateFlags&=~h.modifierCodes[r]):(this.modStateFlags&=~h.modifierCodes[l],this.modStateFlags|=h.modifierCodes[r])}}getLayerId(e){return S.getLayerId(e)}selectLayer(e){let t=e.kName;var i=e.kNextLayer,c=this.activeKeyboard&&this.activeKeyboard.isChiral;if(typeof i=="number"&&(i=this.getLayerId(i*16)),!i)switch(t){case"K_LSHIFT":case"K_RSHIFT":case"K_SHIFT":i="shift";break;case"K_LCONTROL":case"K_LCTRL":if(c){i="leftctrl";break}case"K_RCONTROL":case"K_RCTRL":if(c){i="rightctrl";break}case"K_CTRL":i="ctrl";break;case"K_LMENU":case"K_LALT":if(c){i="leftalt";break}case"K_RMENU":case"K_RALT":if(c){i="rightalt";break}case"K_ALT":i="alt";break;case"K_ALTGR":c?i="leftctrl-rightalt":i="ctrl-alt";break;case"K_CURRENCIES":case"K_NUMERALS":case"K_SHIFTED":case"K_UPPER":case"K_LOWER":case"K_SYMBOLS":i="default";break}return i?(this.updateLayer(e,i),!0):!1}updateLayer(e,t){let i=this.layerId;var c=i;if(t==i&&e.device.formFactor!=G.FormFactor.Desktop)return!1;var s=t,l;if(e.device.formFactor==G.FormFactor.Desktop){var r=["leftctrl","rightctrl","ctrl","leftalt","rightalt","alt","shift"];for(l=0;l<r.length;l++)s=s.replace(r[l]+"-",""),s=s.replace(r[l],"");if(i=="default"||i=="numeric"||i=="symbol"||i=="currency"||s!="")c=t;else{var B=h.getModifierState(c);for(l=0;l<r.length;l++)c=c.replace(r[l]+"-",""),c=c.replace(r[l],"");switch(t){case"shift":B^=h.modifierCodes.SHIFT;break;case"leftctrl":B^=h.modifierCodes.LCTRL;break;case"rightctrl":B^=h.modifierCodes.RCTRL;break;case"ctrl":B^=h.modifierCodes.CTRL;break;case"leftalt":B^=h.modifierCodes.LALT;break;case"rightalt":B^=h.modifierCodes.RALT;break;case"alt":B^=h.modifierCodes.ALT;break;default:c=t}c!="default"&&(c==""?c=this.getLayerId(B):c=this.getLayerId(B)+"-"+c)}c==""&&(c="default")}else c=t;this.activeKeyboard.layout(e.device.formFactor).getLayer(c)?this.layerId=c:this.layerId="default";let g=h.getModifierState(this.layerId);this.modStateFlags=g|e.Lstates}doModifierPress(e,t,i){return this.activeKeyboard?e.isModifier?(this.activeKeyboard.notify(e.Lcode,t,i?1:0),e.device.touchable?!0:this._UpdateVKShift(e)):(e.LmodifierChange&&(this.activeKeyboard.notify(0,t,1),e.device.touchable||this._UpdateVKShift(e)),!1):!1}performNewContextEvent(e){let t=this.processNewContextEvent(this.contextDevice,e);return t&&t.finalize(this,e,!0),t}resetContext(e){this.layerId="default",e==null||e.resetContext(),this.keyboardInterface.resetContextCache(),e&&this.performNewContextEvent(e),this.contextDevice.touchable||this._UpdateVKShift(null)}setNumericLayer(e){this.activeKeyboard&&this.activeKeyboard.layout(e.formFactor).getLayer("numeric")&&(this.layerId="numeric")}},ot=ri;a(ot,"KeyboardProcessor"),ot.DEFAULT_OPTIONS={baseLayout:"us",defaultOutputRules:new Le};var Cs=a(o=>o.substring(o.length-1)!="/"?o+"/":o,"addDelimiter"),Rt=class{constructor(n,e){e=Cs(e),this.sourcePath=e,this.protocol=e.replace(/(.{3,5}:)(.*)/,"$1"),this.updateFromOptions(n)}updateFromOptions(n){let e=this.sourcePath.replace(/(https?:\/\/)([^\/]*)(.*)/,"$1$2/");this._root=e,n.root!=""?this._root=this.fixPath(n.root):this._root=this.fixPath(e);let t=n.resources;t==""&&(t=this.sourcePath),this._resources=this.fixPath(t),this._keyboards=this.fixPath(n.keyboards),this._fonts=this.fixPath(n.fonts)}fixPath(n){return n.length==0||(n=Cs(n),n.replace(/^(http)s?:.*/,"$1")=="http"||n.replace(/^(file):.*/,"$1")=="file")?n:n.substring(0,2)=="//"?this.protocol+n:n.substring(0,1)=="/"?this.root+n.substring(1):this.sourcePath+n}get fonts(){return this._fonts}updateFontPath(n){this._fonts=this.fixPath(n)}get root(){return this._root}get resources(){return this._resources}get keyboards(){return this._keyboards}};a(Rt,"PathConfiguration");var Hc={root:"",resources:"",keyboards:"",fonts:""};var at=class{constructor(n){n.OS==G.OperatingSystem.Android?this.popupCanvasBackgroundColor="#999":this.popupCanvasBackgroundColor=at.prefersDarkMode()?"#0f1319":"#ffffff"}static prefersDarkMode(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}};a(at,"StyleConstants");var At=class{constructor(){this.detected=!1;this.touchable="ontouchstart"in window,this.OS="",this.formFactor="desktop",this.browser="",this.dyPortrait=0,this.dyLandscape=0,this.version="0",this.orientation=window.orientation}getDPI(){var n=document.createElement("DIV"),e=n.style,t=96;return document.readyState!=="complete"||(n.id="calculateDPI",e.position="absolute",e.display="block",e.visibility="hidden",e.left="10px",e.top="10px",e.width="1in",e.height="10px",document.body.appendChild(n),t=typeof window.devicePixelRatio=="undefined"?n.offsetWidth:n.offsetWidth*window.devicePixelRatio,document.body.removeChild(n)),t}detect(){var n=!1;if(navigator&&navigator.userAgent){var e=navigator.userAgent;if(e.indexOf("iPad")>=0)this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;else if(e.indexOf("iPhone")>=0)this.OS="iOS",this.formFactor="phone",this.dyPortrait=this.dyLandscape=25;else if(e.indexOf("Android")>=0){this.OS="Android",this.formFactor="phone",this.dyPortrait=75,this.dyLandscape=25;try{var t=new RegExp("(?:Android\\s+)(\\d+\\.\\d+\\.\\d+)");this.version=e.match(t)[1]}catch(B){}}else if(e.indexOf("Linux")>=0)this.OS="Linux";else if(e.indexOf("Macintosh")>=0){let d=/Intel Mac OS X (\d+(?:[_\.]\d+)+)/i.exec(e);if(!d)console.warn("KMW could not properly parse the user agent string.A suboptimal keyboard layout may result."),this.OS="MacOSX";else if(d.length>1&&d[1]){let g=d[1].replace("_","."),F=new f(g);n=f.MAC_POSSIBLE_IPAD_ALIAS.compareTo(F)<=0,this.OS="MacOSX"}}else e.indexOf("Windows NT")>=0&&(this.OS="Windows",e.indexOf("Touch")>=0&&(this.formFactor="phone"),typeof navigator.msMaxTouchPoints=="number"&&navigator.msMaxTouchPoints>0&&(this.touchable=!0))}let i=Math.min(screen.width,screen.height),c=Math.max(screen.width,screen.height),s=i/c;this.OS!="iOS"&&this.formFactor=="phone"&&(i>=600&&s>.5625||s>=.625)&&(this.formFactor="tablet");let l=navigator.platform=="Win32"||navigator.platform=="MacIntel";this.OS=="iOS"&&!("ongesturestart"in window)&&!l&&(this.OS="Android"),this.browser="web",(this.OS=="iOS"||this.OS.toLowerCase()=="macosx")&&(this.browser="safari");var r=/Firefox|Chrome|OPR|Safari|Edge/;if(r.test(navigator.userAgent)&&(navigator.userAgent.indexOf("Firefox")>=0&&"onmozorientationchange"in screen?this.browser="firefox":navigator.userAgent.indexOf("OPR")>=0?this.browser="opera":navigator.userAgent.indexOf(" Edge/")>=0?this.browser="edge":navigator.userAgent.indexOf("Chrome")>=0?this.browser="chrome":navigator.userAgent.indexOf("Safari")>=0&&(this.browser="safari")),n&&this.browser=="safari"&&window.TouchEvent){this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;let B=screen.height/screen.width;B<1&&(B=1/B),B>1.6&&(this.formFactor="phone",this.dyPortrait=this.dyLandscape=25)}return this.colorScheme=at.prefersDarkMode()?"dark":"light",this.detected=!0,this.coreSpec}get coreSpec(){return new G(this.browser,this.formFactor,this.OS,this.touchable)}};a(At,"Device");var hn=class extends xs.default{constructor(e,t){super();this.applyCacheBusting=!1;if(!t){let i=new At;i.detect(),t=i.coreSpec}this.sourcePath=e,this.hostDevice=t,this.deferForInitialization=new L}initialize(e){this._paths?this._paths.updateFromOptions(e):this._paths=new Rt(e,this.sourcePath),typeof e.setActiveOnRegister=="boolean"?this.activateFirstKeyboard=e.setActiveOnRegister:this.activateFirstKeyboard=!0,this._spacebarText=e.spacebarText,Se.spacebarTextMode=()=>this.spacebarText}finalizeInit(){this.deferForInitialization.resolve()}get paths(){return this._paths}get spacebarText(){return this._spacebarText}set spacebarText(e){this._spacebarText!=e&&(this._spacebarText=e,this.emit("spacebartext",e))}get softDevice(){return this.hostDevice}get hardDevice(){return Lc(this.hostDevice)}get stubNamespacer(){return this._stubNamespacer}set stubNamespacer(e){this._stubNamespacer=e}debugReport(){return{hostDevice:this.hostDevice,initialized:this.deferForInitialization.isResolved}}onRuleFinalization(e,t){}};a(hn,"EngineConfiguration");var Ec=C({setActiveOnRegister:!0,spacebarText:Ze.LANGUAGE_KEYBOARD},Hc);var ms=A(R(),1);var vc=class extends ms.default{constructor(e){super();this.pendingActivations=[];this.engineConfig=e}get predictionContext(){return this._predictionContext}configure(e){this._resetContext=e.resetContext,this._predictionContext=e.predictionContext,this.keyboardCache=e.keyboardCache}insertText(e,t,i){let c=this.activeTarget;return c!=null?(t!=null&&e.output(0,c,t),typeof i!="undefined"&&i!==null&&e.deadkeyOutput(0,c,i),c.invalidateSelection(),!0):!1}resetContext(){this._resetContext(this.activeTarget),this.predictionContext.resetContext()}findAndPopActivation(e){let t;for(t=0;t<this.pendingActivations.length&&this.pendingActivations[t].target!=e;t++);return t==this.pendingActivations.length?null:this.pendingActivations.splice(t,1)[0]}deferredKeyboardActivation(e,t,i){return Z(this,null,function*(){let c={target:i,keyboard:e,stub:t};this.findAndPopActivation(i),this.pendingActivations.push(c),yield e;let s=this.findAndPopActivation(i);if(s==c)return c;if(s)return this.pendingActivations.push(s),null})}activateKeyboard(e,t,i){return Z(this,null,function*(){let c=!this.activeKeyboard;this.findAndPopActivation(this.currentKeyboardSrcTarget());let s=this.prepareKeyboardForActivation(e,t),l=this.currentKeyboardSrcTarget(),r=yield s.keyboard;if(r==null&&s.metadata)return!1;this.currentKeyboardSrcTarget()==l&&this.emit("beforekeyboardchange",s.metadata);let B=null;return r&&(B={keyboard:r,metadata:s.metadata}),this.activateKeyboardForTarget(B,l),this.currentKeyboardSrcTarget()==l&&(!c||!!r)&&(this.resetContext(),this.emit("keyboardchange",this.activeKeyboard)),!0})}prepareKeyboardForActivation(e,t){var s;t||(t="");let i=null;if(e?i=this.keyboardCache.getStub(e,t):t=="",!i){if(e)throw new Error("No matching stub has been registered.");return{keyboard:Promise.resolve(null),metadata:null}}if(((s=this.activeKeyboard)==null?void 0:s.metadata)&&e==this.activeKeyboard.metadata.id){let l=this.activeKeyboard.keyboard;return{keyboard:Promise.resolve(l),metadata:i}}let c;if(c=this.keyboardCache.getKeyboardForStub(i))return{keyboard:Promise.resolve(c),metadata:i};{this.emit("beforekeyboardchange",i);let l=this.engineConfig.deferForInitialization.then(()=>{let B=new L;this.emit("keyboardasyncload",i,B.corePromise);let d=this.keyboardCache.fetchKeyboardForStub(i),g=new Promise((Q,y)=>{let u=`Sorry, the ${i.name} keyboard for ${i.langName} is not currently available.`;window.setTimeout(()=>y(new Error(u)),vc.TIMEOUT_THRESHOLD)}),F=Promise.race([d,g]);return F.then(()=>{B.resolve(null),g.catch(()=>{})}),F.catch(Q=>{throw B.resolve(Q),Q}),F});return{keyboard:this.deferredKeyboardActivation(l,i,this.currentKeyboardSrcTarget()).then(B=>Z(this,null,function*(){return B?l:Promise.resolve(null)})),metadata:i}}}},Ht=vc;a(Ht,"ContextManagerBase"),Ht.TIMEOUT_THRESHOLD=1e4;var Gs=A(R(),1);var Et=class extends Gs.default{};a(Et,"HardKeyboard");function ec(o,n){let e=new Map;return n.keys.forEach(t=>{let i=Math.abs(o.x-t.centerX),c=Math.abs(o.y-t.centerY),s,l;i>.5*t.width?(s=i-.5*t.width,i=.5):(s=0,i/=t.width),c>.5*t.height?(l=c-.5*t.height,c=.5):(l=0,c/=t.height),s*=n.kbdScaleRatio,s+=i*t.height,l+=c*t.height;let r=s*s+l*l;e.set(t.keySpec,r)}),e}a(ec,"keyTouchDistances");function Bt(o){var i;let n=new Map,e=0;Array.isArray(o)||(o=[o]);for(let c of o)for(let s of c.keys()){let l=1/(Math.pow(c.get(s),2)+1e-6);e+=l,n.set(s,(i=n.get(s))!=null?i:0+l)}let t=[];for(let c of n.keys())t.push({keySpec:c,p:n.get(c)/e});return t.sort(function(c,s){return s.p-c.p})}a(Bt,"distributionFromDistanceMaps");var tc=class{constructor(n,e,t){this.keySpec=t,this.centerX=t.proportionalX,this.centerY=e.proportionalY,this.width=t.proportionalWidth,this.height=n.rowProportionalHeight}};a(tc,"CorrectiveBaseKeyLayout");function kl(o){return o.baseKeyID?h.isKnownOSKModifierKey(o.baseKeyID)?!1:!o.isPadding:!1}a(kl,"correctionKeyFilter");function ps(o,n){return{keys:o.row.map(e=>e.key.map(t=>new tc(o,e,t))).reduce((e,t)=>e.concat(t),[]).filter(e=>kl(e.keySpec)),kbdScaleRatio:n}}a(ps,"buildCorrectiveLayout");var Be=class{constructor(n,e,t){this.left=n.getTextBeforeCaret(),this.startOfBuffer=this.left._kmwLength()<=e.leftContextCodePoints,this.startOfBuffer||(this.left=this.left._kmwSubstr(-e.leftContextCodePoints)),this.right=n.getTextAfterCaret(),this.endOfBuffer=this.right._kmwLength()<=e.rightContextCodePoints,this.endOfBuffer||(this.right=this.right._kmwSubstr(0,e.rightContextCodePoints)),this.casingForm=t=="shift"?"initial":t=="caps"?"upper":null}toMock(){let n=this.left._kmwLength();return new E(this.left+(this.right||""),n)}};a(Be,"ContextWindow"),Be.ENGINE_RULE_WINDOW={leftContextCodePoints:64,rightContextCodePoints:32};var Ls=A(R(),1);var Ye=class{constructor(){this._promises=new Map}get length(){return this._promises.size}make(n,e,t){if(this._promises.has(n))return t(`Existing request with token ${n}`);this._promises.set(n,{reject:t,resolve:e})}keep(n,e){let t=this._promises.get(n);if(!t)throw new Error(`No promise associated with token: ${n}`);let i=t.resolve;return this._promises.delete(n),i(e)}break(n,e){let t=this._promises.get(n);if(!t)throw new Error(`No promise associated with token: ${n}`);this._promises.delete(n),t.reject(e)}};a(Ye,"PromiseStore");var vt=class{constructor(n,e,t){this._worker=e,this._worker.onmessage=this.onMessage.bind(this),this._declareLMLayerReady=null,this._predictPromises=new Ye,this._wordbreakPromises=new Ye,this._acceptPromises=new Ye,this._revertPromises=new Ye,this._nextToken=Number.MIN_SAFE_INTEGER,this.sendConfig(n,!!t)}sendConfig(n,e){this._worker.postMessage({message:"config",capabilities:n,testMode:e})}loadModel(n,e="file"){return new Promise((t,i)=>{this._declareLMLayerReady=t;let c={type:e};e=="file"?c.file=n:c.code=n,this._worker.postMessage({message:"load",source:c})})}unloadModel(){this._worker.postMessage({message:"unload"})}predict(n,e){let t=this._nextToken++;return new Promise((i,c)=>{this._predictPromises.make(t,i,c),this._worker.postMessage({message:"predict",token:t,transform:n,context:e})})}wordbreak(n){let e=this._nextToken++;return new Promise((t,i)=>{this._wordbreakPromises.make(e,t,i),this._worker.postMessage({message:"wordbreak",token:e,context:n})})}acceptSuggestion(n,e,t){let i=this._nextToken++;return new Promise((c,s)=>{this._acceptPromises.make(i,c,s),this._worker.postMessage({message:"accept",token:i,suggestion:n,context:e,postTransform:t})})}revertSuggestion(n,e){let t=this._nextToken++;return new Promise((i,c)=>{this._revertPromises.make(t,i,c),this._worker.postMessage({message:"revert",token:t,reversion:n,context:e})})}resetContext(n){this._worker.postMessage({message:"reset-context",context:n})}onMessage(n){let e=n.data;if(e.message==="error")console.error(e.log),e.error&&console.error(e.error);else if(e.message==="ready")this._declareLMLayerReady(n.data.configuration);else if(e.message==="suggestions")this._predictPromises.keep(e.token,e.suggestions);else if(e.message==="currentword")this._wordbreakPromises.keep(e.token,e.word);else if(e.message==="postaccept")this._acceptPromises.keep(e.token,e.reversion);else if(e.message==="postrevert")this._revertPromises.keep(e.token,e.suggestions);else throw new Error(`Message not implemented: ${e.message}`)}shutdown(){this._worker.terminate()}};a(vt,"LMLayer");function nc(o){return o}a(nc,"unwrap");var Xs=`"use strict";(()=>{var Ar=Object.defineProperty;var wr=Object.getOwnPropertySymbols;var Hr=Object.prototype.hasOwnProperty,Gr=Object.prototype.propertyIsEnumerable;var Nr=(n,r,e)=>r in n?Ar(n,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[r]=e,Q=(n,r)=>{for(var e in r||(r={}))Hr.call(r,e)&&Nr(n,e,r[e]);if(wr)for(var e of wr(r))Gr.call(r,e)&&Nr(n,e,r[e]);return n};var s=(n,r)=>Ar(n,"name",{value:r,configurable:!0});var mr=(n,r)=>{for(var e in r)Ar(n,e,{get:r[e],enumerable:!0})};function w(){String.kmwFromCharCode=function(n){var r=[],e;for(e=0;e<arguments.length;e++){var t=Number(arguments[e]);if(!isFinite(t)||t<0||t>1114111||Math.floor(t)!==t)throw new RangeError("Invalid code point "+t);t<65536?r.push(t):(t-=65536,r.push((t>>10)+55296),r.push(t%1024+56320))}return String.fromCharCode.apply(void 0,r)},String.prototype.kmwCharCodeAt=function(n){var r=String(this),e=0;if(n<0||n>=r.length)return NaN;for(var t=0;t<n;t++)if(e=r.kmwNextChar(e),e===null)return NaN;var o=r.charCodeAt(e);if(o>=55296&&o<=56319&&r.length>e+1){var a=r.charCodeAt(e+1);if(a>=56320&&a<=57343)return(o-55296<<10)+(a-56320)+65536}return o},String.prototype.kmwIndexOf=function(n,r){var e=String(this),t=e.indexOf(n,r);if(t<0)return t;for(var o=0,a=0;a!==null&&a<t;a=e.kmwNextChar(a))o++;return o},String.prototype.kmwLastIndexOf=function(n,r){var e=String(this),t=e.lastIndexOf(n,r);if(t<0)return t;for(var o=0,a=0;a!==null&&a<t;a=e.kmwNextChar(a))o++;return o},String.prototype.kmwLength=function(){var n=String(this);if(n.length==0)return 0;for(var r=0,e=0;e!==null;r++)e=n.kmwNextChar(e);return r},String.prototype.kmwSlice=function(n,r){var e=String(this),t=e.kmwCodePointToCodeUnit(n),o=e.kmwCodePointToCodeUnit(r);return t===null||o===null?"":e.slice(t,o)},String.prototype.kmwSubstr=function(n,r){var e=String(this);n<0&&(n=e.kmwLength()+n),n<0&&(n=0);var t=e.kmwCodePointToCodeUnit(n),o=t;if(t===null)return"";if(arguments.length<2)o=e.length;else for(var a=0;a<r;a++)o=e.kmwNextChar(o);return o===null?e.substring(t):e.substring(t,o)},String.prototype.kmwSubstring=function(n,r){var e=String(this),t,o;if(typeof r=="undefined")t=e.kmwCodePointToCodeUnit(n),o=e.length;else{if(n>r){var a=n;n=r,r=a}t=e.kmwCodePointToCodeUnit(n),o=e.kmwCodePointToCodeUnit(r)}return(isNaN(t)||t===null)&&(t=0),(isNaN(o)||o===null)&&(o=e.length),e.substring(t,o)},String.prototype.kmwNextChar=function(n){var r=String(this);if(n===null||n<0||n>=r.length-1)return null;var e=r.charCodeAt(n);if(e>=55296&&e<=56319&&r.length>n+1){var t=r.charCodeAt(n+1);if(t>=56320&&t<=57343)return n==r.length-2?null:n+2}return n+1},String.prototype.kmwPrevChar=function(n){var r=String(this);if(n==null||n<=0||n>r.length)return null;var e=r.charCodeAt(n-1);if(e>=56320&&e<=57343&&n>1){var t=r.charCodeAt(n-2);if(t>=55296&&t<=56319)return n-2}return n-1},String.prototype.kmwCodePointToCodeUnit=function(n){if(n===null)return null;var r=String(this),e=0;if(n<0){e=r.length;for(var t=0;t>n;t--)e=r.kmwPrevChar(e);return e}if(n==r.kmwLength())return r.length;for(var t=0;t<n;t++)e=r.kmwNextChar(e);return e},String.prototype.kmwCodeUnitToCodePoint=function(n){var r=String(this);return n===null?null:n==0?0:n<0?r.substr(n).kmwLength():r.substr(0,n).kmwLength()},String.prototype.kmwCharAt=function(n){var r=String(this);return n>=0?r.kmwSubstr(n,1):""},String.prototype.kmwBMPNextChar=function(n){var r=String(this);return n<0||n>=r.length-1?null:n+1},String.prototype.kmwBMPPrevChar=function(n){var r=String(this);return n<=0||n>r.length?null:n-1},String.prototype.kmwBMPCodePointToCodeUnit=function(n){return n},String.prototype.kmwBMPCodeUnitToCodePoint=function(n){return n},String.prototype.kmwBMPLength=function(){var n=String(this);return n.length},String.prototype.kmwBMPSubstr=function(n,r){var e=String(this);return n>-1?e.substr(n,r):e.substr(e.length+n,-n)},String.kmwEnableSupplementaryPlane=function(n){var r=String.prototype;String._kmwFromCharCode=n?String.kmwFromCharCode:String.fromCharCode,r._kmwCharAt=n?r.kmwCharAt:r.charAt,r._kmwCharCodeAt=n?r.kmwCharCodeAt:r.charCodeAt,r._kmwIndexOf=n?r.kmwIndexOf:r.indexOf,r._kmwLastIndexOf=n?r.kmwLastIndexOf:r.lastIndexOf,r._kmwSlice=n?r.kmwSlice:r.slice,r._kmwSubstring=n?r.kmwSubstring:r.substring,r._kmwSubstr=n?r.kmwSubstr:r.kmwBMPSubstr,r._kmwLength=n?r.kmwLength:r.kmwBMPLength,r._kmwNextChar=n?r.kmwNextChar:r.kmwBMPNextChar,r._kmwPrevChar=n?r.kmwPrevChar:r.kmwBMPPrevChar,r._kmwCodePointToCodeUnit=n?r.kmwCodePointToCodeUnit:r.kmwBMPCodePointToCodeUnit,r._kmwCodeUnitToCodePoint=n?r.kmwCodeUnitToCodePoint:r.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}s(w,"extendString");w();var hr={};mr(hr,{DummyModel:()=>Y,PriorityQueue:()=>c,QuoteBehavior:()=>G,SENTINEL_CODE_UNIT:()=>T,TrieModel:()=>X,applyTransform:()=>C,buildMergedTransform:()=>$,defaultApplyCasing:()=>xr,getLastPreCaretToken:()=>j,isHighSurrogate:()=>_,isLowSurrogate:()=>fr,isSentinel:()=>pr,tokenize:()=>V,transformToSuggestion:()=>U,wordbreak:()=>z});w();var T="\\uFDD0";function C(n,r){var B,k;let e=r.left||"",t=e.kmwLength(),o=t<n.deleteLeft?t:n.deleteLeft,a=e.kmwSubstr(0,t-o)+(n.insert||""),d=r.right||"",i=d.kmwLength(),p=i<((B=n.deleteRight)!=null?B:0)?i:(k=n.deleteRight)!=null?k:0,x=d.kmwSubstr(p);return{left:a,right:x,startOfBuffer:r.startOfBuffer,endOfBuffer:r.endOfBuffer,casingForm:r.casingForm}}s(C,"applyTransform");function $(n,r){let e=n.insert,t=r.deleteLeft;if(r.deleteLeft){let o=n.insert.kmwLength();o<=r.deleteLeft?(e="",t=r.deleteLeft-o):(e=n.insert.kmwSubstr(0,o-r.deleteLeft),t=0)}return{insert:e+r.insert,deleteLeft:n.deleteLeft+t,deleteRight:(n.deleteRight||0)+(r.deleteRight||0)}}s($,"buildMergedTransform");function _(n){return typeof n=="string"&&(n=n.charCodeAt(0)),n>=55296&&n<=56319}s(_,"isHighSurrogate");function fr(n){return typeof n=="string"&&(n=n.charCodeAt(0)),n>=56320&&n<=57343}s(fr,"isLowSurrogate");function pr(n){return n==T}s(pr,"isSentinel");function U(n,r){let e={transform:n,transformId:n.id,displayAs:n.insert};return(r===0||r)&&(e.p=r),e}s(U,"transformToSuggestion");function xr(n,r){switch(n){case"lower":return r.toLowerCase();case"upper":return r.toUpperCase();case"initial":let e=1;return r.length>1&&_(r.charAt(0))&&fr(r.charCodeAt(1))&&(e=2),r.substring(0,e).toUpperCase().concat(r.substring(e))}}s(xr,"defaultApplyCasing");var c=class{constructor(r,e){if(typeof r!="function"){this.comparator=r.comparator,this.heap=[].concat(r.heap);return}let t=r;this.comparator=t,this.heap=(e!=null?e:[]).slice(0),this.heapify()}static leftChildIndex(r){return r*2+1}static rightChildIndex(r){return r*2+2}static parentIndex(r){return Math.floor((r-1)/2)}heapify(r,e){if(r==null||e==null){this.heapify(0,this.count-1);return}let t=[],o=-1;for(let a=e;a>=r;a--){let d=c.parentIndex(a);this.siftDown(a)&&d<r&&o!=d&&(t.push(d),o=d)}for(o=-1;t.length>0;){let a=t.shift(),d=c.parentIndex(a);this.siftDown(a)&&d>=0&&o!=d&&(t.push(d),o=d)}}get count(){return this.heap.length}peek(){return this.heap[0]}enqueue(r){let e=this.heap.length;this.heap.push(r);let t=c.parentIndex,o=t(e);for(;e!==0&&this.comparator(this.heap[e],this.heap[o])<0;){let a=this.heap[e];this.heap[e]=this.heap[o],this.heap[o]=a,e=o,o=t(e)}}enqueueAll(r){if(r.length==0)return;let e=this.count;this.heap=this.heap.concat(r);let t=c.parentIndex(e);this.heapify(t>=0?t:0,c.parentIndex(this.count-1))}dequeue(){if(this.count==0)return;let r=this.heap[0],e=this.heap.pop();return this.heap.length>0&&(this.heap[0]=e,this.siftDown(0)),r}siftDown(r){let e=c.leftChildIndex(r),t=c.rightChildIndex(r),o=r;if(e<this.heap.length&&this.comparator(this.heap[e],this.heap[o])<0&&(o=e),t<this.heap.length&&this.comparator(this.heap[t],this.heap[o])<0&&(o=t),o!=r){let a=this.heap[r];return this.heap[r]=this.heap[o],this.heap[o]=a,this.siftDown(o),!0}else return!1}toArray(){return this.heap.slice(0)}};s(c,"PriorityQueue");var J=(t=>(t.noQuotes="no-quotes",t.useQuotes="use-quotes",t.default="default-quotes",t))(J||{});(r=>{function n(e,t,o,a){if(a=="default-quotes"||!a)throw"Specified quote behavior may be ambiguous - default behavior not specified (may not be .default)";switch(e=="default-quotes"&&(e=a),e){case"no-quotes":return t;case"use-quotes":let{open:d,close:i}=o.quotesForKeepSuggestion;return d+t+i;default:throw"Unsupported quote behavior state detected; implementation missing!"}}r.apply=n,s(n,"apply")})(J||(J={}));var G=J;function V(n,r){r=r||{left:void 0,startOfBuffer:void 0,endOfBuffer:void 0};let e=n(r.left||"")||[],t=n(r.right||"")||[],o;if(e.length>0&&(o=e[e.length-1]),e.length>1){let d=e[e.length-2];if(d.end==o.start&&o.text=="'"){let i={text:d.text+o.text,start:d.start,end:o.end,length:d.length+o.length};e.pop(),e.pop(),e.push(i),o=i}}let a={left:e.map(d=>d.text),right:t.map(d=>d.text),caretSplitsToken:!1};if(e.length>0&&t.length>0){let d=t[0],i=o.end!=r.left.length,p=d.start!=0;if(i||p)return a;n(o.text+d.text).length==1&&(a.caretSplitsToken=!0)}return a}s(V,"tokenize");function j(n,r){let e=V(n,r);return e.left.length>0?e.left.pop():""}s(j,"getLastPreCaretToken");function z(n,r){return j(n,r)}s(z,"wordbreak");var er={};mr(er,{ascii:()=>gr,default:()=>F,defaultWordbreaker:()=>F,placeholder:()=>Er});function Er(n){let r=0;return n.split(/\\s+/).map(e=>{let t={start:r,end:r+e.length,text:e,length:e.length};return r=t.end,t})}s(Er,"placeholder");function gr(n){let r=/[A-Za-z0-9']+/g,e=[],t;for(;(t=r.exec(n))!==null;)e.push(new sr(t[0],t.index));return e}s(gr,"ascii");var sr=class{constructor(r,e){this.text=r,this.start=e}get length(){return this.text.length}get end(){return this.start+this.text.length}};s(sr,"RegExpDerivedSpan");var Mr=["Other","LF","Newline","CR","WSegSpace","Double_Quote","Single_Quote","MidNum","MidNumLet","Numeric","MidLetter","ALetter","ExtendNumLet","Format","Extend","Hebrew_Letter","ZWJ","Katakana","Regional_Indicator","sot","eot"];var Br=[[0,0],[10,1],[11,2],[13,3],[14,0],[32,4],[33,0],[34,5],[35,0],[39,6],[40,0],[44,7],[45,0],[46,8],[47,0],[48,9],[58,10],[59,7],[60,0],[65,11],[91,0],[95,12],[96,0],[97,11],[123,0],[133,2],[134,0],[170,11],[171,0],[173,13],[174,0],[181,11],[182,0],[183,10],[184,0],[186,11],[187,0],[192,11],[215,0],[216,11],[247,0],[248,11],[728,0],[734,11],[768,14],[880,11],[885,0],[886,11],[888,0],[890,11],[894,7],[895,11],[896,0],[902,11],[903,10],[904,11],[907,0],[908,11],[909,0],[910,11],[930,0],[931,11],[1014,0],[1015,11],[1154,0],[1155,14],[1162,11],[1328,0],[1329,11],[1367,0],[1369,11],[1373,0],[1374,11],[1375,10],[1376,11],[1417,7],[1418,11],[1419,0],[1425,14],[1470,0],[1471,14],[1472,0],[1473,14],[1475,0],[1476,14],[1478,0],[1479,14],[1480,0],[1488,15],[1515,0],[1519,15],[1523,11],[1524,10],[1525,0],[1536,13],[1542,0],[1548,7],[1550,0],[1552,14],[1563,0],[1564,13],[1565,0],[1568,11],[1611,14],[1632,9],[1642,0],[1643,9],[1644,7],[1645,0],[1646,11],[1648,14],[1649,11],[1748,0],[1749,11],[1750,14],[1757,13],[1758,0],[1759,14],[1765,11],[1767,14],[1769,0],[1770,14],[1774,11],[1776,9],[1786,11],[1789,0],[1791,11],[1792,0],[1807,13],[1808,11],[1809,14],[1810,11],[1840,14],[1867,0],[1869,11],[1958,14],[1969,11],[1970,0],[1984,9],[1994,11],[2027,14],[2036,11],[2038,0],[2040,7],[2041,0],[2042,11],[2043,0],[2045,14],[2046,0],[2048,11],[2070,14],[2074,11],[2075,14],[2084,11],[2085,14],[2088,11],[2089,14],[2094,0],[2112,11],[2137,14],[2140,0],[2144,11],[2155,0],[2208,11],[2229,0],[2230,11],[2248,0],[2259,14],[2274,13],[2275,14],[2308,11],[2362,14],[2365,11],[2366,14],[2384,11],[2385,14],[2392,11],[2402,14],[2404,0],[2406,9],[2416,0],[2417,11],[2433,14],[2436,0],[2437,11],[2445,0],[2447,11],[2449,0],[2451,11],[2473,0],[2474,11],[2481,0],[2482,11],[2483,0],[2486,11],[2490,0],[2492,14],[2493,11],[2494,14],[2501,0],[2503,14],[2505,0],[2507,14],[2510,11],[2511,0],[2519,14],[2520,0],[2524,11],[2526,0],[2527,11],[2530,14],[2532,0],[2534,9],[2544,11],[2546,0],[2556,11],[2557,0],[2558,14],[2559,0],[2561,14],[2564,0],[2565,11],[2571,0],[2575,11],[2577,0],[2579,11],[2601,0],[2602,11],[2609,0],[2610,11],[2612,0],[2613,11],[2615,0],[2616,11],[2618,0],[2620,14],[2621,0],[2622,14],[2627,0],[2631,14],[2633,0],[2635,14],[2638,0],[2641,14],[2642,0],[2649,11],[2653,0],[2654,11],[2655,0],[2662,9],[2672,14],[2674,11],[2677,14],[2678,0],[2689,14],[2692,0],[2693,11],[2702,0],[2703,11],[2706,0],[2707,11],[2729,0],[2730,11],[2737,0],[2738,11],[2740,0],[2741,11],[2746,0],[2748,14],[2749,11],[2750,14],[2758,0],[2759,14],[2762,0],[2763,14],[2766,0],[2768,11],[2769,0],[2784,11],[2786,14],[2788,0],[2790,9],[2800,0],[2809,11],[2810,14],[2816,0],[2817,14],[2820,0],[2821,11],[2829,0],[2831,11],[2833,0],[2835,11],[2857,0],[2858,11],[2865,0],[2866,11],[2868,0],[2869,11],[2874,0],[2876,14],[2877,11],[2878,14],[2885,0],[2887,14],[2889,0],[2891,14],[2894,0],[2901,14],[2904,0],[2908,11],[2910,0],[2911,11],[2914,14],[2916,0],[2918,9],[2928,0],[2929,11],[2930,0],[2946,14],[2947,11],[2948,0],[2949,11],[2955,0],[2958,11],[2961,0],[2962,11],[2966,0],[2969,11],[2971,0],[2972,11],[2973,0],[2974,11],[2976,0],[2979,11],[2981,0],[2984,11],[2987,0],[2990,11],[3002,0],[3006,14],[3011,0],[3014,14],[3017,0],[3018,14],[3022,0],[3024,11],[3025,0],[3031,14],[3032,0],[3046,9],[3056,0],[3072,14],[3077,11],[3085,0],[3086,11],[3089,0],[3090,11],[3113,0],[3114,11],[3130,0],[3133,11],[3134,14],[3141,0],[3142,14],[3145,0],[3146,14],[3150,0],[3157,14],[3159,0],[3160,11],[3163,0],[3168,11],[3170,14],[3172,0],[3174,9],[3184,0],[3200,11],[3201,14],[3204,0],[3205,11],[3213,0],[3214,11],[3217,0],[3218,11],[3241,0],[3242,11],[3252,0],[3253,11],[3258,0],[3260,14],[3261,11],[3262,14],[3269,0],[3270,14],[3273,0],[3274,14],[3278,0],[3285,14],[3287,0],[3294,11],[3295,0],[3296,11],[3298,14],[3300,0],[3302,9],[3312,0],[3313,11],[3315,0],[3328,14],[3332,11],[3341,0],[3342,11],[3345,0],[3346,11],[3387,14],[3389,11],[3390,14],[3397,0],[3398,14],[3401,0],[3402,14],[3406,11],[3407,0],[3412,11],[3415,14],[3416,0],[3423,11],[3426,14],[3428,0],[3430,9],[3440,0],[3450,11],[3456,0],[3457,14],[3460,0],[3461,11],[3479,0],[3482,11],[3506,0],[3507,11],[3516,0],[3517,11],[3518,0],[3520,11],[3527,0],[3530,14],[3531,0],[3535,14],[3541,0],[3542,14],[3543,0],[3544,14],[3552,0],[3558,9],[3568,0],[3570,14],[3572,0],[3633,14],[3634,0],[3636,14],[3643,0],[3655,14],[3663,0],[3664,9],[3674,0],[3761,14],[3762,0],[3764,14],[3773,0],[3784,14],[3790,0],[3792,9],[3802,0],[3840,11],[3841,0],[3864,14],[3866,0],[3872,9],[3882,0],[3893,14],[3894,0],[3895,14],[3896,0],[3897,14],[3898,0],[3902,14],[3904,11],[3912,0],[3913,11],[3949,0],[3953,14],[3973,0],[3974,14],[3976,11],[3981,14],[3992,0],[3993,14],[4029,0],[4038,14],[4039,0],[4139,14],[4159,0],[4160,9],[4170,0],[4182,14],[4186,0],[4190,14],[4193,0],[4194,14],[4197,0],[4199,14],[4206,0],[4209,14],[4213,0],[4226,14],[4238,0],[4239,14],[4240,9],[4250,14],[4254,0],[4256,11],[4294,0],[4295,11],[4296,0],[4301,11],[4302,0],[4304,11],[4347,0],[4348,11],[4681,0],[4682,11],[4686,0],[4688,11],[4695,0],[4696,11],[4697,0],[4698,11],[4702,0],[4704,11],[4745,0],[4746,11],[4750,0],[4752,11],[4785,0],[4786,11],[4790,0],[4792,11],[4799,0],[4800,11],[4801,0],[4802,11],[4806,0],[4808,11],[4823,0],[4824,11],[4881,0],[4882,11],[4886,0],[4888,11],[4955,0],[4957,14],[4960,0],[4992,11],[5008,0],[5024,11],[5110,0],[5112,11],[5118,0],[5121,11],[5741,0],[5743,11],[5760,4],[5761,11],[5787,0],[5792,11],[5867,0],[5870,11],[5881,0],[5888,11],[5901,0],[5902,11],[5906,14],[5909,0],[5920,11],[5938,14],[5941,0],[5952,11],[5970,14],[5972,0],[5984,11],[5997,0],[5998,11],[6001,0],[6002,14],[6004,0],[6068,14],[6100,0],[6109,14],[6110,0],[6112,9],[6122,0],[6155,14],[6158,13],[6159,0],[6160,9],[6170,0],[6176,11],[6265,0],[6272,11],[6277,14],[6279,11],[6313,14],[6314,11],[6315,0],[6320,11],[6390,0],[6400,11],[6431,0],[6432,14],[6444,0],[6448,14],[6460,0],[6470,9],[6480,0],[6608,9],[6618,0],[6656,11],[6679,14],[6684,0],[6741,14],[6751,0],[6752,14],[6781,0],[6783,14],[6784,9],[6794,0],[6800,9],[6810,0],[6832,14],[6849,0],[6912,14],[6917,11],[6964,14],[6981,11],[6988,0],[6992,9],[7002,0],[7019,14],[7028,0],[7040,14],[7043,11],[7073,14],[7086,11],[7088,9],[7098,11],[7142,14],[7156,0],[7168,11],[7204,14],[7224,0],[7232,9],[7242,0],[7245,11],[7248,9],[7258,11],[7294,0],[7296,11],[7305,0],[7312,11],[7355,0],[7357,11],[7360,0],[7376,14],[7379,0],[7380,14],[7401,11],[7405,14],[7406,11],[7412,14],[7413,11],[7415,14],[7418,11],[7419,0],[7424,11],[7616,14],[7674,0],[7675,14],[7680,11],[7958,0],[7960,11],[7966,0],[7968,11],[8006,0],[8008,11],[8014,0],[8016,11],[8024,0],[8025,11],[8026,0],[8027,11],[8028,0],[8029,11],[8030,0],[8031,11],[8062,0],[8064,11],[8117,0],[8118,11],[8125,0],[8126,11],[8127,0],[8130,11],[8133,0],[8134,11],[8141,0],[8144,11],[8148,0],[8150,11],[8156,0],[8160,11],[8173,0],[8178,11],[8181,0],[8182,11],[8189,0],[8192,4],[8199,0],[8200,4],[8203,0],[8204,14],[8205,16],[8206,13],[8208,0],[8216,8],[8218,0],[8228,8],[8229,0],[8231,10],[8232,2],[8234,13],[8239,12],[8240,0],[8255,12],[8257,0],[8260,7],[8261,0],[8276,12],[8277,0],[8287,4],[8288,13],[8293,0],[8294,13],[8304,0],[8305,11],[8306,0],[8319,11],[8320,0],[8336,11],[8349,0],[8400,14],[8433,0],[8450,11],[8451,0],[8455,11],[8456,0],[8458,11],[8468,0],[8469,11],[8470,0],[8473,11],[8478,0],[8484,11],[8485,0],[8486,11],[8487,0],[8488,11],[8489,0],[8490,11],[8494,0],[8495,11],[8506,0],[8508,11],[8512,0],[8517,11],[8522,0],[8526,11],[8527,0],[8544,11],[8585,0],[9398,11],[9450,0],[11264,11],[11311,0],[11312,11],[11359,0],[11360,11],[11493,0],[11499,11],[11503,14],[11506,11],[11508,0],[11520,11],[11558,0],[11559,11],[11560,0],[11565,11],[11566,0],[11568,11],[11624,0],[11631,11],[11632,0],[11647,14],[11648,11],[11671,0],[11680,11],[11687,0],[11688,11],[11695,0],[11696,11],[11703,0],[11704,11],[11711,0],[11712,11],[11719,0],[11720,11],[11727,0],[11728,11],[11735,0],[11736,11],[11743,0],[11744,14],[11776,0],[11823,11],[11824,0],[12288,4],[12289,0],[12293,11],[12294,0],[12330,14],[12336,0],[12337,17],[12342,0],[12347,11],[12349,0],[12441,14],[12443,17],[12445,0],[12448,17],[12539,0],[12540,17],[12544,0],[12549,11],[12592,0],[12593,11],[12687,0],[12704,11],[12736,0],[12784,17],[12800,0],[13008,17],[13055,0],[13056,17],[13144,0],[40960,11],[42125,0],[42192,11],[42238,0],[42240,11],[42509,0],[42512,11],[42528,9],[42538,11],[42540,0],[42560,11],[42607,14],[42611,0],[42612,14],[42622,0],[42623,11],[42654,14],[42656,11],[42736,14],[42738,0],[42760,11],[42944,0],[42946,11],[42955,0],[42997,11],[43010,14],[43011,11],[43014,14],[43015,11],[43019,14],[43020,11],[43043,14],[43048,0],[43052,14],[43053,0],[43072,11],[43124,0],[43136,14],[43138,11],[43188,14],[43206,0],[43216,9],[43226,0],[43232,14],[43250,11],[43256,0],[43259,11],[43260,0],[43261,11],[43263,14],[43264,9],[43274,11],[43302,14],[43310,0],[43312,11],[43335,14],[43348,0],[43360,11],[43389,0],[43392,14],[43396,11],[43443,14],[43457,0],[43471,11],[43472,9],[43482,0],[43493,14],[43494,0],[43504,9],[43514,0],[43520,11],[43561,14],[43575,0],[43584,11],[43587,14],[43588,11],[43596,14],[43598,0],[43600,9],[43610,0],[43643,14],[43646,0],[43696,14],[43697,0],[43698,14],[43701,0],[43703,14],[43705,0],[43710,14],[43712,0],[43713,14],[43714,0],[43744,11],[43755,14],[43760,0],[43762,11],[43765,14],[43767,0],[43777,11],[43783,0],[43785,11],[43791,0],[43793,11],[43799,0],[43808,11],[43815,0],[43816,11],[43823,0],[43824,11],[43882,0],[43888,11],[44003,14],[44011,0],[44012,14],[44014,0],[44016,9],[44026,0],[44032,11],[55204,0],[55216,11],[55239,0],[55243,11],[55292,0],[64256,11],[64263,0],[64275,11],[64280,0],[64285,15],[64286,14],[64287,15],[64297,0],[64298,15],[64311,0],[64312,15],[64317,0],[64318,15],[64319,0],[64320,15],[64322,0],[64323,15],[64325,0],[64326,15],[64336,11],[64434,0],[64467,11],[64830,0],[64848,11],[64912,0],[64914,11],[64968,0],[65008,11],[65020,0],[65024,14],[65040,7],[65041,0],[65043,10],[65044,7],[65045,0],[65056,14],[65072,0],[65075,12],[65077,0],[65101,12],[65104,7],[65105,0],[65106,8],[65107,0],[65108,7],[65109,10],[65110,0],[65136,11],[65141,0],[65142,11],[65277,0],[65279,13],[65280,0],[65287,8],[65288,0],[65292,7],[65293,0],[65294,8],[65295,0],[65296,9],[65306,10],[65307,7],[65308,0],[65313,11],[65339,0],[65343,12],[65344,0],[65345,11],[65371,0],[65382,17],[65438,14],[65440,11],[65471,0],[65474,11],[65480,0],[65482,11],[65488,0],[65490,11],[65496,0],[65498,11],[65501,0],[65529,13],[65532,0],[65536,11],[65548,0],[65549,11],[65575,0],[65576,11],[65595,0],[65596,11],[65598,0],[65599,11],[65614,0],[65616,11],[65630,0],[65664,11],[65787,0],[65856,11],[65909,0],[66045,14],[66046,0],[66176,11],[66205,0],[66208,11],[66257,0],[66272,14],[66273,0],[66304,11],[66336,0],[66349,11],[66379,0],[66384,11],[66422,14],[66427,0],[66432,11],[66462,0],[66464,11],[66500,0],[66504,11],[66512,0],[66513,11],[66518,0],[66560,11],[66718,0],[66720,9],[66730,0],[66736,11],[66772,0],[66776,11],[66812,0],[66816,11],[66856,0],[66864,11],[66916,0],[67072,11],[67383,0],[67392,11],[67414,0],[67424,11],[67432,0],[67584,11],[67590,0],[67592,11],[67593,0],[67594,11],[67638,0],[67639,11],[67641,0],[67644,11],[67645,0],[67647,11],[67670,0],[67680,11],[67703,0],[67712,11],[67743,0],[67808,11],[67827,0],[67828,11],[67830,0],[67840,11],[67862,0],[67872,11],[67898,0],[67968,11],[68024,0],[68030,11],[68032,0],[68096,11],[68097,14],[68100,0],[68101,14],[68103,0],[68108,14],[68112,11],[68116,0],[68117,11],[68120,0],[68121,11],[68150,0],[68152,14],[68155,0],[68159,14],[68160,0],[68192,11],[68221,0],[68224,11],[68253,0],[68288,11],[68296,0],[68297,11],[68325,14],[68327,0],[68352,11],[68406,0],[68416,11],[68438,0],[68448,11],[68467,0],[68480,11],[68498,0],[68608,11],[68681,0],[68736,11],[68787,0],[68800,11],[68851,0],[68864,11],[68900,14],[68904,0],[68912,9],[68922,0],[69248,11],[69290,0],[69291,14],[69293,0],[69296,11],[69298,0],[69376,11],[69405,0],[69415,11],[69416,0],[69424,11],[69446,14],[69457,0],[69552,11],[69573,0],[69600,11],[69623,0],[69632,14],[69635,11],[69688,14],[69703,0],[69734,9],[69744,0],[69759,14],[69763,11],[69808,14],[69819,0],[69821,13],[69822,0],[69837,13],[69838,0],[69840,11],[69865,0],[69872,9],[69882,0],[69888,14],[69891,11],[69927,14],[69941,0],[69942,9],[69952,0],[69956,11],[69957,14],[69959,11],[69960,0],[69968,11],[70003,14],[70004,0],[70006,11],[70007,0],[70016,14],[70019,11],[70067,14],[70081,11],[70085,0],[70089,14],[70093,0],[70094,14],[70096,9],[70106,11],[70107,0],[70108,11],[70109,0],[70144,11],[70162,0],[70163,11],[70188,14],[70200,0],[70206,14],[70207,0],[70272,11],[70279,0],[70280,11],[70281,0],[70282,11],[70286,0],[70287,11],[70302,0],[70303,11],[70313,0],[70320,11],[70367,14],[70379,0],[70384,9],[70394,0],[70400,14],[70404,0],[70405,11],[70413,0],[70415,11],[70417,0],[70419,11],[70441,0],[70442,11],[70449,0],[70450,11],[70452,0],[70453,11],[70458,0],[70459,14],[70461,11],[70462,14],[70469,0],[70471,14],[70473,0],[70475,14],[70478,0],[70480,11],[70481,0],[70487,14],[70488,0],[70493,11],[70498,14],[70500,0],[70502,14],[70509,0],[70512,14],[70517,0],[70656,11],[70709,14],[70727,11],[70731,0],[70736,9],[70746,0],[70750,14],[70751,11],[70754,0],[70784,11],[70832,14],[70852,11],[70854,0],[70855,11],[70856,0],[70864,9],[70874,0],[71040,11],[71087,14],[71094,0],[71096,14],[71105,0],[71128,11],[71132,14],[71134,0],[71168,11],[71216,14],[71233,0],[71236,11],[71237,0],[71248,9],[71258,0],[71296,11],[71339,14],[71352,11],[71353,0],[71360,9],[71370,0],[71453,14],[71468,0],[71472,9],[71482,0],[71680,11],[71724,14],[71739,0],[71840,11],[71904,9],[71914,0],[71935,11],[71943,0],[71945,11],[71946,0],[71948,11],[71956,0],[71957,11],[71959,0],[71960,11],[71984,14],[71990,0],[71991,14],[71993,0],[71995,14],[71999,11],[72e3,14],[72001,11],[72002,14],[72004,0],[72016,9],[72026,0],[72096,11],[72104,0],[72106,11],[72145,14],[72152,0],[72154,14],[72161,11],[72162,0],[72163,11],[72164,14],[72165,0],[72192,11],[72193,14],[72203,11],[72243,14],[72250,11],[72251,14],[72255,0],[72263,14],[72264,0],[72272,11],[72273,14],[72284,11],[72330,14],[72346,0],[72349,11],[72350,0],[72384,11],[72441,0],[72704,11],[72713,0],[72714,11],[72751,14],[72759,0],[72760,14],[72768,11],[72769,0],[72784,9],[72794,0],[72818,11],[72848,0],[72850,14],[72872,0],[72873,14],[72887,0],[72960,11],[72967,0],[72968,11],[72970,0],[72971,11],[73009,14],[73015,0],[73018,14],[73019,0],[73020,14],[73022,0],[73023,14],[73030,11],[73031,14],[73032,0],[73040,9],[73050,0],[73056,11],[73062,0],[73063,11],[73065,0],[73066,11],[73098,14],[73103,0],[73104,14],[73106,0],[73107,14],[73112,11],[73113,0],[73120,9],[73130,0],[73440,11],[73459,14],[73463,0],[73648,11],[73649,0],[73728,11],[74650,0],[74752,11],[74863,0],[74880,11],[75076,0],[77824,11],[78895,0],[78896,13],[78905,0],[82944,11],[83527,0],[92160,11],[92729,0],[92736,11],[92767,0],[92768,9],[92778,0],[92880,11],[92910,0],[92912,14],[92917,0],[92928,11],[92976,14],[92983,0],[92992,11],[92996,0],[93008,9],[93018,0],[93027,11],[93048,0],[93053,11],[93072,0],[93760,11],[93824,0],[93952,11],[94027,0],[94031,14],[94032,11],[94033,14],[94088,0],[94095,14],[94099,11],[94112,0],[94176,11],[94178,0],[94179,11],[94180,14],[94181,0],[94192,14],[94194,0],[110592,17],[110593,0],[110948,17],[110952,0],[113664,11],[113771,0],[113776,11],[113789,0],[113792,11],[113801,0],[113808,11],[113818,0],[113821,14],[113823,0],[113824,13],[113828,0],[119141,14],[119146,0],[119149,14],[119155,13],[119163,14],[119171,0],[119173,14],[119180,0],[119210,14],[119214,0],[119362,14],[119365,0],[119808,11],[119893,0],[119894,11],[119965,0],[119966,11],[119968,0],[119970,11],[119971,0],[119973,11],[119975,0],[119977,11],[119981,0],[119982,11],[119994,0],[119995,11],[119996,0],[119997,11],[120004,0],[120005,11],[120070,0],[120071,11],[120075,0],[120077,11],[120085,0],[120086,11],[120093,0],[120094,11],[120122,0],[120123,11],[120127,0],[120128,11],[120133,0],[120134,11],[120135,0],[120138,11],[120145,0],[120146,11],[120486,0],[120488,11],[120513,0],[120514,11],[120539,0],[120540,11],[120571,0],[120572,11],[120597,0],[120598,11],[120629,0],[120630,11],[120655,0],[120656,11],[120687,0],[120688,11],[120713,0],[120714,11],[120745,0],[120746,11],[120771,0],[120772,11],[120780,0],[120782,9],[120832,0],[121344,14],[121399,0],[121403,14],[121453,0],[121461,14],[121462,0],[121476,14],[121477,0],[121499,14],[121504,0],[121505,14],[121520,0],[122880,14],[122887,0],[122888,14],[122905,0],[122907,14],[122914,0],[122915,14],[122917,0],[122918,14],[122923,0],[123136,11],[123181,0],[123184,14],[123191,11],[123198,0],[123200,9],[123210,0],[123214,11],[123215,0],[123584,11],[123628,14],[123632,9],[123642,0],[124928,11],[125125,0],[125136,14],[125143,0],[125184,11],[125252,14],[125259,11],[125260,0],[125264,9],[125274,0],[126464,11],[126468,0],[126469,11],[126496,0],[126497,11],[126499,0],[126500,11],[126501,0],[126503,11],[126504,0],[126505,11],[126515,0],[126516,11],[126520,0],[126521,11],[126522,0],[126523,11],[126524,0],[126530,11],[126531,0],[126535,11],[126536,0],[126537,11],[126538,0],[126539,11],[126540,0],[126541,11],[126544,0],[126545,11],[126547,0],[126548,11],[126549,0],[126551,11],[126552,0],[126553,11],[126554,0],[126555,11],[126556,0],[126557,11],[126558,0],[126559,11],[126560,0],[126561,11],[126563,0],[126564,11],[126565,0],[126567,11],[126571,0],[126572,11],[126579,0],[126580,11],[126584,0],[126585,11],[126589,0],[126590,11],[126591,0],[126592,11],[126602,0],[126603,11],[126620,0],[126625,11],[126628,0],[126629,11],[126634,0],[126635,11],[126652,0],[127280,11],[127306,0],[127312,11],[127338,0],[127344,11],[127370,0],[127462,18],[127488,0],[127995,14],[128e3,0],[130032,9],[130042,0],[917505,13],[917506,0],[917536,14],[917632,0],[917760,14],[918e3,0]];function F(n,r){let e=Xr(n,r);if(e.length==0)return[];let t=[];for(let o=0;o<e.length-1;o++){let a=e[o],d=e[o+1],i=new rr(n,a,d);zr(i.text,r)?t.push(i):o==e.length-2&&(i=new rr(n,d,d),t.push(i))}return t}s(F,"default_");var rr=class{constructor(r,e,t){this._source=r,this.start=e,this.end=t}get text(){return this._source.substring(this.start,this.end)}get length(){return this.end-this.start}};s(rr,"LazySpan");var R=class{constructor(r,e,t,o,a,d){this.lookbehind=19;this.left=19;this.right=19;this.text=r,this.options=e,arguments.length==3?this.lookahead=this.wordbreakPropertyAt(t):(this.lookbehind=t,this.left=o,this.right=a,this.lookahead=d)}next(r){let e=this.wordbreakPropertyAt(r);return new R(this.text,this.options,this.left,this.right,this.lookahead,e)}ignoringRight(r){let e=this.wordbreakPropertyAt(r);return new R(this.text,this.options,this.lookbehind,this.left,this.lookahead,e)}ignoringLookahead(r){let e=this.wordbreakPropertyAt(r);return new R(this.text,this.options,this.lookbehind,this.left,this.right,e)}wordbreakPropertyAt(r){return r<0?19:r>=this.text.length?20:vr(this.text[r])?Or(this.text[r]+this.text[r+1]):Or(this.text[r],this.options)}match(r,e,t,o){var d,i,p,x;let a=(d=r==null?void 0:r.includes(this.lookbehind))!=null?d:!0;return a=a&&((i=e==null?void 0:e.includes(this.left))!=null?i:!0),a=a&&((p=t==null?void 0:t.includes(this.right))!=null?p:!0),a&&((x=o==null?void 0:o.includes(this.lookahead))!=null?x:!0)}propertyMatch(r,e,t,o){let a=s(d=>Ir(d,this.options),"propMapper");return this.match(r==null?void 0:r.map(a),e==null?void 0:e.map(a),t==null?void 0:t.map(a),o==null?void 0:o.map(a))}};s(R,"BreakerContext");function zr(n,r){return!Array.from(n).map(e=>Or(e,r)).every(e=>e===3||e===1||e===2||e===4)}s(zr,"isNonSpace");function Xr(n,r){if(n.length===0)return[];r&&!r.rules&&(r.rules=[]);let e=[],t,o=0,a=new R(n,r,o),d=0;do{if(t=o,o=i(o),a=a.next(o),a.match(null,[19],null,null)){e.push(t);continue}if(a.match(null,null,[20],null)){e.push(t);break}if(a.match(null,[3],[1],null))continue;let p=[2,3,1];if(a.match(null,p,null,null)){e.push(t);continue}if(a.match(null,null,p,null)){e.push(t);continue}if(a.match(null,[4],[4],null))continue;let x=[13,14,16];for(;a.match(null,null,x,null);)[t,o]=[o,i(o)],a=a.ignoringRight(o);if(a.right===20){e.push(t);break}for(;a.match(null,null,null,x);)o=i(o),a=a.ignoringLookahead(o);let B=[11,15],k=[8,6];if(r!=null&&r.rules){let A=!1;for(let E of r.rules)if(A=E.match(a),A){E.breakIfMatch&&e.push(t);break}if(A)continue}if(a.match(null,B,B,null))continue;let l=[10].concat(k);if(a.match(null,B,l,B)||a.match(B,l,B,null)||a.match(null,[15],[6],null)||a.match(null,[15],[5],[15])||a.match([15],[5],[15],null)||a.match(null,[9],[9],null)||a.match(null,B,[9],null)||a.match(null,[9],B,null))continue;let h=[7].concat(k);if(a.match([9],h,[9],null)||a.match(null,[9],h,[9])||a.match(null,[17],[17],null))continue;let u=[17,9].concat(B);if(!a.match(null,u,[12],null)&&!a.match(null,[12],[12],null)&&!a.match(null,[12],u,null)){if(a.right===18){if(d+=1,d%2==1)continue}else d=0;e.push(t)}}while(t<n.length);return e;function i(p){return p>=n.length?n.length:vr(n[p])?p+2:p+1}}s(Xr,"findBoundaries");function vr(n){let r=n.charCodeAt(0);return r>=55296&&r<=56319}s(vr,"isStartOfSurrogatePair");function Or(n,r){if(r!=null&&r.propertyMapping){let t=r.propertyMapping(n);if(t)return Ir(t,r)}let e=n.codePointAt(0);return Lr(e,0,Br.length-1)}s(Or,"property");function Ir(n,r){var o,a;let e=s(d=>d.toLowerCase()==n.toLowerCase(),"matcher"),t=(a=(o=r==null?void 0:r.customProperties)==null?void 0:o.findIndex(e))!=null?a:-1;return t!=-1?-t-1:Mr.findIndex(e)}s(Ir,"propertyVal");function Lr(n,r,e){if(e<r)return 0;let t=r+~~((e-r)/2),o=Br[t],a=Br[t+1],d=a?a[0]:1/0;return n<o[0]?Lr(n,r,t-1):n>=d?Lr(n,t+1,e):o[1]}s(Lr,"searchForProperty");w();var Ur=12,N=class{constructor(r,e){this.root=r,this.prefix=e}*children(){let r=this.root;if(r.type=="internal"){for(let e of r.values){let t=r.children[e];if(_(e))if(t.type=="internal"){let o=t;for(let a of o.values){let d=this.prefix+e+a;yield{char:e+a,traversal:function(){return new N(o.children[a],d)}}}}else{let o=t.entries[0].key;e=e+o[this.prefix.length+1];let a=this.prefix+e;yield{char:e,traversal:function(){return new N(t,a)}}}else{if(pr(e))continue;if(e){let o=this.prefix+e;yield{char:e,traversal:function(){return new N(t,o)}}}else continue}}return}else{let e=this.prefix,t=r.entries.filter(function(o){return o.key!=e&&e.length<o.key.length});for(let{key:o}of t){let a=o[e.length];_(a)&&(a=a+o[e.length+1]),yield{char:a,traversal:function(){return new N(r,e+a)}}}return}}get entries(){if(this.root.type=="leaf"){let r=this.prefix;return this.root.entries.filter(function(t){return t.key==r}).map(function(t){return t.content})}else{let r=this.root.children[T];return r&&r.type=="leaf"?r.entries.map(function(e){return e.content}):[]}}};s(N,"Traversal");var X=class{constructor(r,e={}){this.languageUsesCasing=e.languageUsesCasing,this.applyCasing=e.applyCasing,this._trie=new kr(r.root,r.totalWeight,e.searchTermToKey||Zr),this.breakWords=e.wordBreaker||F,this.punctuation=e.punctuation}configure(r){var e;return this.configuration={leftContextCodePoints:r.maxLeftContextCodePoints,rightContextCodePoints:(e=r.maxRightContextCodePoints)!=null?e:0}}toKey(r){return this._trie.toKey(r)}predict(r,e){if(!r.insert&&!e.left&&!e.right&&e.startOfBuffer&&e.endOfBuffer)return d(this._trie.firstN(Ur).map(({text:i,p})=>({transform:{insert:i,deleteLeft:0},displayAs:i,p})));let t=C(r,e),o=r.deleteLeft-r.insert.kmwLength(),a=j(this.breakWords,t);return d(this._trie.lookup(a).map(({text:i,p})=>U({insert:i,deleteLeft:o+a.kmwLength()},p)));function d(i){let p=[];for(let x of i)p.push({sample:x,p:x.p});return p}}get wordbreaker(){return this.breakWords}traverseFromRoot(){return new N(this._trie.root,"")}};s(X,"TrieModel");var kr=class{constructor(r,e,t){this.root=r,this.toKey=t,this.totalWeight=e}lookup(r){let e=this.toKey(r),t=Rr(this.root,e);return t===null?[]:_r(t,e,this.totalWeight)}firstN(r){return _r(this.root,"",this.totalWeight,r)}};s(kr,"Trie");function Rr(n,r,e=0){if(n.type==="leaf"||e===r.length)return n;let t=r[e];return n.children[t]?Rr(n.children[t],r,e+1):null}s(Rr,"findPrefix");function _r(n,r,e,t=Ur){let o=new c(function(d,i){return(i?i.weight:0)-(d?d.weight:0)}),a=[];if(n.type==="leaf"){for(let d of n.entries)if(d.key.indexOf(r)==0){let{content:i,weight:p}=d;if(a.push({text:i,p:p/e}),a.length>=t)return a}}else{o.enqueue(n);let d;for(;d=o.dequeue();)if(Yr(d))if(d.type==="leaf")o.enqueueAll(d.entries);else{let i=d;o.enqueueAll(d.values.map(p=>i.children[p]))}else if(a.push({text:d.content,p:d.weight/e}),a.length>=t)return a}return a}s(_r,"getSortedResults");function Yr(n){return"type"in n}s(Yr,"isNode");function Zr(n){return n.normalize("NFD").replace(/[\\u0300-\\u036f]/g,"").toLowerCase()}s(Zr,"defaultSearchTermToKey");var Y=class{constructor(r){r=r||{},this._futureSuggestions=r.futureSuggestions?r.futureSuggestions.slice():[],r.punctuation&&(this.punctuation=r.punctuation)}configure(r){return this.configuration={leftContextCodePoints:r.maxLeftContextCodePoints,rightContextCodePoints:r.maxRightContextCodePoints},this.configuration}predict(r,e,t){let o=s(function(d){let i=[],p=d.length;for(let x of d)i.push({sample:x,p:1});return i},"makeUniformDistribution");if(t)return o(t);let a=this._futureSuggestions.shift();return a?o(a):[]}};s(Y,"DummyModel");var nr={};mr(nr,{ClassicalDistanceCalculation:()=>W,ContextTracker:()=>v,QUEUE_NODE_COMPARATOR:()=>yr,SearchNode:()=>b,SearchResult:()=>tr,SearchSpace:()=>m,TrackedContextState:()=>M,TrackedContextSuggestion:()=>lr,TrackedContextToken:()=>D});var W=class{constructor(r){this.diagonalWidth=2;this.inputSequence=[];this.matchSequence=[];if(r){let e=r.resolvedDistances.length;this.resolvedDistances=Array(e);for(let t=0;t<e;t++)this.resolvedDistances[t]=r.resolvedDistances[t].slice(0);this.inputSequence=r.inputSequence.slice(0),this.matchSequence=r.matchSequence.slice(0),this.diagonalWidth=r.diagonalWidth}else this.resolvedDistances=[]}getTrueIndex(r,e,t){let o={row:r,col:e-r+t,sparse:!1};return(o.col<0||o.col>2*t)&&(o.sparse=!0),o}getCostAt(r,e,t=this.diagonalWidth){if(r<0||e<0)return r==-1&&e>=-1?e+1:e==-1&&r>=-1?r+1:Number.MAX_VALUE;let o=this.getTrueIndex(r,e,t);return o.sparse?Number.MAX_VALUE:this.resolvedDistances[o.row][o.col]}getFinalCost(){let r=this,e=r.getHeuristicFinalCost();for(;e>r.diagonalWidth;)r=r.increaseMaxDistance(),e=r.getHeuristicFinalCost();return e}getHeuristicFinalCost(){return this.getCostAt(this.inputSequence.length-1,this.matchSequence.length-1)}hasFinalCostWithin(r){let e=this,t=e.getHeuristicFinalCost(),o=this.diagonalWidth;do{if(t<=r)return!0;if(o<r)e=e.increaseMaxDistance(),o++,t=e.getHeuristicFinalCost();else break}while(!0);return!1}editPath(r=this.inputSequence.length-1,e=this.matchSequence.length-1){let t=this.getCostAt(r,e),o=null,a=null,d=this.getCostAt(r,e-1),i=this.getCostAt(r-1,e),p=this.getCostAt(r-1,e-1),[x,B]=W.getTransposeParent(this,r,e);if(x>=0&&B>=0){let k=1;if(o=["transpose-start"],x!=r-1){let l=r-x-1;o=o.concat(Array(l).fill("transpose-delete")),k+=l}else{let l=e-B-1;o=o.concat(Array(l).fill("transpose-insert")),k+=l}o.push("transpose-end"),this.getCostAt(x-1,B-1)!=t-k&&(o=null),a=[x-1,B-1]}return o||(p==t-1?(o=["substitute"],a=[r-1,e-1]):d==t-1?(o=["insert"],a=[r,e-1]):i==t-1?(o=["delete"],a=[r-1,e]):(o=["match"],a=[r-1,e-1])),a[0]>=0&&a[1]>=0?this.editPath(a[0],a[1]).concat(o):a[0]>-1?Array(a[0]+1).fill("delete").concat(o):a[1]>-1?Array(a[1]+1).fill("insert").concat(o):o}static getTransposeParent(r,e,t){if(e<0||t<0||r.inputSequence[e].key==r.matchSequence[t].key)return[-1,-1];let o=-1;for(let d=e-1;d>=0;d--)if(r.inputSequence[d].key==r.matchSequence[t].key){o=d;break}let a=-1;for(let d=t-1;d>=0;d--)if(r.matchSequence[d].key==r.inputSequence[e].key){a=d;break}return[o,a]}static initialCostAt(r,e,t,o,a){var d=r.inputSequence[e].key==r.matchSequence[t].key?0:1,i=r.getCostAt(e-1,t-1)+d,p=o||r.getCostAt(e,t-1)+1,x=a||r.getCostAt(e-1,t)+1,B=Number.MAX_VALUE;if(e>0&&t>0){let[k,l]=W.getTransposeParent(r,e,t);B=r.getCostAt(k-1,l-1)+(e-k-1)+1+(t-l-1)}return Math.min(i,x,p,B)}getSubset(r,e){let t=new W(this);if(r>this.inputSequence.length||e>this.matchSequence.length)throw"Invalid dimensions specified for trim operation";t.inputSequence.splice(r),t.matchSequence.splice(e),t.resolvedDistances.splice(r);let o=this.getTrueIndex(r-1,e-1,this.diagonalWidth);for(let a=o.col;a<=2*this.diagonalWidth;a++){let d=o.row-(a-o.col);if(d<0)break;if(a<0)t.resolvedDistances[d]=Array(2*t.diagonalWidth+1).fill(Number.MAX_VALUE);else{let i=2*this.diagonalWidth-a,p=t.resolvedDistances[d].splice(0,a+1),x=Array(i).fill(Number.MAX_VALUE);t.resolvedDistances[d]=p.concat(x)}}return t}static forDiagonalOfAxis(r,e,t,o){let a=t-e<r?t-e+r:2*r,d=e-r,i=d<0?0:d;for(let p=i-d;p<=a;p++)o(d+p,p)}addInputChar(r){let e=new W(this),t=e.inputSequence.length;e.inputSequence.push(r);let o=Array(2*e.diagonalWidth+1).fill(Number.MAX_VALUE);return e.resolvedDistances[t]=o,e.matchSequence.length==0||W.forDiagonalOfAxis(e.diagonalWidth,t,e.matchSequence.length-1,function(a,d){o[d]=W.initialCostAt(e,t,a)}),e}addMatchChar(r){let e=new W(this),t=e.matchSequence.length;return e.matchSequence.push(r),e.inputSequence.length==0||W.forDiagonalOfAxis(e.diagonalWidth,t,e.inputSequence.length-1,function(o,a){var d=e.resolvedDistances[o];d[2*e.diagonalWidth-a]=W.initialCostAt(e,o,t)}),e}increaseMaxDistance(){let r=new W(this);if(r.diagonalWidth++,r.inputSequence.length<1||r.matchSequence.length<1)return r;function e(o,a,d,i){let p=2*(r.diagonalWidth-1),x=d.length-1;p=p<x-o?p:x-o;for(let B=0;B<=p;B++)a==d[o+B].key&&i(o+B,B)}s(e,"forPossibleTranspositionsInDiagonal");for(let o=0;o<r.inputSequence.length;o++){let a=Number.MAX_VALUE,d=o-r.diagonalWidth;if(d>=0){let p=d==0?o+2:Number.MAX_VALUE;a=W.initialCostAt(r,o,d,p,void 0);let x=a;if(d<r.matchSequence.length-1){W.propagateUpdateFrom(r,o,d+1,x+1,0);let B=o+2;if(o+2<this.inputSequence.length){let k=r.inputSequence[o+1].key;e(d+3,k,r.matchSequence,function(l,h){W.propagateUpdateFrom(r,B,l,x+h+2,h)})}}}let i=Number.MAX_VALUE;if(d=o+r.diagonalWidth,d<r.matchSequence.length){let p=o==0?d+2:Number.MAX_VALUE;var t=r.getCostAt(o,d-1,this.diagonalWidth)+1;i=W.initialCostAt(r,o,d,t,p);let x=i;if(o<r.inputSequence.length-1){W.propagateUpdateFrom(r,o+1,d,x+1,2*this.diagonalWidth);let B=d+2;if(d+2<this.matchSequence.length){let k=r.matchSequence[o+1].key;e(o+3,k,r.inputSequence,function(l,h){let u=2*(r.diagonalWidth-1)-h;W.propagateUpdateFrom(r,l,B,x+h+2,u)})}}}r.resolvedDistances[o]=[a].concat(r.resolvedDistances[o],i)}return r}static propagateUpdateFrom(r,e,t,o,a){if(o<r.resolvedDistances[e][a])r.resolvedDistances[e][a]=o;else return;let d=e<r.inputSequence.length-1,i=t<r.matchSequence.length-1;if(a<2*(r.diagonalWidth-1)&&i){let p=o+1;this.propagateUpdateFrom(r,e,t+1,p,a+1)}if(a>0&&d){let p=o+1;this.propagateUpdateFrom(r,e+1,t,p,a-1)}if(d&&i){let p=o+(r.inputSequence[e+1].key==r.matchSequence[t+1].key?0:1);this.propagateUpdateFrom(r,e+1,t+1,p,a);let x=-1;for(let k=e+2;k<r.inputSequence.length;k++)if(r.inputSequence[k].key==r.matchSequence[t+1].key){x=k;break}let B=-1;for(let k=t+2;k<r.matchSequence.length;k++)if(r.matchSequence[k].key==r.inputSequence[e+1].key){B=k;break}if(x>0&&B>0){let k=o+(x-e-2)+1+(B-t-2);this.propagateUpdateFrom(r,x,B,k,r.diagonalWidth-1+B-x)}}}get mapKey(){let r=this.inputSequence.map(t=>t.key).join(""),e=this.matchSequence.map(t=>t.key).join("");return r+T+e+T+this.diagonalWidth}get lastInputEntry(){return this.inputSequence[this.inputSequence.length-1]}get lastMatchEntry(){return this.matchSequence[this.matchSequence.length-1]}static computeDistance(r,e,t=1){let o=new W;t=t||1,o.diagonalWidth=t;for(let a=0;a<r.length;a++)o=o.addInputChar(r[a]);for(let a=0;a<e.length;a++)o=o.addMatchChar(e[a]);return o}};s(W,"ClassicalDistanceCalculation");var yr=s(function(n,r){return n.currentCost-r.currentCost},"QUEUE_NODE_COMPARATOR"),b=class{constructor(r,e){this.toKey=s(r=>r,"toKey");if(e=e||(t=>t),r instanceof b){let t=r;this.calculation=t.calculation,this.currentTraversal=t.currentTraversal,this.priorInput=t.priorInput,this.toKey=t.toKey}else this.calculation=new W,this.currentTraversal=r,this.priorInput=[],this.toKey=e}get knownCost(){return this.calculation.getHeuristicFinalCost()}get inputSamplingCost(){if(this._inputCost!==void 0)return this._inputCost;{let r=m.MIN_KEYSTROKE_PROBABILITY;return this._inputCost=this.priorInput.map(e=>e.p>r?e.p:r).reduce((e,t)=>e-Math.log(t),0),this._inputCost}}get currentCost(){return m.EDIT_DISTANCE_COST_SCALE*this.knownCost+this.inputSamplingCost}buildInsertionEdges(){let r=[];for(let e of this.currentTraversal.children()){let t=e.traversal(),o={key:e.char,traversal:t},a=this.calculation.addMatchChar(o),d=new b(this);d.calculation=a,d.priorInput=this.priorInput,d.currentTraversal=t,r.push(d)}return r}buildDeletionEdges(r){let e=[];for(let t of r){if(t.p<r[0].p*Math.exp(-m.EDIT_DISTANCE_COST_SCALE))break;let o=this.calculation,a=t.sample;a.deleteLeft&&(o=o.getSubset(o.inputSequence.length-a.deleteLeft,o.matchSequence.length));let d=this.priorInput.slice(0);d.push(t);for(let p=0;p<a.insert.length;p++){let x=a.insert[p];_(x)&&(p++,x=x+a.insert[p]);let B=this.toKey(x);B&&(o=o.addInputChar({key:B}))}let i=new b(this);i.calculation=o,i.priorInput=d,e.push(i)}return e}buildSubstitutionEdges(r){let e=this.buildDeletionEdges(r),t=[];for(let o of this.currentTraversal.children())for(let a of e){let d=o.traversal(),i={key:o.char,traversal:d},p=a.calculation.addMatchChar(i),x=new b(this);x.calculation=p,x.priorInput=a.priorInput,x.currentTraversal=d,t.push(x)}return t}get mapKey(){let r=this.priorInput.map(t=>"+"+t.sample.insert+"-"+t.sample.deleteLeft).join(""),e=this.calculation.matchSequence.map(t=>t.key).join("");return r+T+e}get isFullReplacement(){return this.knownCost&&this.knownCost==this.priorInput.length}};s(b,"SearchNode");var Z=class{constructor(r,e){this.processed=[];if(typeof r=="number"){this.index=r,this.correctionQueue=new c(yr,e);return}else this.index=r.index,this.processed=[].concat(r.processed),this.correctionQueue=new c(r.correctionQueue)}increaseMaxEditDistance(){let r=this.correctionQueue.toArray();r.forEach(function(e){e.calculation=e.calculation.increaseMaxDistance()}),this.correctionQueue=new c(yr,r)}};s(Z,"SearchSpaceTier");var tr=class{constructor(r){this.resultNode=r}get inputSequence(){return this.resultNode.priorInput}get matchSequence(){return this.resultNode.calculation.matchSequence}get matchString(){return this.matchSequence.map(r=>r.key).join("")}get knownCost(){return this.resultNode.knownCost}get inputSamplingCost(){return this.resultNode.inputSamplingCost}get totalCost(){return this.resultNode.currentCost}get finalTraversal(){return this.resultNode.currentTraversal}};s(tr,"SearchResult");var or=class{constructor(r){this.tierOrdering=[];this.inputSequence=[];this.minInputCost=[];this.returnedValues={};this.processedEdgeSet={};if(this.buildQueueSpaceComparator(),r instanceof or){this.inputSequence=[].concat(r.inputSequence),this.minInputCost=[].concat(r.minInputCost),this.rootNode=r.rootNode,this.completedPaths=[].concat(r.completedPaths),this.returnedValues=Q({},r.returnedValues),this.processedEdgeSet=Q({},r.processedEdgeSet),this.tierOrdering=r.tierOrdering.map(o=>new Z(o)),this.selectionQueue=new c(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering);return}let e=r;if(e){if(!e.traverseFromRoot)throw"The provided model does not implement the \`traverseFromRoot\` function, which is needed to support robust correction searching."}else throw"The LexicalModel parameter must not be null / undefined.";this.selectionQueue=new c(this.QUEUE_SPACE_COMPARATOR),this.rootNode=new b(e.traverseFromRoot(),e.toKey?e.toKey.bind(e):null),this.completedPaths=[this.rootNode];let t=new Z(0,[this.rootNode]);this.tierOrdering.push(t),this.selectionQueue.enqueue(t)}buildQueueSpaceComparator(){let r=this;this.QUEUE_SPACE_COMPARATOR=function(e,t){let o=e.correctionQueue.peek(),a=t.correctionQueue.peek(),d=e.index,i=t.index,p=0,x=1;if(i<d){let B=i;i=d,d=B,x=-1}for(let B=d;B<i;B++)p=p+r.minInputCost[B];return o&&a?o.currentCost-a.currentCost+x*p:a?1:-1}}increaseMaxEditDistance(){this.tierOrdering.forEach(function(r){r.increaseMaxEditDistance()})}addInput(r){this.inputSequence.push(r),this.minInputCost.push(-Math.log(r[0].p));let e=[],t=this.completedPaths.map(function(a){let d=a.buildDeletionEdges(r),i=a.buildSubstitutionEdges(r);return d.concat(i)});this.completedPaths=[],this.returnedValues={},t.forEach(function(a){e=e.concat(a)});let o=new Z(this.tierOrdering.length,e);this.tierOrdering.push(o),this.selectionQueue.enqueue(o)}removeLastInput(){}hasNextMatchEntry(){let r=this.selectionQueue.peek();return r?r.correctionQueue.count>0:!1}handleNextNode(){if(!this.hasNextMatchEntry())return{type:"none"};let r=this.selectionQueue.dequeue(),e=r.correctionQueue.dequeue(),t={type:"intermediate",cost:e.currentCost};if(this.processedEdgeSet[e.mapKey])return this.selectionQueue.enqueue(r),t;this.processedEdgeSet[e.mapKey]=!0;let o=!1;if(e.knownCost>2)return t;e.knownCost==2&&(o=!0);let a=0;for(let d=0;d<=r.index;d++)a+=this.minInputCost[d];if(e.currentCost>a+2.5*or.EDIT_DISTANCE_COST_SCALE)return t;if(!o){let d=e.buildInsertionEdges();r.correctionQueue.enqueueAll(d)}if(r.index==this.tierOrdering.length-1)return this.completedPaths.push(e),this.selectionQueue.enqueue(r),{type:"complete",cost:e.currentCost,finalNode:e};{let d=this.tierOrdering[r.index+1],i=d.index,p=[];o||(p=e.buildDeletionEdges(this.inputSequence[i-1]));let x=e.buildSubstitutionEdges(this.inputSequence[i-1]);d.correctionQueue.enqueueAll(p.concat(x)),this.selectionQueue=new c(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering)}return t}*getBestMatches(r){let e=this,t={},o;r==0?o=1/0:r==null||Number.isNaN(r)?o=or.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL:o=r;class a{constructor(h,u){this.largestIntervals=[0];this.loopStart=this.start=Date.now(),this.maxExecutionTime=h,this.maxTrueTime=u}startLoop(){this.loopStart=Date.now()}markIteration(){let u=Date.now()-this.loopStart;this.executionTime+=u,u&&u>this.largestIntervals[0]&&(this.largestIntervals.length>2?this.largestIntervals[0]=u:this.largestIntervals.push(u),this.largestIntervals.sort(),this.updateOutliers())}updateOutliers(){this.largestIntervals.length>2&&this.largestIntervals[2]>=2*(this.largestIntervals[0]+this.largestIntervals[1])&&(this.executionTime-=this.largestIntervals[2],this.largestIntervals.pop())}shouldTimeout(){return Date.now()-this.start>this.maxTrueTime?!0:this.executionTime>this.maxExecutionTime}resetOutlierCheck(){this.largestIntervals=[]}}s(a,"ExecutionTimer");class d{constructor(){this.currentCost=Number.MIN_SAFE_INTEGER;this.entries=[]}checkAndAdd(h){var u=null;h.currentCost>this.currentCost&&(u=this.tryFinalize(),this.currentCost=h.currentCost);let A=h.calculation.matchSequence.map(E=>E.key).join("");return e.returnedValues[A]||(e.returnedValues[A]=h),t[A]||(this.entries.push(new tr(h)),t[A]=h),u}tryFinalize(){var h=null;return this.entries.length>0&&(h=this.entries,this.entries=[]),h}}s(d,"BatchingAssistant");let i=new d,p=new a(o*1.5,o),x=Object.values(this.returnedValues);if(x.length>0){let l=new c(yr,x);for(p.startLoop();l.count>0;){let u=l.dequeue();if(u.isFullReplacement)continue;let A=i.checkAndAdd(u);p.markIteration(),A&&(yield A)}let h=i.tryFinalize();h&&(yield h)}p.resetOutlierCheck(),p.startLoop();let B=!1;do{let l;do l=this.handleNextNode(),p.markIteration(),p.shouldTimeout()&&(B=!0);while(!B&&l.type=="intermediate");let h;if(l.type=="none")break;if(l.type=="complete"){if(l.finalNode.isFullReplacement)break;h=i.checkAndAdd(l.finalNode)}h&&(yield h)}while(!B&&this.hasNextMatchEntry());let k=i.tryFinalize();return k&&(yield k),null}},m=or;s(m,"SearchSpace"),m.EDIT_DISTANCE_COST_SCALE=5,m.MIN_KEYSTROKE_PROBABILITY=1e-4,m.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL=33;var g=class{static isWhitespace(r){let e=/^[\\u0009\\u000A\\u000D\\u0020\\u00a0\\u1680\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u200b\\u2028\\u2029\\u202f\\u205f\\u3000]+$/i;return r.insert.match(e)!=null}static isBackspace(r){return r.insert==""&&r.deleteLeft>0&&!r.deleteRight}static isEmpty(r){return r.insert==""&&r.deleteLeft==0&&!r.deleteRight}};s(g,"TransformUtils");function qr(n,r){let e=[];for(let t=0;t<n.kmwLength();t++){let a={insert:n.kmwCharAt(t),deleteLeft:0,id:r};e.push(a)}return e}s(qr,"textToCharTransforms");var lr=class{};s(lr,"TrackedContextSuggestion");var D=class{constructor(){this.transformDistributions=[];this.activeReplacementId=-1}get currentText(){return this.replacementText===void 0||this.replacementText===null?this.raw:this.replacementText}get replacement(){let r=this.activeReplacementId;return this.replacements.find(function(e){return e.suggestion.id==r})}revert(){delete this.activeReplacementId}};s(D,"TrackedContextToken");var M=class{constructor(r){this.searchSpace=[];if(r instanceof M){let e=r;this.tokens=e.tokens.map(function(o){let a=new D;return a.raw=o.raw,a.replacements=[].concat(o.replacements),a.activeReplacementId=o.activeReplacementId,a.transformDistributions=[].concat(o.transformDistributions),o.replacementText&&(a.replacementText=o.replacementText),a}),this.indexOffset=0;let t=this.model=r.model;this.taggedContext=r.taggedContext,t!=null&&t.traverseFromRoot&&(this.searchSpace=r.searchSpace.map(o=>new m(o)))}else{let e=r;this.tokens=[],this.indexOffset=Number.MIN_SAFE_INTEGER,this.model=e,e&&e.traverseFromRoot&&(this.searchSpace=[new m(e)])}}get head(){return this.tokens[0]}get tail(){return this.tokens[this.tokens.length-1]}popHead(){this.tokens.splice(0,2),this.indexOffset-=1}pushTail(r){this.model&&this.model.traverseFromRoot?this.searchSpace=[new m(this.model)]:this.searchSpace=[],this.tokens.push(r);let e=this;e.searchSpace.length>0&&r.transformDistributions.forEach(t=>e.searchSpace[0].addInput(t))}pushWhitespaceToTail(r=null){let e=new D;e.transformDistributions=r?[r]:[],e.raw=null,this.tokens.push(e)}replaceTailForBackspace(r,e){this.tokens.pop();let t=qr(r,e).map(function(a){return[{sample:a,p:1}]}),o=new D;o.raw=r,o.transformDistributions=t,this.pushTail(o)}updateTail(r,e){let t=this.tail;e=e||(e===""?"":t.raw),r&&r.length>0&&(t.transformDistributions.push(r),this.searchSpace&&this.searchSpace.forEach(o=>o.addInput(r))),t.raw=e}toRawTokenization(){let r=[];for(let e of this.tokens)e.currentText!==null&&r.push(e.currentText);return r}};s(M,"TrackedContextState");var Cr=class{constructor(r=Cr.DEFAULT_ARRAY_SIZE){this.currentHead=0;this.currentTail=0;this.circle=Array(r)}get count(){let r=this.currentHead-this.currentTail;return r<0&&(r=r+this.circle.length),r}get maxCount(){return this.circle.length}get oldest(){if(this.count!=0)return this.item(0)}get newest(){if(this.count!=0)return this.item(this.count-1)}enqueue(r){var e=null;let t=(this.currentHead+1)%this.maxCount;return t==this.currentTail&&(e=this.circle[this.currentTail],this.currentTail=(this.currentTail+1)%this.maxCount),this.circle[this.currentHead]=r,this.currentHead=t,e}dequeue(){if(this.currentTail==this.currentHead)return null;{let r=this.circle[this.currentTail];return this.currentTail=(this.currentTail+1)%this.maxCount,r}}popNewest(){if(this.currentTail==this.currentHead)return null;{let r=this.circle[this.currentHead];return this.currentHead=(this.currentHead-1+this.maxCount)%this.maxCount,r}}item(r){if(r>=this.count)throw"Invalid array index";let e=(this.currentTail+r)%this.maxCount;return this.circle[e]}},ar=Cr;s(ar,"CircularArray"),ar.DEFAULT_ARRAY_SIZE=5;var v=class extends ar{static attemptMatchContext(r,e,t){let o=e.toRawTokenization(),d=W.computeDistance(o.map(f=>({key:f})),r.map(f=>({key:f})),1).editPath(),i=!1,p=!1;if(d.length>1){if(d[0]=="insert"&&!(d[1]=="substitute"&&d.length==2)||d[0].indexOf("transpose")>=0)return null;d[0]=="delete"&&(i=!0)}let x=d.length-1,B=!1;if(d[x]=="delete"||d[0].indexOf("transpose")>=0||(d[x]=="insert"?p=!0:x>0&&d[x-1]=="insert"&&d[x]=="substitute"&&(p=!0,B=!0),x>0&&d[x-1]=="delete"&&d[x]=="substitute"))return null;for(let f=1;f<d.length-(B?2:1);f++)if(d[f]!="match")return null;let k;p?(B&&(e.tail.replacementText=r[r.length-2]),k=new M(e)):k=t?new M(e):e;let h=t&&Array.isArray(t)?t[0].sample:null;h&&h.insert==""&&h.deleteLeft==0&&!h.deleteRight&&(h=null);let u=h&&g.isWhitespace(h),A=h&&g.isBackspace(h),E=r[r.length-1];if(d.length>1)if(i&&k.popHead(),p){let f=r[r.length-1],S=new D;S.raw=f,u||!h?(k.pushWhitespaceToTail(t!=null?t:[]),S.transformDistributions=[]):(k.pushWhitespaceToTail(),S.transformDistributions=t?[t]:[]),k.pushTail(S)}else A?k.replaceTailForBackspace(E,h.id):k.updateTail(h?t:null,E);else if(d[x]=="insert"){let f=new D;f.raw=r[0],f.transformDistributions=[t],k.pushTail(f)}else A?k.replaceTailForBackspace(E,h.id):k.updateTail(h?t:null,E);return k}static modelContextState(r,e,t){let o=r.map(function(d){let i=new D;return i.raw=d,i.raw?i.transformDistributions=qr(i.raw).map(function(p){return[{sample:p,p:1}]}):i.transformDistributions=[],i}),a=new M(t);for(o.length>0&&a.pushTail(o.splice(0,1)[0]);o.length>0;)a.pushWhitespaceToTail(),a.pushTail(o.splice(0,1)[0]);if(a.tokens.length==0){let d=new D;d.raw="",a.pushTail(d)}return a}analyzeState(r,e,t){if(!r.traverseFromRoot)throw"This lexical model does not provide adequate data for correction algorithms and context reuse";let o=V(r.wordbreaker||F,e);if(o.left.length>0)for(let d=this.count-1;d>=0;d--){let i=this.item(d),p=i.taggedContext;if(p&&t&&t.length>0){if(C(t[0].sample,p).left!=e.left)continue}else if((p==null?void 0:p.left)!=e.left)continue;let x=v.attemptMatchContext(o.left,this.item(d),t);if(x)return this.newest!=x&&this.newest!=i&&this.enqueue(i),x.taggedContext=e,x!=this.item(d)&&this.enqueue(x),x}let a=v.modelContextState(o.left,t,r);return a.taggedContext=e,this.enqueue(a),a}clearCache(){for(;this.count>0;)this.dequeue()}};s(v,"ContextTracker");var H=class{constructor(r,e){this.SUGGESTION_ID_SEED=0;this.testMode=!1;this.lexicalModel=r,r.traverseFromRoot&&(this.contextTracker=new v),this.punctuation=H.determinePunctuationFromModel(r),this.testMode=!!e}predictFromCorrections(r,e){let t=[];for(let o of r){let d=this.lexicalModel.predict(o.sample,e).map(function(i){let p=o.sample,x=o.p;return p.id!==void 0&&(i.sample.transformId=p.id),{sample:i.sample,p:i.p*x}},this);t=t.concat(d)}return t}predict(r,e){let t=[],o=this.lexicalModel,a=this.punctuation;r instanceof Array?r.length==0&&r.push({sample:{insert:"",deleteLeft:0},p:1}):r=[{sample:r,p:1}];let d=r.sort(function(y,P){return P.p-y.p})[0].sample,i=g.isWhitespace(d),p=g.isBackspace(d),x=C(d,e),B=this.wordbreak(x),k=null,l=[],h,u=null;if(this.contextTracker){let y=this.contextTracker.analyzeState(this.lexicalModel,e,null);u=this.contextTracker.analyzeState(this.lexicalModel,x,g.isEmpty(d)?null:r);let P=u.searchSpace[0],O=0,L=u.tokens,Pr=L.length,dr=L.length-y.tokens.length;Pr==0||dr>0?(O=0,g.isWhitespace(d)&&(h=d,e=x,y=u)):dr<0?O=this.wordbreak(x).kmwLength()+d.deleteLeft:O=this.wordbreak(e).kmwLength();let Kr=L[L.length-1].transformDistributions.length<=1,ir,Qr=this.testMode?0:m.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL;for(let Fr of P.getBestMatches(Qr)){let Dr=Fr.map(function(K){let cr=K.matchString,Tr;K.inputSequence.length>0?Tr=K.inputSequence[K.inputSequence.length-1].sample:Tr=d;let Vr={insert:cr,deleteLeft:O,id:d.id},br=K.totalCost;return Kr&&(br*=H.SINGLE_CHAR_KEY_PROB_EXPONENT),{sample:Vr,p:Math.exp(-br)}},this),Sr=this.predictFromCorrections(Dr,e);Sr.length>0&&ir===void 0&&(ir=-Math.log(Dr[0].p)),l=l.concat(Sr);let Wr=Fr[0].totalCost;if(Wr>=ir+8)break;if(l.length>=H.MAX_SUGGESTIONS){if(Wr>=ir+4)break;if(l.sort(function(K,cr){return cr.p-K.p}),l[H.MAX_SUGGESTIONS-1].p>Math.exp(-Wr))break}}}else{let y;i?(y=[{sample:d,p:1}],h=d):y=r.map(P=>{let O=P.sample;return g.isWhitespace(O)&&!i||g.isBackspace(O)&&!p?null:P}),y=y.filter(P=>!!P),l=this.predictFromCorrections(y,e)}let A={},E=null;o.languageUsesCasing&&(E=this.detectCurrentCasing(x));let f=this.wordbreak(e);for(let y of l){let P=y.sample.displayAs,O=P==B;if(this.lexicalModel.languageUsesCasing&&(O=O||P==this.lexicalModel.applyCasing("lower",B)),O)if(k)k.p&&y.p&&(k.p+=y.p);else{let L=y.sample.transform,Pr={insert:B,deleteLeft:L.deleteLeft,deleteRight:L.deleteRight,id:L.id},dr=U(Pr,y.p);k=this.toAnnotatedSuggestion(dr,"keep",G.noQuotes),k.matchesModel=!0,k.transformId=y.sample.transformId}else{E&&E!="lower"&&(this.applySuggestionCasing(y.sample,f,E),P=y.sample.displayAs);let L=A[P];L?L.p+=y.p:A[P]=y}}if(!k&&B!=""){let y=Q({},d),P=U(y,1);P.displayAs=B,k=this.toAnnotatedSuggestion(P,"keep"),k.matchesModel=!1}for(let y in A){let P=A[y];t.push(P)}t=t.sort(function(y,P){return P.p-y.p});let S=t.splice(0,H.MAX_SUGGESTIONS).map(function(y){return y.sample.p&&(y.sample["lexical-p"]=y.sample.p,y.sample["correction-p"]=y.p/y.sample.p,y.sample.p=y.p),y.sample});k&&(S=[k].concat(S));let ur=this;return S.forEach(function(y){if(!e.right)y.transform.insert+=a.insertAfterWord;else{let P=ur.tokenize(e);P&&P.caretSplitsToken&&(y.transform.insert+=a.insertAfterWord)}if(h){let P=$(h,y.transform);P.id=y.transformId;let O=y;O.transform=P}y.id=ur.SUGGESTION_ID_SEED,ur.SUGGESTION_ID_SEED++}),u&&(u.tail.replacements=S.map(function(y){return{suggestion:y,tokenWidth:1}})),S}applySuggestionCasing(r,e,t){let o=e.kmwLength()-r.transform.deleteLeft;o>0&&(r.transform.deleteLeft+=o,r.transform.insert=e.kmwSubstr(0,o)+r.transform.insert),r.transform.insert=this.lexicalModel.applyCasing(t,r.transform.insert),r.displayAs=this.lexicalModel.applyCasing(t,r.displayAs)}toAnnotatedSuggestion(r,e,t=G.default){let o=G,a=o.noQuotes;return(e=="keep"||e=="revert")&&(a=o.useQuotes),{transform:r.transform,transformId:r.transformId,displayAs:o.apply(t,r.displayAs,this.punctuation,a),tag:e,p:r.p}}static determinePunctuationFromModel(r){let e=Jr;if(!r.punctuation)return e;let t=r.punctuation,o=t.insertAfterWord;o!==""&&!o&&(o=e.insertAfterWord);let a=t.quotesForKeepSuggestion;a||(a=e.quotesForKeepSuggestion);let d=t.isRTL;return{insertAfterWord:o,quotesForKeepSuggestion:a,isRTL:d}}acceptSuggestion(r,e,t){let o=r.transform,a=e.left.kmwSubstr(-o.deleteLeft,o.deleteLeft),d=o.insert.kmwLength(),i={insert:a,deleteLeft:d},p=e;t&&(i=$(i,t),p=C(t,p));let x,B=this.tokenize(p);B?(B.left.length>0?x=B.left[B.left.length-1]:x="",x+=B.caretSplitsToken?B.right[0]:""):x=this.wordbreak(p);let k=U(i);k.displayAs=x;let l=this.toAnnotatedSuggestion(k,"revert");if(r.transformId!=null&&(l.transformId=-r.transformId),r.id!=null?l.id=-r.id:(l.id=-this.SUGGESTION_ID_SEED,this.SUGGESTION_ID_SEED++),this.contextTracker){let h=this.contextTracker.newest;h||(h=this.contextTracker.analyzeState(this.lexicalModel,e)),h.tail.activeReplacementId=r.id;let u=C(r.transform,e);this.contextTracker.analyzeState(this.lexicalModel,u)}return l}applyReversion(r,e){let t=this,o=s(function(){let i=C(r.transform,e),p=t.predict({insert:"",deleteLeft:0},i);return p.forEach(function(x){x.transformId=-r.transformId}),p},"fallbackSuggestions");if(!this.contextTracker)return o();let a=!1;for(let i=this.contextTracker.count-1;i>=0;i--)if(this.contextTracker.item(i).tail.activeReplacementId==-r.id){a=!0;break}if(!a)return o();for(;this.contextTracker.newest.tail.activeReplacementId!=-r.id;)this.contextTracker.popNewest();this.contextTracker.newest.tail.revert();let d=this.contextTracker.newest.tail.replacements.map(function(i){return i.suggestion});return d.forEach(function(i){i.transformId=-r.transformId}),d}wordbreak(r){let e=this.lexicalModel;if(e.wordbreaker||!e.wordbreak){let t=e.wordbreaker||F;return z(t,r)}else return e.wordbreak(r)}tokenize(r){let e=this.lexicalModel;return e.wordbreaker?V(e.wordbreaker,r):null}resetContext(r){this.contextTracker&&(this.contextTracker.clearCache(),this.contextTracker.analyzeState(this.lexicalModel,r,null))}detectCurrentCasing(r){var o;let e=this.lexicalModel,t=this.wordbreak(r);if(!e.languageUsesCasing)throw"Invalid attempt to detect casing: languageUsesCasing is set to false";if(!e.applyCasing)throw"Invalid LMLayer state:  languageUsesCasing is set to true, but no applyCasing function exists";return r.casingForm=="upper"||r.casingForm=="initial"?r.casingForm:e.applyCasing("lower",t)==t?"lower":e.applyCasing("upper",t)==t?t.kmwLength()>1?"upper":"initial":e.applyCasing("initial",t)==t?"initial":(o=r.casingForm)!=null?o:null}},q=H;s(q,"ModelCompositor"),q.MAX_SUGGESTIONS=12,q.SINGLE_CHAR_KEY_PROB_EXPONENT=16;var Jr={quotesForKeepSuggestion:{open:"\\u201C",close:"\\u201D"},insertAfterWord:" "};w();var I=class{constructor(r={importScripts:null,postMessage:null}){this._testMode=!1;this._postMessage=r.postMessage||postMessage,this._importScripts=r.importScripts||importScripts,this.setupConfigState()}error(r,e){this.cast("error",{log:r,error:e&&e.stack?e.stack:void 0})}onMessage(r){let{message:e}=r.data;if(!e)throw new Error(\`Missing required 'message' property: \${r.data}\`);let t=r.data;if(t.message=="load"){let o=t,a=!1;if(this._currentModelSource&&o.source.type==this._currentModelSource.type&&(o.source.type=="file"&&o.source.file==this._currentModelSource.file||o.source.type=="raw"&&o.source.code==this._currentModelSource.code)&&(a=!0),a){typeof console!="undefined"&&console.warn("Duplicate model load message detected - squashing!");return}else this._currentModelSource=o.source}else t.message=="unload"&&(this._currentModelSource=null);this.state.handleMessage(t)}cast(r,e){let t=this._postMessage;t(Q({message:r},e))}loadModel(r){try{let e=r.configure(this._platformCapabilities);e.leftContextCodePoints||(e.leftContextCodePoints=e.leftContextCodeUnits),e.rightContextCodePoints||(e.rightContextCodePoints=e.rightContextCodeUnits),e.leftContextCodePoints||(e.leftContextCodePoints=this._platformCapabilities.maxLeftContextCodePoints),e.rightContextCodePoints||(e.rightContextCodePoints=this._platformCapabilities.maxRightContextCodePoints||0),r.languageUsesCasing&&!r.applyCasing&&(r.applyCasing=xr);let t=this.transitionToReadyState(r);e.wordbreaksAfterSuggestions===void 0&&(e.wordbreaksAfterSuggestions=t.punctuation.insertAfterWord!=""),this.cast("ready",{configuration:e})}catch(e){this.error("loadModel failed!",e)}}loadModelFile(r){try{this._importScripts(r)}catch(e){this.error("Error occurred when attempting to load dictionary",e)}}unloadModel(){this.transitionToLoadingState()}setupConfigState(){this.state={name:"unconfigured",handleMessage:r=>{if(r.message!=="config")throw new Error(\`invalid message; expected 'config' but got \${r.message}\`);this._platformCapabilities=r.capabilities,this._testMode=!!r.testMode,this.transitionToLoadingState()}}}transitionToLoadingState(){let r=this;this.state={name:"modelless",handleMessage:e=>{if(e.message!=="load")throw new Error(\`invalid message; expected 'load' but got \${e.message}\`);if(e.source.type=="file")r.loadModelFile(e.source.file);else{let t=e.source.code;new Function("LMLayerWorker","models","correction","wordBreakers",t)(r,hr,nr,er)}}}}transitionToReadyState(r){let e=new q(r,this._testMode);return this.state={name:"ready",handleMessage:t=>{switch(t.message){case"predict":var{transform:o,context:x}=t,p=e.predict(o,x);this.cast("suggestions",{token:t.token,suggestions:p});break;case"wordbreak":let B=z(r.wordbreaker||F,t.context);this.cast("currentword",{token:t.token,word:B});break;case"unload":this.unloadModel();break;case"accept":var{suggestion:a,context:x,postTransform:d}=t,i=e.acceptSuggestion(a,x,d);this.cast("postaccept",{token:t.token,reversion:i});break;case"revert":var{reversion:i,context:x}=t,p=e.applyReversion(i,x);this.cast("postrevert",{token:t.token,suggestions:p});break;case"reset-context":var{context:x}=t;e.resetContext(x);break;default:throw new Error(\`invalid message; expected one of {'predict', 'wordbreak', 'accept', 'revert', 'reset-context', 'unload'} but got \${t.message}\`)}},compositor:e},e}static install(r){let e=new I({postMessage:r.postMessage,importScripts:r.importScripts.bind(r)});return r.onmessage=e.onMessage.bind(e),e.self=r,r.LMLayerWorker=e,r.models=hr,r.correction=nr,r.wordBreakers=er,e}};s(I,"LMLayerWorker");typeof self!="undefined"&&"postMessage"in self&&"importScripts"in self?I.install(self):window.LMLayerWorker=I;})();
//# sourceMappingURL=worker-main.min.js.map
`,Vs="";var Wt=class{static constructInstance(){return new Worker(this.asBlobURI(Xs))}static asBlobURI(n){let e=nc(n);e+=`
`+Vs;let t=new Blob([e],{type:"text/javascript"});return URL.createObjectURL(t)}};a(Wt,"DefaultWorker");var oi=class{constructor(n,e){this.suggestions=n,this.transcriptionID=e}};a(oi,"ReadySuggestions");var ft=class extends Ls.default{constructor(e,t,i=!1){super();this._mayPredict=!0;this._mayCorrect=!0;this._state="inactive";this.recentTranscriptions=t;let c={maxLeftContextCodePoints:64,maxRightContextCodePoints:i?0:64};!e||(this.lmEngine=new vt(c,e))}get activeModel(){return this.currentModel}get isConfigured(){return!!this.configuration}get state(){return this._state}unloadModel(){this.lmEngine.unloadModel(),delete this.currentModel,delete this.configuration,this._state="inactive",this.emit("statechange","inactive")}loadModel(e){if(!e)throw new Error("Null reference not allowed.");let t=e.path?"file":"raw",i=t=="file"?e.path:e.code;return this.currentModel=e,this.mayPredict&&(this._state="active",this.emit("statechange","active")),this.lmEngine.loadModel(i,t).then(c=>{this.configuration=c,this.mayPredict&&(this._state="configured",this.emit("statechange","configured"))}).catch(c=>{let s;c instanceof Error?s=c.message:s=String(c),console.error("Could not load model '"+e.id+"': "+s),this.currentModel=null,this._state="inactive",this.emit("statechange","inactive")})}invalidateContext(e,t){if(this.emit("invalidatesuggestions","context"),!this.currentModel||!this.configuration)return Promise.resolve([]);if(this.isActive){if(e){let i=e.buildTranscriptionFrom(e,null,!1);return this.predict_internal(i,!0,t)}}else return Promise.resolve([])}wordbreak(e,t){if(!this.isActive)return null;let i=new Be(E.from(e,!1),this.configuration,t);return this.lmEngine.wordbreak(i)}predict(e,t){return!this.isActive||!this.currentModel||!this.configuration?null:(this.emit("invalidatesuggestions","new"),this.predict_internal(e,!1,t))}applySuggestion(e,t,i){if(!t)throw"Accepting suggestions requires a destination OutputTarget instance.";let c=this.getPredictionState(e.transformId);if(c){let s=E.from(c.preInput,!1);s.apply(e.transform);let l=s.buildTransformFrom(t);t.apply(l),this.emit("suggestionapplied",t),E.from(c.preInput,!1).apply(c.transform);let B=new Be(c.preInput,this.configuration,i()),d=this.lmEngine.acceptSuggestion(e,B,c.transform);return d=d.then(g=>{let F={transform:c.transform,transformId:-c.token,displayAs:g.displayAs,id:g.id,tag:g.tag};return this.predictFromTarget(t,i()),F}),d}else return console.warn("Could not apply the Suggestion!"),null}applyReversion(e,t){if(!t)throw"Accepting suggestions requires a destination OutputTarget instance.";let i=this.getPredictionState(-e.transformId);if(!i){console.warn("Could not apply the Suggestion!");return}let c=E.from(i.preInput,!1);c.apply(e.transform);let s=c.buildTransformFrom(t);return t.apply(s),this.lmEngine.revertSuggestion(e,new Be(i.preInput,this.configuration,null)).then(r=>{let B=new oi(r,s.id);return this.emit("suggestionsready",B),this.currentPromise=null,r})}predictFromTarget(e,t){if(!e)return null;let i=e.buildTranscriptionFrom(e,null,!1);return this.predict(i,t)}predict_internal(e,t,i){if(!e)return null;let c=new Be(e.preInput,this.configuration,i);this.recordTranscription(e),t&&this.lmEngine.resetContext(c);let s=e.alternates;(!s||s.length==0)&&(s=[{sample:e.transform,p:1}]);let l=e.transform;var r=this.currentPromise=this.lmEngine.predict(s,c);return r.then(B=>{if(r==this.currentPromise){let d=new oi(B,l.id);this.emit("suggestionsready",d),this.currentPromise=null}return B})}recordTranscription(e){this.recentTranscriptions.save(e)}getPredictionState(e){return this.recentTranscriptions.get(e)}shutdown(){this.lmEngine.shutdown()}get isActive(){return this.canEnable()?(this.activeModel||!1)&&this._mayPredict:(this._mayPredict=!1,!1)}canEnable(){return!!this.lmEngine}get mayPredict(){return this._mayPredict}set mayPredict(e){if(!this.canEnable())return;let t=this._mayPredict;if(this._mayPredict=e,t!=e&&this.activeModel){let i=e?"active":"inactive";this._state=i,this.emit("statechange",i),e&&this.isConfigured&&(this._state="configured",this.emit("statechange","configured"))}}get mayCorrect(){return this._mayCorrect}set mayCorrect(e){this._mayCorrect=e}get wordbreaksAfterSuggestions(){return this.configuration.wordbreaksAfterSuggestions}tryAcceptSuggestion(e){return this.emit("tryaccept",e),!1}tryRevertSuggestion(){return this.emit("tryrevert"),!1}};a(ft,"LanguageProcessor");var Nl=10,bn=class{constructor(){this.map=new Map}get(n){let e=this.map.get(n);return e&&this.save(e),e}save(n){let e=n.token>=0?n.token:-n.token;this.map.delete(e),this.map.set(e,n),this.map.size>Nl&&this.map.delete(this.map.keys().next().value)}};a(bn,"TranscriptionCache");var Wc=class{constructor(n,e,t){this.contextCache=new bn;if(!n)throw new Error("device must be defined");t||(t=Wc.DEFAULT_OPTIONS),this.contextDevice=n,this.kbdProcessor=new ot(n,t),this.lngProcessor=new ft(e,this.contextCache)}get languageProcessor(){return this.lngProcessor}get keyboardProcessor(){return this.kbdProcessor}get keyboardInterface(){return this.keyboardProcessor.keyboardInterface}get activeKeyboard(){return this.keyboardInterface.activeKeyboard}set activeKeyboard(n){this.keyboardInterface.activeKeyboard=n,this.resetContext()}get activeModel(){return this.languageProcessor.activeModel}processKeyEvent(n,e){let t=n.srcKeyboard&&this.activeKeyboard!=n.srcKeyboard,i=this.activeKeyboard;try{if(t&&(this.keyboardInterface.activeKeyboard=n.srcKeyboard),n.baseTranscriptionToken){let c=this.contextCache.get(n.baseTranscriptionToken);c?e.restoreTo(c.preInput):console.warn("The base context for the multitap could not be found")}return this._processKeyEvent(n,e)}finally{t&&(this.keyboardInterface.activeKeyboard=i)}}_processKeyEvent(n,e){var F;let t=n.device.formFactor,i=n.isSynthetic;if((t==G.FormFactor.Desktop||!this.activeKeyboard||this.activeKeyboard.usesDesktopLayoutOnDevice(n.device))&&i&&this.keyboardProcessor.selectLayer(n))return new se;if(this.keyboardProcessor.doModifierPress(n,e,!i)&&!i)return new se;if(this.languageProcessor.isActive){if((n.kName=="K_BKSP"||n.Lcode==h.keyCodes.K_BKSP)&&this.languageProcessor.tryRevertSuggestion())return new se;if((n.kName=="K_SPACE"||n.Lcode==h.keyCodes.K_SPACE)&&this.languageProcessor.tryAcceptSuggestion("space"))return new se}let c=E.from(e,!0),s=this.keyboardProcessor.layerId,l=this.keyboardProcessor.processKeystroke(n,e);n.kNextLayer&&this.keyboardProcessor.selectLayer(n);let r=h.isKnownOSKModifierKey(n.kName);In((F=l==null?void 0:l.transcription)==null?void 0:F.transform)&&n.kNextLayer&&(r=!0);let B=l!=null;if(B){let Q=r?null:this.buildAlternates(l,n,c);l.finalize(this.keyboardProcessor,e,!1),Q&&Q.length>0&&(l.transcription.alternates=Q)}else l=new se,l.transcription=e.buildTranscriptionFrom(e,null,!1),l.triggersDefaultCommand=!0;this.contextCache.save(l.transcription);let d=l.setStore[33]||n.kNextLayer;this.keyboardProcessor.newLayerStore.set(d?this.keyboardProcessor.layerId:""),this.keyboardProcessor.oldLayerStore.set(d?s:"");let g=this.keyboardProcessor.processPostKeystroke(this.contextDevice,e);return g&&g.finalize(this.keyboardProcessor,e,!0),l.predictionPromise=this.languageProcessor.predict(l.transcription,this.keyboardProcessor.layerId),l.triggersDefaultCommand||e.doInputEvent(),B?l:null}buildAlternates(n,e,t){let i;if(this.languageProcessor.isActive&&!n.triggersDefaultCommand){let c=e.keyDistribution,l=new Be(t,Be.ENGINE_RULE_WINDOW,this.keyboardProcessor.layerId).toMock();if(this.languageProcessor.isActive&&c&&e.kbdLayer){let r=Number.MAX_VALUE,B=Fn(),d;B.performance&&B.performance.now&&(d=a(function(){return B.performance.now()},"timer"),r=d()+16);let g=Math.exp(-5);c.sort((Q,y)=>y.p-Q.p),i=[];let F=0;for(let Q of c){if(Q.p<g){F+=Q.p;break}else if(d&&d()>=r)break;let y=E.from(l,!1),u=Q.keySpec;if(!u){console.warn("Internal error:  failed to properly filter set of keys for corrections");continue}let I=this.keyboardProcessor.activeKeyboard.constructKeyEvent(u,e.device,this.keyboardProcessor.stateKeys),b=this.keyboardProcessor.processKeystroke(I,y);if(b&&!b.beep&&Q.p>0){let U=b.transcription.transform;U.id=n.transcription.token,i.push({sample:U,p:Q.p}),F+=Q.p}}i.forEach(function(Q){Q.p/=F})}}return i}resetContext(n){this.keyboardProcessor.resetContext(n),this.languageProcessor.invalidateContext(n,this.keyboardProcessor.layerId)}},dt=Wc;a(dt,"InputProcessor"),dt.DEFAULT_OPTIONS={baseLayout:"us"};var Zs=A(R(),1);var kt=class extends Zs.default{constructor(e,t){super();this.initNewContext=!0;this._currentSuggestions=[];this.recentAccept=!1;this.swallowPrediction=!1;this.doRevert=!1;this.recentRevert=!1;this.doTryAccept=a(e=>{!this.recentAccept&&this.selected?this.accept(this.selected):this.recentAccept&&e=="space"&&(this.recentAccept=!1)},"doTryAccept");this.doTryRevert=a(()=>{this.doRevert?(this.doRevert=!1,this.recentAccept=!1):this.recentAccept&&(this.showRevert(),this.swallowPrediction=!0)},"doTryRevert");this.invalidateSuggestions=a(e=>{this.initNewContext=!1,(!this.swallowPrediction||e=="context")&&(this.recentAccept=!1,this.doRevert=!1,this.recentRevert=!1,e=="context"&&(this.swallowPrediction=!1,this.initNewContext=!0)),e!="new"&&this.clearSuggestions()},"invalidateSuggestions");this.updateSuggestions=a(e=>{let t=e.suggestions;this._currentSuggestions=t,this.keepSuggestion=null;for(let i of t)i.tag=="keep"&&(this.keepSuggestion=i);this.keepSuggestion&&this._currentSuggestions.splice(this._currentSuggestions.indexOf(this.keepSuggestion),1),this.swallowPrediction?this.swallowPrediction=!1:(this.recentAccept=!1,this.doRevert=!1,this.recentRevert=!1),this.sendUpdateEvent()},"updateSuggestions");this.onModelStateChange=a(e=>{(e=="configured"||e=="inactive")&&this.resetContext()},"onModelStateChange");this.langProcessor=e,this.kbdProcessor=t;let i=a(()=>this.currentTarget&&e.state=="configured","validSuggestionState");this.suggestionApplier=c=>{if(i())return e.applySuggestion(c,this.currentTarget,()=>t.layerId)},this.suggestionReverter=c=>{i()&&e.applyReversion(c,this.currentTarget)},this.postApplicationHandler=()=>{var c;t.newLayerStore.set(""),t.oldLayerStore.set(""),(c=t.processPostKeystroke(t.contextDevice,this.currentTarget))==null||c.finalize(t,this.currentTarget,!0)},this.connect()}get currentTarget(){return this._currentTarget}setCurrentTarget(e){let t=this._currentTarget;return this._currentTarget=e,t!=e?this.resetContext():Promise.resolve([])}connect(){this.langProcessor.addListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.addListener("suggestionsready",this.updateSuggestions),this.langProcessor.addListener("tryaccept",this.doTryAccept),this.langProcessor.addListener("tryrevert",this.doTryRevert),this.langProcessor.addListener("statechange",this.onModelStateChange),this.langProcessor.addListener("suggestionapplied",this.postApplicationHandler)}disconnect(){this.langProcessor.removeListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.removeListener("suggestionsready",this.updateSuggestions),this.langProcessor.removeListener("tryaccept",this.doTryAccept),this.langProcessor.removeListener("tryrevert",this.doTryRevert),this.langProcessor.removeListener("statechange",this.onModelStateChange),this.langProcessor.removeListener("suggestionapplied",this.postApplicationHandler),this.clearSuggestions()}get currentSuggestions(){let e=[];return this.activateKeep()&&this.keepSuggestion&&this.keepSuggestion.matchesModel?e.push(this.keepSuggestion):this.doRevert&&e.push(this.revertSuggestion),e.concat(this._currentSuggestions)}acceptInternal(e){return e?e.tag=="revert"?(this.suggestionReverter(e),null):this.suggestionApplier(e):null}accept(e){let t=this;return this.selected=null,this.doRevert=!1,this.revertAcceptancePromise=this.acceptInternal(e),this.revertAcceptancePromise?(this.revertAcceptancePromise.then(function(i){i&&(t.revertSuggestion=i)}),this.recentAccept=!0,this.recentRevert=!1,this.swallowPrediction=!0,this.revertAcceptancePromise):(e&&e.tag=="revert"&&(this.recentAccept=!1,this.recentRevert=!0),null)}showRevert(){this.doRevert=!0,this.sendUpdateEvent()}clearSuggestions(){this.updateSuggestions({suggestions:[],transcriptionID:0})}activateKeep(){return!this.recentAccept&&!this.recentRevert&&!this.initNewContext}sendUpdateEvent(){this.emit("update",this.currentSuggestions)}resetContext(){let e=this.currentTarget;return e?this.langProcessor.invalidateContext(e,this.kbdProcessor.layerId):Promise.resolve([])}};a(kt,"PredictionContext");var Ss=A(R(),1);var ic="Keyboard_";function de(o){return o.startsWith(ic)?o:ic+o}a(de,"prefixed");function we(o){return o.startsWith(ic)?o.substring(ic.length):o}a(we,"withoutPrefix");var Nt=class extends Ss.default{constructor(e){super();this.stubSetTable={};this.keyboardTable={};this.keyboardLoader=e}getKeyboardForStub(e){return e?this.getKeyboard(e.KI):null}getKeyboard(e){if(!e)return null;let t=this.keyboardTable[de(e)];return t instanceof Promise?null:t}get defaultStub(){function e(i){let c=Object.keys(i);if(c.length!=0)return i[c[0]]}a(e,"getFirstValue");let t=e(this.stubSetTable);if(t)return e(t)}addKeyboard(e){let t=de(e.id);this.keyboardTable[t]=e,this.emit("keyboardadded",e)}fetchKeyboardForStub(e){return this.fetchKeyboard(e.KI)}isFetchingKeyboard(e){if(!e)throw new Error("Keyboard ID must be specified");return e=de(e),this.keyboardTable[e]instanceof Promise}fetchKeyboard(e){if(!e)throw new Error("Keyboard ID must be specified");if(!this.keyboardLoader)throw new Error("Cannot load keyboards; this cache was configured without a loader");e=de(e);let t=this.keyboardTable[e];if(t instanceof N)return Promise.resolve(t);if(t instanceof Promise)return t;let i=this.getStub(e,null);if(!i)throw new Error(`No stub for ${we(e)} has been registered`);if(!i.filename)throw new Error(`The registered stub for ${we(e)} lacks a path to the main keyboard file`);let c=this.keyboardLoader.loadKeyboardFromStub(i);return this.keyboardTable[e]=c,c.then(s=>{s.scriptObject.KI=e,this.addKeyboard(s)}).catch(s=>{throw delete this.keyboardTable[e],s}),c}addStub(e){var c;let t=de(e.KI),i=this.stubSetTable[t]=(c=this.stubSetTable[t])!=null?c:{};i[e.KLC]=e,this.emit("stubadded",e)}findMatchingStub(e){return this.getStub(e.KI,e.KLC)}getStub(e,t){var l;let i,c=t||"---";e instanceof N?i=e.id:i=e,i&&(i=de(i));let s=(l=this.stubSetTable[i])!=null?l:{};if(c!="---")return s[c];{let r=Object.keys(s);return r.length==0?null:s[r[0]]}}forgetKeyboard(e,t=!1){let i=e instanceof N?e.id:de(e);this.stubSetTable[i]&&delete this.stubSetTable[i],t&&this.keyboardTable[i]&&delete this.keyboardTable[i]}getStubList(){let e=[],t=Object.keys(this.stubSetTable);for(let i of t){let c=this.stubSetTable[i],s=Object.keys(c);for(let l of s)e.push(c[l])}return e}};a(Nt,"StubAndKeyboardCache");var fc=["World","Africa","Asia","Europe","South America","North America","Oceania","Central America","Middle East"],kc=["un","af","as","eu","sa","na","oc","ca","me"],Tl=RegExp("^(([\\.]/)|([\\.][\\.]/)|(/))|(:)");function Js(o,n){return n=n||"",o&&!Tl.test(o)?n+o:o}a(Js,"configureFilePathing");var w=class extends Se{constructor(e,t,i){var n=(...args)=>{super(...args)};if(typeof e!="string")if(e.id!==void 0){let c=e;c.id=de(c.id),n(c,i),this.KF=Js(c.filename,t),this.mapRegion(c.languages)}else{let c=e;c.KI=de(c.KI),n(c,i),this.KF=Js(c.KF,t),this.KP=c.KP,this.KR=c.KR,this.KRC=c.KRC;return}else n(de(e),t)}mapRegion(e){let t=e.region,i=0;if(typeof t=="number")t<1||t>9?i=0:i=t-1;else if(typeof t=="string"){let c=t.length==2?kc:fc;for(let s=0;s<c.length;s++)if(t.toLowerCase()==c[s].toLowerCase()){i=s;break}}this.KR=fc[i],this.KRC=kc[i]}get region(){return this.KR}get regionCode(){return this.KRC}get filename(){return this.KF}static toStubs(e,t,i){let c="";if(typeof e.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),e.languages||(e.languages=e.language),e?e.id?e.languages||(c="KeyboardStub has undefined languages"):c="KeyboardStub has undefined id":c="Stub undefined",c!="")return[{error:new Error(c)}];let s=[];Array.isArray(e.languages)?s=s.concat(e.languages):s.push(e.languages);let l=[];return s.forEach(r=>{let B=X(C({},e),{languages:r,language:void 0}),d=new w(B,t,i);l.push(d)}),l}merge(e){this.KL||(this.KL=e.KL),this.KR||(this.KR=e.KR),this.KRC||(this.KRC=e.KRC),this.KN||(this.KN=e.KN),this.KF||(this.KF=e.KF),this.KFont||(this.KFont=e.KFont),this.KOskFont||(this.KOskFont=e.KOskFont),e._displayName&&(this._displayName||(this._displayName=e._displayName))}validateForCustomKeyboard(){return super.validateForCustomKeyboard()||!this.KF||!this.KR?new Error("To use a custom keyboard, you must specify file name, keyboard id, keyboard name, language, language code, and region."):null}};a(w,"KeyboardStub");function ai(o,n){if(n.length==0)return Promise.resolve(o);if(o.length==0)return Promise.reject(n);{let e=o;return Promise.resolve(e.concat(n))}}a(ai,"mergeAndResolveStubPromises");var Rs=A(R(),1);var As="The Cloud API request timed out.",Nc="Could not find a keyboard with that ID.",Hs="The Cloud API failed to find an appropriate keyboard.",Ml="Error occurred while registering keyboards: ",Yl=a(function(o){return o+" keyboard not found."},"MISSING_KEYBOARD"),ve=class extends Rs.default{constructor(e,t){super();this.cloudResolutionPromises={};this.languageFetchStarted=!1;this.registerFromCloud=a(e=>{let t=e.timerid,i;try{i=this._registerCore(e)}catch(c){i=new Error(Ml+c)}if(t){let c=this.cloudResolutionPromises[t];if(c)try{i instanceof Error?c.reject(i):c.resolve(i)}finally{delete this.cloudResolutionPromises[t]}else{this.emit("unboundregister",i);return}}else{this.emit("unboundregister",i);return}},"registerFromCloud");this.requestEngine=e,this.pathConfig=t,this._languageListPromise=new L}get languageListPromise(){return this.languageFetchStarted||(this.languageFetchStarted=!0,this.keymanCloudRequest("",!0).catch(e=>{this.languageFetchStarted=!1,this._languageListPromise.reject(e),this._languageListPromise=new L})),this._languageListPromise.corePromise}keymanCloudRequest(e,t){let i="https://api.keyman.com/cloud/4.0/"+(arguments.length>1&&t?"languages":"keyboards"),c="?jsonp=keyman.register&languageidtype=bcp47&version="+f.CURRENT.toString(),s=i+c+e,{promise:l,queryId:r}=this.requestEngine.request(s);return this.cloudResolutionPromises[r]=l,l.finally(()=>{delete this.cloudResolutionPromises[r]}),l.corePromise}_registerCore(e){let t=e.options,i=t.fontBaseUri;if(this.pathConfig.fonts!=""?i=this.pathConfig.fonts:this.pathConfig.updateFontPath(i),typeof e.error=="string"){var c="";if(typeof e.options.keyboardid=="string"){let l=e.options.keyboardid;c=l.substring(0,1).toUpperCase()+l.substring(1)}return new Error(Yl(c))}if(typeof t=="undefined"||typeof t.context=="undefined")return new Error(Nc);let s=[];if(t.context=="keyboard"){let l,r=e.keyboard;if(Array.isArray(r))for(l=0;l<r.length;l++)s=s.concat(ve.registerLanguagesForKeyboard(r[l],t,l));else s=s.concat(ve.registerLanguagesForKeyboard(r,t,0))}else if(t.context=="language"){let l=e.languages;return this._languageListPromise.resolve(l),l}return s}static registerLanguagesForKeyboard(e,t,i){let c="";if(typeof e=="undefined")return[];if(typeof t.keyboardid=="string"&&(c=t.keyboardid.split(",")[i]),Array.isArray(e))if(e.length==1||c.substr(-1,1)=="$"||c==""){let s=[];for(let l=0;l<e.length;l++)s=s.concat(this.registerLanguagesForKeyboard(e[l],t,i));return s}else{let s=0;for(let l=0;l<e.length;l++){let r=e[l].id.toLowerCase();if(r=="us"&&(r="english"),Array.isArray(e[l].languages)){let B=e[l].languages;for(let d=0;d<B.length;d++)if(r==B[d].name.toLowerCase()){s=l;break}}}return this.registerLanguagesForKeyboard(e[s],t,i)}else{let s=t.fontBaseUri||"",l=w.toStubs(e,t.keyboardBaseUri,s),r=c.split("@")[1];if(l.length==1&&typeof l[0].error!="undefined")throw l[0].error;return typeof r!="string"?l:(r=r.replace(/\$$/,""),[l.find(B=>B.KLC==r)])}}fetchCloudStubs(e){return Z(this,null,function*(){if(e.length==0)return Promise.resolve([]);let t="&keyboardid=",i="";for(let s=0;s<e.length;s++)t=t+i+e[s].toString(),i=",";let c=[];try{let s=yield this.keymanCloudRequest(t,!1);return ai(s,c)}catch(s){console.error(s);let l={error:s};return c.push(l),Promise.reject(c)}})}};a(ve,"CloudQueryEngine");var cc=class{constructor(n,e){this.id=n,this.language=e}toString(){let n=this.id;return this.language?(n=n+"@"+this.language,this.version&&(n=n+"@"+this.version)):this.version&&(n=n+"@@"+this.version),n}};a(cc,"CloudRequestEntry");function Tc(o,n){return{keyboard:{id:o.id,name:o.name},error:typeof n=="string"?new Error(n):n}}a(Tc,"convertToErrorStub");function Es(o,n,e){let t=new cc(o,n);return e&&(t.version=e),t}a(Es,"toQuerySpecs");function vs(o,n,e){if(o.getStub(e.id,e.language)==null){for(let t=0;t<n.length;t++)if(n[t].id==e.id&&n[t].language==e.language)return!1;return!0}else return!1}a(vs,"isUniqueRequest");var Tt=class{constructor(n,e,t){this.pathConfig=t,this.cache=new Nt(n),this.cloudQueryEngine=new ve(e,this.pathConfig),this.cloudQueryEngine.on("unboundregister",i=>{Array.isArray(i)&&i.forEach(c=>{this.cache.addStub(c)})})}addKeyboardArray(n){let e=[],t=[],i=[],c=[],s=[];for(let B of n)if(typeof B=="string"&&B.length>0)c.push(B);else if(B.KI||B.KL||B.KLC||B.KFont||B.KOskFont)i.push(new w(B));else{let d=B;if(typeof d.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),d.languages||(d.languages=d.language),typeof d.languages=="undefined"){let g="To use keyboard '"+d.id+"', you must specify languages.";s.push(Tc(d,g))}else if(Array.isArray(d.languages)){let g=w.toStubs(d,this.pathConfig.keyboards,this.pathConfig.fonts);for(let F of g)F instanceof w?i.push(F):s.push(F)}else{let g=d;i.push(new w(g,this.pathConfig.keyboards,this.pathConfig.fonts))}}for(let B of i)if(B.KF){let d=B.validateForCustomKeyboard();d?s.push(Tc(B,d)):e.push(B)}else t.push(B);let l=[];for(let B of t){if(!B.KI&&!B.KLC){s.push(Tc(B,"Cannot fetch keyboard information without a keyboard ID or language code."));continue}let d=Es(we(B.id),B.langId);vs(this.cache,l,d)&&l.push(d)}for(let B of c){let d=B.split("@"),g=[""];d[0].toLowerCase()=="english"&&(d[0]="us"),d.length>1&&(g=d[1].split(","));for(let F=0;F<g.length;F++){if(F>0&&g[F]=="")continue;let Q=Es(d[0],g[F],d[2]);vs(this.cache,l,Q)&&l.push(Q)}}return e.forEach(B=>this.cache.addStub(B)),this.cloudQueryEngine.fetchCloudStubs(l.map(B=>B.toString())).then(B=>{for(let d of B)d instanceof w?(this.cache.addStub(d),e.push(d)):s.push(d);return[].concat(s).concat(e)})}addLanguageKeyboards(n){return Z(this,null,function*(){let e=[],t=[];try{t=yield this.cloudQueryEngine.languageListPromise}catch(s){return console.error(s),e.push({error:s}),e}let i=t,c="";for(let s=0;s<n.length;s++){let l=n[s].toLowerCase(),r=l.substr(-1,1)=="$";r&&(l=l.substr(0,l.length-1));let B=!1;for(let d=0;d<i.length;d++)if(l==i[d].name.toLowerCase()){c!=""&&(c=c+","),c=c+"@"+i[d].id,r&&(c=c+"$"),B=!0;break}if(!B){let d={language:{name:l},error:new Error(this.alertLanguageUnavailable(l))};e.push(d)}}return c==""?Promise.reject(e):this.cloudQueryEngine.keymanCloudRequest("&keyboardid="+c,!1).then(s=>Z(this,null,function*(){let l=yield ai(s,e);for(let r of l)typeof r.error=="undefined"&&this.cache.addStub(r);return l}),s=>{console.error(s);let l={error:s};return e.push(l),Promise.reject(e)})})}fetchCloudCatalog(){return Z(this,null,function*(){try{let n=yield this.cloudQueryEngine.keymanCloudRequest("",!1);return n.forEach(e=>this.cache.addStub(e)),n}catch(n){return Promise.reject([{error:n}])}})}alertLanguageUnavailable(n){return"No keyboards are available for "+n+". Does it have another language name?"}};a(Tt,"KeyboardRequisitioner");var Mt=class{constructor(){this.registeredModels={};this.languageModelMap={}}modelForLanguage(n){return this.languageModelMap[n]}register(n){if(n.id=n.id.toLowerCase(),JSON.stringify(n)==JSON.stringify(this.registeredModels[n.id]))return;this.registeredModels[n.id]=n;let e=this;n.languages.forEach(function(t){if(!t){console.warn("Null / undefined language codes are not permitted for registration.");return}e.languageModelMap[t]=n})}unregister(n){let e;if(n=n.toLowerCase(),this.registeredModels[n])e=this.registeredModels[n],delete this.registeredModels[n];else return;let t=this;return e.languages.forEach(function(i){t.languageModelMap[i].id==n&&delete t.languageModelMap[i]}),e}isRegistered(n){return!!this.registeredModels[n.id.toLowerCase()]}};a(Mt,"ModelManager");function sc(o){let n=[];for(let e=0;e<o.length;e++)n.push(o[e]);return n}a(sc,"arrayFromNodeList");function v(o){let n=document.createElement(o);return n.style.userSelect="none",n.style.webkitUserSelect="none",n.style.MozUserSelect="none",n}a(v,"createUnselectableElement");var Ue=class{constructor(n,e){this.fontStyleDefinitions={};this.linkedSheets=[];if(!n){let t=document.getElementsByTagName("HEAD");t.length>0?n=t[0]:n=document.body}this.linkNode=n,this.doCacheBusting=e||!1}linkStylesheet(n){this.linkedSheets.push(n),this.linkNode.appendChild(n)}allLoadedPromise(){return Z(this,null,function*(){var e;let n=[];for(let t of this.linkedSheets)if((e=t.sheet)!=null&&e.cssRules)n.push(Promise.resolve());else{let i=new L;t.addEventListener("load",()=>i.resolve()),n.push(i.corePromise)}yield Promise.all(n)})}addStyleSheetForFont(n,e,t){if(!n||typeof n.files=="undefined")return;let i=n.family,c,s="",l="",r="",B="",d=[];t||(t=G.OperatingSystem.Other);let g=this.fontStyleDefinitions[t]=this.fontStyleDefinitions[t]||{};if(g[i]){let u=g[i];u.parentNode||this.linkStylesheet(u);return}for(typeof n.files=="string"?d[0]=n.files:d=n.files,c=0;c<d.length;c++)d[c].toLowerCase().indexOf(".otf")>0&&(s=d[c]),d[c].toLowerCase().indexOf(".ttf")>0&&(s=d[c]),d[c].toLowerCase().indexOf(".woff")>0&&(l=d[c]),d[c].toLowerCase().indexOf(".eot")>0&&(r=d[c]),d[c].toLowerCase().indexOf(".svg")>0&&(B=d[c]);s!=""&&s.indexOf("/")<0&&(s=e+s),l!=""&&l.indexOf("/")<0&&(l=e+l),r!=""&&r.indexOf("/")<0&&(r=e+r),B!=""&&B.indexOf("/")<0&&(B=e+B);var F=`@font-face {
font-family:`+n.family+`;
font-style:normal;
font-weight:normal;
`;if(t==G.OperatingSystem.iOS)if(s!="")this.doCacheBusting&&(s=this.cacheBust(s)),F=F+"src:url('"+s+"') format('truetype');";else return null;else{var Q=[];if(t==G.OperatingSystem.Android?(B!=""&&Q.push("url('"+B+"') format('svg')"),l!=""&&Q.push("url('"+l+"') format('woff')"),s!=""&&Q.push("url('"+s+"') format('truetype')")):(l!=""&&Q.push("url('"+l+"') format('woff')"),s!=""&&Q.push("url('"+s+"') format('truetype')"),B!=""&&Q.push("url('"+B+"') format('svg')")),Q.length==0)return null;F+="src:"+Q.join(",")+";"}F=F+`
}
`;let y=gt(F);return g[i]=y,this.linkStylesheet(y),y}cacheBust(n){return n+"?v="+new Date().getTime()}linkExternalSheet(n){try{if(document.querySelector("link[href="+JSON.stringify(n)+"]")!=null)return}catch(t){return}let e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href=n,this.linkStylesheet(e)}unlink(n){let e=this.linkedSheets.indexOf(n);return e>-1?(this.linkedSheets.splice(e,1),n.parentNode.removeChild(n),!0):!1}unlinkAll(){for(let n of this.linkedSheets)n.parentNode&&n.parentNode.removeChild(n);this.linkedSheets.splice(0,this.linkedSheets.length)}};a(Ue,"StylesheetManager");function gt(o){var n=document.createElement("style");return n.type="text/css",n.appendChild(document.createTextNode(o)),n}a(gt,"createStyleSheet");function ge(){var o;return typeof window.orientation!="undefined"?o=window.orientation:typeof window.screen.orientation!="undefined"&&(o=window.screen.orientation.angle),o!==void 0?Math.abs(o/90)==1:!1}a(ge,"landscapeView");var Ws=a(o=>o,"no_change"),le=class{constructor(n){this.name=n}load(n){return this.loadCookie(this.name,n||Ws)}save(n,e){this.saveCookie(this.name,n,e||Ws)}_loadRawCookies(){let n={};if(typeof document.cookie!="undefined"&&document.cookie!=""){let e=document.cookie.split(/;\s*/);for(let t=0;t<e.length;t++){let i=e[t].split("=");i.length==2&&(n[i[0]]=i[1])}}return n}loadCookie(n,e){let t={},c=this._loadRawCookies()[n];if(c){let s=decodeURIComponent(c).split(";");for(let l=0;l<s.length&&!(l==s.length-1&&!s[l]);l++){let r=s[l].split("=");if(r.length>1){let[B,d]=r;t[B]=e(d,B)}else t[r[0]]=""}}return t}saveCookie(n,e,t){let i="";for(let l in e)i+=l+"="+t(e[l],l)+";";let s=" path=/; expires="+new Date(new Date().valueOf()+1e3*60*60*24*30).toUTCString();document.cookie=`${n}=${encodeURIComponent(i)}; ${s}`}};a(le,"CookieSerializer");function q(o){var n;if(!o)return 0;var e=o.offsetLeft?o.offsetLeft:0;if(n=o,n.offsetParent){for(;n.offsetParent;)n=n.offsetParent,e+=n.offsetLeft;let i=n.ownerDocument;n.style.position=="fixed"&&i&&i.scrollingElement&&(e+=i.scrollingElement.scrollLeft)}if(n&&n.ownerDocument&&o.ownerDocument!=window.document){var t=n.ownerDocument;if(t&&t.defaultView&&t.defaultView.frameElement)return e+q(t.defaultView.frameElement)-t.documentElement.scrollLeft}return e}a(q,"getAbsoluteX");function $(o){var n;if(!o)return 0;var e=o.offsetTop?o.offsetTop:0;if(n=o,n.ownerDocument&&n instanceof n.ownerDocument.defaultView.HTMLElement){for(;n.offsetParent;)n=n.offsetParent,e+=n.offsetTop;let i=n.ownerDocument;n.style.position=="fixed"&&i&&i.scrollingElement&&(e+=i.scrollingElement.scrollTop)}if(n&&n.ownerDocument&&o.ownerDocument!=window.document){var t=n.ownerDocument;if(t&&t.defaultView&&t.defaultView.frameElement)return e+$(t.defaultView.frameElement)}return e}a($,"getAbsoluteY");var Bi=class extends le{constructor(n,e){super(`KeymanWeb_${n}_Option_${e}`)}load(){return super.load(decodeURIComponent)}save(n){super.save(n,encodeURIComponent)}};a(Bi,"VarStoreSerializer");var Cn=class{loadStore(n,e){return new Bi(n,e).load()}saveStore(n,e,t){new Bi(n,e).save(t)}};a(Cn,"VariableStoreCookieSerializer");var Ft=class extends Je{constructor(e,t,i){super(e,t,new Cn);this.insertText=a((e,t)=>{this.resetContextCache(),this.engine.contextManager.insertText(this,e,t)},"insertText");this.KT=this.insertText;this.engine=t,this.stubNamespacer=i}preserveID(e){var t;if(document.currentScript)t=document.currentScript.id;else{var i=document.getElementsByTagName("script"),c=i[i.length-1];t=c.id}if(t)t.indexOf(we(e.KI))!=-1?e.KI=t:console.error("Error when registering keyboard:  current SCRIPT tag's ID does not match!");else return}registerKeyboard(e){super.registerKeyboard(e);let t=this.loadedKeyboard;this.preserveID(e),this.engine.config.deferForInitialization.then(()=>{this.engine.keyboardRequisitioner.cache.isFetchingKeyboard(t.id)||(this.engine.keyboardRequisitioner.cache.addKeyboard(t),this.loadedKeyboard=null)})}registerStub(e){var i;this.stubNamespacer&&this.stubNamespacer(e);let t=a(()=>{let c=this.engine.config.paths;return new w(e,c.keyboards,c.fonts)},"buildStub");if(!this.engine.config.deferForInitialization.isResolved)this.engine.config.deferForInitialization.then(()=>this.engine.keyboardRequisitioner.cache.addStub(t()));else{let c=t();if((i=this.engine.keyboardRequisitioner)!=null&&i.cache.findMatchingStub(c))return 1;this.engine.keyboardRequisitioner.cache.addStub(c)}return null}};a(Ft,"KeyboardInterface");(function(){Ft.__publishShorthandAPI()})();var di=class extends Zt{constructor(e,t){var n=(...args)=>{super(...args)};e&&e._jsGlobal!=window&&(e._jsGlobal.String=window.String),n(e||new ct(window,ni)),this.performCacheBusting=t||!1}loadKeyboardInternal(e,t,i){let c=new L;this.performCacheBusting&&(e=this.cacheBust(e));try{let s=this.harness._jsGlobal.document,l=s.createElement("script");i&&(l.id=i),s.head.appendChild(l),l.onerror=r=>{c.reject(t.missingError(r))},l.onload=()=>{if(this.harness.loadedKeyboard){let r=this.harness.loadedKeyboard;this.harness.loadedKeyboard=null,c.resolve(r)}else c.reject(t.scriptError())},c.then(()=>{l.remove()}).catch(()=>{l.remove()}),l.src=e}catch(s){return Promise.reject(s)}return c.corePromise}cacheBust(e){return e+"?v="+new Date().getTime()}};a(di,"DOMKeyboardLoader");var gi=class{constructor(n,e,t,i){this.Pelem=n,this.Peventname=e.toLowerCase(),this.Phandler=t,this.PuseCapture=i}equals(n){return this.Pelem==n.Pelem&&this.Peventname==n.Peventname&&this.Phandler==n.Phandler&&this.PuseCapture==n.PuseCapture}};a(gi,"DomEventTracking");var xe=class{constructor(){this.domEvents=[]}attachDOMEvent(n,e,t,i){this.detachDOMEvent(n,e,t,i),n.addEventListener(e,t,!!i);var c=new gi(n,e,t,i);this.domEvents.push(c)}detachDOMEvent(n,e,t,i){n.removeEventListener(e,t,i);for(var c=new gi(n,e,t,i),s=0;s<this.domEvents.length;s++)if(this.domEvents[s].equals(c)){this.domEvents.splice(s,1);break}}shutdown(){for(let n of this.domEvents)this.detachDOMEvent(n.Pelem,n.Peventname,n.Phandler,n.PuseCapture)}};a(xe,"DomEventTracker");var Mc=A(R(),1);var Yt=class extends Mc.default{constructor(n){super(),n instanceof Mc.default?(n.on=this.listenerRegistrationSpy("listeneradded",n,n.on),n.addListener=this.listenerRegistrationSpy("listeneradded",n,n.addListener),n.off=this.listenerRegistrationSpy("listenerremoved",n,n.off),n.removeListener=this.listenerRegistrationSpy("listenerremoved",n,n.off)):(n.addEventListener=this.listenerRegistrationSpy("listeneradded",n,n.addEventListener),n.removeEventListener=this.listenerRegistrationSpy("listenerremoved",n,n.removeEventListener))}listenerRegistrationSpy(n,e,t){return(i,c)=>{let s=t.apply(e,[i,c]);return this.emit(n,i),s}}};a(Yt,"EmitterListenerSpy");var wt=class{constructor(){this.events={};this.currentEvents=[]}addEventListener(n,e){return this._removeEventListener(n,e),this.events[n].push(e),!0}removeEventListener(n,e){return this._removeEventListener(n,e)}_removeEventListener(n,e){typeof this.events[n]=="undefined"&&(this.events[n]=[]);for(var t=0;t<this.events[n].length;t++)if(this.events[n][t]==e)return this.events[n].splice(t,1),!0;return!1}callEvent(n,e){if(typeof this.events[n]=="undefined")return!0;if(this.currentEvents.indexOf(n)!=-1)return!1;this.currentEvents.push(n);for(var t=0;t<this.events[n].length;t++){var i=this.events[n][t],c=!1;try{c=i(e)}catch(s){console.error(s),c=!1}if(c===!1)return this.currentEvents.pop(),!1}return this.currentEvents.pop(),!0}listenerCount(n){let e=this.events[n];return e?e.length:0}shutdown(){this.events={}}};a(wt,"LegacyEventEmitter");var xn=class{constructor(n=!1){this.fileLocal=n}request(n){let e=new L,t=window.setTimeout(()=>{e.reject(new Error(As))},1e4),i="&timerid="+t,c=n+i,s=document.createElement("script");s.onload=l=>{window.clearTimeout(t),e.isResolved||e.reject(new Error(Hs))},s.onerror=(l,r,B,d,g)=>{window.clearTimeout(t);let F=Nc;g&&(F=F+": "+g.message),e.reject(new Error(F))},this.fileLocal?s.src=n:s.src=c;try{document.body.appendChild(s)}catch(l){document.getElementsByTagName("head")[0].appendChild(s)}return e.finally(()=>{clearTimeout(t)}),{promise:e,queryId:t}}};a(xn,"DOMCloudRequester");function wl(){return typeof window.KeymanWeb_BaseLayout!="undefined"?window.KeymanWeb_BaseLayout:"us"}a(wl,"determineBaseLayout");var Dt=class{constructor(n,e,t,i){this.legacyAPIEvents=new wt;this.keyEventListener=a((n,e)=>{var c;let t=this.contextManager.activeTarget;if((!this.contextManager.activeKeyboard||!t)&&e&&e(null,null),this.keyEventRefocus&&this.keyEventRefocus(),t.invalidateSelection(),t.deadkeys().deleteMatched(),n.isSynthetic){let s=this.osk.vkbd.layerId;s&&s!=this.core.keyboardProcessor.layerId&&(this.core.keyboardProcessor.layerId=s)}let i=this.core.processKeyEvent(n,t);i&&((c=i.transcription)==null?void 0:c.transform)&&this.config.onRuleFinalization(i,this.contextManager.activeTarget),e&&e(i,null)},"keyEventListener");this.config=e,this.contextManager=t;let c=i(this);c.baseLayout=wl(),this.interface=c.keyboardInterface,this.core=new dt(e.hostDevice,n,c),this.core.languageProcessor.on("statechange",s=>{var l,r;(l=this.osk)==null||l.bannerController.selectBanner(s),(r=this.osk)==null||r.refreshLayout()}),this.core.keyboardProcessor.on("statekeychange",s=>{var l,r;(r=(l=this.osk)==null?void 0:l.vkbd)==null||r.updateStateKeys(s)}),this.contextManager.on("beforekeyboardchange",s=>{this.legacyAPIEvents.callEvent("beforekeyboardchange",{internalName:s==null?void 0:s.id,languageCode:s==null?void 0:s.langId})}),this.contextManager.on("keyboardchange",s=>{var l,r;this.refreshModel(),this.core.activeKeyboard=s==null?void 0:s.keyboard,this.legacyAPIEvents.callEvent("keyboardchange",{internalName:(l=s==null?void 0:s.metadata.id)!=null?l:"",languageCode:(r=s==null?void 0:s.metadata.langId)!=null?r:""}),s||this.osk.startHide(!1),this.osk&&(this.osk.setNeedsLayout(),this.osk.activeKeyboard=s,this.osk.present())}),this.contextManager.on("keyboardasyncload",s=>{var l,r;this.config.hostDevice.touchable&&((l=this.osk)==null?void 0:l.activationModel)&&(this.osk.activationModel.enabled=!0),(r=this.osk)==null||r.startHide(!1)})}init(n){return Z(this,null,function*(){let e=this.config;if(e.deferForInitialization.isResolved)return Promise.resolve();e.initialize(n);let t=new di(this.interface,e.applyCacheBusting);this.keyboardRequisitioner=new Tt(t,new xn,this.config.paths),this.modelCache=new Mt;let i=this.keyboardRequisitioner.cache;this.contextManager.configure({resetContext:c=>{this.core.resetContext(c)},predictionContext:new kt(this.core.languageProcessor,this.core.keyboardProcessor),keyboardCache:this.keyboardRequisitioner.cache}),this.config.on("spacebartext",()=>{var c;(c=this.osk)==null||c.refreshLayout()}),i.on("stubadded",c=>{let s=a(()=>{this.legacyAPIEvents.callEvent("keyboardregistered",{internalName:c.KI,language:c.KL,keyboardName:c.KN,languageCode:c.KLC,package:c.KP}),this.config.activateFirstKeyboard&&this.keyboardRequisitioner.cache.defaultStub==c&&this.contextManager.activateKeyboard(c.id,c.langId,!0)},"eventRaiser");this.config.deferForInitialization.isResolved?s():this.config.deferForInitialization.then(s)}),i.on("keyboardadded",c=>{let s=a(()=>{this.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:c.id})},"eventRaiser");this.config.deferForInitialization.isResolved?s():this.config.deferForInitialization.then(s)}),this.keyboardRequisitioner.cache.on("keyboardadded",c=>{this.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:c.id})})})}get build(){return Number.parseInt($n.VERSION_PATCH,10)}get version(){return $n.VERSION_RELEASE}get hardKeyboard(){return this._hardKeyboard}set hardKeyboard(n){this._hardKeyboard&&this._hardKeyboard.off("keyevent",this.keyEventListener),this._hardKeyboard=n,n.on("keyevent",this.keyEventListener)}get osk(){return this._osk}set osk(n){this._osk&&(this._osk.off("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=this.osk.layerChangeHandler),this._osk=n,n&&(this.contextManager.activeKeyboard&&(n.activeKeyboard=this.contextManager.activeKeyboard),n.on("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=n.layerChangeHandler)}getDebugInfo(){var t,i,c,s,l,r,B,d,g,F,Q,y,u,I;let n=(t=this.contextManager)==null?void 0:t.activeKeyboard;return{configReport:(i=this.config)==null?void 0:i.debugReport(),keyboard:{id:we((s=(c=n==null?void 0:n.metadata)==null?void 0:c.id)!=null?s:""),langId:((l=n==null?void 0:n.metadata)==null?void 0:l.langId)||"",version:(B=(r=n==null?void 0:n.keyboard)==null?void 0:r.version)!=null?B:""},model:{id:((g=(d=this.core)==null?void 0:d.activeModel)==null?void 0:g.id)||""},osk:{banner:(y=(Q=(F=this.osk)==null?void 0:F.banner)==null?void 0:Q.banner.type)!=null?y:"",layer:((I=(u=this.osk)==null?void 0:u.vkbd)==null?void 0:I.layerId)||""}}}refreshModel(){let n=this.contextManager.activeKeyboard,e=this.modelCache.modelForLanguage(n==null?void 0:n.metadata.langId);return this.core.activeModel!=e&&(this.core.activeModel&&this.core.languageProcessor.unloadModel(),e)?this.core.languageProcessor.loadModel(e).then(()=>e):Promise.resolve(e)}addEventListener(n,e){this.legacyAPIEvents.addEventListener(n,e)}removeEventListener(n,e){this.legacyAPIEvents.removeEventListener(n,e)}shutdown(){var n;this.legacyAPIEvents.shutdown(),(n=this.osk)==null||n.shutdown()}addModel(n){var t;this.modelCache.register(n);let e=(t=this.contextManager.activeKeyboard)==null?void 0:t.metadata;return e&&n.languages.indexOf(e.langId)!=-1?this.refreshModel().then(()=>{}):Promise.resolve()}removeModel(n){this.modelCache.unregister(n),this.core.activeModel&&this.core.activeModel.id==n&&this.core.languageProcessor.unloadModel()}setActiveKeyboard(n,e){return Z(this,null,function*(){return this.contextManager.activateKeyboard(n,e,!0)})}getActiveKeyboard(){var n,e;return(e=(n=this.contextManager.activeKeyboard)==null?void 0:n.metadata.id)!=null?e:""}getActiveLanguage(n){var t,i,c;let e=(t=this.contextManager.activeKeyboard)==null?void 0:t.metadata;return n?(c=e==null?void 0:e.langName)!=null?c:"":(i=e==null?void 0:e.langId)!=null?i:""}isChiral(n){let e;if(n){if(typeof n=="string"){let t=this.keyboardRequisitioner.cache.getKeyboard(n);if(t)n=t;else throw new Error(`Keyboard '${n}' has not been loaded.`)}e=n}else e=this.core.activeKeyboard;return e.isChiral}resetContext(){this.contextManager.resetContext()}setNumericLayer(){this.core.keyboardProcessor.setNumericLayer(this.config.softDevice)}};a(Dt,"KeymanEngine");var yl=A(R(),1);var fs=A(R(),1);var lc=class{get height(){return this._height}set height(n){this._height=n>0?n:0,this.update()}update(){let n=this.div.style,e=n.height,t=n.display;return this._height>0?(n.height=this._height+"px",n.display="block"):(n.height="0px",n.display="none"),e!==n.height||t!==n.display}constructor(n){let e=v("div");e.id=lc.BANNER_ID,e.className=lc.BANNER_CLASS,this.div=e,this.height=n,this.update()}appendStyleSheet(){}getDiv(){return this.div}configureForKeyboard(n,e){}},D=lc;a(D,"Banner"),D.DEFAULT_HEIGHT=37,D.BANNER_CLASS="kmw-banner-bar",D.BANNER_ID="kmw-banner-bar";var p=class{constructor(n){let e=typeof n=="string"?p.parseLengthStyle(n):n;this.val=e.val,this.absolute=e.absolute,e.special&&(this.special=e.special)}get styleString(){return this.absolute?this.val+"px":this.special?this.val+this.special:this.val*100+"%"}scaledBy(n){return new p({val:n*this.val,absolute:this.absolute})}static inPixels(n){return new p({val:n,absolute:!0})}static inPercent(n){return new p({val:n/100,absolute:!1})}static forScalar(n){return new p({val:n,absolute:!1})}static special(n,e){return new p({val:n,absolute:!1,special:e})}static parseLengthStyle(n){let e=parseFloat(n);return isNaN(e)?(console.error("Could not properly parse specified length style info: '"+n+"'."),null):n.indexOf("px")!=-1?{val:e,absolute:!0}:n.indexOf("pt")!=-1?{val:4*e/3,absolute:!0}:n.indexOf("%")!=-1?{val:e/100,absolute:!1}:n.indexOf("rem")!=-1?{val:e,absolute:!1,special:"rem"}:n.indexOf("em")!=-1?{val:e,absolute:!1,special:"em"}:{val:4*e/3,absolute:!0}}};a(p,"ParsedLengthStyle");var De=class extends D{constructor(){super(0);this.type="blank"}};a(De,"BlankBanner");var Fi=class{constructor(){this._activeBannerHeight=D.DEFAULT_HEIGHT;this.events=new fs.default;this.constructContainer()}constructContainer(){let n=v("div");return n.id="keymanweb_banner_container",n.className="kmw-banner-container",this.bannerContainer=n}get element(){return this.bannerContainer}appendStyles(){this.currentBanner&&this.currentBanner.appendStyleSheet()}get banner(){return this.currentBanner}set banner(n){if(this.currentBanner){if(n==this.currentBanner)return;{let e=this.currentBanner;this.currentBanner=n,this.bannerContainer.replaceChild(n.getDiv(),e.getDiv())}}else this.currentBanner=n,n&&this.bannerContainer.appendChild(n.getDiv());n instanceof De||(n.height=this.activeBannerHeight),this.events.emit("bannerchange")}get height(){return this.currentBanner?this.currentBanner.height:0}get activeBannerHeight(){return this._activeBannerHeight}set activeBannerHeight(n){this._activeBannerHeight=n,this.currentBanner&&!(this.currentBanner instanceof De)&&(this.currentBanner.height=n)}get layoutHeight(){return p.inPixels(this.height)}refreshLayout(){}};a(Fi,"BannerView");var Qi=class extends D{constructor(e,t){var n=(...args)=>{super(...args)};e.length>0?(n(),t&&(this.height=t)):n(0),this.type="image",e.indexOf("base64")>=0?console.log("Loading img from base64 data"):console.log("Loading img with src '"+e+"'"),this.img=document.createElement("img"),this.img.setAttribute("src",e);let i=this.img.style;i.width="100%",i.height="100%",this.getDiv().appendChild(this.img),console.log("Image loaded.")}setImagePath(e){this.img&&this.img.setAttribute("src",e)}};a(Qi,"ImageBanner");function ks(o){return"targetX"in o&&"targetY"in o&&"t"in o}a(ks,"isAnInputSample");var z=class{constructor(n){this.rawLinearSums={x:0,y:0,t:0};this.coordArcSum=0;this._sampleCount=0;if(!!n)if(n instanceof z)Object.assign(this,n),this.rawLinearSums=C({},n.rawLinearSums);else if(ks(n))Object.assign(this,this.extend(n));else throw new Error("A constructor for this input pattern has not yet been implemented")}extend(n){return this._extend(new z(this),n)}_extend(n,e){n._initialSample||(n._initialSample=e,n.baseSample=e);let t=n.baseSample;this.followingSample=e;let i=e.targetX-t.targetX,c=e.targetY-t.targetY,s=e.t-t.t;if(n.rawLinearSums.x+=i,n.rawLinearSums.y+=c,n.rawLinearSums.t+=s,this.lastSample){let l=e.targetX-this.lastSample.targetX,r=e.targetY-this.lastSample.targetY,B=e.t-this.lastSample.t,d=l*l+r*r,g=Math.sqrt(d);n.coordArcSum+=g}return n._lastSample=e,n.sampleCount=this.sampleCount+1,n}deaccumulate(n){let e=new z(this);return this._deaccumulate(e,n)}_deaccumulate(n,e){if(!e)return n;if(!e.followingSample||!e.lastSample)throw"Invalid argument:  stats missing necessary tracking variable.";for(let t in n.rawLinearSums){let i=t;n.rawLinearSums[i]-=e.rawLinearSums[i]}if(e.followingSample&&e.lastSample){let t=e.followingSample.targetX-e.lastSample.targetX,i=e.followingSample.targetY-e.lastSample.targetY,c=e.followingSample.t-e.lastSample.t,s=t*t+i*i,l=Math.sqrt(s);n.coordArcSum-=l,n.coordArcSum-=e.coordArcSum}return n.sampleCount-=e.sampleCount,n._initialSample=e.followingSample,n}translateCoordSystem(n){let e=new z(this);return this._translateCoordSystem(e,n)}_translateCoordSystem(n,e){if(this.sampleCount==0)return n;let t=n.initialSample==n.lastSample;return n._initialSample=e(n.initialSample),n.baseSample=e(n.baseSample),n._lastSample=t?n._initialSample:e(n.lastSample),n}replaceInitialSample(n){let e=new z(this);return this._replaceInitialSample(e,n)}_replaceInitialSample(n,e){if(this.sampleCount==0)throw new Error("no sample available to replace");let t=n.initialSample;if(n._initialSample=e,this.sampleCount>1){let i=e.targetX-t.targetX,c=e.targetY-t.targetY,s=e.t-t.t;n.rawLinearSums.x+=i,n.rawLinearSums.y+=c,n.rawLinearSums.t+=s;let l=i*i+c*c,r=Math.sqrt(l);n.coordArcSum+=r}else n._lastSample=e;return n}get lastSample(){return this._lastSample}get lastTimestamp(){var n;return(n=this.lastSample)==null?void 0:n.t}get sampleCount(){return this._sampleCount}set sampleCount(n){this._sampleCount=n}get initialSample(){return this._initialSample}mappingConstant(n){if(!!this.baseSample)return n=="t"?this.baseSample.t:n=="x"?this.baseSample.targetX:n=="y"?this.baseSample.targetY:0}mean(n){return this.rawLinearSums[n]/this.sampleCount+this.mappingConstant(n)}get netDistance(){if(!this.lastSample||!this.initialSample)return 0;let n=this.lastSample.targetX-this.initialSample.targetX,e=this.lastSample.targetY-this.initialSample.targetY;return Math.sqrt(n*n+e*e)}get duration(){return!this.lastSample||!this.initialSample?0:this.lastSample.t-this.initialSample.t}get angle(){if(this.sampleCount==1||!this.lastSample||!this.initialSample)return;if(this.netDistance<1)return;let n=this.lastSample.targetX-this.initialSample.targetX,e=this.lastSample.targetY-this.initialSample.targetY,t=Math.acos(-e/this.netDistance);return n<0?2*Math.PI-t:t}get angleInDegrees(){return this.angle*180/Math.PI}get cardinalDirection(){if(this.sampleCount==1||!this.lastSample||!this.initialSample||isNaN(this.angle)||this.angle===null||this.angle===void 0)return;let n=["n","ne","e","se","s","sw","w","nw","n"],e=Math.ceil((this.angleInDegrees-22.5)/45);return n[e]}get speed(){return this.duration?this.netDistance/this.duration:0}get rawDistance(){return this.coordArcSum}get summaryObject(){return{angle:this.angle,cardinal:this.cardinalDirection,netDistance:this.netDistance,duration:this.duration,sampleCount:this.sampleCount,rawDistance:this.rawDistance}}};a(z,"CumulativePathStats");function mn(o,n){let e=o.gestures.find(t=>t.id==n);if(!e)throw new Error(`Could not find spec for gesture with id '${n}'`);return e}a(mn,"getGestureModel");function Ns(o,n){let e=o.sets[n];if(!e)throw new Error(`Could not find a defined gesture-set with id '${n}'`);let t=o.gestures.filter(c=>!!e.find(s=>c.id==s)),i=e.filter(c=>!t.find(s=>s.id==c));if(i.length>0)throw new Error(`Set '${n}' cannot find definitions for gestures with ids ${i}`);return t}a(Ns,"getGestureModelSet");var Ts={gestures:[],sets:{default:[]}};var yi=class{constructor(){}getBoundingClientRect(){return new DOMRect(0,0,Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0))}};a(yi,"ViewportZoneSource");var he=class{get edgePadding(){return this._edgePadding}constructor(n,e){Array.isArray(n)&&(e=n,n=new yi),this.root=n,e=e||[0,0,0,0],this.updatePadding(e)}updatePadding(n){switch(n.length){case 1:let e=n[0];this._edgePadding={x:e,y:e,w:2*e,h:2*e};break;case 2:this._edgePadding={x:n[1],y:n[0],w:2*n[1],h:2*n[0]};break;case 3:this._edgePadding={x:n[1],y:n[0],w:2*n[1],h:n[0]+n[2]};break;case 4:this._edgePadding={x:n[3],y:n[0],w:n[1]+n[3],h:n[0]+n[2]};break;default:throw new Error("Invalid values for PaddedZoneSource's edgePadding - must be between 1 to 4 `number` values.")}}getBoundingClientRect(){let n=this.root.getBoundingClientRect();return new DOMRect(n.left+this.edgePadding.x,n.top+this.edgePadding.y,n.width-this.edgePadding.w,n.height-this.edgePadding.h)}};a(he,"PaddedZoneSource");function rc(o){var e,t,i,c,s,l;let n=C({},o);if(n.mouseEventRoot=(e=n.mouseEventRoot)!=null?e:n.targetRoot,n.touchEventRoot=(t=n.touchEventRoot)!=null?t:n.targetRoot,n.inputStartBounds=(i=n.inputStartBounds)!=null?i:n.targetRoot,n.maxRoamingBounds=(c=n.maxRoamingBounds)!=null?c:n.targetRoot,n.safeBounds=(s=n.safeBounds)!=null?s:new he([2]),n.itemIdentifier=(l=n.itemIdentifier)!=null?l:()=>null,n.recordingMode=!!n.recordingMode,o.paddedSafeBounds)delete n.safeBoundPadding;else{let r=o.safeBoundPadding;typeof r=="number"&&(r=[r]),r=r!=null?r:[3],n.paddedSafeBounds=new he(n.safeBounds,r)}return n}a(rc,"preprocessRecognizerConfig");var Ys=A(R(),1);var Ms=A(R(),1);var ze=class extends Ms.default{constructor(){super();this._isComplete=!1;this._stats=new z}get stats(){return this._stats}clone(){let e=new ze;return e._isComplete=this._isComplete,e._wasCancelled=this._wasCancelled,e._stats=new z(this._stats),e}get isComplete(){return this._isComplete}get wasCancelled(){return this._wasCancelled}translateCoordSystem(e){this._stats=this._stats.translateCoordSystem(e)}replaceInitialSample(e){this._stats=this._stats.replaceInitialSample(e)}extend(e){if(this._isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this._stats=this._stats.extend(e),this.emit("step",e)}terminate(e=!1){this._isComplete||(this._wasCancelled=e,this._isComplete=!0,e?this.emit("invalidated"):this.emit("complete"),this.removeAllListeners())}};a(ze,"GesturePath");var me=class extends ze{constructor(){super(...arguments);this.samples=[]}clone(){let e=new me;return e.samples=[].concat(this.samples),e._isComplete=this._isComplete,e._wasCancelled=this._wasCancelled,e._stats=new z(this._stats),e}static deserialize(e){let t=new me;t.samples=[].concat(e.coords.map(c=>C({},c))),t._isComplete=!0,t._wasCancelled=e.wasCancelled;let i=t.samples.reduce((c,s)=>c.extend(s),new z);return t._stats=i,t}extend(e){if(this.isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this.samples.push(e),super.extend(e)}translateCoordSystem(e){super.translateCoordSystem(e);for(let t=0;t<this.samples.length;t++)this.samples[t]=e(this.samples[t])}get coords(){return this.samples}toJSON(){let e={coords:[].concat(this.samples.map(t=>({targetX:t.targetX,targetY:t.targetY,t:t.t,item:t.item}))),wasCancelled:this.wasCancelled};for(let t of e.coords)delete t.clientX,delete t.clientY,t.item===void 0&&delete t.item;return e}};a(me,"GestureDebugPath");var be=class{constructor(n,e,t,i){this.stateToken=null;this.rawIdentifier=n,this.isFromTouch=t,this._path=i?new i:new ze,this.recognizerConfigStack=Array.isArray(e)?e:[e]}get path(){return this._path}setGestureMatchInspector(n){if(this._matchInspectionClosure)throw new Error("Invalid state:  the match-inspection closure has already been set");this._matchInspectionClosure=n}update(n){this.path.extend(n),this._baseItem||(this._baseItem=n.item)}get baseItem(){return this._baseItem}set baseItem(n){this._baseItem=n}get currentSample(){return this.path.stats.lastSample}get potentialModelMatchIds(){return this._matchInspectionClosure(this)}constructSubview(n,e,t){return new T(this,this.recognizerConfigStack,n,e,t)}terminate(n){this.path.terminate(n)}get isPathComplete(){return this.path.isComplete}get identifier(){return`${this.isFromTouch?"touch":"mouse"}:${this.rawIdentifier}`}pushRecognizerConfig(n){let e=X(C({},n),{mouseEventRoot:this.recognizerConfigStack[0].mouseEventRoot,touchEventRoot:this.recognizerConfigStack[0].touchEventRoot});this.recognizerConfigStack.push(rc(e))}popRecognizerConfig(){if(this.recognizerConfigStack.length==1)throw new Error("Cannot 'pop' the original recognizer-configuration for this GestureSource.");return this.recognizerConfigStack.pop()}get currentRecognizerConfig(){return this.recognizerConfigStack[this.recognizerConfigStack.length-1]}};a(be,"GestureSource");var T=class extends be{constructor(e,t,i,c,s){let l=0,r=e.path.stats.sampleCount;e instanceof T&&(l=e._baseStartIndex);super(e.rawIdentifier,t,e.isFromTouch,Object.getPrototypeOf(e.path).constructor);let B=this._baseSource=e instanceof T?e._baseSource:e;this.stateToken=s!=null?s:e.stateToken;let d=a(u=>{let I=this.recognizerTranslation,b=X(C({},u),{targetX:u.targetX-I.x,targetY:u.targetY-I.y});return this.stateToken&&(b.stateToken=this.stateToken),(this.stateToken!=B.stateToken||this.stateToken!=e.stateToken)&&(b.item=this.currentRecognizerConfig.itemIdentifier(b,null)),b},"translateSample"),g=e.path.stats.lastSample;i?(this._baseStartIndex=l=Math.max(l+r-1,0),r=r>0?1:0):this._baseStartIndex=l,i?e.path.stats.sampleCount&&this._path.extend(e.path.stats.lastSample):this._path=e.path.clone(),this._path.translateCoordSystem(d),c?this._baseItem=e.baseItem:this._baseItem=g==null?void 0:g.item;let F=a(()=>this.path.terminate(!1),"completeHook"),Q=a(()=>this.path.terminate(!0),"invalidatedHook"),y=a(u=>{super.update(d(u))},"stepHook");B.path.on("complete",F),B.path.on("invalidated",Q),B.path.on("step",y),this.subviewDisconnector=()=>{B.path.off("complete",F),B.path.off("invalidated",Q),B.path.off("step",y)},B.isPathComplete&&(this.path.terminate(B.path.wasCancelled),this.disconnect())}get recognizerTranslation(){if(this.recognizerConfigStack.length==1||!this.currentRecognizerConfig)return{x:0,y:0};let t=this.currentRecognizerConfig.targetRoot.getBoundingClientRect(),i=this.recognizerConfigStack[0].targetRoot.getBoundingClientRect();return{x:t.left-i.left,y:t.top-i.top}}get baseSource(){return this._baseSource}disconnect(){this.subviewDisconnector&&(this.subviewDisconnector(),this.subviewDisconnector=null)}pushRecognizerConfig(e){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")}popRecognizerConfig(){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")}update(e){throw new Error("Updates should be provided through the base GestureSource.")}terminate(e){this.baseSource.terminate(e)}};a(T,"GestureSourceSubview");var zt=class extends be{constructor(e,t,i){super(e,t,i,me);this.stateToken=null}initPath(){return new me}static deserialize(e,t){let i=t!==void 0?t:this._jsonIdSeed++,c=e.isFromTouch,s=me.deserialize(e.path),l=new zt(i,null,c);return l._path=s,l}toJSON(){let e=this.path;return{isFromTouch:this.isFromTouch,path:e.toJSON()}}};a(zt,"GestureDebugSource");var Yc=class extends Ys.default{constructor(e){var t;super();this._activeTouchpoints=[];this.identifierMap={};this.config=e,this.sourceConstructor=(t=e==null?void 0:e.recordingMode)==null||t?zt:be}createTouchpoint(e,t){let i=Yc.IDENTIFIER_SEED++;this.identifierMap[e]=i;let c=new this.sourceConstructor(i,this.config,t);return c.stateToken=this.stateToken,c}maintainTouchpointsWithIds(e){let t=e.map(i=>this.identifierMap[i]);this._activeTouchpoints.filter(i=>!t.includes(i.rawIdentifier)).forEach(i=>i.terminate(!0))}hasActiveTouchpoint(e){return this.identifierMap[e]!==void 0}getTouchpointWithId(e){let t=this.identifierMap[e];return this._activeTouchpoints.find(i=>i.rawIdentifier==t)}getConfigForId(e){return this.getTouchpointWithId(e).currentRecognizerConfig}getStateTokenForId(e){var t;return(t=this.getTouchpointWithId(e).stateToken)!=null?t:null}dropTouchpoint(e){let t=e.rawIdentifier;this._activeTouchpoints=this._activeTouchpoints.filter(i=>e!=i);for(let i of Object.keys(this.identifierMap))this.identifierMap[i]==t&&delete this.identifierMap[i]}addTouchpoint(e){this._activeTouchpoints.push(e)}get activeSources(){return[].concat(this._activeTouchpoints)}},Gn=Yc;a(Gn,"InputEngineBase"),Gn.IDENTIFIER_SEED=0;function wc(o,n,e){let t=o.targetRoot.getBoundingClientRect();return{clientX:n,clientY:e,targetX:n-t.left,targetY:e-t.top}}a(wc,"processSampleClientCoords");var Kt=class extends Gn{buildSampleFor(n,e,t,i,c){var B,d;let s=X(C({},wc(this.config,n,e)),{t:i,stateToken:(B=c==null?void 0:c.stateToken)!=null?B:this.stateToken}),r=((d=c==null?void 0:c.currentRecognizerConfig.itemIdentifier)!=null?d:this.config.itemIdentifier)(s,t);return s.item=r,s}onInputStart(n,e,t,i){let c=this.createTouchpoint(n,i);c.update(e),this.addTouchpoint(c),c.path.on("invalidated",()=>{this.dropTouchpoint(c)}),c.path.on("complete",()=>{this.dropTouchpoint(c)}),this.emit("pointstart",c)}onInputMove(n,e,t){let i=this.getTouchpointWithId(n);!i||i.update(e)}onInputMoveCancel(n,e,t){let i=this.getTouchpointWithId(n);!i||(i.update(e),i.path.terminate(!0))}onInputEnd(n,e){var s;let t=this.getTouchpointWithId(n);if(!t)return;let i=t.path.stats.lastSample,c=this.buildSampleFor(i.clientX,i.clientY,e,i.t,t);c.t!=i.t&&t.update(c),(s=this.getTouchpointWithId(n))==null||s.path.terminate(!1)}};a(Kt,"InputEventEngine");var pn=class{constructor(){}static getCoordZoneBitmask(n,e){let t=e.getBoundingClientRect(),i=0;return i|=n.clientX<t.left?pn.FAR_LEFT:0,i|=n.clientX>t.right?pn.FAR_RIGHT:0,i|=n.clientY<t.top?pn.FAR_TOP:0,i|=n.clientY>t.bottom?pn.FAR_BOTTOM:0,i}static inputStartOutOfBoundsCheck(n,e){return!!this.getCoordZoneBitmask(n,e.inputStartBounds)}static inputStartSafeBoundProximityCheck(n,e){return this.getCoordZoneBitmask(n,e.paddedSafeBounds)}static inputMoveCancellationCheck(n,e,t){return t=t||0,this.getCoordZoneBitmask(n,e.maxRoamingBounds)?!0:!!(this.getCoordZoneBitmask(n,e.safeBounds)&~t)}},re=pn;a(re,"ZoneBoundaryChecker"),re.FAR_TOP=8,re.FAR_LEFT=4,re.FAR_BOTTOM=2,re.FAR_RIGHT=1;var ui=class extends Kt{constructor(e){super(e);this.hasActiveClick=!1;this.disabledSafeBounds=0;this._mouseStart=t=>this.onMouseStart(t),this._mouseMove=t=>this.onMouseMove(t),this._mouseEnd=t=>this.onMouseEnd(t)}get eventRoot(){return this.config.mouseEventRoot}get activeIdentifier(){return 0}registerEventHandlers(){this.eventRoot.addEventListener("mousedown",this._mouseStart,!0),this.eventRoot.addEventListener("mousemove",this._mouseMove,!1),this.eventRoot.addEventListener("mouseup",this._mouseEnd,!0)}unregisterEventHandlers(){this.eventRoot.removeEventListener("mousedown",this._mouseStart,!0),this.eventRoot.removeEventListener("mousemove",this._mouseMove,!1),this.eventRoot.removeEventListener("mouseup",this._mouseEnd,!0)}preventPropagation(e){e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,typeof e.stopImmediatePropagation=="function"?e.stopImmediatePropagation():typeof e.stopPropagation=="function"&&e.stopPropagation()}buildSampleFromEvent(e,t){let i=this.getTouchpointWithId(t);return this.buildSampleFor(e.clientX,e.clientY,e.target,performance.now(),i)}onMouseStart(e){if(!this.config.targetRoot.contains(e.target))return;this.preventPropagation(e);let t=this.activeIdentifier,i=this.buildSampleFromEvent(e,t);re.inputStartOutOfBoundsCheck(i,this.config)||(this.disabledSafeBounds=re.inputStartSafeBoundProximityCheck(i,this.config)),this.onInputStart(t,i,e.target,!1)}onMouseMove(e){if(!this.hasActiveTouchpoint(this.activeIdentifier))return;let t=this.buildSampleFromEvent(e,this.activeIdentifier);if(!e.buttons){this.hasActiveClick&&(this.hasActiveClick=!1,this.onInputMoveCancel(this.activeIdentifier,t,e.target));return}this.preventPropagation(e);let i=this.getConfigForId(this.activeIdentifier);re.inputMoveCancellationCheck(t,i,this.disabledSafeBounds)?this.onInputMoveCancel(this.activeIdentifier,t,e.target):this.onInputMove(this.activeIdentifier,t,e.target)}onMouseEnd(e){!this.hasActiveTouchpoint(this.activeIdentifier)||(e.buttons||(this.hasActiveClick=!1),this.onInputEnd(this.activeIdentifier,e.target))}};a(ui,"MouseEventEngine");function Dc(o){let n=[];for(let e=0;e<o.length;e++)n.push(o.item(e));return n}a(Dc,"touchListToArray");var Ii=class extends Kt{constructor(e){super(e);this.safeBoundMaskMap={};this._touchStart=t=>this.onTouchStart(t),this._touchMove=t=>this.onTouchMove(t),this._touchEnd=t=>this.onTouchEnd(t)}get eventRoot(){return this.config.touchEventRoot}registerEventHandlers(){this.eventRoot.addEventListener("touchstart",this._touchStart,{capture:!0,passive:!1}),this.eventRoot.addEventListener("touchmove",this._touchMove,{capture:!1,passive:!1}),this.eventRoot.addEventListener("touchend",this._touchEnd,{capture:!0,passive:!1})}unregisterEventHandlers(){this.eventRoot.removeEventListener("touchstart",this._touchStart,!0),this.eventRoot.removeEventListener("touchmove",this._touchMove,!1),this.eventRoot.removeEventListener("touchend",this._touchEnd,!0)}preventPropagation(e){e.cancelable&&e.preventDefault(),typeof e.stopImmediatePropagation=="function"?e.stopImmediatePropagation():typeof e.stopPropagation=="function"&&e.stopPropagation()}dropTouchpoint(e){super.dropTouchpoint(e);for(let t of Object.keys(this.safeBoundMaskMap))this.getTouchpointWithId(Number.parseInt(t,10))==e&&delete this.safeBoundMaskMap[t]}buildSampleFromTouch(e,t){let i=this.getTouchpointWithId(e.identifier);return this.buildSampleFor(e.clientX,e.clientY,e.target,t,i)}onTouchStart(e){if(!this.config.targetRoot.contains(e.target))return;this.preventPropagation(e);let t=Dc(e.touches),i=Dc(e.changedTouches);this.maintainTouchpointsWithIds(t.filter(s=>i.findIndex(l=>s.identifier==l.identifier)==-1).map(s=>s.identifier));let c=performance.now();for(let s=0;s<e.changedTouches.length;s++){let l=e.changedTouches.item(s),r=this.buildSampleFromTouch(l,c);if(!re.inputStartOutOfBoundsCheck(r,this.config))this.safeBoundMaskMap[l.identifier]=re.inputStartSafeBoundProximityCheck(r,this.config);else continue;this.onInputStart(l.identifier,r,e.target,!0)}}onTouchMove(e){let t=!0,i=performance.now();this.maintainTouchpointsWithIds(Dc(e.touches).map(c=>c.identifier));for(let c=0;c<e.touches.length;c++){let s=e.touches.item(c);if(!this.hasActiveTouchpoint(s.identifier))continue;t&&(this.preventPropagation(e),t=!1);let l=this.getConfigForId(s.identifier),r=this.buildSampleFromTouch(s,i);re.inputMoveCancellationCheck(r,l,this.safeBoundMaskMap[s.identifier])?this.onInputMoveCancel(s.identifier,r,s.target):this.onInputMove(s.identifier,r,s.target)}}onTouchEnd(e){let t=!0;for(let i=0;i<e.changedTouches.length;i++){let c=e.changedTouches.item(i);!this.hasActiveTouchpoint(c.identifier)||(t&&(this.preventPropagation(e),t=!1),this.onInputEnd(c.identifier,e.target))}}};a(Ii,"TouchEventEngine");var zs=A(R(),1);var ws=A(R(),1);var Ui=class{get promise(){return this.publishedPromise.corePromise}constructor(n,e,t){if(!n||!e)throw new Error("A gesture-path source and contact-path model must be specified.");if(this.model=n,this.publishedPromise=new L,this.source=e,this.inheritedStats=t,this.lastStats=null,n.timer){let i=n.timer.inheritElapsed?Math.min(e.path.stats.duration,n.timer.duration):0;this.timerPromise=new He(n.timer.duration-i),this.publishedPromise.then(()=>{this.timerPromise.resolve(!1)}),this.timerPromise.then(c=>{let s=e instanceof T?e.baseSource:e,l=performance.now();!s.isPathComplete&&s.currentSample.t!=l&&s.path.extend(X(C({},s.currentSample),{t:l})),c!=n.timer.expectedResult&&this.finalize(!1,"timer"),n.timer.validateItem?this.finalize(n.timer.validateItem(this.source.path.stats.lastSample.item,this.baseItem),"timer"):this.finalize(!0,"timer")})}}finalize(n,e){if(this.publishedPromise.isFulfilled)return this._result;let t=this.model,i;return n?i={type:t.pathResolutionAction,cause:e}:i={type:"reject",cause:e},this.publishedPromise.resolve(i),this._result=i,i}get stats(){return this.source.path.stats}get baseItem(){return this.source.baseItem}get lastItem(){return this.source.currentSample.item}update(){let n=this.model,e=this.source;if(e.path.wasCancelled)return this.finalize(!1,"path");if(n.itemChangeAction&&e.path.stats.sampleCount>0&&e.currentSample.item!=e.baseItem){let t=n.itemChangeAction=="resolve";return this.finalize(t,"item")}else{let t=n.pathModel.evaluate(e.path,this.lastStats,e.baseItem,this.inheritedStats)||"continue";return this.lastStats=e.path.stats,t!="continue"?this.finalize(t=="resolve","path"):e.path.isComplete?this.finalize(!1,"path"):{type:"continue"}}}};a(Ui,"PathMatcher");var Xn=class{constructor(n,e){this._isCancelled=!1;var l;if(!n||!e)throw new Error("Construction of GestureMatcher requires a gesture-model spec and a source for related contact points.");if(!n.sustainTimer&&!e)throw new Error("If the provided gesture-model spec lacks a sustain timer, there must be an active contact point.");let t=e instanceof be?null:e,i=t?null:e;this.predecessor=t,this.publishedPromise=new L,this.model=n,n.sustainTimer&&(this.sustainTimerPromise=new He(n.sustainTimer.duration),this.sustainTimerPromise.then(r=>{let B=n.sustainTimer.expectedResult==r;this.finalize(B,"timer")})),this.pathMatchers=[];let s=(i?[i]:t.sources).map(r=>i&&r==i?i:r.isPathComplete?null:r).reduce((r,B)=>B?r.concat(B):r,[]);if(n.sustainTimer&&s.length>0){this.finalize(!1,"path");return}else!n.sustainTimer&&s.length==0&&this.finalize(!1,"path");for(let r=0;r<s.length;r++){let B=s[r],d=B;B instanceof T&&(B.disconnect(),d=B.baseSource);let g=n.contacts[r];if(!g)throw new Error(`No contact model for inherited path: gesture "${n.id}', entry ${r}`);let F=(l=g==null?void 0:g.model.pathInheritance)!=null?l:"chop",Q=!1,y;switch(F){case"reject":this.finalize(!1,"path");return;case"full":y=B.constructSubview(!1,!0),this.addContactInternal(y,B.path.stats);continue;case"partial":Q=!0;case"chop":y=B.constructSubview(!0,Q),this.addContactInternal(y,B.path.stats);break}}}get sources(){return this.pathMatchers.map((n,e)=>{if(!this.model.contacts[e].resetOnResolve)return n.source}).filter(n=>!!n)}get promise(){return this.publishedPromise.corePromise}cancel(){this._isCancelled=!0,this._result||this.finalize(!1,"cancelled")}get isCancelled(){return this._isCancelled}finalize(n,e){var t,i;if(this.publishedPromise.isFulfilled)return this._result;try{let c;n?c=this.model.resolutionAction:((t=this.model.rejectionActions)!=null&&t[e]&&(c=this.model.rejectionActions[e],c.item="none"),c=c||{type:"none",item:"none"});let s;switch((i=c.item)!=null?i:"current"){case"none":s=null;break;case"base":s=this.primaryPath.baseItem;break;case"current":s=this.primaryPath.currentSample.item;break}let r={matched:n,action:X(C({},c),{item:s})};return this.publishedPromise.resolve(r),this._result=r,r}catch(c){this.publishedPromise.reject(c)}}finalizeSources(){if(!this._result)throw Error("Invalid state for source-finalization - the matcher's evaluation of the gesture model is not yet complete");let n=this._result.matched;for(let e=0;e<this.pathMatchers.length;e++){let t=this.pathMatchers[e],i=this.model.contacts[e];t.source.isPathComplete||(n&&i.endOnResolve||!n&&i.endOnReject)&&t.source.terminate(!1)}}get primaryPath(){let n,e=Number.NEGATIVE_INFINITY;for(let t of this.pathMatchers)t.model.itemPriority>e&&(e=t.model.itemPriority,n=t);return!n&&this.predecessor?this.predecessor.primaryPath:n==null?void 0:n.source}get baseItem(){return this.primaryPath.baseItem}get currentItem(){return this.primaryPath.currentSample.item}get allSourceIds(){let n=this.sources.map(t=>t.identifier),e=this.predecessor?this.predecessor.allSourceIds:[];return n=n.filter(t=>e.indexOf(t)==-1),n.concat(e)}mayAddContact(){return this.pathMatchers.length<this.model.contacts.length}addContact(n){let e=this.pathMatchers.length;if(!this.mayAddContact())throw new Error(`The specified gesture model does not support more than ${e} contact points.`);this.addContactInternal(n.constructSubview(!1,!0),null)}get result(){return this._result}addContactInternal(n,e){var r;let t=this.pathMatchers.length,i=this.model.contacts[t],c=new Ui(i.model,n,new z(e));this.pathMatchers.push(c);let s=null,l=null;if(!t&&this.predecessor&&this.model.sustainTimer){s=this.predecessor.primaryPath;let B=(r=this.model.sustainTimer.baseItem)!=null?r:"result",d;switch(B){case"none":l=null;break;case"base":l=this.predecessor.primaryPath.baseItem,d=this.predecessor.primaryPath.stateToken;break;case"result":l=this.predecessor.result.action.item,d=this.predecessor.primaryPath.currentSample.stateToken;break}n.baseItem=l!=null?l:n.baseItem,n.stateToken=d,n.currentSample.stateToken=d,n.currentRecognizerConfig&&(n.currentSample.item=n.currentRecognizerConfig.itemIdentifier(n.currentSample,null))}else l=this.primaryPath.baseItem,s=this.primaryPath;if(i.model.baseCoordReplacer){let B=n.path.stats,d=i.model.baseCoordReplacer(B,l);if(d){let g=X(C({},wc(n.currentRecognizerConfig,d.clientX,d.clientY)),{t:d.t||d.t===0?d.t:B.initialSample.t,item:l,stateToken:n.stateToken});n.path.replaceInitialSample(g)}}i.model.allowsInitialState&&(i.model.allowsInitialState(n.currentSample,s.currentSample,l,s.stateToken)||(this.pathMatchers.pop(),this.finalize(!1,"path"))),c.update(),c.promise.then(B=>{this.finalize(B.type=="resolve",B.cause)})}update(){this.pathMatchers.forEach(n=>n.update())}};a(Xn,"GestureMatcher");var Ot=class extends ws.default{constructor(e){super();this._sourceSelector=[];this.potentialMatchers=[];this.sustainMode=!1;this.attemptSynchronousUpdate=a(()=>{let t=this._sourceSelector.filter(c=>!c.source.isPathComplete).map(c=>c.source.currentSample.t),i=t[0];t.find(c=>i!=c)||this.potentialMatchers.forEach(c=>c.update())},"attemptSynchronousUpdate");this.baseGestureSetId=e||"default"}potentialMatchersForSource(e){return this.potentialMatchers.filter(t=>t.allSourceIds.find(i=>i==e.identifier))}cascadeTermination(){let e=this.potentialMatchers,t=e.filter(l=>!l.model.sustainWhenNested),i=e.filter(l=>l.model.sustainWhenNested);this.potentialMatchers=i;let c=i.map(l=>l.allSourceIds).reduce((l,r)=>{for(let B of r)l.indexOf(B)==-1&&l.push(B);return l},[]);return this._sourceSelector.filter(l=>!c.find(r=>r==l.source.identifier)).forEach(l=>{l.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}});let r=this._sourceSelector.indexOf(l);r>-1&&this._sourceSelector.splice(r,1)}),t.forEach(l=>l.cancel()),this.sustainMode=!0,this._sourceSelector.map(l=>l.source)}matchGesture(e,t){return Z(this,null,function*(){let i=e instanceof be,c=a(Q=>{let y=Q.sources.map(u=>u.baseSource);return y&&y.length>0?y:Q.predecessor?c(Q.predecessor):[]},"determinePredecessorSources"),s=i?[e instanceof T?e.baseSource:e]:c(e),l=i?e:null,r=i?null:e;this.pendingMatchSetup&&(yield this.pendingMatchSetup),i&&l.path.on("invalidated",()=>{this.dropSourcesWithIds([l.identifier])});let B=new L,g=s.map(Q=>{let y={source:Q,matchPromise:B};return this._sourceSelector.push(y),y}).map(Q=>Q.matchPromise);if(i){let Q=this.potentialMatchers.filter(y=>y.mayAddContact());if(Q.forEach(y=>{y.addContact(l),y.promise.then(this.matcherSelectionFilter(y,g))}),Q.length>0){let y=this.stateToken,u=new L;this.pendingMatchSetup=u.corePromise,yield Me(0),yield Me(0),this.pendingMatchSetup=null,u.resolve();let I=this.stateToken;if(y!=I){let U=l.currentSample;l.stateToken=I,U.stateToken=I,U.item=e.currentRecognizerConfig.itemIdentifier(U,null),l.baseItem=U.item}let b=Q.find(U=>U.result);if(b&&b.allSourceIds.includes(e.identifier))return B.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),{selectionPromise:B.corePromise}}}if(this.sustainMode&&l)return B.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),{selectionPromise:B.corePromise,sustainModeWithoutMatch:!0};let F=t.map(Q=>new Xn(Q,l||r));F=F.filter(Q=>!Q.result||Q.result.matched!==!1);for(let Q of F)Q.promise.then(this.matcherSelectionFilter(Q,g));return F.length>0?this.potentialMatchers=this.potentialMatchers.concat(F):B.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),this.potentialMatchers.sort((Q,y)=>y.model.resolutionPriority-Q.model.resolutionPriority),this.resetSourceHooks(),{selectionPromise:B.corePromise}})}resetSourceHooks(){let e=a(t=>{let i=t;i.path.off("step",this.attemptSynchronousUpdate),i.path.off("complete",this.attemptSynchronousUpdate),i.path.off("invalidated",this.attemptSynchronousUpdate),i.path.on("step",this.attemptSynchronousUpdate),i.path.on("complete",this.attemptSynchronousUpdate),i.path.on("invalidated",this.attemptSynchronousUpdate)},"resetHooks");this._sourceSelector.forEach(t=>e(t.source))}dropSourcesWithIds(e){for(let t of e){let i=this._sourceSelector.findIndex(c=>c.source.identifier==t);i>-1&&this._sourceSelector.splice(i,1)[0].matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"none",item:null}}})}}matchersForSource(e){return this.potentialMatchers.filter(t=>!!t.sources.find(i=>i.identifier==e.identifier))}matcherSelectionFilter(e,t){return i=>Z(this,null,function*(){e.isCancelled?i={matched:!1,action:{type:"none",item:null}}:e.finalizeSources();let s=e.allSourceIds.map(r=>this._sourceSelector.find(B=>B.source.identifier==r)).filter(r=>!!r),l=this.potentialMatchers.indexOf(e);if(l!=-1){if(this.potentialMatchers.splice(l,1),i.action.type=="none"){this.finalizeMatcherlessTrackers(s);return}if(i.matched)for(let r of s){let B=this.matchersForSource(r.source);this.potentialMatchers=this.potentialMatchers.filter(d=>!B.find(g=>d==g)),B.forEach(d=>{d.cancel()}),this._sourceSelector=this._sourceSelector.filter(d=>!s.find(g=>d==g)),r.matchPromise.resolve({matcher:e,result:i})}else{let r=a(B=>{if(this.sustainMode&&!B.sustainWhenNested){this.finalizeMatcherlessTrackers(s);return}let d=new Xn(B,e);if(d.result&&d.result.matched==!1){this.finalizeMatcherlessTrackers(s);return}d.promise.then(this.matcherSelectionFilter(d,s.map(g=>g.matchPromise))),this.potentialMatchers.push(d),this.resetSourceHooks()},"replacer");this.emit("rejectionwithaction",{matcher:e,result:i},r);return}}})}finalizeMatcherlessTrackers(e){let t=e.map(i=>({tracker:i,pendingCount:this.potentialMatchers.filter(c=>!!c.allSourceIds.find(s=>i.source.identifier==s)).length}));for(let i of t)i.pendingCount==0&&i.tracker.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}})}};a(Ot,"MatcherSelector");var Ds=A(R(),1);var oc=class{constructor(n){var i,c;let{matcher:e,result:t}=n;this.matchedId=e==null?void 0:e.model.id,this.linkType=t.action.type,this.item=t.action.item,this.sources=e==null?void 0:e.sources,(i=this.sources)==null||i.forEach(s=>s.disconnect()),(c=this.sources)==null||c.sort((s,l)=>(e==null?void 0:e.primaryPath)==s?-1:(e==null?void 0:e.primaryPath)==l?1:0),this.allSourceIds=(e==null?void 0:e.allSourceIds)||[]}};a(oc,"GestureStageReport");var hi=class extends Ds.default{constructor(e,t,i,c){super();this.markedComplete=!1;this.selectionHandler=a(e=>Z(this,null,function*(){var B,d,g,F,Q,y,u,I;let t=new oc(e);e.matcher&&this.stageReports.push(t);let i=(B=e.matcher)!=null?B:this.stageReports[this.stageReports.length-1],c=(d=i==null?void 0:i.sources.map(b=>b instanceof T?b.baseSource:b))!=null?d:[],s=e.result.action.type;if((s=="complete"||s=="none")&&(c.forEach(b=>{b.isPathComplete||b.terminate(s=="none")}),!e.result.matched)){this.markedComplete||(this.markedComplete=!0,this.emit("complete"));return}if(s=="complete"&&this.touchpointCoordinator&&this.pushedSelector){let U=((g=this.touchpointCoordinator)==null?void 0:g.sustainSelectorSubstack(this.pushedSelector)).map(x=>{let m=new L;return x.path.on("invalidated",()=>m.resolve()),x.path.on("complete",()=>m.resolve()),m.corePromise});U.length>0&&e.result.action.awaitNested&&(yield Promise.all(U),yield Me(0)),(F=this.touchpointCoordinator)==null||F.popSelector(this.pushedSelector),this.pushedSelector=null}this.emit("stage",t,b=>{b.type=="pop"?c.forEach(U=>U.popRecognizerConfig()):c.forEach(U=>U.pushRecognizerConfig(b.config))});let l=!1;this.touchpointCoordinator&&(l=!this.touchpointCoordinator.selectorStackIncludes(this.selector));let r=Dl(e.result.action,this.gestureConfig,this.baseGestureSetId);if(l&&(r=r.filter(b=>b.sustainWhenNested)),r.length>0){if(!(s=="chain"&&e.result.action.selectionMode==((Q=this.pushedSelector)==null?void 0:Q.baseGestureSetId))){if(this.pushedSelector&&(this.pushedSelector.off("rejectionwithaction",this.modelResetHandler),(y=this.touchpointCoordinator)==null||y.popSelector(this.pushedSelector),this.pushedSelector=null),s=="chain"){let x=e.result.action.selectionMode;if(x){let m=new Ot(x);m.on("rejectionwithaction",this.modelResetHandler),this.pushedSelector=m,(u=this.touchpointCoordinator)==null||u.pushSelector(m)}}}((I=this.pushedSelector)!=null?I:this.selector).matchGesture(e.matcher,r).then(x=>Z(this,null,function*(){return this.selectionHandler(yield x.selectionPromise)}))}else this.markedComplete||(this.markedComplete=!0,this.emit("complete"))}),"selectionHandler");this.modelResetHandler=a((e,t)=>{let i=e.matcher.allSourceIds;if(!this.allSourceIds.find(c=>i.indexOf(c)==-1))if(e.result.action.type=="replace")t(mn(this.gestureConfig,e.result.action.replace));else throw new Error("Missed a case in implementation!")},"modelResetHandler");this.stageReports=[],this.selector=i,this.selector.on("rejectionwithaction",this.modelResetHandler),this.once("complete",()=>{var s;this.pushedSelector&&((s=this.touchpointCoordinator)==null||s.popSelector(this.pushedSelector),this.pushedSelector=null),this.selector.off("rejectionwithaction",this.modelResetHandler),this.selector.dropSourcesWithIds(this.allSourceIds),this.selector=null}),this.gestureConfig=t,this.touchpointCoordinator=c,Promise.resolve().then(()=>this.selectionHandler(e))}get allSourceIds(){var e,t;return(t=(e=this.stageReports[this.stageReports.length-1])==null?void 0:e.allSourceIds)!=null?t:[]}get baseGestureSetId(){var e,t;return(t=(e=this.selector)==null?void 0:e.baseGestureSetId)!=null?t:null}get potentialModelMatchIds(){if(!this.selector)return[];let e=[this.selector];return this.pushedSelector&&e.push(this.pushedSelector),this.stageReports[this.stageReports.length-1].sources.map(s=>e.map(l=>l.potentialMatchersForSource(s).map(r=>r.model.id))).reduce((s,l)=>s.concat(l)).reduce((s,l)=>{for(let r of l)s.indexOf(r)==-1&&s.push(r);return s},[])}cancel(){this.stageReports[this.stageReports.length-1].sources.forEach(t=>t.baseSource.isPathComplete||t.baseSource.terminate(!0)),this.markedComplete||(this.markedComplete=!0,this.emit("complete"))}};a(hi,"GestureSequence");function Dl(o,n,e){switch(o.type){case"none":case"complete":return[];case"replace":return[mn(n,o.replace)];case"chain":return[mn(n,o.next)];default:throw new Error("Unexpected case arose within `processGestureAction` method")}}a(Dl,"modelSetForAction");var bi=class extends zs.default{constructor(e,t){super();this.selectorStack=[new Ot];this._activeSources=[];this._activeGestures=[];this.modelResetHandler=a((e,t)=>{let i=e.matcher.allSourceIds;if(!this.activeGestures.find(c=>c.allSourceIds.find(s=>i.indexOf(s)!=-1)))if(e.result.action.type=="replace")t(mn(this.gestureModelDefinitions,e.result.action.replace));else throw new Error("Missed a case in implementation!")},"modelResetHandler");this.onNewTrackedPath=a(e=>Z(this,null,function*(){this.addSimpleSourceHooks(e);let t=this.gestureModelDefinitions,i,c;do{i=this.currentSelector;let g=yield i.matchGesture(e,Ns(t,i.baseGestureSetId));if(g.sustainModeWithoutMatch){let F=a(Q=>{Q.stateToken=this.stateToken,Q.item=e.currentRecognizerConfig.itemIdentifier(Q,null)},"correctSample");e.path instanceof me&&e.path.coords.forEach(F),e.stateToken=this.stateToken,e.baseItem=e.path.stats.initialSample.item,F(e.path.stats.initialSample),F(e.path.stats.lastSample);continue}else{c=g.selectionPromise;break}}while(i!=this.currentSelector);let s=this.currentSelector;e.setGestureMatchInspector(this.buildGestureMatchInspector(s)),this.emit("inputstart",e);let l=yield c;if(!l||l.result.matched==!1)return;let r=l.matcher.allSourceIds;for(let d of this._activeGestures)if(d.allSourceIds.find(g=>!!r.find(F=>g==F)))return;let B=new hi(l,t,this.currentSelector,this);this._activeGestures.push(B),B.on("complete",()=>{let d=this._activeGestures.indexOf(B);d!=-1&&this._activeGestures.splice(d,1)}),this.emit("recognizedgesture",B)}),"onNewTrackedPath");if(this.gestureModelDefinitions=e,this.inputEngines=[],t)for(let i of t)this.addEngine(i);this.selectorStack[0].on("rejectionwithaction",this.modelResetHandler)}pushSelector(e){this.selectorStack.push(e),e.on("rejectionwithaction",this.modelResetHandler)}sustainSelectorSubstack(e){if(!e)return[];let t=this.selectorStack.indexOf(e);if(t==-1)return[];if(this.selectorStack.length<=1)throw new Error("May not force the original, base gesture selector into sustain mode.");let i=[];for(let c=t;c<this.selectorStack.length;c++)e=this.selectorStack[c],i=i.concat(e.cascadeTermination());return i}popSelector(e){if(!e)return;let t=this.selectorStack.indexOf(e);if(t!=-1){if(this.selectorStack.length<=1)throw new Error("May not pop the original, base gesture selector.");for(;t<this.selectorStack.length;)e=this.selectorStack[t],e.off("rejectionwithaction",this.modelResetHandler),this.selectorStack.splice(t,1);this.currentSelector.stateToken=this.stateToken}}selectorStackIncludes(e){return this.selectorStack.includes(e)}get currentSelector(){return this.selectorStack[this.selectorStack.length-1]}buildGestureMatchInspector(e){return t=>{let i=this.selectorStack.indexOf(e);return this.selectorStack.slice(i).map(s=>s.potentialMatchersForSource(t).map(l=>l.model.id)).reduce((s,l)=>s.concat(l))}}addEngine(e){e.on("pointstart",this.onNewTrackedPath),this.inputEngines.push(e)}get activeGestures(){return[].concat(this._activeGestures)}get activeSources(){return[].concat(this.inputEngines.map(e=>e.activeSources).reduce((e,t)=>e.concat(t),[]))}get stateToken(){return this._stateToken}set stateToken(e){this._stateToken=e,this.inputEngines.forEach(t=>t.stateToken=e),this.currentSelector.stateToken=e}addSimpleSourceHooks(e){e.path.on("invalidated",()=>{let t=this.activeGestures.find(c=>c.allSourceIds.includes(e.identifier));t&&t.cancel();let i=this._activeSources.indexOf(e);this._activeSources=this._activeSources.splice(i,1)}),e.path.on("complete",()=>{let t=this._activeSources.indexOf(e);this._activeSources=this._activeSources.splice(t,1)})}};a(bi,"TouchpointCoordinator");var Qt=class extends bi{constructor(e,t){let i=rc(t);e=e||Ts;super(e);this.config=i,this.mouseEngine=new ui(this.config),this.touchEngine=new Ii(this.config),this.mouseEngine.registerEventHandlers(),this.touchEngine.registerEventHandlers(),this.addEngine(this.mouseEngine),this.addEngine(this.touchEngine)}destroy(){this.activeGestures.forEach(e=>e.cancel()),this.activeSources.forEach(e=>e.terminate(!0)),this.mouseEngine.unregisterEventHandlers(),this.touchEngine.unregisterEventHandlers(),this.mouseEngine=null,this.touchEngine=null}};a(Qt,"GestureRecognizer");var zc=["n","ne","e","se","s","sw","w","nw"],Ks=Math.PI,Kc=(()=>{let o=new Map,n=Ks/4;for(let e=0;e<zc.length;e++)o.set(zc[e],[n*e,1]);return o})();function ac(o){return Math.PI/4*zc.indexOf(o)}a(ac,"lockedAngleForDir");function Ci(o,n){let e=ac(n),t=o.initialSample,i=o.lastSample.targetX-t.targetX,c=o.lastSample.targetY-t.targetY,s=Math.max(0,-c*Math.cos(e));return Math.max(0,i*Math.sin(e))+s}a(Ci,"calcLockedDistance");function zl(o,n,e,t){return i=>{let c=ac(n),s=t.flick.triggerDist-t.flick.dirLockDist,l=Math.max(0,Ci(o.path.stats,n)-t.flick.dirLockDist),B=Math.min(1,.7*l/s),d=Math.sin(c)*B,g=-Math.cos(c)*B;e==null||e.scrollFlickPreview(d,g)}}a(zl,"buildFlickScroller");var Bc=Math.PI/3,Vn=class{constructor(n,e,t,i,c,s){this.directlyEmitsKeys=!0;this.sequence=n,this.gestureParams=c,this.baseSpec=i.key.spec,this.baseKeyDistances=t.getSimpleTapCorrectionDistances(n.stageReports[0].sources[0].path.stats.initialSample,this.baseSpec);let l=n.stageReports[0].sources[0].baseSource,r=l;n.on("complete",()=>{s.cancel()}),this.sequence.on("stage",d=>{var y;let g=r.path.stats;this.computedFlickDistribution=this.flickDistribution(g,!0);let F=this.computedFlickDistribution[0].keySpec;if(d.matchedId=="flick-restart"){r.path.replaceInitialSample(d.sources[0].path.stats.initialSample);return}if(d.matchedId=="flick-reset-centering"){r=l.constructSubview(!0,!0);return}else if(d.matchedId=="flick-reset-end"){this.emitKey(t,this.baseSpec,r.path.stats);return}else if(d.matchedId=="flick-reset"){this.flickScroller&&(this.flickScroller(r.currentSample),r.path.off("step",this.flickScroller)),this.lockedDir=null,this.lockedSelectable=null,r instanceof T&&r.disconnect();return}else if(d.matchedId=="flick-mid"){if(F==this.baseSpec)return;let u=Object.keys(this.baseSpec.flick).find(I=>this.baseSpec.flick[I]==F);this.lockedDir=u,this.lockedSelectable=F,this.flickScroller&&r.path.off("step",this.flickScroller),this.flickScroller=zl(r,u,s,this.gestureParams),this.flickScroller(r.currentSample),r.path.on("step",this.flickScroller);return}let Q=(y=this.lockedSelectable)!=null?y:F;this.emitKey(t,Q,g)});let B=this.buildPopupRecognitionConfig(t);e({type:"push",config:B})}emitKey(n,e,t){let i;Ci(t,this.lockedDir)>this.gestureParams.flick.triggerDist?i=n.keyEventFromSpec(e):i=n.keyEventFromSpec(this.baseSpec),i.keyDistribution=this.currentStageKeyDistribution(this.baseKeyDistances),n.raiseKeyEvent(i,null)}buildPopupRecognitionConfig(n){let e={getBoundingClientRect(){let t=Number.MAX_SAFE_INTEGER;return new DOMRect(-t,-t,2*t,2*t)}};return X(C({},n.gestureEngine.config),{maxRoamingBounds:e,safeBounds:e})}cancel(){}flickDistribution(n,e){let t=this.baseSpec.flick,i=[{spec:this.baseSpec,coord:[NaN,0]}];i=i.concat(Object.keys(t).map(F=>({spec:t[F],coord:Kc.get(F)})));let c=n.angle,s=this.gestureParams.flick.triggerDist,r=Math.min(s,e?s:n.netDistance)/s,B=0,d=i.map(F=>{let Q=0,y=F.coord;if(!isNaN(y[0])){let U=c-y[0],x=2*Ks+y[0]-c;Q=Math.min(U*U,x*x)}let u=Bc*(y[1]-r),I=u*u,b=1/(Q+I+1e-6);return B+=b,{keySpec:F.spec,p:b}}),g=1/B;return d.forEach(F=>F.p*=g),d.sort((F,Q)=>Q.p-F.p)}currentStageKeyDistribution(n){let e=this.baseSpec,t=this.baseKeyDistances,i=this.computedFlickDistribution;if(!t.get(e))return[{keySpec:i[0].keySpec,p:1}];let s=i.findIndex(B=>B.keySpec==e),l=i.splice(s,1)[0].p,r=Bt(t);return i.concat(r.map(B=>({keySpec:B.keySpec,p:B.p*l})))}};a(Vn,"Flick");var dc=Xt.TouchLayoutKeySp;var Oc={longpress:{permitsFlick:()=>!0,flickDist:5,waitLength:500,noiseTolerance:10},multitap:{waitLength:500,holdLength:500},flick:{startDist:10,dirLockDist:25,triggerDist:40}};function Os(o){let n=o.getBoundingClientRect();return{clientX:n.left+n.width/2,clientY:n.top+n.height/2}}a(Os,"getKeyCentroid");function Ps(o){let n=Os(o);return e=>{let t=e.lastSample.clientX-n.clientX,i=e.lastSample.clientY-n.clientY;return Math.sqrt(t*t+i*i)}}a(Ps,"buildDistFromKeyCentroidFunctor");function xi(o){let n=o.key.spec,e=["K_SHIFT","K_ALT","K_CTRL","K_NUMERALS","K_SYMBOLS","K_CURRENCIES"];for(let t of e)if(n.id==t)return!0;if(n.nextlayer)switch(n.sp){case dc.special:case dc.specialActive:case dc.customSpecial:case dc.customSpecialActive:return!0;default:return!1}else return!1}a(xi,"keySupportsModipress");function Pc(o,n){let e=a((F,Q)=>{if(!F)return!1;let y=F.key.spec;switch(Q){case"modipress-start":return xi(F);case"special-key-start":return["K_LOPT","K_ROPT","K_BKSP"].indexOf(y.baseKeyID)!=-1;case"longpress":return!0;case"multitap-start":case"modipress-multitap-start":return o.hasMultitaps?!!y.multitap:!1;case"flick-start":return!!y.flick;default:return!0}},"gestureKeyFilter"),t=n.roamingEnabled||(n.roamingEnabled=!o.hasFlicks),i=Ie(t?dr(n):tl(n)),c=Ie(t?_c(n):nl(n)),s=Ie($s(n,!0,t));function l(F,Q){F=Ie(F);let y=F.id;return typeof Q=="number"&&(Q=[Q]),F.contacts.forEach((u,I)=>{var b;if(Q.indexOf(I)!=-1){let U=(b=u.model.allowsInitialState)!=null?b:()=>!0;u.model=X(C({},u.model),{allowsInitialState:(x,m,V)=>e(V,y)&&U(x,m,V)})}}),F}a(l,"withKeySpecFiltering");let r=$l(),B=Fr(),d=[l(s,0),l(ar(n),0),Br(n),i,c,l(r,0),er(n),gr(),l(B,0),Qr(n),ur(),yr(),l(Ir(n),0),Ur(n),hr()],g=[s.id,i.id,B.id,r.id];return t?(d.push(l(tr(n),0)),d.push(nr())):(d.push(l(el(n),0)),d.push(cr(n)),d.push(sr(n)),d.push(lr(n)),d.push(ir(n)),d.push(rr()),d.push(or(n)),g.push("flick-start")),{gestures:d,sets:{default:g,modipress:g.filter(F=>F!=B.id),none:[]}}}a(Pc,"gestureSetForLayout");function jc(){return{itemPriority:0,pathResolutionAction:"reject",pathModel:{evaluate:o=>"resolve"}}}a(jc,"instantContactRejectionModel");function Ke(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:o=>"resolve"}}}a(Ke,"instantContactResolutionModel");function Kl(o){return{itemPriority:1,pathModel:{evaluate:n=>n.stats.netDistance>o.flick.startDist?"resolve":null},pathResolutionAction:"resolve",pathInheritance:"partial"}}a(Kl,"flickStartContactModel");function js(o,n){let e=n.key.spec.flick,t=Object.keys(e),i,c=0;for(let s of t){let l=Ci(o,s);l>c&&(c=l,i=s)}return{dir:i,dist:c}}a(js,"determineLockFromStats");function Ol(o){return{itemPriority:1,pathModel:{evaluate:(n,e,t)=>{let{dir:i,dist:c}=js(n.stats,t);if(c>o.flick.dirLockDist){let s=n.stats.angle,l=ac(i),r=Math.abs(s-l),B=Math.abs(2*Math.PI+l-s);if(r<=Bc||B<=Bc)return"resolve"}else if(n.isComplete)return"reject"}},pathResolutionAction:"resolve",pathInheritance:"full"}}a(Ol,"flickMidContactModel");function Pl(o){return{itemPriority:1,pathModel:{evaluate:(n,e,t,i)=>{if(n.isComplete)return"resolve";{let{dir:c}=js(i,t);if(Ci(n.stats,c)<o.flick.dirLockDist)return"reject"}}},pathResolutionAction:"resolve",pathInheritance:"full"}}a(Pl,"flickEndContactModel");function jl(o,n,e){let t=o.longpress;return{itemPriority:0,pathResolutionAction:"resolve",timer:{duration:t.waitLength,expectedResult:!0,validateItem:i=>!!(i!=null&&i.key.spec.sk)},pathModel:{evaluate:i=>{var s;let c=i.stats;if(n&&t.permitsFlick(c.lastSample.item)&&((s=c.cardinalDirection)==null?void 0:s.indexOf("n"))!=-1){if(c.netDistance>t.flickDist)return"resolve"}else if(e){if(c.rawDistance>t.noiseTolerance||c.lastSample.item!=c.initialSample.item)return"reject"}else if(c.lastSample.item!=c.initialSample.item)return"reject";return i.isComplete?"reject":null}}}}a(jl,"longpressContactModel");function _s(){return{itemPriority:-1,pathResolutionAction:"resolve",pathModel:{evaluate:o=>"resolve"}}}a(_s,"modipressContactStartModel");function _l(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:o=>{if(o.isComplete)return"reject"}}}}a(_l,"modipressContactHoldModel");function qs(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:o=>{if(o.isComplete)return"resolve"}}}}a(qs,"modipressContactEndModel");function gc(o,n){var t;let e=(t=o==null?void 0:o.roamingEnabled)!=null?t:!0;return{itemPriority:0,itemChangeAction:e?"reject":void 0,pathResolutionAction:"resolve",pathInheritance:!e&&n?"full":"chop",pathModel:{evaluate:i=>{if(i.isComplete&&!i.wasCancelled)return"resolve"}}}}a(gc,"simpleTapContactModel");function ql(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:o=>{if(o.isComplete&&!o.wasCancelled)return"resolve"}}}}a(ql,"subkeySelectContactModel");function $l(){return{id:"special-key-start",resolutionPriority:0,contacts:[{model:C({},Ke()),endOnResolve:!1}],resolutionAction:{type:"chain",next:"special-key-end",item:"current"}}}a($l,"specialKeyStartModel");function er(o){return{id:"special-key-end",resolutionPriority:0,contacts:[{model:X(C({},gc(o)),{itemChangeAction:"resolve"}),endOnResolve:!0}],resolutionAction:{type:"complete",item:"none"}}}a(er,"specialKeyEndModel");function $s(o,n,e){let t={id:"longpress",resolutionPriority:0,contacts:[{model:X(C({},jl(o,n,e)),{itemPriority:1,pathInheritance:"chop"}),endOnResolve:!1},{model:jc()}],resolutionAction:{type:"chain",next:"subkey-select",selectionMode:"none",item:"none"}};return e?X(C({},t),{rejectionActions:{path:{type:"replace",replace:"longpress-roam"},timer:{type:"replace",replace:"longpress-roam-restore"}}}):t}a($s,"longpressModel");function tr(o){let n=$s(o,!1,!0);return X(C({},n),{id:"longpress-roam"})}a(tr,"longpressModelAfterRoaming");function nr(){return{id:"longpress-roam-restore",contacts:[{model:{pathModel:{evaluate:o=>null},itemChangeAction:"reject",pathInheritance:"full",pathResolutionAction:"reject",itemPriority:0}}],resolutionPriority:-1,rejectionActions:{item:{type:"replace",replace:"longpress-roam"}},resolutionAction:{type:"chain",next:"longpress-roam"}}}a(nr,"longpressRoamRestoration");function el(o){return{id:"flick-start",resolutionPriority:3,contacts:[{model:Kl(o)}],resolutionAction:{type:"chain",item:"none",next:"flick-mid"}}}a(el,"flickStartModel");function ir(o){let n=el(o);return X(C({},n),{contacts:[X(C({},n.contacts[0]),{model:X(C({},n.contacts[0].model),{baseCoordReplacer:(e,t)=>{let i=Os(t),c=Ps(t),s=e.initialSample,l=c(e);if(l>o.flick.triggerDist)return i;let r=o.flick.dirLockDist;if(l<r)return s;let B=r/l,d=s.clientX-i.clientX,g=s.clientY-i.clientY;return{clientX:i.clientX+d*B,clientY:i.clientY+g*B}}})})],id:"flick-restart",sustainWhenNested:!0,rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}}})}a(ir,"flickRestartModel");function cr(o){return{id:"flick-mid",resolutionPriority:0,contacts:[{model:Ol(o),endOnReject:!0},{model:jc(),resetOnResolve:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}},resolutionAction:{type:"chain",item:"none",next:"flick-end"},sustainWhenNested:!0}}a(cr,"flickMidModel");function sr(o){return{id:"flick-reset",resolutionPriority:1,contacts:[{model:X(C({},Ke()),{pathInheritance:"partial"})}],resolutionAction:{type:"chain",next:"flick-reset-centering"},sustainWhenNested:!0}}a(sr,"flickResetModel");function lr(o){return{id:"flick-reset-centering",resolutionPriority:1,contacts:[{model:{pathModel:{evaluate(n,e,t){e||(e=n.stats);let i=Ps(t),c=i(n.stats);if(i(e)<c)return"resolve"}},itemPriority:0,pathResolutionAction:"resolve",pathInheritance:"full"}}],resolutionAction:{type:"chain",next:"flick-restart"},sustainWhenNested:!0}}a(lr,"flickResetCenteringModel");function rr(){return{id:"flick-reset-end",resolutionPriority:1,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"complete",item:"base"},sustainWhenNested:!0}}a(rr,"flickResetEndModel");function or(o){return{id:"flick-end",resolutionPriority:0,contacts:[{model:Pl(o)},{model:Ke(),resetOnResolve:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset"}},resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}a(or,"flickEndModel");function ar(o){return{id:"multitap-start",resolutionPriority:2,contacts:[{model:X(C({},Ke()),{itemPriority:1,pathInheritance:"reject",allowsInitialState(n,e,t){return n.item==t}})}],sustainTimer:{duration:o.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"multitap-end",item:"current"}}}a(ar,"multitapStartModel");function Br(o){return{id:"multitap-end",resolutionPriority:2,contacts:[{model:X(C({},gc(o)),{itemPriority:1,timer:{duration:o.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Ke(),resetOnResolve:!0}],rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"none"}}}a(Br,"multitapEndModel");function tl(o){return{id:"initial-tap",resolutionPriority:1,contacts:[{model:X(C({},gc(o)),{pathInheritance:"chop",itemPriority:1,timer:{duration:o.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Ke(),resetOnResolve:!0}],sustainWhenNested:!0,rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"base"}}}a(tl,"initialTapModel");function nl(o){return{id:"simple-tap",resolutionPriority:1,contacts:[{model:X(C({},gc(o,!0)),{itemPriority:1}),endOnResolve:!0},{model:Ke(),resetOnResolve:!0}],sustainWhenNested:!0,resolutionAction:{type:"complete",item:"base"}}}a(nl,"simpleTapModel");function dr(o){let n=tl(o);return X(C({},n),{rejectionActions:X(C({},n.rejectionActions),{item:{type:"replace",replace:"initial-tap"}})})}a(dr,"initialTapModelWithReset");function _c(o){let n=nl(o);return X(C({},n),{rejectionActions:X(C({},n.rejectionActions),{item:{type:"replace",replace:"simple-tap"}})})}a(_c,"simpleTapModelWithReset");function gr(){return{id:"subkey-select",resolutionPriority:0,contacts:[{model:X(C({},ql()),{pathInheritance:"full",itemPriority:1}),endOnResolve:!0,endOnReject:!0}],resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}a(gr,"subkeySelectModel");function Fr(){return{id:"modipress-start",resolutionPriority:5,contacts:[{model:X(C({},_s()),{allowsInitialState(o,n,e){return xi(e)},itemChangeAction:"reject",itemPriority:1})}],resolutionAction:{type:"chain",next:"modipress-hold",selectionMode:"modipress",item:"current"}}}a(Fr,"modipressStartModel");function Qr(o){return{id:"modipress-hold",resolutionPriority:5,contacts:[{model:X(C({},_l()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:o.multitap.holdLength,expectedResult:!0,inheritElapsed:!0}})},{model:C({},Ke()),resetOnResolve:!0}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"},rejectionActions:{path:{type:"replace",replace:"modipress-end-multitap-transition"}}}}a(Qr,"modipressHoldModel");function yr(){return{id:"modipress-end-multitap-transition",resolutionPriority:5,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"}}}a(yr,"modipressMultitapTransitionModel");function ur(){return{id:"modipress-end",resolutionPriority:5,contacts:[{model:X(C({},qs()),{itemChangeAction:"reject",pathInheritance:"full"})}],resolutionAction:{type:"complete",item:"none",awaitNested:!0}}}a(ur,"modipressEndModel");function Ir(o){return{id:"modipress-multitap-start",resolutionPriority:6,contacts:[{model:X(C({},_s()),{pathInheritance:"reject",allowsInitialState(n,e,t){return n.item!=t?!1:xi(t)},itemChangeAction:"reject",itemPriority:1})}],sustainTimer:{duration:o.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"modipress-multitap-end",selectionMode:"modipress",item:"current"}}}a(Ir,"modipressMultitapStartModel");function Ur(o){return{id:"modipress-multitap-end",resolutionPriority:5,contacts:[{model:X(C({},qs()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:o.multitap.holdLength,expectedResult:!1}})},{model:C({},jc()),resetOnResolve:!0}],resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"},rejectionActions:{timer:{type:"replace",replace:"modipress-multitap-lock-transition"},path:{type:"replace",replace:"modipress-multitap-lock-transition"}}}}a(Ur,"modipressMultitapEndModel");function hr(){return{id:"modipress-multitap-lock-transition",resolutionPriority:5,contacts:[{model:X(C({},Ke()),{pathResolutionAction:"resolve"})}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"}}}a(hr,"modipressMultitapLockModel");var il=X(C({},Ie(_c(null))),{resolutionAction:{type:"complete",item:"current"}}),cl={gestures:[il],sets:{default:[il.id]}};var sl=A(R(),1);var qc=class{constructor(n,e){this.rtl=!1;this.index=n,this.rtl=e,this.constructRoot();let t=this.display=v("span");this.div.appendChild(t)}constructRoot(){let n=this.div=v("div"),e=n.style;n.className="kmw-suggest-option",n.id=qc.BASE_ID+this.index;let i=(100-ee.MARGIN*(ee.SUGGESTION_LIMIT-1))/ee.SUGGESTION_LIMIT;e.width=i+"%",this.div.suggestion=this}matchKeyboardProperties(n){let e=this.div;if(n){n.KLC&&(e.lang=n.KLC);let t=n.KFont;t&&t.family&&t.family!=""&&(e.style.fontFamily=this.fontFamily=t.family)}}get suggestion(){return this._suggestion}update(n){this._suggestion=n,this.updateText()}updateText(){let n=this.generateSuggestionText(this.rtl);this.div.replaceChild(n,this.display),this.display=n}highlight(n){let e=this.div,t=e.className,i=" "+ee.TOUCHED_CLASS;n&&t.indexOf(i)<0?e.className=t+i:e.className=t.replace(i,"")}isEmpty(){return!this._suggestion}generateSuggestionText(n){let e=this._suggestion;var t,i=v("span");if(i.className="kmw-suggestion-text",e==null)return i;if(e.displayAs==null||e.displayAs=="")t="\xA0";else{let c=n?8238:8237;t=String.fromCharCode(c)+e.displayAs}return i.innerHTML=t,i}},mi=qc;a(mi,"BannerSuggestion"),mi.BASE_ID="kmw-suggestion-";var Oe=class extends D{constructor(e,t){super(t||D.DEFAULT_HEIGHT);this.type="suggestion";this.currentSuggestions=[];this.options=[];this.onSuggestionUpdate=a(e=>{this.currentSuggestions=e,this.options.forEach((t,i)=>{i<e.length?t.update(e[i]):t.update(null)})},"onSuggestionUpdate");this.hostDevice=e,this.getDiv().className=this.getDiv().className+" "+Oe.BANNER_CLASS,this.buildInternals(!1),this.events=new sl.default,this.gestureEngine=this.setupInputHandling()}buildInternals(e){this.options.length>0&&this.options.splice(0,this.options.length);for(var t=0;t<Oe.SUGGESTION_LIMIT;t++){let i=new mi(t,e);this.options[t]=i}for(var t=0;t<Oe.SUGGESTION_LIMIT;t++){let c=e?Oe.SUGGESTION_LIMIT-t-1:t;if(this.getDiv().appendChild(this.options[c].div),t!=Oe.SUGGESTION_LIMIT){let s=v("div");s.className="kmw-banner-separator";let l=s.style;l.marginLeft=Oe.MARGIN/2+"%",l.marginRight=Oe.MARGIN/2+"%",this.getDiv().appendChild(s)}}}setupInputHandling(){let e=a(s=>{try{if(s){if(s.classList.contains("kmw-suggest-option"))return s;if(s.parentElement&&s.parentElement.classList.contains("kmw-suggest-option"))return s.parentElement}}catch(l){}return null},"findTargetFrom"),t={targetRoot:this.getDiv(),maxRoamingBounds:new he(this.getDiv(),[-.333*this.height]),itemIdentifier:(s,l)=>{let r=null,B=Number.MAX_VALUE;for(let d of this.options){let g=d.div.getBoundingClientRect();if(g.left<=s.clientX&&s.clientX<g.right)return d;{let F=(s.clientX<g.left?-1:1)*(s.clientX-g.left);F<B&&(B=F,r=d)}}return r}},i=new Qt(cl,t),c={source:null,roamingHighlightHandler:null,suggestion:null};return i.on("inputstart",s=>{if(c.source){s.terminate(!0);return}c.source=s,c.roamingHighlightHandler=r=>{let B=r.item;B!=c.suggestion&&(c.suggestion.highlight(!1),B.highlight(!0),c.suggestion=B)},c.suggestion=s.currentSample.item,s.currentSample.item.highlight(!0);let l=a(()=>{c.suggestion.highlight(!1),c.source=null,c.roamingHighlightHandler=null,c.suggestion=null},"terminationHandler");s.path.on("complete",l),s.path.on("invalidated",l),s.path.on("step",c.roamingHighlightHandler)}),i.on("recognizedgesture",s=>{s.once("stage",l=>{let r=l.item;r&&this.predictionContext.accept(r.suggestion)})}),i}update(){var t,i;let e=super.update();return(i=(t=this.gestureEngine)==null?void 0:t.config.maxRoamingBounds)==null||i.updatePadding([-.333*this.height]),e}configureForKeyboard(e,t){let i=e.isRTL;this.getDiv().textContent="",this.buildInternals(i),this.options.forEach(c=>c.matchKeyboardProperties(t)),this.onSuggestionUpdate(this.currentSuggestions)}get predictionContext(){return this._predictionContext}set predictionContext(e){this._predictionContext&&this._predictionContext.off("update",this.onSuggestionUpdate),this._predictionContext=e,e&&(e.on("update",this.onSuggestionUpdate),this.onSuggestionUpdate(e.currentSuggestions))}},ee=Oe;a(ee,"SuggestionBanner"),ee.SUGGESTION_LIMIT=3,ee.MARGIN=1,ee.TOUCHED_CLASS="kmw-suggest-touched",ee.BANNER_CLASS="kmw-suggest-banner";var Gi=class extends D{constructor(e){super();this.type="html";let t=this.getDiv(),i=document.createElement("div");i.style.userSelect="none",i.style.height="100%",i.style.width="100%",t.appendChild(i),this.container=i.attachShadow?i.attachShadow({mode:"closed"}):i,this.container.innerHTML=e}get innerHTML(){return this.container.innerHTML}set innerHTML(e){this.container.innerHTML=e}};a(Gi,"HTMLBanner");var Ln=class{constructor(n,e,t){this.ImageBanner=Qi;this.HTMLBanner=Gi;this.hostDevice=e,this.container=n,this.predictionContext=t,this.inactiveBanner=new De}get inactiveBanner(){return this._inactiveBanner}set inactiveBanner(n){this._inactiveBanner=n!=null?n:new De,this.container.banner instanceof ee||(this.container.banner=this._inactiveBanner)}activateBanner(n){let e,t=this.container.banner;if(t instanceof ee&&(t.predictionContext=null),!n)this.container.banner=this.inactiveBanner;else{let i=e=new ee(this.hostDevice,this.container.activeBannerHeight);i.predictionContext=this.predictionContext,i.events.on("apply",c=>this.predictionContext.accept(c.suggestion)),this.container.banner=i}}selectBanner(n){this.activateBanner(n=="active"||n=="configured")}shutdown(){this.container.banner instanceof ee&&(this.container.banner.predictionContext=null)}};a(Ln,"BannerController");var yt=class{constructor(){let n=this.element=document.createElement("div");n.style.userSelect="none",n.className="kmw-osk-none"}postInsert(){}updateState(){}refreshLayout(){}get layoutHeight(){return p.inPixels(0)}};a(yt,"EmptyView");var Fc=class{constructor(n){this.kbd=n;var e=this.element=document.createElement("div");e.style.userSelect="none",e.className="kmw-osk-static",e.id=Fc.ID,e.innerHTML=n.helpText}postInsert(){if(!this.element.parentElement||!document.getElementById(Fc.ID))throw new Error("The HelpPage root element has not yet been inserted into the DOM.");this.kbd.hasScript&&this.kbd.embedScript(this.element.parentElement)}updateState(){}refreshLayout(){}get layoutHeight(){return p.inPercent(100)}},Pt=Fc;a(Pt,"HelpPageView"),Pt.ID="kmw-osk-help-page";var Fl=A(R(),1);function Zn(o){var n;return typeof o=="string"?n=o:(n=o.style.fontSize,n||(n=getComputedStyle(o).fontSize)),new p(n)}a(Zn,"getFontSizeStyle");function ll(o,n,e){if(o.touchable){let t=o.formFactor=="phone"?1.6*(e?.65:.6)*1.2:2;return p.special(t,"em")}else return n?p.inPixels(n/8):void 0}a(ll,"defaultFontSize");var br={"*Shift*":8,"*Enter*":5,"*Tab*":6,"*BkSp*":4,"*Menu*":11,"*Hide*":10,"*Alt*":25,"*Ctrl*":1,"*Caps*":3,"*ABC*":16,"*abc*":17,"*123*":19,"*Symbol*":21,"*Currency*":20,"*Shifted*":9,"*AltGr*":2,"*TabLeft*":7,"*LAlt*":86,"*RAlt*":87,"*LCtrl*":88,"*RCtrl*":89,"*LAltCtrl*":96,"*RAltCtrl*":97,"*LAltCtrlShift*":98,"*RAltCtrlShift*":99,"*AltShift*":100,"*CtrlShift*":101,"*AltCtrlShift*":102,"*LAltShift*":103,"*RAltShift*":104,"*LCtrlShift*":105,"*RCtrlShift*":112,"*LTREnter*":5,"*LTRBkSp*":4,"*RTLEnter*":113,"*RTLBkSp*":114,"*ShiftLock*":115,"*ShiftedLock*":116,"*ZWNJ*":117,"*ZWNJiOS*":117,"*ZWNJAndroid*":118,"*ZWNJGeneric*":121,"*Sp*":128,"*NBSp*":130,"*NarNBSp*":131,"*EnQ*":132,"*EmQ*":133,"*EnSp*":134,"*EmSp*":135,"*PunctSp*":140,"*ThSp*":141,"*HSp*":142,"*ZWSp*":129,"*ZWJ*":119,"*WJ*":120,"*CGJ*":122,"*LTRM*":144,"*RTLM*":145,"*SH*":161,"*HTab*":162},Qc=br;var Cr=["default","shift","shift-on","special","special-on","","","","deadkey","blank","hidden"],jt=Cr;function _t(o,n){switch(o){case"*ZWNJ*":o=n.device.OS==G.OperatingSystem.Android?"*ZWNJAndroid*":"*ZWNJiOS*";break;case"*Enter*":o=n.isRTL?"*RTLEnter*":"*LTREnter*";break;case"*BkSp*":o=n.isRTL?"*RTLBkSp*":"*LTRBkSp*";break;default:}let e=57344+Qc[o];return Qc[o]?String.fromCharCode(e):o}a(_t,"renameSpecialKey");var Pe=class{constructor(n,e){this.spec=n,this.layer=e}setButtonClass(){var i;let n=this.spec,e=this.btn;var t=0;typeof n.dk=="string"&&n.dk=="1"&&(t=8),t=(i=n.sp)!=null?i:t,(t<0||t>10)&&(t=0),e.className="kmw-key kmw-key-"+jt[t]}setToggleState(n){let e;switch(e=this.spec.sp,jt[e]){case"shift":case"shift-on":n===void 0&&(n=jt[e]=="shift"),this.spec.sp=1+(n?1:0);break;case"special":case"special-on":n===void 0&&(n=jt[e]=="special"),this.spec.sp=3+(n?1:0);break;default:return}this.setButtonClass()}isFrameKey(){let n=this.spec.sp||0;switch(jt[n]){case"default":case"deadkey":return!1;default:return!0}}allowsKeyTip(){return this.isFrameKey()?!1:!this.btn.classList.contains("kmw-spacebar")}highlight(n){var e=this.btn.classList;n?e.contains(Pe.HIGHLIGHT_CLASS)||e.add(Pe.HIGHLIGHT_CLASS):e.remove(Pe.HIGHLIGHT_CLASS)}static getTextMetrics(n,e,t){t={fontFamily:t.fontFamily,fontSize:t.fontSize},t.fontFamily||(t.fontFamily=getComputedStyle(document.body).fontFamily),(!t.fontSize||t.fontSize=="")&&(t.fontSize="1em");let i=t.fontFamily,c=Zn(t.fontSize);var s;c.absolute?s=c.val+"px":s=c.val*e+"px";var l=Pe.getTextMetrics.canvas||(Pe.getTextMetrics.canvas=document.createElement("canvas")),r=l.getContext("2d");r.font=s+" "+i;var B=r.measureText(n);return B}getIdealFontSize(n,e,t,i){let c=getComputedStyle(this.btn),s=parseFloat(c.width),l=1,r=Zn(t.fontSize||"1em");c.fontSize?i||(t=c):(l=n.getKeyEmFontSize(),s=this.getKeyWidth(n));let B=Zn(t.fontSize||"1em"),d=Pe.getTextMetrics(e,l,t),g=.9,F=.9,Q=2;var y,u;d.fontBoundingBoxAscent&&(y=d.fontBoundingBoxAscent+d.fontBoundingBoxDescent);let I=y!=null?y:0;t.height&&t.height.indexOf("px")!=-1&&(u=Number.parseFloat(t.height.substring(0,t.height.indexOf("px"))));let b=s*g/(d.width+Q),U=I&&u?u*F/I:void 0;var x=b;return U&&U<b&&(x=U),x<1?r.absolute?x*B.val+"px":x*r.val+"em":r.absolute?B.val+"px":r.val+"em"}getKeyWidth(n){return this.spec.proportionalWidth*n.width}get keyText(){let n=this.spec,e="\xA0",t=null;return n.text==null||n.text==""?t=e:(t=n.text,t=="*Tab*"&&this.layer=="shift"&&(t="*TabLeft*")),t}generateKeyText(n){let e=this.spec,t=document.createElement("span"),i=t.style;t.className="kmw-key-text";let c=this.keyText,s=_t(c,n);s!=c&&(c=s,e.font="SpecialOSK"),typeof e.font=="string"&&e.font!=""&&(i.fontFamily=e.font),typeof e.fontsize=="string"&&e.fontsize!=""&&(i.fontSize=e.fontsize);let l={fontSize:i.fontSize};i.fontFamily?l.fontFamily=i.fontFamily:l.fontFamily=n.fontFamily;let r=n.getKeyEmFontSize();var B=Pe.getTextMetrics(c,r,l).width;return B==0&&c!=""&&c!="\xA0"&&n.isRTL&&(c="\u200F"+c),i.fontSize=this.getIdealFontSize(n,c,l),t.innerText=c,t}refreshLayout(n){if(this.label)if(!this.label.classList.contains("kmw-spacebar-caption"))this.label.style.fontSize=this.getIdealFontSize(n,this.keyText,this.btn.style);else{this.label.style.fontSize="";let e=this.getIdealFontSize(n,this.label.textContent,getComputedStyle(this.label),!0);this.label.style.setProperty("font-size",e,"important")}}},oe=Pe;a(oe,"OSKKey"),oe.specialCharacters=Qc,oe.BUTTON_CLASSES=jt,oe.HIGHLIGHT_CLASS="kmw-key-touched";var qt=class{constructor(n,e){this.key=n,this.keyId=e}};a(qt,"KeyData");function yc(o,n){let e=o;for(let t in n)e.hasOwnProperty(t)||(e[t]=n[t]);return e}a(yc,"link");function xr(o){return o&&"key"in o&&o.key instanceof oe}a(xr,"isKey");function uc(o){return xr(o)?o:null}a(uc,"getKeyFrom");var Sn=class extends oe{constructor(e,t,i){super(e,t);this.row=i}getId(){return this.spec.elementID}getCoreId(){return this.spec.coreID}getBaseId(){return this.spec.baseKeyID}generateKeyCapLabel(){var e=h.keyCodes[this.spec.baseKeyID];switch(e){case 186:e=59;break;case 187:e=61;break;case 188:e=44;break;case 189:e=45;break;case 190:e=46;break;case 191:e=47;break;case 192:e=96;break;case 219:e=91;break;case 220:e=92;break;case 221:e=93;break;case 222:e=39;break;default:(e<48||e>90)&&(e=0)}let t=document.createElement("div");return t.className="kmw-key-label",e>0&&(t.innerText=String.fromCharCode(e)),t}processSubkeys(e,t){var i,c=e.subKeys=this.spec.sk;for(i=0;i<c.length;i++){if(c[i].sp==1||c[i].sp==2){var s=c[i].text;c[i].text=_t(s,t)}c[i].layer||(c[i].layer=e.key.layer)}}construct(e){let t=this.spec,i=document.createElement("div");i.className="kmw-key-square";let c=document.createElement("div"),s=this.btn=yc(c,new qt(this,t.id));this.setButtonClass();let l=this.capLabel=this.generateKeyCapLabel();s.appendChild(l),s.id=this.getId(),s.appendChild(this.label=this.generateKeyText(e)),typeof t.sk!="undefined"&&t.sk!=null?this.processSubkeys(s,e):s.subKeys=null;let r=this.generateHint(e);return s.appendChild(r),i.appendChild(s),this.preview=document.createElement("div"),this.preview.style.display="none",s.appendChild(this.preview),this.square=i}generateHint(e){let t=document.createElement("div");t.className="kmw-key-popup-icon";let i=this.spec.hintSrc;if(!i)return t;if(i.font&&i.font!="SpecialOSK"?t.style.fontFamily=i.font:t.classList.add("kmw-key-text"),i.fontsize){let l=new p(i.fontsize);t.style.fontSize=l.scaledBy(.5).styleString}let c=i==this.spec?this.spec.hint:i.text,s=_t(c,e);return s=="\u2022"&&(t.style.fontWeight="bold"),c!=s&&(t.style.fontFamily="SpecialOSK"),t.textContent=s,t}setPreview(e){let t=this.preview;e?(this.previewHost=e,this.preview=this.previewHost.element):(this.previewHost=null,this.preview=document.createElement("div"),this.preview.style.display="none"),e==null||e.setCancellationHandler(()=>{this.setPreview(null)}),this.btn.replaceChild(this.preview,t)}refreshLayout(e){let t=this.spec;this.square.style.width=e.layoutWidth.scaledBy(t.proportionalWidth).styleString,this.square.style.marginLeft=e.layoutWidth.scaledBy(t.proportionalPad).styleString,this.btn.style.width=e.usesFixedWidthScaling?this.square.style.width:"100%",e.usesFixedHeightScaling?this.square.style.height=e.internalHeight.scaledBy(this.row.heightFraction).styleString:this.square.style.height="100%",super.refreshLayout(e);let i=e.device;i.OS==G.OperatingSystem.iOS&&i.formFactor==G.FormFactor.Phone&&ge()&&this.capLabel&&(this.capLabel.style.fontSize="6px")}get displaysKeyCap(){return this.capLabel&&this.capLabel.style.display=="block"}set displaysKeyCap(e){if(!this.capLabel)throw new Error("Key element not yet constructed; cannot display key cap");this.capLabel.style.display=e?"block":"none"}};a(Sn,"OSKBaseKey");var Jn=class{constructor(n,e,t){let i=this.element=document.createElement("div");i.className="kmw-key-row",this.heightFraction=1/e.row.length;let c=t.key;this.keys=[];for(let r=0;r<c.length;r++){let B=c[r];var s=new Sn(B,e.id,this),l=s.construct(n);this.keys.push(s),i.appendChild(l)}}get displaysKeyCaps(){if(this.keys.length>0)return this.keys[0].displaysKeyCap}set displaysKeyCaps(n){for(let e of this.keys)e.displaysKeyCap=n}refreshLayout(n){let e=this.element.style,t=n.internalHeight.scaledBy(this.heightFraction);e.maxHeight=e.lineHeight=e.height=t.styleString;let i=.15,c=n.usesFixedHeightScaling?t:p.forScalar(1),s=c.scaledBy(i/2),l=c.scaledBy(1-i);for(let r of this.keys){let B=r.btn.parentElement,d=r.btn,g=B.style;g.height=g.minHeight=c.styleString;let F=d.style;F.top=s.styleString,F.height=F.lineHeight=F.minHeight=l.styleString,d.key&&d.key.refreshLayout(n)}}};a(Jn,"OSKRow");var Rn=class{get rowHeight(){return this._rowHeight}get id(){return this.spec.id}constructor(n,e,t){this.spec=t;let i=this.element=document.createElement("div"),c=i.style;i.className="kmw-key-layer";var s=t.row.length;s>4&&n.device.formFactor=="phone"&&(i.className=i.className+" kmw-5rows"),c.fontFamily="font"in e?e.font:"",this.nextlayer=i.layer=t.id,typeof t.nextlayer=="string"&&(i.nextLayer=this.nextlayer=t.nextlayer);let l=t.row;this.rows=[];for(let r=0;r<l.length;r++){let B=new Jn(n,t,l[r]);B.displaysKeyCaps=e.displayUnderlying,i.appendChild(B.element),this.rows.push(B)}n.device.touchable&&(this.globeKey=this.findKey("K_LOPT"),this.hideKey=this.findKey("K_ROPT")),this.spaceBarKey=this.findKey("K_SPACE"),this.capsKey=this.findKey("K_CAPS"),this.numKey=this.findKey("K_NUMLOCK"),this.scrollKey=this.findKey("K_SCROLL")}findKey(n){for(let e of this.rows)for(let t of e.keys)if(t.getBaseId()==n)return t;return null}refreshLayout(n,e){let t=this.rows.length,i=this._rowHeight=Math.floor(e/(t==0?1:t));n.usesFixedHeightScaling&&(this.element.style.height=e+"px");for(let c=0;c<t;c++){let s=this.rows[c],l=(t-c-1)*i+1;n.usesFixedHeightScaling&&(this.spec.row[c].proportionalY=(e-l-i/2)/e,c==t-1&&(s.element.style.bottom="1px")),s.refreshLayout(n)}}};a(Rn,"OSKLayer");var An=class{constructor(n,e,t){this.layers={};this._activeLayerId="default";let i=e.layout(t);this.spec=i;let c=this.element=document.createElement("div"),s=c.style;if(c.className="kmw-key-layer-group",i==null)return;let l=i.fontsize;typeof l=="undefined"||l==null||l==""?s.fontSize="1em":s.fontSize=i.fontsize,s.width="100%",s.height="100%";var r,B,d,g;g=i.layer;var F=n.getDefaultKeyObject();for(F.fontsize=s.fontSize,r=0;r<g.length;r++){let Q=g[r],y=new Rn(n,i,Q);this.layers[Q.id]=y,y.element.style.display=Q.id=="default"?"block":"none",c.appendChild(y.element)}}get activeLayerId(){return this._activeLayerId}set activeLayerId(n){this._activeLayerId=n;for(let e of Object.keys(this.layers)){let t=this.layers[e],i=t.element;t.id==n?i.style.display="block":i.style.display="none"}}findNearestKey(n){if(!n)return null;let e=n.stateToken;if(!e)throw new Error("Layer id not set for input coordinate");let t=this.layers[e];if(!t)throw new Error(`Layer id ${e} could not be found`);return this.blinkLayer(t),this.nearestKey(n,t)}blinkLayer(n){if(typeof n=="string"){let t=n;if(n=this.layers[t],!n)throw new Error(`Layer id ${t} could not be found`)}let e=n;if(e.element.style.display!="block")for(let t in this.layers){if(this.layers[t].element.style.display=="block"){let i=this.layers[t];i.element.style.display="none"}this.layers[t].element.style.display="none"}e.element.style.display="block",Promise.resolve().then(()=>{let t=this.layers[this._activeLayerId];(e.element.style.display=="block"||t.element.style.display!="block")&&(e.element.style.display="none",t.element.style.display="block")})}nearestKey(n,e){let t=this.element.getBoundingClientRect(),i=null,c=Number.MAX_VALUE;for(let g of e.rows){let F=g.element.getBoundingClientRect();if(F.top<=n.clientY&&n.clientY<F.bottom){i=g;break}else{let Q=F.top>n.clientY?F.top-n.clientY:n.clientY-F.bottom;Q<c&&(c=Q,i=g)}}let s=0,l,r=24,B=1e5,d=n.clientX;for(let g=0;g<i.keys.length;g++){let F=i.keys[g].square,Q=F.getBoundingClientRect(),y=F.firstChild?F.firstChild:F;if(y.className!==void 0&&(y.className.indexOf("key-hidden")>=0||y.className.indexOf("key-blank")>=0))continue;let u=Q.left,I=Q.right;if(d>=u&&d<=I)return y;l=u-d,l>=0&&l<B&&(s=g,B=l),l=d-I,l>=0&&l<B&&(s=g,B=l)}if(B<1e5){let g=i.keys[s].square,F=g.getBoundingClientRect(),Q=F.left,y=F.right;if(F.width>40&&(r=.6*F.width),Q-d>=0&&Q-d<r||d-y>=0&&d-y<r)return g.firstChild}return null}};a(An,"OSKLayerGroup");var rl="kmw-",ol="top",Hn=class{constructor(n,e){this.state=!1;this.orientation=ol;this.vkbd=n;let t=this.element=document.createElement("div");t.className="kmw-keytip",t.id="kmw-keytip",t.style.pointerEvents="none",t.style.display="none",t.appendChild(this.tip=document.createElement("div")),t.appendChild(this.cap=document.createElement("div")),this.tip.appendChild(this.preview=document.createElement("div")),this.tip.className="kmw-keytip-tip",this.cap.className="kmw-keytip-cap",this.constrain=e,this.reorient=i=>{this.orientation=i,this.show(this.key,this.state,this.previewHost)}}show(n,e,t){var l;let i=this.vkbd;if(e&&i.layerGroup.blinkLayer(n.key.spec.displayLayer),e&&n.offsetParent){let r=n.key.row.element,B=n.getClientRects()[0],d=r.getClientRects()[0],g=B.left-d.left,F=B.width,Q=B.height,y=n.key.label,u=1.8,I=this.element.style,U=i.topContainer.getBoundingClientRect(),x=n.getBoundingClientRect(),m,V=this.orientation,J=x.bottom-U.top;m=J+(V=="top"?1:-1);let W=m-Math.floor(m),Xe=F+Math.ceil(F*.3)*2,ae=Math.ceil(2.3*Q)+W;I.top="auto";let ye=V=="top"?"bottom":"top";this.tip.classList.remove(`${rl}${ye}`),this.tip.classList.add(`${rl}${V}`),V=="bottom"&&(m+=ae-Q),I.bottom=Math.floor(U.height-m)+"px",I.textAlign="center",I.overflow="visible",I.width=Xe+"px",I.height=ae+"px";let Kn=this.vkbd.currentLayer.element.style.fontFamily,dn=getComputedStyle(i.element);I.fontFamily=n.key.spec.font||Kn||dn.fontFamily;var c=parseInt(dn.fontSize,10);if(c==Number.NaN&&(c=0),c!=0){let Te=u*c,mt={fontFamily:I.fontFamily,fontSize:Te+"px",height:1.6*Q+"px"};I.fontSize=n.key.getIdealFontSize(i,n.key.keyText,mt,!0)}var s=(Xe-F)/2;g<s?(this.cap.style.left="1px",g+=s-1):g>window.innerWidth-F-s?(this.cap.style.left=Xe-F-1+"px",g-=s-1):this.cap.style.left=s+"px",I.left=g-s+"px";let xt=getComputedStyle(this.element),On=U.height,ue=parseFloat(xt.bottom),Ne=parseFloat(xt.height),Pn=Math.ceil(ae/2);this.cap.style.width=F+"px",this.tip.style.height=Pn+"px";let Xc=3,jn=Pn-Xc+"px";V=="top"?(this.cap.style.top=jn,this.cap.style.bottom=""):(this.cap.style.top="",this.cap.style.bottom=jn);let _n=J-Math.floor(m)+ae-(V=="top"?Pn:-Xc*2);if(this.cap.style.height=_n+"px",this.constrain&&Ne+ue>On){let Te=Ne+ue-On;I.height=ae-Te+"px";let mt=Math.max(0,ae-Te-ae/2+2);this.cap.style.height=mt+"px"}else ue<0&&(I.bottom="0px",this.cap.style.height=Math.max(0,_n+ue)+"px");if(I.display="block",this.previewHost==t)return;let ki=this.preview;this.previewHost&&this.previewHost.off("preferredOrientation",this.reorient),this.previewHost=t,t&&(this.previewHost.on("preferredOrientation",this.reorient),this.preview=this.previewHost.element,this.tip.replaceChild(this.preview,ki),t.setCancellationHandler(()=>this.show(null,!1,null)),t.on("startFade",()=>{this.element.classList.remove("kmw-preview-fade"),this.element.offsetWidth,this.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",(l=this.previewHost)==null||l.off("preferredOrientation",this.reorient),this.previewHost=null;let r=this.preview;this.preview=document.createElement("div"),this.tip.replaceChild(this.preview,r),this.element.classList.remove("kmw-preview-fade"),this.orientation=ol}this.key=n,this.state=e}};a(Hn,"KeyTip");var $c="kmw-keypreview",mr="kmw-preview-overlay",Gr="kmw-keytip",pi=class{constructor(n){this.state=!1;this.vkbd=n;let e=this.element=document.createElement("div");e.className=$c,e.id="kmw-keytip",e.style.pointerEvents="none",e.style.display="none",this.preview=document.createElement("div"),e.appendChild(this.preview)}show(n,e,t){let i=this.vkbd,c=n==null?void 0:n.key.spec.displayLayer;if(e&&i.layerGroup.blinkLayer(c),e&&(n==null?void 0:n.offsetParent)){let s=this.vkbd.topContainer.getBoundingClientRect(),l=n.getBoundingClientRect(),r=c!=i.layerId?mr:"";this.element.className=`${$c} ${n.className} ${r}`,this.element.id=`${Gr}-${n.id}`;let B=this.element.style,d=this.vkbd.currentLayer.element.style.fontFamily;if(B.fontFamily=n.key.spec.font||d,B.left=l.left-s.left+"px",B.top=l.top-s.top+"px",B.width=l.width+"px",B.height=l.height+"px",this.element.style.display="block",this.previewHost==t)return;let g=this.preview;this.previewHost=t,t&&(this.preview=this.previewHost.element,this.element.replaceChild(this.preview,g),t.setCancellationHandler(()=>this.show(null,!1,null)),t.on("startFade",()=>{this.element.classList.remove("kmw-preview-fade"),this.element.offsetWidth,this.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",this.element.className=$c,this.previewHost=null;let s=this.preview;this.preview=document.createElement("div"),this.element.replaceChild(this.preview,s),this.element.classList.remove("kmw-preview-fade")}this.key=n,this.state=e}};a(pi,"TabletKeyTip");function Re(o){try{if(o=="desktop")return 1;var n=document.documentElement.clientWidth;if(screen.width>n)return 1;var e=screen.width;return ge()?screen.width<screen.height&&(e=screen.height):screen.width>screen.height&&(e=screen.height),Math.round(100*e/n)/100}catch(t){return 1}}a(Re,"getViewportScale");var Ic=class{constructor(n,e){this.directlyEmitsKeys=!0;this.hasModalVisualization=!1;this.deleteRepeater=a(()=>{this.repeatClosure(),this.timerHandle=window.setTimeout(this.deleteRepeater,Ic.REPEAT_DELAY)},"deleteRepeater");this.source=n;let t=n.stageReports[0].item;t.key.highlight(!0),this.repeatClosure=()=>{e(),t.key.highlight(!0)},this.timerHandle=window.setTimeout(this.deleteRepeater,Ic.INITIAL_DELAY),this.source.on("complete",()=>{window.clearTimeout(this.timerHandle),this.timerHandle=void 0,t.key.highlight(!1)})}cancel(){this.deleteRepeater(),this.source.cancel()}currentStageKeyDistribution(){return null}},$t=Ic;a($t,"HeldRepeater"),$t.INITIAL_DELAY=500,$t.REPEAT_DELAY=100;var En=class extends oe{constructor(n,e){if(typeof e!="string"||e=="")throw"The 'layer' parameter for subkey construction must be properly defined.";super(n,e)}getId(){return"popup-"+this.layer+"-"+this.spec.id}construct(n,e,t){let i=this.spec,c=document.createElement("div"),s=n.getDefaultKeyObject(),l=c.style;c.className="kmw-key-square-ex",t&&(l.marginTop="5px"),typeof i.width!="undefined"?l.width=i.width*e.offsetWidth/100+"px":l.width=e.offsetWidth+"px",l.height=e.offsetHeight+"px";let r=document.createElement("div"),B=this.btn=yc(r,new qt(this,i.id));this.setButtonClass(),B.id=this.getId();let d=B.style;return d.height=l.height,d.lineHeight=e.style.lineHeight,d.width=l.width,d.position="absolute",B.appendChild(this.label=this.generateKeyText(n)),c.appendChild(B),this.square=c}allowsKeyTip(){return!1}};a(En,"OSKSubKey");var al=.2,pr=1.2,dl=3,Xr=5,Bl=6+dl,en=class{constructor(n,e,t,i,c){this.directlyEmitsKeys=!0;this.shouldLockLayer=!1;this.baseKey=i,this.source=n,this.gestureParams=c,t.layerLocked&&(this.shouldLockLayer=!0),n.on("complete",()=>{var b;(b=this.currentSelection)==null||b.key.highlight(!1),this.clear()}),n.on("stage",()=>{let b=this.currentSelection;if(b){let U=t.keyEventFromSpec(b.key.spec);U.keyDistribution=this.currentStageKeyDistribution(),t.raiseKeyEvent(U,b)}});let s=n.stageReports[0].sources[0].constructSubview(!0,!1);s.path.on("step",b=>{var U,x;s.path.stats.netDistance>=4&&((U=this.currentSelection)==null||U.key.highlight(!1),(x=b.item)==null||x.key.highlight(!0),this.currentSelection=b.item)}),this.currentSelection=i,i.key.highlight(!0);let l=i.subKeys,r=this.element=document.createElement("div");var B;r.id="kmw-popup-keys";var d=r.style;d.fontFamily=t.fontFamily;let g=getComputedStyle(i);d.fontSize=g.fontSize,d.visibility="hidden";var F=l.length,Q,y;for(Q=Math.min(Math.ceil(F/9),2),y=Math.ceil(F/Q),this.menuWidth=y*i.offsetWidth+y*Xr,d.width=this.menuWidth+"px",this.subkeys=[],B=0;B<F;B++){var u=!1;let b=Math.floor(B/y);Q>1&&b>0&&(u=!0);let U=i.key.layer;(typeof U!="string"||U=="")&&(U=t.layerId);let m=new En(l[B],U).construct(t,i,u);this.subkeys.push(m.firstChild),r.appendChild(m)}this.shim=document.createElement("div"),this.shim.id="kmw-popup-shim",t.device.formFactor==G.FormFactor.Phone&&this.selectDefaultSubkey(i,r),t.element.appendChild(this.element),t.topContainer.appendChild(this.shim),this.reposition(t);let I=this.buildPopupRecognitionConfig(t);e({type:"push",config:I})}buildPopupRecognitionConfig(n){let e=this.element.getBoundingClientRect(),t=this.baseKey.getBoundingClientRect(),i=this.subkeys[0].style,s=-.666*Number.parseInt(i.height,10),l=3,r=t.bottom-e.bottom,B=new he(this.element,[s*l,s,-r<s?-r:s]),d={getBoundingClientRect(){let g=Number.MAX_SAFE_INTEGER;return new DOMRect(-g,-g,2*g,2*g)}};return{targetRoot:this.element,inputStartBounds:n.element,maxRoamingBounds:d,safeBounds:d,itemIdentifier:(g,F)=>{let Q=B.getBoundingClientRect(),y=null,u=Number.MAX_VALUE,I=Number.MAX_VALUE;if(g.clientX<Q.left||g.clientX>Q.right||g.clientY<Q.top||g.clientY>Q.bottom)return null;for(let b of this.subkeys){let U=b.getBoundingClientRect(),x=Number.MAX_VALUE,m=Number.MAX_VALUE;if(U.left<=g.clientX&&g.clientX<U.right?x=0:x=U.left>=g.clientX?U.left-g.clientX:g.clientX-U.right,U.top<=g.clientY&&g.clientY<U.bottom?m=0:m=U.top>=g.clientY?U.top-g.clientY:g.clientY-U.bottom,x==0&&m==0)return b;(x<I||x==I&&m<u)&&(I=x,y=b,u=m)}return y}}}reposition(n){let e=this.element,t=this.baseKey,i=n.topContainer,c=t.key.row.element,s=e.style,l=t.offsetParent?t.offsetParent.offsetLeft:0;var r=t.offsetLeft+l+.5*(t.offsetWidth-e.offsetWidth),B=n.width-e.offsetWidth;r>B&&(r=B),r<0&&(r=0),s.left=r+"px";let d=i.getBoundingClientRect(),g=c.getBoundingClientRect();s.top=g.top-d.top-e.offsetHeight-dl+"px",s.visibility="visible";let F=n.isEmbedded,Q=getComputedStyle(e),y=parseFloat(Q.top),u=0,I=0;y<u&&F&&(I=u-y,s.top=u+"px"),this.callout=this.addCallout(t,I,n.element,n.topContainer,n.device.formFactor=="tablet")}addCallout(n,e,t,i,c){e=e||0;let s=getComputedStyle(this.element),l=Math.max(Number.parseInt(s.borderRadius),0),r=n.getBoundingClientRect(),B=i.getBoundingClientRect(),d=Math.floor(Number.parseInt(s.top,10)+Number.parseInt(s.height,10)+Number.parseInt(s.paddingTop,10)/2+Number.parseInt(s.paddingBottom,10)),g=al*(r.height-e),F=al*r.height,Q=g+Bl,y=Q/(F+Bl),u=r.bottom-B.top-d-1,I=u<Q?u:Q;if(I>0){let b=document.createElement("div"),U=b.style;b.id="kmw-popup-callout",t.appendChild(b),U.top=d+"px",U.borderTopWidth=I+"px";let x=pr*y,m=r.width*x,V=this.menuWidth-2*l,J=V<m?V:m,W=r.left-B.left-(J-r.width)/2,Xe=Math.max(0,W+J-(B.right-l)),ae=Math.max(0,l-W);return U.left=r.left-B.left-(J-r.width)/2+ae+"px",U.borderLeftWidth=J/2-ae+"px",U.borderRightWidth=J/2-Xe+"px",b}else return null}selectDefaultSubkey(n,e){var c;var t;let i=n.subKeys;for(let s=0;s<i.length;s++){let l=i[s],r=e.childNodes[s].firstChild;if(l.default){t=r;break}else if(!n.key||!n.key.spec)continue;l.elementID==n.key.spec.elementID&&(t=r)}t&&((c=this.currentSelection)==null||c.key.highlight(!1),this.currentSelection=t,t.key.highlight(!0))}get hasModalVisualization(){return this.element.style.visibility=="visible"}buildCorrectiveLayout(){let n=this.element.getBoundingClientRect(),e=n.width/n.height;return{keys:this.subkeys.map(i=>{let c=i.getBoundingClientRect();return{keySpec:i.key.spec,centerX:(c.right-c.width/2-n.left)/n.width,centerY:(c.bottom-c.height/2-n.top)/n.height,width:c.width/n.width,height:c.height/n.height}}),kbdScaleRatio:e}}currentStageKeyDistribution(){let n=this.source.stageReports[this.source.stageReports.length-1],e=this.source.stageReports[0],t=n.sources[0],i=t.currentSample,c=this.element.getBoundingClientRect(),s={x:i.targetX/c.width,y:i.targetY/c.height};s.x=s.x<0?0:s.x>1?1:s.x,s.y=s.y<0?0:s.y>1?1:s.y;let l=ec(s,this.buildCorrectiveLayout()),r=l.get(i.item.key.spec),B=Math.min(t.path.stats.duration-e.sources[0].path.stats.duration,this.gestureParams.longpress.waitLength)/(2*this.gestureParams.longpress.waitLength),d=Math.min(t.path.stats.rawDistance,this.gestureParams.longpress.noiseTolerance*4)/(this.gestureParams.longpress.noiseTolerance*8),g=Math.min(B*B,d*d),F=r+g,Q=new Map,y=this.subkeys.find(u=>u.keyId==this.baseKey.keyId);return y?Q.set(y.key.spec,F):Q.set(this.baseKey.key.spec,F),Bt([l,Q])}cancel(){this.clear(),this.source.cancel()}clear(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.shim.parentNode&&this.shim.parentNode.removeChild(this.shim),this.callout&&this.callout.parentNode&&this.callout.parentNode.removeChild(this.callout)}};a(en,"SubkeyPopup");var je=class{constructor(n,e,t){this.directlyEmitsKeys=!0;this.shouldRestore=!1;this.hasModalVisualization=!1;let i=n.stageReports[0];this.originalLayer=i.sources[0].stateToken,this.source=n,this.completionCallback=()=>{e.lockLayer(!1),this.shouldRestore&&(e.layerId=this.originalLayer,e.updateState()),t==null||t()},e.lockLayer(!0),n.on("stage",c=>{let s=c.matchedId;s.includes("modipress")&&s.includes("-end")?this.clear():s.includes("modipress")&&s.includes("-hold")&&(this.shouldRestore=!0)}),n.on("complete",()=>this.cancel())}get isLocked(){return this.shouldRestore}setLocked(){this.shouldRestore=!0}get completed(){return this.completionCallback===null}clear(){let n=this.completionCallback;this.completionCallback=null,n==null||n()}cancel(){this.clear(),this.source.cancel()}currentStageKeyDistribution(n){return null}};a(je,"Modipress");var vn=class{constructor(n,e,t,i,c){this.directlyEmitsKeys=!0;this.hasModalVisualization=!1;this.tapIndex=0;this.baseKey=t,this.baseContextToken=i,this.multitaps=[t.key.spec].concat(t.key.spec.multitap),this.sequence=n;let s=a(g=>{var Q;(Q=this.modipress)==null||Q.clear();let F=new je(n,e,()=>{this.modipress=e.activeModipress=null});this.modipress=e.activeModipress=F},"startModipress");this.originalLayer=e.layerId;let l=a(g=>(this.tapIndex+g)%this.multitaps.length,"tapLookahead"),r=a(()=>{c==null||c.setMultitapHint(this.multitaps[l(0)],this.multitaps[l(1)],e)},"updatePreview");n.on("complete",()=>{var g;(g=this.modipress)==null||g.cancel(),this.clear()});let B=a(g=>{var I;switch(g.matchedId){case"modipress-hold":this.clear(),n.off("stage",B);return;case"modipress-end-multitap-transition":case"modipress-multitap-end":case"modipress-end":case"multitap-end":case"simple-tap":return;case"modipress-multitap-lock-transition":(I=this.modipress)==null||I.setLocked();return;case"modipress-multitap-start":case"multitap-start":break;default:throw new Error(`Unsupported gesture state encountered during multitap: ${g.matchedId}`)}this.tapIndex=l(1);let F=this.multitaps[this.tapIndex];r();let Q=e.keyEventFromSpec(F);Q.baseTranscriptionToken=this.baseContextToken;let y=g.sources[0].currentSample,u=e.getSimpleTapCorrectionDistances(y,this.baseKey.key.spec);if(y.stateToken!=e.layerId&&!g.matchedId.includes("modipress")){let b=e.layerGroup.findNearestKey(X(C({},y),{stateToken:e.layerId})),U=u.get(b.key.spec);U==null&&console.warn("Could not find current layer's key"),u.delete(b.key.spec),u.set(y.item.key.spec,U)}Q.keyDistribution=this.currentStageKeyDistribution(u),Q.kNextLayer||(Q.kNextLayer=this.originalLayer),e.raiseKeyEvent(Q,null),g.matchedId=="modipress-multitap-start"&&s(g)},"stageHandler");n.on("stage",B),n.stageReports[0].matchedId=="modipress-start"&&s(n.stageReports[0]),r()}currentStageKeyDistribution(n){let e=Bt(n),t=e.findIndex(r=>r.keySpec==this.baseKey.key.spec);if(t==-1)return xi(this.baseKey)||console.warn("Could not find base key's probability for multitap correction"),e;let i=e.splice(t,1)[0].p,c=0,s=[];for(let r=0;r<this.multitaps.length;r++){let B=this.multitaps[r],d=Math.abs(r-this.tapIndex)%this.multitaps.length,g=(r+this.multitaps.length-this.tapIndex)%this.multitaps.length,F=d<g?d:g,Q=1/((1+F)*(1+F));c+=Q,s.push({keySpec:B,p:Q})}let l=i/c;return s.forEach(r=>{r.p=l*r.p}),e.concat(s).sort((r,B)=>B.p-r.p)}cancel(){this.clear(),this.sequence.cancel()}clear(){}};a(vn,"Multitap");var gl=A(R(),1);var Xi=1.4142,es=a(o=>Math.abs(o)<1e-10?0:o,"coerceZeroes"),Vi=class extends gl.default{constructor(e,t,i,c){var F;super();this.flickPreviews=new Map;this.orientation="top";let s=e.key.spec,l=this.flickEdgeLength=Math.max(i,c),r=this.div=document.createElement("div");r.className=r.id="kmw-gesture-preview",r.style.pointerEvents="none";let B=this.previewImgContainer=document.createElement("div");this.previewImgContainer.id="kmw-preview-img-container";let d=this.label=document.createElement("span");if(d.className="kmw-gesture-base-label kmw-key-text",d.id="kmw-gesture-base-label",B.appendChild(d),d.textContent=e.key.label.textContent,this.div.appendChild(this.previewImgContainer),s.flick){let Q=s.flick||{};Object.keys(Q).forEach(y=>{let u=document.createElement("div");u.className="kmw-flick-preview kmw-key-text",u.textContent=Q[y].text;let I=u.style,b=Kc.get(y),U=es(-Math.sin(b[0])),x=es(Math.cos(b[0]));I.width="100%",I.textAlign="center",U<0?I.right=-U*Xi*l+"px":U>0?I.left=U*Xi*l+"px":I.left="0px",I.height="100%",I.lineHeight="100%",x<0?I.bottom=-x*Xi*l+"px":x>0?I.top=x*Xi*l+"px":I.top="0px",this.flickPreviews.set(y,u),B.appendChild(u)})}let g=this.hintLabel=document.createElement("div");g.className="kmw-key-popup-icon",t||(g.textContent=s==s.hintSrc?s.hint:(F=s.hintSrc)==null?void 0:F.text,g.style.fontWeight=g.textContent=="\u2022"?"bold":""),r.appendChild(g)}get element(){return this.div}refreshLayout(){let e=getComputedStyle(this.div),t=Number.parseInt(e.height,10);this.flickPreviews.forEach(i=>{i.style.lineHeight=i.style.height=`${t}px`})}cancel(){var e;(e=this.onCancel)==null||e.call(this),this.onCancel=null}setCancellationHandler(e){this.onCancel=e}setMultitapHint(e,t,i){var l,r;let c=_t(e.text,i),s=_t(t.text,i);this.label.textContent=c,this.hintLabel.textContent=s,this.label.style.fontFamily=c!=e.text?"SpecialOSK":(l=e.font)!=null?l:this.label.style.fontFamily,this.hintLabel.style.fontFamily=s!=t.text?"SpecialOSK":(r=t.font)!=null?r:this.hintLabel.style.fontFamily,this.emit("startFade"),this.clearFlick()}scrollFlickPreview(e,t){this.clearHint();let i=this.previewImgContainer.style,c=this.flickEdgeLength*Xi;i.marginLeft=`${c*e}px`,i.marginTop=`${c*t}px`;let s=es(t)<0?"bottom":"top";this.orientation!=s&&(this.orientation=s,this.emit("preferredOrientation",s))}clearFlick(){this.previewImgContainer.style.marginTop="0px",this.previewImgContainer.style.marginLeft="0px",this.previewImgContainer.classList.add("kmw-flick-clear")}clearHint(){this.hintLabel.classList.add("kmw-hint-clear")}clearAll(){this.clearFlick()}};a(Vi,"GesturePreviewHost");var ts=class extends Fl.default{constructor(e){var B,d;super();this.gestureParams=C({},Oc);this._layerId="default";this.layerLocked=!1;this.layerIndex=0;this.isStatic=!1;this._fixedWidthScaling=!1;this._fixedHeightScaling=!0;this.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};this.activeGestures=[];this.activeModipress=null;this.repeatDelete=function(){this.deleting&&(this.modelKeyClick(this.deleteKey),this.deleting=window.setTimeout(this.repeatDelete,100))}.bind(this);this.config=e,this.config.device=e.device||e.hostDevice,this.config.isEmbedded=e.isEmbedded||!1,e.isStatic&&(this.isStatic=e.isStatic),this._fixedWidthScaling=this.device.touchable&&!this.isStatic,this._fixedHeightScaling=this.device.touchable&&!this.isStatic;var t=document.createElement("div");this.config.styleSheetManager=e.styleSheetManager||new Ue(t);let i;if(e.keyboard)i=this.kbdLayout=e.keyboard.layout(e.device.formFactor),this.layoutKeyboardProperties=e.keyboardMetadata,this.isRTL=e.keyboard.isRTL;else{let g=S.buildDefaultLayout(null,null,e.device.formFactor);i=this.kbdLayout=nt.polyfill(g,null,e.device.formFactor),this.layoutKeyboardProperties=null,this.isRTL=!1}"font"in i?this.fontFamily=i.font:this.fontFamily="";let c=e.device.formFactor;this.layoutKeyboard=e.keyboard,this.layoutKeyboard||(this.layoutKeyboard=new N(null)),this.layerGroup=new An(this,this.layoutKeyboard,c),this.layoutKeyboard.markLayoutCalibrated(c),t.appendChild(this.layerGroup.element),this.kbdDiv=t,this.isStatic||(this.gestureEngine=this.constructGestureEngine()),t.classList.add(e.device.formFactor,"kmw-osk-inner-frame");let s=(d=(B=this.layoutKeyboard)==null?void 0:B.id.replace("Keyboard_",""))!=null?d:"",l=s.indexOf("::");l!=-1&&(s=s.substring(l+2));let r="kmw-keyboard-"+s;this.element.classList.add(r)}get layerId(){return this._layerId}set layerId(e){let t=e!=this._layerId;if(this.layerGroup.layers[e])this._layerId=e,this.layerGroup.activeLayerId=e,this.gestureEngine&&(this.gestureEngine.stateToken=e);else throw new Error(`Keyboard ${this.layoutKeyboard.id} does not have a layer with id ${e}`);t&&(this.updateState(),this.refreshLayout())}get currentLayer(){var e;return this.layerId?(e=this.layerGroup)==null?void 0:e.layers[this.layerId]:null}get lgKey(){var e,t;return(t=(e=this.currentLayer)==null?void 0:e.globeKey)==null?void 0:t.btn}get hkKey(){var e,t;return(t=(e=this.currentLayer)==null?void 0:e.hideKey)==null?void 0:t.btn}get spaceBar(){var e,t;return(t=(e=this.currentLayer)==null?void 0:e.spaceBarKey)==null?void 0:t.btn}constructGestureEngine(){let e=this.kbdLayout.layerMap.default.row.length,t={targetRoot:this.element,mouseEventRoot:document.body,maxRoamingBounds:new he(this.topContainer,[NaN]),itemIdentifier:(r,B)=>this.layerGroup.findNearestKey(r)};this.gestureParams.longpress.permitsFlick=r=>{let B=r==null?void 0:r.key.spec.flick;return!B||!(B.n||B.nw||B.ne)};let i=new Qt(Pc(this.kbdLayout,this.gestureParams),t);i.stateToken=this.layerId;let c={},s=a(r=>{for(let B of Object.keys(c)){if(B==r)continue;c[B].source.terminate(!0)}},"clearActiveGestures"),l=new Map;return i.on("inputstart",r=>{var F;let B=this.highlightKey(r.currentSample.item,!0);B&&((F=this.gesturePreviewHost)==null||F.cancel(),this.gesturePreviewHost=B);let d=c[r.identifier]={source:r,roamingHighlightHandler:null,key:r.currentSample.item,previewHost:B},g=a(()=>{Me(0).then(()=>{let Q=d.previewHost;Q&&(Q.cancel(),this.gesturePreviewHost=null,d.previewHost=null),d.key&&(this.highlightKey(d.key,!1),d.key=null)})},"endHighlighting");d.roamingHighlightHandler=Q=>{var I;let y=Q.item,u=c[r.identifier].key;if(!this.kbdLayout.hasFlicks&&y!=u){this.highlightKey(u,!1),(I=this.gesturePreviewHost)==null||I.cancel(),this.gesturePreviewHost=null;let b=this.highlightKey(y,!0);b&&(this.gesturePreviewHost=b,d.previewHost=b,c[r.identifier].key=y)}},r.path.on("invalidated",g),r.path.on("complete",g),r.path.on("step",d.roamingHighlightHandler)}),i.on("recognizedgesture",r=>{var B;(B=this.activeModipress)==null||B.setLocked(),r.on("complete",()=>{var d;for(let g of r.allSourceIds)(d=c[g])!=null&&d.previewHost&&(this.gesturePreviewHost=null,c[g].previewHost.cancel()),delete c[g]}),r.on("stage",(d,g)=>{let F=r.allSourceIds.map(m=>{var V;return(V=c[m])==null?void 0:V.previewHost}).find(m=>!!m),Q=l.get(r);!Q&&F&&!d.matchedId.includes("flick")&&F.clearFlick();let y;for(let m of d.allSourceIds){let V=a(J=>{J.key&&(this.highlightKey(J.key,!1),J.key=null),J.source.path.off("step",J.roamingHighlightHandler)},"clearRoaming");if(y=c[m],y)V(y);else{let J=m;Me(0).then(()=>{let W=c[J];W&&V(W)})}}let u=d.item,I=d.sources[0],b=I?I.currentSample:null,U=null;if(u&&!(Q&&Q[0].directlyEmitsKeys)){let m,V=this.getSimpleTapCorrectionDistances(I.currentSample,u.key.spec);Q&&(m=Q[0].currentStageKeyDistribution(V)),m||(m=Bt(V));let J=!this.layerLocked&&Q&&Q[0]instanceof en&&Q[0].shouldLockLayer;try{J&&this.lockLayer(!0),U=this.modelKeyClick(d.item,b)}finally{J&&this.lockLayer(!1)}}if(r.stageReports.length>1&&d.matchedId!="modipress-end")return;let x=r.stageReports[0].item;if(d.matchedId=="special-key-start")u.key.spec.baseKeyID=="K_BKSP"?(F==null||F.cancel(),Q=[new $t(r,()=>this.modelKeyClick(u,b))]):u.key.spec.baseKeyID=="K_LOPT"&&(r.on("complete",()=>this.emit("globekey",u,!1)),s(I.identifier));else if(d.matchedId.indexOf("longpress")>-1)F==null||F.cancel(),Q=[new en(r,g,this,r.stageReports[0].sources[0].baseItem,this.gestureParams)];else if((x==null?void 0:x.key.spec.multitap)&&(d.matchedId=="initial-tap"||d.matchedId=="multitap"||d.matchedId=="modipress-start"))y.previewHost=null,r.on("complete",()=>{F==null||F.cancel(),this.gesturePreviewHost=null}),Q=[new vn(r,this,x,U.contextToken,F)];else if(d.matchedId.indexOf("flick")>-1)Q=[new Vn(r,g,this,r.stageReports[0].sources[0].baseItem,this.gestureParams,F)];else if(d.matchedId.includes("modipress")&&d.matchedId.includes("-start"))if(F==null||F.cancel(),this.layerLocked)console.warn("Unexpected state:  modipress start attempt during an active modipress");else{Q||(Q=[]);let m=new je(r,this,()=>{let V=Q.indexOf(m);V>-1&&Q.splice(V,1),this.activeModipress=null});Q.push(m),this.activeModipress=m}else F==null||F.cancel();Q&&(this.activeGestures=this.activeGestures.concat(Q),l.set(r,Q),r.on("complete",()=>{let m=this.activeGestures.filter(V=>Q.includes(V));this.activeGestures=this.activeGestures.filter(V=>!Q.includes(V)),m.forEach(V=>{V instanceof je&&V.cancel()})}))})}),i}get element(){return this.kbdDiv}get device(){return this.config.device}get hostDevice(){return this.config.hostDevice}get fontRootPath(){return this.config.pathConfig.fonts}get styleSheetManager(){return this.config.styleSheetManager}get topContainer(){return this.config.topContainer}get isEmbedded(){return this.config.isEmbedded}postInsert(){}get width(){return this._width}get height(){return this._height}get layoutWidth(){if(this.usesFixedWidthScaling){let e=this.width,t=getComputedStyle(this.element);if(t.border){let i=new p(t.borderWidth).val;e-=i*2}return p.inPixels(e)}else return p.forScalar(1)}get layoutHeight(){if(this.usesFixedHeightScaling){let e=this.height,t=getComputedStyle(this.element);if(t.border){let i=new p(t.borderWidth).val;e-=i*2}return p.inPixels(e)}else return p.forScalar(1)}get internalHeight(){return this.usesFixedHeightScaling?p.inPixels(this.layoutHeight.val-this.getVerticalLayerGroupPadding()):p.forScalar(1)}get fontSize(){return this._fontSize||(this._fontSize=new p("1em")),this._fontSize}set fontSize(e){this._fontSize=e,this.kbdDiv.style.fontSize=e.styleString}get usesFixedWidthScaling(){return this._fixedWidthScaling}set usesFixedWidthScaling(e){this._fixedWidthScaling=e}get usesFixedHeightScaling(){return this._fixedHeightScaling}set usesFixedHeightScaling(e){this._fixedHeightScaling=e}get usesFixedPositioning(){let e=this.element;for(;e;){if(getComputedStyle(e).position=="fixed")return!0;e=e.offsetParent}return!1}setSize(e,t,i){this._width=e,this._height=t,this.kbdDiv&&(this.kbdDiv.style.width=e?this._width+"px":"",this.kbdDiv.style.height=t?this._height+"px":"",!this.device.touchable&&t&&(this.fontSize=new p(this._height/8+"px")),i||this.refreshLayout())}getDefaultKeyObject(){let e=C({},k.DEFAULT_KEY);return k.polyfill(e,this.layoutKeyboard,this.kbdLayout,this.layerId),e}getTouchCoordinatesOnKeyboard(e){let t={x:e.targetX,y:e.targetY};return t.x/=this.layerGroup.element.offsetWidth,t.y/=this.kbdDiv.offsetHeight,t}getSimpleTapCorrectionDistances(e,t){let i=this.getTouchCoordinatesOnKeyboard(e),s=this.layerGroup.element.offsetWidth,l=this.kbdDiv.offsetHeight;if(!s||!l)return new Map;let r=s/l,B=ps(this.kbdLayout.getLayer(this.layerId),r);return ec(i,B)}keyTarget(e){let t=e;try{if(t){if(t.classList.contains("kmw-key"))return uc(t);if(t.parentNode&&t.parentNode.classList.contains("kmw-key"))return uc(t.parentNode);if(t.firstChild&&t.firstChild.classList.contains("kmw-key"))return uc(t.firstChild)}}catch(i){}return null}cancelDelete(){this.deleting&&window.clearTimeout(this.deleting),this.deleting=0}modelKeyClick(e,t,i){let c=this.initKeyEvent(e);return t&&(c.source=t),i&&(c.keyDistribution=i),this.raiseKeyEvent(c,e)}initKeyEvent(e){this.highlightKey(e,!1);let t=e.key?e.key.spec:null;return t?this.keyEventFromSpec(t):null}keyEventFromSpec(e){let t=this.layoutKeyboard.constructKeyEvent(e,this.device,this.stateKeys);return t.srcKeyboard=this.layoutKeyboard,t}_UpdateVKShiftStyle(e){var l;var t;e||(e=this.layerId);let i=this.layerGroup.layers[e];if(!i||(this.gestureEngine&&(this.gestureEngine.stateToken=e),!((l=this.layoutKeyboard)!=null&&l.usesDesktopLayoutOnDevice(this.device))))return;let c=["K_CAPS","K_NUMLOCK","K_SCROLL"],s=[i.capsKey,i.numKey,i.scrollKey];for(t=0;t<s.length;t++)s[t]!=null&&s[t].setToggleState(this.stateKeys[c[t]])}updateStateKeys(e){for(let t in this.stateKeys)this.stateKeys[t]=e[t];this._UpdateVKShiftStyle()}showLanguage(){var c;let e=this.layoutKeyboardProperties,t=(c=e==null?void 0:e.displayName)!=null?c:"(System keyboard)";try{var i=this.spaceBar.key.label;let s=i.parentNode;typeof s.className=="undefined"||s.className==""?s.className="kmw-spacebar":s.className.indexOf("kmw-spacebar")==-1&&(s.className+=" kmw-spacebar"),i.className!="kmw-spacebar-caption"&&(i.className="kmw-spacebar-caption"),(i.innerText!=t||t=="")&&(i.innerText=t),this.spaceBar.key.refreshLayout(this)}catch(s){}}highlightKey(e,t){if(!e||!e.key||e.className==""||e.className.indexOf("kmw-key-row")>=0)return;let i=e.key.allowsKeyTip();return t=this.activeGestures.find(s=>s.hasModalVisualization)?!1:t,e.key.highlight(t),t&&i?this.gesturePreviewHost?null:this.showGesturePreview(e):null}getKeyEmFontSize(){if(!this.fontSize)return 0;if(this.device.formFactor=="desktop"){let t=.8;return this.fontSize.scaledBy(t).val}else{let t=getComputedStyle(document.body).fontSize,i=Zn(t).val;var e=1;if(!this.isStatic){if(this.fontSize.absolute)return this.fontSize.val;e=this.fontSize.val}return i*e}}updateState(){if(!!this.currentLayer){var e,t=this.kbdDiv.childNodes[0].childNodes;this.nextLayer=this.layerId,this.currentLayer.nextlayer&&(this.nextLayer=this.currentLayer.nextlayer),this.layerGroup.activeLayerId=this.layerId,this._UpdateVKShiftStyle()}}refreshLayout(){let e=this.device;var t=1;e.OS==G.OperatingSystem.iOS&&!this.isEmbedded&&(t=t/Re(this.device.formFactor));let i;this.height&&(i=this.computedAdjustedOskHeight(this.height));let c=this.layerGroup.element,s=this.kbdDiv.style,l=c.style;this.usesFixedHeightScaling&&this.height&&(s.height=s.maxHeight=this.height+"px"),s.fontSize=this.fontSize.styleString,l.fontSize=p.forScalar(t).styleString;let r=this.width&&this.height,B=getComputedStyle(this.kbdDiv),d=B.height!=""&&B.height!="auto";if(this.showLanguage(),r)this._computedWidth=this.width,this._computedHeight=this.height;else if(d){if(this._computedWidth=parseInt(B.width,10),!this._computedWidth){let g=getComputedStyle(this.kbdDiv.firstElementChild);this._computedWidth=parseInt(g.width,10)}this._computedHeight=parseInt(B.height,10)}else return;this.isStatic||(this.gestureEngine.config.maxRoamingBounds.updatePadding([-.333*this.currentLayer.rowHeight]),this.gestureParams.longpress.flickDist=.25*this.currentLayer.rowHeight,this.gestureParams.flick.startDist=.15*this.currentLayer.rowHeight,this.gestureParams.flick.dirLockDist=.35*this.currentLayer.rowHeight,this.gestureParams.flick.triggerDist=.75*this.currentLayer.rowHeight),this.currentLayer&&this.currentLayer.refreshLayout(this,this._computedHeight-this.getVerticalLayerGroupPadding())}getVerticalLayerGroupPadding(){let e=getComputedStyle(this.layerGroup.element),t=parseInt(e.paddingTop,10)||0,i=parseInt(e.paddingBottom,10)||0;return t+i}computedAdjustedOskHeight(e){if(!this.layerGroup)return e;let t=this.layerGroup.layers,i=0;for(let l in t){let B=t[l].rows.length,d=Math.floor(e/(B==0?1:B)),g=B*d;g>i&&(i=g)}return i+0}appendStyleSheet(){var e=this.layoutKeyboard,t=this.layoutKeyboardProperties;if(t!=null){this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet);var i=t.textFont,c=t.oskFont;this.styleSheetManager.addStyleSheetForFont(i,this.fontRootPath,this.device.OS),this.styleSheetManager.addStyleSheetForFont(c,this.fontRootPath,this.device.OS);var s=this.addFontStyle(i,c);e!=null&&typeof e.oskStyling=="string"&&(s=s+e.oskStyling),this.styleSheet=gt(s),this.styleSheet.addEventListener("load",()=>{this.refreshLayout()}),this.styleSheetManager.linkStylesheet(this.styleSheet)}}addFontStyle(e,t){let i="",c=a(s=>s.family.replace(/\u0022/g,"").replace(/,/g,'","'),"family");return(e||t)&&(i=`
.kmw-key-text {
  font-family: "${c(t||e)}";
}

.kmw-suggestion-text {
  font-family: "${c(e||t)}";
}
`),i}static buildDocumentationKeyboard(e,t,i,c,s,l){if(!e)return null;var r=typeof c=="undefined"?"desktop":c,B=typeof s=="undefined"?"default":s,d={};d.formFactor=r,r!="desktop"?(d.OS=G.OperatingSystem.iOS,d.touchable=!0):(d.OS=G.OperatingSystem.Windows,d.touchable=!1);let g=e.layout(r),F=new G("other",d.formFactor,d.OS,d.touchable),Q=new ts({keyboard:e,keyboardMetadata:t,hostDevice:F,isStatic:!0,topContainer:null,pathConfig:{fonts:i,resources:""},styleSheetManager:null});Q.layerGroup.element.className=Q.kbdDiv.className,Q.layerGroup.element.classList.add(d.formFactor+"-static");let y=Q.kbdDiv.childNodes[0],u=document.createElement("div");u.classList.add(d.OS.toLowerCase(),d.formFactor),g!=null?(Q.layerId=B,Q.layerGroup.activeLayerId=B,Q.setSize(800,l),Q.fontSize=ll(F,l,!1),Q.refreshLayout(),y.style.fontSize=Q.kbdDiv.style.fontSize,y.style.height=Q.kbdDiv.style.height,y.style.maxHeight=Q.kbdDiv.style.maxHeight):y.innerHTML="<p style='color:#c40; font-size:0.5em;margin:10px;'>No "+r+" layout is defined for "+e.name+".</p>",y.style.border="1px solid #ccc",Q.updateState();let I=a(()=>{if(document.contains(y))try{getComputedStyle(y)&&y.style.fontSize&&(Q.fontSize=new p(y.style.fontSize)),Q.appendStyleSheet();let U=Q.styleSheet,x=U.parentElement;Q.refreshLayout(),y.style.fontSize=Q.kbdDiv.style.fontSize,Q.shutdown(),y.appendChild(U)}finally{b.disconnect()}},"detectAndHandleInsertion"),b=new MutationObserver(I);return b.observe(document.body,{childList:!0,subtree:!0}),u.append(y),u}onHide(){this.hkKey&&this.highlightKey(this.hkKey,!1)}optionKey(e,t,i){t.indexOf("K_LOPT")>=0?this.emit("globekey",e,i):t.indexOf("K_ROPT")>=0&&i&&this.emit("hiderequested",e)}showGesturePreview(e){let t=this.keytip,i=getComputedStyle(e),c=Number.parseInt(i.height,10),s=Number.parseInt(i.width,10),l=new Vi(e,this.device.formFactor=="phone",s,c);return t==null?e.key.setPreview(l):t.show(e,!0,l),l.refreshLayout(),l}createKeyTip(){if(this.keytip==null)if(this.device.formFactor=="phone"){let e=this.isEmbedded;this.keytip=new Hn(this,e)}else this.keytip=new pi(this);this.keytip&&this.keytip.element&&this.element.appendChild(this.keytip.element)}createGlobeHint(){return this.config.embeddedGestureConfig.createGlobeHint?this.config.embeddedGestureConfig.createGlobeHint(this):null}shutdown(){var e;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet),this.activeGestures.forEach(t=>t.cancel()),this.gestureEngine&&this.gestureEngine.destroy(),this.deleting&&window.clearTimeout(this.deleting),(e=this.keytip)==null||e.show(null,!1,null)}lockLayer(e){this.layerLocked=e}raiseKeyEvent(e,t){if(e.kName=="K_LOPT"||e.kName=="K_ROPT")return this.optionKey(t,e.kName,!0),{};let i={},c=a((s,l)=>{var B,d;i.contextToken=(B=s==null?void 0:s.transcription)==null?void 0:B.token;let r=(d=s==null?void 0:s.transcription)==null?void 0:d.transform;i.alteredText=s&&(!r||In(r))},"keyEventCallback");return this.layerLocked&&(e.kNextLayer=this.layerId),this.emit("keyevent",e,c),i}},Fe=ts;a(Fe,"VisualKeyboard"),Fe.specialCharacters=oe.specialCharacters;var Ql=A(R(),1);var We=class extends Ql.default{};a(We,"Activator");var ut=class extends We{get enabled(){return!0}set enabled(n){}get activate(){return!0}get conditionsMet(){return!0}};a(ut,"StaticActivator");var Wn=class{constructor(){this.map={}}promiseForTouchpoint(n){return this.map[n]||(this.map[n]=new L),this.map[n]}maintainTouches(n){let e=Object.keys(this.map);for(let t=0;t<n.length;t++){let i=e.indexOf(""+n.item(t).identifier);i!=-1&&e.splice(i,1)}for(let t of e)this.map[t].resolve(),delete this.map[t]}};a(Wn,"TouchEventPromiseMap");var Uc=class extends yl.default{constructor(e){super();this.legacyEvents=new wt;this.needsLayout=!0;this.touchEventPromiseManager=new Wn;this.activationListener=a(e=>{if(!this.mayDisable&&!this.activationModel.enabled){this.activationModel.off("activate",this.activationListener);try{this.activationModel.enabled=!0}finally{this.activationModel.on("activate",this.activationListener)}}this.commonCheckAndDisplay()},"activationListener");this.layerChangeHandler=a((e,t)=>{var i,c;return this.vkbd&&this.vkbd._UpdateVKShiftStyle(t),(this.vkbd&&this.vkbd.layerId!=t||e.value!=t)&&(((i=this.vkbd)==null?void 0:i.layerGroup.layers[t])&&!((c=this.vkbd)!=null&&c.layerLocked)&&(this.vkbd.layerId=t,this.vkbd.showLanguage()),this.keyboardView.updateState(),this.refreshLayout()),!1},"layerChangeHandler");this._Visible=!1;this.config=e=C({},e),this.config.allowHideAnimations===void 0&&(this.config.allowHideAnimations=!0),this.config.device=e.device||e.hostDevice,this.config.isEmbedded=e.isEmbedded||!1,this.config.embeddedGestureConfig=e.embeddedGestureConfig||{},this.config.activator.on("activate",this.activationListener),this._Box=v("div"),this.kbdStyleSheetManager=new Ue(this._Box,this.config.doCacheBusting||!1),this.uiStyleSheetManager=new Ue(this._Box),this.bannerView=new Fi,this.bannerView.events.on("bannerchange",()=>this.refreshLayout()),this._bannerController=new Ln(this.bannerView,this.hostDevice,this.config.predictionContextManager),this.keyboardView=null,this.setBaseMouseEventListeners(),this.hostDevice.touchable&&this.setBaseTouchEventListeners()}get keyCodes(){return h.keyCodes}get modifierCodes(){return h.modifierCodes}get modifierBitmasks(){return h.modifierBitmasks}get stateBitmasks(){return h.stateBitmasks}get configuration(){return this.config}get bannerController(){return this._bannerController}get hostDevice(){return this.config.hostDevice}get fontRootPath(){return this.config.pathConfig.fonts}get isEmbedded(){return this.config.isEmbedded}setBaseMouseEventListeners(){this._Box.onmouseenter=this._VKbdMouseEnter=e=>{this.mouseEnterPromise&&this.mouseEnterPromise.resolve(),this.mouseEnterPromise=new L,this.emit("pointerinteraction",this.mouseEnterPromise.corePromise)},this._Box.onmouseleave=this._VKbdMouseLeave=e=>{this.mouseEnterPromise.resolve(),this.mouseEnterPromise=null}}removeBaseMouseEventListeners(){this._Box.onmouseenter=null,this._Box.onmouseleave=null}setBaseTouchEventListeners(){let e=a(function(t){return t.cancelable&&t.preventDefault(),t.stopPropagation(),!1},"commonPrevention");this._boxBaseTouchEventCancel=t=>(this.touchEventPromiseManager.maintainTouches(t.touches),e(t)),this._boxBaseTouchStart=t=>{for(let i=0;i<t.changedTouches.length;i++){let c=this.touchEventPromiseManager.promiseForTouchpoint(t.changedTouches[i].identifier);this.emit("pointerinteraction",c.corePromise)}return this.touchEventPromiseManager.maintainTouches(t.touches),e(t)},this._Box.addEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.addEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchcancel",this._boxBaseTouchEventCancel,!1)}removeBaseTouchEventListeners(){!this._boxBaseTouchEventCancel||(this._Box.removeEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.removeEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchcancel",this._boxBaseTouchEventCancel,!1),this._boxBaseTouchEventCancel=null,this._boxBaseTouchStart=null)}get targetDevice(){return this.config.device}set targetDevice(e){this.allowsDeviceChange(e)?(this.config.device=e,this.loadActiveKeyboard()):console.error("May not change target device for this OSKView type.")}allowsDeviceChange(e){return!1}get activationModel(){return this.config.activator}set activationModel(e){if(!e)throw new Error("The activation model may not be set to null or undefined!");this.config.activator.off("activate",this.activationListener),e.on("activate",this.activationListener),this.config.activator=e,this.commonCheckAndDisplay()}get mayDisable(){var e;return!(this.hostDevice.touchable||(e=this.activeKeyboard)!=null&&e.keyboard.isCJK)}get displayIfActive(){return this.activationModel.enabled}commonCheckAndDisplay(){this.activationModel.activate&&this.activeKeyboard?this.present():this.startHide(!1)}get vkbd(){return this.keyboardView instanceof Fe?this.keyboardView:null}get banner(){return this.bannerView}get width(){return this._width}get height(){return this._height}get computedWidth(){return this.needsLayout&&this.refreshLayout(),this._computedWidth}get computedHeight(){return this.needsLayout&&this.refreshLayout(),this._computedHeight}get baseFontSize(){var e;return((e=this.parsedBaseFontSize)==null?void 0:e.styleString)||""}get parsedBaseFontSize(){return this._baseFontSize||(this._baseFontSize=Uc.defaultFontSize(this.targetDevice,this.computedHeight,this.isEmbedded)),this._baseFontSize}static defaultFontSize(e,t,i){if(e.touchable){let c=e.formFactor=="phone"?1.6*(i?.65:.6)*1.2:2;return p.special(c,"em")}else return t?p.inPixels(t/8):void 0}get activeKeyboard(){return this.keyboardData}set activeKeyboard(e){var t;this.keyboardData=e,this.loadActiveKeyboard(),(t=this.keyboardData)!=null&&t.keyboard.isCJK&&(this.activationModel.enabled=!0)}computeFrameHeight(){var e,t;return(((e=this.headerView)==null?void 0:e.layoutHeight.val)||0)+(((t=this.footerView)==null?void 0:t.layoutHeight.val)||0)}setSize(e,t,i){let c=!1,s,l;!e&&e!==0||!t&&t!==0||(Number.isFinite(e)?s=p.inPixels(e):s=new p(e),Number.isFinite(t)?l=p.inPixels(t):l=new p(t),e&&t&&(c=!this._width||!this._height,c=c||s.styleString!=this._width.styleString,c=c||l.styleString!=this._height.styleString,this._width=s,this._height=l),this.needsLayout=this.needsLayout||c,this.refreshLayoutIfNeeded(i))}setNeedsLayout(){this.needsLayout=!0}refreshLayout(e){var l,r;if(!this.keyboardView||!(this.width&&this.height))return;let i=this.width.absolute&&this.height.absolute,c=getComputedStyle(this._Box),s=c.height!=""&&c.height!="auto";if(i)this._computedWidth=this.width.val,this._computedHeight=this.height.val;else if(s){let B=this._Box.parentElement;this._computedWidth=this.width.val*(this.width.absolute?1:B.offsetWidth),this._computedHeight=this.height.val*(this.height.absolute?1:B.offsetHeight)}else{console.warn("Unable to properly perform layout - specification uses a relative spec, thus relies upon insertion into the DOM for layout.");return}if(this.needsLayout=!1,this.banner.element.style.fontSize=this.baseFontSize,this.vkbd&&(this.vkbd.fontSize=this.parsedBaseFontSize),e||((l=this.headerView)==null||l.refreshLayout(),this.bannerView.refreshLayout(),(r=this.footerView)==null||r.refreshLayout()),this.vkbd){let B=this.computedHeight-this.computeFrameHeight();this.bannerView.height>0&&(B-=this.bannerView.height+5),this.vkbd.setSize(this.computedWidth,B,e);let d=this._Box.style;d.width=d.maxWidth=this.computedWidth+"px",d.height=d.maxHeight=this.computedHeight+"px",this.vkbd.showLanguage()}else{let B=this._Box.style;B.width="auto",B.height="auto",B.maxWidth=B.maxHeight=""}}refreshLayoutIfNeeded(e){this.needsLayout&&this.refreshLayout(e)}postKeyboardLoad(){this._Visible=!1,this.postKeyboardAdjustments(),this.displayIfActive&&this.present()}loadActiveKeyboard(){var i,c,s,l;this.setBoxStyling(),this.vkbd&&this.vkbd.shutdown(),this.keyboardView=null,this.needsLayout=!0,this._Box.innerHTML="",this.uiStyleSheetManager.unlinkAll(),this.kbdStyleSheetManager.unlinkAll();let e="osk/";this.config.isEmbedded&&(e="");for(let r of Uc.STYLESHEET_FILES){let B=`${this.config.pathConfig.resources}/${e}${r}`;this.uiStyleSheetManager.linkExternalSheet(B)}this.headerView&&this._Box.appendChild(this.headerView.element),this._Box.appendChild(this.banner.element),this.bannerView.banner&&this.banner.banner.configureForKeyboard((i=this.keyboardData)==null?void 0:i.keyboard,(c=this.keyboardData)==null?void 0:c.metadata);let t=this.keyboardView=this._GenerateKeyboardView((s=this.keyboardData)==null?void 0:s.keyboard,(l=this.keyboardData)==null?void 0:l.metadata);if(this._Box.appendChild(t.element),t.postInsert(),this.footerView&&this._Box.appendChild(this.footerView.element),this.banner.appendStyles(),this.vkbd){this.vkbd.createKeyTip();let r=this.vkbd.createGlobeHint();r&&this._Box.appendChild(r.element),this.vkbd.appendStyleSheet()}this.postKeyboardLoad()}_GenerateKeyboardView(e,t){let i=this.targetDevice;return this.vkbd&&this.vkbd.shutdown(),this._Box.className="",e==null&&!i.touchable?new yt:e&&e.layout(i.formFactor)?this._GenerateVisualKeyboard(e,t):!e||!t?this._GenerateVisualKeyboard(null,null):new Pt(e)}_GenerateVisualKeyboard(e,t){let i=this.targetDevice,c=new Fe({keyboard:e,keyboardMetadata:t,device:i,hostDevice:this.hostDevice,topContainer:this._Box,styleSheetManager:this.kbdStyleSheetManager,pathConfig:this.config.pathConfig,embeddedGestureConfig:this.config.embeddedGestureConfig,isEmbedded:this.config.isEmbedded});return c.on("keyevent",(s,l)=>this.emit("keyevent",s,l)),c.on("globekey",(s,l)=>this.emit("globekey",s,l)),c.on("hiderequested",s=>{this.doHide(!0),this.emit("hiderequested",s)}),this._Box.className=i.formFactor+" "+i.OS.toLowerCase()+" kmw-osk-frame",c}present(){if(!!this.mayShow()){if(this.keyboardView.updateState(),this._Box.style.display="block",this.refreshLayoutIfNeeded(),this.keyboardView instanceof Fe&&this.keyboardView.showLanguage(),this._Visible=!0,this._Box.style.opacity="1",this._Box.style.visibility=="hidden"){let e=this;window.setTimeout(function(){e._Box.style.visibility="visible"},0)}this.setDisplayPositioning()}}startHide(e){if(!this.mayHide(e))return;e&&(this.activationModel.enabled=!!(this.keyboardData.keyboard.isCJK||this.hostDevice.touchable));let t=null;this._Box&&this.hostDevice.touchable&&!(this.keyboardView instanceof yt)&&this.config.allowHideAnimations?t=this.useHideAnimation():t=Promise.resolve(!0);let i=this;t.then(function(c){c&&i.finalizeHide()}),this.doHide(e)}finalizeHide(){if(!(document.body.className.indexOf("osk-always-visible")>=0&&this.hostDevice.formFactor=="desktop")){if(this._Box){let e=this._Box.style;e.display="none",e.transition="",e.opacity="1",this._Visible=!1}this.vkbd&&this.vkbd.onHide()}}mayShow(){return!(!this.activationModel.conditionsMet||!this.keyboardView||this.keyboardView instanceof yt||!this.activationModel.enabled||!this._Box)}mayHide(e){return!(this.activationModel.conditionsMet&&!this.mayDisable||this.activationModel instanceof ut||!e&&this.hostDevice.formFactor=="desktop"&&document.body.className.indexOf("osk-always-visible")>=0)}useHideAnimation(){let e=this._Box.style,t=this;return new Promise(function(i){let c=a(function(){return t._Box.removeEventListener("transitionend",c,!1),t._Box.removeEventListener("webkitTransitionEnd",c,!1),t._Box.removeEventListener("transitioncancel",c,!1),t._Box.removeEventListener("webkitTransitionCancel",c,!1),t._animatedHideTimeout!=0&&window.clearTimeout(t._animatedHideTimeout),t._animatedHideTimeout=0,t._Visible&&t.activationModel.conditionsMet?(e.transition="",e.opacity="1",i(!1),!1):(i(!0),!0)},"cleanup"),s=a(function(){t._Box.removeEventListener("transitionrun",s,!1),t._Box.removeEventListener("webkitTransitionRun",s,!1),t._Box.addEventListener("transitionend",c,!1),t._Box.addEventListener("webkitTransitionEnd",c,!1),t._Box.addEventListener("transitioncancel",c,!1),t._Box.addEventListener("webkitTransitionCancel",c,!1)},"startup");t._Box.addEventListener("transitionrun",s,!1),t._Box.addEventListener("webkitTransitionRun",s,!1),e.transition="opacity 0.5s linear 0",e.opacity="0",t._animatedHideTimeout=window.setTimeout(c,200)})}hideNow(){if(!this.mayHide(!1)||!this._Box)return;this._animatedHideTimeout&&(window.clearTimeout(this._animatedHideTimeout),this._animatedHideTimeout=0);let e=this._Box.style;e.transition="",e.opacity="0",this.finalizeHide()}shutdown(){this.removeBaseMouseEventListeners(),this.removeBaseTouchEventListeners();var e=this._Box;e.parentElement&&e.parentElement.removeChild(e),this.kbdStyleSheetManager.unlinkAll(),this.uiStyleSheetManager.unlinkAll(),this.bannerController.shutdown()}getRect(){var e={};return e.left=e.left=q(this._Box),e.top=e.top=$(this._Box),e.width=this.computedWidth,e.height=this.computedHeight,e}isEnabled(){return this.displayIfActive}isVisible(){return this._Visible}hide(){this.activationModel.enabled=!1,this.startHide(!0)}show(e){arguments.length>0?this.activationModel.enabled=e:this.activationModel.conditionsMet&&(this.activationModel.enabled=!this.activationModel.enabled)}doShow(e){this.legacyEvents.callEvent("show",e)}doHide(e){let t={HiddenByUser:e};this.legacyEvents.callEvent("hide",t)}addEventListener(e,t){this.legacyEvents.addEventListener(e,t)}removeEventListener(e,t){this.legacyEvents.removeEventListener(e,t)}},Ge=Uc;a(Ge,"OSKView"),Ge.STYLESHEET_FILES=["kmwosk.css","globe-hint.css"];var ul=A(R(),1);var ns=class extends ul.default{constructor(e){super();this.mouseCancellingHandler=a(function(e){return e.preventDefault(),e.cancelBubble=!0,!1},"mouseCancellingHandler");this._element=this.buildTitleBar(),this.helpEnabled=!1,this.configEnabled=!1,e&&(this.element.onmousedown=e.mouseDownHandler)}get helpEnabled(){return this._helpEnabled}set helpEnabled(e){this._helpEnabled=e,this._helpButton.style.display=e?"inline":"none"}get configEnabled(){return this._configEnabled}set configEnabled(e){this._configEnabled=e,this._configButton.style.display=e?"inline":"none"}get layoutHeight(){return ns.DISPLAY_HEIGHT}get element(){return this._element}setPinCJKOffset(){this._unpinButton.style.left="15px"}showPin(e){this._unpinButton.style.display=e?"block":"none"}setTitle(e){this._caption.innerHTML=e}setTitleFromKeyboard(e){let t="<span style='font-weight:bold'>"+(e==null?void 0:e.name)+"</span>";this._caption.innerHTML=t}buildTitleBar(){let e=v("div");e.id="keymanweb_title_bar",e.className="kmw-title-bar";var t=this._caption=v("span");t.className="kmw-title-bar-caption",t.style.color="#fff",e.appendChild(t);var i=this._closeButton=this.buildCloseButton();return this._closeButton.onclick=()=>(this.emit("close"),!1),e.appendChild(i),i=this._helpButton=this.buildHelpButton(),this._helpButton.onclick=()=>(this.emit("help"),!1),e.appendChild(i),i=this._configButton=this.buildConfigButton(),this._configButton.onclick=()=>(this.emit("config"),!1),e.appendChild(i),i=this._unpinButton=this.buildUnpinButton(),this._unpinButton.onclick=()=>(this.emit("unpin"),!1),e.appendChild(i),e}buildCloseButton(){var e=v("div");return e.id="kmw-close-button",e.className="kmw-title-bar-image",e.onmousedown=this.mouseCancellingHandler,e}buildHelpButton(){let e=v("div");return e.id="kmw-help-image",e.className="kmw-title-bar-image",e.title="KeymanWeb Help",e.onmousedown=this.mouseCancellingHandler,e}buildConfigButton(){let e=v("div");return e.id="kmw-config-image",e.className="kmw-title-bar-image",e.title="KeymanWeb Configuration Options",e.onmousedown=this.mouseCancellingHandler,e}buildUnpinButton(){let e=v("div");return e.id="kmw-pin-image",e.className="kmw-title-bar-image",e.title="Pin the On Screen Keyboard to its default location on the active text box",e.onmousedown=this.mouseCancellingHandler,e}refreshLayout(){}},It=ns;a(It,"TitleBar"),It.DISPLAY_HEIGHT=p.inPixels(20);var Il=A(R(),1);var is=class extends Il.default{constructor(e){super();this.mouseCancellingHandler=a(function(e){return e.preventDefault(),e.cancelBubble=!0,!1},"mouseCancellingHandler");this._element=this.buildResizeBar(),e&&(this._resizeHandle.onmousedown=e.mouseDownHandler)}get layoutHeight(){return is.DISPLAY_HEIGHT}get element(){return this._element}get handle(){return this._resizeHandle}allowResizing(e){this._resizeHandle.style.display=e?"block":"none"}buildResizeBar(){var e=v("div");e.className="kmw-footer",e.onmousedown=this.mouseCancellingHandler;var t=v("div");t.className="kmw-footer-caption",t.innerHTML='<a href="https://keyman.com/developer/keymanweb/">KeymanWeb</a>',t.id="keymanweb-osk-footer-caption",t.addEventListener("dblclick",c=>(this.emit("showbuild"),!1),!1),e.appendChild(t);var i=v("div");return i.className="kmw-footer-resize",e.appendChild(i),this._resizeHandle=i,e}refreshLayout(){}},tn=is;a(tn,"ResizeBar"),tn.DISPLAY_HEIGHT=p.inPixels(16);var _e=class{constructor(n,e,t){this.x=n,this.y=e,t&&(this.source=t)}static fromEvent(n){let e;if(window.TouchEvent&&n instanceof TouchEvent||n.changedTouches?e=n.changedTouches[0]:e=n,e.pageX)return new _e(e.pageX,e.pageY,n);if(e.clientX){let t=e.clientX+document.body.scrollLeft,i=e.clientY+document.body.scrollTop;return new _e(t,i,n)}else return new _e(null,null,n)}};a(_e,"InputEventCoordinate");var hc=class{constructor(n){this._VPreviousMouseMove=document.onmousemove,this._VPreviousMouseUp=document.onmouseup,this._VPreviousCursor=document.body.style.cursor,this._VPreviousMouseButton=typeof n.which=="undefined"?n.button:n.which}restore(){document.onmousemove=this._VPreviousMouseMove,document.onmouseup=this._VPreviousMouseUp,document.body.style.cursor&&(document.body.style.cursor=this._VPreviousCursor)}matchesCausingClick(n){return this._VPreviousMouseButton==(typeof n.which=="undefined"?n.button:n.which)}};a(hc,"MouseStartSnapshot");var nn=class{constructor(n){this.startHandler=this._VMoveMouseDown.bind(this),this.cursorType=n}get enabled(){return this._enabled}set enabled(n){this._enabled=n}get isActive(){return!!this._mouseStartSnapshot}get mouseDownHandler(){return this.startHandler}_VMoveMouseDown(n){return!n||!this._enabled?!0:(this._mouseStartSnapshot||(this._mouseStartSnapshot=new hc(n)),this._startCoord=_e.fromEvent(n),document.onmousemove=this._VMoveMouseMove.bind(this),document.onmouseup=this._VMoveMouseUp.bind(this),document.body.style.cursor&&(document.body.style.cursor=this.cursorType),n.preventDefault(),n.cancelBubble=!0,this.onDragStart(),!1)}_VMoveMouseMove(n){if(!n||!this.enabled)return!0;if(n.preventDefault(),n.cancelBubble=!0,this._mouseStartSnapshot.matchesCausingClick(n)){let e=_e.fromEvent(n),t=e.x-this._startCoord.x,i=e.y-this._startCoord.y;return this.onDragMove(t,i),!1}else return this._VMoveMouseUp(n)}_VMoveMouseUp(n){return n?(this._mouseStartSnapshot.restore(),this._mouseStartSnapshot=null,n.preventDefault(),n.cancelBubble=!0,this.onDragRelease(),!1):!0}};a(nn,"MouseDragOperation");var qe=class extends We{constructor(){super(...arguments);this._enabled=!0;this.actValue=null}get activate(){return this._enabled&&!!this.actValue}checkState(e){this.activate!=e&&this.emit("activate",this.activate)}get enabled(){return this._enabled}set enabled(e){let t=this.activate;this._enabled=e,this.checkState(t)}get activationTrigger(){return this.actValue}set activationTrigger(e){let t=this.activate,i=this.actValue;this.actValue=e,this.checkState(t),i!=e&&this.emit("triggerchange",e)}get conditionsMet(){return!!this.activationTrigger}};a(qe,"TwoStateActivator");var Li=class extends le{constructor(){super("KeymanWeb_OnScreenKeyboard")}loadWithDefaults(n){return C(C({},n),this.load())}load(){let n=super.load((e,t)=>{switch(t){case"version":return e;default:return Number.parseInt(e,10)}});return n.width||delete n.width,n.height||delete n.height,n}save(n){super.save(n)}};a(Li,"FloatingOSKCookieSerializer");var fe=class extends Ge{constructor(e){e.activator=e.activator||new qe;super(e);this.userPositioned=!1;this.specifiedPosition=!1;this.noDrag=!1;this.layoutSerializer=new Li;this.restorePosition=function(e){let t=this._Visible,i=new L;this.emit("dragmove",i.corePromise),this.loadPersistedLayout(),this.userPositioned=!1,e||(delete this.dfltX,delete this.dfltY),this.savePersistedLayout(),t&&this.present(),this.titleBar.showPin(!1),i.resolve(),this.doResizeMove()}.bind(this);this.typedActivationModel.on("triggerchange",()=>this.setDisplayPositioning()),document.body.appendChild(this._Box),this.titleBar=new It(this.titleDragHandler),this.titleBar.on("help",()=>{this.legacyEvents.callEvent("helpclick",{})}),this.titleBar.on("config",()=>{this.legacyEvents.callEvent("configclick",{})}),this.titleBar.on("close",()=>this.startHide(!0)),this.titleBar.on("unpin",()=>this.restorePosition(!0)),this.resizeBar=new tn(this.resizeDragHandler),this.resizeBar.on("showbuild",()=>this.emit("showbuild")),this.headerView=this.titleBar;let t=a(s=>{let l=this.headerView;if(l&&l instanceof It)switch(s){case"configclick":l.configEnabled=this.legacyEvents.listenerCount("configclick")>0;break;case"helpclick":l.helpEnabled=this.legacyEvents.listenerCount("helpclick")>0;break;default:return}},"onListenedEvent"),i=new Yt(this),c=new Yt(this.legacyEvents);for(let s of[i,c])s.on("listeneradded",t),s.on("listenerremoved",t);this.loadPersistedLayout()}get typedActivationModel(){return this.activationModel}_Unload(){this.keyboardView=null,this.bannerView=null,this._Box=null}setBoxStyling(){let e=this._Box.style;e.zIndex="9999",e.display="none",e.width="auto",e.position="absolute"}postKeyboardAdjustments(){this.enableMoveResizeHandlers(),this.activeKeyboard&&this.titleBar.setTitleFromKeyboard(this.activeKeyboard.keyboard),this.vkbd?(this.footerView=this.resizeBar,this._Box.appendChild(this.footerView.element)):(this.footerView&&this._Box.removeChild(this.footerView.element),this.footerView=null),this.loadPersistedLayout(),this.setNeedsLayout()}isEnabled(){return this.displayIfActive}isVisible(){return this._Visible}savePersistedLayout(){var e=this.getPos();let t={visible:this.displayIfActive?1:0,userSet:this.userPositioned?1:0,left:e.left,top:e.top,_version:f.CURRENT.toString()};this.vkbd&&(t.width=this.width.val,t.height=this.height.val),this.layoutSerializer.save(t)}loadPersistedLayout(){let e=this.layoutSerializer.loadWithDefaults({visible:1,userSet:0,left:-1,top:-1,_version:void 0,width:.3*screen.width,height:.15*screen.height});this.activationModel.enabled=e.visible==1,this.userPositioned=e.userSet==1,this.x=e.left,this.y=e.top;let t=e._version,i=t===void 0,c=e.width,s=e.height;c<.2*screen.width&&(c=.2*screen.width),s<.1*screen.height&&(s=.1*screen.height),c>.9*screen.width&&(c=.9*screen.width),s>.5*screen.height&&(s=.5*screen.height),(i||!t)&&(this.headerView&&this.headerView.layoutHeight.absolute&&(s+=this.headerView.layoutHeight.val),this.footerView&&this.footerView.layoutHeight.absolute&&(s+=this.footerView.layoutHeight.val)),this.setSize(c,s),(this.x==-1||this.y==-1||!this._Box)&&(this.userPositioned=!1),this.x<window.pageXOffset-.8*c&&(this.x=window.pageXOffset-.8*c),this.y<0&&(this.x=-1,this.y=-1,this.userPositioned=!1),this.userPositioned&&this._Box&&this.setPos({left:this.x,top:this.y})}getDefaultKeyboardHeight(){if(this.configuration.heightOverride)return this.configuration.heightOverride();var e=Math.floor(Math.min(screen.availHeight,screen.availWidth)/2),t=e;if(this.targetDevice.formFactor=="phone"){var i=Math.min(screen.height,screen.width),c=Math.max(screen.height,screen.width);ge()?t=t*(c/i)/1.6:t=Math.floor(Math.max(screen.availHeight,screen.availWidth)/3)}return this.targetDevice.OS==G.OperatingSystem.iOS&&(t=t/Re(this.targetDevice.formFactor)),t}getDefaultWidth(){if(this.configuration.widthOverride)return this.configuration.widthOverride();var e;if(this.targetDevice.OS==G.OperatingSystem.iOS)e=window.innerWidth;else if(this.targetDevice.OS==G.OperatingSystem.Android)try{e=document.documentElement.clientWidth}catch(t){e=screen.availWidth}else e=screen.width;return e}doResizeMove(e){this.legacyEvents.callEvent("resizemove",e)}setRect(e){if(!(this._Box==null||this.targetDevice.formFactor!="desktop")){var t=this._Box,i=t.style;if("left"in e&&(this.x=e.left-q(t)+t.offsetLeft,i.left=this.x+"px",this.dfltX=i.left),"top"in e&&(this.y=e.top-$(t)+t.offsetTop,i.top=this.y+"px",this.dfltY=i.top),this.vkbd!=null){var c=this.vkbd.kbdDiv,s=c.style;if("width"in e){var l=e.width-(t.offsetWidth-c.offsetWidth);l<.2*screen.width&&(l=.2*screen.width),l>.9*screen.width&&(l=.9*screen.width),s.width=l+"px",this.setSize(l,this.computedHeight,!0)}if("height"in e){var r=e.height-(t.offsetHeight-c.offsetHeight);r<.1*screen.height&&(r=.1*screen.height),r>.5*screen.height&&(r=.5*screen.height),s.height=r+"px",s.fontSize=r/8+"px",this.setSize(this.computedWidth,r,!0)}"nosize"in e&&(this.resizingEnabled=!e.nosize)}"nomove"in e&&(this.noDrag=e.nomove,this.movementEnabled=!this.noDrag),this.savePersistedLayout()}}getPos(){var e=this._Box,t={left:this._Visible?e.offsetLeft:this.x,top:this._Visible?e.offsetTop:this.y};return t}setPos(e){if(typeof this._Box!="undefined"){if(this.userPositioned){var t=e.left,i=e.top;typeof t!="undefined"&&(t<-.8*this._Box.offsetWidth&&(t=-.8*this._Box.offsetWidth),this.userPositioned&&(this._Box.style.left=t+"px",this.x=t)),typeof i!="undefined"&&(i<0&&(i=0),this.userPositioned&&(this._Box.style.top=i+"px",this.y=i))}this.titleBar.showPin(this.userPositioned)}}setDisplayPositioning(){var e=this._Box.style;if(e.position="absolute",this.activationModel.activate&&(e.display="block"),e.left="0px",this.specifiedPosition||this.userPositioned)e.left=this.x+"px",e.top=this.y+"px";else{let t=this.typedActivationModel.activationTrigger||null;this.dfltX?e.left=this.dfltX:typeof t!="undefined"&&t!=null&&(e.left=q(t)+"px"),this.dfltY?e.top=this.dfltY:typeof t!="undefined"&&t!=null&&(e.top=$(t)+t.offsetHeight+"px")}this.specifiedPosition=!1}presentAtPosition(e,t){!this.mayShow()||(this.specifiedPosition=e>=0||t>=0,this.specifiedPosition&&(this.x=e,this.y=t),this.specifiedPosition=this.specifiedPosition||this.userPositioned,this.present())}present(){if(!!this.mayShow()){this.titleBar.showPin(this.userPositioned),super.present();var e={};e.x=this._Box.offsetLeft,e.y=this._Box.offsetTop,e.userLocated=this.userPositioned,this.doShow(e)}}startHide(e){super.startHide(e),e&&this.savePersistedLayout()}show(e){e!==void 0?super.show(e):super.show(),this.savePersistedLayout()}userLocated(){return this.userPositioned}get movementEnabled(){return this.titleDragHandler.enabled}set movementEnabled(e){this.titleDragHandler.enabled=e,this.titleBar.showPin(e&&this.userPositioned)}get resizingEnabled(){return this.resizeDragHandler.enabled}set resizingEnabled(e){this.resizeDragHandler.enabled=e,this.resizeBar.allowResizing(e)}get isBeingMoved(){return this.titleDragHandler.isActive}get isBeingResized(){return this.resizeDragHandler.isActive}enableMoveResizeHandlers(){this.titleDragHandler.enabled=!this.noDrag,this.resizeDragHandler.enabled=!0}get titleDragHandler(){let e=this;return this._moveHandler?this._moveHandler:(this._moveHandler=new class extends nn{constructor(){super("move")}onDragStart(){this.startX=e._Box.offsetLeft,this.startY=e._Box.offsetTop,e.activeKeyboard.keyboard.isCJK&&e.titleBar.setPinCJKOffset(),this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new L,e.emit("dragmove",this.dragPromise.corePromise)}onDragMove(i,c){e.titleBar.showPin(!0),e.userPositioned=!0,e._Box.style.left=this.startX+i+"px",e._Box.style.top=this.startY+c+"px";var s=e.getRect();e.setSize(s.width,s.height,!0),e.x=s.left,e.y=s.top}onDragRelease(){e.vkbd&&(e.vkbd.currentKey=null),this.dragPromise.resolve(),this.dragPromise.then(()=>{e.userPositioned=!0,e.doResizeMove(),e.savePersistedLayout()}),this.dragPromise=null}},this._moveHandler)}get resizeDragHandler(){let e=this;return this._resizeHandler?this._resizeHandler:(this._resizeHandler=new class extends nn{constructor(){super("se-resize")}onDragStart(){this.startWidth=e.computedWidth,this.startHeight=e.computedHeight,this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new L,e.emit("resizemove",this.dragPromise.corePromise)}onDragMove(i,c){let s=this.startWidth+i,l=this.startHeight+c;s<.2*screen.width&&(s=.2*screen.width),l<.1*screen.height&&(l=.1*screen.height),s>.9*screen.width&&(s=.9*screen.width),l>.5*screen.height&&(l=.5*screen.height),e.setSize(s,l,!0)}onDragRelease(){e.vkbd&&(e.vkbd.currentKey=null),e.vkbd&&(this.startWidth=e.computedWidth,this.startHeight=e.computedHeight),e.refreshLayout(),this.dragPromise.resolve(),this.dragPromise.then(()=>{e.doResizeMove(),e.savePersistedLayout()}),this.dragPromise=null}},this._resizeHandler)}};a(fe,"FloatingOSKView");var cn=class extends Ge{constructor(e){e.isEmbedded?e.activator=e.activator||new ut:e.activator=e.activator||new qe;super(e);this.isResizing=!1;this.restorePosition=function(e){}.bind(this);document.body.appendChild(this._Box)}_Unload(){this.keyboardView=null,this.bannerView=null,this._Box=null}setBoxStyling(){let e=this._Box.style;e.zIndex="9999",e.display="none",e.width="100%",e.position="fixed"}refreshLayout(e){if(!this.isResizing){try{this.isResizing=!0,this.doResize()}finally{this.isResizing=!1}super.refreshLayout(e)}}doResize(){if(this.vkbd){let e=this.getDefaultKeyboardHeight();this.setSize(this.getDefaultWidth(),e+this.banner.height)}}postKeyboardAdjustments(){this.doResize()}getDefaultKeyboardHeight(){var l,r;let e=this.targetDevice;if(this.configuration.heightOverride)return this.configuration.heightOverride();let t=(l=document==null?void 0:document.documentElement)==null?void 0:l.clientWidth,i=(r=document==null?void 0:document.documentElement)==null?void 0:r.clientHeight;if(typeof t=="undefined"&&(t=Math.min(screen.height,screen.width),i=Math.max(screen.height,screen.width),ge())){let B=t;t=i,i=B}var c=Math.floor(Math.min(i,t)/2),s=c;return e.formFactor=="phone"&&(ge()?s=Math.floor(i/1.6):s=Math.floor(i/2.4)),this.targetDevice.OS==G.OperatingSystem.iOS&&(s=s/Re(this.targetDevice.formFactor)),s}getDefaultWidth(){var i;let e=this.targetDevice;if(this.configuration.widthOverride)return this.configuration.widthOverride();var t;return t=(i=document==null?void 0:document.documentElement)==null?void 0:i.clientWidth,typeof t=="undefined"&&(this.targetDevice.OS==G.OperatingSystem.iOS?t=window.innerWidth:e.OS==G.OperatingSystem.Android?t=screen.availWidth:t=screen.width),t}setRect(e){}getPos(){var e=this._Box,t={left:this._Visible?e.offsetLeft:this.x,top:this._Visible?e.offsetTop:this.y};return t}setPos(e){}setDisplayPositioning(){let e=this._Box.style;this.vkbd&&(e.position="fixed",e.left=e.bottom="0px",e.border="none",e.borderTop="1px solid gray")}present(){super.present(),this.legacyEvents.callEvent("show",{})}};a(cn,"AnchoredOSKView");var sn=class extends We{constructor(){super(...arguments);this.flag=!0}get enabled(){return this.flag}set enabled(e){this.activate=e}get activate(){return this.flag}set activate(e){this.flag!=e&&(this.flag=e,this.emit("activate",e))}get conditionsMet(){return!0}};a(sn,"SimpleActivator");var ln=class extends Ge{constructor(e){e.activator=e.activator||new sn;super(e);this.restorePosition=function(e){}.bind(this)}get element(){return this._Box}_Unload(){this.keyboardView=null,this.bannerView=null,this._Box=null}setBoxStyling(){let e=this._Box.style;e.display="none",e.position="relative"}postKeyboardAdjustments(){}getDefaultKeyboardHeight(){return this.keyboardView instanceof Fe?this.keyboardView.height:this.computedHeight}getDefaultWidth(){return this.computedWidth}setRect(e){}getPos(){var e=this._Box,t={left:this._Visible?e.offsetLeft:void 0,top:this._Visible?e.offsetTop:void 0};return t}setPos(e){}present(){super.present(),this.legacyEvents.callEvent("show",{})}setDisplayPositioning(){}allowsDeviceChange(e){return!0}};a(ln,"InlinedOSKView");var ss={};Fs(ss,{AnchoredOSKView:()=>fn,FloatingOSKView:()=>kn,InlinedOSKView:()=>bc});function cs(o){return{hostDevice:o.config.hostDevice,pathConfig:o.config.paths,predictionContextManager:o.contextManager.predictionContext,isEmbedded:!1}}a(cs,"buildBaseOskConfiguration");var fn=class extends cn{constructor(n,e){let t=C(C({},cs(n)),e||{});super(t)}};a(fn,"PublishedAnchoredOSKView");var kn=class extends fe{constructor(n,e){let t=C(C({},cs(n)),e||{});super(t)}};a(kn,"PublishedFloatingOSKView");var bc=class extends ln{constructor(n,e){let t=C(C({},cs(n)),e||{});super(t)}};a(bc,"PublishedInlineOSKView");var Ul=A(R(),1);var K=class extends rt{constructor(){super(...arguments);this.events=new Ul.default;this.changed=!1}focus(){let e=this.getElement();e.focus&&e.focus()}isForcingScroll(){return!1}dispatchInputEventOn(e){let t;window.InputEvent&&(t=new InputEvent("input",{bubbles:!0,cancelable:!1})),e&&t&&e.dispatchEvent(t)}};a(K,"OutputTarget");var ke=class extends K{constructor(e){super();this.root=e,this._cachedSelectionStart=-1}get isSynthetic(){return!1}static isSupportedType(e){return e=="email"||e=="search"||e=="text"||e=="url"}getElement(){return this.root}clearSelection(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)}isSelectionEmpty(){return this.root.selectionStart==this.root.selectionEnd}hasSelection(){return!0}invalidateSelection(){this._cachedSelectionStart=-1}getCaret(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart}getDeadkeyCaret(){return this.getCaret()}setCaret(e){this.setSelection(e,e,"none")}setSelection(e,t,i){let c=this.root.value._kmwCodePointToCodeUnit(e),s=this.root.value._kmwCodePointToCodeUnit(t);this.root.setSelectionRange(c,s,i),this.processedSelectionStart=e,this.processedSelectionEnd=t,this.forceScroll(),this.root.setSelectionRange(c,s,i)}forceScroll(){let e=this.getElement(),t=e.selectionStart,i=e.selectionEnd;this._activeForcedScroll=!0;try{e.blur(),e.focus()}finally{e.selectionStart=t,e.selectionEnd=i,this._activeForcedScroll=!1}}isForcingScroll(){return this._activeForcedScroll}getSelectionDirection(){return this.root.selectionDirection}getTextBeforeCaret(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)}getSelectedText(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)}setTextBeforeCaret(e){this.getCaret();let t=this.processedSelectionEnd-this.processedSelectionStart,i=this.getSelectionDirection(),c=e._kmwLength();this.root.value=e+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(c,c+t,i)}setTextAfterCaret(e){let t=this.getCaret(),i=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+e,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,i)}getTextAfterCaret(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)}getText(){return this.root.value}deleteCharsBeforeCaret(e){if(e>0){let t=this.getTextBeforeCaret(),i=this.processedSelectionStart;e>i&&(e=i),this.adjustDeadkeys(-e),this.setTextBeforeCaret(t.kmwSubstring(0,i-e)),this.setCaret(i-e)}}insertTextBeforeCaret(e){if(!e)return;let t=this.getCaret(),i=this.getTextBeforeCaret(),c=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(e._kmwLength()),this.root.value=i+e+c,this.setCaret(t+e._kmwLength())}handleNewlineAtCaret(){let e=this.root;e&&(e.type=="search"||e.type=="submit")?(e.disabled=!1,e.form.submit()):this.events.emit("unhandlednewline",e)}doInputEvent(){this.dispatchInputEventOn(this.root)}};a(ke,"Input");var rn=class extends K{constructor(e){super();this.root=e,this._cachedSelectionStart=-1}get isSynthetic(){return!1}getElement(){return this.root}clearSelection(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)}isSelectionEmpty(){return this.root.selectionStart==this.root.selectionEnd}hasSelection(){return!0}invalidateSelection(){this._cachedSelectionStart=-1}getCaret(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart}getDeadkeyCaret(){return this.getCaret()}setCaret(e){this.setSelection(e,e,"none")}setSelection(e,t,i){let c=this.root.value._kmwCodePointToCodeUnit(e),s=this.root.value._kmwCodePointToCodeUnit(t);this.root.setSelectionRange(c,s,i),this.processedSelectionStart=e,this.processedSelectionEnd=t,this.forceScroll(),this.root.setSelectionRange(c,s,i)}forceScroll(){let e=this.getElement(),t=e.selectionStart,i=e.selectionEnd;this._activeForcedScroll=!0;try{e.blur(),e.focus()}finally{e.selectionStart=t,e.selectionEnd=i,this._activeForcedScroll=!1}}isForcingScroll(){return this._activeForcedScroll}getSelectionDirection(){return this.root.selectionDirection}getTextBeforeCaret(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)}setTextBeforeCaret(e){this.getCaret();let t=this.processedSelectionEnd-this.processedSelectionStart,i=this.getSelectionDirection(),c=e._kmwLength();this.root.value=e+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(c,c+t,i)}setTextAfterCaret(e){let t=this.getCaret(),i=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+e,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,i)}getTextAfterCaret(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)}getSelectedText(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)}getText(){return this.root.value}deleteCharsBeforeCaret(e){if(e>0){let t=this.getTextBeforeCaret(),i=this.processedSelectionStart;e>i&&(e=i),this.adjustDeadkeys(-e),this.setTextBeforeCaret(t.kmwSubstring(0,i-e)),this.setCaret(i-e)}}insertTextBeforeCaret(e){if(!e)return;let t=this.getCaret(),i=this.getTextBeforeCaret(),c=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(e._kmwLength()),this.root.value=i+e+c,this.setCaret(t+e._kmwLength())}handleNewlineAtCaret(){this.insertTextBeforeCaret(`
`)}doInputEvent(){this.dispatchInputEventOn(this.root)}};a(rn,"TextArea");var Nn=class{constructor(n,e){this.node=n,this.offset=e}};a(Nn,"SelectionCaret");var Tn=class{constructor(n,e){this.start=n,this.end=e}};a(Tn,"SelectionRange");var Qe=class{constructor(n,e){this.cmd=n,this.stateType=e}};a(Qe,"StyleCommand");var te=class extends K{constructor(e){super();if(this.root=e,e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.designMode=="on")this.doc=e.contentWindow.document,this.docRoot=e.contentWindow.document.documentElement;else throw"Specified IFrame is not in design-mode!"}get isSynthetic(){return!1}getElement(){return this.root}focus(){this.doc.defaultView.focus()}isSelectionEmpty(){return this.hasSelection()?this.doc.getSelection().isCollapsed:!0}hasSelection(){let e=this.doc.getSelection(),t=document.getSelection();return t.anchorNode==e.anchorNode&&t.focusNode==e.focusNode,!0}clearSelection(){if(this.hasSelection()){let e=this.doc.getSelection();e.isCollapsed||e.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")}invalidateSelection(){}getCarets(){let e=this.doc.getSelection(),t=e.anchorNode.compareDocumentPosition(e.focusNode);if(e.isCollapsed){let i=new Nn(e.anchorNode,e.anchorOffset);return new Tn(i,i)}else{let i=new Nn(e.anchorNode,e.anchorOffset),c=new Nn(e.focusNode,e.focusOffset);return i.node==c.node&&(t=c.offset-i.offset>0?2:4),t&2?new Tn(i,c):new Tn(c,i)}}getDeadkeyCaret(){return this.getTextBeforeCaret().kmwLength()}getTextBeforeCaret(){if(!this.hasSelection())return this.getText();let e=this.getCarets().start;return e.node.nodeType!=3?"":e.node.textContent.substr(0,e.offset)}getSelectedText(){return""}getTextAfterCaret(){if(!this.hasSelection())return"";let e=this.getCarets().end;return e.node.nodeType!=3?"":e.node.textContent.substr(e.offset)}getText(){return this.docRoot.innerText}deleteCharsBeforeCaret(e){if(!this.hasSelection()||e<=0)return;let t=this.getCarets().start;if(e>t.offset&&(e=t.offset),t.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}let i=this.doc.createRange(),c=t.offset-t.node.nodeValue.substr(0,t.offset)._kmwSubstr(-e).length;i.setStart(t.node,c),i.setEnd(t.node,t.offset),this.adjustDeadkeys(-e),i.deleteContents()}insertTextBeforeCaret(e){if(!this.hasSelection())return;let t=this.getCarets().start,i=e._kmwLength(),c=this.doc.getSelection();if(i==0)return;this.adjustDeadkeys(i);let s=this.root.ownerDocument.createRange();if(t.node.nodeType==3){let r=t.node;r.insertData(t.offset,e),s.setStart(r,t.offset+e.length)}else{var l=this.doc.createTextNode(e);let r=this.doc.createRange();r.setStart(t.node,t.offset),r.collapse(!0),r.insertNode(l),s.setStart(l,e.length)}s.collapse(!0),c.removeAllRanges();try{c.addRange(s)}catch(r){t.node.parentElement.scrollIntoView(),c.addRange(s)}c.collapseToEnd()}handleNewlineAtCaret(){}setTextAfterCaret(e){if(!this.hasSelection())return;let t=this.getCarets().end,i=e._kmwLength(),c=this.doc.getSelection();if(i!=0)if(t.node.nodeType==3){let l=t.node;l.replaceData(t.offset,l.length,e)}else{var s=t.node.ownerDocument.createTextNode(e);let l=this.root.ownerDocument.createRange();l.setStart(t.node,t.offset),l.collapse(!0),l.insertNode(s)}}saveProperties(){var e=[new Qe("backcolor",1),new Qe("fontname",1),new Qe("fontsize",1),new Qe("forecolor",1),new Qe("bold",0),new Qe("italic",0),new Qe("strikethrough",0),new Qe("subscript",0),new Qe("superscript",0),new Qe("underline",0)];this.doc.defaultView&&e.push(new Qe("hilitecolor",1));for(var t=0;t<e.length;t++){let i=e[t];i.stateType==1?i.cache=this.doc.queryCommandValue(i.cmd):i.cache=this.doc.queryCommandState(i.cmd)}this.commandCache=e}restoreProperties(e){this.commandCache||console.error("No command cache exists to restore!");for(var t=0;t<this.commandCache.length;t++){let i=this.commandCache[t];i.stateType==1?this.doc.queryCommandValue(i.cmd)!=i.cache&&(e&&e(),this.doc.execCommand(i.cmd,!1,i.cache)):this.doc.queryCommandState(i.cmd)!=i.cache&&(e&&e(),this.doc.execCommand(i.cmd,!1,null))}}doInputEvent(){this.dispatchInputEventOn(this.root)}};a(te,"DesignIFrame");var Mn=class{constructor(n,e){this.node=n,this.offset=e}};a(Mn,"SelectionCaret");var Yn=class{constructor(n,e){this.start=n,this.end=e}};a(Yn,"SelectionRange");var Ut=class extends K{constructor(e){var n=(...args)=>{super(...args)};if(e.isContentEditable)n(),this.root=e;else throw"Specified element is not already content-editable!"}get isSynthetic(){return!1}getElement(){return this.root}isSelectionEmpty(){return this.hasSelection()?this.root.ownerDocument.getSelection().isCollapsed:!0}hasSelection(){let e=this.root.ownerDocument.getSelection();return!(this.root!=e.anchorNode&&!this.root.contains(e.anchorNode)||this.root!=e.focusNode&&!this.root.contains(e.focusNode))}clearSelection(){if(this.hasSelection()){let e=this.root.ownerDocument.getSelection();e.isCollapsed||e.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")}invalidateSelection(){}getCarets(){let e=this.root.ownerDocument.getSelection(),t=e.anchorNode.compareDocumentPosition(e.focusNode);if(e.isCollapsed){let i=new Mn(e.anchorNode,e.anchorOffset);return new Yn(i,i)}else{let i=new Mn(e.anchorNode,e.anchorOffset),c=new Mn(e.focusNode,e.focusOffset);return i.node==c.node&&(t=c.offset-i.offset>0?2:4),t&2?new Yn(i,c):new Yn(c,i)}}getDeadkeyCaret(){return this.getTextBeforeCaret().kmwLength()}getTextBeforeCaret(){if(!this.hasSelection())return this.getText();let e=this.getCarets().start;return e.node.nodeType!=3?"":e.node.textContent.substr(0,e.offset)}getSelectedText(){return""}getTextAfterCaret(){if(!this.hasSelection())return"";let e=this.getCarets().end;return e.node.nodeType!=3?"":e.node.textContent.substr(e.offset)}getText(){return this.root.innerText}deleteCharsBeforeCaret(e){if(!this.hasSelection()||e<=0)return;let t=this.getCarets().start;if(e>t.offset&&(e=t.offset),t.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}let i=this.root.ownerDocument.createRange(),c=t.offset-t.node.nodeValue.substr(0,t.offset)._kmwSubstr(-e).length;i.setStart(t.node,c),i.setEnd(t.node,t.offset),this.adjustDeadkeys(-e),i.deleteContents()}insertTextBeforeCaret(e){if(!this.hasSelection())return;let t=this.getCarets().start,i=e._kmwLength(),c=this.root.ownerDocument.getSelection();if(i==0)return;this.adjustDeadkeys(i);let s=this.root.ownerDocument.createRange();if(t.node.nodeType==3){let r=t.node;r.insertData(t.offset,e),s.setStart(r,t.offset+e.length)}else{var l=t.node.ownerDocument.createTextNode(e);let r=this.root.ownerDocument.createRange();r.setStart(t.node,t.offset),r.collapse(!0),r.insertNode(l),s.setStart(l,e.length)}s.collapse(!0),c.removeAllRanges();try{c.addRange(s)}catch(r){t.node.parentElement.scrollIntoView(),c.addRange(s)}c.collapseToEnd()}handleNewlineAtCaret(){}setTextAfterCaret(e){if(!this.hasSelection())return;let t=this.getCarets().end,i=e._kmwLength(),c=this.root.ownerDocument.getSelection();if(i!=0)if(t.node.nodeType==3){let l=t.node;l.replaceData(t.offset,l.length,e)}else{var s=t.node.ownerDocument.createTextNode(e);let l=this.root.ownerDocument.createRange();l.setStart(t.node,t.offset),l.collapse(!0),l.insertNode(s)}}doInputEvent(){this.dispatchInputEventOn(this.root)}};a(Ut,"ContentEditable");function ne(o,n){var e;if(!o)return!1;if(o.Window)return n=="Window";if(o.defaultView)e=o.defaultView[n];else if(o.ownerDocument)e=o.ownerDocument.defaultView[n];else if(o.target){var t=o;this.instanceof(t.target,"Window")?e=t.target[n]:this.instanceof(t.target,"Document")?e=t.target.defaultView[n]:this.instanceof(t.target,"HTMLElement")&&(e=t.target.ownerDocument.defaultView[n])}return e?o instanceof e:!1}a(ne,"nestedInstanceOf");function Cc(o){if(ne(o,"HTMLInputElement"))return new ke(o);if(ne(o,"HTMLTextAreaElement"))return new rn(o);if(ne(o,"HTMLIFrameElement")){let n=o;return n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.designMode=="on"?new te(n):o.isContentEditable?new Ut(o):null}else if(o.isContentEditable)return new Ut(o);return null}a(Cc,"wrapElement");var $e=class{constructor(){this.pending=!1;let n=this.bg=document.createElement("div"),e=this.lb=document.createElement("div"),t=this.lt=document.createElement("div"),i=this.gr=document.createElement("div"),c=this.bx=document.createElement("div");n.className="kmw-wait-background",e.className="kmw-wait-box",this.dismiss=null,t.className="kmw-wait-text",i.className="kmw-wait-graphic",c.className="kmw-alert-close",e.onmousedown=e.onclick=s=>{c.style.display=="block"&&(n.style.display="none",this.dismiss&&this.dismiss())},e.addEventListener("touchstart",e.onclick,!1),n.onmousedown=n.onclick=s=>{s.preventDefault(),s.stopPropagation()},n.addEventListener("touchstart",n.onclick,!1),e.appendChild(c),e.appendChild(t),e.appendChild(i),n.appendChild(e),document.body.appendChild(n)}get rootElement(){return this.bg}wait(n){let e=this.bg;typeof e=="undefined"||e==null||(n?(this.pending=!0,window.setTimeout(()=>{this.pending&&(window.scrollTo(0,0),this.bx.style.display="none",this.lt.className="kmw-wait-text",this.lt.innerHTML=n,this.gr.style.display="block",e.style.display="block")},1e3)):this.pending&&(this.lt.innerHTML="",this.pending=!1,e.style.display="none"))}alert(n,e){let t=this.bg;this.bx.style.display="block",this.lt.className="kmw-alert-text",this.lt.innerHTML=n,this.gr.style.display="none",t.style.display="block",this.dismiss=arguments.length>1?e:null}shutdown(){this.bg.parentNode.removeChild(this.bg)}};a($e,"AlertHost");function Zi(){return document.readyState==="complete"?Promise.resolve():new Promise((o,n)=>{let e=a(()=>{window.removeEventListener("load",e),o()},"loadHandler");window.addEventListener("load",e)})}a(Zi,"whenDocumentReady");var Si=class extends hn{initialize(e){this._options?this._options=C(C({},this._options),e):this._options=C({},e),super.initialize(e),this._options=e,this._ui=e.ui,this._attachType=e.attachType,Zi().then(()=>{var t;e.useAlerts&&!this.alertHost?this._alertHost=new $e:!e.useAlerts&&this.alertHost&&((t=this._alertHost)==null||t.shutdown(),this._alertHost=null)})}get options(){return this._options}get attachType(){return this._attachType}get alertHost(){return this._alertHost}set signalUser(e){(!e||e!=this.alertHost)&&this.alertHost.shutdown(),this._alertHost=e}debugReport(){let e=super.debugReport();return e.attachType=this.attachType,e.ui=this._ui,e.keymanEngine="app/browser",e}onRuleFinalization(e,t){let i=e.transcription.transform;In(i)||t instanceof K&&(t.changed=!0)}};a(Si,"BrowserConfiguration");var hl=C({ui:"",attachType:"",useAlerts:!0},Ec);var wn=class{constructor(n,e,t){this.interface=n,this.keyboard=e}};a(wn,"AttachmentInfo");function et(o){let n=o==null?void 0:o.target;return tt(n)}a(et,"eventOutputTarget");function tt(o){var n;if(o==null)return null;if(o.body&&(o=o.body),o.nodeType==3&&(o=o.parentNode),ne(o,"HTMLInputElement")){let e=o.type.toLowerCase();if(!(e=="text"||e=="search"))return null}return(n=o._kmwAttachment)==null?void 0:n.interface}a(tt,"outputTargetForElement");var bl=A(R(),1);var ht=class extends bl.default{constructor(e,t){if(!e)throw new Error("Cannot attach to a null/undefined document");super();this.baseFont="";this.appliedFont="";this.embeddedPageContexts=[];this._inputList=[];this._sortedInputs=[];this._InputModeObserverCore=a(e=>{this.disableInputModeObserver();try{for(let t of e){let i=t.target;!this.isAttached(i)||(i._kmwAttachment.inputMode=i.inputMode,this.device.touchable&&(i.inputMode="none"))}}finally{this.enableInputModeObserver()}},"_InputModeObserverCore");this._EnablementMutationObserverCore=a(e=>{for(var t=0;t<e.length;t++){var i=e[t],c=i.oldValue?i.oldValue.indexOf("kmw-disabled")>=0:!1,s=i.target.className.indexOf("kmw-disabled")>=0;if(c&&!s?this._EnableControl(i.target):!c&&s&&this._DisableControl(i.target),!s&&i.attributeName=="readonly"){var l=i.oldValue?i.oldValue!=null:!1,r=i.target;if(r instanceof r.ownerDocument.defaultView.HTMLInputElement||r instanceof r.ownerDocument.defaultView.HTMLTextAreaElement){var B=r.readOnly;l&&!B?this._EnableControl(i.target):!l&&B&&this._DisableControl(i.target)}}}},"_EnablementMutationObserverCore");this._AutoAttachObserverCore=a(e=>{for(var t=[],i=[],c=0;c<e.length;c++){let r=e[c];for(var s=0;s<r.addedNodes.length;s++)t=t.concat(this._GetDocumentEditables(r.addedNodes[s]));for(s=0;s<r.removedNodes.length;s++)i=i.concat(this._GetDocumentEditables(r.removedNodes[s]))}for(var l=0;l<t.length;l++)this.isKMWInput(t[l])&&this._MutationAdditionObserved(t[l]);for(l=0;l<i.length;l++){let r=!1,B=i[l];if(B instanceof B.ownerDocument.defaultView.HTMLIFrameElement){for(let d=0;d<this.embeddedPageContexts.length;d++)if(this.embeddedPageContexts[d].options.owner==B){this.embeddedPageContexts[d].shutdown(),this.embeddedPageContexts.splice(d,1),r=!0;break}if(!r){for(let d=0;d<this._inputList.length;d++)if(this._inputList[d]==B){this.detachFromControl(B),this._inputList[d]==B&&this._inputList.splice(d,1);break}}}else this.isKMWInput(B)&&this._MutationRemovalObserved(B)}(t.length||i.length)&&(this.device.touchable?this.device.touchable&&window.setTimeout(()=>{this.listInputs()},1):this.listInputs())},"_AutoAttachObserverCore");this._MutationAdditionObserved=a(e=>{if(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement){let t=a(()=>{window.setTimeout(()=>{this.attachToControl(e)},1)},"attachFunctor");e.addEventListener("load",t)}else this.attachToControl(e)},"_MutationAdditionObserved");this._MutationRemovalObserved=a(e=>{this.detachFromControl(e)},"_MutationRemovalObserved");this.options=t,this.document=e,this.stylesheetManager=new Ue(this.document.body)}get device(){return this.options.hostDevice}get window(){return this.document.defaultView}get inputList(){let e=this.embeddedPageContexts.map(t=>t.inputList).reduce((t,i)=>t.concat(i),[]);return[].concat(this._inputList).concat(e)}get sortedInputs(){return this._sortedInputs}install(e){this.manualAttach=e,this.baseFont=this.getBaseFont(),this.manualAttach||(this._SetupDocument(this.document.documentElement),this.listInputs()),this.options.owner||this.initMutationObservers(this.document,e)}setupElementAttachment(e){if(!e._kmwAttachment){let t=Cc(e);t||ne(e,"HTMLIFrameElement")||console.warn("Could not create processing interface for newly-attached element!"),e._kmwAttachment=new wn(t,null,this.device.touchable)}}clearElementAttachment(e){e._kmwAttachment=null}isKMWInput(e){if(e instanceof e.ownerDocument.defaultView.HTMLTextAreaElement)return!0;if(e instanceof e.ownerDocument.defaultView.HTMLInputElement){if(ke.isSupportedType(e.type))return!0}else if(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)try{if(e.contentWindow){let t=e.contentWindow.document;if(t)return!(this.device.touchable&&t.designMode.toLowerCase()=="on")}else return!!e._kmwAttachment}catch(t){console.warn("Error during attachment to / detachment from iframe: "),console.warn(t)}else if(e.isContentEditable)return!0;return!1}isAttached(e){if(e._kmwAttachment)return!0;if(ne(e,"HTMLIFrameElement")){if(e.contentDocument==this.document)return!0;for(let i of this.embeddedPageContexts)if(i.isAttached(e))return!0}return!1}isKMWDisabled(e){let t=e.className;return e.readOnly?!0:!!(t&&t.indexOf("kmw-disabled")>=0)}enableInputElement(e){var t;this.isKMWDisabled(e)||(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement?this._AttachToIframe(e):(this.setupElementAttachment(e),e._kmwAttachment.inputMode=(t=e.inputMode)!=null?t:"text",this.disableInputModeObserver(),e.inputMode="none",this.enableInputModeObserver(),e.classList.add("keymanweb-font"),this._inputList.push(e),this.emit("enabled",e)))}disableInputElement(e){var i;if(!!e)if(e.ownerDocument.defaultView&&e instanceof e.ownerDocument.defaultView.HTMLIFrameElement||e instanceof HTMLIFrameElement)this._DetachFromIframe(e);else{if(this.isAttached(e)){let s=(i=e._kmwAttachment)==null?void 0:i.inputMode;this.disableInputModeObserver(),e.inputMode=s,this.enableInputModeObserver()}e.className.indexOf("keymanweb-font")>=0&&(e.className=e.className.replace("keymanweb-font","").trim());var t=this.inputList.indexOf(e);t>-1&&this._inputList.splice(t,1),this.emit("disabled",e)}}enableTouchElement(e){return this.isKMWDisabled(e)?(this.emit("disabled",e),!1):(this.isAttached(e)||this.setupElementAttachment(e),this.enableInputElement(e),!0)}disableTouchElement(e){if(this.isAttached(e)){let t=e._kmwAttachment.inputMode;this.disableInputModeObserver(),e.inputMode=t,this.enableInputModeObserver()}}_AttachToIframe(e){try{let t=e.contentWindow.document;if(t){if(t.designMode.toLowerCase()=="on")this.setupElementAttachment(e),t.body._kmwAttachment=e._kmwAttachment,this._inputList.push(e),this.emit("enabled",e);else if(this.embeddedPageContexts.filter(i=>i.document==t).length==0){let i=new ht(t,X(C({},this.options),{owner:e}));this.embeddedPageContexts.push(i),i.on("enabled",c=>this.emit("enabled",c)),i.on("disabled",c=>this.emit("disabled",c)),i.install(this.manualAttach)}}}catch(t){}}_DetachFromIframe(e){let t=a(()=>{this.clearElementAttachment(e);let i=this._inputList.indexOf(e);i!=-1&&this._inputList.splice(i,1),this.emit("disabled",e)},"detachFromDesignIframe");try{let i=e.contentWindow.document;if(i){if(i.designMode.toLowerCase()=="on")i.body._kmwAttachment=null,t();else for(let c=0;c<this.embeddedPageContexts.length;c++)if(this.embeddedPageContexts[c].document==i){let s=this.embeddedPageContexts.splice(c,1)[0];s._ClearDocument(i.body),s.shutdown(),this.embeddedPageContexts.splice(c,1);break}}}catch(i){e._kmwAttachment&&t()}}attachToControl(e){var t=this.device.touchable;this.isAttached(e)&&!(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(e)?this.isKMWDisabled(e)?this.emit("disabled",e):t?this.enableTouchElement(e):this.enableInputElement(e):t&&this.emit("disabled",e))}detachFromControl(e){!(this.isAttached(e)||e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(e)&&(this.isKMWDisabled(e)||this._DisableControl(e)),this.clearElementAttachment(e))}_DisableControl(e){(this.isAttached(e)||e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)&&(this.device.touchable&&this.disableTouchElement(e),this.listInputs(),this.disableInputElement(e))}_EnableControl(e){this.isAttached(e)?(this.device.touchable?this.enableTouchElement(e):this.enableInputElement(e),this.listInputs()):ne(e,"HTMLIFrameElement")&&this._AttachToIframe(e)}disableControl(e){this.isAttached(e)||console.warn("KeymanWeb is not attached to element "+e);var t=e.className;t.indexOf("kmw-disabled")<0&&(e.className=t?t+" kmw-disabled":"kmw-disabled")}enableControl(e){!this.isAttached(e)&&!ne(e,"HTMLIFrameElement")&&console.warn("KeymanWeb is not attached to element "+e);var t=e.className,i=t.indexOf("kmw-disabled");i>=0&&(e.className=t.replace("kmw-disabled","").trim())}listInputs(){let e=[],t=document.getElementsByTagName("input"),i=document.getElementsByTagName("textarea");for(let s=0;s<t.length;s++)ke.isSupportedType(t[s].type)&&t[s].className.indexOf("kmw-disabled")<0&&e.push({ip:t[s],x:q(t[s]),y:$(t[s])});for(let s=0;s<i.length;s++)i[s].className.indexOf("kmw-disabled")<0&&e.push({ip:i[s],x:q(i[s]),y:$(i[s])});e.sort((s,l)=>s.y!=l.y?s.y-l.y:s.x-l.x);let c=[];for(let s=0;s<e.length;s++)c.push(e[s].ip);this._sortedInputs=c}findNeighboringInput(e,t){var i,c=this.sortedInputs;if(c.length==0)return null;for(i=0;i<c.length&&c[i]!=e;i++);return i==c.length&&!t&&i--,i=t?i-1:i+1,i=i>=c.length?i-c.length:i,i=i<0?i+c.length:i,c[i]}_GetDocumentEditables(e){let t=[];if(e.ownerDocument&&e instanceof e.ownerDocument.defaultView.HTMLElement){let c=e.ownerDocument.defaultView;(e instanceof c.HTMLInputElement||e instanceof c.HTMLTextAreaElement||e instanceof c.HTMLIFrameElement)&&t.push(e)}if(e.getElementsByTagName){var i=a(function(c){return sc(e.getElementsByTagName(c))},"LiTmp");t=t.concat(i("INPUT"),i("TEXTAREA"),i("IFRAME"))}return e.querySelectorAll&&(t=t.concat(sc(e.querySelectorAll("[contenteditable]")))),e.ownerDocument&&e instanceof e.ownerDocument.defaultView.HTMLElement&&e.isContentEditable&&t.push(e),t}_SetupDocument(e){let t=this._GetDocumentEditables(e);for(var i=0;i<t.length;i++)this.attachToControl(t[i])}_ClearDocument(e){let t=this._GetDocumentEditables(e);for(var i=0;i<t.length;i++)this.detachFromControl(t[i])}initMutationObservers(e,t){if(typeof MutationObserver=="function"){var i=e.querySelector("body"),c;t||(c={childList:!0,subtree:!0},this.attachmentObserver=new MutationObserver(this._AutoAttachObserverCore),this.attachmentObserver.observe(i,c)),c={subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["class","readonly"]},this.enablementObserver=new MutationObserver(this._EnablementMutationObserverCore),this.enablementObserver.observe(i,c),this.inputModeObserver=new MutationObserver(this._InputModeObserverCore),this.enableInputModeObserver()}else console.warn("Your browser is outdated and does not support MutationObservers, a web feature needed by KeymanWeb to support dynamically-added elements.")}enableInputModeObserver(){var i;let e=document.querySelector("body"),t={subtree:!0,attributes:!0,attributeFilter:["inputmode"]};(i=this.inputModeObserver)==null||i.observe(e,t)}disableInputModeObserver(){var e;(e=this.inputModeObserver)==null||e.disconnect()}getBaseFont(){var e=document.getElementsByTagName("input"),t=document.getElementsByTagName("textarea"),i=0,c,s="Arial,sans-serif";if(e.length==0&&t.length==0)i=0;else if(e.length>0&&t.length==0)i=1;else if(e.length==0&&t.length>0)i=2;else{var l=e[0],r=t[0];l.offsetTop<r.offsetTop?i=1:l.offsetTop>r.offsetTop?i=2:l.offsetLeft<r.offsetLeft?i=1:l.offsetLeft>r.offsetLeft&&(i=2)}switch(i){case 0:c=s;break;case 1:c=getComputedStyle(e[0]).fontFamily||"";break;case 2:c=getComputedStyle(t[0]).fontFamily||"";break}return(typeof c=="undefined"||c=="monospace")&&(c=s),c}buildAttachmentFontStyle(e){let t=e,i=this.baseFont;t&&typeof t.family!="undefined"&&(i=t.family),i=i.replace(/\u0022/g,"");var c=new RegExp("\\s?"+i+",?"),s=this.appliedFont.replace(/\u0022/g,"");s=s.replace(c,""),s=s.replace(/,$/,""),s==""?s=i:s=i+","+s,s='"'+s.replace(/\,\s?/g,'","')+'"';let l=`.keymanweb-font{
font-family:`+s+` !important;
}
`;return this.appliedFont=s,l}setAttachmentFont(e,t,i){this.stylesheetManager.unlinkAll(),this.stylesheetManager.addStyleSheetForFont(e,t,i),this.stylesheetManager.linkStylesheet(gt(this.buildAttachmentFontStyle(e)))}shutdown(){var e,t,i,c;try{(e=this.enablementObserver)==null||e.disconnect(),(t=this.attachmentObserver)==null||t.disconnect(),(i=this.inputModeObserver)==null||i.disconnect(),(c=this.stylesheetManager)==null||c.unlinkAll(),this.inputModeObserver=null,this.embeddedPageContexts.forEach(s=>{try{s.shutdown()}catch(l){}});for(let s of this.inputList)try{this.detachFromControl(s)}catch(l){this.emit("disabled",s)}this._inputList=[]}catch(s){console.error("Error occurred during shutdown"),console.error(s)}}};a(ht,"PageContextAttachment");var Cl=A(R(),1);var xc=class{constructor(n,e){this.activationPending=n,this.activated=e}};a(xc,"FocusStateAPIObject");var Ji=class extends Cl.default{constructor(e){super();this._maintainingFocus=!1;this.restoringFocus=!1;this._IgnoreNextSelChange=0;this.isTargetForcingScroll=e}get maintainingFocus(){return this._maintainingFocus}set maintainingFocus(e){let t=this._maintainingFocus;this._maintainingFocus=e,t&&!e&&this.emit("maintainingfocusend")}getUIState(){return new xc(this.maintainingFocus,this.restoringFocus)}setMaintainingFocus(e){this.maintainingFocus=!!e}setFocusTimer(){this.focusing=!0,this.focusTimer=window.setTimeout(function(){this.focusing=!1}.bind(this),50)}};a(Ji,"FocusAssistant");function xl(o,n){let e=n!=null&&n.isRTL?"rtl":"ltr";o&&(o instanceof o.ownerDocument.defaultView.HTMLInputElement||o instanceof o.ownerDocument.defaultView.HTMLTextAreaElement?o.value.length==0&&(o.dir=e):typeof o.textContent=="string"&&o.textContent.length==0&&(o.dir=e))}a(xl,"_SetTargDir");var bt=class extends Ht{constructor(e,t){super(e);this.cookieManager=new le("KeymanWeb_Keyboard");this.focusAssistant=new Ji(()=>{var e;return(e=this.activeTarget)==null?void 0:e.isForcingScroll()});this.domEventTracker=new xe;this._ControlFocus=a(e=>{let t=et(e);return t&&this.setActiveTarget(t,!0),!0},"_ControlFocus");this._ControlBlur=a(e=>{if(this.focusAssistant._IgnoreNextSelChange)return this.focusAssistant._IgnoreNextSelChange--,e.cancelBubble=!0,e.stopPropagation(),!0;if(this.focusAssistant.isTargetForcingScroll())return e.cancelBubble=!0,e.stopPropagation(),!0;let t=et(e);if(t==null)return!0;this.lastActiveTarget&&this._BlurKeyboardSettings(this.lastActiveTarget.getElement());let i=this.activeTarget;this.currentTarget=null,(i||this.lastActiveTarget)&&(this.mostRecentTarget=t),this.focusAssistant.restoringFocus=!1;let c=this.activeKeyboard,s=this.focusAssistant.maintainingFocus;return!s&&c&&c.keyboard.notify(0,t,0),i&&!this.activeTarget&&this.emit("targetchange",null),this.apiEvents.callEvent("controlblurred",{target:t.getElement(),event:e,isActivating:s}),this.doChangeEvent(t),this.resetContext(),!0},"_ControlBlur");this._Click=a(e=>(this.resetContext(),!0),"_Click");this.nonKMWTouchHandler=a(e=>{this.focusAssistant.focusing=!1,clearTimeout(this.focusAssistant.focusTimer),this.forgetActiveTarget()},"nonKMWTouchHandler");this._eventsObj=t,this.page=new ht(window.document,{hostDevice:this.engineConfig.hostDevice}),this.focusAssistant.on("maintainingfocusend",()=>{!this.activeTarget&&this.mostRecentTarget&&this.emit("targetchange",this.activeTarget)})}get apiEvents(){return this._eventsObj()}initialize(){this.on("keyboardasyncload",(e,t)=>{var i;(i=this.engineConfig.alertHost)==null||i.wait("Installing keyboard<br/>"+e.name),t.then(()=>{var c;(c=this.engineConfig.alertHost)==null||c.wait()})}),this.engineConfig.deferForInitialization.then(()=>{let e=this.engineConfig.hostDevice,t=a(i=>i.stopPropagation(),"noPropagation");this.page.on("enabled",i=>{if(!(i._kmwAttachment.interface instanceof te))e.touchable&&(this.domEventTracker.detachDOMEvent(i,"touchstart",this.nonKMWTouchHandler),this.domEventTracker.attachDOMEvent(i,"touchmove",t,!1),this.domEventTracker.attachDOMEvent(i,"touchend",t,!1)),this.domEventTracker.attachDOMEvent(i,"focus",this._ControlFocus),this.domEventTracker.attachDOMEvent(i,"blur",this._ControlBlur),this.domEventTracker.attachDOMEvent(i,"click",this._Click);else{var c=i.contentWindow.document;e.browser=="firefox"?(this.domEventTracker.attachDOMEvent(c,"focus",this._ControlFocus),this.domEventTracker.attachDOMEvent(c,"blur",this._ControlBlur)):(this.domEventTracker.attachDOMEvent(c.body,"focus",this._ControlFocus),this.domEventTracker.attachDOMEvent(c.body,"blur",this._ControlBlur))}}),this.page.on("disabled",i=>{var s;if(!ne(i,"HTMLIFrameElement"))e.touchable&&this.domEventTracker.attachDOMEvent(i,"touchstart",this.nonKMWTouchHandler,!1),this.domEventTracker.detachDOMEvent(i,"focus",this._ControlFocus),this.domEventTracker.detachDOMEvent(i,"blur",this._ControlBlur),this.domEventTracker.detachDOMEvent(i,"click",this._Click);else{let l=i.contentWindow.document;e.browser=="firefox"?(this.domEventTracker.detachDOMEvent(l,"focus",this._ControlFocus),this.domEventTracker.detachDOMEvent(l,"blur",this._ControlBlur)):(this.domEventTracker.detachDOMEvent(l.body,"focus",this._ControlFocus),this.domEventTracker.detachDOMEvent(l.body,"blur",this._ControlBlur))}var c=(s=this.mostRecentTarget)==null?void 0:s.getElement();c&&c==i&&this.forgetActiveTarget()}),this.page.install(this.engineConfig.attachType=="manual")})}get activeTarget(){let e=this.focusAssistant.maintainingFocus;return this.currentTarget||(e?this.mostRecentTarget:null)}get lastActiveTarget(){return this.mostRecentTarget}deactivateCurrentTarget(){let e=this.activeTarget||this.lastActiveTarget;e&&this.page.isAttached(e.getElement())&&this._BlurKeyboardSettings(e.getElement()),this.activeTarget||this.setActiveTarget(null,!0)}forgetActiveTarget(){this.focusAssistant.maintainingFocus=!1,this.focusAssistant.restoringFocus=!1;let e=this.activeTarget||this.mostRecentTarget;e&&this._BlurKeyboardSettings(e.getElement()),this.setActiveTarget(null,!0),e==this.lastActiveTarget&&(this.mostRecentTarget=null)}setActiveTarget(e,t){var r;let i=this.mostRecentTarget,c=this.activeTarget;if(e==c){c&&(this.currentTarget=c);return}let s=!!i;if(this.currentTarget=this.mostRecentTarget=e,this.predictionContext.setCurrentTarget(e),this.focusAssistant.restoringFocus?this._BlurKeyboardSettings(e.getElement()):e&&this._FocusKeyboardSettings(e.getElement(),!s),this._CommonFocusHelper(e))return!0;let l=e==null?void 0:e.getElement();e instanceof te&&(l=e.docRoot),l&&l.ownerDocument&&l instanceof l.ownerDocument.defaultView.HTMLElement&&xl(l,(r=this.activeKeyboard)==null?void 0:r.keyboard),e!=c&&this.emit("targetchange",e),t&&this.apiEvents.callEvent("controlfocused",{target:(e==null?void 0:e.getElement())||null,activeControl:i==null?void 0:i.getElement()})}get activeKeyboard(){return this._activeKeyboard}restoreLastActiveTarget(){!this.mostRecentTarget||(this.focusAssistant.restoringFocus=!0,this.mostRecentTarget.focus(),this.focusAssistant.restoringFocus=!1)}insertText(e,t,i){this.restoreLastActiveTarget();let c=this.activeTarget;return c==null&&this.mostRecentTarget&&(c=this.activeTarget),c!=null?super.insertText(e,t,i):!1}currentKeyboardSrcTarget(){let e=this.currentTarget||this.mostRecentTarget;return this.isTargetKeyboardIndependent(e)?e:null}isTargetKeyboardIndependent(e){let t=e==null?void 0:e.getElement()._kmwAttachment;return!!((t==null?void 0:t.keyboard)||(t==null?void 0:t.keyboard)==="")}activateKeyboardForTarget(e,t){var c,s;let i=t==null?void 0:t.getElement()._kmwAttachment;if(i?(i.keyboard=(c=e==null?void 0:e.metadata.id)!=null?c:"",i.languageCode=(s=e==null?void 0:e.metadata.langId)!=null?s:""):this.globalKeyboard=e,this.currentKeyboardSrcTarget()==t){this._activeKeyboard=e;let l=e==null?void 0:e.metadata;this.page.setAttachmentFont(l==null?void 0:l.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS)}}setKeyboardForTarget(e,t,i){if(e instanceof te){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}let c=e.getElement()._kmwAttachment,s=this.currentKeyboardSrcTarget()==e;if(c){if(c.keyboard=t||null,c.languageCode=i||null,s||this.currentKeyboardSrcTarget()==e){let l=this.globalKeyboard.metadata;this.activateKeyboard(c.keyboard||l.id,c.languageCode||l.langId,!0)}}else return}getKeyboardStubForTarget(e){if(this.isTargetKeyboardIndependent(e)){let t=e.getElement()._kmwAttachment;return this.keyboardCache.getStub(t.keyboard,t.languageCode)}else return this.globalKeyboard.metadata}getFallbackStubKey(){let e={id:"",langId:""};return this.engineConfig.hostDevice.touchable&&this.keyboardCache.defaultStub||e}activateKeyboard(e,t,i){return Z(this,null,function*(){var s,l,r,B,d,g;i||(i=!1);let c=this.currentKeyboardSrcTarget();e||(e=this.getFallbackStubKey().id,t=this.getFallbackStubKey().langId);try{let F=yield Ti(bt.prototype,this,"activateKeyboard").call(this,e,t,i);return(s=this.engineConfig.alertHost)==null||s.wait(),i&&!c&&this.cookieManager.save({current:`${e}:${t}`}),c==this.currentKeyboardSrcTarget()&&(xl((l=this.currentTarget)==null?void 0:l.getElement(),this.keyboardCache.getKeyboard(e)),this.page.setAttachmentFont((B=(r=this.activeKeyboard)==null?void 0:r.metadata)==null?void 0:B.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS),this.restoreLastActiveTarget()),F}catch(F){let Q=a(()=>Z(this,null,function*(){let u=this.getFallbackStubKey();u.id!=e&&(yield this.activateKeyboard(u.id,u.langId,!0).catch(()=>{}))}),"fallback");(d=this.engineConfig.alertHost)==null||d.wait();let y=(F==null?void 0:F.message)||"Sorry, the "+e+" keyboard for "+t+" is not currently available.";throw F instanceof st?console.error(F||y):console.warn(F||y),this.engineConfig.alertHost?(g=this.engineConfig.alertHost)==null||g.alert(y,Q):yield Q(),F}})}_BlurKeyboardSettings(e,t,i){var l;var c=this.activeKeyboard?this.activeKeyboard.keyboard.id:"",s=(l=this.activeKeyboard)==null?void 0:l.metadata.langId;t!==void 0&&i!==void 0&&(c=t,s=i),e&&e._kmwAttachment.keyboard!=null?(e._kmwAttachment.keyboard=c,e._kmwAttachment.languageCode=s):this.globalKeyboard=this.activeKeyboard}_FocusKeyboardSettings(e,t){var s;let i=e._kmwAttachment,c=this.globalKeyboard;i.keyboard!=null?this.activateKeyboard(i.keyboard,i.languageCode,!0):!t&&(c==null?void 0:c.metadata)!=((s=this._activeKeyboard)==null?void 0:s.metadata)&&this.activateKeyboard(c==null?void 0:c.metadata.id,c==null?void 0:c.metadata.langId,!0)}_CommonFocusHelper(e){var c;let t=this.focusAssistant,i=(c=this.activeKeyboard)==null?void 0:c.keyboard;return t.restoringFocus||(e==null||e.deadkeys().clear(),i==null||i.notify(0,e,1)),!t.restoringFocus&&this.mostRecentTarget!=e&&(t.maintainingFocus=!1),t.restoringFocus=!1,this.resetContext(),!1}doChangeEvent(e){if(e.changed){let t=new Event("change",{bubbles:!0,cancelable:!1});e.getElement().dispatchEvent(t)}e.changed=!1}getSavedKeyboardRaw(){var t=new le("KeymanWeb_Keyboard").load(decodeURIComponent);return typeof t.current!="string"||t.current=="Keyboard_us:eng"?"Keyboard_us:en":t.current}getSavedKeyboard(){let e=this.getSavedKeyboardRaw(),t=this.keyboardCache.getStubList(),i;for(let c=0;c<t.length;c++)if(i=t[c].KI+":"+t[c].KLC,i==e)return i;for(let c=0;c<t.length;c++)if(i=t[c].KI+":"+t[c].KLC,i=="Keyboard_us:en")return i;return t.length>0?t[0].KI+":"+t[0].KLC:"Keyboard_us:en"}restoreSavedKeyboard(e){let i=e.split(":");i.length<2&&(i[1]=""),(this.keyboardCache.getStub(i[0],i[1])||this.keyboardCache.defaultStub)&&this.activateKeyboard(i[0],i[1])}shutdown(){this.page.shutdown(),this.domEventTracker.shutdown()}};a(bt,"ContextManager");var Dn=class extends Le{constructor(e){super();this.contextManager=e}isCommand(e){switch(this.codeForEvent(e)){case h.keyCodes.K_TAB:case h.keyCodes.K_TABBACK:case h.keyCodes.K_TABFWD:return!0;default:return super.isCommand(e)}}applyCommand(e,t){let i=this.codeForEvent(e),c=a(s=>{var d;let l=this.contextManager,r=(d=l.activeTarget)==null?void 0:d.getElement();l.page.findNeighboringInput(r,s).focus()},"moveToNext");switch(i){case h.keyCodes.K_TAB:c((e.Lmodifiers&h.modifierCodes.SHIFT)!=0);break;case h.keyCodes.K_TABBACK:c(!0);break;case h.keyCodes.K_TABFWD:c(!1);break}super.applyCommand(e,t)}};a(Dn,"DefaultBrowserRules");function ls(o){return o.keyCode?o.keyCode:o.which?o.which:null}a(ls,"_GetEventKeyCode");function mc(o,n,e){if(o.cancelBubble===!0)return null;let t=ls(o);if(t==null)return null;var i=n.modStateFlags,c=0,s=!1,l=!1;let r=h.keyCodes;switch(t){case r.K_CTRL:case r.K_LCTRL:case r.K_RCTRL:case r.K_CONTROL:case r.K_LCONTROL:case r.K_RCONTROL:s=!0;break;case r.K_LMENU:case r.K_RMENU:case r.K_ALT:case r.K_LALT:case r.K_RALT:l=!0;break}c|=o.getModifierState("Shift")?16:0;let B=h.modifierCodes;o.getModifierState("Control")&&(c|=o.location!=0&&s?o.location==1?B.LCTRL:B.RCTRL:i&3),o.getModifierState("Alt")&&(c|=o.location!=0&&l?o.location==1?B.LALT:B.RALT:i&12);let d=0;d|=o.getModifierState("CapsLock")?B.CAPS:B.NO_CAPS,d|=o.getModifierState("NumLock")?B.NUM_LOCK:B.NO_NUM_LOCK,d|=o.getModifierState("ScrollLock")?B.SCROLL_LOCK:B.NO_SCROLL_LOCK,c|=d;let g=n.modStateFlags!=c;n.modStateFlags=c;let F=B.RALT|B.LCTRL;(i&F)==F&&(c&F)!=F&&(c&=~F),c&B.RALT&&(c&=~B.LCTRL);let Q=h.modifierBitmasks,y=n.activeKeyboard,u;y&&y.isChiral?(u=c&Q.CHIRAL,y.emulatesAltGr&&(u&Q.ALT_GR_SIM)==Q.ALT_GR_SIM&&(u^=Q.ALT_GR_SIM,u|=B.RALT)):u=c&16|(c&(B.LCTRL|B.RCTRL)?32:0)|(c&(B.LALT|B.RALT)?64:0),u|=o.metaKey?B.META:0,e.browser==G.Browser.Firefox&&P.browserMap.FF["k"+t]&&(t=P.browserMap.FF["k"+t]);let I=new M({device:e,kName:"",Lcode:t,Lmodifiers:u,Lstates:d,LmodifierChange:g,isSynthetic:!1});y&&y.isMnemonic&&I.setMnemonicCode(o.getModifierState("Shift"),o.getModifierState("CapsLock"));let b=typeof o.charCode!="undefined"&&o.charCode!=null&&(o.charCode==0||(u&111)!=0);if(I.LisVirtualKey=b||o.type!="keypress",y&&!y.isMnemonic){var U=P.languageMap[n.baseLayout];U&&U["k"+I.Lcode]&&(I.Lcode=U["k"+I.Lcode]),!y.definesPositionalOrMnemonic&&!(I.Lmodifiers&96)&&(I=new M({Lcode:P._USKeyCodeToCharCode(I),Lmodifiers:0,LisVirtualKey:!1,vkCode:I.Lcode,Lstates:I.Lstates,kName:"",device:e,isSynthetic:!1}))}let x=new M(I);return x.source=o,x}a(mc,"preprocessKeyboardEvent");var zn=class extends Et{constructor(e,t,i){super();this.domEventTracker=new xe;this.swallowKeypress=!1;this._KeyDown=a(e=>{var s;let t=this.contextManager.activeKeyboard,i=et(e);if(!i||t==null)return!0;let c=i.getElement();return((s=c==null?void 0:c.className)==null?void 0:s.indexOf("kmw-disabled"))>=0?!0:this.keyDown(e)},"_KeyDown");this._KeyPress=a(e=>!et(e)||this.activeKeyboard==null?!0:this.keyPress(e),"_KeyPress");this._KeyUp=a(e=>{let t=et(e);var i=mc(e,this.processor,this.hardDevice);if(i==null||t==null)return!0;var c=t.getElement();if(i.Lcode==13){var s=!1;if(ne(c,"HTMLTextAreaElement")&&(s=!0),!s)return c instanceof c.ownerDocument.defaultView.HTMLInputElement&&(c.form&&(c.type=="search"||c.type=="submit")?c.form.submit():this.contextManager.page.findNeighboringInput(c,!1).focus()),!0}return this.keyUp(e)},"_KeyUp");this.hardDevice=e,this.contextManager=i,this.processor=t;let c=i.page,s=this.domEventTracker;c.on("enabled",l=>{let r=tt(l);if(!(r instanceof te))s.attachDOMEvent(l,"keypress",this._KeyPress),s.attachDOMEvent(l,"keydown",this._KeyDown),s.attachDOMEvent(l,"keyup",this._KeyUp);else{let B=r.getElement().contentDocument;s.attachDOMEvent(B.body,"keydown",this._KeyDown),s.attachDOMEvent(B.body,"keypress",this._KeyPress),s.attachDOMEvent(B.body,"keyup",this._KeyUp)}}),c.on("disabled",l=>{let r=tt(l);if(!(r instanceof te))s.detachDOMEvent(l,"keypress",this._KeyPress),s.detachDOMEvent(l,"keydown",this._KeyDown),s.detachDOMEvent(l,"keyup",this._KeyUp);else{let B=r.getElement().contentDocument;s.detachDOMEvent(B.body,"keydown",this._KeyDown),s.detachDOMEvent(B.body,"keypress",this._KeyPress),s.detachDOMEvent(B.body,"keyup",this._KeyUp)}})}get activeKeyboard(){return this.contextManager.activeKeyboard.keyboard}keyDown(e){this.swallowKeypress=!1;var t=mc(e,this.processor,this.hardDevice);if(t==null)return!0;let i={LeventMatched:!1};return this.emit("keyevent",t,(c,s)=>{i.LeventMatched=c&&!c.triggerKeyDefault,i.LeventMatched?(e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),this.swallowKeypress=!!t.Lcode,t.Lcode==8&&(this.swallowKeypress=!1)):this.swallowKeypress=!1}),!i.LeventMatched}keyUp(e){var t=mc(e,this.processor,this.hardDevice);if(t==null)return!0;let i=et(e);return this.processor.doModifierPress(t,i,!1)}keyPress(e){var t=mc(e,this.processor,this.hardDevice);if(t==null||t.LisVirtualKey)return!0;if(!this.activeKeyboard.isMnemonic)return!this.swallowKeypress||t.Lcode<32||this.hardDevice.browser==G.Browser.Safari&&t.Lcode>63232&&t.Lcode<63744;let i={};return this.swallowKeypress||this.emit("keyevent",t,(c,s)=>{i.preventDefaultKeystroke=!!c}),this.swallowKeypress||i.preventDefaultKeystroke?(this.swallowKeypress=!1,e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),!1):(this.swallowKeypress=!1,!0)}shutdown(){this.domEventTracker.shutdown()}};a(zn,"HardwareEventKeyboard");var Ri=class{constructor(){this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}equals(n){return this.innerWidth==n.innerWidth&&this.innerHeight==n.innerHeight}};a(Ri,"RotationState");var Ai=class{constructor(n){this.idlePermutationCounter=Ai.IDLE_PERMUTATION_CAP;this.keyman=n}resolve(){var e;var n=this.keyman.osk;(e=this.keyman.touchLanguageMenu)==null||e.hide(),this.keyman.touchLanguageMenu=null,n.setNeedsLayout(),this.oskVisible&&n.present(),this.isActive=!1,this.updateTimer&&(window.clearInterval(this.updateTimer),this.rotState=null)}initNewRotation(){this.oskVisible=this.keyman.osk.isVisible(),this.keyman.osk.hideNow(),this.isActive=!0}init(){var n=this.keyman.config.hostDevice.OS,e=this.keyman.util;n=="ios"?(e.attachDOMEvent(window,"orientationchange",()=>(this.iOSEventHandler(),!1)),e.attachDOMEvent(window,"resize",()=>(this.iOSEventHandler(),!1))):n=="android"&&("onmozorientationchange"in screen?e.attachDOMEvent(screen,"mozorientationchange",()=>(this.initNewRotation(),!1)):e.attachDOMEvent(window,"orientationchange",()=>(this.initNewRotation(),!1)),e.attachDOMEvent(window,"resize",()=>(this.resolve(),!1)))}iOSEventHandler(){this.isActive||(this.initNewRotation(),this.rotState=new Ri,this.updateTimer=window.setInterval(this.iOSEventUpdate.bind(this),Ai.UPDATE_INTERVAL)),this.idlePermutationCounter=0}iOSEventUpdate(){var n=new Ri;this.rotState.equals(n)?++this.idlePermutationCounter==Ai.IDLE_PERMUTATION_CAP&&this.resolve():(this.rotState=n,this.idlePermutationCounter=0)}},on=Ai;a(on,"RotationProcessor"),on.IDLE_PERMUTATION_CAP=15,on.UPDATE_INTERVAL=20;var Hi=class{constructor(n,e){this.domEventTracker=new xe;this.suppressFocusCheck=a(n=>(this.focusAssistant.isTargetForcingScroll()&&(n.stopPropagation(),n.cancelBubble=!0),!0),"suppressFocusCheck");this.pageFocusHandler=a(()=>{var n;return!this.focusAssistant.maintainingFocus&&((n=this.engine.osk)==null?void 0:n.vkbd)&&(this.engine.contextManager.deactivateCurrentTarget(),this.engine.contextManager.resetContext()),!1},"pageFocusHandler");this.touchStartActivationHandler=a(n=>{let e=this.engine.osk;if(!e)return!1;let t=this.engine.config.hostDevice;if(this.deactivateOnRelease=!0,this.touchY=n.touches[0].screenY,this.deactivateOnScroll=!1,t.OS=="android"&&t.browser=="chrome"){if(typeof e._Box=="undefined"||typeof e._Box.style=="undefined")return!1;let i=n.target.parentElement;if(typeof i!="undefined"&&i!=null&&(i.className.indexOf("kmw-key-")>=0||typeof i.parentElement!="undefined"&&i.parentElement!=null&&(i=i.parentElement,i.className.indexOf("kmw-key-")>=0)))return!1;this.deactivateOnScroll=!0}return!1},"touchStartActivationHandler");this.touchMoveActivationHandler=a(n=>{this.deactivateOnScroll&&(this.focusAssistant.focusing=!1,this.engine.contextManager.deactivateCurrentTarget());let e=n.touches[0].screenY,t=this.touchY;return(e-t>5||t-e<5)&&(this.deactivateOnRelease=!1),!1},"touchMoveActivationHandler");this.touchEndActivationHandler=a(n=>(this.deactivateOnRelease&&!this.engine.touchLanguageMenu&&!this.focusAssistant.focusing&&this.engine.contextManager.deactivateCurrentTarget(),this.deactivateOnRelease=!1,!1),"touchEndActivationHandler");this._WindowLoad=a(()=>{document.body.scrollTop=0,typeof document.documentElement!="undefined"&&(document.documentElement.scrollTop=0)},"_WindowLoad");this._WindowUnload=a(()=>{this.engine.shutdown()},"_WindowUnload");this.window=n,this.engine=e,this.attachHandlers(),e.config.hostDevice.touchable&&(this.buildPageTrailer(),this.rotationProcessor=new on(this.engine),this.rotationProcessor.init())}buildPageTrailer(){let n=this.mobilePageTrailer=document.createElement("div"),e=n.style;e.width="100%",e.height=screen.width/2+"px",document.body.appendChild(n)}get focusAssistant(){return this.engine.contextManager.focusAssistant}attachHandlers(){let n=this.domEventTracker,e=this.engine.config.hostDevice,t=this.window.document.body;n.attachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),n.attachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),n.attachDOMEvent(t,"focus",this.suppressFocusCheck,!0),n.attachDOMEvent(t,"blur",this.suppressFocusCheck,!0),e.touchable&&(n.attachDOMEvent(t,"touchstart",this.touchStartActivationHandler,!1),n.attachDOMEvent(t,"touchmove",this.touchMoveActivationHandler,!1),n.attachDOMEvent(t,"touchend",this.touchEndActivationHandler,!1)),n.attachDOMEvent(window,"load",this._WindowLoad,!1),n.attachDOMEvent(window,"unload",this._WindowUnload,!1),n.attachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)}shutdown(){var i;let n=this.domEventTracker,e=this.engine.config.hostDevice,t=this.window.document.body;n.detachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),n.detachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),n.detachDOMEvent(t,"focus",this.suppressFocusCheck,!0),n.detachDOMEvent(t,"blur",this.suppressFocusCheck,!0),e.touchable&&(n.detachDOMEvent(t,"touchstart",this.touchStartActivationHandler,!1),n.detachDOMEvent(t,"touchmove",this.touchMoveActivationHandler,!1),n.detachDOMEvent(t,"touchend",this.touchEndActivationHandler,!1),(i=this.mobilePageTrailer)==null||i.parentElement.removeChild(this.mobilePageTrailer)),n.detachDOMEvent(window,"load",this._WindowLoad,!1),n.detachDOMEvent(window,"unload",this._WindowUnload,!1),n.detachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)}};a(Hi,"PageIntegrationHandlers");function pe(o){let n=document.createElement(o);return n.style.userSelect="none",n.style.MozUserSelect="none",n.style.KhtmlUserSelect="none",n.style.UserSelect="none",n.style.WebkitUserSelect="none",n}a(pe,"_CreateElement");function an(o,n){try{if(o&&typeof window.getComputedStyle!="undefined")return window.getComputedStyle(o,"").getPropertyValue(n)}catch(e){}return""}a(an,"getStyleValue");var Ei=class{constructor(n){this.keyman=n,this.scrolling=!1,this.shim=this.constructShim()}constructShim(){let n=this,e=pe("div"),t=this.keyman.osk;return e.id="kmw-language-menu-background",e.addEventListener("touchstart",i=>{if(i.preventDefault(),n.hide(),i.touches.length>2){var c=i.touches[1].pageX,s=i.touches[1].pageY;let l=t.vkbd.spaceBar;c>l.offsetLeft&&c<l.offsetLeft+l.offsetWidth&&s>l.offsetTop&&s<l.offsetTop+l.offsetHeight&&this.keyman.osk.emit("showbuild")}},!1),e}show(){let n=this.keyman.config.hostDevice,e=this.keyman.keyboardRequisitioner.cache.getStubList();if(e.length<1)return;var i=this.lgList=pe("div");this.lgList.id="kmw-language-menu";let c=this;document.body.appendChild(this.shim);var s=pe("div"),l=s.style,r=pe("div"),B=r.style;s.id="kmw-menu-scroll-container",r.id="kmw-menu-scroller","WebkitOverflowScrolling"in l&&(l.WebkitOverflowScrolling="touch"),s.appendChild(r),i.appendChild(s);var d,g,F=pe("div");for(F.id="kmw-menu-index",d=1;d<=26;d++)g=pe("p"),g.innerHTML=String.fromCharCode(d+64),F.appendChild(g);F.addEventListener("touchstart",function(J){c.scrollToLanguage(J,s,r)},!1),F.addEventListener("touchend",function(J){J.stopPropagation()},!1),i.appendChild(F),i.addEventListener("scroll",function(J){c.scrolling=!0},!1),s.addEventListener("scroll",function(J){s.scrollTop<1&&(s.scrollTop=1),s.scrollTop>s.scrollHeight-s.offsetHeight-1&&(s.scrollTop=s.scrollHeight-s.offsetHeight-1)},!1),this.activeLgNo=this.addLanguages(r,e);var Q=r.childNodes.length-1;if(this.lgList.style.visibility="hidden",document.body.appendChild(this.lgList),n.OS=="android"&&"devicePixelRatio"in window&&(this.lgList.style.fontSize=2/window.devicePixelRatio+"em"),n.OS=="android"&&n.formFactor=="tablet"&&"devicePixelRatio"in window){var y=parseInt(an(i,"width"),10),u=i.style;isNaN(y)||(u.width=u.maxWidth=2*y/window.devicePixelRatio+"px"),y=parseInt(an(s,"width"),10),u=s.style,isNaN(y)||(u.width=u.maxWidth=2*y/window.devicePixelRatio+"px"),y=parseInt(an(r,"width"),10),u=r.style,isNaN(y)||(u.width=u.maxWidth=2*y/window.devicePixelRatio+"px")}this.adjust(0);var I=F.childNodes[1].offsetTop-F.childNodes[0].offsetTop,b=Math.floor(i.offsetHeight/26),U=Math.round(100*b/I)/100,x=U>.6?1:2;for(U>1.25&&(U=1.25),d=0;d<26;d++){var m=F.childNodes[d].style;x==2&&d%2==1?m.display="none":(m.fontSize=U*x+"em",m.lineHeight=b*x+"px")}var V=s.offsetWidth;s.scrollHeight>s.offsetHeight+3?V=V+F.offsetWidth:F.style.display="none",i.style.width=V+"px",this.lgList.style.visibility="",this.scrollToIndex(this.activeLgNo,s,r)}adjust(n){let e=this.keyman.osk,t=this.keyman.config.hostDevice;var i=this.lgList,c=i.firstChild,s=c.firstChild,l=0,r=i.style,B=i.childNodes[1],d=window.innerHeight-e.vkbd.lgKey.offsetHeight-16,g=s.childNodes.length+n-1,F=s.firstChild.firstChild.offsetHeight,Q=g*F;t.OS=="ios"&&(t.formFactor=="phone"?(l=ge()?36:0,d=(window.innerHeight-l-16)*Re(t.formFactor)):t.formFactor=="tablet"&&(l=ge()?16:0,d=d-l)),r.left=q(e.vkbd.lgKey)+"px",Q>d&&(Q=d),r.height=Q+"px",r.bottom="0px",B.style.height=c.style.height=r.height}scrollToLanguage(n,e,t){n.stopImmediatePropagation(),n.stopPropagation(),n.preventDefault();let i=n.touches[0].target;if(i.nodeName=="P"){var c,s,l=i.innerHTML.charCodeAt(0),r=t.childNodes;try{for(c=0;c<r.length-1&&(s=r[c].firstChild.innerHTML.toUpperCase().charCodeAt(0),!(s>=l));c++);}catch(B){}this.scrollToIndex(c,e,t)}}scrollToIndex(n,e,t){let i;try{i=t.firstChild.getBoundingClientRect().height*(n-.5)+1,e.scrollTop=i}catch(s){i=0}try{e.scrollTop<0&&(e.scrollTop=0),e.scrollTop>e.scrollHeight-e.offsetHeight-1&&(e.scrollTop=e.scrollHeight-e.offsetHeight-1)}catch(s){}}addLanguages(n,e){var b;var t=e.length;let i=this.keyman.config.hostDevice;var c,s,l,r=[];for(s=0;s<t;s++)l=e[s].KL,r.indexOf(l)==-1&&r.push(l);r.sort();var B=Math.round(100/Re(i.formFactor))/100,d,g,F,Q,y=-1;for(c=0;c<r.length;c++){for(d=pe("div"),d.className="kbd-list-closed",g=pe("p"),g.kList=[],s=0;s<t;s++)e[s].KL==r[c]&&g.kList.push(e[s]);i.OS=="ios"&&(g.style.fontSize=B+"em"),d.appendChild(g),n.appendChild(d),r[c]==((b=this.keyman.contextManager.activeKeyboard)==null?void 0:b.metadata.langName)&&(y=c);let U=this;if(g.kList.length>1)for(g.className="kbd-list",g.innerHTML=r[c]+"...",g.scrolled=!1,g.ontouchend=function(x){x.stopPropagation(),x.target.scrolled?x.target.scrolled=!1:this.parentNode.className=this.parentNode.className=="kbd-list-closed"?"kbd-list-open":"kbd-list-closed",U.adjust(this.parentNode.className=="kbd-list-closed"?0:this.kList.length)},g.addEventListener("touchstart",function(x){x.stopPropagation()},!1),g.addEventListener("touchmove",function(x){x.target.scrolled=!0,x.stopPropagation()},!1),F=0;F<g.kList.length;F++)Q=pe("p"),Q.className="kbd-list-entry",i.OS=="ios"&&(Q.style.fontSize=B+"em"),this.addKeyboard(g.kList[F],Q,!1),d.appendChild(Q);else g.innerHTML=r[c],g.className="kbd-single-entry",this.addKeyboard(g.kList[0],g,!0);c==y&&(g.className=g.className+" current")}var u=pe("div");u.id="kmw-menu-footer";var I=a(function(U){U.cancelable&&U.preventDefault(),U.stopPropagation()},"cancelTouch");return u.addEventListener("touchstart",I,!1),u.addEventListener("touchmove",I,!1),u.addEventListener("touchend",I,!1),n.appendChild(u),y}addKeyboard(n,e,t){e.kn=n.KI,e.kc=n.KLC,e.innerHTML=t?n.KL:n.KN.replace(" Keyboard","");let i=this,c=a(()=>{if(this.originalBodyStyle){console.error("Unexpected state:  `originalBodyStyle` was not cleared by a previous `unlockBodyScroll()` call");return}this.originalBodyStyle={};let g=this.originalBodyStyle,F=document.body.style;return g.overflowY=F.overflowY,g.height=F.height,F.overflowY="hidden",F.height="100%",!0},"lockBodyScroll"),s=a(()=>{if(!this.originalBodyStyle){console.error("Unexpected state:  `originalBodyStyle` is unset; cannot restore original body style");return}let g=this.originalBodyStyle,F=document.body.style;F.overflowY=g.overflowY,F.height=g.height,this.originalBodyStyle=null},"unlockBodyScroll"),l=a(function(g){g.stopPropagation(),this.className.indexOf("selected")<=0&&(this.className=this.className+" selected"),i.scrolling=!1,i.y0=g.touches[0].pageY,c()},"touchStart"),r=a(function(g){g.stopImmediatePropagation();var F=i.lgList.childNodes[0],Q=F.scrollHeight-F.offsetHeight,y,u;if(typeof g.pageY!="undefined")y=g.pageY;else if(typeof g.touches!="undefined")y=g.touches[0].pageY;else return;if(u=y-i.y0,u<0)F.scrollTop>=Q-1&&(i.y0=y);else if(u>0)F.scrollTop<2&&(i.y0=y);else return;return(u<-5||u>5)&&(i.scrolling=!0,this.className=this.className.replace(/\s*selected/,""),i.y0=y),!0},"touchMove"),B=a(function(g){return typeof g.stopImmediatePropagation!="undefined"?g.stopImmediatePropagation():g.stopPropagation(),i.scrolling?this.className=this.className.replace(/\s*selected/,""):(i.keyman.contextManager.focusAssistant.setFocusTimer(),i.lgList.style.display="none",i.keyman.contextManager.activateKeyboard(this.kn,this.kc,!0),i.keyman.contextManager.restoreLastActiveTarget(),i.hide()),s(),!0},"touchEnd"),d=a(function(g){s()},"touchCancel");e.onmspointerdown=l,e.addEventListener("touchstart",l,!1),e.onmspointermove=r,e.addEventListener("touchmove",r,!1),e.onmspointerout=B,e.addEventListener("touchend",B,!1),e.addEventListener("touchcancel",d,!1)}hide(){let n=this.keyman.osk;this.lgList&&(n.vkbd.highlightKey(n.vkbd.lgKey,!1),this.lgList.style.visibility="hidden",window.setTimeout(()=>{this.shim.parentElement&&(document.body.removeChild(this.shim),document.body.removeChild(this.lgList))},500)),this.keyman.touchLanguageMenu=null}};a(Ei,"LanguageMenu");function ml(o,n,e){let t=e.focusAssistant;n.on("globekey",(i,c)=>{c&&n.hostDevice.touchable&&(o.touchLanguageMenu=new Ei(o),o.touchLanguageMenu.show()),n.vkbd&&n.vkbd.highlightKey(i,!1)}),n.on("hiderequested",i=>{n&&(n.startHide(!0),e.forgetActiveTarget())}),n.addEventListener("hide",i=>{var c;i!=null&&i.HiddenByUser&&((c=e.activeTarget)==null||c.focus())}),n.on("showbuild",()=>{var i;(i=o.config.alertHost)==null||i.alert("KeymanWeb Version "+j.VERSION+'<br /><br /><span style="font-size:0.8em">Copyright &copy; 2007-2023 SIL International</span>')}),n.on("dragmove",i=>Z(this,null,function*(){t.restoringFocus=!0,yield i,e.restoreLastActiveTarget(),t.restoringFocus=!1,t.setMaintainingFocus(!1)})),n.on("resizemove",i=>Z(this,null,function*(){t.restoringFocus=!0,yield i,e.restoreLastActiveTarget(),t.restoringFocus=!1,t.setMaintainingFocus(!1)})),n.on("pointerinteraction",i=>Z(this,null,function*(){t.setMaintainingFocus(!0),yield i,t.setMaintainingFocus(!1)}))}a(ml,"setupOskListeners");function Lr(o){let n=document.createElement(o);return n.style.userSelect="none",n}a(Lr,"createUnselectableElement");var vi=class{constructor(n){this.getAbsoluteX=q;this.getAbsoluteY=$;this._GetAbsoluteX=q;this._GetAbsoluteY=$;this._GetAbsolute=this.getAbsolute;this.toNzString=this.nzString;this.createElement=Lr;this.getStyleValue=an;this.config=n,this.stylesheetManager=new Ue(document.body,n.applyCacheBusting),this.domEventTracker=new xe}isTouchDevice(){return this.config.hostDevice.touchable}getAbsolute(n){return{x:q(n),y:$(n)}}getOption(n,e){return n in this.config.paths?this.config.paths[n]:n in this.config.options?this.config.options[n]:arguments.length>1?e:""}setOption(n,e){switch(n){case"attachType":break;case"ui":break;case"useAlerts":this.config.signalUser=e?new $e:null;break;case"setActiveOnRegister":this.config.activateFirstKeyboard=!!e;break;case"spacebarText":this.config.spacebarText=e;break;default:throw new Error("Path-related options may not be changed after the engine has initialized.")}}loadCookie(n){return new le(n).load(decodeURIComponent)}saveCookie(n,e){new le(n).save(e,encodeURIComponent)}addStyleSheet(n){let e=gt(n);return this.stylesheetManager.linkStylesheet(e),e}removeStyleSheet(n){return this.stylesheetManager.unlink(n)}linkStyleSheet(n){this.stylesheetManager.linkExternalSheet(n)}getLanguageCodes(n){return n.indexOf("-")==-1?[n]:n.split("-")}attachDOMEvent(n,e,t,i){this.domEventTracker.attachDOMEvent(n,e,t,i)}detachDOMEvent(n,e,t,i){this.domEventTracker.detachDOMEvent(n,e,t,i)}get alertHost(){return this.config.alertHost?this.config.alertHost:(this._alertHost||(this._alertHost=new $e),this._alertHost)}alert(n,e){this.alertHost.alert(n,e)}nzString(n,e){let t="";return arguments.length>1&&(t=e),typeof n=="undefined"||n==null||n==0||n==""?t:""+n}toNumber(n,e){let t=parseInt(n,10);return isNaN(t)?e:t}toFloat(n,e){let t=parseFloat(n);return isNaN(t)?e:t}rgba(n,e,t,i,c){let s="transparent";try{s="rgba("+e+","+t+","+i+","+c+")"}catch(l){s="rgb("+e+","+t+","+i+")"}return s}shutdown(){var n,e,t;(n=this.stylesheetManager)==null||n.unlinkAll(),(e=this.domEventTracker)==null||e.shutdown(),(t=this._alertHost)==null||t.shutdown()}};a(vi,"UtilApiEndpoint");var Gc=class{constructor(n,e,t){this.code=n,this.shift=e,this.handler=t}matches(n,e){return this.code==n&&this.shift==e}};a(Gc,"Hotkey");var Wi=class{constructor(){this.hotkeys=[];this._Process=a(n=>{n||(n=window.event);var e=ls(n);if(e==null)return!1;for(var t=(n.shiftKey?16:0)|(n.ctrlKey?32:0)|(n.altKey?64:0),i=0;i<this.hotkeys.length;i++)if(this.hotkeys[i].matches(e,t))return this.hotkeys[i].handler(),n.returnValue=!1,n&&n.preventDefault&&n.preventDefault(),n.cancelBubble=!0,!1;return!0},"_Process")}addHotKey(n,e,t){for(var i=0;i<this.hotkeys.length;i++)if(this.hotkeys[i].code==n&&this.hotkeys[i].shift==e){this.hotkeys[i].handler=t;return}this.hotkeys.push(new Gc(n,e,t))}removeHotkey(n,e){for(var t=0;t<this.hotkeys.length;t++)if(this.hotkeys[t].matches(n,e)){this.hotkeys.splice(t,1);return}}};a(Wi,"HotkeyManager");var pc=class{constructor(n){this.e=n,this.c=n.style.backgroundColor}reset(){this.e.style.backgroundColor=this.c}};a(pc,"BeepData");var fi=class{constructor(n){this._BeepObjects=[];this._BeepTimeout=0;this.reset=a(()=>{this.keyboardInterface.resetContextCache();var n;for(this._BeepTimeout=0,n=0;n<this._BeepObjects.length;n++)this._BeepObjects[n].reset();this._BeepObjects=[]},"reset");this.keyboardInterface=n}beep(n){if(n instanceof K){var e=n.getElement();if(n instanceof te&&(e=n.docRoot),!!e&&!(!e.style||typeof e.style.backgroundColor=="undefined")){for(var t=0;t<this._BeepObjects.length;t++)if(this._BeepObjects[t].e==e)return;this._BeepObjects.push(new pc(e)),e.style.backgroundColor="#000000",this._BeepTimeout==0&&(this._BeepTimeout=1,window.setTimeout(this.reset,50))}}}};a(fi,"BeepHandler");var Bn=class extends Ft{constructor(e,t){super(e,t);this.GetLastActiveElement=this.getLastActiveElement;this.FocusLastActiveElement=this.focusLastActiveElement;this.HideHelp=this.hideHelp;this.ShowHelp=this.showHelp;this.ShowPinnedHelp=this.showPinnedHelp}saveFocus(){this.engine.contextManager.focusAssistant._IgnoreNextSelChange=1}getLastActiveElement(){return this.engine.contextManager.lastActiveTarget}focusLastActiveElement(){this.engine.contextManager.restoreLastActiveTarget()}hideHelp(){this.engine.osk.startHide(!0)}showHelp(e,t){let i=this.engine.osk;i instanceof fe?i.presentAtPosition(e,t):i.present()}showPinnedHelp(){let e=this.engine.osk;e instanceof fe&&(!e.activeKeyboard.keyboard.isCJK||!this.ruleBehavior)&&(e.userPositioned=!0),e.present()}};a(Bn,"KeyboardInterface");(function(){Bn.__publishShorthandAPI()})();var Ct=class extends Dt{constructor(e,t){let i=new Si(t);super(e,i,new bt(i,()=>this.legacyAPIEvents),c=>({keyboardInterface:new Bn(window,c),defaultOutputRules:new Dn(c.contextManager)}));this._initialized=0;this.hotkeyManager=new Wi;this.helpURL="https://help.keyman.com/go";this.keyEventRefocus=a(()=>{this.contextManager.restoreLastActiveTarget()},"keyEventRefocus");this._GetKeyboardDetail=a(function(e,t){return{Name:e.KN,InternalName:e.KI,LanguageName:e.KL,LanguageCode:e.KLC,RegionName:e.KR,RegionCode:e.KRC,CountryName:e.KC,CountryCode:e.KCC,KeyboardID:e.KD,Font:e.KFont,OskFont:e.KOskFont,HasLoaded:!!t,IsRTL:t?t.isRTL:null}},"_GetKeyboardDetail");this._util=new vi(i),this.beepHandler=new fi(this.core.keyboardInterface),this.core.keyboardProcessor.beepHandler=()=>this.beepHandler.beep(this.contextManager.activeTarget),this.hardKeyboard=new zn(i.hardDevice,this.core.keyboardProcessor,this.contextManager),this.contextManager.on("targetchange",c=>{let s=c==null?void 0:c.getElement();if(this.osk.activationModel.activationTrigger=s,this.config.hostDevice.touchable){if(!s||!c||!this.osk)return;let l=$(s),r=window.pageYOffset,B=l-r;l>=r&&(B-=window.innerHeight-this.osk._Box.offsetHeight-s.offsetHeight-2,B<0&&(B=0)),B!=0&&window.scrollTo(0,B+r)}})}get util(){return this._util}get views(){return ss}get initialized(){return this._initialized}get ui(){return this._ui}set ui(e){this._ui&&this._ui.shutdown(),this._ui=e,this.config.deferForInitialization.isFulfilled&&e.initialize()}init(e){return Z(this,null,function*(){let i=new At().detect(),c=C(C({},hl),e);if(this.config.hostDevice=i,this.config.initialize(c),this._initialized=1,yield Zi(),this.config.deferForInitialization.isResolved)return Promise.resolve();yield Ti(Ct.prototype,this,"init").call(this,c),this.keyboardRequisitioner.cloudQueryEngine.once("unboundregister",()=>{var l;(l=this.contextManager.activeKeyboard)!=null&&l.keyboard||this.setActiveKeyboard("","")}),this.contextManager.initialize();let s=this.contextManager.getSavedKeyboardRaw();i.touchable?this.osk=new fn(this):this.osk=new kn(this),ml(this,this.osk,this.contextManager),this.pageIntegration=new Hi(window,this),String.kmwEnableSupplementaryPlane(!0),this.config.finalizeInit(),this.ui&&(this.ui.initialize(),this.legacyAPIEvents.callEvent("loaduserinterface",{})),this._initialized=2,yield Promise.resolve(),this.contextManager.restoreSavedKeyboard(s),yield Promise.resolve()})}get register(){return this.keyboardRequisitioner.cloudQueryEngine.registerFromCloud}getUIState(){return this.contextManager.focusAssistant.getUIState()}activatingUI(e){this.contextManager.focusAssistant.setMaintainingFocus(!!e)}setKeyboardForControl(e,t,i){if(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}if(!this.isAttached(e)){console.error("KeymanWeb is not attached to element "+e);return}let c=null;if(t&&(c=this.keyboardRequisitioner.cache.getStub(t,i),!c))throw new Error(`No keyboard has been registered with id ${t} and language code ${i}.`);this.contextManager.setKeyboardForTarget(e._kmwAttachment.interface,t,i)}getKeyboardForControl(e){let t=tt(e);return this.contextManager.getKeyboardStubForTarget(t).id}getLanguageForControl(e){let t=tt(e);return this.contextManager.getKeyboardStubForTarget(t).langId}isAttached(e){return this.contextManager.page.isAttached(e)}addKeyboards(...e){return this.config.deferForInitialization.then(()=>{if(!e||!e[0]||e[0].length==0)return this.keyboardRequisitioner.fetchCloudCatalog().catch(t=>(console.error(t[0].error),t));{let t=[];return Array.isArray(e[0])?t=t.concat(e[0]):Array.isArray(e)&&(t=t.concat(e)),this.keyboardRequisitioner.addKeyboardArray(t)}})}addKeyboardsForLanguage(e){return this.config.deferForInitialization.then(()=>typeof e=="string"?this.keyboardRequisitioner.addLanguageKeyboards(e.split(",").map(t=>t.trim())):this.keyboardRequisitioner.addLanguageKeyboards(e))}isCJK(e){let t;return e?e.KeyboardID?t=this.keyboardRequisitioner.cache.getKeyboard(e.KeyboardID):t=new N(e):t=this.core.activeKeyboard,t&&t.isCJK}getKeyboard(e,t){let i=this.keyboardRequisitioner.cache.getStub(e,t),c=this.keyboardRequisitioner.cache.getKeyboardForStub(i);return i&&this._GetKeyboardDetail(i,c)}getKeyboards(){let e=[],t=this.keyboardRequisitioner.cache,i=t.getStubList();for(let c=0;c<i.length;c++){let s=i[c],l=t.getKeyboardForStub(s),r=this._GetKeyboardDetail(s,l);e.push(r)}return e}removeKeyboards(...e){var t;for(let i=0;i<e.length;i++)this.keyboardRequisitioner.cache.forgetKeyboard(e[i],!0),((t=this.contextManager.activeKeyboard)==null?void 0:t.metadata.id)==de(e[i])&&this.contextManager.activateKeyboard("","");return!0}getSavedKeyboard(){return this.contextManager.getSavedKeyboard()}focusLastActiveElement(){var e;(e=this.contextManager.lastActiveTarget)==null||e.focus()}getLastActiveElement(){var e;return(e=this.contextManager.lastActiveTarget)==null?void 0:e.getElement()}setActiveElement(e,t){if(typeof e=="string"){let c=e;if(e=document.getElementById(e),!e)throw new Error(`Could not find the specified element (id: ${c}`)}let i=tt(e);if(!i)throw new Error(`KMW is not attached to the specified element (id: ${e.id}).`);this.contextManager.setActiveTarget(i,t)}moveToElement(e){typeof e=="string"&&(e=document.getElementById(e)),e.focus()}addHotKey(e,t,i){this.hotkeyManager.addHotKey(e,t,i)}removeHotKey(e,t){this.hotkeyManager.removeHotkey(e,t)}attachToControl(e){this.contextManager.page.attachToControl(e)}detachFromControl(e){this.contextManager.page.detachFromControl(e)}disableControl(e){this.contextManager.page.disableControl(e)}enableControl(e){this.contextManager.page.enableControl(e)}BuildVisualKeyboard(e,t,i,c){let s=null;e!=null&&(s=this.keyboardRequisitioner.cache.getKeyboard(e)),s=s||this.core.activeKeyboard;let l=this.keyboardRequisitioner.cache.getStub(s),r=this.getOskHeight,B=(typeof r=="function"?r():null)||this.osk.computedHeight||200;return Fe.buildDocumentationKeyboard(s,l,this.config.paths.fonts,i,c,B)}shutdown(){var e,t;this.pageIntegration.shutdown(),this.contextManager.shutdown(),(e=this.osk)==null||e.shutdown(),this.core.languageProcessor.shutdown(),this.hardKeyboard.shutdown(),this.util.shutdown(),this.legacyAPIEvents.callEvent("unloaduserinterface",{}),(t=this.ui)==null||t.shutdown()}};a(Ct,"KeymanEngine");var Gl=document.getElementsByTagName("script"),pl=Gl[Gl.length-1].src,Zr=pl.substr(0,pl.lastIndexOf("/")+1);window.keyman=new Ct(Wt.constructInstance(),Zr);})();
//# sourceMappingURL=keymanweb.js.map
