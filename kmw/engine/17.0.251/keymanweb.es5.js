(function(){var Kl=Object.create;var ln=Object.defineProperty;var _l=Object.getOwnPropertyDescriptor;var Pl=Object.getOwnPropertyNames;var jl=Object.getPrototypeOf,ql=Object.prototype.hasOwnProperty;var Cc=function(i,t){return function(){return t||i((t={exports:{}}).exports,t),t.exports}},bc=function(i,t){for(var e in t)ln(i,e,{get:t[e],enumerable:!0})},cn=function(i,t,e,n){if(t&&typeof t=="object"||typeof t=="function")for(var c=Pl(t),l=0,r=c.length,s;l<r;l++)s=c[l],!ql.call(i,s)&&s!==e&&ln(i,s,{get:function(o){return t[o]}.bind(null,s),enumerable:!(n=_l(t,s))||n.enumerable});return i},rn=function(i,t,e){return cn(i,t,"default"),e&&cn(e,t,"default")},R=function(i,t,e){return e=i!=null?Kl(jl(i)):{},cn(t||!i||!i.__esModule?ln(e,"default",{value:i,enumerable:!0}):e,i)};var sn=Cc(function(mo,Lt){var Uc,xc,pc,Gc,mc,Xc,Vc,ft;(function(i){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(n){i(e(t,e(n)))}):typeof Lt=="object"&&typeof Lt.exports=="object"?i(e(t,e(Lt.exports))):i(e(t));function e(n,c){return n!==t&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(l,r){return n[l]=c?c(l,r):r}}})(function(i){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var c in n)Object.prototype.hasOwnProperty.call(n,c)&&(e[c]=n[c])};Uc=function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function c(){this.constructor=e}e.prototype=n===null?Object.create(n):(c.prototype=n.prototype,new c)},xc=Object.assign||function(e){for(var n,c=1,l=arguments.length;c<l;c++){n=arguments[c];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pc=function(e,n,c,l){var r=arguments.length,s=r<3?n:l===null?l=Object.getOwnPropertyDescriptor(n,c):l,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,n,c,l);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(n,c,s):o(n,c))||s);return r>3&&s&&Object.defineProperty(n,c,s),s},Gc=function(e,n,c,l){function r(s){return s instanceof c?s:new c(function(o){o(s)})}return new(c||(c=Promise))(function(s,o){function a(F){try{g(l.next(F))}catch(u){o(u)}}function B(F){try{g(l.throw(F))}catch(u){o(u)}}function g(F){F.done?s(F.value):r(F.value).then(a,B)}g((l=l.apply(e,n||[])).next())})},mc=function(e,n){var c={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},l,r,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(g){return function(F){return B([g,F])}}function B(g){if(l)throw new TypeError("Generator is already executing.");for(;o&&(o=0,g[0]&&(c=0)),c;)try{if(l=1,r&&(s=g[0]&2?r.return:g[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,g[1])).done)return s;switch(r=0,s&&(g=[g[0]&2,s.value]),g[0]){case 0:case 1:s=g;break;case 4:return c.label++,{value:g[1],done:!1};case 5:c.label++,r=g[1],g=[0];continue;case 7:g=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(g[0]===6||g[0]===2)){c=0;continue}if(g[0]===3&&(!s||g[1]>s[0]&&g[1]<s[3])){c.label=g[1];break}if(g[0]===6&&c.label<s[1]){c.label=s[1],s=g;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(g);break}s[2]&&c.ops.pop(),c.trys.pop();continue}g=n.call(e,c)}catch(F){g=[6,F],r=0}finally{l=s=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}},Xc=function(e){var n=typeof Symbol=="function"&&Symbol.iterator,c=n&&e[n],l=0;if(c)return c.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&l>=e.length&&(e=void 0),{value:e&&e[l++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},Vc=function(e,n){var c=typeof Symbol=="function"&&e[Symbol.iterator];if(!c)return e;var l=c.call(e),r,s=[],o;try{for(;(n===void 0||n-- >0)&&!(r=l.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(c=l.return)&&c.call(l)}finally{if(o)throw o.error}}return s},ft=function(e){return this instanceof ft?(this.v=e,this):new ft(e)},i("__extends",Uc),i("__assign",xc),i("__decorate",pc),i("__awaiter",Gc),i("__generator",mc),i("__values",Xc),i("__read",Vc),i("__await",ft)})});var H=Cc(function(Vo,on){"use strict";var er=Object.prototype.hasOwnProperty,j="~";function rt(){}Object.create&&(rt.prototype=Object.create(null),new rt().__proto__||(j=!1));function tr(i,t,e){this.fn=i,this.context=t,this.once=e||!1}function Zc(i,t,e,n,c){if(typeof e!="function")throw new TypeError("The listener must be a function");var l=new tr(e,n||i,c),r=j?j+t:t;return i._events[r]?i._events[r].fn?i._events[r]=[i._events[r],l]:i._events[r].push(l):(i._events[r]=l,i._eventsCount++),i}function Jt(i,t){--i._eventsCount===0?i._events=new rt:delete i._events[t]}function z(){this._events=new rt,this._eventsCount=0}z.prototype.eventNames=function(){var t=[],e,n;if(this._eventsCount===0)return t;for(n in e=this._events)er.call(e,n)&&t.push(j?n.slice(1):n);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};z.prototype.listeners=function(t){var e=j?j+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var c=0,l=n.length,r=new Array(l);c<l;c++)r[c]=n[c].fn;return r};z.prototype.listenerCount=function(t){var e=j?j+t:t,n=this._events[e];return n?n.fn?1:n.length:0};z.prototype.emit=function(t,e,n,c,l,r){var s=j?j+t:t;if(!this._events[s])return!1;var o=this._events[s],a=arguments.length,B,g;if(o.fn){switch(o.once&&this.removeListener(t,o.fn,void 0,!0),a){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,e),!0;case 3:return o.fn.call(o.context,e,n),!0;case 4:return o.fn.call(o.context,e,n,c),!0;case 5:return o.fn.call(o.context,e,n,c,l),!0;case 6:return o.fn.call(o.context,e,n,c,l,r),!0}for(g=1,B=new Array(a-1);g<a;g++)B[g-1]=arguments[g];o.fn.apply(o.context,B)}else{var F=o.length,u;for(g=0;g<F;g++)switch(o[g].once&&this.removeListener(t,o[g].fn,void 0,!0),a){case 1:o[g].fn.call(o[g].context);break;case 2:o[g].fn.call(o[g].context,e);break;case 3:o[g].fn.call(o[g].context,e,n);break;case 4:o[g].fn.call(o[g].context,e,n,c);break;default:if(!B)for(u=1,B=new Array(a-1);u<a;u++)B[u-1]=arguments[u];o[g].fn.apply(o[g].context,B)}}return!0};z.prototype.on=function(t,e,n){return Zc(this,t,e,n,!1)};z.prototype.once=function(t,e,n){return Zc(this,t,e,n,!0)};z.prototype.removeListener=function(t,e,n,c){var l=j?j+t:t;if(!this._events[l])return this;if(!e)return Jt(this,l),this;var r=this._events[l];if(r.fn)r.fn===e&&(!c||r.once)&&(!n||r.context===n)&&Jt(this,l);else{for(var s=0,o=[],a=r.length;s<a;s++)(r[s].fn!==e||c&&!r[s].once||n&&r[s].context!==n)&&o.push(r[s]);o.length?this._events[l]=o.length===1?o[0]:o:Jt(this,l)}return this};z.prototype.removeAllListeners=function(t){var e;return t?(e=j?j+t:t,this._events[e]&&Jt(this,e)):(this._events=new rt,this._eventsCount=0),this};z.prototype.off=z.prototype.removeListener;z.prototype.addListener=z.prototype.on;z.prefixed=j;z.EventEmitter=z;typeof on!="undefined"&&(on.exports=z)});var d={};bc(d,{tslib:function(){return $l}});rn(d,R(sn(),1));var $l=R(sn(),1);var wc=R(H(),1);var ie={modifierCodes:{LCTRL:1,RCTRL:2,LALT:4,RALT:8,SHIFT:16,CTRL:32,ALT:64,META:128,CAPS:256,NO_CAPS:512,NUM_LOCK:1024,NO_NUM_LOCK:2048,SCROLL_LOCK:4096,NO_SCROLL_LOCK:8192,VIRTUAL_KEY:16384,VIRTUAL_CHAR_KEY:32768},modifierBitmasks:{ALL:127,ALT_GR_SIM:5,CHIRAL:31,IS_CHIRAL:15,NON_CHIRAL:112},stateBitmasks:{ALL:16128,CAPS:768,NUM_LOCK:3072,SCROLL_LOCK:12288},keyCodes:{K_BKSP:8,K_TAB:9,K_ENTER:13,K_SHIFT:16,K_CONTROL:17,K_ALT:18,K_PAUSE:19,K_CAPS:20,K_ESC:27,K_SPACE:32,K_PGUP:33,K_PGDN:34,K_END:35,K_HOME:36,K_LEFT:37,K_UP:38,K_RIGHT:39,K_DOWN:40,K_SEL:41,K_PRINT:42,K_EXEC:43,K_INS:45,K_DEL:46,K_HELP:47,K_0:48,K_1:49,K_2:50,K_3:51,K_4:52,K_5:53,K_6:54,K_7:55,K_8:56,K_9:57,K_A:65,K_B:66,K_C:67,K_D:68,K_E:69,K_F:70,K_G:71,K_H:72,K_I:73,K_J:74,K_K:75,K_L:76,K_M:77,K_N:78,K_O:79,K_P:80,K_Q:81,K_R:82,K_S:83,K_T:84,K_U:85,K_V:86,K_W:87,K_X:88,K_Y:89,K_Z:90,K_NP0:96,K_NP1:97,K_NP2:98,K_NP3:99,K_NP4:100,K_NP5:101,K_NP6:102,K_NP7:103,K_NP8:104,K_NP9:105,K_NPSTAR:106,K_NPPLUS:107,K_SEPARATOR:108,K_NPMINUS:109,K_NPDOT:110,K_NPSLASH:111,K_F1:112,K_F2:113,K_F3:114,K_F4:115,K_F5:116,K_F6:117,K_F7:118,K_F8:119,K_F9:120,K_F10:121,K_F11:122,K_F12:123,K_NUMLOCK:144,K_SCROLL:145,K_LSHIFT:160,K_RSHIFT:161,K_LCONTROL:162,K_RCONTROL:163,K_LALT:164,K_RALT:165,K_COLON:186,K_EQUAL:187,K_COMMA:188,K_HYPHEN:189,K_PERIOD:190,K_SLASH:191,K_BKQUOTE:192,K_LBRKT:219,K_BKSLASH:220,K_RBRKT:221,K_QUOTE:222,K_oE2:226,K_OE2:226,K_LOPT:50001,K_ROPT:50002,K_NUMERALS:50003,K_SYMBOLS:50004,K_CURRENCIES:50005,K_UPPER:50006,K_LOWER:50007,K_ALPHA:50008,K_SHIFTED:50009,K_ALTGR:50010,K_TABBACK:50011,K_TABFWD:50012},codesUS:[["0123456789",";=,-./`","[\\]'"],[")!@#$%^&*(",":+<_>?~",'{|}"']],isKnownOSKModifierKey:function(i){switch(i){case"K_SHIFT":case"K_LOPT":case"K_ROPT":case"K_NUMLOCK":case"K_CAPS":return!0;default:if(ie.keyCodes[i]>=5e4)return!0;var t=ie[i];if(t>5e4&&t<50011)return!0}return!1},getModifierState:function(i){var t=0;i.indexOf("shift")>=0&&(t|=ie.modifierCodes.SHIFT);var e=!1;i.indexOf("leftctrl")>=0&&(t|=ie.modifierCodes.LCTRL,e=!0),i.indexOf("rightctrl")>=0&&(t|=ie.modifierCodes.RCTRL,e=!0),i.indexOf("ctrl")>=0&&!e&&(t|=ie.modifierCodes.CTRL);var n=!1;return i.indexOf("leftalt")>=0&&(t|=ie.modifierCodes.LALT,n=!0),i.indexOf("rightalt")>=0&&(t|=ie.modifierCodes.RALT,n=!0),i.indexOf("alt")>=0&&!n&&(t|=ie.modifierCodes.ALT),t},getStateFromLayer:function(i){var t=0;return i.indexOf("caps")>=0?t|=ie.modifierCodes.CAPS:t|=ie.modifierCodes.NO_CAPS,t}},U=ie;var Le;(function(i){i.Enter="\n",i.Backspace="\b"})(Le||(Le={}));var nr=function(){function i(){}return i.prototype.codeForEvent=function(t){return U.keyCodes[t.kName]||t.Lcode},i.prototype.forAny=function(t,e,n){var c="";if((c=this.forSpecialEmulation(t))!=null)return c;if(!e&&(c=this.forNumpadKeys(t))!=null)return c;if((c=this.forUnicodeKeynames(t,n))!=null)return c;if((c=this.forBaseKeys(t,n))!=null)return c;var l=this.codeForEvent(t);switch(l){default:return null}},i.prototype.isCommand=function(t){var e=this.codeForEvent(t);switch(e){default:return!1}},i.prototype.applyCommand=function(t,e){},i.prototype.forSpecialEmulation=function(t){var e=this.codeForEvent(t);switch(e){case U.keyCodes.K_BKSP:return Le.Backspace;case U.keyCodes.K_ENTER:return Le.Enter;default:return null}},i.prototype.forNumpadKeys=function(t){if(t.Lcode>=U.keyCodes.K_NP0&&t.Lcode<=U.keyCodes.K_NPSLASH){if(t.Lcode<106)var e=t.Lcode-48;else e=t.Lcode-64;var n=String._kmwFromCharCode(e);return n}else return null},i.prototype.forUnicodeKeynames=function(t,e){var n=t.kName;if(!n||n.substr(0,2)!="U_")return null;for(var c="",l=n.substr(2).split("_"),r=0,s=l;r<s.length;r++){var o=s[r],a=parseInt(o,16);if(0<=a&&a<=31||128<=a&&a<=159||isNaN(a)){e&&(e.errorLog="Suppressing Unicode control code in "+n);continue}else c+=String.kmwFromCharCode(a)}return c||null},i.prototype.forBaseKeys=function(t,e){var n=t.Lcode,c=t.Lmodifiers;if(c==U.modifierCodes.SHIFT)c=1;else if(c!=0)return e&&(e.warningLog="KMW only defines default key output for the 'default' and 'shift' layers!"),null;try{if(n==U.keyCodes.K_SPACE)return" ";if(n>=U.keyCodes.K_0&&n<=U.keyCodes.K_9)return U.codesUS[c][0][n-U.keyCodes.K_0];if(n>=U.keyCodes.K_A&&n<=U.keyCodes.K_Z)return String.fromCharCode(n+(c?0:32));if(n>=U.keyCodes.K_COLON&&n<=U.keyCodes.K_BKQUOTE)return U.codesUS[c][1][n-U.keyCodes.K_COLON];if(n>=U.keyCodes.K_LBRKT&&n<=U.keyCodes.K_QUOTE)return U.codesUS[c][2][n-U.keyCodes.K_LBRKT];if(n==U.keyCodes.K_oE2)return c?"|":"\\"}catch(l){e&&(e.errorLog="Error detected with default mapping for key:  code = "+n+", shift state = "+(c==1?"shift":"default"))}return null},i}(),Ee=nr;var cr=new Ee,ir=function(){function i(t){this.isSynthetic=!0;for(var e in t)t[e]!==void 0&&(this[e]=t[e])}return i.constructNullKeyEvent=function(t){var e=new i({Lcode:0,kName:"",device:t,Lstates:void 0,Lmodifiers:void 0,vkCode:void 0,LisVirtualKey:void 0});return e},Object.defineProperty(i.prototype,"isModifier",{get:function(){switch(this.Lcode){case 16:case 17:case 18:case 20:case 144:case 145:return!0;default:return!1}},enumerable:!1,configurable:!0}),i.prototype.setMnemonicCode=function(t,e){if(this.Lcode!=U.keyCodes.K_SPACE){var n=new i(this);for(var c in this)n[c]=this[c];n.kName="K_xxxx",n.Lmodifiers=t?16:0;var l=cr.forAny(n,!0);this.vkCode=this.Lcode,l?this.Lcode=l.charCodeAt(0):this.isModifier||delete this.Lcode}e&&(this.Lcode>=65&&this.Lcode<=90||this.Lcode>=97&&this.Lcode<=122)&&(this.Lmodifiers^=16,this.Lcode^=32)},i}(),oe=ir;var ke=function(){function i(){}return i}(),lr=function(){function i(){this.FF=new ke,this.Safari=new ke,this.Opera=new ke,this.FF.k61=187,this.FF.k59=186,this.FF.k173=189}return i}(),rr=function(){function i(){this.se=new ke,this.se.k220=192,this.se.k187=189,this.se.k219=187,this.se.k221=219,this.se.k186=221,this.se.k191=220,this.se.k192=186,this.se.k189=191,this.uk=new ke,this.uk.k223=192,this.uk.k192=222,this.uk.k222=226,this.uk.k220=220}return i}(),sr=function(){function i(){}return i._usCodeInit=function(){var t=new ke,e=new ke;t.k192=96,t.k49=49,t.k50=50,t.k51=51,t.k52=52,t.k53=53,t.k54=54,t.k55=55,t.k56=56,t.k57=57,t.k48=48,t.k189=45,t.k187=61,t.k81=113,t.k87=119,t.k69=101,t.k82=114,t.k84=116,t.k89=121,t.k85=117,t.k73=105,t.k79=111,t.k80=112,t.k219=91,t.k221=93,t.k220=92,t.k65=97,t.k83=115,t.k68=100,t.k70=102,t.k71=103,t.k72=104,t.k74=106,t.k75=107,t.k76=108,t.k186=59,t.k222=39,t.k90=122,t.k88=120,t.k67=99,t.k86=118,t.k66=98,t.k78=110,t.k77=109,t.k188=44,t.k190=46,t.k191=47,e.k192=126,e.k49=33,e.k50=64,e.k51=35,e.k52=36,e.k53=37,e.k54=94,e.k55=38,e.k56=42,e.k57=40,e.k48=41,e.k189=95,e.k187=43,e.k81=81,e.k87=87,e.k69=69,e.k82=82,e.k84=84,e.k89=89,e.k85=85,e.k73=73,e.k79=79,e.k80=80,e.k219=123,e.k221=125,e.k220=124,e.k65=65,e.k83=83,e.k68=68,e.k70=70,e.k71=71,e.k72=72,e.k74=74,e.k75=75,e.k76=76,e.k186=58,e.k222=34,e.k90=90,e.k88=88,e.k67=67,e.k86=86,e.k66=66,e.k78=78,e.k77=77,e.k188=60,e.k190=62,e.k191=63,i._usCharCodes=[t,e]},i._USKeyCodeToCharCode=function(t){return i.usCharCodes[t.Lmodifiers&16?1:0]["k"+t.Lcode]},Object.defineProperty(i,"usCharCodes",{get:function(){return i._usCharCodes||i._usCodeInit(),i._usCharCodes},enumerable:!1,configurable:!0}),i.browserMap=new lr,i.languageMap=new rr,i}(),ae=sr;function te(i,t){var e=t||{};for(var n in i)typeof i[n]=="object"&&i[n]!=null?(e[n]=i[n].constructor===Array?[]:{},te(i[n],e[n])):e[n]=i[n];return e}var st=function(){function i(t,e,n,c){switch(t.toLowerCase()){case i.Browser.Chrome:case i.Browser.Edge:case i.Browser.Firefox:case i.Browser.Native:case i.Browser.Opera:case i.Browser.Safari:this.browser=t.toLowerCase();break;default:this.browser=i.Browser.Other}switch(e.toLowerCase()){case i.FormFactor.Desktop:case i.FormFactor.Phone:case i.FormFactor.Tablet:this.formFactor=e.toLowerCase();break;default:throw"Invalid form factor specified for device: "+e}switch(n.toLowerCase()){case i.OperatingSystem.Windows.toLowerCase():case i.OperatingSystem.macOS.toLowerCase():case i.OperatingSystem.Linux.toLowerCase():case i.OperatingSystem.Android.toLowerCase():case i.OperatingSystem.iOS.toLowerCase():this.OS=n.toLowerCase();break;default:this.OS=i.OperatingSystem.Other}this.touchable=c}return i}();(function(i){var t;(function(c){c.Chrome="chrome",c.Edge="edge",c.Firefox="firefox",c.Native="native",c.Opera="opera",c.Safari="safari",c.Other="other"})(t=i.Browser||(i.Browser={}));var e;(function(c){c.Windows="windows",c.macOS="macosx",c.Linux="linux",c.Android="android",c.iOS="ios",c.Other="other"})(e=i.OperatingSystem||(i.OperatingSystem={}));var n;(function(c){c.Desktop="desktop",c.Phone="phone",c.Tablet="tablet"})(n=i.FormFactor||(i.FormFactor={}))})(st||(st={}));function an(i){return new st(i.browser,st.FormFactor.Desktop,i.OS,!1)}var V=st;var Bn=function(){function i(){}return i.VERSION="17.0.251",i.VERSION_RELEASE="17.0",i.VERSION_MAJOR="17",i.VERSION_MINOR="0",i.VERSION_PATCH="251",i.TIER="alpha",i.VERSION_TAG="-alpha",i.VERSION_WITH_TAG="17.0.251-alpha",i.VERSION_ENVIRONMENT="alpha",i.VERSION_GIT_TAG="release@17.0.251-alpha",i}();var ot=Bn;var or=function(){function i(t){if(t==null){this.components=[].concat(i.DEVELOPER_VERSION_FALLBACK.components);return}if(Array.isArray(t)){var e=t;if(e.length<2)throw new Error("Version string must have at least a major and minor component!");this.components=[].concat(e);return}var n=t.split("."),c=[];if(n.length<2)throw new Error("Version string must have at least a major and minor component!");for(var l=0;l<n.length;l++){var r=parseInt(n[l],10);if(isNaN(r))throw new Error("Version string components must be numerical!");c.push(r)}this.components=c}return Object.defineProperty(i.prototype,"major",{get:function(){return this.components[0]},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minor",{get:function(){return this.components[1]},enumerable:!1,configurable:!0}),i.prototype.toString=function(){return this.components.join(".")},i.prototype.toJSON=function(){return this.toString()},i.prototype.equals=function(t){return this.compareTo(t)==0},i.prototype.precedes=function(t){return this.compareTo(t)<0},i.prototype.compareTo=function(t){var e=this.components.length<t.components.length,n=this.components.length<t.components.length?this.components.length:t.components.length,c;for(c=0;c<n;c++){var l=this.components[c]-t.components[c];if(l!=0)return l}var r=e?t.components:this.components;do{if(r[c]>0)return e?-1:1;c++}while(c<r.length);return 0},i.CURRENT=new i(ot.VERSION_RELEASE),i.DEVELOPER_VERSION_FALLBACK=new i([9,0,0]),i.NO_DEFAULT_KEYCAPS=new i([12,0]),i.MAC_POSSIBLE_IPAD_ALIAS=new i([10,15]),i}(),ne=or;function ze(){return typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof self!="undefined"?self:global}function at(){String.kmwFromCharCode=function(i){var t=[],e;for(e=0;e<arguments.length;e++){var n=Number(arguments[e]);if(!isFinite(n)||n<0||n>1114111||Math.floor(n)!==n)throw new RangeError("Invalid code point "+n);n<65536?t.push(n):(n-=65536,t.push((n>>10)+55296),t.push(n%1024+56320))}return String.fromCharCode.apply(void 0,t)},String.prototype.kmwCharCodeAt=function(i){var t=String(this),e=0;if(i<0||i>=t.length)return NaN;for(var n=0;n<i;n++)if(e=t.kmwNextChar(e),e===null)return NaN;var c=t.charCodeAt(e);if(c>=55296&&c<=56319&&t.length>e+1){var l=t.charCodeAt(e+1);if(l>=56320&&l<=57343)return(c-55296<<10)+(l-56320)+65536}return c},String.prototype.kmwIndexOf=function(i,t){var e=String(this),n=e.indexOf(i,t);if(n<0)return n;for(var c=0,l=0;l!==null&&l<n;l=e.kmwNextChar(l))c++;return c},String.prototype.kmwLastIndexOf=function(i,t){var e=String(this),n=e.lastIndexOf(i,t);if(n<0)return n;for(var c=0,l=0;l!==null&&l<n;l=e.kmwNextChar(l))c++;return c},String.prototype.kmwLength=function(){var i=String(this);if(i.length==0)return 0;for(var t=0,e=0;e!==null;t++)e=i.kmwNextChar(e);return t},String.prototype.kmwSlice=function(i,t){var e=String(this),n=e.kmwCodePointToCodeUnit(i),c=e.kmwCodePointToCodeUnit(t);return n===null||c===null?"":e.slice(n,c)},String.prototype.kmwSubstr=function(i,t){var e=String(this);i<0&&(i=e.kmwLength()+i),i<0&&(i=0);var n=e.kmwCodePointToCodeUnit(i),c=n;if(n===null)return"";if(arguments.length<2)c=e.length;else for(var l=0;l<t;l++)c=e.kmwNextChar(c);return c===null?e.substring(n):e.substring(n,c)},String.prototype.kmwSubstring=function(i,t){var e=String(this),n,c;if(typeof t=="undefined")n=e.kmwCodePointToCodeUnit(i),c=e.length;else{if(i>t){var l=i;i=t,t=l}n=e.kmwCodePointToCodeUnit(i),c=e.kmwCodePointToCodeUnit(t)}return(isNaN(n)||n===null)&&(n=0),(isNaN(c)||c===null)&&(c=e.length),e.substring(n,c)},String.prototype.kmwNextChar=function(i){var t=String(this);if(i===null||i<0||i>=t.length-1)return null;var e=t.charCodeAt(i);if(e>=55296&&e<=56319&&t.length>i+1){var n=t.charCodeAt(i+1);if(n>=56320&&n<=57343)return i==t.length-2?null:i+2}return i+1},String.prototype.kmwPrevChar=function(i){var t=String(this);if(i==null||i<=0||i>t.length)return null;var e=t.charCodeAt(i-1);if(e>=56320&&e<=57343&&i>1){var n=t.charCodeAt(i-2);if(n>=55296&&n<=56319)return i-2}return i-1},String.prototype.kmwCodePointToCodeUnit=function(i){if(i===null)return null;var t=String(this),e=0;if(i<0){e=t.length;for(var n=0;n>i;n--)e=t.kmwPrevChar(e);return e}if(i==t.kmwLength())return t.length;for(var n=0;n<i;n++)e=t.kmwNextChar(e);return e},String.prototype.kmwCodeUnitToCodePoint=function(i){var t=String(this);return i===null?null:i==0?0:i<0?t.substr(i).kmwLength():t.substr(0,i).kmwLength()},String.prototype.kmwCharAt=function(i){var t=String(this);return i>=0?t.kmwSubstr(i,1):""},String.prototype.kmwBMPNextChar=function(i){var t=String(this);return i<0||i>=t.length-1?null:i+1},String.prototype.kmwBMPPrevChar=function(i){var t=String(this);return i<=0||i>t.length?null:i-1},String.prototype.kmwBMPCodePointToCodeUnit=function(i){return i},String.prototype.kmwBMPCodeUnitToCodePoint=function(i){return i},String.prototype.kmwBMPLength=function(){var i=String(this);return i.length},String.prototype.kmwBMPSubstr=function(i,t){var e=String(this);return i>-1?e.substr(i,t):e.substr(e.length+i,-i)},String.kmwEnableSupplementaryPlane=function(i){var t=String.prototype;String._kmwFromCharCode=i?String.kmwFromCharCode:String.fromCharCode,t._kmwCharAt=i?t.kmwCharAt:t.charAt,t._kmwCharCodeAt=i?t.kmwCharCodeAt:t.charCodeAt,t._kmwIndexOf=i?t.kmwIndexOf:t.indexOf,t._kmwLastIndexOf=i?t.kmwLastIndexOf:t.lastIndexOf,t._kmwSlice=i?t.kmwSlice:t.slice,t._kmwSubstring=i?t.kmwSubstring:t.substring,t._kmwSubstr=i?t.kmwSubstr:t.kmwBMPSubstr,t._kmwLength=i?t.kmwLength:t.kmwBMPLength,t._kmwNextChar=i?t.kmwNextChar:t.kmwBMPNextChar,t._kmwPrevChar=i?t.kmwPrevChar:t.kmwBMPPrevChar,t._kmwCodePointToCodeUnit=i?t.kmwCodePointToCodeUnit:t.kmwBMPCodePointToCodeUnit,t._kmwCodeUnitToCodePoint=i?t.kmwCodeUnitToCodePoint:t.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}at();var ar=function(){function i(t){var e=this;this._isFulfilled=!1,this._isRejected=!1,this._promise=new Promise(function(n,c){e._resolve=function(l){e._isFulfilled=!0,n(l)},e._reject=function(l){e._isRejected=!0,c(l)},t&&t(e._resolve,e._reject)})}return Object.defineProperty(i.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isFulfilled",{get:function(){return this._isFulfilled},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isRejected",{get:function(){return this._isRejected},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isResolved",{get:function(){return this.isFulfilled||this.isRejected},enumerable:!1,configurable:!0}),i.prototype.then=function(t,e){return this._promise.then(t,e)},i.prototype.catch=function(t){return this._promise.catch(t)},i.prototype.finally=function(t){return this._promise.finally(t)},Object.defineProperty(i.prototype,"corePromise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),i}(),J=ar;var vc=function(i){(0,d.__extends)(t,i);function t(e){var n=this,c=null;n=i.call(this,function(s){var o=setTimeout(function(){n.isResolved||s(!0)},e);c=o})||this,n.timerHandle=c;var l=n._resolve;n._resolve=function(s){clearTimeout(n.timerHandle),l(s)};var r=n._reject;return n._reject=function(s){clearTimeout(n.timerHandle),r(s)},n}return t}(J),Bt=vc,xe=function(i){var t=new vc(i);return t.corePromise};var Br=200,O=function(){function i(){}return i.buildDefaultLayout=function(t,e,n){var c=n;typeof i.dfltLayout[c]!="object"&&(c="desktop");var l=U.modifierBitmasks.NON_CHIRAL,r=ne.CURRENT;e&&(l=e.modifierBitmask,r=e.compilerVersion),t||(t=this.DEFAULT_RAW_SPEC);var s=te(i.dfltLayout[c]),o,a=s.layer,B=t.KLS,g=t.K102,F,u,I,y,Q,h,C,b,x=(l&U.modifierBitmasks.IS_CHIRAL)!=0;if(t.F){var G=/^(?:(?:italic|bold) )* *[0-9.eE-]+(?:[a-z]+) "(.+)"$/.exec(t.F);G&&(s.font=G[1])}var X=!(typeof B=="undefined"||!B);X||(B=t.KLS=i.processLegacyDefinitions(t.BK));var m=/\*\w+\*/,p=Object.getOwnPropertyNames(B),Z=[];if(p.splice(p.indexOf("default"),1),p=["default"].concat(p),e&&e.emulatesAltGr&&(p.indexOf("leftctrl-leftalt")==-1&&p.indexOf("rightalt")!=-1&&(p.push("leftctrl-leftalt"),B["leftctrl-leftalt"]=B.rightalt),p.indexOf("leftctrl-leftalt-shift")==-1&&p.indexOf("rightalt-shift")!=-1&&(p.push("leftctrl-leftalt-shift"),B["leftctrl-leftalt-shift"]=B["rightalt-shift"])),s.displayUnderlying=e?!!e.scriptObject.KDU:!1,n=="desktop")for(Z=i.generateLayerIds(x),o=0;o<Z.length;o++)p.indexOf(Z[o])!=-1&&Z.splice(o--,1);var W=p.concat(Z);if(X&&n!="desktop"){var A=null;h=a[0].row;for(var k=0;k<h.length;k++){b=h[k].key;for(var S=0;S<b.length;S++)C=b[S],C.id=="K_SHIFT"&&(A=C)}if(A){A.sk=[];for(var L in B)if(!(L=="default"||L=="shift")){var f=i.modifierSpecials[L],E={id:"K_".concat(f),text:f,sp:1,nextlayer:L};A.sk.push(E)}}else console.warn("Error in default layout - cannot find default Shift key!")}for(o=0;o<W.length;o++)o>0&&(a[o]=te(a[0])),a[o].id=W[o],a[o].nextlayer=W[o],i.formatDefaultLayer(a[o],x,n,!!g);for(o=0;o<a.length;o++){var Y=a[o],N,A=null,Ne=null,Ue="",nt=null,ct=null,it=null,Te=B[Y.id],lt=Y.id=="shift"?1:0,vt=Y.id=="default"||lt?1:0;for(h=Y.row,F=0;F<h.length;F++)for(b=h[F].key,u=0;u<b.length;u++){switch(C=b[u],N=i.dfltCodes.indexOf(C.id),(Te||vt)&&(Te&&N>=0&&N<Te.length&&(C.text=Te[N]),vt&&r.precedes(ne.NO_DEFAULT_KEYCAPS)&&C.id!="K_SPACE"&&N+65*lt<i.dfltText.length&&C.text!==null&&(C.text=C.text||i.dfltText[N+65*lt])),C.text!==null&&(C.text=C.text||""),C.id){case"K_SHIFT":A=C;break;case"K_TAB":Ne=C;break;case"K_CAPS":nt=C;break;case"K_NUMLOCK":ct=C;break;case"K_SCROLL":it=C;break}if(C.sk!=null){for(I=0;I<C.sk.length;I++)p.indexOf(C.sk[I].nextlayer)==-1&&C.sk.splice(I--,1);C.sk.length==0&&(C.sk=null)}}Y.shiftKey=A,Y.capsKey=nt,Y.numKey=ct,Y.scrollKey=it,n!="desktop"&&o>0&&A!=null&&(A.sp=2,A.sk=null,A.text=i.modifierSpecials[a[o].id]?i.modifierSpecials[a[o].id]:"*Shift*")}return s},i.getLayerId=function(t){var e=U.modifierCodes,n="";return t==0?"default":(t&e.LCTRL&&(n=(n.length>0?n+"-":"")+"leftctrl"),t&e.RCTRL&&(n=(n.length>0?n+"-":"")+"rightctrl"),t&e.LALT&&(n=(n.length>0?n+"-":"")+"leftalt"),t&e.RALT&&(n=(n.length>0?n+"-":"")+"rightalt"),t&e.SHIFT&&(n=(n.length>0?n+"-":"")+"shift"),t&e.CTRL&&(n=(n.length>0?n+"-":"")+"ctrl"),t&e.ALT&&(n=(n.length>0?n+"-":"")+"alt"),n)},i.generateLayerIds=function(t){var e,n;t?(e=32,n=1):(e=8,n=16);for(var c=[],l=0;l<e;l++)c.push(i.getLayerId(l*n));return c},i.formatDefaultLayer=function(t,e,n,c){for(var l=t.id,r=0;r<t.row.length;r++)for(var s=t.row[r],o=s.key,a=0;a<o.length;a++){var B=o[a];switch(B.id){case"K_SHIFT":case"K_LSHIFT":case"K_RSHIFT":l.indexOf("shift")!=-1&&(B.sp=2),n!="desktop"&&(l!="default"?B.nextlayer="default":B.nextlayer="shift");break;case"K_LCTRL":case"K_LCONTROL":if(e){l.indexOf("leftctrl")!=-1&&(B.sp=2);break}case"K_RCTRL":case"K_RCONTROL":if(e){l.indexOf("rightctrl")!=-1&&(B.sp=2);break}case"K_CONTROL":l.indexOf("ctrl")!=-1&&(!e||l.indexOf("leftctrl")!=-1&&l.indexOf("rightctrl")!=-1)&&(B.sp=2);break;case"K_LALT":if(e){l.indexOf("leftalt")!=-1&&(B.sp=2);break}case"K_RALT":if(e){l.indexOf("rightalt")!=-1&&(B.sp=2);break}case"K_ALT":l.indexOf("alt")!=-1&&(!e||l.indexOf("leftalt")!=-1&&l.indexOf("rightalt")!=-1)&&(B.sp=2);break;case"K_oE2":(typeof c=="undefined"||!c)&&(n=="desktop"?(o.splice(a--,1),o[0].width=Br):o[a].sp=10);break}}},i.processLegacyDefinitions=function(t){for(var e=i.generateLayerIds(!1),n={},c=0;c<e.length;c++){for(var l=e[c],r=[],s=!1,o=0;o<65;o++){var a=o+65*c;r.push(t[a]),a<t.length&&t[a]!=""&&o!=i.dfltCodes.indexOf("K_SPACE")&&(s=!0)}s&&(n[l]=r)}return(typeof n.default=="undefined"||!n.default)&&(n.default=[""]),(typeof n.shift=="undefined"||!n.shift)&&(n.shift=[""]),n},i.dfltCodes=["K_BKQUOTE","K_1","K_2","K_3","K_4","K_5","K_6","K_7","K_8","K_9","K_0","K_HYPHEN","K_EQUAL","K_*","K_*","K_*","K_Q","K_W","K_E","K_R","K_T","K_Y","K_U","K_I","K_O","K_P","K_LBRKT","K_RBRKT","K_BKSLASH","K_*","K_*","K_*","K_A","K_S","K_D","K_F","K_G","K_H","K_J","K_K","K_L","K_COLON","K_QUOTE","K_*","K_*","K_*","K_*","K_*","K_oE2","K_Z","K_X","K_C","K_V","K_B","K_N","K_M","K_COMMA","K_PERIOD","K_SLASH","K_*","K_*","K_*","K_*","K_*","K_SPACE"],i.dfltText="`1234567890-=\xA7~~qwertyuiop[]\\~~~asdfghjkl;'~~~~~?zxcvbnm,./~~~~~ ~!@#$%^&*()_+\xA7~~QWERTYUIOP{}\\~~~ASDFGHJKL:\"~~~~~?ZXCVBNM<>?~~~~~ ",i.DEFAULT_RAW_SPEC={F:"Tahoma",BK:i.dfltText},i.modifierSpecials={leftalt:"*LAlt*",rightalt:"*RAlt*",alt:"*Alt*",leftctrl:"*LCtrl*",rightctrl:"*RCtrl*",ctrl:"*Ctrl*","ctrl-alt":"*AltGr*","leftctrl-leftalt":"*LAltCtrl*","rightctrl-rightalt":"*RAltCtrl*","leftctrl-leftalt-shift":"*LAltCtrlShift*","rightctrl-rightalt-shift":"*RAltCtrlShift*",shift:"*Shift*","shift-alt":"*AltShift*","shift-ctrl":"*CtrlShift*","shift-ctrl-alt":"*AltCtrlShift*","leftalt-shift":"*LAltShift*","rightalt-shift":"*RAltShift*","leftctrl-shift":"*LCtrlShift*","rightctrl-shift":"*RCtrlShift*"},i.dfltShiftToCaps={id:"T_*_MT_SHIFT_TO_CAPS",text:"*ShiftLock*",sp:1,nextlayer:"caps"},i.dfltShiftToDefault={id:"T_*_MT_SHIFT_TO_DEFAULT",text:"*Shift*",sp:1,nextlayer:"default"},i.dfltShiftToShift={id:"T_*_MT_SHIFT_TO_SHIFT",text:"*Shift*",sp:1,nextlayer:"shift"},i.dfltLayout={desktop:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:1,key:[{id:"K_BKQUOTE"},{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{id:"K_BKSP",text:"*BkSp*",sp:1,width:130}]},{id:2,key:[{id:"K_TAB",text:"*Tab*",sp:1,width:130},{id:"K_Q"},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{id:"K_BKSLASH"}]},{id:3,key:[{id:"K_CAPS",text:"*Caps*",sp:1,width:165},{id:"K_A"},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_ENTER",text:"*Enter*",sp:1,width:165}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:130},{id:"K_oE2"},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_RSHIFT",text:"*Shift*",sp:1,width:130}]},{id:5,key:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:170},{id:"K_LALT",text:"*Alt*",sp:1,width:160},{id:"K_SPACE",text:"",width:770},{id:"K_RALT",text:"*Alt*",sp:1,width:160},{id:"K_RCONTROL",text:"*Ctrl*",sp:1,width:170}]}]}]},tablet:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",sp:1,width:150},{id:"K_SPACE",text:"",width:570},{id:"K_BKSP",text:"*BkSp*",sp:1,width:150},{id:"K_ENTER",text:"*Enter*",sp:1,width:200}]}]}]},phone:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",width:150,sp:1},{id:"K_SPACE",width:570,text:""},{id:"K_BKSP",text:"*BkSp*",width:150,sp:1},{id:"K_ENTER",text:"*Enter*",width:200,sp:1}]}]}]}},i}();function he(i,t,e){e.enumerable=!0}var fc={id:"string",text:"string",layer:"string",nextlayer:"string",font:"string",fontsize:"string",sp:"number",pad:"number",width:"number",sk:"subkeys",flick:"flicks",multitap:"subkeys",hint:"string",default:"boolean"},Lc=["n","ne","e","se","s","sw","w","nw"],Rc=function(){function i(){this.isMnemonic=!1}return Object.defineProperty(i.prototype,"baseKeyID",{get:function(){if(typeof this.id!="undefined")return this.id},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isPadding",{get:function(){return this.sp==10},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"coreID",{get:function(){if(typeof this.id!="undefined"){var t=this.id||"";return this.displayLayer!=this.layer&&(t=t+"+"+this.layer),t}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"elementID",{get:function(){if(typeof this.id!="undefined")return this.displayLayer+"-"+this.coreID},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"baseKeyEvent",{get:function(){return new oe(this._baseKeyEvent)},enumerable:!1,configurable:!0}),i.unicodeIDToText=function(t,e){if(!t||t.substring(0,2)!="U_")return null;for(var n="",c=t.substring(2).split("_"),l=0,r=c;l<r.length;l++){var s=r[l],o=parseInt(s,16);if(0<=o&&o<=31||128<=o&&o<=159||isNaN(o)){e&&e(s);continue}else n+=String.kmwFromCharCode(o)}return n||null},i.sanitize=function(t){typeof t.width=="string"&&(t.width=parseInt(t.width,10)),t.width||(t.width=M.DEFAULT_KEY_WIDTH),typeof t.pad=="string"&&(t.pad=parseInt(t.pad,10)),t.pad||(t.pad=M.DEFAULT_PAD),typeof t.sp=="string"&&(t.sp=Number.parseInt(t.sp,10)),t.sp||(t.sp=M.DEFAULT_KEY.sp);for(var e=0,n=Object.keys(fc);e<n.length;e++){var c=n[e],l=fc[c];switch(l){case"subkeys":var r=t[c];if(!Array.isArray(r))delete t[c];else for(var s=0;s<r.length;s++){var o=r[s];typeof o!="object"?r.splice(s--,1):M.sanitize(o)}break;case"flicks":var a=t[c];if(typeof a!="object")delete t[c];else for(var B=0,g=Lc;B<g.length;B++){var F=g[B],o=a[F];typeof o!="object"?delete a[F]:M.sanitize(o)}break;default:var u=t[c];typeof u!=l&&delete t[c]}}t.text||(t.text=M.DEFAULT_KEY.text)},i.polyfill=function(t,e,n,c,l){l||(l={hasFlicks:!1,hasLongpresses:!1,hasMultitaps:!1});var r=new i,s=Object.getPrototypeOf(r);for(var o in r)if(!t.hasOwnProperty(o)){var a=Object.getOwnPropertyDescriptor(s,o);a?Object.defineProperty(t,o,a):t[o]=r[o]}if(!t.text&&typeof t.id=="string"&&(t.text=M.unicodeIDToText(t.id)),t.sk){l.hasLongpresses=!0;for(var B=0,g=t.sk;B<g.length;B++){var F=g[B];dt.polyfill(F,e,n,c,l)}}if(t.multitap){l.hasMultitaps=!0;for(var u=0,I=t.multitap;u<I.length;u++){var y=I[u];dt.polyfill(y,e,n,c,l)}}if(t.flick){l.hasFlicks=!0;for(var Q in t.flick)dt.polyfill(t.flick[Q],e,n,c,l)}var h=t;h.displayLayer=c,h.layer=h.layer||c,i.determineHint(h,n.defaultHint),h.constructBaseKeyEvent(e,n,c)},i.determineHint=function(t,e){var n;if(t.hint){t.hintSrc=t;return}if(e!=null&&e.includes("flick-")){if(t.flick){var c=e.substring(6);!((n=t.flick[c])===null||n===void 0)&&n.text&&(t.hintSrc=t.flick[c])}return}switch(e){case"none":return;case"multitap":t.multitap&&(t.hintSrc=t.multitap[0]);return;case"flick":if(t.flick)for(var l=0,r=Lc;l<r.length;l++){var s=r[l];if(t.flick[s]){t.hintSrc=t.flick[s];return}}return;case"longpress":t.sk&&(t.hintSrc=t.sk[0]);return;case"dot":default:t.sk&&(t.hint="\u2022",t.hintSrc=t);return}},i.prototype.constructBaseKeyEvent=function(t,e,n){var c=this.layer||n||"",l=this.id?this.id.toUpperCase():null,r={Lmodifiers:U.getModifierState(c),Lstates:U.getStateFromLayer(c),Lcode:l?U.keyCodes[l]:0,LisVirtualKey:!0,vkCode:0,kName:l,kLayer:c,kbdLayer:n,kNextLayer:this.nextlayer,device:null,isSynthetic:!0},s=new oe(r);if(e.keyboard){var o=e.keyboard;o.isMnemonic&&!(e.isDefault&&e.formFactor!="desktop")?s.Lcode!=U.keyCodes.K_SPACE&&(s.vkCode=s.Lcode,this.isMnemonic=!0):s.vkCode=s.Lcode,o.definesPositionalOrMnemonic||(s.Lcode=ae._USKeyCodeToCharCode(s),s.LisVirtualKey=!1)}this._baseKeyEvent=s},i.DEFAULT_PAD=15,i.DEFAULT_RIGHT_MARGIN=15,i.DEFAULT_KEY_WIDTH=100,i.DEFAULT_KEY={text:"",width:i.DEFAULT_KEY_WIDTH,sp:0,pad:i.DEFAULT_PAD},(0,d.__decorate)([he],i.prototype,"baseKeyID",null),(0,d.__decorate)([he],i.prototype,"isPadding",null),(0,d.__decorate)([he],i.prototype,"coreID",null),(0,d.__decorate)([he],i.prototype,"elementID",null),(0,d.__decorate)([he],i.prototype,"baseKeyEvent",null),(0,d.__decorate)([he],i.prototype,"constructBaseKeyEvent",null),i}();var M=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.getSubkey=function(e){if(this.sk)for(var n=0,c=this.sk;n<c.length;n++){var l=c[n];if(l.coreID==e)return l}return null},t}(Rc);var dt=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t}(Rc);var Jc=function(){function i(){}return i.sanitize=function(t){for(var e=0,n=t.key;e<n.length;e++){var c=n[e];c==null?t.key.length=t.key.length-1:M.sanitize(c)}typeof t.id=="string"&&(t.id=Number.parseInt(t.id,10))},i.polyfill=function(t,e,n,c,l,r,s){for(var o=t.key,a=0;a<o.length;a++){var B=o[a];for(var g in M.DEFAULT_KEY)typeof B[g]!="string"&&typeof B[g]!="number"&&(B[g]=M.DEFAULT_KEY[g]);switch(B.sp){case 1:!i.SPECIAL_LABEL.test(B.text)&&B.text!=""&&(B.sp=3);break;case 2:!i.SPECIAL_LABEL.test(B.text)&&B.text!=""&&(B.sp=4);break}M.polyfill(B,e,n,c,s)}for(var F=function(x,G,X,m){x.proportionalPad=G,x.proportionalWidth=X,x.proportionalX=m+G+X/2},u=0,a=0;a<o.length-1;a++){var B=o[a];F(B,B.pad/l,B.width/l,u),u+=B.proportionalPad,u+=B.proportionalWidth}var I=M.DEFAULT_RIGHT_MARGIN/l;if(o.length>0){var y=o[o.length-1];if(o.length==1&&y.pad<0){var Q=y.width/l,h=1-(u+Q+I);F(y,h,Q,u)}else{var h=y.pad/l,Q=1-(u+h+I);F(y,h,Q,u)}}var C=new i;for(var B in C)t.hasOwnProperty(B)||(t[B]=C[B]);var b=t;b.proportionalY=r},i.prototype.populateKeyMap=function(t){this.key.forEach(function(e){e.coreID&&(t[e.coreID]=e)})},i.SPECIAL_LABEL=/\*\w+\*/,(0,d.__decorate)([he],i.prototype,"populateKeyMap",null),i}();var Sc=function(){function i(){}return i.sanitize=function(t){for(var e=0,n=t.row;e<n.length;e++){var c=n[e];Jc.sanitize(c)}},i.polyfill=function(t,e,n,c){t.aligned=!1;for(var l=t.row,r=0,s=0,o=l;s<o.length;s++){for(var a=o[s],B=0,g=a.key,F=0,u=g;F<u.length;F++){var I=u[F];B+=I.width+I.pad}B>r&&(r=B)}n.formFactor=="desktop"?r+=5:r+=M.DEFAULT_RIGHT_MARGIN;for(var y=t.row.length,Q=0;Q<y;Q++){var h=(Q+.5)/y;Jc.polyfill(t.row[Q],e,n,t.id,r,h,c)}var C=new i;for(var I in C)t.hasOwnProperty(I)||(t[I]=C[I]);var b=t;b.totalWidth=r,b.defaultKeyProportionalWidth=M.DEFAULT_KEY.width/r,b.rowProportionalHeight=1/y,b.keyMap=b.constructKeyMap()},i.prototype.constructKeyMap=function(){var t={};return this.row.forEach(function(e){e.populateKeyMap(t)}),t},i.prototype.getKey=function(t){t.indexOf(this.id+"-")==0&&(t=t.replace(this.id+"-",""));var e=t.split("::");if(e.length>1){var n=this.keyMap[e[0]];return n.getSubkey(e[1])}else return this.keyMap[t]},(0,d.__decorate)([he],i.prototype,"constructKeyMap",null),(0,d.__decorate)([he],i.prototype,"getKey",null),i}();var St=function(){function i(){this.hasFlicks=!1,this.hasLongpresses=!1,this.hasMultitaps=!1}return i.prototype.getLayer=function(t){return this.layerMap[t]},i.correctLayerEmptyRowBug=function(t){for(var e=0;e<t.length;e++){var n=t[e],c=n.row,l=void 0;for(l=c.length-1;l>=0;l--)(!Array.isArray(c[l].key)||c[l].key.length==0)&&c.splice(l,1)}},i.sanitize=function(t){i.correctLayerEmptyRowBug(t.layer);for(var e=0,n=t.layer;e<n.length;e++){var c=n[e];Sc.sanitize(c)}},i.polyfill=function(t,e,n){if(t==null)throw new Error("Cannot build an ActiveLayout for a null specification.");var c={hasFlicks:!1,hasLongpresses:!1,hasMultitaps:!1};this.sanitize(t);var l,r={},s=t.layer,o=new i;for(var a in o)t.hasOwnProperty(a)||(t[a]=o[a]);var B=t;for(B.keyboard=e,B.formFactor=n,l=0;l<s.length;l++)Sc.polyfill(s[l],e,B,c),r[s[l].id]=s[l];if(n!="desktop"&&!!t.layer.find(function(y){return y.id=="caps"})){var g=t.layer.find(function(y){return y.id=="default"}),F=t.layer.find(function(y){return y.id=="shift"}),u=g.getKey("K_SHIFT"),I=F==null?void 0:F.getKey("K_SHIFT");u&&I&&!u.multitap&&!I.multitap&&!u.sk&&!I.sk&&(c.hasMultitaps=!0,u.multitap=[(0,d.__assign)({},O.dfltShiftToCaps),(0,d.__assign)({},O.dfltShiftToDefault)],I.multitap=[(0,d.__assign)({},O.dfltShiftToCaps),(0,d.__assign)({},O.dfltShiftToShift)],u.multitap.forEach(function(y){return dt.polyfill(y,e,B,"default")}),I.multitap.forEach(function(y){return dt.polyfill(y,e,B,"shift")}))}return B.hasFlicks=c.hasFlicks,B.hasLongpresses=c.hasLongpresses,B.hasMultitaps=c.hasMultitaps,B.layerMap=r,B},(0,d.__decorate)([he],i.prototype,"getLayer",null),i}();var dr=function(){function i(){this.stores={}}return i}(),Ye;(function(i){i[i.NOT_LOADED=void 0]="NOT_LOADED",i[i.POLYFILLED=1]="POLYFILLED",i[i.CALIBRATED=2]="CALIBRATED"})(Ye||(Ye={}));var gr=function(){function i(t){t?this.scriptObject=t:this.scriptObject=i.DEFAULT_SCRIPT_OBJECT,this.layoutStates={}}return i.prototype.process=function(t,e){return this.scriptObject.gs(t,e)},i.prototype.processNewContextEvent=function(t,e){return this.scriptObject.gn?this.scriptObject.gn(t,e):!1},i.prototype.processPostKeystroke=function(t,e){return this.scriptObject.gpk?this.scriptObject.gpk(t,e):!1},Object.defineProperty(i.prototype,"isHollow",{get:function(){return this.scriptObject==i.DEFAULT_SCRIPT_OBJECT},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this.scriptObject.KI},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this.scriptObject.KN},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"variableStores",{get:function(){var t=this.scriptObject.KVS,e={};if(Array.isArray(t))for(var n=0,c=t;n<c.length;n++){var l=c[n];e[l]=this.scriptObject[l]}return e},set:function(t){var e=this.scriptObject.KVS;if(Array.isArray(e))for(var n=0,c=e;n<c.length;n++){var l=c[n];typeof t[l]=="string"&&(this.scriptObject[l]=t[l])}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_legacyLayoutSpec",{get:function(){return this.scriptObject.KV},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_layouts",{get:function(){return this.scriptObject.KVKL},set:function(t){this.scriptObject.KVKL=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"compilerVersion",{get:function(){return new ne(this.scriptObject.KVER)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isMnemonic",{get:function(){return!!this.scriptObject.KM},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"definesPositionalOrMnemonic",{get:function(){return typeof this.scriptObject.KM!="undefined"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"helpText",{get:function(){return this.scriptObject.KH},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasScript",{get:function(){return!!this.scriptObject.KHF},enumerable:!1,configurable:!0}),i.prototype.embedScript=function(t){this.scriptObject.KHF(t)},Object.defineProperty(i.prototype,"oskStyling",{get:function(){return this.scriptObject.KCSS},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isCJK",{get:function(){var t;return typeof this.scriptObject.KLC!="undefined"?t=this.scriptObject.KLC:typeof this.scriptObject.LanguageCode!="undefined"&&(t=this.scriptObject.LanguageCode),t=="cmn"||t=="jpn"||t=="kor"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isRTL",{get:function(){return!!this.scriptObject.KRTL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"modifierBitmask",{get:function(){return this.scriptObject.KMBM||U.modifierBitmasks.NON_CHIRAL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isChiral",{get:function(){return!!(this.modifierBitmask&U.modifierBitmasks.IS_CHIRAL)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"desktopFont",{get:function(){return this.scriptObject.KV?this.scriptObject.KV.F:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cacheTag",{get:function(){var t=this.scriptObject._kmw;return t||(t=new dr,this.scriptObject._kmw=t),t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"explodedStores",{get:function(){return this.cacheTag.stores},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"emulatesAltGr",{get:function(){var t=U.modifierCodes;if(!this.isChiral||this._legacyLayoutSpec==null)return!1;var e=this._legacyLayoutSpec.KLS;if(!e)return!1;var n=t.LCTRL|t.LALT,c=e[O.getLayerId(n)],l=e[O.getLayerId(t.SHIFT|n)];if(c!=null&&c!=e[O.getLayerId(t.RALT)]||l!=null&&l!=e[O.getLayerId(t.RALT|t.SHIFT)])return!1;var r=this.modifierBitmask;return(r&n)!=n||c==null&&l==null,!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"usesSupplementaryPlaneChars",{get:function(){var t=this.scriptObject;return t&&(t.KS&&t.KS==1||t.KN=="Hieroglyphic")},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"version",{get:function(){return this.scriptObject.KBVER||""},enumerable:!1,configurable:!0}),i.prototype.usesDesktopLayoutOnDevice=function(t){return this.scriptObject.KVKL?t.formFactor==V.FormFactor.Desktop:!0},i.prototype.notify=function(t,e,n){typeof this.scriptObject.KNS=="function"&&this.scriptObject.KNS(t,e,n)},i.prototype.findOrConstructLayout=function(t){if(this._layouts){if(this._layouts[t]!==void 0)return this._layouts[t];if(t==V.FormFactor.Phone&&this._layouts[V.FormFactor.Tablet])return this._layouts[V.FormFactor.Phone]=this._layouts[V.FormFactor.Tablet];if(t==V.FormFactor.Tablet&&this._layouts[V.FormFactor.Phone])return this._layouts[V.FormFactor.Tablet]=this._layouts[V.FormFactor.Phone]}var e=null;if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.KLS)e=this._legacyLayoutSpec;else if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.BK!=null){for(var n=this._legacyLayoutSpec.BK,c=0;c<n.length;c++)if(n[c].length>0){e=this._legacyLayoutSpec;break}}if(!e&&(this.helpText==""||t!=V.FormFactor.Desktop)&&(e={F:"Tahoma",BK:O.dfltText}),this._layouts||(this._layouts={}),e){var l=this._layouts[t]=O.buildDefaultLayout(e,this,t);return l.isDefault=!0,l}else return this._layouts[t]=null,null},i.prototype.layout=function(t){var e=this.findOrConstructLayout(t);return e?(this.layoutStates[t]==Ye.NOT_LOADED&&(e=St.polyfill(e,this,t),this.layoutStates[t]=Ye.POLYFILLED),e):null},i.prototype.refreshLayouts=function(){var t=[V.FormFactor.Desktop,V.FormFactor.Phone,V.FormFactor.Tablet],e=this;t.forEach(function(n){e.layoutStates[n]=Ye.NOT_LOADED})},i.prototype.markLayoutCalibrated=function(t){this.layoutStates[t]!=Ye.NOT_LOADED&&(this.layoutStates[t]=Ye.CALIBRATED)},i.prototype.getLayoutState=function(t){return this.layoutStates[t]},i.prototype.constructNullKeyEvent=function(t,e){e=e||{K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};var n=oe.constructNullKeyEvent(t);return this.setSyntheticEventDefaults(n,e),n},i.prototype.constructKeyEvent=function(t,e,n){var c=t.baseKeyEvent;c.device=e,this.isMnemonic&&c.setMnemonicCode(t.layer.indexOf("shift")!=-1,n.K_CAPS),this.setSyntheticEventDefaults(c,n);var l={K_CAPS:U.stateBitmasks.CAPS,K_NUMLOCK:U.stateBitmasks.NUM_LOCK,K_SCROLL:U.stateBitmasks.SCROLL_LOCK},r=l[c.kName];return r&&(c.Lstates^=r,c.LmodifierChange=!0),c},i.prototype.setSyntheticEventDefaults=function(t,e){t.device.touchable||(t.Lstates=0,t.Lstates|=e.K_CAPS?U.modifierCodes.CAPS:U.modifierCodes.NO_CAPS,t.Lstates|=e.K_NUMLOCK?U.modifierCodes.NUM_LOCK:U.modifierCodes.NO_NUM_LOCK,t.Lstates|=e.K_SCROLL?U.modifierCodes.SCROLL_LOCK:U.modifierCodes.NO_SCROLL_LOCK),t.kName&&t.kName.substr(0,2)=="U_"&&(t.LisVirtualKey=!1),typeof t.Lcode=="undefined"&&(t.Lcode=this.getVKDictionaryCode(t.kName),t.Lcode||(t.Lcode=1)),(t.Lmodifiers&U.modifierBitmasks.ALT_GR_SIM)==U.modifierBitmasks.ALT_GR_SIM&&this.emulatesAltGr&&(t.Lmodifiers&=~U.modifierBitmasks.ALT_GR_SIM,t.Lmodifiers|=U.modifierCodes.RALT)},i.prototype.getVKDictionaryCode=function(t){if(!this.scriptObject.VKDictionary){var e=[];if(typeof this.scriptObject.KVKD=="string")for(var n=this.scriptObject.KVKD.split(" "),c=0;c<n.length;c++)e[n[c].toUpperCase()]=c+256;this.scriptObject.VKDictionary=e}var l=this.scriptObject.VKDictionary[t.toUpperCase()];return l||0},i.DEFAULT_SCRIPT_OBJECT={gs:function(t,e){return!1},KI:"",KN:"",KV:O.DEFAULT_RAW_SPEC,KM:0},i}(),q=gr;var gt={osk:U},Ft=function(){function i(t,e){this.loadedKeyboard=null,this._jsGlobal=t,this.keymanGlobal=e,this.install()}return i.prototype.KR=function(t){if(this.loadedKeyboard)throw new Error("Unexpected state:  the most-recently loaded keyboard field was not properly reset.");this.loadedKeyboard=new q(t)},i.prototype.install=function(){this._jsGlobal.KeymanWeb=this,this._jsGlobal.keyman=this.keymanGlobal},i.prototype.uninstall=function(){this._jsGlobal.KeymanWeb==this&&delete this._jsGlobal.KeymanWeb,this._jsGlobal.keyman==this.keymanGlobal&&delete this._jsGlobal.keyman},i}();var ut=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e)||this;return c.cause=n,c}return t}(Error);var dn=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e)||this;return c.cause=n,c}return t}(Error);var Fr=function(){function i(t){this.uri=t}return i.prototype.missingError=function(t){var e="Cannot find the keyboard at ".concat(this.uri,".");return new dn(e,t)},i.prototype.scriptError=function(t){var e="Error registering the keyboard script at ".concat(this.uri,"; it may contain an error.");return new ut(e,t)},i}(),ur=function(){function i(t){this.stub=t}return i.prototype.missingError=function(t){var e=this.stub,n="Cannot find the ".concat(e.name," keyboard for ").concat(e.langName," at ").concat(e.filename,".");return new dn(n,t)},i.prototype.scriptError=function(t){var e=this.stub,n="Error registering the ".concat(e.name," keyboard for ").concat(e.langName,"; keyboard script at ").concat(e.filename," may contain an error.");return new ut(n,t)},i}(),yr=function(){function i(t){this._harness=t}return Object.defineProperty(i.prototype,"harness",{get:function(){return this._harness},enumerable:!1,configurable:!0}),i.prototype.loadKeyboardFromPath=function(t){this.harness.install();var e=this.loadKeyboardInternal(t,new Fr(t));return e},i.prototype.loadKeyboardFromStub=function(t){this.harness.install();var e=this.loadKeyboardInternal(t.filename,new ur(t),t.id);return e},i}(),gn=yr;var Fn;(function(i){i.KEYBOARD="keyboard",i.LANGUAGE="language",i.LANGUAGE_KEYBOARD="languageKeyboard",i.BLANK="blank"})(Fn||(Fn={}));var Be=Fn;function un(i,t){if(i)return{family:i.family,path:t,files:i.filename||i.source}}var Ir=function(){function i(t,e){if(typeof t!="string")if(t.KI||t.KL||t.KLC||t.KFont||t.KOskFont){var n=t;this.KI=n.KI,this.KN=n.KN,this.KL=n.KL,this.KLC=n.KLC,this.KFont=n.KFont,this.KOskFont=n.KOskFont,this._displayName=n instanceof i?n._displayName:n.displayName}else{var c=t;c.languages||(c.languages=c.language),this.KI=c.id,this.KN=c.name,this.KL=c.languages.name,this.KLC=c.languages.id,this.KFont=un(c.languages.font,e),this.KOskFont=un(c.languages.oskFont,e)}else this.KI=t,this.KLC=e}return Object.defineProperty(i,"spacebarTextMode",{get:function(){return typeof this.spacebarTextModeSrc=="string"?this.spacebarTextModeSrc:this.spacebarTextModeSrc()},set:function(t){this.spacebarTextModeSrc=t},enumerable:!1,configurable:!0}),i.fromMultilanguageAPIStub=function(t){var e=[];t.languages||(t.languages=t.language);for(var n=0,c=t.languages;n<c.length;n++){var l=c[n],r={id:t.id,name:t.name,languages:l};e.push(new i(r))}return e},Object.defineProperty(i.prototype,"id",{get:function(){return this.KI},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this.KN},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"langId",{get:function(){return this.KLC},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"langName",{get:function(){return this.KL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"displayName",{get:function(){if(this._displayName)return this._displayName;var t=this.KN,e=this.KL;switch(i.spacebarTextMode){case Be.KEYBOARD:return t;case Be.LANGUAGE:return e;case Be.LANGUAGE_KEYBOARD:return t==e?e:e+" - "+t;case Be.BLANK:return"";default:return t}},set:function(t){this._displayName=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textFont",{get:function(){return this.KFont},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"oskFont",{get:function(){return this.KOskFont},enumerable:!1,configurable:!0}),i.prototype.validateForOSK=function(){return this.KLC?this.displayName===void 0||i.spacebarTextMode!=Be.BLANK&&!this.displayName?new Error("A display name is missing for this keyboard and cannot be generated under current settings."):null:this.KI||this.KN?new Error("No language code was specified for use with the ".concat(this.KI||this.KN," keyboard")):new Error("No language code was specified for use with the corresponding keyboard")},i.prototype.validateForCustomKeyboard=function(){return!this.KI||!this.KN||!this.KL||!this.KLC?new Error("To use a custom keyboard, you must specify keyboard id, keyboard name, language and language code."):null},i.spacebarTextModeSrc=Be.KEYBOARD,i}(),Ke=Ir;var yn=function(){function i(t,e){this.p=t,this.d=e,this.o=i.ordinalSeed++}return i.prototype.match=function(t,e){var n=this.p==t&&this.d==e;return n},i.prototype.set=function(){this.matched=1},i.prototype.reset=function(){this.matched=0},i.prototype.before=function(t){return this.o<t.o},i.prototype.clone=function(){var t=new i(this.p,this.d);return t.o=this.o,t},i.ordinalSeed=0,i.sortFunc=function(t,e){return t.p!=e.p?e.p-t.p:e.o-t.o},i}();var Ac=function(){function i(){this.dks=[]}return i.prototype.toSortedArray=function(){return this.dks=this.dks.sort(yn.sortFunc),[].concat(this.dks)},i.prototype.clone=function(){var t=new i,e=this.toSortedArray();return t.dks=[],e.forEach(function(n){t.dks.push(n.clone())}),t},i.prototype.isMatch=function(t,e,n){if(this.dks.length==0)return!1;var c=t;e=c-e;for(var l=0;l<this.dks.length;l++)if(this.dks[l].match(e,n)&&!this.dks[l].matched)return this.dks[l].set(),!0;return this.resetMatched(),!1},i.prototype.add=function(t){this.dks=this.dks.concat(t)},i.prototype.remove=function(t){var e=this.dks.indexOf(t);this.dks.splice(e,1)},i.prototype.clear=function(){this.dks=[]},i.prototype.resetMatched=function(){for(var t=0,e=this.dks;t<e.length;t++){var n=e[t];n.reset()}},i.prototype.deleteMatched=function(){for(var t=0;t<this.dks.length;t++)this.dks[t].matched&&this.dks.splice(t--,1)},i.prototype.adjustPositions=function(t,e){if(e!=0)for(var n=0,c=this.dks;n<c.length;n++){var l=c[n];l.p>t&&(l.p+=e)}},i.prototype.count=function(){return this.dks.length},i}();var Hc=function(){function i(t){this.id=t}return i.prototype.set=function(t){throw new Error("System store with ID "+this.id+" may not be directly set.")},i}();var Rt=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e)||this;return c.handler=null,c._value=n,c}return Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),t.prototype.matches=function(e){return this._value==e},t.prototype.set=function(e){this.handler&&this.handler(this,e)||(this._value=e)},t}(Hc);var Wc=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this,w.TSS_PLATFORM)||this;return n.kbdInterface=e,n}return t.prototype.matches=function(e){var n,c,l=e.split(" "),r=this.kbdInterface.activeDevice;for(n=0;n<l.length;n++)switch(c=l[n].toLowerCase(),c){case"touch":case"hardware":if(r.touchable!=(c=="touch"))return!1;break;case"macos":case"mac":c="macosx";case"macosx":case"windows":case"android":case"ios":case"linux":if(r.OS!=c)return!1;break;case"tablet":case"phone":case"desktop":if(r.formFactor!=c)return!1;break;case"web":if(r.browser=="native")return!1;break;case"native":case"chrome":case"firefox":case"safari":case"edge":case"opera":if(r.browser!=c)return!1;break;default:return!1}return!0},t}(Hc);at();function _e(i){var t;return i?i.insert===""&&i.deleteLeft===0&&((t=i.deleteRight)!==null&&t!==void 0?t:0)===0:!1}var Qr=function(){function i(t,e,n){this.insert=t,this.deleteLeft=e,this.deleteRight=n||0}return i.nil=new i("",0,0),i}();var hr=function(){function i(t,e,n,c){var l=this.token=i.tokenSeed++;this.keystroke=t,this.transform=e,this.alternates=c,this.preInput=n,this.transform.id=this.token,c&&c.forEach(function(r){r.sample.id=l})}return i.tokenSeed=0,i}();var Nc=function(){function i(){this._dks=new Ac}return Object.defineProperty(i.prototype,"isSynthetic",{get:function(){return!0},enumerable:!1,configurable:!0}),i.prototype.resetContext=function(){this.deadkeys().clear()},i.prototype.deadkeys=function(){return this._dks},i.prototype.hasDeadkeyMatch=function(t,e){return this.deadkeys().isMatch(this.getDeadkeyCaret(),t,e)},i.prototype.insertDeadkeyBeforeCaret=function(t){var e=new yn(this.getDeadkeyCaret(),t);this.deadkeys().add(e)},i.prototype.adjustDeadkeys=function(t){this.deadkeys().adjustPositions(this.getDeadkeyCaret(),t)},i.prototype.setDeadkeys=function(t){this._dks=t.clone()},i.prototype.buildTransformFrom=function(t){for(var e=this.getText(),n=t.getText(),c=t.getDeadkeyCaret(),l=this.getDeadkeyCaret(),r=c<l?c:l,s=e._kmwCodePointToCodeUnit(r),o=0,a=s;o<a;){var B=Math.floor((a+o+1)/2),g=n.substr(o,B-o),F=e.substr(o,B-o);g==F?o=B:a=B-1}if(a>0&&a<s){var u=n.charCodeAt(a-1),I=n.charCodeAt(a),y=e.charCodeAt(a);if(u>=55296&&u<=56319){var Q=I>=56320&&I<=57343;Q=Q||y>=56320&&y<=57343,Q&&(a=a-1)}}var h=n._kmwCodeUnitToCodePoint(a),C=c-h,b=l-h,x=e._kmwSubstr(h,b),G=e._kmwLength()-l,X=n._kmwLength()-c,m=X-G;return m<0&&(x=x+e._kmwSubstr(l,-m),m=0),new Qr(x,C,m)},i.prototype.buildTranscriptionFrom=function(t,e,n,c){var l=this.buildTransformFrom(t);return new hr(e,l,D.from(t,n),c)},i.prototype.restoreTo=function(t){this.setTextBeforeCaret(t.getTextBeforeCaret()),this.setTextAfterCaret(t.getTextAfterCaret()),this._dks=t._dks.clone()},i.prototype.apply=function(t){t.deleteRight&&this.setTextAfterCaret(this.getTextAfterCaret()._kmwSubstr(t.deleteRight)),t.deleteLeft&&this.deleteCharsBeforeCaret(t.deleteLeft),t.insert&&this.insertTextBeforeCaret(t.insert),this._dks.clear()},i.prototype.setTextBeforeCaret=function(t){this.deleteCharsBeforeCaret(this.getTextBeforeCaret()._kmwLength()),this.insertTextBeforeCaret(t)},i.prototype.saveProperties=function(){},i.prototype.restoreProperties=function(){},i}(),In=Nc,D=function(i){(0,d.__extends)(t,i);function t(e,n,c){var l=i.call(this)||this;l.selForward=!0,l.text=e||"";var r=l.text._kmwLength();return l.selStart=typeof n=="number"?n:r,l.selEnd=typeof c=="number"?c:l.selStart,l.selForward=l.selEnd>=l.selStart,l}return t.from=function(e,n){var c;if(e instanceof t){var l=e;c=new t(l.text,l.selStart,l.selEnd)}else{var r=e.getText(),s=r._kmwLength(),o=s,a=0;if(e.hasSelection()){var B=e.getTextBeforeCaret(),g=e.getTextAfterCaret();o=B._kmwLength(),a=s-g._kmwLength()}c=new t(r,o,a)}return c.setDeadkeys(e.deadkeys()),c},t.prototype.clearSelection=function(){this.text=this.getTextBeforeCaret()+this.getTextAfterCaret(),this.selEnd=this.selStart,this.selForward=!0},t.prototype.invalidateSelection=function(){},t.prototype.isSelectionEmpty=function(){return this.selStart==this.selEnd},t.prototype.hasSelection=function(){return!0},t.prototype.getDeadkeyCaret=function(){return this.selStart},t.prototype.setSelection=function(e,n){if(this.selStart=e,this.selEnd=typeof n=="number"?n:e,this.selForward=n>=e,!this.selForward){var c=this.selStart;this.selStart=this.selEnd,this.selEnd=c}},t.prototype.getTextBeforeCaret=function(){return this.text.kmwSubstr(0,this.selStart)},t.prototype.getSelectedText=function(){return this.text.kmwSubstr(this.selStart,this.selEnd-this.selStart)},t.prototype.getTextAfterCaret=function(){return this.text.kmwSubstr(this.selEnd)},t.prototype.getText=function(){return this.text},t.prototype.deleteCharsBeforeCaret=function(e){e>=0&&(e>this.selStart&&(e=this.selStart),this.adjustDeadkeys(-e),this.text=this.text.kmwSubstr(0,this.selStart-e)+this.text.kmwSubstr(this.selStart),this.selStart-=e,this.selEnd-=e)},t.prototype.insertTextBeforeCaret=function(e){this.adjustDeadkeys(e._kmwLength()),this.text=this.getTextBeforeCaret()+e+this.text.kmwSubstr(this.selStart),this.selStart+=e.kmwLength(),this.selEnd+=e.kmwLength()},t.prototype.handleNewlineAtCaret=function(){this.insertTextBeforeCaret("\n")},t.prototype.setTextAfterCaret=function(e){this.text=this.getTextBeforeCaret()+e},t.prototype.doInputEvent=function(){},t}(Nc);var Cr=function(){function i(){this.transcription=null,this.setStore={},this.saveStore={},this.variableStores={},this.triggersDefaultCommand=!1}return i.prototype.finalize=function(t,e,n){if(!this.transcription)throw"Cannot finalize a RuleBehavior with no transcription.";t.beepHandler&&this.beep&&t.beepHandler(e);for(var c in this.setStore){var l=t.keyboardInterface.systemStores[c];if(l)try{l.set(this.setStore[c])}catch(s){t.errorLogger&&t.errorLogger("Rule attempted to perform illegal operation - 'platform' may not be changed.")}else t.warningLogger&&t.warningLogger("Unknown store affected by keyboard rule: "+c)}if(t.keyboardInterface.applyVariableStores(this.variableStores),t.keyboardInterface.variableStoreSerializer)for(var c in this.saveStore)t.keyboardInterface.variableStoreSerializer.saveStore(t.activeKeyboard.id,c,this.saveStore[c]);if(this.triggersDefaultCommand){var r=this.transcription.keystroke;t.defaultRules.applyCommand(r,e)}t.warningLogger&&this.warningLog?t.warningLogger(this.warningLog):t.errorLogger&&this.errorLog&&t.errorLogger(this.errorLog)},i.prototype.mergeInDefaults=function(t){var e=this.transcription.keystroke,n=t.transcription.keystroke;if(e.Lcode!=n.Lcode||e.Lmodifiers!=n.Lmodifiers)throw"RuleBehavior default-merge not supported unless keystrokes are identical!";this.triggersDefaultCommand=this.triggersDefaultCommand||t.triggersDefaultCommand;var c=D.from(this.transcription.preInput,!1);c.apply(this.transcription.transform),c.apply(t.transcription.transform),this.transcription=c.buildTranscriptionFrom(this.transcription.preInput,e,!1,this.transcription.alternates)},i}(),de=Cr;var br=function(){function i(){}return i}();var Ur=function(){function i(){}return i.prototype.reset=function(){this._cache=[]},i.prototype.get=function(t,e){return typeof this._cache[t]=="undefined"||typeof this._cache[t][e]=="undefined"?null:this._cache[t][e]},i.prototype.set=function(t,e,n){typeof this._cache[t]=="undefined"&&(this._cache[t]=[]),this._cache[t][e]=n},i}(),xr=function(){function i(){}return i.prototype.reset=function(){this._cache=[]},i.prototype.get=function(t,e){return typeof this._cache[t]=="undefined"||typeof this._cache[t][e]=="undefined"?null:this._cache[t][e]},i.prototype.set=function(t,e,n){typeof this._cache[t]=="undefined"&&(this._cache[t]=[]),this._cache[t][e]=n},i.prototype.clone=function(){var t=new i;return t._cache=this._cache,t},i}(),w;(function(i){i[i.TSS_LAYER=33]="TSS_LAYER",i[i.TSS_PLATFORM=31]="TSS_PLATFORM",i[i.TSS_NEWLAYER=42]="TSS_NEWLAYER",i[i.TSS_OLDLAYER=43]="TSS_OLDLAYER"})(w||(w={}));var Tc=function(i){(0,d.__extends)(t,i);function t(e,n,c){c===void 0&&(c=null);var l=i.call(this,e,n)||this;return l.cachedContext=new Ur,l.cachedContextEx=new xr,l._AnyIndices=[],l.systemStores={},l.systemStores[w.TSS_PLATFORM]=new Wc(l),l.systemStores[w.TSS_LAYER]=new Rt(w.TSS_LAYER,"default"),l.systemStores[w.TSS_NEWLAYER]=new Rt(w.TSS_NEWLAYER,""),l.systemStores[w.TSS_OLDLAYER]=new Rt(w.TSS_OLDLAYER,""),l.variableStoreSerializer=c,l}return Object.defineProperty(t.prototype,"Codes",{get:function(){return U},enumerable:!1,configurable:!0}),t.prototype.saveFocus=function(){},t.prototype.registerKeyboard=function(e){var n=new q(e);this.loadedKeyboard=n},t.prototype.context=function(e,n,c){var l=this.cachedContext.get(e,n);if(l!==null)return l;var r=this.KC_(e,n,c);return this.cachedContext.set(e,n,r),r},t.prototype.KC_=function(e,n,c){var l="";return l=c.isSelectionEmpty()?c.getTextBeforeCaret():"",l._kmwLength()<e&&(l=Array(e-l._kmwLength()+1).join("\uFFFE")+l),l._kmwSubstr(-e)._kmwSubstr(0,n)},t.prototype.nul=function(e,n){var c=this.context(e+1,1,n);return c==="\uFFFE"},t.prototype.contextMatch=function(e,n,c,l){var r=this.context(e,l,n);return r===c?!0:(n.deadkeys().resetMatched(),!1)},t.prototype._BuildExtendedContext=function(e,n,c){var l=this.cachedContextEx.get(e,n);if(l!==null)return l;if(l=this.cachedContextEx.get(e,e),l===null){var r=c.deadkeys().toSortedArray(),s=0;for(l={valContext:[],deadContext:[]};l.valContext.length<e;){var o=c.getDeadkeyCaret(),a=o-s;if(r.length>0&&r[0].p>a){r.splice(0,1);continue}else if(r.length>0&&r[0].p==a)l.deadContext[e-l.valContext.length-1]=r[0],l.valContext=[r[0].d].concat(l.valContext),r.splice(0,1);else{var B=this.context(++s,1,c);l.valContext=[B].concat(l.valContext)}}this.cachedContextEx.set(e,e,l)}var g=l;g.valContext=g.valContext.slice(0,n);for(var F=0;F<g.valContext.length;F++)g[F]=="\uFFFE"&&(g.valContext.splice(0,1),g.deadContext.splice(0,1));return g.valContext.length==0&&(g.valContext=["\uFFFE"],g.deadContext=[]),this.cachedContextEx.set(e,n,g),g},t.prototype.fullContextMatch=function(e,n,c){var l=this._BuildExtendedContext(e,c.length,n);this.ruleContextEx=this.cachedContextEx.clone();for(var r=l.valContext,s=l.deadContext,o=!1,a="\uFFFE",B=function(h){throw new Error("Unexpected object in fullContextMatch specification: "+h)},g=0;g<c.length;g++)if(typeof c[g]=="string"){var F=c[g];if(F!==r[g]){o=!0;break}}else{var u=c[g];switch(u.t){case"d":u.d!==r[g]?o=!0:s[g].set();break;case"a":var I;typeof r[g]=="string"?I=r[g]:I={t:"d",d:r[g]};var y=this.any(g,I,u.a);u.n?u.n&&(y||r[g]===a)&&(o=!0):y?s[g]!==void 0&&s[g].set():o=!0;break;case"i":var Q=this._Index(u.i,u.o);Q!==void 0&&(typeof Q=="string"?Q:Q.d)!==r[g]?o=!0:s[g]!==void 0&&s[g].set();break;case"c":r[u.c-1]!==r[g]?o=!0:s[g]!==void 0&&s[g].set();break;case"n":r[g]!=a&&(o=!0);break;default:B(u)}}return o&&(n.deadkeys().resetMatched(),this._AnyIndices=[]),!o},t.prototype.isKeypress=function(e){return this.activeKeyboard.isMnemonic?!e.LisVirtualKey:!!ae._USKeyCodeToCharCode(e)},t.matchModifiersToRuleChirality=function(e,n){var c=U.modifierCodes.LALT|U.modifierCodes.RALT,l=U.modifierCodes.LCTRL|U.modifierCodes.RCTRL,r=e;if(!(n&c)){var s=r&c;s&&(r^=s|U.modifierCodes.ALT)}if(!(n&l)){var o=r&l;o&&(r^=o|U.modifierCodes.CTRL)}return r},t.prototype.keyMatch=function(e,n,c){var l=!1,r=e.Lcode==173?189:e.Lcode,s=this.activeKeyboard.modifierBitmask,o=s&U.modifierBitmasks.ALL,a=s&U.stateBitmasks.ALL,B=t.matchModifiersToRuleChirality(e.Lmodifiers,n);return e.vkCode>255&&(r=e.vkCode),e.LisVirtualKey||r>255?((n&16384)==16384||r>255)&&(l=c==r&&(n&o)==B,l=l&&this.stateMatch(e,n&a)):(n&16384)==0&&(l=r==c),l||this.activeTargetOutput.deadkeys().resetMatched(),l},t.prototype.stateMatch=function(e,n){return(n&e.Lstates)==n},t.prototype.keyInformation=function(e){var n=new br;return n.vk=e.LisVirtualKey,n.code=e.Lcode,n.modifiers=e.Lmodifiers,n},t.prototype.deadkeyMatch=function(e,n,c){return n.hasDeadkeyMatch(e,c)},t.prototype.beep=function(e){this.resetContextCache(),this.ruleBehavior.beep=!0},t.prototype._ExplodeStore=function(e){if(typeof e=="string"){var n=this.activeKeyboard.explodedStores;if(n[e])return n[e];for(var c=[],l=0;l<e._kmwLength();l++)c.push(e._kmwCharAt(l));return n[e]=c,c}else return e},t.prototype.any=function(e,n,c){if(n=="")return!1;c=this._ExplodeStore(c);for(var l=-1,r=0;r<c.length;r++)if(typeof c[r]=="string"){if(c[r]==n){l=r;break}}else if(c[r].d===n.d){l=r;break}return this._AnyIndices[e]=l,l>=0},t.prototype._Index=function(e,n){return e=this._ExplodeStore(e),this._AnyIndices[n-1]<e.length?e[this._AnyIndices[n-1]]:(console.warn("Unmatched contextual index() statement detected in rule with index "+n+"!"),"")},t.prototype.indexOutput=function(e,n,c,l){this.resetContextCache();var r=function(a){throw new Error("Unexpected object in fullContextMatch specification: "+a)},s=this._Index(n,c);if(s!=="")if(typeof s=="string")this.output(e,l,s);else if(s.t){var o=s;switch(o.t){case"b":this.beep(l);break;case"d":this.deadkeyOutput(e,l,s.d);break;default:r(o)}}else this.deadkeyOutput(e,l,s.d)},t.prototype.deleteContext=function(e,n){var c;if(e>0){c=this._BuildExtendedContext(e,e,n);for(var l=0,r=0;r<c.valContext.length;r++){var s=c.deadContext[r];s?(n.deadkeys().remove(s),e--):c.valContext[r]=="\uFFFE"&&l++}var o=c.valContext.length-l;e>o&&(e=o)}n.deadkeys().resetMatched(),this.output(e,n,"")},t.prototype.output=function(e,n,c){this.resetContextCache(),n.saveProperties(),n.clearSelection(),n.deadkeys().deleteMatched(),e>=0&&n.deleteCharsBeforeCaret(e),n.insertTextBeforeCaret(c),n.restoreProperties()},t.prototype.contextExOutput=function(e,n,c,l){this.resetContextCache(),e>=0&&this.output(e,n,"");var r=this.ruleContextEx.get(c,c),s=r.deadContext[l-1],o=r.valContext[l-1];if(s)n.insertDeadkeyBeforeCaret(s.d);else if(typeof o=="string")this.output(-1,n,o);else throw new Error("contextExOutput: should never be a numeric valContext with no corresponding deadContext")},t.prototype.deadkeyOutput=function(e,n,c){this.resetContextCache(),e>=0&&this.output(e,n,""),n.insertDeadkeyBeforeCaret(c)},t.prototype.ifStore=function(e,n,c){var l=!0,r=this.systemStores[e];return r&&(l=r.matches(n)),l},t.prototype.setStore=function(e,n,c){if(this.resetContextCache(),e==w.TSS_LAYER&&this.activeDevice.touchable)this.ruleBehavior.setStore[e]=n;else return!1},t.prototype.loadStore=function(e,n,c){if(this.resetContextCache(),this.variableStoreSerializer){var l=this.variableStoreSerializer.loadStore(e,n);return l[n]||c}else return c},t.prototype.saveStore=function(e,n){this.resetContextCache();var c=this.activeKeyboard;if(!c||typeof c.id=="undefined"||c.id=="")return!1;var l={};return l[e]=n,this.ruleBehavior?this.ruleBehavior.saveStore[e]=l:this.variableStoreSerializer.saveStore(this.activeKeyboard.id,e,l),!0},t.prototype.resetContextCache=function(){this.cachedContext.reset(),this.cachedContextEx.reset()},t.prototype.defaultBackspace=function(e){e.isSelectionEmpty()?this.output(1,e,""):this.output(0,e,"")},t.prototype.processNewContextEvent=function(e,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processNewContextEvent.bind(this.activeKeyboard),e,n,!0)},t.prototype.processPostKeystroke=function(e,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processPostKeystroke.bind(this.activeKeyboard),e,n,!0)},t.prototype.processKeystroke=function(e,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.process.bind(this.activeKeyboard),e,n,!1)},t.prototype.process=function(e,n,c,l){if(n)if(this.activeKeyboard){if(!e)throw"No callee for keystroke processing!"}else throw"No active keyboard for keystroke processing!";else throw"No target specified for keyboard output!";n.invalidateSelection(),n.deadkeys().resetMatched(),this.resetContextCache();var r=D.from(n,!0),s=this.activeKeyboard.variableStores;this.ruleBehavior=new de,this.activeDevice=c.device,this.activeTargetOutput=n;var o=e(n,c);this.activeTargetOutput=null,this.ruleBehavior.transcription=n.buildTranscriptionFrom(r,c,l),this.ruleBehavior.variableStores=this.activeKeyboard.variableStores,this.activeKeyboard.variableStores=s,this.ruleBehavior.triggerKeyDefault=!o;var a=this.ruleBehavior;return this.ruleBehavior=null,a},t.prototype.applyVariableStores=function(e){this.activeKeyboard.variableStores=e},t.__publishShorthandAPI=function(){var e=this.prototype,n=function(c,l){e[l]&&(e[c]=e[l])};n("KSF","saveFocus"),n("KBR","beepReset"),n("KT","insertText"),n("KR","registerKeyboard"),n("KRS","registerStub"),n("KC","context"),n("KN","nul"),n("KCM","contextMatch"),n("KFCM","fullContextMatch"),n("KIK","isKeypress"),n("KKM","keyMatch"),n("KSM","stateMatch"),n("KKI","keyInformation"),n("KDM","deadkeyMatch"),n("KB","beep"),n("KA","any"),n("KDC","deleteContext"),n("KO","output"),n("KDO","deadkeyOutput"),n("KCXO","contextExOutput"),n("KIO","indexOutput"),n("KIFS","ifStore"),n("KSETS","setStore"),n("KLOAD","loadStore"),n("KSAVE","saveStore")},t.GLOBAL_NAME="KeymanWeb",t}(Ft),yt=Tc;(function(){Tc.__publishShorthandAPI()})();var Ec=R(H(),1);var pr=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this)||this;return c.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1},c.modStateFlags=0,n||(n=t.DEFAULT_OPTIONS),c.contextDevice=e,c.baseLayout=n.baseLayout||t.DEFAULT_OPTIONS.baseLayout,c.keyboardInterface=n.keyboardInterface||new yt(ze(),gt),c.defaultRules=n.defaultOutputRules||t.DEFAULT_OPTIONS.defaultOutputRules,c}return Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this.keyboardInterface.activeKeyboard},set:function(e){this.keyboardInterface.activeKeyboard=e,this.resetContext()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerStore",{get:function(){return this.keyboardInterface.systemStores[w.TSS_LAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newLayerStore",{get:function(){return this.keyboardInterface.systemStores[w.TSS_NEWLAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldLayerStore",{get:function(){return this.keyboardInterface.systemStores[w.TSS_OLDLAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerId",{get:function(){return this.layerStore.value},set:function(e){this.layerStore.set(e)},enumerable:!1,configurable:!0}),t.prototype.defaultRuleBehavior=function(e,n,c){var l=D.from(n,c),r=new de,s=!1,o="",a;if(e.isSynthetic||n.isSynthetic)if(s=!0,this.defaultRules.isCommand(e))r.triggersDefaultCommand=!0;else if((a=this.defaultRules.forSpecialEmulation(e))!=null)switch(a){case Le.Backspace:this.keyboardInterface.defaultBackspace(n);break;case Le.Enter:n.handleNewlineAtCaret();break;default:r.errorLog="Unexpected 'special emulation' character (\\u"+a.kmwCharCodeAt(0).toString(16)+") went unhandled!"}else s=!1;var B=this.activeKeyboard&&this.activeKeyboard.isMnemonic;if(!s)if((o=this.defaultRules.forAny(e,B))!=null)if(a=this.defaultRules.forSpecialEmulation(e),a==Le.Backspace)this.keyboardInterface.defaultBackspace(n);else{if(a||this.defaultRules.isCommand(e))return null;this.keyboardInterface.output(0,n,o)}else return null;if(r.errorLog)return r;var g=n.buildTranscriptionFrom(l,e,c);return r.transcription=g,r},t.prototype.processNewContextEvent=function(e,n){return this.activeKeyboard?this.keyboardInterface.processNewContextEvent(n,this.activeKeyboard.constructNullKeyEvent(e,this.stateKeys)):null},t.prototype.processPostKeystroke=function(e,n){return this.activeKeyboard?this.keyboardInterface.processPostKeystroke(n,this.activeKeyboard.constructNullKeyEvent(e,this.stateKeys)):null},t.prototype.processKeystroke=function(e,n){var c;if(this.activeKeyboard&&e.Lcode!=0&&(c=this.keyboardInterface.processKeystroke(n,e)),!c||c.triggerKeyDefault){e.Lcode=e.vkCode||e.Lcode,this.keyboardInterface.activeTargetOutput=n;var l=this.defaultRuleBehavior(e,n,!1);l&&(c?c.mergeInDefaults(l):c=l,c.triggerKeyDefault=!1),this.keyboardInterface.activeTargetOutput=null}return c},t.prototype._UpdateVKShift=function(e){var n=0,c=["CAPS","NUM_LOCK","SCROLL_LOCK"],l=["K_CAPS","K_NUMLOCK","K_SCROLL"];if(!this.activeKeyboard)return!0;if(e){n=e.Lmodifiers,this.activeKeyboard.isChiral&&this.activeKeyboard.emulatesAltGr&&(this.modStateFlags&U.modifierBitmasks.ALT_GR_SIM)==U.modifierBitmasks.ALT_GR_SIM&&(n|=U.modifierBitmasks.ALT_GR_SIM,n&=~U.modifierCodes.RALT);for(var r=!1,s=0;s<c.length;s++)e.Lstates&U.stateBitmasks[c[s]]&&(this.stateKeys[l[s]]=!!(e.Lstates&U.modifierCodes[c[s]]),r=!0);r&&this.emit("statekeychange",this.stateKeys)}return this.updateStates(),this.activeKeyboard.isMnemonic&&this.stateKeys.K_CAPS&&(!e||!e.isModifier)&&(n^=U.modifierCodes.SHIFT),this.layerId=this.getLayerId(n),!0},t.prototype.updateStates=function(){for(var e=["CAPS","NUM_LOCK","SCROLL_LOCK"],n=["K_CAPS","K_NUMLOCK","K_SCROLL"],c=0;c<n.length;c++){var l=n[c],r=this.stateKeys[l],s=e[c],o="NO_"+e[c];r?(this.modStateFlags|=U.modifierCodes[s],this.modStateFlags&=~U.modifierCodes[o]):(this.modStateFlags&=~U.modifierCodes[s],this.modStateFlags|=U.modifierCodes[o])}},t.prototype.getLayerId=function(e){return O.getLayerId(e)},t.prototype.selectLayer=function(e){var n=e.kName,c=e.kNextLayer,l=this.activeKeyboard&&this.activeKeyboard.isChiral;if(typeof c=="number"&&(c=this.getLayerId(c*16)),!c)switch(n){case"K_LSHIFT":case"K_RSHIFT":case"K_SHIFT":c="shift";break;case"K_LCONTROL":case"K_LCTRL":if(l){c="leftctrl";break}case"K_RCONTROL":case"K_RCTRL":if(l){c="rightctrl";break}case"K_CTRL":c="ctrl";break;case"K_LMENU":case"K_LALT":if(l){c="leftalt";break}case"K_RMENU":case"K_RALT":if(l){c="rightalt";break}case"K_ALT":c="alt";break;case"K_ALTGR":l?c="leftctrl-rightalt":c="ctrl-alt";break;case"K_CURRENCIES":case"K_NUMERALS":case"K_SHIFTED":case"K_UPPER":case"K_LOWER":case"K_SYMBOLS":c="default";break}return c?(this.updateLayer(e,c),!0):!1},t.prototype.updateLayer=function(e,n){var c=this.layerId,l=c;if(n==c&&e.device.formFactor!=V.FormFactor.Desktop)return!1;var r=n,s;if(e.device.formFactor==V.FormFactor.Desktop){var o=["leftctrl","rightctrl","ctrl","leftalt","rightalt","alt","shift"];for(s=0;s<o.length;s++)r=r.replace(o[s]+"-",""),r=r.replace(o[s],"");if(c=="default"||c=="numeric"||c=="symbol"||c=="currency"||r!="")l=n;else{var a=U.getModifierState(l);for(s=0;s<o.length;s++)l=l.replace(o[s]+"-",""),l=l.replace(o[s],"");switch(n){case"shift":a^=U.modifierCodes.SHIFT;break;case"leftctrl":a^=U.modifierCodes.LCTRL;break;case"rightctrl":a^=U.modifierCodes.RCTRL;break;case"ctrl":a^=U.modifierCodes.CTRL;break;case"leftalt":a^=U.modifierCodes.LALT;break;case"rightalt":a^=U.modifierCodes.RALT;break;case"alt":a^=U.modifierCodes.ALT;break;default:l=n}l!="default"&&(l==""?l=this.getLayerId(a):l=this.getLayerId(a)+"-"+l)}l==""&&(l="default")}else l=n;var B=this.activeKeyboard.layout(e.device.formFactor);B.getLayer(l)?this.layerId=l:this.layerId="default";var g=U.getModifierState(this.layerId);this.modStateFlags=g|e.Lstates},t.prototype.doModifierPress=function(e,n,c){return this.activeKeyboard?e.isModifier?(this.activeKeyboard.notify(e.Lcode,n,c?1:0),e.device.touchable?!0:this._UpdateVKShift(e)):(e.LmodifierChange&&(this.activeKeyboard.notify(0,n,1),e.device.touchable||this._UpdateVKShift(e)),!1):!1},t.prototype.performNewContextEvent=function(e){var n=this.processNewContextEvent(this.contextDevice,e);return n&&n.finalize(this,e,!0),n},t.prototype.resetContext=function(e){this.layerId="default",e==null||e.resetContext(),this.keyboardInterface.resetContextCache(),e&&this.performNewContextEvent(e),this.contextDevice.touchable||this._UpdateVKShift(null)},t.prototype.setNumericLayer=function(e){if(this.activeKeyboard){var n=this.activeKeyboard.layout(e.formFactor);n.getLayer("numeric")&&(this.layerId="numeric")}},t.DEFAULT_OPTIONS={baseLayout:"us",defaultOutputRules:new Ee},t}(Ec.default),Qn=pr;var kc=function(i){return i.substring(i.length-1)!="/"?i+"/":i},Gr=function(){function i(t,e){e=kc(e),this.sourcePath=e,this.protocol=e.replace(/(.{3,5}:)(.*)/,"$1"),this.updateFromOptions(t)}return i.prototype.updateFromOptions=function(t){var e=this.sourcePath.replace(/(https?:\/\/)([^\/]*)(.*)/,"$1$2/");this._root=e,t.root!=""?this._root=this.fixPath(t.root):this._root=this.fixPath(e);var n=t.resources;n==""&&(n=this.sourcePath),this._resources=this.fixPath(n),this._keyboards=this.fixPath(t.keyboards),this._fonts=this.fixPath(t.fonts)},i.prototype.fixPath=function(t){return t.length==0||(t=kc(t),t.replace(/^(http)s?:.*/,"$1")=="http"||t.replace(/^(file):.*/,"$1")=="file")?t:t.substring(0,2)=="//"?this.protocol+t:t.substring(0,1)=="/"?this.root+t.substring(1):this.sourcePath+t},Object.defineProperty(i.prototype,"fonts",{get:function(){return this._fonts},enumerable:!1,configurable:!0}),i.prototype.updateFontPath=function(t){this._fonts=this.fixPath(t)},Object.defineProperty(i.prototype,"root",{get:function(){return this._root},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"resources",{get:function(){return this._resources},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keyboards",{get:function(){return this._keyboards},enumerable:!1,configurable:!0}),i}(),hn=Gr;var Cn={root:"",resources:"",keyboards:"",fonts:""};var mr=function(){function i(t){t.OS==V.OperatingSystem.Android?this.popupCanvasBackgroundColor="#999":this.popupCanvasBackgroundColor=i.prefersDarkMode()?"#0f1319":"#ffffff"}return i.prefersDarkMode=function(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches},i}(),Yc=mr;var At=function(){function i(){this.detected=!1,this.touchable="ontouchstart"in window,this.OS="",this.formFactor="desktop",this.browser="",this.dyPortrait=0,this.dyLandscape=0,this.version="0",this.orientation=window.orientation}return i.prototype.getDPI=function(){var t=document.createElement("DIV"),e=t.style,n=96;return document.readyState!=="complete"||(t.id="calculateDPI",e.position="absolute",e.display="block",e.visibility="hidden",e.left="10px",e.top="10px",e.width="1in",e.height="10px",document.body.appendChild(t),n=typeof window.devicePixelRatio=="undefined"?t.offsetWidth:t.offsetWidth*window.devicePixelRatio,document.body.removeChild(t)),n},i.prototype.detect=function(){var t=!1;if(navigator&&navigator.userAgent){var e=navigator.userAgent;if(e.indexOf("iPad")>=0)this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;else if(e.indexOf("iPhone")>=0)this.OS="iOS",this.formFactor="phone",this.dyPortrait=this.dyLandscape=25;else if(e.indexOf("Android")>=0){this.OS="Android",this.formFactor="phone",this.dyPortrait=75,this.dyLandscape=25;try{var n=new RegExp("(?:Android\\s+)(\\d+\\.\\d+\\.\\d+)");this.version=e.match(n)[1]}catch(I){}}else if(e.indexOf("Linux")>=0)this.OS="Linux";else if(e.indexOf("Macintosh")>=0){var c=/Intel Mac OS X (\d+(?:[_\.]\d+)+)/i,l=c.exec(e);if(!l)console.warn("KMW could not properly parse the user agent string.A suboptimal keyboard layout may result."),this.OS="MacOSX";else if(l.length>1&&l[1]){var r=l[1].replace("_","."),s=new ne(r);t=ne.MAC_POSSIBLE_IPAD_ALIAS.compareTo(s)<=0,this.OS="MacOSX"}}else e.indexOf("Windows NT")>=0&&(this.OS="Windows",e.indexOf("Touch")>=0&&(this.formFactor="phone"),typeof navigator.msMaxTouchPoints=="number"&&navigator.msMaxTouchPoints>0&&(this.touchable=!0))}var o=Math.min(screen.width,screen.height),a=Math.max(screen.width,screen.height),B=o/a;this.OS!="iOS"&&this.formFactor=="phone"&&(o>=600&&B>.5625||B>=.625)&&(this.formFactor="tablet");var g=navigator.platform=="Win32"||navigator.platform=="MacIntel";this.OS=="iOS"&&!("ongesturestart"in window)&&!g&&(this.OS="Android"),this.browser="web",(this.OS=="iOS"||this.OS.toLowerCase()=="macosx")&&(this.browser="safari");var F=/Firefox|Chrome|OPR|Safari|Edge/;if(F.test(navigator.userAgent)&&(navigator.userAgent.indexOf("Firefox")>=0&&"onmozorientationchange"in screen?this.browser="firefox":navigator.userAgent.indexOf("OPR")>=0?this.browser="opera":navigator.userAgent.indexOf(" Edge/")>=0?this.browser="edge":navigator.userAgent.indexOf("Chrome")>=0?this.browser="chrome":navigator.userAgent.indexOf("Safari")>=0&&(this.browser="safari")),t&&this.browser=="safari"&&window.TouchEvent){this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;var u=screen.height/screen.width;u<1&&(u=1/u),u>1.6&&(this.formFactor="phone",this.dyPortrait=this.dyLandscape=25)}return this.colorScheme=Yc.prefersDarkMode()?"dark":"light",this.detected=!0,this.coreSpec},Object.defineProperty(i.prototype,"coreSpec",{get:function(){return new V(this.browser,this.formFactor,this.OS,this.touchable)},enumerable:!1,configurable:!0}),i}();var bn=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this)||this;if(c.applyCacheBusting=!1,!n){var l=new At;l.detect(),n=l.coreSpec}return c.sourcePath=e,c.hostDevice=n,c.deferForInitialization=new J,c}return t.prototype.initialize=function(e){var n=this;this._paths?this._paths.updateFromOptions(e):this._paths=new hn(e,this.sourcePath),typeof e.setActiveOnRegister=="boolean"?this.activateFirstKeyboard=e.setActiveOnRegister:this.activateFirstKeyboard=!0,this._spacebarText=e.spacebarText,Ke.spacebarTextMode=function(){return n.spacebarText}},t.prototype.finalizeInit=function(){this.deferForInitialization.resolve()},Object.defineProperty(t.prototype,"paths",{get:function(){return this._paths},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spacebarText",{get:function(){return this._spacebarText},set:function(e){this._spacebarText!=e&&(this._spacebarText=e,this.emit("spacebartext",e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"softDevice",{get:function(){return this.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hardDevice",{get:function(){return an(this.hostDevice)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stubNamespacer",{get:function(){return this._stubNamespacer},set:function(e){this._stubNamespacer=e},enumerable:!1,configurable:!0}),t.prototype.debugReport=function(){return{hostDevice:this.hostDevice,initialized:this.deferForInitialization.isResolved}},t.prototype.onRuleFinalization=function(e,n){},t}(wc.default);var Un=(0,d.__assign)({setActiveOnRegister:!0,spacebarText:Be.LANGUAGE_KEYBOARD},Cn);var Oc=R(H(),1);var xn=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.pendingActivations=[],n.engineConfig=e,n}return Object.defineProperty(t.prototype,"predictionContext",{get:function(){return this._predictionContext},enumerable:!1,configurable:!0}),t.prototype.configure=function(e){this._resetContext=e.resetContext,this._predictionContext=e.predictionContext,this.keyboardCache=e.keyboardCache},t.prototype.insertText=function(e,n,c){var l=this.activeTarget;return l!=null?(n!=null&&e.output(0,l,n),typeof c!="undefined"&&c!==null&&e.deadkeyOutput(0,l,c),l.invalidateSelection(),!0):!1},t.prototype.resetContext=function(){this._resetContext(this.activeTarget),this.predictionContext.resetContext()},t.prototype.findAndPopActivation=function(e){var n;for(n=0;n<this.pendingActivations.length&&this.pendingActivations[n].target!=e;n++);return n==this.pendingActivations.length?null:this.pendingActivations.splice(n,1)[0]},t.prototype.deferredKeyboardActivation=function(e,n,c){return(0,d.__awaiter)(this,void 0,void 0,function(){var l,r;return(0,d.__generator)(this,function(s){switch(s.label){case 0:return l={target:c,keyboard:e,stub:n},this.findAndPopActivation(c),this.pendingActivations.push(l),[4,e];case 1:return s.sent(),r=this.findAndPopActivation(c),r==l?[2,l]:r?(this.pendingActivations.push(r),[2,null]):[2]}})})},t.prototype.activateKeyboard=function(e,n,c){return(0,d.__awaiter)(this,void 0,void 0,function(){var l,r,s,o,a;return(0,d.__generator)(this,function(B){switch(B.label){case 0:return l=!this.activeKeyboard,this.findAndPopActivation(this.currentKeyboardSrcTarget()),r=this.prepareKeyboardForActivation(e,n),s=this.currentKeyboardSrcTarget(),[4,r.keyboard];case 1:return o=B.sent(),o==null&&r.metadata?[2,!1]:(this.currentKeyboardSrcTarget()==s&&this.emit("beforekeyboardchange",r.metadata),a=null,o&&(a={keyboard:o,metadata:r.metadata}),this.activateKeyboardForTarget(a,s),this.currentKeyboardSrcTarget()==s&&(!l||!!o)&&(this.resetContext(),this.emit("keyboardchange",this.activeKeyboard)),[2,!0])}})})},t.prototype.prepareKeyboardForActivation=function(e,n){var c=this,l;n||(n="");var r=null;if(e?r=this.keyboardCache.getStub(e,n):n=="",!r){if(e)throw new Error("No matching stub has been registered.");return{keyboard:Promise.resolve(null),metadata:null}}if(((l=this.activeKeyboard)===null||l===void 0?void 0:l.metadata)&&e==this.activeKeyboard.metadata.id){var s=this.activeKeyboard.keyboard;return{keyboard:Promise.resolve(s),metadata:r}}var o;if(o=this.keyboardCache.getKeyboardForStub(r))return{keyboard:Promise.resolve(o),metadata:r};this.emit("beforekeyboardchange",r);var a=this.engineConfig.deferForInitialization.then(function(){var g=new J;c.emit("keyboardasyncload",r,g.corePromise);var F=c.keyboardCache.fetchKeyboardForStub(r),u=new Promise(function(y,Q){var h="Sorry, the ".concat(r.name," keyboard for ").concat(r.langName," is not currently available.");window.setTimeout(function(){return Q(new Error(h))},t.TIMEOUT_THRESHOLD)}),I=Promise.race([F,u]);return I.then(function(){g.resolve(null),u.catch(function(){})}),I.catch(function(y){throw g.resolve(y),y}),I}),B=this.deferredKeyboardActivation(a,r,this.currentKeyboardSrcTarget());return{keyboard:B.then(function(g){return(0,d.__awaiter)(c,void 0,void 0,function(){return(0,d.__generator)(this,function(F){return g?[2,a]:[2,Promise.resolve(null)]})})}),metadata:r}},t.TIMEOUT_THRESHOLD=1e4,t}(Oc.default);var Mc=R(H(),1);var Xr=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t}(Mc.default),pn=Xr;function Gn(i,t,e){var n=U.modifierCodes;if(t&&t.isMnemonic&&i.setMnemonicCode(!!(i.Lmodifiers&n.SHIFT),!!(i.Lmodifiers&n.CAPS)),t&&!t.isMnemonic){var c=ae.languageMap[e];c&&c["k"+i.Lcode]&&(i.Lcode=c["k"+i.Lcode]),!t.definesPositionalOrMnemonic&&!(i.Lmodifiers&96)&&!i.isModifier&&(i=new oe({Lcode:ae._USKeyCodeToCharCode(i),Lmodifiers:0,LisVirtualKey:!1,vkCode:i.Lcode,Lstates:i.Lstates,kName:"",device:i.device,isSynthetic:!1}))}return i}var Dc=R(H(),1),Ht="Keyboard_";function $(i){return i.startsWith(Ht)?i:Ht+i}function pe(i){return i.startsWith(Ht)?i.substring(Ht.length):i}var Vr=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.stubSetTable={},n.keyboardTable={},n.keyboardLoader=e,n}return t.prototype.getKeyboardForStub=function(e){return e?this.getKeyboard(e.KI):null},t.prototype.getKeyboard=function(e){if(!e)return null;var n=this.keyboardTable[$(e)];return n instanceof Promise?null:n},Object.defineProperty(t.prototype,"defaultStub",{get:function(){function e(c){var l=Object.keys(c);if(l.length!=0)return c[l[0]]}var n=e(this.stubSetTable);if(n)return e(n)},enumerable:!1,configurable:!0}),t.prototype.addKeyboard=function(e){var n=$(e.id);this.keyboardTable[n]=e,this.emit("keyboardadded",e)},t.prototype.fetchKeyboardForStub=function(e){return this.fetchKeyboard(e.KI)},t.prototype.isFetchingKeyboard=function(e){if(!e)throw new Error("Keyboard ID must be specified");e=$(e);var n=this.keyboardTable[e];return n instanceof Promise},t.prototype.fetchKeyboard=function(e){var n=this;if(!e)throw new Error("Keyboard ID must be specified");if(!this.keyboardLoader)throw new Error("Cannot load keyboards; this cache was configured without a loader");e=$(e);var c=this.keyboardTable[e];if(c instanceof q)return Promise.resolve(c);if(c instanceof Promise)return c;var l=this.getStub(e,null);if(!l)throw new Error("No stub for ".concat(pe(e)," has been registered"));if(!l.filename)throw new Error("The registered stub for ".concat(pe(e)," lacks a path to the main keyboard file"));var r=this.keyboardLoader.loadKeyboardFromStub(l);return this.keyboardTable[e]=r,r.then(function(s){s.scriptObject.KI=e,n.addKeyboard(s)}).catch(function(s){throw delete n.keyboardTable[e],s}),r},t.prototype.addStub=function(e){var n,c=$(e.KI),l=this.stubSetTable[c]=(n=this.stubSetTable[c])!==null&&n!==void 0?n:{};l[e.KLC]=e,this.emit("stubadded",e)},t.prototype.findMatchingStub=function(e){return this.getStub(e.KI,e.KLC)},t.prototype.getStub=function(e,n){var c,l,r=n||"---";e instanceof q?l=e.id:l=e,l&&(l=$(l));var s=(c=this.stubSetTable[l])!==null&&c!==void 0?c:{};if(r!="---")return s[r];var o=Object.keys(s);return o.length==0?null:s[o[0]]},t.prototype.forgetKeyboard=function(e,n){n===void 0&&(n=!1);var c=e instanceof q?e.id:$(e);this.stubSetTable[c]&&delete this.stubSetTable[c],n&&this.keyboardTable[c]&&delete this.keyboardTable[c]},t.prototype.getStubList=function(){for(var e=[],n=Object.keys(this.stubSetTable),c=0,l=n;c<l.length;c++)for(var r=l[c],s=this.stubSetTable[r],o=Object.keys(s),a=0,B=o;a<B.length;a++){var g=B[a];e.push(s[g])}return e},t}(Dc.default),mn=Vr;var Xn=["World","Africa","Asia","Europe","South America","North America","Oceania","Central America","Middle East"],Vn=["un","af","as","eu","sa","na","oc","ca","me"],Zr=RegExp("^(([\\.]/)|([\\.][\\.]/)|(/))|(:)");function zc(i,t){return t=t||"",i&&!Zr.test(i)?t+i:i}var vr=function(i){(0,d.__extends)(t,i);function t(e,n,c){var l=this;if(typeof e!="string")if(e.id!==void 0){var r=e;r.id=$(r.id),l=i.call(this,r,c)||this,l.KF=zc(r.filename,n),l.mapRegion(r.languages)}else{var s=e;s.KI=$(s.KI),l=i.call(this,s,c)||this,l.KF=zc(s.KF,n),l.KP=s.KP,l.KR=s.KR,l.KRC=s.KRC;return}else l=i.call(this,$(e),n)||this;return l}return t.prototype.mapRegion=function(e){var n=e.region,c=0;if(typeof n=="number")n<1||n>9?c=0:c=n-1;else if(typeof n=="string"){for(var l=n.length==2?Vn:Xn,r=0;r<l.length;r++)if(n.toLowerCase()==l[r].toLowerCase()){c=r;break}}this.KR=Xn[c],this.KRC=Vn[c]},Object.defineProperty(t.prototype,"region",{get:function(){return this.KR},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"regionCode",{get:function(){return this.KRC},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filename",{get:function(){return this.KF},enumerable:!1,configurable:!0}),t.toStubs=function(e,n,c){var l="";if(typeof e.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),e.languages||(e.languages=e.language),e?e.id?e.languages||(l="KeyboardStub has undefined languages"):l="KeyboardStub has undefined id":l="Stub undefined",l!="")return[{error:new Error(l)}];var r=[];Array.isArray(e.languages)?r=r.concat(e.languages):r.push(e.languages);var s=[];return r.forEach(function(o){var a=(0,d.__assign)((0,d.__assign)({},e),{languages:o,language:void 0}),B=new t(a,n,c);s.push(B)}),s},t.prototype.merge=function(e){this.KL||(this.KL=e.KL),this.KR||(this.KR=e.KR),this.KRC||(this.KRC=e.KRC),this.KN||(this.KN=e.KN),this.KF||(this.KF=e.KF),this.KFont||(this.KFont=e.KFont),this.KOskFont||(this.KOskFont=e.KOskFont),e._displayName&&(this._displayName||(this._displayName=e._displayName))},t.prototype.validateForCustomKeyboard=function(){return i.prototype.validateForCustomKeyboard.call(this)||!this.KF||!this.KR?new Error("To use a custom keyboard, you must specify file name, keyboard id, keyboard name, language, language code, and region."):null},t}(Ke),ge=vr;function It(i,t){if(t.length==0)return Promise.resolve(i);if(i.length==0)return Promise.reject(t);var e=i;return Promise.resolve(e.concat(t))}var Kc=R(H(),1);var _c="The Cloud API request timed out.",Zn="Could not find a keyboard with that ID.",Pc="The Cloud API failed to find an appropriate keyboard.",fr="Error occurred while registering keyboards: ",Lr=function(i){return i+" keyboard not found."},Jr=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this)||this;return c.cloudResolutionPromises={},c.languageFetchStarted=!1,c.registerFromCloud=function(l){var r=l.timerid,s;try{s=c._registerCore(l)}catch(a){s=new Error(fr+a)}if(r){var o=c.cloudResolutionPromises[r];if(o)try{s instanceof Error?o.reject(s):o.resolve(s)}finally{delete c.cloudResolutionPromises[r]}else{c.emit("unboundregister",s);return}}else{c.emit("unboundregister",s);return}},c.requestEngine=e,c.pathConfig=n,c._languageListPromise=new J,c}return Object.defineProperty(t.prototype,"languageListPromise",{get:function(){var e=this;return this.languageFetchStarted||(this.languageFetchStarted=!0,this.keymanCloudRequest("",!0).catch(function(n){e.languageFetchStarted=!1,e._languageListPromise.reject(n),e._languageListPromise=new J})),this._languageListPromise.corePromise},enumerable:!1,configurable:!0}),t.prototype.keymanCloudRequest=function(e,n){var c=this,l="https://api.keyman.com/cloud/4.0/"+(arguments.length>1&&n?"languages":"keyboards"),r="?jsonp=keyman.register&languageidtype=bcp47&version="+ne.CURRENT.toString(),s=l+r+e,o=this.requestEngine.request(s),a=o.promise,B=o.queryId;return this.cloudResolutionPromises[B]=a,a.finally(function(){delete c.cloudResolutionPromises[B]}),a.corePromise},t.prototype._registerCore=function(e){var n=e.options,c=n.fontBaseUri;if(this.pathConfig.fonts!=""?c=this.pathConfig.fonts:this.pathConfig.updateFontPath(c),typeof e.error=="string"){var l="";if(typeof e.options.keyboardid=="string"){var r=e.options.keyboardid;l=r.substring(0,1).toUpperCase()+r.substring(1)}return new Error(Lr(l))}if(typeof n=="undefined"||typeof n.context=="undefined")return new Error(Zn);var s=[];if(n.context=="keyboard"){var o=void 0,a=e.keyboard;if(Array.isArray(a))for(o=0;o<a.length;o++)s=s.concat(t.registerLanguagesForKeyboard(a[o],n,o));else s=s.concat(t.registerLanguagesForKeyboard(a,n,0))}else if(n.context=="language"){var B=e.languages;return this._languageListPromise.resolve(B),B}return s},t.registerLanguagesForKeyboard=function(e,n,c){var l="";if(typeof e=="undefined")return[];if(typeof n.keyboardid=="string"&&(l=n.keyboardid.split(",")[c]),Array.isArray(e))if(e.length==1||l.substr(-1,1)=="$"||l==""){for(var r=[],s=0;s<e.length;s++)r=r.concat(this.registerLanguagesForKeyboard(e[s],n,c));return r}else{for(var o=0,s=0;s<e.length;s++){var a=e[s].id.toLowerCase();if(a=="us"&&(a="english"),Array.isArray(e[s].languages)){for(var B=e[s].languages,g=0;g<B.length;g++)if(a==B[g].name.toLowerCase()){o=s;break}}}return this.registerLanguagesForKeyboard(e[o],n,c)}else{var F=n.fontBaseUri||"",u=ge.toStubs(e,n.keyboardBaseUri,F),I=l.split("@")[1];if(u.length==1&&typeof u[0].error!="undefined")throw u[0].error;return typeof I!="string"?u:(I=I.replace(/\$$/,""),[u.find(function(y){return y.KLC==I})])}},t.prototype.fetchCloudStubs=function(e){return(0,d.__awaiter)(this,void 0,void 0,function(){var n,c,l,r,s,o,a;return(0,d.__generator)(this,function(B){switch(B.label){case 0:if(e.length==0)return[2,Promise.resolve([])];for(n="&keyboardid=",c="",l=0;l<e.length;l++)n=n+c+e[l].toString(),c=",";r=[],B.label=1;case 1:return B.trys.push([1,3,,4]),[4,this.keymanCloudRequest(n,!1)];case 2:return s=B.sent(),[2,It(s,r)];case 3:return o=B.sent(),console.error(o),a={error:o},r.push(a),[2,Promise.reject(r)];case 4:return[2]}})})},t}(Kc.default),vn=Jr;var Sr=function(){function i(t,e){this.id=t,this.language=e}return i.prototype.toString=function(){var t=this.id;return this.language?(t=t+"@"+this.language,this.version&&(t=t+"@"+this.version)):this.version&&(t=t+"@@"+this.version),t},i}();function fn(i,t){return{keyboard:{id:i.id,name:i.name},error:typeof t=="string"?new Error(t):t}}function jc(i,t,e){var n=new Sr(i,t);return e&&(n.version=e),n}function qc(i,t,e){if(i.getStub(e.id,e.language)==null){for(var n=0;n<t.length;n++)if(t[n].id==e.id&&t[n].language==e.language)return!1;return!0}else return!1}var Rr=function(){function i(t,e,n){var c=this;this.pathConfig=n,this.cache=new mn(t),this.cloudQueryEngine=new vn(e,this.pathConfig),this.cloudQueryEngine.on("unboundregister",function(l){Array.isArray(l)&&l.forEach(function(r){c.cache.addStub(r)})})}return i.prototype.addKeyboardArray=function(t){for(var e=this,n=[],c=[],l=[],r=[],s=[],o=0,a=t;o<a.length;o++){var B=a[o];if(typeof B=="string"&&B.length>0)r.push(B);else if(B.KI||B.KL||B.KLC||B.KFont||B.KOskFont)l.push(new ge(B));else{var g=B;if(typeof g.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),g.languages||(g.languages=g.language),typeof g.languages=="undefined"){var F="To use keyboard '"+g.id+"', you must specify languages.";s.push(fn(g,F))}else if(Array.isArray(g.languages))for(var u=ge.toStubs(g,this.pathConfig.keyboards,this.pathConfig.fonts),I=0,y=u;I<y.length;I++){var Q=y[I];Q instanceof ge?l.push(Q):s.push(Q)}else{var h=g;l.push(new ge(h,this.pathConfig.keyboards,this.pathConfig.fonts))}}}for(var C=0,b=l;C<b.length;C++){var Q=b[C];if(Q.KF){var x=Q.validateForCustomKeyboard();x?s.push(fn(Q,x)):n.push(Q)}else c.push(Q)}for(var G=[],X=0,m=c;X<m.length;X++){var p=m[X];if(!p.KI&&!p.KLC){s.push(fn(p,"Cannot fetch keyboard information without a keyboard ID or language code."));continue}var Z=jc(pe(p.id),p.langId);qc(this.cache,G,Z)&&G.push(Z)}for(var W=0,A=r;W<A.length;W++){var k=A[W],S=k.split("@"),L=[""];S[0].toLowerCase()=="english"&&(S[0]="us"),S.length>1&&(L=S[1].split(","));for(var f=0;f<L.length;f++)if(!(f>0&&L[f]=="")){var Z=jc(S[0],L[f],S[2]);qc(this.cache,G,Z)&&G.push(Z)}}n.forEach(function(Y){return e.cache.addStub(Y)});var E=this.cloudQueryEngine.fetchCloudStubs(G.map(function(Y){return Y.toString()}));return E.then(function(Y){for(var N=0,Ne=Y;N<Ne.length;N++){var Ue=Ne[N];Ue instanceof ge?(e.cache.addStub(Ue),n.push(Ue)):s.push(Ue)}return[].concat(s).concat(n)})},i.prototype.addLanguageKeyboards=function(t){return(0,d.__awaiter)(this,void 0,void 0,function(){var e,n,c,l,r,s,o,a,B,g,F,u=this;return(0,d.__generator)(this,function(I){switch(I.label){case 0:e=[],n=[],I.label=1;case 1:return I.trys.push([1,3,,4]),[4,this.cloudQueryEngine.languageListPromise];case 2:return n=I.sent(),[3,4];case 3:return c=I.sent(),console.error(c),e.push({error:c}),[2,e];case 4:for(l=n,r="",s=0;s<t.length;s++){for(o=t[s].toLowerCase(),a=o.substr(-1,1)=="$",a&&(o=o.substr(0,o.length-1)),B=!1,g=0;g<l.length;g++)if(o==l[g].name.toLowerCase()){r!=""&&(r=r+","),r=r+"@"+l[g].id,a&&(r=r+"$"),B=!0;break}B||(F={language:{name:o},error:new Error(this.alertLanguageUnavailable(o))},e.push(F))}return r==""?[2,Promise.reject(e)]:[2,this.cloudQueryEngine.keymanCloudRequest("&keyboardid="+r,!1).then(function(y){return(0,d.__awaiter)(u,void 0,void 0,function(){var Q,h,C,b;return(0,d.__generator)(this,function(x){switch(x.label){case 0:return[4,It(y,e)];case 1:for(Q=x.sent(),h=0,C=Q;h<C.length;h++)b=C[h],typeof b.error=="undefined"&&this.cache.addStub(b);return[2,Q]}})})},function(y){console.error(y);var Q={error:y};return e.push(Q),Promise.reject(e)})]}})})},i.prototype.fetchCloudCatalog=function(){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,e,n=this;return(0,d.__generator)(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.cloudQueryEngine.keymanCloudRequest("",!1)];case 1:return t=c.sent(),t.forEach(function(l){return n.cache.addStub(l)}),[2,t];case 2:return e=c.sent(),[2,Promise.reject([{error:e}])];case 3:return[2]}})})},i.prototype.alertLanguageUnavailable=function(t){var e="No keyboards are available for "+t+". Does it have another language name?";return e},i}(),Ln=Rr;var Ar=function(){function i(){this.registeredModels={},this.languageModelMap={}}return i.prototype.modelForLanguage=function(t){return this.languageModelMap[t]},i.prototype.register=function(t){if(t.id=t.id.toLowerCase(),JSON.stringify(t)!=JSON.stringify(this.registeredModels[t.id])){this.registeredModels[t.id]=t;var e=this;t.languages.forEach(function(n){if(!n){console.warn("Null / undefined language codes are not permitted for registration.");return}e.languageModelMap[n]=t})}},i.prototype.unregister=function(t){var e;if(t=t.toLowerCase(),this.registeredModels[t])e=this.registeredModels[t],delete this.registeredModels[t];else return;var n=this;return e.languages.forEach(function(c){n.languageModelMap[c].id==t&&delete n.languageModelMap[c]}),e},i.prototype.isRegistered=function(t){return!!this.registeredModels[t.id.toLowerCase()]},i}(),Jn=Ar;function Wt(i){for(var t=[],e=0;e<i.length;e++)t.push(i[e]);return t}function T(i){var t=document.createElement(i);return t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.MozUserSelect="none",t}var Ce=function(){function i(t,e){if(this.fontStyleDefinitions={},this.linkedSheets=[],!t){var n=document.getElementsByTagName("HEAD");n.length>0?t=n[0]:t=document.body}this.linkNode=t,this.doCacheBusting=e||!1}return i.prototype.linkStylesheet=function(t){this.linkedSheets.push(t),this.linkNode.appendChild(t)},i.prototype.allLoadedPromise=function(){var t;return(0,d.__awaiter)(this,void 0,void 0,function(){var e,n,c,l,r;return(0,d.__generator)(this,function(s){switch(s.label){case 0:for(e=[],n=function(o){if(!((t=o.sheet)===null||t===void 0)&&t.cssRules)e.push(Promise.resolve());else{var a=new J;o.addEventListener("load",function(){return a.resolve()}),e.push(a.corePromise)}},c=0,l=this.linkedSheets;c<l.length;c++)r=l[c],n(r);return[4,Promise.all(e)];case 1:return s.sent(),[2]}})})},i.prototype.addStyleSheetForFont=function(t,e,n){if(!!t&&typeof t.files!="undefined"){var c=t.family,l,r="",s="",o="",a="",B=[];n||(n=V.OperatingSystem.Other);var g=this.fontStyleDefinitions[n]=this.fontStyleDefinitions[n]||{};if(g[c]){var F=g[c];F.parentNode||this.linkStylesheet(F);return}for(typeof t.files=="string"?B[0]=t.files:B=t.files,l=0;l<B.length;l++)B[l].toLowerCase().indexOf(".otf")>0&&(r=B[l]),B[l].toLowerCase().indexOf(".ttf")>0&&(r=B[l]),B[l].toLowerCase().indexOf(".woff")>0&&(s=B[l]),B[l].toLowerCase().indexOf(".eot")>0&&(o=B[l]),B[l].toLowerCase().indexOf(".svg")>0&&(a=B[l]);r!=""&&r.indexOf("/")<0&&(r=e+r),s!=""&&s.indexOf("/")<0&&(s=e+s),o!=""&&o.indexOf("/")<0&&(o=e+o),a!=""&&a.indexOf("/")<0&&(a=e+a);var u="@font-face {\nfont-family:"+t.family+";\nfont-style:normal;\nfont-weight:normal;\n";if(n==V.OperatingSystem.iOS)if(r!="")this.doCacheBusting&&(r=this.cacheBust(r)),u=u+"src:url('"+r+"') format('truetype');";else return null;else{var I=[];if(n==V.OperatingSystem.Android?(a!=""&&I.push("url('"+a+"') format('svg')"),s!=""&&I.push("url('"+s+"') format('woff')"),r!=""&&I.push("url('"+r+"') format('truetype')")):(s!=""&&I.push("url('"+s+"') format('woff')"),r!=""&&I.push("url('"+r+"') format('truetype')"),a!=""&&I.push("url('"+a+"') format('svg')")),I.length==0)return null;u+="src:"+I.join(",")+";"}u=u+"\n}\n";var y=Je(u);return g[c]=y,this.linkStylesheet(y),y}},i.prototype.cacheBust=function(t){return t+"?v="+new Date().getTime()},i.prototype.linkExternalSheet=function(t){try{if(document.querySelector("link[href="+JSON.stringify(t)+"]")!=null)return}catch(n){return}var e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href=t,this.linkStylesheet(e)},i.prototype.unlink=function(t){var e=this.linkedSheets.indexOf(t);return e>-1?(this.linkedSheets.splice(e,1),t.parentNode.removeChild(t),!0):!1},i.prototype.unlinkAll=function(){for(var t=0,e=this.linkedSheets;t<e.length;t++){var n=e[t];n.parentNode&&n.parentNode.removeChild(n)}this.linkedSheets.splice(0,this.linkedSheets.length)},i}();function Je(i){var t=document.createElement("style");return t.type="text/css",t.appendChild(document.createTextNode(i)),t}function ee(){var i;return typeof window.orientation!="undefined"?i=window.orientation:typeof window.screen.orientation!="undefined"&&(i=window.screen.orientation.angle),i!==void 0?Math.abs(i/90)==1:!1}var $c=function(i){return i},Hr=function(){function i(t){this.name=t}return i.prototype.load=function(t){return this.loadCookie(this.name,t||$c)},i.prototype.save=function(t,e){this.saveCookie(this.name,t,e||$c)},i.prototype._loadRawCookies=function(){var t={};if(typeof document.cookie!="undefined"&&document.cookie!="")for(var e=document.cookie.split(/;\s*/),n=0;n<e.length;n++){var c=e[n].split("=");c.length==2&&(t[c[0]]=c[1])}return t},i.prototype.loadCookie=function(t,e){var n={},c=this._loadRawCookies(),l=c[t];if(l)for(var r=decodeURIComponent(l).split(";"),s=0;s<r.length&&!(s==r.length-1&&!r[s]);s++){var o=r[s].split("=");if(o.length>1){var a=o[0],B=o[1];n[a]=e(B,a)}else n[o[0]]=""}return n},i.prototype.saveCookie=function(t,e,n){var c="";for(var l in e)c+=l+"="+n(e[l],l)+";";var r=new Date(new Date().valueOf()+1e3*60*60*24*30).toUTCString(),s=" path=/; expires="+r;document.cookie="".concat(t,"=").concat(encodeURIComponent(c),"; ").concat(s)},i}(),Fe=Hr;function K(i){var t;if(!i)return 0;var e=i.offsetLeft?i.offsetLeft:0;if(t=i,t.offsetParent){for(;t.offsetParent;)t=t.offsetParent,e+=t.offsetLeft;var n=t.ownerDocument;t.style.position=="fixed"&&n&&n.scrollingElement&&(e+=n.scrollingElement.scrollLeft)}if(t&&t.ownerDocument&&i.ownerDocument!=window.document){var c=t.ownerDocument;if(c&&c.defaultView&&c.defaultView.frameElement)return e+K(c.defaultView.frameElement)-c.documentElement.scrollLeft}return e}function _(i){var t;if(!i)return 0;var e=i.offsetTop?i.offsetTop:0;if(t=i,t.ownerDocument&&t instanceof t.ownerDocument.defaultView.HTMLElement){for(;t.offsetParent;)t=t.offsetParent,e+=t.offsetTop;var n=t.ownerDocument;t.style.position=="fixed"&&n&&n.scrollingElement&&(e+=n.scrollingElement.scrollTop)}if(t&&t.ownerDocument&&i.ownerDocument!=window.document){var c=t.ownerDocument;if(c&&c.defaultView&&c.defaultView.frameElement)return e+_(c.defaultView.frameElement)}return e}var ei=function(i){(0,d.__extends)(t,i);function t(e,n){return i.call(this,"KeymanWeb_".concat(e,"_Option_").concat(n))||this}return t.prototype.load=function(){return i.prototype.load.call(this,decodeURIComponent)},t.prototype.save=function(e){i.prototype.save.call(this,e,encodeURIComponent)},t}(Fe),Sn=function(){function i(){}return i.prototype.loadStore=function(t,e){var n=new ei(t,e);return n.load()},i.prototype.saveStore=function(t,e,n){var c=new ei(t,e);c.save(n)},i}();var ti=function(i){(0,d.__extends)(t,i);function t(e,n,c){var l=i.call(this,e,n,new Sn)||this;return l.insertText=function(r,s){l.resetContextCache(),l.engine.contextManager.insertText(l,r,s)},l.KT=l.insertText,l.engine=n,l.stubNamespacer=c,l}return t.prototype.preserveID=function(e){var n;if(document.currentScript)n=document.currentScript.id;else{var c=document.getElementsByTagName("script"),l=c[c.length-1];n=l.id}if(n)n.indexOf(pe(e.KI))!=-1?e.KI=n:console.error("Error when registering keyboard:  current SCRIPT tag's ID does not match!");else return},t.prototype.registerKeyboard=function(e){var n=this;i.prototype.registerKeyboard.call(this,e);var c=this.loadedKeyboard;this.preserveID(e),this.engine.config.deferForInitialization.then(function(){n.engine.keyboardRequisitioner.cache.isFetchingKeyboard(c.id)||(n.engine.keyboardRequisitioner.cache.addKeyboard(c),n.loadedKeyboard=null)})},t.prototype.registerStub=function(e){var n=this,c;this.stubNamespacer&&this.stubNamespacer(e);var l=function(){var s=n.engine.config.paths;return new ge(e,s.keyboards,s.fonts)};if(!this.engine.config.deferForInitialization.isResolved)this.engine.config.deferForInitialization.then(function(){return n.engine.keyboardRequisitioner.cache.addStub(l())});else{var r=l();if(!((c=this.engine.keyboardRequisitioner)===null||c===void 0)&&c.cache.findMatchingStub(r))return 1;this.engine.keyboardRequisitioner.cache.addStub(r)}return null},t}(yt),Rn=ti;(function(){ti.__publishShorthandAPI()})();var ni=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this;return e&&e._jsGlobal!=window&&(e._jsGlobal.String=window.String),e?c=i.call(this,e)||this:c=i.call(this,new Ft(window,gt))||this,c.performCacheBusting=n||!1,c}return t.prototype.loadKeyboardInternal=function(e,n,c){var l=this,r=new J;this.performCacheBusting&&(e=this.cacheBust(e));try{var s=this.harness._jsGlobal.document,o=s.createElement("script");c&&(o.id=c),s.head.appendChild(o),o.onerror=function(a){r.reject(n.missingError(a))},o.onload=function(){if(l.harness.loadedKeyboard){var a=l.harness.loadedKeyboard;l.harness.loadedKeyboard=null,r.resolve(a)}else r.reject(n.scriptError())},r.then(function(){o.remove()}).catch(function(){o.remove()}),o.src=e}catch(a){return Promise.reject(a)}return r.corePromise},t.prototype.cacheBust=function(e){return e+"?v="+new Date().getTime()},t}(gn);function Nt(i,t){var e=new Map;return t.keys.forEach(function(n){var c=Math.abs(i.x-n.centerX),l=Math.abs(i.y-n.centerY),r,s;c>.5*n.width?(r=c-.5*n.width,c=.5):(r=0,c/=n.width),l>.5*n.height?(s=l-.5*n.height,l=.5):(s=0,l/=n.height),r*=t.kbdScaleRatio,r+=c*n.height,s+=l*n.height;var o=r*r+s*s;e.set(n.keySpec,o)}),e}function Se(i){var t,e,n,c,l,r,s,o=new Map,a=0;Array.isArray(i)||(i=[i]);try{for(var B=(0,d.__values)(i),g=B.next();!g.done;g=B.next()){var F=g.value;try{for(var u=(n=void 0,(0,d.__values)(F.keys())),I=u.next();!I.done;I=u.next()){var y=I.value,Q=1/(Math.pow(F.get(y),2)+1e-6);a+=Q,o.set(y,(s=o.get(y))!==null&&s!==void 0?s:0+Q)}}catch(x){n={error:x}}finally{try{I&&!I.done&&(c=u.return)&&c.call(u)}finally{if(n)throw n.error}}}}catch(x){t={error:x}}finally{try{g&&!g.done&&(e=B.return)&&e.call(B)}finally{if(t)throw t.error}}var h=[];try{for(var C=(0,d.__values)(o.keys()),b=C.next();!b.done;b=C.next()){var y=b.value;h.push({keySpec:y,p:o.get(y)/a})}}catch(x){l={error:x}}finally{try{b&&!b.done&&(r=C.return)&&r.call(C)}finally{if(l)throw l.error}}return h.sort(function(x,G){return G.p-x.p})}var Wr=function(){function i(t,e,n){this.keySpec=n,this.centerX=n.proportionalX,this.centerY=e.proportionalY,this.width=n.proportionalWidth,this.height=t.rowProportionalHeight}return i}();function Nr(i){return i.baseKeyID?U.isKnownOSKModifierKey(i.baseKeyID)?!1:!i.isPadding:!1}function ci(i,t){return{keys:i.row.map(function(e){return e.key.map(function(n){return new Wr(i,e,n)})}).reduce(function(e,n){return e.concat(n)},[]).filter(function(e){return Nr(e.keySpec)}),kbdScaleRatio:t}}var Tr=function(){function i(t,e,n){this.left=t.getTextBeforeCaret(),this.startOfBuffer=this.left._kmwLength()<=e.leftContextCodePoints,this.startOfBuffer||(this.left=this.left._kmwSubstr(-e.leftContextCodePoints)),this.right=t.getTextAfterCaret(),this.endOfBuffer=this.right._kmwLength()<=e.rightContextCodePoints,this.endOfBuffer||(this.right=this.right._kmwSubstr(0,e.rightContextCodePoints)),this.casingForm=n=="shift"?"initial":n=="caps"?"upper":null}return i.prototype.toMock=function(){var t=this.left._kmwLength();return new D(this.left+(this.right||""),t)},i.ENGINE_RULE_WINDOW={leftContextCodePoints:64,rightContextCodePoints:32},i}(),Ge=Tr;var si=R(H(),1);var Er=function(){function i(){this._promises=new Map}return Object.defineProperty(i.prototype,"length",{get:function(){return this._promises.size},enumerable:!1,configurable:!0}),i.prototype.make=function(t,e,n){if(this._promises.has(t))return n("Existing request with token ".concat(t));this._promises.set(t,{reject:n,resolve:e})},i.prototype.keep=function(t,e){var n=this._promises.get(t);if(!n)throw new Error("No promise associated with token: ".concat(t));var c=n.resolve;return this._promises.delete(t),c(e)},i.prototype.break=function(t,e){var n=this._promises.get(t);if(!n)throw new Error("No promise associated with token: ".concat(t));this._promises.delete(t),n.reject(e)},i}(),Qt=Er;var kr=function(){function i(t,e,n){this._worker=e,this._worker.onmessage=this.onMessage.bind(this),this._declareLMLayerReady=null,this._predictPromises=new Qt,this._wordbreakPromises=new Qt,this._acceptPromises=new Qt,this._revertPromises=new Qt,this._nextToken=Number.MIN_SAFE_INTEGER,this.sendConfig(t,!!n)}return i.prototype.sendConfig=function(t,e){this._worker.postMessage({message:"config",capabilities:t,testMode:e})},i.prototype.loadModel=function(t,e){var n=this;return e===void 0&&(e="file"),new Promise(function(c,l){n._declareLMLayerReady=c;var r={type:e};e=="file"?r.file=t:r.code=t,n._worker.postMessage({message:"load",source:r})})},i.prototype.unloadModel=function(){this._worker.postMessage({message:"unload"})},i.prototype.predict=function(t,e){var n=this,c=this._nextToken++;return new Promise(function(l,r){n._predictPromises.make(c,l,r),n._worker.postMessage({message:"predict",token:c,transform:t,context:e})})},i.prototype.wordbreak=function(t){var e=this,n=this._nextToken++;return new Promise(function(c,l){e._wordbreakPromises.make(n,c,l),e._worker.postMessage({message:"wordbreak",token:n,context:t})})},i.prototype.acceptSuggestion=function(t,e,n){var c=this,l=this._nextToken++;return new Promise(function(r,s){c._acceptPromises.make(l,r,s),c._worker.postMessage({message:"accept",token:l,suggestion:t,context:e,postTransform:n})})},i.prototype.revertSuggestion=function(t,e){var n=this,c=this._nextToken++;return new Promise(function(l,r){n._revertPromises.make(c,l,r),n._worker.postMessage({message:"revert",token:c,reversion:t,context:e})})},i.prototype.resetContext=function(t){this._worker.postMessage({message:"reset-context",context:t})},i.prototype.onMessage=function(t){var e=t.data;if(e.message==="error")console.error(e.log),e.error&&console.error(e.error);else if(e.message==="ready")this._declareLMLayerReady(t.data.configuration);else if(e.message==="suggestions")this._predictPromises.keep(e.token,e.suggestions);else if(e.message==="currentword")this._wordbreakPromises.keep(e.token,e.word);else if(e.message==="postaccept")this._acceptPromises.keep(e.token,e.reversion);else if(e.message==="postrevert")this._revertPromises.keep(e.token,e.suggestions);else throw new Error("Message not implemented: ".concat(e.message))},i.prototype.shutdown=function(){this._worker.terminate()},i}(),An=kr;function Tt(i){return i}var ii='"use strict";/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){"use strict";var L=function(){try{var P={},q=Object.defineProperty,A=q(P,P,P)&&q}catch(N){}return A}(),k=function(P){if(this==null)throw TypeError();var q=String(this),A=q.length,N=P?Number(P):0;if(N!=N&&(N=0),!(N<0||N>=A)){var F=q.charCodeAt(N),R;return F>=55296&&F<=56319&&A>N+1&&(R=q.charCodeAt(N+1),R>=56320&&R<=57343)?(F-55296)*1024+R-56320+65536:F}};L?L(String.prototype,"codePointAt",{value:k,configurable:!0,writable:!0}):String.prototype.codePointAt=k}(),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(L){if(this==null)throw new TypeError("this is null or not defined");for(var k=Object(this),P=k.length>>>0,q=arguments[1],A=q>>0,N=A<0?Math.max(P+A,0):Math.min(A,P),F=arguments[2],R=F===void 0?P:F>>0,J=R<0?Math.max(P+R,0):Math.min(R,P);N<J;)k[N]=L,N++;return k}});/**\n* Array.prototype.findIndex() polyfill\n* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex\n* @license MIT\n*/Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(L){if(this==null)throw new TypeError(\'"this" is null or not defined\');var k=Object(this),P=k.length>>>0;if(typeof L!="function")throw new TypeError("predicate must be a function");for(var q=arguments[1],A=0;A<P;){var N=k[A];if(L.call(q,N,A,k))return A;A++}return-1},configurable:!0,writable:!0}),Array.prototype.includes||(Array.prototype.includes=function(L){return!!~this.indexOf(L)}),Object.keys||(Object.keys=function(){"use strict";var L=Object.prototype.hasOwnProperty,k=!{toString:null}.propertyIsEnumerable("toString"),P=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],q=P.length;return function(A){if(typeof A!="function"&&(typeof A!="object"||A===null))throw new TypeError("Object.keys called on non-object");var N=[],F,R;for(F in A)L.call(A,F)&&N.push(F);if(k)for(R=0;R<q;R++)L.call(A,P[R])&&N.push(P[R]);return N}}());var reduce=Function.bind.call(Function.call,Array.prototype.reduce),isEnumerable=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),concat=Function.bind.call(Function.call,Array.prototype.concat),keys=Object.keys;Object.values||(Object.values=function(k){return reduce(keys(k),function(P,q){return concat(P,typeof q=="string"&&isEnumerable(k,q)?[k[q]]:[])},[])}),Object.entries||(Object.entries=function(k){return reduce(keys(k),function(P,q){return concat(P,typeof q=="string"&&isEnumerable(k,q)?[[q,k[q]]]:[])},[])}),self.Symbol||function(L,k){"use strict";typeof module=="object"&&typeof module.exports=="object"?module.exports=k(L):k(L)}(typeof window!="undefined"?window:self||global,function(L){"use strict";var k=Object.defineProperty,P=Object.defineProperties,q=0,A=[],N=Array.prototype.slice,F=typeof L.ES6=="object"?L.ES6:L.ES6={},R=Array.isArray,J=Object.prototype.toString,Oe=Array.prototype.push,me=function(){},we=function(h){return h},T=function(h){return typeof h=="function"},he=function(){},B=function(h,g){this._array=h,this._flag=g,this._nextIndex=0},G=function(h,g){this._string=h,this._flag=g,this._nextIndex=0},Q=function(h){return h!==null&&(typeof h=="object"||typeof h=="function")},H=function(h,g){return P(h,{_description:{value:g},_isSymbol:{value:!0},_id:{value:q++}}),h},le=function(h,g){if(typeof h.length=="number"&&h.length>=0&&typeof g.length=="number"&&g.length>=0){var E=Math.floor(h.length),b=Math.floor(g.length),D=0;for(h.length=E+b;D<b;++D)g.hasOwnProperty(D)&&(h[E+D]=g[D])}},$=function(h,g){if(typeof h!="function"||typeof g!="function")throw new TypeError("Child and Parent must be function type");h.prototype=Object.create(g.prototype),h.prototype.constructor=h},M=function h(g){if(g=g===void 0?"":String(g),this instanceof h)throw new TypeError("Symbol is not a constructor");return H(Object.create(h.prototype),g)};P(M,{for:{value:function(h){h=String(h);for(var g,E=A.length,b=0;b<E;++b)if((g=A[b]).key===h)return g.symbol;return g={key:h,symbol:M(h)},A.push(g),g.symbol},writable:!0,configurable:!0},keyFor:{value:function(h){if(!F.isSymbol(h))throw new TypeError(String(h)+" is not a symbol");for(var g,E=A.length,b=0;b<E;++b)if((g=A[b]).symbol===h)return g.key},writable:!0,configurable:!0},hasInstance:{value:M("Symbol.hasInstance")},isConcatSpreadable:{value:M("Symbol.isConcatSpreadable")},iterator:{value:M("Symbol.iterator")},toStringTag:{value:M("Symbol.toStringTag")}}),M.prototype.toString=function(){return"@@_____"+this._id+"_____"},M.prototype.valueOf=function(){return this},k(he.prototype,M.iterator.toString(),{value:function(){return this},writable:!0,configurable:!0}),$(B,he),$(G,he),k(B.prototype,M.toStringTag.toString(),{value:"Array Iterator",configurable:!0}),k(G.prototype,M.toStringTag.toString(),{value:"String Iterator",configurable:!0}),B.prototype.next=function(){if(!(this instanceof B))throw new TypeError("Method Array Iterator.prototype.next called on incompatible receiver "+String(this));var h;return this._nextIndex===-1?{done:!0,value:void 0}:typeof this._array.length=="number"&&this._array.length>=0&&this._nextIndex<Math.floor(this._array.length)?(this._flag===1?h=[this._nextIndex,this._array[this._nextIndex]]:this._flag===2?h=this._array[this._nextIndex]:this._flag===3&&(h=this._nextIndex),this._nextIndex++,{done:!1,value:h}):(this._nextIndex=-1,{done:!0,value:void 0})},G.prototype.next=function(){if(!(this instanceof G))throw new TypeError("Method String Iterator.prototype.next called on incompatible receiver "+String(this));var h,g=new String(this._string);return this._nextIndex===-1?{done:!0,value:void 0}:this._nextIndex<g.length?(h=g[this._nextIndex],this._nextIndex++,{done:!1,value:h}):(this._nextIndex=-1,{done:!0,value:void 0})};var X=function(h,g){this._target=h,this._values=[],this._thisArg=g};return X.prototype.spread=function(){var h=this;return N.call(arguments).forEach(function(g){F.forOf(g,function(E){h._values.push(E)})}),h},X.prototype.add=function(){var h=this;return N.call(arguments).forEach(function(g){h._values.push(g)}),h},X.prototype.call=function(h){if(typeof this._target!="function")throw new TypeError("Target is not a function");return h=arguments.length<=0?this._thisArg:h,this._target.apply(h,this._values)},X.prototype.new=function(){if(typeof this._target!="function")throw new TypeError("Target is not a constructor");var h,g;return h=Object.create(this._target.prototype),g=this._target.apply(h,this._values),Q(g)?g:h},X.prototype.array=function(){if(!R(this._target))throw new TypeError("Target is not a array");return Oe.apply(this._target,this._values),this._target},P(F,{isSymbol:{value:function(h){return h instanceof M&&function(g){return g._isSymbol===!0&&typeof g._id=="number"&&typeof g._description=="string"}(h)},writable:!0,configurable:!0},instanceOf:{value:function(h,g){if(!Q(g))throw new TypeError("Right-hand side of \'instanceof\' is not an object");var E=g[M.hasInstance];if(E===void 0)return h instanceof g;if(typeof E!="function")throw new TypeError(typeof E+" is not a function");return E.call(g,h)},writable:!0,configurable:!0},forOf:{value:function(h,g,E){if(g=typeof g!="function"?me:g,typeof h[M.iterator]!="function")throw new TypeError("Iterable[Symbol.iterator] is not a function");var b,D=h[M.iterator]();if(typeof D.next!="function")throw new TypeError(".iterator.next is not a function");for(;;){if(b=D.next(),!Q(b))throw new TypeError("Iterator result "+b+" is not an object");if(b.done)break;g.call(E,b.value)}},writable:!0,configurable:!0},spreadOperator:{value:function(h,g){if(typeof h!="function"&&!R(h))throw new TypeError("Spread operator only supports on array and function objects at this moment");return new X(h,g)},writable:!0,configurable:!0}}),k(L,"Symbol",{value:M,writable:!0,configurable:!0}),k(Function.prototype,M.hasInstance.toString(),{value:function(h){return typeof this=="function"&&h instanceof this}}),k(Array.prototype,"concat",{value:function(){if(this===void 0||this===null)throw new TypeError("Array.prototype.concat called on null or undefined");var h=Object(this),g=N.call(arguments),E=[];return g.unshift(h),g.forEach(function(b){Q(b)?b[M.isConcatSpreadable]!==void 0?b[M.isConcatSpreadable]?le(E,b):E.push(b):R(b)?le(E,b):E.push(b):E.push(b)}),E},writable:!0,configurable:!0}),k(Object.prototype,"toString",{value:function(){return this===void 0||this===null?J.call(this):typeof this[M.toStringTag]=="string"?"[object "+this[M.toStringTag]+"]":J.call(this)},writable:!0,configurable:!0}),k(Array.prototype,M.iterator.toString(),{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var h=Object(this);return new B(h,2)},writable:!0,configurable:!0}),k(Array,"from",{value:function(h,g,E){var b,D,U,z=0;if(b=T(this)?this:Array,h==null)throw new TypeError("Cannot convert undefined or null to object");if(h=Object(h),g===void 0)g=we;else if(!T(g))throw new TypeError(g+" is not a function");if(h[M.iterator]===void 0){if(!(typeof h.length=="number"&&h.length>=0))return(U=new b(0)).length=0,U;for(D=Math.floor(h.length),(U=new b(D)).length=D;z<D;++z)U[z]=g.call(E,h[z])}else(U=new b).length=0,F.forOf(h,function(pe){U.length++,U[U.length-1]=g.call(E,pe)});return U},writable:!0,configurable:!0}),k(Array.prototype,"entries",{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var h=Object(this);return new B(h,1)},writable:!0,configurable:!0}),k(Array.prototype,"keys",{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var h=Object(this);return new B(h,3)},writable:!0,configurable:!0}),k(String.prototype,M.iterator.toString(),{value:function(){if(this===void 0||this===null)throw new TypeError("String.prototype[Symbol.iterator] called on null or undefined");return new G(String(this),0)},writable:!0,configurable:!0}),F}),function(){var L=Object.create,k=Object.defineProperty,P=Object.getOwnPropertyDescriptor,q=Object.getOwnPropertyNames,A=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty,F=function(r,e){return function(){return e||(0,r[q(r)[0]])((e={exports:{}}).exports,e),e.exports}},R=function(r,e){for(var t in e)k(r,t,{get:e[t],enumerable:!0})},J=function(r,e,t,n){if(e&&typeof e=="object"||typeof e=="function")for(var i=q(e),a=0,l=i.length,o;a<l;a++)o=i[a],!N.call(r,o)&&o!==t&&k(r,o,{get:function(s){return e[s]}.bind(null,o),enumerable:!(n=P(e,o))||n.enumerable});return r},Oe=function(r,e,t){return J(r,e,"default"),t&&J(t,e,"default")},me=function(r,e,t){return t=r!=null?L(A(r)):{},J(e||!r||!r.__esModule?k(t,"default",{value:r,enumerable:!0}):t,r)},we=F({"../../../node_modules/tslib/tslib.js":function(r,e){var t,n,i,a,l;(function(o){var s=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(c){o(u(s,u(c)))}):typeof e=="object"&&typeof e.exports=="object"?o(u(s,u(e.exports))):o(u(s));function u(c,f){return c!==s&&(typeof Object.create=="function"?Object.defineProperty(c,"__esModule",{value:!0}):c.__esModule=!0),function(v,p){return c[v]=f?f(v,p):p}}})(function(o){var s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,c){u.__proto__=c}||function(u,c){for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(u[f]=c[f])};t=function(u,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");s(u,c);function f(){this.constructor=u}u.prototype=c===null?Object.create(c):(f.prototype=c.prototype,new f)},n=Object.assign||function(u){for(var c,f=1,v=arguments.length;f<v;f++){c=arguments[f];for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(u[p]=c[p])}return u},i=function(u,c){var f={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},v,p,d,m;return m={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function C(y){return function(S){return x([y,S])}}function x(y){if(v)throw new TypeError("Generator is already executing.");for(;m&&(m=0,y[0]&&(f=0)),f;)try{if(v=1,p&&(d=y[0]&2?p.return:y[0]?p.throw||((d=p.return)&&d.call(p),0):p.next)&&!(d=d.call(p,y[1])).done)return d;switch(p=0,d&&(y=[y[0]&2,d.value]),y[0]){case 0:case 1:d=y;break;case 4:return f.label++,{value:y[1],done:!1};case 5:f.label++,p=y[1],y=[0];continue;case 7:y=f.ops.pop(),f.trys.pop();continue;default:if(d=f.trys,!(d=d.length>0&&d[d.length-1])&&(y[0]===6||y[0]===2)){f=0;continue}if(y[0]===3&&(!d||y[1]>d[0]&&y[1]<d[3])){f.label=y[1];break}if(y[0]===6&&f.label<d[1]){f.label=d[1],d=y;break}if(d&&f.label<d[2]){f.label=d[2],f.ops.push(y);break}d[2]&&f.ops.pop(),f.trys.pop();continue}y=c.call(u,f)}catch(S){y=[6,S],p=0}finally{v=d=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}},a=function(u){var c=typeof Symbol=="function"&&Symbol.iterator,f=c&&u[c],v=0;if(f)return f.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&v>=u.length&&(u=void 0),{value:u&&u[v++],done:!u}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},l=function(u,c){var f=typeof Symbol=="function"&&u[Symbol.iterator];if(!f)return u;var v=f.call(u),p,d=[],m;try{for(;(c===void 0||c-- >0)&&!(p=v.next()).done;)d.push(p.value)}catch(C){m={error:C}}finally{try{p&&!p.done&&(f=v.return)&&f.call(v)}finally{if(m)throw m.error}}return d},o("__extends",t),o("__assign",n),o("__generator",i),o("__values",a),o("__read",l)})}}),T={};R(T,{tslib:function(){return he}}),Oe(T,me(we(),1));var he=me(we(),1);function B(){String.kmwFromCharCode=function(r){var e=[],t;for(t=0;t<arguments.length;t++){var n=Number(arguments[t]);if(!isFinite(n)||n<0||n>1114111||Math.floor(n)!==n)throw new RangeError("Invalid code point "+n);n<65536?e.push(n):(n-=65536,e.push((n>>10)+55296),e.push(n%1024+56320))}return String.fromCharCode.apply(void 0,e)},String.prototype.kmwCharCodeAt=function(r){var e=String(this),t=0;if(r<0||r>=e.length)return NaN;for(var n=0;n<r;n++)if(t=e.kmwNextChar(t),t===null)return NaN;var i=e.charCodeAt(t);if(i>=55296&&i<=56319&&e.length>t+1){var a=e.charCodeAt(t+1);if(a>=56320&&a<=57343)return(i-55296<<10)+(a-56320)+65536}return i},String.prototype.kmwIndexOf=function(r,e){var t=String(this),n=t.indexOf(r,e);if(n<0)return n;for(var i=0,a=0;a!==null&&a<n;a=t.kmwNextChar(a))i++;return i},String.prototype.kmwLastIndexOf=function(r,e){var t=String(this),n=t.lastIndexOf(r,e);if(n<0)return n;for(var i=0,a=0;a!==null&&a<n;a=t.kmwNextChar(a))i++;return i},String.prototype.kmwLength=function(){var r=String(this);if(r.length==0)return 0;for(var e=0,t=0;t!==null;e++)t=r.kmwNextChar(t);return e},String.prototype.kmwSlice=function(r,e){var t=String(this),n=t.kmwCodePointToCodeUnit(r),i=t.kmwCodePointToCodeUnit(e);return n===null||i===null?"":t.slice(n,i)},String.prototype.kmwSubstr=function(r,e){var t=String(this);r<0&&(r=t.kmwLength()+r),r<0&&(r=0);var n=t.kmwCodePointToCodeUnit(r),i=n;if(n===null)return"";if(arguments.length<2)i=t.length;else for(var a=0;a<e;a++)i=t.kmwNextChar(i);return i===null?t.substring(n):t.substring(n,i)},String.prototype.kmwSubstring=function(r,e){var t=String(this),n,i;if(typeof e=="undefined")n=t.kmwCodePointToCodeUnit(r),i=t.length;else{if(r>e){var a=r;r=e,e=a}n=t.kmwCodePointToCodeUnit(r),i=t.kmwCodePointToCodeUnit(e)}return(isNaN(n)||n===null)&&(n=0),(isNaN(i)||i===null)&&(i=t.length),t.substring(n,i)},String.prototype.kmwNextChar=function(r){var e=String(this);if(r===null||r<0||r>=e.length-1)return null;var t=e.charCodeAt(r);if(t>=55296&&t<=56319&&e.length>r+1){var n=e.charCodeAt(r+1);if(n>=56320&&n<=57343)return r==e.length-2?null:r+2}return r+1},String.prototype.kmwPrevChar=function(r){var e=String(this);if(r==null||r<=0||r>e.length)return null;var t=e.charCodeAt(r-1);if(t>=56320&&t<=57343&&r>1){var n=e.charCodeAt(r-2);if(n>=55296&&n<=56319)return r-2}return r-1},String.prototype.kmwCodePointToCodeUnit=function(r){if(r===null)return null;var e=String(this),t=0;if(r<0){t=e.length;for(var n=0;n>r;n--)t=e.kmwPrevChar(t);return t}if(r==e.kmwLength())return e.length;for(var n=0;n<r;n++)t=e.kmwNextChar(t);return t},String.prototype.kmwCodeUnitToCodePoint=function(r){var e=String(this);return r===null?null:r==0?0:r<0?e.substr(r).kmwLength():e.substr(0,r).kmwLength()},String.prototype.kmwCharAt=function(r){var e=String(this);return r>=0?e.kmwSubstr(r,1):""},String.prototype.kmwBMPNextChar=function(r){var e=String(this);return r<0||r>=e.length-1?null:r+1},String.prototype.kmwBMPPrevChar=function(r){var e=String(this);return r<=0||r>e.length?null:r-1},String.prototype.kmwBMPCodePointToCodeUnit=function(r){return r},String.prototype.kmwBMPCodeUnitToCodePoint=function(r){return r},String.prototype.kmwBMPLength=function(){var r=String(this);return r.length},String.prototype.kmwBMPSubstr=function(r,e){var t=String(this);return r>-1?t.substr(r,e):t.substr(t.length+r,-r)},String.kmwEnableSupplementaryPlane=function(r){var e=String.prototype;String._kmwFromCharCode=r?String.kmwFromCharCode:String.fromCharCode,e._kmwCharAt=r?e.kmwCharAt:e.charAt,e._kmwCharCodeAt=r?e.kmwCharCodeAt:e.charCodeAt,e._kmwIndexOf=r?e.kmwIndexOf:e.indexOf,e._kmwLastIndexOf=r?e.kmwLastIndexOf:e.lastIndexOf,e._kmwSlice=r?e.kmwSlice:e.slice,e._kmwSubstring=r?e.kmwSubstring:e.substring,e._kmwSubstr=r?e.kmwSubstr:e.kmwBMPSubstr,e._kmwLength=r?e.kmwLength:e.kmwBMPLength,e._kmwNextChar=r?e.kmwNextChar:e.kmwBMPNextChar,e._kmwPrevChar=r?e.kmwPrevChar:e.kmwBMPPrevChar,e._kmwCodePointToCodeUnit=r?e.kmwCodePointToCodeUnit:e.kmwBMPCodePointToCodeUnit,e._kmwCodeUnitToCodePoint=r?e.kmwCodeUnitToCodePoint:e.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}B();var G={};R(G,{DummyModel:function(){return vt},PriorityQueue:function(){return b},QuoteBehavior:function(){return U},SENTINEL_CODE_UNIT:function(){return Q},TrieModel:function(){return lt},applyTransform:function(){return H},buildMergedTransform:function(){return le},defaultApplyCasing:function(){return g},getLastPreCaretToken:function(){return pe},isHighSurrogate:function(){return $},isLowSurrogate:function(){return M},isSentinel:function(){return X},tokenize:function(){return z},transformToSuggestion:function(){return h},wordbreak:function(){return Ae}}),B();var Q="\\uFDD0";function H(r,e){var t,n,i=e.left||"",a=i.kmwLength(),l=a<r.deleteLeft?a:r.deleteLeft,o=i.kmwSubstr(0,a-l)+(r.insert||""),s=e.right||"",u=s.kmwLength(),c=u<((t=r.deleteRight)!==null&&t!==void 0?t:0)?u:(n=r.deleteRight)!==null&&n!==void 0?n:0,f=s.kmwSubstr(c);return{left:o,right:f,startOfBuffer:e.startOfBuffer,endOfBuffer:e.endOfBuffer,casingForm:e.casingForm}}function le(r,e){var t=r.insert,n=e.deleteLeft;if(e.deleteLeft){var i=r.insert.kmwLength();i<=e.deleteLeft?(t="",n=e.deleteLeft-i):(t=r.insert.kmwSubstr(0,i-e.deleteLeft),n=0)}return{insert:t+e.insert,deleteLeft:r.deleteLeft+n,deleteRight:(r.deleteRight||0)+(e.deleteRight||0)}}function $(r){return typeof r=="string"&&(r=r.charCodeAt(0)),r>=55296&&r<=56319}function M(r){return typeof r=="string"&&(r=r.charCodeAt(0)),r>=56320&&r<=57343}function X(r){return r==Q}function h(r,e){var t={transform:r,transformId:r.id,displayAs:r.insert};return(e===0||e)&&(t.p=e),t}function g(r,e){switch(r){case"lower":return e.toLowerCase();case"upper":return e.toUpperCase();case"initial":var t=1;return e.length>1&&$(e.charAt(0))&&M(e.charCodeAt(1))&&(t=2),e.substring(0,t).toUpperCase().concat(e.substring(t))}}var E=function(){function r(e,t){if(typeof e!="function"){this.comparator=e.comparator,this.heap=[].concat(e.heap);return}var n=e;this.comparator=n,this.heap=(t!=null?t:[]).slice(0),this.heapify()}return r.leftChildIndex=function(e){return e*2+1},r.rightChildIndex=function(e){return e*2+2},r.parentIndex=function(e){return Math.floor((e-1)/2)},r.prototype.heapify=function(e,t){if(e==null||t==null){this.heapify(0,this.count-1);return}for(var n=[],i=-1,a=t;a>=e;a--){var l=r.parentIndex(a);this.siftDown(a)&&l<e&&i!=l&&(n.push(l),i=l)}for(i=-1;n.length>0;){var o=n.shift(),l=r.parentIndex(o);this.siftDown(o)&&l>=0&&i!=l&&(n.push(l),i=l)}},Object.defineProperty(r.prototype,"count",{get:function(){return this.heap.length},enumerable:!1,configurable:!0}),r.prototype.peek=function(){return this.heap[0]},r.prototype.enqueue=function(e){var t=this.heap.length;this.heap.push(e);for(var n=r.parentIndex,i=n(t);t!==0&&this.comparator(this.heap[t],this.heap[i])<0;){var a=this.heap[t];this.heap[t]=this.heap[i],this.heap[i]=a,t=i,i=n(t)}},r.prototype.enqueueAll=function(e){if(e.length!=0){var t=this.count;this.heap=this.heap.concat(e);var n=r.parentIndex(t);this.heapify(n>=0?n:0,r.parentIndex(this.count-1))}},r.prototype.dequeue=function(){if(this.count!=0){var e=this.heap[0],t=this.heap.pop();return this.heap.length>0&&(this.heap[0]=t,this.siftDown(0)),e}},r.prototype.siftDown=function(e){var t=r.leftChildIndex(e),n=r.rightChildIndex(e),i=e;if(t<this.heap.length&&this.comparator(this.heap[t],this.heap[i])<0&&(i=t),n<this.heap.length&&this.comparator(this.heap[n],this.heap[i])<0&&(i=n),i!=e){var a=this.heap[e];return this.heap[e]=this.heap[i],this.heap[i]=a,this.siftDown(i),!0}else return!1},r.prototype.toArray=function(){return this.heap.slice(0)},r}(),b=E,D;(function(r){r.noQuotes="no-quotes",r.useQuotes="use-quotes",r.default="default-quotes"})(D||(D={})),function(r){function e(t,n,i,a){if(a==r.default||!a)throw"Specified quote behavior may be ambiguous - default behavior not specified (may not be .default)";switch(t==r.default&&(t=a),t){case r.noQuotes:return n;case r.useQuotes:var l=i.quotesForKeepSuggestion,o=l.open,s=l.close;return o+n+s;default:throw"Unsupported quote behavior state detected; implementation missing!"}}r.apply=e}(D||(D={}));var U=D;function z(r,e){e=e||{left:void 0,startOfBuffer:void 0,endOfBuffer:void 0};var t=r(e.left||"")||[],n=r(e.right||"")||[],i;if(t.length>0&&(i=t[t.length-1]),t.length>1){var a=t[t.length-2];if(a.end==i.start&&i.text=="\'"){var l={text:a.text+i.text,start:a.start,end:i.end,length:a.length+i.length};t.pop(),t.pop(),t.push(l),i=l}}var o={left:t.map(function(f){return f.text}),right:n.map(function(f){return f.text}),caretSplitsToken:!1};if(t.length>0&&n.length>0){var s=n[0],u=i.end!=e.left.length,c=s.start!=0;if(u||c)return o;r(i.text+s.text).length==1&&(o.caretSplitsToken=!0)}return o}function pe(r,e){var t=z(r,e);return t.left.length>0?t.left.pop():""}function Ae(r,e){return pe(r,e)}var Pe={};R(Pe,{ascii:function(){return tt},default:function(){return ce},defaultWordbreaker:function(){return ce},placeholder:function(){return et}});function et(r){var e=0;return r.split(/\\s+/).map(function(t){var n={start:e,end:e+t.length,text:t,length:t.length};return e=n.end,n})}function tt(r){for(var e=/[A-Za-z0-9\']+/g,t=[],n;(n=e.exec(r))!==null;)t.push(new rt(n[0],n.index));return t}var rt=function(){function r(e,t){this.text=e,this.start=t}return Object.defineProperty(r.prototype,"length",{get:function(){return this.text.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"end",{get:function(){return this.start+this.text.length},enumerable:!1,configurable:!0}),r}(),nt=["Other","LF","Newline","CR","WSegSpace","Double_Quote","Single_Quote","MidNum","MidNumLet","Numeric","MidLetter","ALetter","ExtendNumLet","Format","Extend","Hebrew_Letter","ZWJ","Katakana","Regional_Indicator","sot","eot"],Me=[[0,0],[10,1],[11,2],[13,3],[14,0],[32,4],[33,0],[34,5],[35,0],[39,6],[40,0],[44,7],[45,0],[46,8],[47,0],[48,9],[58,10],[59,7],[60,0],[65,11],[91,0],[95,12],[96,0],[97,11],[123,0],[133,2],[134,0],[170,11],[171,0],[173,13],[174,0],[181,11],[182,0],[183,10],[184,0],[186,11],[187,0],[192,11],[215,0],[216,11],[247,0],[248,11],[728,0],[734,11],[768,14],[880,11],[885,0],[886,11],[888,0],[890,11],[894,7],[895,11],[896,0],[902,11],[903,10],[904,11],[907,0],[908,11],[909,0],[910,11],[930,0],[931,11],[1014,0],[1015,11],[1154,0],[1155,14],[1162,11],[1328,0],[1329,11],[1367,0],[1369,11],[1373,0],[1374,11],[1375,10],[1376,11],[1417,7],[1418,11],[1419,0],[1425,14],[1470,0],[1471,14],[1472,0],[1473,14],[1475,0],[1476,14],[1478,0],[1479,14],[1480,0],[1488,15],[1515,0],[1519,15],[1523,11],[1524,10],[1525,0],[1536,13],[1542,0],[1548,7],[1550,0],[1552,14],[1563,0],[1564,13],[1565,0],[1568,11],[1611,14],[1632,9],[1642,0],[1643,9],[1644,7],[1645,0],[1646,11],[1648,14],[1649,11],[1748,0],[1749,11],[1750,14],[1757,13],[1758,0],[1759,14],[1765,11],[1767,14],[1769,0],[1770,14],[1774,11],[1776,9],[1786,11],[1789,0],[1791,11],[1792,0],[1807,13],[1808,11],[1809,14],[1810,11],[1840,14],[1867,0],[1869,11],[1958,14],[1969,11],[1970,0],[1984,9],[1994,11],[2027,14],[2036,11],[2038,0],[2040,7],[2041,0],[2042,11],[2043,0],[2045,14],[2046,0],[2048,11],[2070,14],[2074,11],[2075,14],[2084,11],[2085,14],[2088,11],[2089,14],[2094,0],[2112,11],[2137,14],[2140,0],[2144,11],[2155,0],[2208,11],[2229,0],[2230,11],[2248,0],[2259,14],[2274,13],[2275,14],[2308,11],[2362,14],[2365,11],[2366,14],[2384,11],[2385,14],[2392,11],[2402,14],[2404,0],[2406,9],[2416,0],[2417,11],[2433,14],[2436,0],[2437,11],[2445,0],[2447,11],[2449,0],[2451,11],[2473,0],[2474,11],[2481,0],[2482,11],[2483,0],[2486,11],[2490,0],[2492,14],[2493,11],[2494,14],[2501,0],[2503,14],[2505,0],[2507,14],[2510,11],[2511,0],[2519,14],[2520,0],[2524,11],[2526,0],[2527,11],[2530,14],[2532,0],[2534,9],[2544,11],[2546,0],[2556,11],[2557,0],[2558,14],[2559,0],[2561,14],[2564,0],[2565,11],[2571,0],[2575,11],[2577,0],[2579,11],[2601,0],[2602,11],[2609,0],[2610,11],[2612,0],[2613,11],[2615,0],[2616,11],[2618,0],[2620,14],[2621,0],[2622,14],[2627,0],[2631,14],[2633,0],[2635,14],[2638,0],[2641,14],[2642,0],[2649,11],[2653,0],[2654,11],[2655,0],[2662,9],[2672,14],[2674,11],[2677,14],[2678,0],[2689,14],[2692,0],[2693,11],[2702,0],[2703,11],[2706,0],[2707,11],[2729,0],[2730,11],[2737,0],[2738,11],[2740,0],[2741,11],[2746,0],[2748,14],[2749,11],[2750,14],[2758,0],[2759,14],[2762,0],[2763,14],[2766,0],[2768,11],[2769,0],[2784,11],[2786,14],[2788,0],[2790,9],[2800,0],[2809,11],[2810,14],[2816,0],[2817,14],[2820,0],[2821,11],[2829,0],[2831,11],[2833,0],[2835,11],[2857,0],[2858,11],[2865,0],[2866,11],[2868,0],[2869,11],[2874,0],[2876,14],[2877,11],[2878,14],[2885,0],[2887,14],[2889,0],[2891,14],[2894,0],[2901,14],[2904,0],[2908,11],[2910,0],[2911,11],[2914,14],[2916,0],[2918,9],[2928,0],[2929,11],[2930,0],[2946,14],[2947,11],[2948,0],[2949,11],[2955,0],[2958,11],[2961,0],[2962,11],[2966,0],[2969,11],[2971,0],[2972,11],[2973,0],[2974,11],[2976,0],[2979,11],[2981,0],[2984,11],[2987,0],[2990,11],[3002,0],[3006,14],[3011,0],[3014,14],[3017,0],[3018,14],[3022,0],[3024,11],[3025,0],[3031,14],[3032,0],[3046,9],[3056,0],[3072,14],[3077,11],[3085,0],[3086,11],[3089,0],[3090,11],[3113,0],[3114,11],[3130,0],[3133,11],[3134,14],[3141,0],[3142,14],[3145,0],[3146,14],[3150,0],[3157,14],[3159,0],[3160,11],[3163,0],[3168,11],[3170,14],[3172,0],[3174,9],[3184,0],[3200,11],[3201,14],[3204,0],[3205,11],[3213,0],[3214,11],[3217,0],[3218,11],[3241,0],[3242,11],[3252,0],[3253,11],[3258,0],[3260,14],[3261,11],[3262,14],[3269,0],[3270,14],[3273,0],[3274,14],[3278,0],[3285,14],[3287,0],[3294,11],[3295,0],[3296,11],[3298,14],[3300,0],[3302,9],[3312,0],[3313,11],[3315,0],[3328,14],[3332,11],[3341,0],[3342,11],[3345,0],[3346,11],[3387,14],[3389,11],[3390,14],[3397,0],[3398,14],[3401,0],[3402,14],[3406,11],[3407,0],[3412,11],[3415,14],[3416,0],[3423,11],[3426,14],[3428,0],[3430,9],[3440,0],[3450,11],[3456,0],[3457,14],[3460,0],[3461,11],[3479,0],[3482,11],[3506,0],[3507,11],[3516,0],[3517,11],[3518,0],[3520,11],[3527,0],[3530,14],[3531,0],[3535,14],[3541,0],[3542,14],[3543,0],[3544,14],[3552,0],[3558,9],[3568,0],[3570,14],[3572,0],[3633,14],[3634,0],[3636,14],[3643,0],[3655,14],[3663,0],[3664,9],[3674,0],[3761,14],[3762,0],[3764,14],[3773,0],[3784,14],[3790,0],[3792,9],[3802,0],[3840,11],[3841,0],[3864,14],[3866,0],[3872,9],[3882,0],[3893,14],[3894,0],[3895,14],[3896,0],[3897,14],[3898,0],[3902,14],[3904,11],[3912,0],[3913,11],[3949,0],[3953,14],[3973,0],[3974,14],[3976,11],[3981,14],[3992,0],[3993,14],[4029,0],[4038,14],[4039,0],[4139,14],[4159,0],[4160,9],[4170,0],[4182,14],[4186,0],[4190,14],[4193,0],[4194,14],[4197,0],[4199,14],[4206,0],[4209,14],[4213,0],[4226,14],[4238,0],[4239,14],[4240,9],[4250,14],[4254,0],[4256,11],[4294,0],[4295,11],[4296,0],[4301,11],[4302,0],[4304,11],[4347,0],[4348,11],[4681,0],[4682,11],[4686,0],[4688,11],[4695,0],[4696,11],[4697,0],[4698,11],[4702,0],[4704,11],[4745,0],[4746,11],[4750,0],[4752,11],[4785,0],[4786,11],[4790,0],[4792,11],[4799,0],[4800,11],[4801,0],[4802,11],[4806,0],[4808,11],[4823,0],[4824,11],[4881,0],[4882,11],[4886,0],[4888,11],[4955,0],[4957,14],[4960,0],[4992,11],[5008,0],[5024,11],[5110,0],[5112,11],[5118,0],[5121,11],[5741,0],[5743,11],[5760,4],[5761,11],[5787,0],[5792,11],[5867,0],[5870,11],[5881,0],[5888,11],[5901,0],[5902,11],[5906,14],[5909,0],[5920,11],[5938,14],[5941,0],[5952,11],[5970,14],[5972,0],[5984,11],[5997,0],[5998,11],[6001,0],[6002,14],[6004,0],[6068,14],[6100,0],[6109,14],[6110,0],[6112,9],[6122,0],[6155,14],[6158,13],[6159,0],[6160,9],[6170,0],[6176,11],[6265,0],[6272,11],[6277,14],[6279,11],[6313,14],[6314,11],[6315,0],[6320,11],[6390,0],[6400,11],[6431,0],[6432,14],[6444,0],[6448,14],[6460,0],[6470,9],[6480,0],[6608,9],[6618,0],[6656,11],[6679,14],[6684,0],[6741,14],[6751,0],[6752,14],[6781,0],[6783,14],[6784,9],[6794,0],[6800,9],[6810,0],[6832,14],[6849,0],[6912,14],[6917,11],[6964,14],[6981,11],[6988,0],[6992,9],[7002,0],[7019,14],[7028,0],[7040,14],[7043,11],[7073,14],[7086,11],[7088,9],[7098,11],[7142,14],[7156,0],[7168,11],[7204,14],[7224,0],[7232,9],[7242,0],[7245,11],[7248,9],[7258,11],[7294,0],[7296,11],[7305,0],[7312,11],[7355,0],[7357,11],[7360,0],[7376,14],[7379,0],[7380,14],[7401,11],[7405,14],[7406,11],[7412,14],[7413,11],[7415,14],[7418,11],[7419,0],[7424,11],[7616,14],[7674,0],[7675,14],[7680,11],[7958,0],[7960,11],[7966,0],[7968,11],[8006,0],[8008,11],[8014,0],[8016,11],[8024,0],[8025,11],[8026,0],[8027,11],[8028,0],[8029,11],[8030,0],[8031,11],[8062,0],[8064,11],[8117,0],[8118,11],[8125,0],[8126,11],[8127,0],[8130,11],[8133,0],[8134,11],[8141,0],[8144,11],[8148,0],[8150,11],[8156,0],[8160,11],[8173,0],[8178,11],[8181,0],[8182,11],[8189,0],[8192,4],[8199,0],[8200,4],[8203,0],[8204,14],[8205,16],[8206,13],[8208,0],[8216,8],[8218,0],[8228,8],[8229,0],[8231,10],[8232,2],[8234,13],[8239,12],[8240,0],[8255,12],[8257,0],[8260,7],[8261,0],[8276,12],[8277,0],[8287,4],[8288,13],[8293,0],[8294,13],[8304,0],[8305,11],[8306,0],[8319,11],[8320,0],[8336,11],[8349,0],[8400,14],[8433,0],[8450,11],[8451,0],[8455,11],[8456,0],[8458,11],[8468,0],[8469,11],[8470,0],[8473,11],[8478,0],[8484,11],[8485,0],[8486,11],[8487,0],[8488,11],[8489,0],[8490,11],[8494,0],[8495,11],[8506,0],[8508,11],[8512,0],[8517,11],[8522,0],[8526,11],[8527,0],[8544,11],[8585,0],[9398,11],[9450,0],[11264,11],[11311,0],[11312,11],[11359,0],[11360,11],[11493,0],[11499,11],[11503,14],[11506,11],[11508,0],[11520,11],[11558,0],[11559,11],[11560,0],[11565,11],[11566,0],[11568,11],[11624,0],[11631,11],[11632,0],[11647,14],[11648,11],[11671,0],[11680,11],[11687,0],[11688,11],[11695,0],[11696,11],[11703,0],[11704,11],[11711,0],[11712,11],[11719,0],[11720,11],[11727,0],[11728,11],[11735,0],[11736,11],[11743,0],[11744,14],[11776,0],[11823,11],[11824,0],[12288,4],[12289,0],[12293,11],[12294,0],[12330,14],[12336,0],[12337,17],[12342,0],[12347,11],[12349,0],[12441,14],[12443,17],[12445,0],[12448,17],[12539,0],[12540,17],[12544,0],[12549,11],[12592,0],[12593,11],[12687,0],[12704,11],[12736,0],[12784,17],[12800,0],[13008,17],[13055,0],[13056,17],[13144,0],[40960,11],[42125,0],[42192,11],[42238,0],[42240,11],[42509,0],[42512,11],[42528,9],[42538,11],[42540,0],[42560,11],[42607,14],[42611,0],[42612,14],[42622,0],[42623,11],[42654,14],[42656,11],[42736,14],[42738,0],[42760,11],[42944,0],[42946,11],[42955,0],[42997,11],[43010,14],[43011,11],[43014,14],[43015,11],[43019,14],[43020,11],[43043,14],[43048,0],[43052,14],[43053,0],[43072,11],[43124,0],[43136,14],[43138,11],[43188,14],[43206,0],[43216,9],[43226,0],[43232,14],[43250,11],[43256,0],[43259,11],[43260,0],[43261,11],[43263,14],[43264,9],[43274,11],[43302,14],[43310,0],[43312,11],[43335,14],[43348,0],[43360,11],[43389,0],[43392,14],[43396,11],[43443,14],[43457,0],[43471,11],[43472,9],[43482,0],[43493,14],[43494,0],[43504,9],[43514,0],[43520,11],[43561,14],[43575,0],[43584,11],[43587,14],[43588,11],[43596,14],[43598,0],[43600,9],[43610,0],[43643,14],[43646,0],[43696,14],[43697,0],[43698,14],[43701,0],[43703,14],[43705,0],[43710,14],[43712,0],[43713,14],[43714,0],[43744,11],[43755,14],[43760,0],[43762,11],[43765,14],[43767,0],[43777,11],[43783,0],[43785,11],[43791,0],[43793,11],[43799,0],[43808,11],[43815,0],[43816,11],[43823,0],[43824,11],[43882,0],[43888,11],[44003,14],[44011,0],[44012,14],[44014,0],[44016,9],[44026,0],[44032,11],[55204,0],[55216,11],[55239,0],[55243,11],[55292,0],[64256,11],[64263,0],[64275,11],[64280,0],[64285,15],[64286,14],[64287,15],[64297,0],[64298,15],[64311,0],[64312,15],[64317,0],[64318,15],[64319,0],[64320,15],[64322,0],[64323,15],[64325,0],[64326,15],[64336,11],[64434,0],[64467,11],[64830,0],[64848,11],[64912,0],[64914,11],[64968,0],[65008,11],[65020,0],[65024,14],[65040,7],[65041,0],[65043,10],[65044,7],[65045,0],[65056,14],[65072,0],[65075,12],[65077,0],[65101,12],[65104,7],[65105,0],[65106,8],[65107,0],[65108,7],[65109,10],[65110,0],[65136,11],[65141,0],[65142,11],[65277,0],[65279,13],[65280,0],[65287,8],[65288,0],[65292,7],[65293,0],[65294,8],[65295,0],[65296,9],[65306,10],[65307,7],[65308,0],[65313,11],[65339,0],[65343,12],[65344,0],[65345,11],[65371,0],[65382,17],[65438,14],[65440,11],[65471,0],[65474,11],[65480,0],[65482,11],[65488,0],[65490,11],[65496,0],[65498,11],[65501,0],[65529,13],[65532,0],[65536,11],[65548,0],[65549,11],[65575,0],[65576,11],[65595,0],[65596,11],[65598,0],[65599,11],[65614,0],[65616,11],[65630,0],[65664,11],[65787,0],[65856,11],[65909,0],[66045,14],[66046,0],[66176,11],[66205,0],[66208,11],[66257,0],[66272,14],[66273,0],[66304,11],[66336,0],[66349,11],[66379,0],[66384,11],[66422,14],[66427,0],[66432,11],[66462,0],[66464,11],[66500,0],[66504,11],[66512,0],[66513,11],[66518,0],[66560,11],[66718,0],[66720,9],[66730,0],[66736,11],[66772,0],[66776,11],[66812,0],[66816,11],[66856,0],[66864,11],[66916,0],[67072,11],[67383,0],[67392,11],[67414,0],[67424,11],[67432,0],[67584,11],[67590,0],[67592,11],[67593,0],[67594,11],[67638,0],[67639,11],[67641,0],[67644,11],[67645,0],[67647,11],[67670,0],[67680,11],[67703,0],[67712,11],[67743,0],[67808,11],[67827,0],[67828,11],[67830,0],[67840,11],[67862,0],[67872,11],[67898,0],[67968,11],[68024,0],[68030,11],[68032,0],[68096,11],[68097,14],[68100,0],[68101,14],[68103,0],[68108,14],[68112,11],[68116,0],[68117,11],[68120,0],[68121,11],[68150,0],[68152,14],[68155,0],[68159,14],[68160,0],[68192,11],[68221,0],[68224,11],[68253,0],[68288,11],[68296,0],[68297,11],[68325,14],[68327,0],[68352,11],[68406,0],[68416,11],[68438,0],[68448,11],[68467,0],[68480,11],[68498,0],[68608,11],[68681,0],[68736,11],[68787,0],[68800,11],[68851,0],[68864,11],[68900,14],[68904,0],[68912,9],[68922,0],[69248,11],[69290,0],[69291,14],[69293,0],[69296,11],[69298,0],[69376,11],[69405,0],[69415,11],[69416,0],[69424,11],[69446,14],[69457,0],[69552,11],[69573,0],[69600,11],[69623,0],[69632,14],[69635,11],[69688,14],[69703,0],[69734,9],[69744,0],[69759,14],[69763,11],[69808,14],[69819,0],[69821,13],[69822,0],[69837,13],[69838,0],[69840,11],[69865,0],[69872,9],[69882,0],[69888,14],[69891,11],[69927,14],[69941,0],[69942,9],[69952,0],[69956,11],[69957,14],[69959,11],[69960,0],[69968,11],[70003,14],[70004,0],[70006,11],[70007,0],[70016,14],[70019,11],[70067,14],[70081,11],[70085,0],[70089,14],[70093,0],[70094,14],[70096,9],[70106,11],[70107,0],[70108,11],[70109,0],[70144,11],[70162,0],[70163,11],[70188,14],[70200,0],[70206,14],[70207,0],[70272,11],[70279,0],[70280,11],[70281,0],[70282,11],[70286,0],[70287,11],[70302,0],[70303,11],[70313,0],[70320,11],[70367,14],[70379,0],[70384,9],[70394,0],[70400,14],[70404,0],[70405,11],[70413,0],[70415,11],[70417,0],[70419,11],[70441,0],[70442,11],[70449,0],[70450,11],[70452,0],[70453,11],[70458,0],[70459,14],[70461,11],[70462,14],[70469,0],[70471,14],[70473,0],[70475,14],[70478,0],[70480,11],[70481,0],[70487,14],[70488,0],[70493,11],[70498,14],[70500,0],[70502,14],[70509,0],[70512,14],[70517,0],[70656,11],[70709,14],[70727,11],[70731,0],[70736,9],[70746,0],[70750,14],[70751,11],[70754,0],[70784,11],[70832,14],[70852,11],[70854,0],[70855,11],[70856,0],[70864,9],[70874,0],[71040,11],[71087,14],[71094,0],[71096,14],[71105,0],[71128,11],[71132,14],[71134,0],[71168,11],[71216,14],[71233,0],[71236,11],[71237,0],[71248,9],[71258,0],[71296,11],[71339,14],[71352,11],[71353,0],[71360,9],[71370,0],[71453,14],[71468,0],[71472,9],[71482,0],[71680,11],[71724,14],[71739,0],[71840,11],[71904,9],[71914,0],[71935,11],[71943,0],[71945,11],[71946,0],[71948,11],[71956,0],[71957,11],[71959,0],[71960,11],[71984,14],[71990,0],[71991,14],[71993,0],[71995,14],[71999,11],[72e3,14],[72001,11],[72002,14],[72004,0],[72016,9],[72026,0],[72096,11],[72104,0],[72106,11],[72145,14],[72152,0],[72154,14],[72161,11],[72162,0],[72163,11],[72164,14],[72165,0],[72192,11],[72193,14],[72203,11],[72243,14],[72250,11],[72251,14],[72255,0],[72263,14],[72264,0],[72272,11],[72273,14],[72284,11],[72330,14],[72346,0],[72349,11],[72350,0],[72384,11],[72441,0],[72704,11],[72713,0],[72714,11],[72751,14],[72759,0],[72760,14],[72768,11],[72769,0],[72784,9],[72794,0],[72818,11],[72848,0],[72850,14],[72872,0],[72873,14],[72887,0],[72960,11],[72967,0],[72968,11],[72970,0],[72971,11],[73009,14],[73015,0],[73018,14],[73019,0],[73020,14],[73022,0],[73023,14],[73030,11],[73031,14],[73032,0],[73040,9],[73050,0],[73056,11],[73062,0],[73063,11],[73065,0],[73066,11],[73098,14],[73103,0],[73104,14],[73106,0],[73107,14],[73112,11],[73113,0],[73120,9],[73130,0],[73440,11],[73459,14],[73463,0],[73648,11],[73649,0],[73728,11],[74650,0],[74752,11],[74863,0],[74880,11],[75076,0],[77824,11],[78895,0],[78896,13],[78905,0],[82944,11],[83527,0],[92160,11],[92729,0],[92736,11],[92767,0],[92768,9],[92778,0],[92880,11],[92910,0],[92912,14],[92917,0],[92928,11],[92976,14],[92983,0],[92992,11],[92996,0],[93008,9],[93018,0],[93027,11],[93048,0],[93053,11],[93072,0],[93760,11],[93824,0],[93952,11],[94027,0],[94031,14],[94032,11],[94033,14],[94088,0],[94095,14],[94099,11],[94112,0],[94176,11],[94178,0],[94179,11],[94180,14],[94181,0],[94192,14],[94194,0],[110592,17],[110593,0],[110948,17],[110952,0],[113664,11],[113771,0],[113776,11],[113789,0],[113792,11],[113801,0],[113808,11],[113818,0],[113821,14],[113823,0],[113824,13],[113828,0],[119141,14],[119146,0],[119149,14],[119155,13],[119163,14],[119171,0],[119173,14],[119180,0],[119210,14],[119214,0],[119362,14],[119365,0],[119808,11],[119893,0],[119894,11],[119965,0],[119966,11],[119968,0],[119970,11],[119971,0],[119973,11],[119975,0],[119977,11],[119981,0],[119982,11],[119994,0],[119995,11],[119996,0],[119997,11],[120004,0],[120005,11],[120070,0],[120071,11],[120075,0],[120077,11],[120085,0],[120086,11],[120093,0],[120094,11],[120122,0],[120123,11],[120127,0],[120128,11],[120133,0],[120134,11],[120135,0],[120138,11],[120145,0],[120146,11],[120486,0],[120488,11],[120513,0],[120514,11],[120539,0],[120540,11],[120571,0],[120572,11],[120597,0],[120598,11],[120629,0],[120630,11],[120655,0],[120656,11],[120687,0],[120688,11],[120713,0],[120714,11],[120745,0],[120746,11],[120771,0],[120772,11],[120780,0],[120782,9],[120832,0],[121344,14],[121399,0],[121403,14],[121453,0],[121461,14],[121462,0],[121476,14],[121477,0],[121499,14],[121504,0],[121505,14],[121520,0],[122880,14],[122887,0],[122888,14],[122905,0],[122907,14],[122914,0],[122915,14],[122917,0],[122918,14],[122923,0],[123136,11],[123181,0],[123184,14],[123191,11],[123198,0],[123200,9],[123210,0],[123214,11],[123215,0],[123584,11],[123628,14],[123632,9],[123642,0],[124928,11],[125125,0],[125136,14],[125143,0],[125184,11],[125252,14],[125259,11],[125260,0],[125264,9],[125274,0],[126464,11],[126468,0],[126469,11],[126496,0],[126497,11],[126499,0],[126500,11],[126501,0],[126503,11],[126504,0],[126505,11],[126515,0],[126516,11],[126520,0],[126521,11],[126522,0],[126523,11],[126524,0],[126530,11],[126531,0],[126535,11],[126536,0],[126537,11],[126538,0],[126539,11],[126540,0],[126541,11],[126544,0],[126545,11],[126547,0],[126548,11],[126549,0],[126551,11],[126552,0],[126553,11],[126554,0],[126555,11],[126556,0],[126557,11],[126558,0],[126559,11],[126560,0],[126561,11],[126563,0],[126564,11],[126565,0],[126567,11],[126571,0],[126572,11],[126579,0],[126580,11],[126584,0],[126585,11],[126589,0],[126590,11],[126591,0],[126592,11],[126602,0],[126603,11],[126620,0],[126625,11],[126628,0],[126629,11],[126634,0],[126635,11],[126652,0],[127280,11],[127306,0],[127312,11],[127338,0],[127344,11],[127370,0],[127462,18],[127488,0],[127995,14],[128e3,0],[130032,9],[130042,0],[917505,13],[917506,0],[917536,14],[917632,0],[917760,14],[918e3,0]];function ce(r,e){var t=ot(r,e);if(t.length==0)return[];for(var n=[],i=0;i<t.length-1;i++){var a=t[i],l=t[i+1],o=new Ue(r,a,l);at(o.text,e)?n.push(o):i==t.length-2&&(o=new Ue(r,l,l),n.push(o))}return n}var Ue=function(){function r(e,t,n){this._source=e,this.start=t,this.end=n}return Object.defineProperty(r.prototype,"text",{get:function(){return this._source.substring(this.start,this.end)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"length",{get:function(){return this.end-this.start},enumerable:!1,configurable:!0}),r}(),it=function(){function r(e,t,n,i,a,l){this.lookbehind=19,this.left=19,this.right=19,this.text=e,this.options=t,arguments.length==3?this.lookahead=this.wordbreakPropertyAt(n):(this.lookbehind=n,this.left=i,this.right=a,this.lookahead=l)}return r.prototype.next=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.left,this.right,this.lookahead,t)},r.prototype.ignoringRight=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.lookbehind,this.left,this.lookahead,t)},r.prototype.ignoringLookahead=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.lookbehind,this.left,this.right,t)},r.prototype.wordbreakPropertyAt=function(e){return e<0?19:e>=this.text.length?20:We(this.text[e])?Ee(this.text[e]+this.text[e+1]):Ee(this.text[e],this.options)},r.prototype.match=function(e,t,n,i){var a,l,o,s,u=(a=e==null?void 0:e.includes(this.lookbehind))!==null&&a!==void 0?a:!0;return u=u&&((l=t==null?void 0:t.includes(this.left))!==null&&l!==void 0?l:!0),u=u&&((o=n==null?void 0:n.includes(this.right))!==null&&o!==void 0?o:!0),u&&((s=i==null?void 0:i.includes(this.lookahead))!==null&&s!==void 0?s:!0)},r.prototype.propertyMatch=function(e,t,n,i){var a=this,l=function(o){return Be(o,a.options)};return this.match(e==null?void 0:e.map(l),t==null?void 0:t.map(l),n==null?void 0:n.map(l),i==null?void 0:i.map(l))},r}();function at(r,e){return!Array.from(r).map(function(t){return Ee(t,e)}).every(function(t){return t===3||t===1||t===2||t===4})}function ot(r,e){var t,n,i;if(r.length===0)return[];e&&!e.rules&&(e.rules=[]);var a=[],l,o=0,s=new it(r,e,o),u=0;do{if(l=o,o=_(o),s=s.next(o),s.match(null,[19],null,null)){a.push(l);continue}if(s.match(null,null,[20],null)){a.push(l);break}if(!s.match(null,[3],[1],null)){var c=[2,3,1];if(s.match(null,c,null,null)){a.push(l);continue}if(s.match(null,null,c,null)){a.push(l);continue}if(!s.match(null,[4],[4],null)){for(var f=[13,14,16];s.match(null,null,f,null);)t=(0,T.__read)([o,_(o)],2),l=t[0],o=t[1],s=s.ignoringRight(o);if(s.right===20){a.push(l);break}for(;s.match(null,null,null,f);)o=_(o),s=s.ignoringLookahead(o);var v=[11,15],p=[8,6];if(e!=null&&e.rules){var d=!1;try{for(var m=(n=void 0,(0,T.__values)(e.rules)),C=m.next();!C.done;C=m.next()){var x=C.value;if(d=x.match(s),d){x.breakIfMatch&&a.push(l);break}}}catch(I){n={error:I}}finally{try{C&&!C.done&&(i=m.return)&&i.call(m)}finally{if(n)throw n.error}}if(d)continue}if(!s.match(null,v,v,null)){var y=[10].concat(p);if(!s.match(null,v,y,v)&&!s.match(v,y,v,null)&&!s.match(null,[15],[6],null)&&!s.match(null,[15],[5],[15])&&!s.match([15],[5],[15],null)&&!s.match(null,[9],[9],null)&&!s.match(null,v,[9],null)&&!s.match(null,[9],v,null)){var S=[7].concat(p);if(!s.match([9],S,[9],null)&&!s.match(null,[9],S,[9])&&!s.match(null,[17],[17],null)){var w=[17,9].concat(v);if(!s.match(null,w,[12],null)&&!s.match(null,[12],[12],null)&&!s.match(null,[12],w,null)){if(s.right===18){if(u+=1,u%2==1)continue}else u=0;a.push(l)}}}}}}}while(l<r.length);return a;function _(I){return I>=r.length?r.length:We(r[I])?I+2:I+1}}function We(r){var e=r.charCodeAt(0);return e>=55296&&e<=56319}function Ee(r,e){if(e!=null&&e.propertyMapping){var t=e.propertyMapping(r);if(t)return Be(t,e)}var n=r.codePointAt(0);return Ie(n,0,Me.length-1)}function Be(r,e){var t,n,i=function(l){return l.toLowerCase()==r.toLowerCase()},a=(n=(t=e==null?void 0:e.customProperties)===null||t===void 0?void 0:t.findIndex(i))!==null&&n!==void 0?n:-1;return a!=-1?-a-1:nt.findIndex(i)}function Ie(r,e,t){if(t<e)return 0;var n=e+~~((t-e)/2),i=Me[n],a=Me[n+1],l=a?a[0]:1/0;return r<i[0]?Ie(r,e,n-1):r>=l?Ie(r,n+1,t):i[1]}B();var Qe=12,ut=function(){function r(e,t){this.root=e,this.prefix=t}return r.prototype.children=function(){var e,t,n,i,a,l,o,s,u,c,f,v,p,d,m,C,x,y;return(0,T.__generator)(this,function(S){switch(S.label){case 0:if(e=this.root,e.type!="internal")return[3,9];t=function(w){var _,I,Y,ne,Z,be,ke,ie,_e,ae,K,ve;return(0,T.__generator)(this,function(W){switch(W.label){case 0:if(_=e.children[w],!$(w))return[3,12];if(_.type!="internal")return[3,9];I=_,Y=function(oe){var ue;return(0,T.__generator)(this,function(se){switch(se.label){case 0:return ue=n.prefix+w+oe,[4,{char:w+oe,traversal:function(){return new r(I.children[oe],ue)}}];case 1:return se.sent(),[2]}})},W.label=1;case 1:W.trys.push([1,6,7,8]),ne=(K=void 0,(0,T.__values)(I.values)),Z=ne.next(),W.label=2;case 2:return Z.done?[3,5]:(be=Z.value,[5,Y(be)]);case 3:W.sent(),W.label=4;case 4:return Z=ne.next(),[3,2];case 5:return[3,8];case 6:return ke=W.sent(),K={error:ke},[3,8];case 7:try{Z&&!Z.done&&(ve=ne.return)&&ve.call(ne)}finally{if(K)throw K.error}return[7];case 8:return[3,11];case 9:return ie=_.entries[0].key,w=w+ie[n.prefix.length+1],_e=n.prefix+w,[4,{char:w,traversal:function(){return new r(_,_e)}}];case 10:W.sent(),W.label=11;case 11:return[3,16];case 12:return X(w)?[2,"continue"]:[3,13];case 13:return w?[3,14]:[2,"continue"];case 14:return ae=n.prefix+w,[4,{char:w,traversal:function(){return new r(_,ae)}}];case 15:W.sent(),W.label=16;case 16:return[2]}})},n=this,S.label=1;case 1:S.trys.push([1,6,7,8]),i=(0,T.__values)(e.values),a=i.next(),S.label=2;case 2:return a.done?[3,5]:(l=a.value,[5,t(l)]);case 3:S.sent(),S.label=4;case 4:return a=i.next(),[3,2];case 5:return[3,8];case 6:return o=S.sent(),m={error:o},[3,8];case 7:try{a&&!a.done&&(C=i.return)&&C.call(i)}finally{if(m)throw m.error}return[7];case 8:return[2];case 9:s=this.prefix,u=e.entries.filter(function(w){return w.key!=s&&s.length<w.key.length}),c=function(w){var _;return(0,T.__generator)(this,function(I){switch(I.label){case 0:return _=w[s.length],$(_)&&(_=_+w[s.length+1]),[4,{char:_,traversal:function(){return new r(e,s+_)}}];case 1:return I.sent(),[2]}})},S.label=10;case 10:S.trys.push([10,15,16,17]),f=(0,T.__values)(u),v=f.next(),S.label=11;case 11:return v.done?[3,14]:(p=v.value.key,[5,c(p)]);case 12:S.sent(),S.label=13;case 13:return v=f.next(),[3,11];case 14:return[3,17];case 15:return d=S.sent(),x={error:d},[3,17];case 16:try{v&&!v.done&&(y=f.return)&&y.call(f)}finally{if(x)throw x.error}return[7];case 17:return[2]}})},Object.defineProperty(r.prototype,"entries",{get:function(){if(this.root.type=="leaf"){var e=this.prefix,t=this.root.entries.filter(function(i){return i.key==e});return t.map(function(i){return i.content})}else{var n=this.root.children[Q];return n&&n.type=="leaf"?n.entries.map(function(i){return i.content}):[]}},enumerable:!1,configurable:!0}),r}(),st=function(){function r(e,t){t===void 0&&(t={}),this.languageUsesCasing=t.languageUsesCasing,this.applyCasing=t.applyCasing,this._trie=new ct(e.root,e.totalWeight,t.searchTermToKey||ht),this.breakWords=t.wordBreaker||ce,this.punctuation=t.punctuation}return r.prototype.configure=function(e){var t;return this.configuration={leftContextCodePoints:e.maxLeftContextCodePoints,rightContextCodePoints:(t=e.maxRightContextCodePoints)!==null&&t!==void 0?t:0}},r.prototype.toKey=function(e){return this._trie.toKey(e)},r.prototype.predict=function(e,t){if(!e.insert&&!t.left&&!t.right&&t.startOfBuffer&&t.endOfBuffer)return l(this._trie.firstN(Qe).map(function(o){var s=o.text,u=o.p;return{transform:{insert:s,deleteLeft:0},displayAs:s,p:u}}));var n=H(e,t),i=e.deleteLeft-e.insert.kmwLength(),a=pe(this.breakWords,n);return l(this._trie.lookup(a).map(function(o){var s=o.text,u=o.p;return h({insert:s,deleteLeft:i+a.kmwLength()},u)}));function l(o){var s,u,c=[];try{for(var f=(0,T.__values)(o),v=f.next();!v.done;v=f.next()){var p=v.value;c.push({sample:p,p:p.p})}}catch(d){s={error:d}}finally{try{v&&!v.done&&(u=f.return)&&u.call(f)}finally{if(s)throw s.error}}return c}},Object.defineProperty(r.prototype,"wordbreaker",{get:function(){return this.breakWords},enumerable:!1,configurable:!0}),r.prototype.traverseFromRoot=function(){return new ut(this._trie.root,"")},r}(),lt=st,ct=function(){function r(e,t,n){this.root=e,this.toKey=n,this.totalWeight=t}return r.prototype.lookup=function(e){var t=this.toKey(e),n=Ke(this.root,t);return n===null?[]:Ve(n,t,this.totalWeight)},r.prototype.firstN=function(e){return Ve(this.root,"",this.totalWeight,e)},r}();function Ke(r,e,t){if(t===void 0&&(t=0),r.type==="leaf"||t===e.length)return r;var n=e[t];return r.children[n]?Ke(r.children[n],e,t+1):null}function Ve(r,e,t,n){var i,a;n===void 0&&(n=Qe);var l=new b(function(C,x){return(x?x.weight:0)-(C?C.weight:0)}),o=[];if(r.type==="leaf")try{for(var s=(0,T.__values)(r.entries),u=s.next();!u.done;u=s.next()){var c=u.value;if(c.key.indexOf(e)==0){var f=c.content,v=c.weight;if(o.push({text:f,p:v/t}),o.length>=n)return o}}}catch(C){i={error:C}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}else{l.enqueue(r);for(var p=void 0,d=function(){if(ft(p))if(p.type==="leaf")l.enqueueAll(p.entries);else{var C=p;l.enqueueAll(p.values.map(function(x){return C.children[x]}))}else if(o.push({text:p.content,p:p.weight/t}),o.length>=n)return{value:o}};p=l.dequeue();){var m=d();if(typeof m=="object")return m.value}}return o}function ft(r){return"type"in r}function ht(r){return r.normalize("NFD").replace(/[\\u0300-\\u036f]/g,"").toLowerCase()}var pt=function(){function r(e){e=e||{},this._futureSuggestions=e.futureSuggestions?e.futureSuggestions.slice():[],e.punctuation&&(this.punctuation=e.punctuation)}return r.prototype.configure=function(e){return this.configuration={leftContextCodePoints:e.maxLeftContextCodePoints,rightContextCodePoints:e.maxRightContextCodePoints},this.configuration},r.prototype.predict=function(e,t,n){var i=function(l){var o,s,u=[],c=l.length;try{for(var f=(0,T.__values)(l),v=f.next();!v.done;v=f.next()){var p=v.value;u.push({sample:p,p:1})}}catch(d){o={error:d}}finally{try{v&&!v.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}return u};if(n)return i(n);var a=this._futureSuggestions.shift();return a?i(a):[]},r}(),vt=pt,qe={};R(qe,{ClassicalDistanceCalculation:function(){return Ne},ContextTracker:function(){return ze},QUEUE_NODE_COMPARATOR:function(){return Se},SearchNode:function(){return Ge},SearchResult:function(){return He},SearchSpace:function(){return ee},TrackedContextState:function(){return Ce},TrackedContextSuggestion:function(){return gt},TrackedContextToken:function(){return re}});var Ne=function(){function r(e){if(this.diagonalWidth=2,this.inputSequence=[],this.matchSequence=[],e){var t=e.resolvedDistances.length;this.resolvedDistances=Array(t);for(var n=0;n<t;n++)this.resolvedDistances[n]=e.resolvedDistances[n].slice(0);this.inputSequence=e.inputSequence.slice(0),this.matchSequence=e.matchSequence.slice(0),this.diagonalWidth=e.diagonalWidth}else this.resolvedDistances=[]}return r.prototype.getTrueIndex=function(e,t,n){var i={row:e,col:t-e+n,sparse:!1};return(i.col<0||i.col>2*n)&&(i.sparse=!0),i},r.prototype.getCostAt=function(e,t,n){if(n===void 0&&(n=this.diagonalWidth),e<0||t<0)return e==-1&&t>=-1?t+1:t==-1&&e>=-1?e+1:Number.MAX_VALUE;var i=this.getTrueIndex(e,t,n);return i.sparse?Number.MAX_VALUE:this.resolvedDistances[i.row][i.col]},r.prototype.getFinalCost=function(){for(var e=this,t=e.getHeuristicFinalCost();t>e.diagonalWidth;)e=e.increaseMaxDistance(),t=e.getHeuristicFinalCost();return t},r.prototype.getHeuristicFinalCost=function(){return this.getCostAt(this.inputSequence.length-1,this.matchSequence.length-1)},r.prototype.hasFinalCostWithin=function(e){var t=this,n=t.getHeuristicFinalCost(),i=this.diagonalWidth;do{if(n<=e)return!0;if(i<e)t=t.increaseMaxDistance(),i++,n=t.getHeuristicFinalCost();else break}while(!0);return!1},r.prototype.editPath=function(e,t){e===void 0&&(e=this.inputSequence.length-1),t===void 0&&(t=this.matchSequence.length-1);var n=this.getCostAt(e,t),i=null,a=null,l=this.getCostAt(e,t-1),o=this.getCostAt(e-1,t),s=this.getCostAt(e-1,t-1),u=(0,T.__read)(r.getTransposeParent(this,e,t),2),c=u[0],f=u[1];if(c>=0&&f>=0){var v=1;if(i=["transpose-start"],c!=e-1){var p=e-c-1;i=i.concat(Array(p).fill("transpose-delete")),v+=p}else{var p=t-f-1;i=i.concat(Array(p).fill("transpose-insert")),v+=p}i.push("transpose-end"),this.getCostAt(c-1,f-1)!=n-v&&(i=null),a=[c-1,f-1]}return i||(s==n-1?(i=["substitute"],a=[e-1,t-1]):l==n-1?(i=["insert"],a=[e,t-1]):o==n-1?(i=["delete"],a=[e-1,t]):(i=["match"],a=[e-1,t-1])),a[0]>=0&&a[1]>=0?this.editPath(a[0],a[1]).concat(i):a[0]>-1?Array(a[0]+1).fill("delete").concat(i):a[1]>-1?Array(a[1]+1).fill("insert").concat(i):i},r.getTransposeParent=function(e,t,n){if(t<0||n<0||e.inputSequence[t].key==e.matchSequence[n].key)return[-1,-1];for(var i=-1,a=t-1;a>=0;a--)if(e.inputSequence[a].key==e.matchSequence[n].key){i=a;break}for(var l=-1,a=n-1;a>=0;a--)if(e.matchSequence[a].key==e.inputSequence[t].key){l=a;break}return[i,l]},r.initialCostAt=function(e,t,n,i,a){var l=e.inputSequence[t].key==e.matchSequence[n].key?0:1,o=e.getCostAt(t-1,n-1)+l,s=i||e.getCostAt(t,n-1)+1,u=a||e.getCostAt(t-1,n)+1,c=Number.MAX_VALUE;if(t>0&&n>0){var f=(0,T.__read)(r.getTransposeParent(e,t,n),2),v=f[0],p=f[1];c=e.getCostAt(v-1,p-1)+(t-v-1)+1+(n-p-1)}return Math.min(o,u,s,c)},r.prototype.getSubset=function(e,t){var n=new r(this);if(e>this.inputSequence.length||t>this.matchSequence.length)throw"Invalid dimensions specified for trim operation";n.inputSequence.splice(e),n.matchSequence.splice(t),n.resolvedDistances.splice(e);for(var i=this.getTrueIndex(e-1,t-1,this.diagonalWidth),a=i.col;a<=2*this.diagonalWidth;a++){var l=i.row-(a-i.col);if(l<0)break;if(a<0)n.resolvedDistances[l]=Array(2*n.diagonalWidth+1).fill(Number.MAX_VALUE);else{var o=2*this.diagonalWidth-a,s=n.resolvedDistances[l].splice(0,a+1),u=Array(o).fill(Number.MAX_VALUE);n.resolvedDistances[l]=s.concat(u)}}return n},r.forDiagonalOfAxis=function(e,t,n,i){for(var a=n-t<e?n-t+e:2*e,l=t-e,o=l<0?0:l,s=o-l;s<=a;s++)i(l+s,s)},r.prototype.addInputChar=function(e){var t=new r(this),n=t.inputSequence.length;t.inputSequence.push(e);var i=Array(2*t.diagonalWidth+1).fill(Number.MAX_VALUE);return t.resolvedDistances[n]=i,t.matchSequence.length==0||r.forDiagonalOfAxis(t.diagonalWidth,n,t.matchSequence.length-1,function(a,l){i[l]=r.initialCostAt(t,n,a)}),t},r.prototype.addMatchChar=function(e){var t=new r(this),n=t.matchSequence.length;return t.matchSequence.push(e),t.inputSequence.length==0||r.forDiagonalOfAxis(t.diagonalWidth,n,t.inputSequence.length-1,function(i,a){var l=t.resolvedDistances[i];l[2*t.diagonalWidth-a]=r.initialCostAt(t,i,n)}),t},r.prototype.increaseMaxDistance=function(){var e=new r(this);if(e.diagonalWidth++,e.inputSequence.length<1||e.matchSequence.length<1)return e;function t(o,s,u,c){var f=2*(e.diagonalWidth-1),v=u.length-1;f=f<v-o?f:v-o;for(var p=0;p<=f;p++)s==u[o+p].key&&c(o+p,p)}for(var n=function(o){var s=Number.MAX_VALUE,u=o-e.diagonalWidth;if(u>=0){var c=u==0?o+2:Number.MAX_VALUE;s=r.initialCostAt(e,o,u,c,void 0);var f=s;if(u<e.matchSequence.length-1){r.propagateUpdateFrom(e,o,u+1,f+1,0);var v=o+2;if(o+2<i.inputSequence.length){var p=e.inputSequence[o+1].key;t(u+3,p,e.matchSequence,function(S,w){r.propagateUpdateFrom(e,v,S,f+w+2,w)})}}}var d=Number.MAX_VALUE;if(u=o+e.diagonalWidth,u<e.matchSequence.length){var m=o==0?u+2:Number.MAX_VALUE;a=e.getCostAt(o,u-1,i.diagonalWidth)+1,d=r.initialCostAt(e,o,u,a,m);var C=d;if(o<e.inputSequence.length-1){r.propagateUpdateFrom(e,o+1,u,C+1,2*i.diagonalWidth);var x=u+2;if(u+2<i.matchSequence.length){var y=e.matchSequence[o+1].key;t(o+3,y,e.inputSequence,function(S,w){var _=2*(e.diagonalWidth-1)-w;r.propagateUpdateFrom(e,S,x,C+w+2,_)})}}}e.resolvedDistances[o]=[s].concat(e.resolvedDistances[o],d)},i=this,a,l=0;l<e.inputSequence.length;l++)n(l);return e},r.propagateUpdateFrom=function(e,t,n,i,a){if(i<e.resolvedDistances[t][a])e.resolvedDistances[t][a]=i;else return;var l=t<e.inputSequence.length-1,o=n<e.matchSequence.length-1;if(a<2*(e.diagonalWidth-1)&&o){var s=i+1;this.propagateUpdateFrom(e,t,n+1,s,a+1)}if(a>0&&l){var s=i+1;this.propagateUpdateFrom(e,t+1,n,s,a-1)}if(l&&o){var s=i+(e.inputSequence[t+1].key==e.matchSequence[n+1].key?0:1);this.propagateUpdateFrom(e,t+1,n+1,s,a);for(var u=-1,c=t+2;c<e.inputSequence.length;c++)if(e.inputSequence[c].key==e.matchSequence[n+1].key){u=c;break}for(var f=-1,c=n+2;c<e.matchSequence.length;c++)if(e.matchSequence[c].key==e.inputSequence[t+1].key){f=c;break}if(u>0&&f>0){var v=i+(u-t-2)+1+(f-n-2);this.propagateUpdateFrom(e,u,f,v,e.diagonalWidth-1+f-u)}}},Object.defineProperty(r.prototype,"mapKey",{get:function(){var e=this.inputSequence.map(function(n){return n.key}).join(""),t=this.matchSequence.map(function(n){return n.key}).join("");return e+Q+t+Q+this.diagonalWidth},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastInputEntry",{get:function(){return this.inputSequence[this.inputSequence.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastMatchEntry",{get:function(){return this.matchSequence[this.matchSequence.length-1]},enumerable:!1,configurable:!0}),r.computeDistance=function(e,t,n){n===void 0&&(n=1);var i=new r;n=n||1,i.diagonalWidth=n;for(var a=0;a<e.length;a++)i=i.addInputChar(e[a]);for(var l=0;l<t.length;l++)i=i.addMatchChar(t[l]);return i},r}(),Se=function(r,e){return r.currentCost-e.currentCost},Ge=function(){function r(e,t){if(this.toKey=function(i){return i},t=t||function(i){return i},e instanceof r){var n=e;this.calculation=n.calculation,this.currentTraversal=n.currentTraversal,this.priorInput=n.priorInput,this.toKey=n.toKey}else this.calculation=new Ne,this.currentTraversal=e,this.priorInput=[],this.toKey=t}return Object.defineProperty(r.prototype,"knownCost",{get:function(){return this.calculation.getHeuristicFinalCost()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputSamplingCost",{get:function(){if(this._inputCost!==void 0)return this._inputCost;var e=ee.MIN_KEYSTROKE_PROBABILITY;return this._inputCost=this.priorInput.map(function(t){return t.p>e?t.p:e}).reduce(function(t,n){return t-Math.log(n)},0),this._inputCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentCost",{get:function(){return ee.EDIT_DISTANCE_COST_SCALE*this.knownCost+this.inputSamplingCost},enumerable:!1,configurable:!0}),r.prototype.buildInsertionEdges=function(){var e,t,n=[];try{for(var i=(0,T.__values)(this.currentTraversal.children()),a=i.next();!a.done;a=i.next()){var l=a.value,o=l.traversal(),s={key:l.char,traversal:o},u=this.calculation.addMatchChar(s),c=new r(this);c.calculation=u,c.priorInput=this.priorInput,c.currentTraversal=o,n.push(c)}}catch(f){e={error:f}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.buildDeletionEdges=function(e){var t,n,i=[];try{for(var a=(0,T.__values)(e),l=a.next();!l.done;l=a.next()){var o=l.value;if(o.p<e[0].p*Math.exp(-ee.EDIT_DISTANCE_COST_SCALE))break;var s=this.calculation,u=o.sample;u.deleteLeft&&(s=s.getSubset(s.inputSequence.length-u.deleteLeft,s.matchSequence.length));var c=this.priorInput.slice(0);c.push(o);for(var f=0;f<u.insert.length;f++){var v=u.insert[f];$(v)&&(f++,v=v+u.insert[f]);var p=this.toKey(v);p&&(s=s.addInputChar({key:p}))}var d=new r(this);d.calculation=s,d.priorInput=c,i.push(d)}}catch(m){t={error:m}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i},r.prototype.buildSubstitutionEdges=function(e){var t,n,i,a,l=this.buildDeletionEdges(e),o=[];try{for(var s=(0,T.__values)(this.currentTraversal.children()),u=s.next();!u.done;u=s.next()){var c=u.value;try{for(var f=(i=void 0,(0,T.__values)(l)),v=f.next();!v.done;v=f.next()){var p=v.value,d=c.traversal(),m={key:c.char,traversal:d},C=p.calculation.addMatchChar(m),x=new r(this);x.calculation=C,x.priorInput=p.priorInput,x.currentTraversal=d,o.push(x)}}catch(y){i={error:y}}finally{try{v&&!v.done&&(a=f.return)&&a.call(f)}finally{if(i)throw i.error}}}}catch(y){t={error:y}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return o},Object.defineProperty(r.prototype,"mapKey",{get:function(){var e=this.priorInput.map(function(n){return"+"+n.sample.insert+"-"+n.sample.deleteLeft}).join(""),t=this.calculation.matchSequence.map(function(n){return n.key}).join("");return e+Q+t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isFullReplacement",{get:function(){return this.knownCost&&this.knownCost==this.priorInput.length},enumerable:!1,configurable:!0}),r}(),Le=function(){function r(e,t){if(this.processed=[],typeof e=="number"){this.index=e,this.correctionQueue=new b(Se,t);return}else this.index=e.index,this.processed=[].concat(e.processed),this.correctionQueue=new b(e.correctionQueue)}return r.prototype.increaseMaxEditDistance=function(){var e=this.correctionQueue.toArray();e.forEach(function(t){t.calculation=t.calculation.increaseMaxDistance()}),this.correctionQueue=new b(Se,e)},r}(),He=function(){function r(e){this.resultNode=e}return Object.defineProperty(r.prototype,"inputSequence",{get:function(){return this.resultNode.priorInput},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"matchSequence",{get:function(){return this.resultNode.calculation.matchSequence},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"matchString",{get:function(){return this.matchSequence.map(function(e){return e.key}).join("")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"knownCost",{get:function(){return this.resultNode.knownCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputSamplingCost",{get:function(){return this.resultNode.inputSamplingCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"totalCost",{get:function(){return this.resultNode.currentCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"finalTraversal",{get:function(){return this.resultNode.currentTraversal},enumerable:!1,configurable:!0}),r}(),ee=function(){function r(e){if(this.tierOrdering=[],this.inputSequence=[],this.minInputCost=[],this.returnedValues={},this.processedEdgeSet={},this.buildQueueSpaceComparator(),e instanceof r){this.inputSequence=[].concat(e.inputSequence),this.minInputCost=[].concat(e.minInputCost),this.rootNode=e.rootNode,this.completedPaths=[].concat(e.completedPaths),this.returnedValues=(0,T.__assign)({},e.returnedValues),this.processedEdgeSet=(0,T.__assign)({},e.processedEdgeSet),this.tierOrdering=e.tierOrdering.map(function(i){return new Le(i)}),this.selectionQueue=new b(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering);return}var t=e;if(t){if(!t.traverseFromRoot)throw"The provided model does not implement the `traverseFromRoot` function, which is needed to support robust correction searching."}else throw"The LexicalModel parameter must not be null / undefined.";this.selectionQueue=new b(this.QUEUE_SPACE_COMPARATOR),this.rootNode=new Ge(t.traverseFromRoot(),t.toKey?t.toKey.bind(t):null),this.completedPaths=[this.rootNode];var n=new Le(0,[this.rootNode]);this.tierOrdering.push(n),this.selectionQueue.enqueue(n)}return r.prototype.buildQueueSpaceComparator=function(){var e=this;this.QUEUE_SPACE_COMPARATOR=function(t,n){var i=t.correctionQueue.peek(),a=n.correctionQueue.peek(),l=t.index,o=n.index,s=0,u=1;if(o<l){var c=o;o=l,l=c,u=-1}for(var f=l;f<o;f++)s=s+e.minInputCost[f];return i&&a?i.currentCost-a.currentCost+u*s:a?1:-1}},r.prototype.increaseMaxEditDistance=function(){this.tierOrdering.forEach(function(e){e.increaseMaxEditDistance()})},r.prototype.addInput=function(e){this.inputSequence.push(e),this.minInputCost.push(-Math.log(e[0].p));var t=[],n=this.completedPaths.map(function(a){var l=a.buildDeletionEdges(e),o=a.buildSubstitutionEdges(e);return l.concat(o)});this.completedPaths=[],this.returnedValues={},n.forEach(function(a){t=t.concat(a)});var i=new Le(this.tierOrdering.length,t);this.tierOrdering.push(i),this.selectionQueue.enqueue(i)},r.prototype.removeLastInput=function(){},r.prototype.hasNextMatchEntry=function(){var e=this.selectionQueue.peek();return e?e.correctionQueue.count>0:!1},r.prototype.handleNextNode=function(){if(!this.hasNextMatchEntry())return{type:"none"};var e=this.selectionQueue.dequeue(),t=e.correctionQueue.dequeue(),n={type:"intermediate",cost:t.currentCost};if(this.processedEdgeSet[t.mapKey])return this.selectionQueue.enqueue(e),n;this.processedEdgeSet[t.mapKey]=!0;var i=!1;if(t.knownCost>2)return n;t.knownCost==2&&(i=!0);for(var a=0,l=0;l<=e.index;l++)a+=this.minInputCost[l];if(t.currentCost>a+2.5*r.EDIT_DISTANCE_COST_SCALE)return n;if(!i){var o=t.buildInsertionEdges();e.correctionQueue.enqueueAll(o)}if(e.index==this.tierOrdering.length-1)return this.completedPaths.push(t),this.selectionQueue.enqueue(e),{type:"complete",cost:t.currentCost,finalNode:t};var s=this.tierOrdering[e.index+1],u=s.index,c=[];i||(c=t.buildDeletionEdges(this.inputSequence[u-1]));var f=t.buildSubstitutionEdges(this.inputSequence[u-1]);return s.correctionQueue.enqueueAll(c.concat(f)),this.selectionQueue=new b(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering),n},r.prototype.getBestMatches=function(e){var t,n,i,a,l,o,s,u,c,f,v,p,d,m,C,x;return(0,T.__generator)(this,function(y){switch(y.label){case 0:if(t=this,n={},e==0?i=1/0:e==null||Number.isNaN(e)?i=r.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL:i=e,a=function(){function S(w,_){this.largestIntervals=[0],this.loopStart=this.start=Date.now(),this.maxExecutionTime=w,this.maxTrueTime=_}return S.prototype.startLoop=function(){this.loopStart=Date.now()},S.prototype.markIteration=function(){var w=Date.now(),_=w-this.loopStart;this.executionTime+=_,_&&_>this.largestIntervals[0]&&(this.largestIntervals.length>2?this.largestIntervals[0]=_:this.largestIntervals.push(_),this.largestIntervals.sort(),this.updateOutliers())},S.prototype.updateOutliers=function(){this.largestIntervals.length>2&&this.largestIntervals[2]>=2*(this.largestIntervals[0]+this.largestIntervals[1])&&(this.executionTime-=this.largestIntervals[2],this.largestIntervals.pop())},S.prototype.shouldTimeout=function(){var w=Date.now();return w-this.start>this.maxTrueTime?!0:this.executionTime>this.maxExecutionTime},S.prototype.resetOutlierCheck=function(){this.largestIntervals=[]},S}(),l=function(){function S(){this.currentCost=Number.MIN_SAFE_INTEGER,this.entries=[]}return S.prototype.checkAndAdd=function(w){var _=null;w.currentCost>this.currentCost&&(_=this.tryFinalize(),this.currentCost=w.currentCost);var I=w.calculation.matchSequence.map(function(Y){return Y.key}).join("");return t.returnedValues[I]||(t.returnedValues[I]=w),n[I]||(this.entries.push(new He(w)),n[I]=w),_},S.prototype.tryFinalize=function(){var w=null;return this.entries.length>0&&(w=this.entries,this.entries=[]),w},S}(),o=new l,s=new a(i*1.5,i),u=Object.values(this.returnedValues),!(u.length>0))return[3,6];c=new b(Se,u),s.startLoop(),y.label=1;case 1:return c.count>0?(f=c.dequeue(),f.isFullReplacement?[3,1]:(v=o.checkAndAdd(f),s.markIteration(),v?[4,v]:[3,3])):[3,4];case 2:y.sent(),y.label=3;case 3:return[3,1];case 4:return p=o.tryFinalize(),p?[4,p]:[3,6];case 5:y.sent(),y.label=6;case 6:s.resetOutlierCheck(),s.startLoop(),d=!1,y.label=7;case 7:m=void 0;do m=this.handleNextNode(),s.markIteration(),s.shouldTimeout()&&(d=!0);while(!d&&m.type=="intermediate");if(C=void 0,m.type=="none")return[3,10];if(m.type=="complete"){if(m.finalNode.isFullReplacement)return[3,10];C=o.checkAndAdd(m.finalNode)}return C?[4,C]:[3,9];case 8:y.sent(),y.label=9;case 9:if(!d&&this.hasNextMatchEntry())return[3,7];y.label=10;case 10:return x=o.tryFinalize(),x?[4,x]:[3,12];case 11:y.sent(),y.label=12;case 12:return[2,null]}})},r.EDIT_DISTANCE_COST_SCALE=5,r.MIN_KEYSTROKE_PROBABILITY=1e-4,r.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL=33,r}(),dt=function(){function r(){}return r.isWhitespace=function(e){var t=/^[\\u0009\\u000A\\u000D\\u0020\\u00a0\\u1680\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u200b\\u2028\\u2029\\u202f\\u205f\\u3000]+$/i;return e.insert.match(t)!=null},r.isBackspace=function(e){return e.insert==""&&e.deleteLeft>0&&!e.deleteRight},r.isEmpty=function(e){return e.insert==""&&e.deleteLeft==0&&!e.deleteRight},r}(),te=dt;function Xe(r,e){for(var t=[],n=0;n<r.kmwLength();n++){var i=r.kmwCharAt(n),a={insert:i,deleteLeft:0,id:e};t.push(a)}return t}var gt=function(){function r(){}return r}(),re=function(){function r(){this.transformDistributions=[],this.activeReplacementId=-1}return Object.defineProperty(r.prototype,"currentText",{get:function(){return this.replacementText===void 0||this.replacementText===null?this.raw:this.replacementText},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"replacement",{get:function(){var e=this.activeReplacementId;return this.replacements.find(function(t){return t.suggestion.id==e})},enumerable:!1,configurable:!0}),r.prototype.revert=function(){delete this.activeReplacementId},r}(),Ce=function(){function r(e){if(this.searchSpace=[],e instanceof r){var t=e;this.tokens=t.tokens.map(function(i){var a=new re;return a.raw=i.raw,a.replacements=[].concat(i.replacements),a.activeReplacementId=i.activeReplacementId,a.transformDistributions=[].concat(i.transformDistributions),i.replacementText&&(a.replacementText=i.replacementText),a}),this.indexOffset=0;var n=this.model=e.model;this.taggedContext=e.taggedContext,n!=null&&n.traverseFromRoot&&(this.searchSpace=e.searchSpace.map(function(i){return new ee(i)}))}else{var n=e;this.tokens=[],this.indexOffset=Number.MIN_SAFE_INTEGER,this.model=n,n&&n.traverseFromRoot&&(this.searchSpace=[new ee(n)])}}return Object.defineProperty(r.prototype,"head",{get:function(){return this.tokens[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tail",{get:function(){return this.tokens[this.tokens.length-1]},enumerable:!1,configurable:!0}),r.prototype.popHead=function(){this.tokens.splice(0,2),this.indexOffset-=1},r.prototype.pushTail=function(e){this.model&&this.model.traverseFromRoot?this.searchSpace=[new ee(this.model)]:this.searchSpace=[],this.tokens.push(e);var t=this;t.searchSpace.length>0&&e.transformDistributions.forEach(function(n){return t.searchSpace[0].addInput(n)})},r.prototype.pushWhitespaceToTail=function(e){e===void 0&&(e=null);var t=new re;t.transformDistributions=e?[e]:[],t.raw=null,this.tokens.push(t)},r.prototype.replaceTailForBackspace=function(e,t){this.tokens.pop();var n=Xe(e,t).map(function(a){return[{sample:a,p:1}]}),i=new re;i.raw=e,i.transformDistributions=n,this.pushTail(i)},r.prototype.updateTail=function(e,t){var n=this.tail;t=t||(t===""?"":n.raw),e&&e.length>0&&(n.transformDistributions.push(e),this.searchSpace&&this.searchSpace.forEach(function(i){return i.addInput(e)})),n.raw=t},r.prototype.toRawTokenization=function(){var e,t,n=[];try{for(var i=(0,T.__values)(this.tokens),a=i.next();!a.done;a=i.next()){var l=a.value;l.currentText!==null&&n.push(l.currentText)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r}(),yt=function(){function r(e){e===void 0&&(e=r.DEFAULT_ARRAY_SIZE),this.currentHead=0,this.currentTail=0,this.circle=Array(e)}return Object.defineProperty(r.prototype,"count",{get:function(){var e=this.currentHead-this.currentTail;return e<0&&(e=e+this.circle.length),e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxCount",{get:function(){return this.circle.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"oldest",{get:function(){if(this.count!=0)return this.item(0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"newest",{get:function(){if(this.count!=0)return this.item(this.count-1)},enumerable:!1,configurable:!0}),r.prototype.enqueue=function(e){var t=null,n=(this.currentHead+1)%this.maxCount;return n==this.currentTail&&(t=this.circle[this.currentTail],this.currentTail=(this.currentTail+1)%this.maxCount),this.circle[this.currentHead]=e,this.currentHead=n,t},r.prototype.dequeue=function(){if(this.currentTail==this.currentHead)return null;var e=this.circle[this.currentTail];return this.currentTail=(this.currentTail+1)%this.maxCount,e},r.prototype.popNewest=function(){if(this.currentTail==this.currentHead)return null;var e=this.circle[this.currentHead];return this.currentHead=(this.currentHead-1+this.maxCount)%this.maxCount,e},r.prototype.item=function(e){if(e>=this.count)throw"Invalid array index";var t=(this.currentTail+e)%this.maxCount;return this.circle[t]},r.DEFAULT_ARRAY_SIZE=5,r}(),ze=function(r){(0,T.__extends)(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.attemptMatchContext=function(t,n,i){var a=n.toRawTokenization(),l=Ne.computeDistance(a.map(function(I){return{key:I}}),t.map(function(I){return{key:I}}),1),o=l.editPath(),s=!1,u=!1;if(o.length>1){if(o[0]=="insert"&&!(o[1]=="substitute"&&o.length==2)||o[0].indexOf("transpose")>=0)return null;o[0]=="delete"&&(s=!0)}var c=o.length-1,f=!1;if(o[c]=="delete"||o[0].indexOf("transpose")>=0||(o[c]=="insert"?u=!0:c>0&&o[c-1]=="insert"&&o[c]=="substitute"&&(u=!0,f=!0),c>0&&o[c-1]=="delete"&&o[c]=="substitute"))return null;for(var v=1;v<o.length-(f?2:1);v++)if(o[v]!="match")return null;var p;u?(f&&(n.tail.replacementText=t[t.length-2]),p=new Ce(n)):p=i?new Ce(n):n;var d=i&&Array.isArray(i),m=d?i[0].sample:null;m&&m.insert==""&&m.deleteLeft==0&&!m.deleteRight&&(m=null);var C=m&&te.isWhitespace(m),x=m&&te.isBackspace(m),y=t[t.length-1];if(o.length>1)if(s&&p.popHead(),u){var S=t[t.length-1],w=new re;w.raw=S,C||!m?(p.pushWhitespaceToTail(i!=null?i:[]),w.transformDistributions=[]):(p.pushWhitespaceToTail(),w.transformDistributions=i?[i]:[]),p.pushTail(w)}else x?p.replaceTailForBackspace(y,m.id):p.updateTail(m?i:null,y);else if(o[c]=="insert"){var _=new re;_.raw=t[0],_.transformDistributions=[i],p.pushTail(_)}else x?p.replaceTailForBackspace(y,m.id):p.updateTail(m?i:null,y);return p},e.modelContextState=function(t,n,i){var a=t.map(function(s){var u=new re;return u.raw=s,u.raw?u.transformDistributions=Xe(u.raw).map(function(c){return[{sample:c,p:1}]}):u.transformDistributions=[],u}),l=new Ce(i);for(a.length>0&&l.pushTail(a.splice(0,1)[0]);a.length>0;)l.pushWhitespaceToTail(),l.pushTail(a.splice(0,1)[0]);if(l.tokens.length==0){var o=new re;o.raw="",l.pushTail(o)}return l},e.prototype.analyzeState=function(t,n,i){if(!t.traverseFromRoot)throw"This lexical model does not provide adequate data for correction algorithms and context reuse";var a=z(t.wordbreaker||ce,n);if(a.left.length>0)for(var l=this.count-1;l>=0;l--){var o=this.item(l),s=o.taggedContext;if(s&&i&&i.length>0){var u=H(i[0].sample,s);if(u.left!=n.left)continue}else if((s==null?void 0:s.left)!=n.left)continue;var c=e.attemptMatchContext(a.left,this.item(l),i);if(c)return this.newest!=c&&this.newest!=o&&this.enqueue(o),c.taggedContext=n,c!=this.item(l)&&this.enqueue(c),c}var f=e.modelContextState(a.left,i,t);return f.taggedContext=n,this.enqueue(f),f},e.prototype.clearCache=function(){for(;this.count>0;)this.dequeue()},e}(yt),mt=function(){function r(e,t){this.SUGGESTION_ID_SEED=0,this.testMode=!1,this.lexicalModel=e,e.traverseFromRoot&&(this.contextTracker=new ze),this.punctuation=r.determinePunctuationFromModel(e),this.testMode=!!t}return r.prototype.predictFromCorrections=function(e,t){var n,i,a=[],l=function(f){var v=o.lexicalModel.predict(f.sample,t),p=v.map(function(d){var m=f.sample,C=f.p;m.id!==void 0&&(d.sample.transformId=m.id);var x={sample:d.sample,p:d.p*C};return x},o);a=a.concat(p)},o=this;try{for(var s=(0,T.__values)(e),u=s.next();!u.done;u=s.next()){var c=u.value;l(c)}}catch(f){n={error:f}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return a},r.prototype.predict=function(e,t){var n,i,a,l,o=[],s=this.lexicalModel,u=this.punctuation;e instanceof Array?e.length==0&&e.push({sample:{insert:"",deleteLeft:0},p:1}):e=[{sample:e,p:1}];var c=e.sort(function(O,j){return j.p-O.p})[0].sample,f=te.isWhitespace(c),v=te.isBackspace(c),p=H(c,t),d=this.wordbreak(p),m=null,C=[],x,y=null;if(this.contextTracker){var w=this.contextTracker.analyzeState(this.lexicalModel,t,null);y=this.contextTracker.analyzeState(this.lexicalModel,p,te.isEmpty(c)?null:e);var _=y.searchSpace[0],I=0,Y=y.tokens,ne=Y.length,Z=Y.length-w.tokens.length;ne==0||Z>0?(I=0,te.isWhitespace(c)&&(x=c,t=p,w=y)):Z<0?I=this.wordbreak(p).kmwLength()+c.deleteLeft:I=this.wordbreak(t).kmwLength();var be=Y[Y.length-1],ke=be.transformDistributions.length<=1,ie=void 0,_e=this.testMode?0:ee.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL;try{for(var ae=(0,T.__values)(_.getBestMatches(_e)),K=ae.next();!K.done;K=ae.next()){var ve=K.value,S=ve.map(function(j){var fe=j.matchString,Te;j.inputSequence.length>0?Te=j.inputSequence[j.inputSequence.length-1].sample:Te=c;var Tt={insert:fe,deleteLeft:I,id:c.id},$e=j.totalCost;return ke&&($e*=r.SINGLE_CHAR_KEY_PROB_EXPONENT),{sample:Tt,p:Math.exp(-$e)}},this),W=this.predictFromCorrections(S,t);W.length>0&&ie===void 0&&(ie=-Math.log(S[0].p)),C=C.concat(W);var oe=ve[0].totalCost;if(oe>=ie+8)break;if(C.length>=r.MAX_SUGGESTIONS){if(oe>=ie+4)break;if(C.sort(function(j,fe){return fe.p-j.p}),C[r.MAX_SUGGESTIONS-1].p>Math.exp(-oe))break}}}catch(O){n={error:O}}finally{try{K&&!K.done&&(i=ae.return)&&i.call(ae)}finally{if(n)throw n.error}}}else{var S=void 0;f?(S=[{sample:c,p:1}],x=c):S=e.map(function(O){var j=O.sample;return te.isWhitespace(j)&&!f||te.isBackspace(j)&&!v?null:O}),S=S.filter(function(O){return!!O}),C=this.predictFromCorrections(S,t)}var ue={},se=null;s.languageUsesCasing&&(se=this.detectCurrentCasing(p));var bt=this.wordbreak(t);try{for(var xe=(0,T.__values)(C),de=xe.next();!de.done;de=xe.next()){var V=de.value,ge=V.sample.displayAs,Re=ge==d;if(this.lexicalModel.languageUsesCasing&&(Re=Re||ge==this.lexicalModel.applyCasing("lower",d)),Re)if(m)m.p&&V.p&&(m.p+=V.p);else{var Fe=V.sample.transform,De={insert:d,deleteLeft:Fe.deleteLeft,deleteRight:Fe.deleteRight,id:Fe.id},kt=h(De,V.p);m=this.toAnnotatedSuggestion(kt,"keep",U.noQuotes),m.matchesModel=!0,m.transformId=V.sample.transformId}else{se&&se!="lower"&&(this.applySuggestionCasing(V.sample,bt,se),ge=V.sample.displayAs);var Ze=ue[ge];Ze?Ze.p+=V.p:ue[ge]=V}}}catch(O){a={error:O}}finally{try{de&&!de.done&&(l=xe.return)&&l.call(xe)}finally{if(a)throw a.error}}if(!m&&d!=""){var De=(0,T.__assign)({},c),Je=h(De,1);Je.displayAs=d,m=this.toAnnotatedSuggestion(Je,"keep"),m.matchesModel=!1}for(var _t in ue){var xt=ue[_t];o.push(xt)}o=o.sort(function(O,j){return j.p-O.p});var ye=o.splice(0,r.MAX_SUGGESTIONS).map(function(O){return O.sample.p&&(O.sample["lexical-p"]=O.sample.p,O.sample["correction-p"]=O.p/O.sample.p,O.sample.p=O.p),O.sample});m&&(ye=[m].concat(ye));var je=this;return ye.forEach(function(O){if(!t.right)O.transform.insert+=u.insertAfterWord;else{var j=je.tokenize(t);j&&j.caretSplitsToken&&(O.transform.insert+=u.insertAfterWord)}if(x){var fe=le(x,O.transform);fe.id=O.transformId;var Te=O;Te.transform=fe}O.id=je.SUGGESTION_ID_SEED,je.SUGGESTION_ID_SEED++}),y&&(y.tail.replacements=ye.map(function(O){return{suggestion:O,tokenWidth:1}})),ye},r.prototype.applySuggestionCasing=function(e,t,n){var i=t.kmwLength()-e.transform.deleteLeft;i>0&&(e.transform.deleteLeft+=i,e.transform.insert=t.kmwSubstr(0,i)+e.transform.insert),e.transform.insert=this.lexicalModel.applyCasing(n,e.transform.insert),e.displayAs=this.lexicalModel.applyCasing(n,e.displayAs)},r.prototype.toAnnotatedSuggestion=function(e,t,n){n===void 0&&(n=U.default);var i=U,a=i.noQuotes;return(t=="keep"||t=="revert")&&(a=i.useQuotes),{transform:e.transform,transformId:e.transformId,displayAs:i.apply(n,e.displayAs,this.punctuation,a),tag:t,p:e.p}},r.determinePunctuationFromModel=function(e){var t=St;if(!e.punctuation)return t;var n=e.punctuation,i=n.insertAfterWord;i!==""&&!i&&(i=t.insertAfterWord);var a=n.quotesForKeepSuggestion;a||(a=t.quotesForKeepSuggestion);var l=n.isRTL;return{insertAfterWord:i,quotesForKeepSuggestion:a,isRTL:l}},r.prototype.acceptSuggestion=function(e,t,n){var i=e.transform,a=t.left.kmwSubstr(-i.deleteLeft,i.deleteLeft),l=i.insert.kmwLength(),o={insert:a,deleteLeft:l},s=t;n&&(o=le(o,n),s=H(n,s));var u,c=this.tokenize(s);c?(c.left.length>0?u=c.left[c.left.length-1]:u="",u+=c.caretSplitsToken?c.right[0]:""):u=this.wordbreak(s);var f=h(o);f.displayAs=u;var v=this.toAnnotatedSuggestion(f,"revert");if(e.transformId!=null&&(v.transformId=-e.transformId),e.id!=null?v.id=-e.id:(v.id=-this.SUGGESTION_ID_SEED,this.SUGGESTION_ID_SEED++),this.contextTracker){var p=this.contextTracker.newest;p||(p=this.contextTracker.analyzeState(this.lexicalModel,t)),p.tail.activeReplacementId=e.id;var d=H(e.transform,t);this.contextTracker.analyzeState(this.lexicalModel,d)}return v},r.prototype.applyReversion=function(e,t){var n=this,i=function(){var u=H(e.transform,t),c=n.predict({insert:"",deleteLeft:0},u);return c.forEach(function(f){f.transformId=-e.transformId}),c};if(!this.contextTracker)return i();for(var a=!1,l=this.contextTracker.count-1;l>=0;l--){var o=this.contextTracker.item(l);if(o.tail.activeReplacementId==-e.id){a=!0;break}}if(!a)return i();for(;this.contextTracker.newest.tail.activeReplacementId!=-e.id;)this.contextTracker.popNewest();this.contextTracker.newest.tail.revert();var s=this.contextTracker.newest.tail.replacements.map(function(u){return u.suggestion});return s.forEach(function(u){u.transformId=-e.transformId}),s},r.prototype.wordbreak=function(e){var t=this.lexicalModel;if(t.wordbreaker||!t.wordbreak){var n=t.wordbreaker||ce;return Ae(n,e)}else return t.wordbreak(e)},r.prototype.tokenize=function(e){var t=this.lexicalModel;return t.wordbreaker?z(t.wordbreaker,e):null},r.prototype.resetContext=function(e){this.contextTracker&&(this.contextTracker.clearCache(),this.contextTracker.analyzeState(this.lexicalModel,e,null))},r.prototype.detectCurrentCasing=function(e){var t,n=this.lexicalModel,i=this.wordbreak(e);if(!n.languageUsesCasing)throw"Invalid attempt to detect casing: languageUsesCasing is set to false";if(!n.applyCasing)throw"Invalid LMLayer state:  languageUsesCasing is set to true, but no applyCasing function exists";return e.casingForm=="upper"||e.casingForm=="initial"?e.casingForm:n.applyCasing("lower",i)==i?"lower":n.applyCasing("upper",i)==i?i.kmwLength()>1?"upper":"initial":n.applyCasing("initial",i)==i?"initial":(t=e.casingForm)!==null&&t!==void 0?t:null},r.MAX_SUGGESTIONS=12,r.SINGLE_CHAR_KEY_PROB_EXPONENT=16,r}(),wt=mt,St={quotesForKeepSuggestion:{open:"\\u201C",close:"\\u201D"},insertAfterWord:" "};B();var Ct=function(){function r(e){e===void 0&&(e={importScripts:null,postMessage:null}),this._testMode=!1,this._postMessage=e.postMessage||postMessage,this._importScripts=e.importScripts||importScripts,this.setupConfigState()}return r.prototype.error=function(e,t){this.cast("error",{log:e,error:t&&t.stack?t.stack:void 0})},r.prototype.onMessage=function(e){var t=e.data.message;if(!t)throw new Error("Missing required \'message\' property: ".concat(e.data));var n=e.data;if(n.message=="load"){var i=n,a=!1;if(this._currentModelSource&&i.source.type==this._currentModelSource.type&&(i.source.type=="file"&&i.source.file==this._currentModelSource.file||i.source.type=="raw"&&i.source.code==this._currentModelSource.code)&&(a=!0),a){typeof console!="undefined"&&console.warn("Duplicate model load message detected - squashing!");return}else this._currentModelSource=i.source}else n.message=="unload"&&(this._currentModelSource=null);this.state.handleMessage(n)},r.prototype.cast=function(e,t){var n=this._postMessage;n((0,T.__assign)({message:e},t))},r.prototype.loadModel=function(e){try{var t=e.configure(this._platformCapabilities);t.leftContextCodePoints||(t.leftContextCodePoints=t.leftContextCodeUnits),t.rightContextCodePoints||(t.rightContextCodePoints=t.rightContextCodeUnits),t.leftContextCodePoints||(t.leftContextCodePoints=this._platformCapabilities.maxLeftContextCodePoints),t.rightContextCodePoints||(t.rightContextCodePoints=this._platformCapabilities.maxRightContextCodePoints||0),e.languageUsesCasing&&!e.applyCasing&&(e.applyCasing=g);var n=this.transitionToReadyState(e);t.wordbreaksAfterSuggestions===void 0&&(t.wordbreaksAfterSuggestions=n.punctuation.insertAfterWord!=""),this.cast("ready",{configuration:t})}catch(i){this.error("loadModel failed!",i)}},r.prototype.loadModelFile=function(e){try{this._importScripts(e)}catch(t){this.error("Error occurred when attempting to load dictionary",t)}},r.prototype.unloadModel=function(){this.transitionToLoadingState()},r.prototype.setupConfigState=function(){var e=this;this.state={name:"unconfigured",handleMessage:function(t){if(t.message!=="config")throw new Error("invalid message; expected \'config\' but got ".concat(t.message));e._platformCapabilities=t.capabilities,e._testMode=!!t.testMode,e.transitionToLoadingState()}}},r.prototype.transitionToLoadingState=function(){var e=this;this.state={name:"modelless",handleMessage:function(t){if(t.message!=="load")throw new Error("invalid message; expected \'load\' but got ".concat(t.message));if(t.source.type=="file")e.loadModelFile(t.source.file);else{var n=t.source.code,i=new Function("LMLayerWorker","models","correction","wordBreakers",n);i(e,G,qe,Pe)}}}},r.prototype.transitionToReadyState=function(e){var t=this,n=new wt(e,this._testMode);return this.state={name:"ready",handleMessage:function(i){switch(i.message){case"predict":var a=i.transform,f=i.context,c=n.predict(a,f);t.cast("suggestions",{token:i.token,suggestions:c});break;case"wordbreak":var l=Ae(e.wordbreaker||ce,i.context);t.cast("currentword",{token:i.token,word:l});break;case"unload":t.unloadModel();break;case"accept":var o=i.suggestion,f=i.context,s=i.postTransform,u=n.acceptSuggestion(o,f,s);t.cast("postaccept",{token:i.token,reversion:u});break;case"revert":var u=i.reversion,f=i.context,c=n.applyReversion(u,f);t.cast("postrevert",{token:i.token,suggestions:c});break;case"reset-context":var f=i.context;n.resetContext(f);break;default:throw new Error("invalid message; expected one of {\'predict\', \'wordbreak\', \'accept\', \'revert\', \'reset-context\', \'unload\'} but got ".concat(i.message))}},compositor:n},n},r.install=function(e){var t=new r({postMessage:e.postMessage,importScripts:e.importScripts.bind(e)});return e.onmessage=t.onMessage.bind(t),t.self=e,e.LMLayerWorker=t,e.models=G,e.correction=qe,e.wordBreakers=Pe,t},r}(),Ye=Ct;typeof self!="undefined"&&"postMessage"in self&&"importScripts"in self?Ye.install(self):window.LMLayerWorker=Ye}();\n',li="";var Yr=function(){function i(){}return i.constructInstance=function(){return new Worker(this.asBlobURI(ii))},i.asBlobURI=function(t){var e=Tt(t);e+="\n"+li;var n=new Blob([e],{type:"text/javascript"});return URL.createObjectURL(n)},i}(),Hn=Yr;var ri=function(){function i(t,e){this.suggestions=t,this.transcriptionID=e}return i}();var wr=function(i){(0,d.__extends)(t,i);function t(e,n,c){c===void 0&&(c=!1);var l=i.call(this)||this;l._mayPredict=!0,l._mayCorrect=!0,l._state="inactive",l.recentTranscriptions=n;var r={maxLeftContextCodePoints:64,maxRightContextCodePoints:c?0:64};return e&&(l.lmEngine=new An(r,e)),l}return Object.defineProperty(t.prototype,"activeModel",{get:function(){return this.currentModel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isConfigured",{get:function(){return!!this.configuration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype.unloadModel=function(){this.lmEngine.unloadModel(),delete this.currentModel,delete this.configuration,this._state="inactive",this.emit("statechange","inactive")},t.prototype.loadModel=function(e){var n=this;if(!e)throw new Error("Null reference not allowed.");var c=e.path?"file":"raw",l=c=="file"?e.path:e.code;return this.currentModel=e,this.mayPredict&&(this._state="active",this.emit("statechange","active")),this.lmEngine.loadModel(l,c).then(function(r){n.configuration=r,n.mayPredict&&(n._state="configured",n.emit("statechange","configured"))}).catch(function(r){var s;r instanceof Error?s=r.message:s=String(r),console.error("Could not load model '"+e.id+"': "+s),n.currentModel=null,n._state="inactive",n.emit("statechange","inactive")})},t.prototype.invalidateContext=function(e,n){if(this.emit("invalidatesuggestions","context"),!this.currentModel||!this.configuration)return Promise.resolve([]);if(this.isActive){if(e){var c=e.buildTranscriptionFrom(e,null,!1);return this.predict_internal(c,!0,n)}}else return Promise.resolve([])},t.prototype.wordbreak=function(e,n){if(!this.isActive)return null;var c=new Ge(D.from(e,!1),this.configuration,n);return this.lmEngine.wordbreak(c)},t.prototype.predict=function(e,n){return!this.isActive||!this.currentModel||!this.configuration?null:(this.emit("invalidatesuggestions","new"),this.predict_internal(e,!1,n))},t.prototype.applySuggestion=function(e,n,c){var l=this;if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";var r=this.getPredictionState(e.transformId);if(r){var s=D.from(r.preInput,!1);s.apply(e.transform);var o=s.buildTransformFrom(n);n.apply(o),this.emit("suggestionapplied",n);var a=D.from(r.preInput,!1);a.apply(r.transform);var B=new Ge(r.preInput,this.configuration,c()),g=this.lmEngine.acceptSuggestion(e,B,r.transform);return g=g.then(function(F){var u={transform:r.transform,transformId:-r.token,displayAs:F.displayAs,id:F.id,tag:F.tag};return l.predictFromTarget(n,c()),u}),g}else return console.warn("Could not apply the Suggestion!"),null},t.prototype.applyReversion=function(e,n){var c=this;if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";var l=this.getPredictionState(-e.transformId);if(!l){console.warn("Could not apply the Suggestion!");return}var r=D.from(l.preInput,!1);r.apply(e.transform);var s=r.buildTransformFrom(n);n.apply(s);var o=this.lmEngine.revertSuggestion(e,new Ge(l.preInput,this.configuration,null));return o.then(function(a){var B=new ri(a,s.id);return c.emit("suggestionsready",B),c.currentPromise=null,a})},t.prototype.predictFromTarget=function(e,n){if(!e)return null;var c=e.buildTranscriptionFrom(e,null,!1);return this.predict(c,n)},t.prototype.predict_internal=function(e,n,c){var l=this;if(!e)return null;var r=new Ge(e.preInput,this.configuration,c);this.recordTranscription(e),n&&this.lmEngine.resetContext(r);var s=e.alternates;(!s||s.length==0)&&(s=[{sample:e.transform,p:1}]);var o=e.transform,a=this.currentPromise=this.lmEngine.predict(s,r);return a.then(function(B){if(a==l.currentPromise){var g=new ri(B,o.id);l.emit("suggestionsready",g),l.currentPromise=null}return B})},t.prototype.recordTranscription=function(e){this.recentTranscriptions.save(e)},t.prototype.getPredictionState=function(e){return this.recentTranscriptions.get(e)},t.prototype.shutdown=function(){this.lmEngine.shutdown()},Object.defineProperty(t.prototype,"isActive",{get:function(){return this.canEnable()?(this.activeModel||!1)&&this._mayPredict:(this._mayPredict=!1,!1)},enumerable:!1,configurable:!0}),t.prototype.canEnable=function(){return!!this.lmEngine},Object.defineProperty(t.prototype,"mayPredict",{get:function(){return this._mayPredict},set:function(e){if(!!this.canEnable()){var n=this._mayPredict;if(this._mayPredict=e,n!=e&&this.activeModel){var c=e?"active":"inactive";this._state=c,this.emit("statechange",c),e&&this.isConfigured&&(this._state="configured",this.emit("statechange","configured"))}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mayCorrect",{get:function(){return this._mayCorrect},set:function(e){this._mayCorrect=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordbreaksAfterSuggestions",{get:function(){return this.configuration.wordbreaksAfterSuggestions},enumerable:!1,configurable:!0}),t.prototype.tryAcceptSuggestion=function(e){return this.emit("tryaccept",e),!1},t.prototype.tryRevertSuggestion=function(){return this.emit("tryrevert"),!1},t}(si.default),Wn=wr;var Or=10,Nn=function(){function i(){this.map=new Map}return i.prototype.get=function(t){var e=this.map.get(t);return e&&this.save(e),e},i.prototype.save=function(t){var e=t.token>=0?t.token:-t.token;this.map.delete(e),this.map.set(e,t),this.map.size>Or&&this.map.delete(this.map.keys().next().value)},i}();var Mr=function(){function i(t,e,n){if(this.contextCache=new Nn,!t)throw new Error("device must be defined");n||(n=i.DEFAULT_OPTIONS),this.contextDevice=t,this.kbdProcessor=new Qn(t,n),this.lngProcessor=new Wn(e,this.contextCache)}return Object.defineProperty(i.prototype,"languageProcessor",{get:function(){return this.lngProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keyboardProcessor",{get:function(){return this.kbdProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keyboardInterface",{get:function(){return this.keyboardProcessor.keyboardInterface},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeKeyboard",{get:function(){return this.keyboardInterface.activeKeyboard},set:function(t){this.keyboardInterface.activeKeyboard=t,this.resetContext()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeModel",{get:function(){return this.languageProcessor.activeModel},enumerable:!1,configurable:!0}),i.prototype.processKeyEvent=function(t,e){var n=t.srcKeyboard&&this.activeKeyboard!=t.srcKeyboard,c=this.activeKeyboard;try{if(n&&(this.keyboardInterface.activeKeyboard=t.srcKeyboard),t.baseTranscriptionToken){var l=this.contextCache.get(t.baseTranscriptionToken);l?e.restoreTo(l.preInput):console.warn("The base context for the multitap could not be found")}return this._processKeyEvent(t,e)}finally{n&&(this.keyboardInterface.activeKeyboard=c)}},i.prototype._processKeyEvent=function(t,e){var n,c=t.device.formFactor,l=t.isSynthetic;if((c==V.FormFactor.Desktop||!this.activeKeyboard||this.activeKeyboard.usesDesktopLayoutOnDevice(t.device))&&l&&this.keyboardProcessor.selectLayer(t))return new de;if(this.keyboardProcessor.doModifierPress(t,e,!l)&&!l)return new de;if(this.languageProcessor.isActive){if((t.kName=="K_BKSP"||t.Lcode==U.keyCodes.K_BKSP)&&this.languageProcessor.tryRevertSuggestion())return new de;if((t.kName=="K_SPACE"||t.Lcode==U.keyCodes.K_SPACE)&&this.languageProcessor.tryAcceptSuggestion("space"))return new de}var r=D.from(e,!0),s=this.keyboardProcessor.layerId,o=this.keyboardProcessor.processKeystroke(t,e);t.kNextLayer&&this.keyboardProcessor.selectLayer(t);var a=U.isKnownOSKModifierKey(t.kName);_e((n=o==null?void 0:o.transcription)===null||n===void 0?void 0:n.transform)&&t.kNextLayer&&(a=!0);var B=o!=null;if(B){var g=a?null:this.buildAlternates(o,t,r);o.finalize(this.keyboardProcessor,e,!1),g&&g.length>0&&(o.transcription.alternates=g)}else o=new de,o.transcription=e.buildTranscriptionFrom(e,null,!1),o.triggersDefaultCommand=!0;this.contextCache.save(o.transcription);var F=o.setStore[w.TSS_LAYER]||t.kNextLayer;this.keyboardProcessor.newLayerStore.set(F?this.keyboardProcessor.layerId:""),this.keyboardProcessor.oldLayerStore.set(F?s:"");var u=this.keyboardProcessor.processPostKeystroke(this.contextDevice,e);return u&&u.finalize(this.keyboardProcessor,e,!0),o.predictionPromise=this.languageProcessor.predict(o.transcription,this.keyboardProcessor.layerId),o.triggersDefaultCommand||e.doInputEvent(),B?o:null},i.prototype.buildAlternates=function(t,e,n){var c,l,r;if(this.languageProcessor.isActive&&!t.triggersDefaultCommand){var s=e.keyDistribution,o=new Ge(n,Ge.ENGINE_RULE_WINDOW,this.keyboardProcessor.layerId),a=o.toMock();if(this.languageProcessor.isActive&&s&&e.kbdLayer){var B=Number.MAX_VALUE,g=ze(),F=void 0;g.performance&&g.performance.now&&(F=function(){return g.performance.now()},B=F()+16);var u=Math.exp(-5);s.sort(function(m,p){return p.p-m.p}),r=[];var I=0;try{for(var y=(0,d.__values)(s),Q=y.next();!Q.done;Q=y.next()){var h=Q.value;if(h.p<u){I+=h.p;break}else if(F&&F()>=B)break;var C=D.from(a,!1),b=h.keySpec;if(!b){console.warn("Internal error:  failed to properly filter set of keys for corrections");continue}var x=this.keyboardProcessor.activeKeyboard.constructKeyEvent(b,e.device,this.keyboardProcessor.stateKeys),G=this.keyboardProcessor.processKeystroke(x,C);if(G&&!G.beep&&h.p>0){var X=G.transcription.transform;X.id=t.transcription.token,r.push({sample:X,p:h.p}),I+=h.p}}}catch(m){c={error:m}}finally{try{Q&&!Q.done&&(l=y.return)&&l.call(y)}finally{if(c)throw c.error}}r.forEach(function(m){m.p/=I})}}return r},i.prototype.resetContext=function(t){this.keyboardProcessor.resetContext(t),this.languageProcessor.invalidateContext(t,this.keyboardProcessor.layerId)},i.DEFAULT_OPTIONS={baseLayout:"us"},i}(),Tn=Mr;var oi=R(H(),1),Dr=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this)||this;c.initNewContext=!0,c._currentSuggestions=[],c.recentAccept=!1,c.swallowPrediction=!1,c.doRevert=!1,c.recentRevert=!1,c.doTryAccept=function(r){!c.recentAccept&&c.selected?c.accept(c.selected):c.recentAccept&&r=="space"&&(c.recentAccept=!1)},c.doTryRevert=function(){c.doRevert?(c.doRevert=!1,c.recentAccept=!1):c.recentAccept&&(c.showRevert(),c.swallowPrediction=!0)},c.invalidateSuggestions=function(r){c.initNewContext=!1,(!c.swallowPrediction||r=="context")&&(c.recentAccept=!1,c.doRevert=!1,c.recentRevert=!1,r=="context"&&(c.swallowPrediction=!1,c.initNewContext=!0)),r!="new"&&c.clearSuggestions()},c.updateSuggestions=function(r){var s,o,a=r.suggestions;c._currentSuggestions=a,c.keepSuggestion=null;try{for(var B=(0,d.__values)(a),g=B.next();!g.done;g=B.next()){var F=g.value;F.tag=="keep"&&(c.keepSuggestion=F)}}catch(u){s={error:u}}finally{try{g&&!g.done&&(o=B.return)&&o.call(B)}finally{if(s)throw s.error}}c.keepSuggestion&&c._currentSuggestions.splice(c._currentSuggestions.indexOf(c.keepSuggestion),1),c.swallowPrediction?c.swallowPrediction=!1:(c.recentAccept=!1,c.doRevert=!1,c.recentRevert=!1),c.sendUpdateEvent()},c.onModelStateChange=function(r){(r=="configured"||r=="inactive")&&c.resetContext()},c.langProcessor=e,c.kbdProcessor=n;var l=function(){return c.currentTarget&&e.state=="configured"};return c.suggestionApplier=function(r){if(l())return e.applySuggestion(r,c.currentTarget,function(){return n.layerId})},c.suggestionReverter=function(r){l()&&e.applyReversion(r,c.currentTarget)},c.postApplicationHandler=function(){var r;n.newLayerStore.set(""),n.oldLayerStore.set(""),(r=n.processPostKeystroke(n.contextDevice,c.currentTarget))===null||r===void 0||r.finalize(n,c.currentTarget,!0)},c.connect(),c}return Object.defineProperty(t.prototype,"currentTarget",{get:function(){return this._currentTarget},enumerable:!1,configurable:!0}),t.prototype.setCurrentTarget=function(e){var n=this._currentTarget;return this._currentTarget=e,n!=e?this.resetContext():Promise.resolve([])},t.prototype.connect=function(){this.langProcessor.addListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.addListener("suggestionsready",this.updateSuggestions),this.langProcessor.addListener("tryaccept",this.doTryAccept),this.langProcessor.addListener("tryrevert",this.doTryRevert),this.langProcessor.addListener("statechange",this.onModelStateChange),this.langProcessor.addListener("suggestionapplied",this.postApplicationHandler)},t.prototype.disconnect=function(){this.langProcessor.removeListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.removeListener("suggestionsready",this.updateSuggestions),this.langProcessor.removeListener("tryaccept",this.doTryAccept),this.langProcessor.removeListener("tryrevert",this.doTryRevert),this.langProcessor.removeListener("statechange",this.onModelStateChange),this.langProcessor.removeListener("suggestionapplied",this.postApplicationHandler),this.clearSuggestions()},Object.defineProperty(t.prototype,"currentSuggestions",{get:function(){var e=[];return this.activateKeep()&&this.keepSuggestion&&this.keepSuggestion.matchesModel?e.push(this.keepSuggestion):this.doRevert&&e.push(this.revertSuggestion),e.concat(this._currentSuggestions)},enumerable:!1,configurable:!0}),t.prototype.acceptInternal=function(e){return e?e.tag=="revert"?(this.suggestionReverter(e),null):this.suggestionApplier(e):null},t.prototype.accept=function(e){var n=this;return this.selected=null,this.doRevert=!1,this.revertAcceptancePromise=this.acceptInternal(e),this.revertAcceptancePromise?(this.revertAcceptancePromise.then(function(c){c&&(n.revertSuggestion=c)}),this.recentAccept=!0,this.recentRevert=!1,this.swallowPrediction=!0,this.revertAcceptancePromise):(e&&e.tag=="revert"&&(this.recentAccept=!1,this.recentRevert=!0),null)},t.prototype.showRevert=function(){this.doRevert=!0,this.sendUpdateEvent()},t.prototype.clearSuggestions=function(){this.updateSuggestions({suggestions:[],transcriptionID:0})},t.prototype.activateKeep=function(){return!this.recentAccept&&!this.recentRevert&&!this.initNewContext},t.prototype.sendUpdateEvent=function(){this.emit("update",this.currentSuggestions)},t.prototype.resetContext=function(){var e=this.currentTarget;return e?this.langProcessor.invalidateContext(e,this.kbdProcessor.layerId):Promise.resolve([])},t}(oi.default),En=Dr;var ai=function(){function i(t,e,n,c){this.Pelem=t,this.Peventname=e.toLowerCase(),this.Phandler=n,this.PuseCapture=c}return i.prototype.equals=function(t){return this.Pelem==t.Pelem&&this.Peventname==t.Peventname&&this.Phandler==t.Phandler&&this.PuseCapture==t.PuseCapture},i}(),me=function(){function i(){this.domEvents=[]}return i.prototype.attachDOMEvent=function(t,e,n,c){this.detachDOMEvent(t,e,n,c),t.addEventListener(e,n,!!c);var l=new ai(t,e,n,c);this.domEvents.push(l)},i.prototype.detachDOMEvent=function(t,e,n,c){t.removeEventListener(e,n,c);for(var l=new ai(t,e,n,c),r=0;r<this.domEvents.length;r++)if(this.domEvents[r].equals(l)){this.domEvents.splice(r,1);break}},i.prototype.shutdown=function(){for(var t=0,e=this.domEvents;t<e.length;t++){var n=e[t];this.detachDOMEvent(n.Pelem,n.Peventname,n.Phandler,n.PuseCapture)}},i}();var kn=R(H(),1),Et=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return e instanceof kn.default?(e.on=n.listenerRegistrationSpy("listeneradded",e,e.on),e.addListener=n.listenerRegistrationSpy("listeneradded",e,e.addListener),e.off=n.listenerRegistrationSpy("listenerremoved",e,e.off),e.removeListener=n.listenerRegistrationSpy("listenerremoved",e,e.off)):(e.addEventListener=n.listenerRegistrationSpy("listeneradded",e,e.addEventListener),e.removeEventListener=n.listenerRegistrationSpy("listenerremoved",e,e.removeEventListener)),n}return t.prototype.listenerRegistrationSpy=function(e,n,c){var l=this;return function(r,s){var o=c.apply(n,[r,s]);return l.emit(e,r),o}},t}(kn.default);var kt=function(){function i(){this.events={},this.currentEvents=[]}return i.prototype.addEventListener=function(t,e){return this._removeEventListener(t,e),this.events[t].push(e),!0},i.prototype.removeEventListener=function(t,e){return this._removeEventListener(t,e)},i.prototype._removeEventListener=function(t,e){typeof this.events[t]=="undefined"&&(this.events[t]=[]);for(var n=0;n<this.events[t].length;n++)if(this.events[t][n]==e)return this.events[t].splice(n,1),!0;return!1},i.prototype.callEvent=function(t,e){if(typeof this.events[t]=="undefined")return!0;if(this.currentEvents.indexOf(t)!=-1)return!1;this.currentEvents.push(t);for(var n=0;n<this.events[t].length;n++){var c=this.events[t][n],l=!1;try{l=c(e)}catch(r){console.error(r),l=!1}if(l===!1)return this.currentEvents.pop(),!1}return this.currentEvents.pop(),!0},i.prototype.listenerCount=function(t){var e=this.events[t];return e?e.length:0},i.prototype.shutdown=function(){this.events={}},i}();var zr=function(){function i(t){t===void 0&&(t=!1),this.fileLocal=t}return i.prototype.request=function(t){var e=new J,n=window.setTimeout(function(){e.reject(new Error(_c))},1e4),c="&timerid="+n,l=t+c,r=document.createElement("script");r.onload=function(s){window.clearTimeout(n),e.isResolved||e.reject(new Error(Pc))},r.onerror=function(s,o,a,B,g){window.clearTimeout(n);var F=Zn;g&&(F=F+": "+g.message),e.reject(new Error(F))},this.fileLocal?r.src=t:r.src=l;try{document.body.appendChild(r)}catch(s){document.getElementsByTagName("head")[0].appendChild(r)}return e.finally(function(){clearTimeout(n)}),{promise:e,queryId:n}},i}(),Bi=zr;function Kr(){return typeof window.KeymanWeb_BaseLayout!="undefined"?window.KeymanWeb_BaseLayout:"us"}var _r=function(){function i(t,e,n,c){var l=this;this.legacyAPIEvents=new kt,this.keyEventListener=function(s,o){var a,B=l.contextManager.activeTarget;if((!l.contextManager.activeKeyboard||!B)&&o&&o(null,null),l.keyEventRefocus&&l.keyEventRefocus(),B.invalidateSelection(),B.deadkeys().deleteMatched(),s.isSynthetic){var g=l.osk.vkbd.layerId;g&&g!=l.core.keyboardProcessor.layerId&&(l.core.keyboardProcessor.layerId=g)}var F=l.core.processKeyEvent(s,B);F&&((a=F.transcription)===null||a===void 0?void 0:a.transform)&&l.config.onRuleFinalization(F,l.contextManager.activeTarget),o&&o(F,null)},this.config=e,this.contextManager=n;var r=c(this);r.baseLayout=Kr(),this.interface=r.keyboardInterface,this.core=new Tn(e.hostDevice,t,r),this.core.languageProcessor.on("statechange",function(s){var o,a;(o=l.osk)===null||o===void 0||o.bannerController.selectBanner(s),(a=l.osk)===null||a===void 0||a.refreshLayout()}),this.core.keyboardProcessor.on("statekeychange",function(s){var o,a;(a=(o=l.osk)===null||o===void 0?void 0:o.vkbd)===null||a===void 0||a.updateStateKeys(s)}),this.contextManager.on("beforekeyboardchange",function(s){l.legacyAPIEvents.callEvent("beforekeyboardchange",{internalName:s==null?void 0:s.id,languageCode:s==null?void 0:s.langId})}),this.contextManager.on("keyboardchange",function(s){var o,a;l.refreshModel(),l.core.activeKeyboard=s==null?void 0:s.keyboard,l.legacyAPIEvents.callEvent("keyboardchange",{internalName:(o=s==null?void 0:s.metadata.id)!==null&&o!==void 0?o:"",languageCode:(a=s==null?void 0:s.metadata.langId)!==null&&a!==void 0?a:""}),s||l.osk.startHide(!1),l.osk&&(l.osk.setNeedsLayout(),l.osk.activeKeyboard=s,l.osk.present())}),this.contextManager.on("keyboardasyncload",function(s){var o,a;l.config.hostDevice.touchable&&((o=l.osk)===null||o===void 0?void 0:o.activationModel)&&(l.osk.activationModel.enabled=!0),(a=l.osk)===null||a===void 0||a.startHide(!1)})}return i.prototype.init=function(t){return(0,d.__awaiter)(this,void 0,void 0,function(){var e,n,c,l=this;return(0,d.__generator)(this,function(r){return e=this.config,e.deferForInitialization.isResolved?[2,Promise.resolve()]:(e.initialize(t),n=new ni(this.interface,e.applyCacheBusting),this.keyboardRequisitioner=new Ln(n,new Bi,this.config.paths),this.modelCache=new Jn,c=this.keyboardRequisitioner.cache,this.contextManager.configure({resetContext:function(s){l.core.resetContext(s)},predictionContext:new En(this.core.languageProcessor,this.core.keyboardProcessor),keyboardCache:this.keyboardRequisitioner.cache}),this.config.on("spacebartext",function(){var s;(s=l.osk)===null||s===void 0||s.refreshLayout()}),c.on("stubadded",function(s){var o=function(){l.legacyAPIEvents.callEvent("keyboardregistered",{internalName:s.KI,language:s.KL,keyboardName:s.KN,languageCode:s.KLC,package:s.KP}),l.config.activateFirstKeyboard&&l.keyboardRequisitioner.cache.defaultStub==s&&l.contextManager.activateKeyboard(s.id,s.langId,!0)};l.config.deferForInitialization.isResolved?o():l.config.deferForInitialization.then(o)}),c.on("keyboardadded",function(s){var o=function(){l.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:s.id})};l.config.deferForInitialization.isResolved?o():l.config.deferForInitialization.then(o)}),this.keyboardRequisitioner.cache.on("keyboardadded",function(s){l.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:s.id})}),[2])})})},Object.defineProperty(i.prototype,"build",{get:function(){return Number.parseInt(ot.VERSION_PATCH,10)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"version",{get:function(){return ot.VERSION_RELEASE},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hardKeyboard",{get:function(){return this._hardKeyboard},set:function(t){this._hardKeyboard&&this._hardKeyboard.off("keyevent",this.keyEventListener),this._hardKeyboard=t,t.on("keyevent",this.keyEventListener)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"osk",{get:function(){return this._osk},set:function(t){this._osk&&(this._osk.off("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=this.osk.layerChangeHandler),this._osk=t,t&&(this.contextManager.activeKeyboard&&(t.activeKeyboard=this.contextManager.activeKeyboard),t.on("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=t.layerChangeHandler)},enumerable:!1,configurable:!0}),i.prototype.getDebugInfo=function(){var t,e,n,c,l,r,s,o,a,B,g,F,u,I,y=(t=this.contextManager)===null||t===void 0?void 0:t.activeKeyboard,Q={configReport:(e=this.config)===null||e===void 0?void 0:e.debugReport(),keyboard:{id:pe((c=(n=y==null?void 0:y.metadata)===null||n===void 0?void 0:n.id)!==null&&c!==void 0?c:""),langId:((l=y==null?void 0:y.metadata)===null||l===void 0?void 0:l.langId)||"",version:(s=(r=y==null?void 0:y.keyboard)===null||r===void 0?void 0:r.version)!==null&&s!==void 0?s:""},model:{id:((a=(o=this.core)===null||o===void 0?void 0:o.activeModel)===null||a===void 0?void 0:a.id)||""},osk:{banner:(F=(g=(B=this.osk)===null||B===void 0?void 0:B.banner)===null||g===void 0?void 0:g.banner.type)!==null&&F!==void 0?F:"",layer:((I=(u=this.osk)===null||u===void 0?void 0:u.vkbd)===null||I===void 0?void 0:I.layerId)||""}};return Q},i.prototype.refreshModel=function(){var t=this.contextManager.activeKeyboard,e=this.modelCache.modelForLanguage(t==null?void 0:t.metadata.langId);return this.core.activeModel!=e&&(this.core.activeModel&&this.core.languageProcessor.unloadModel(),e)?this.core.languageProcessor.loadModel(e).then(function(){return e}):Promise.resolve(e)},i.prototype.addEventListener=function(t,e){this.legacyAPIEvents.addEventListener(t,e)},i.prototype.removeEventListener=function(t,e){this.legacyAPIEvents.removeEventListener(t,e)},i.prototype.shutdown=function(){var t;this.legacyAPIEvents.shutdown(),(t=this.osk)===null||t===void 0||t.shutdown()},i.prototype.addModel=function(t){var e;this.modelCache.register(t);var n=(e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata;return n&&t.languages.indexOf(n.langId)!=-1?this.refreshModel().then(function(){}):Promise.resolve()},i.prototype.removeModel=function(t){this.modelCache.unregister(t),this.core.activeModel&&this.core.activeModel.id==t&&this.core.languageProcessor.unloadModel()},i.prototype.setActiveKeyboard=function(t,e){return(0,d.__awaiter)(this,void 0,void 0,function(){return(0,d.__generator)(this,function(n){return[2,this.contextManager.activateKeyboard(t,e,!0)]})})},i.prototype.getActiveKeyboard=function(){var t,e;return(e=(t=this.contextManager.activeKeyboard)===null||t===void 0?void 0:t.metadata.id)!==null&&e!==void 0?e:""},i.prototype.getActiveLanguage=function(t){var e,n,c,l=(e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata;return t?(c=l==null?void 0:l.langName)!==null&&c!==void 0?c:"":(n=l==null?void 0:l.langId)!==null&&n!==void 0?n:""},i.prototype.isChiral=function(t){var e;if(t){if(typeof t=="string"){var n=this.keyboardRequisitioner.cache.getKeyboard(t);if(n)t=n;else throw new Error("Keyboard '".concat(t,"' has not been loaded."))}e=t}else e=this.core.activeKeyboard;return e.isChiral},i.prototype.resetContext=function(){this.contextManager.resetContext()},i.prototype.setNumericLayer=function(){this.core.keyboardProcessor.setNumericLayer(this.config.softDevice)},i}(),Yn=_r;var hl=R(H(),1);var di=R(H(),1);var ue=function(){function i(t){var e=T("div");e.id=i.BANNER_ID,e.className=i.BANNER_CLASS,this.div=e,this.height=t,this.update()}return Object.defineProperty(i.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t>0?t:0,this.update()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this.update()},enumerable:!1,configurable:!0}),i.prototype.update=function(){var t=this.div.style,e=t.height,n=t.display;return this._height>0?(t.height=this._height+"px",t.display="block"):(t.height="0px",t.display="none"),e!==t.height||n!==t.display},i.prototype.appendStyleSheet=function(){},i.prototype.getDiv=function(){return this.div},i.prototype.configureForKeyboard=function(t,e){},i.DEFAULT_HEIGHT=37,i.BANNER_CLASS="kmw-banner-bar",i.BANNER_ID="kmw-banner-bar",i}();var v=function(){function i(t){var e=typeof t=="string"?i.parseLengthStyle(t):t;this.val=e.val,this.absolute=e.absolute,e.special&&(this.special=e.special)}return Object.defineProperty(i.prototype,"styleString",{get:function(){return this.absolute?this.val+"px":this.special?this.val+this.special:this.val*100+"%"},enumerable:!1,configurable:!0}),i.prototype.scaledBy=function(t){return new i({val:t*this.val,absolute:this.absolute})},i.inPixels=function(t){return new i({val:t,absolute:!0})},i.inPercent=function(t){return new i({val:t/100,absolute:!1})},i.forScalar=function(t){return new i({val:t,absolute:!1})},i.special=function(t,e){return new i({val:t,absolute:!1,special:e})},i.parseLengthStyle=function(t){var e=parseFloat(t);return isNaN(e)?(console.error("Could not properly parse specified length style info: '"+t+"'."),null):t.indexOf("px")!=-1?{val:e,absolute:!0}:t.indexOf("pt")!=-1?{val:4*e/3,absolute:!0}:t.indexOf("%")!=-1?{val:e/100,absolute:!1}:t.indexOf("rem")!=-1?{val:e,absolute:!1,special:"rem"}:t.indexOf("em")!=-1?{val:e,absolute:!1,special:"em"}:{val:4*e/3,absolute:!0}},i}();var Pe=function(i){(0,d.__extends)(t,i);function t(){var e=i.call(this,0)||this;return e.type="blank",e}return t}(ue);var gi=function(){function i(){this._activeBannerHeight=ue.DEFAULT_HEIGHT,this.events=new di.default,this.constructContainer()}return i.prototype.constructContainer=function(){var t=T("div");return t.id="keymanweb_banner_container",t.className="kmw-banner-container",this.bannerContainer=t},Object.defineProperty(i.prototype,"element",{get:function(){return this.bannerContainer},enumerable:!1,configurable:!0}),i.prototype.appendStyles=function(){this.currentBanner&&this.currentBanner.appendStyleSheet()},Object.defineProperty(i.prototype,"banner",{get:function(){return this.currentBanner},set:function(t){if(this.currentBanner){if(t==this.currentBanner)return;var e=this.currentBanner;this.currentBanner=t,this.bannerContainer.replaceChild(t.getDiv(),e.getDiv())}else this.currentBanner=t,t&&this.bannerContainer.appendChild(t.getDiv());t instanceof Pe||(t.height=this.activeBannerHeight),this.events.emit("bannerchange")},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.currentBanner?this.currentBanner.height:0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeBannerHeight",{get:function(){return this._activeBannerHeight},set:function(t){this._activeBannerHeight=t,this.currentBanner&&!(this.currentBanner instanceof Pe)&&(this.currentBanner.height=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"layoutHeight",{get:function(){return v.inPixels(this.height)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){var t;return(t=this.currentBanner)===null||t===void 0?void 0:t.width},set:function(t){this.currentBanner&&(this.currentBanner.width=t)},enumerable:!1,configurable:!0}),i.prototype.refreshLayout=function(){},i}();var Fi=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this;e.length>0?(c=i.call(this)||this,n&&(c.height=n)):c=i.call(this,0)||this,c.type="image",e.indexOf("base64")>=0?console.log("Loading img from base64 data"):console.log("Loading img with src '"+e+"'"),c.img=document.createElement("img"),c.img.setAttribute("src",e);var l=c.img.style;return l.width="100%",l.height="100%",c.getDiv().appendChild(c.img),console.log("Image loaded."),c}return t.prototype.setImagePath=function(e){this.img&&this.img.setAttribute("src",e)},t}(ue);function ui(i){return"targetX"in i&&"targetY"in i&&"t"in i}var Re=function(){function i(t){if(this.rawLinearSums={x:0,y:0,t:0},this.coordArcSum=0,this._sampleCount=0,!!t)if(t instanceof i)Object.assign(this,t),this.rawLinearSums=(0,d.__assign)({},t.rawLinearSums);else if(ui(t))Object.assign(this,this.extend(t));else throw new Error("A constructor for this input pattern has not yet been implemented")}return i.prototype.extend=function(t){return this._extend(new i(this),t)},i.prototype._extend=function(t,e){t._initialSample||(t._initialSample=e,t.baseSample=e);var n=t.baseSample;this.followingSample=e;var c=e.targetX-n.targetX,l=e.targetY-n.targetY,r=e.t-n.t;if(t.rawLinearSums.x+=c,t.rawLinearSums.y+=l,t.rawLinearSums.t+=r,this.lastSample){var s=e.targetX-this.lastSample.targetX,o=e.targetY-this.lastSample.targetY,a=e.t-this.lastSample.t,B=s*s+o*o,g=Math.sqrt(B);t.coordArcSum+=g}return t._lastSample=e,t.sampleCount=this.sampleCount+1,t},i.prototype.deaccumulate=function(t){var e=new i(this);return this._deaccumulate(e,t)},i.prototype._deaccumulate=function(t,e){if(!e)return t;if(!e.followingSample||!e.lastSample)throw"Invalid argument:  stats missing necessary tracking variable.";for(var n in t.rawLinearSums){var c=n;t.rawLinearSums[c]-=e.rawLinearSums[c]}if(e.followingSample&&e.lastSample){var l=e.followingSample.targetX-e.lastSample.targetX,r=e.followingSample.targetY-e.lastSample.targetY,s=e.followingSample.t-e.lastSample.t,o=l*l+r*r,a=Math.sqrt(o);t.coordArcSum-=a,t.coordArcSum-=e.coordArcSum}return t.sampleCount-=e.sampleCount,t._initialSample=e.followingSample,t},i.prototype.translateCoordSystem=function(t){var e=new i(this);return this._translateCoordSystem(e,t)},i.prototype._translateCoordSystem=function(t,e){if(this.sampleCount==0)return t;var n=t.initialSample==t.lastSample;return t._initialSample=e(t.initialSample),t.baseSample=e(t.baseSample),t._lastSample=n?t._initialSample:e(t.lastSample),t},i.prototype.replaceInitialSample=function(t){var e=new i(this);return this._replaceInitialSample(e,t)},i.prototype._replaceInitialSample=function(t,e){if(this.sampleCount==0)throw new Error("no sample available to replace");var n=t.initialSample;if(t._initialSample=e,this.sampleCount>1){var c=e.targetX-n.targetX,l=e.targetY-n.targetY,r=e.t-n.t;t.rawLinearSums.x+=c,t.rawLinearSums.y+=l,t.rawLinearSums.t+=r;var s=c*c+l*l,o=Math.sqrt(s);t.coordArcSum+=o}else t._lastSample=e;return t},Object.defineProperty(i.prototype,"lastSample",{get:function(){return this._lastSample},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lastTimestamp",{get:function(){var t;return(t=this.lastSample)===null||t===void 0?void 0:t.t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sampleCount",{get:function(){return this._sampleCount},set:function(t){this._sampleCount=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"initialSample",{get:function(){return this._initialSample},enumerable:!1,configurable:!0}),i.prototype.mappingConstant=function(t){if(!!this.baseSample)return t=="t"?this.baseSample.t:t=="x"?this.baseSample.targetX:t=="y"?this.baseSample.targetY:0},i.prototype.mean=function(t){return this.rawLinearSums[t]/this.sampleCount+this.mappingConstant(t)},Object.defineProperty(i.prototype,"netDistance",{get:function(){if(!this.lastSample||!this.initialSample)return 0;var t=this.lastSample.targetX-this.initialSample.targetX,e=this.lastSample.targetY-this.initialSample.targetY;return Math.sqrt(t*t+e*e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"duration",{get:function(){return!this.lastSample||!this.initialSample?0:this.lastSample.t-this.initialSample.t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"angle",{get:function(){if(!(this.sampleCount==1||!this.lastSample||!this.initialSample)&&!(this.netDistance<1)){var t=this.lastSample.targetX-this.initialSample.targetX,e=this.lastSample.targetY-this.initialSample.targetY,n=Math.acos(-e/this.netDistance);return t<0?2*Math.PI-n:n}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"angleInDegrees",{get:function(){return this.angle*180/Math.PI},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cardinalDirection",{get:function(){if(!(this.sampleCount==1||!this.lastSample||!this.initialSample)&&!(isNaN(this.angle)||this.angle===null||this.angle===void 0)){var t=["n","ne","e","se","s","sw","w","nw","n"],e=Math.ceil((this.angleInDegrees-22.5)/45);return t[e]}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"speed",{get:function(){return this.duration?this.netDistance/this.duration:0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rawDistance",{get:function(){return this.coordArcSum},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"summaryObject",{get:function(){return{angle:this.angle,cardinal:this.cardinalDirection,netDistance:this.netDistance,duration:this.duration,sampleCount:this.sampleCount,rawDistance:this.rawDistance}},enumerable:!1,configurable:!0}),i}();var yi=function(){function i(){}return i.prototype.getBoundingClientRect=function(){return new DOMRect(0,0,Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0))},i}();var ye=function(){function i(t,e){Array.isArray(t)&&(e=t,t=new yi),this.root=t,e=e||[0,0,0,0],this.updatePadding(e)}return Object.defineProperty(i.prototype,"edgePadding",{get:function(){return this._edgePadding},enumerable:!1,configurable:!0}),i.prototype.updatePadding=function(t){switch(t.length){case 1:var e=t[0];this._edgePadding={x:e,y:e,w:2*e,h:2*e};break;case 2:this._edgePadding={x:t[1],y:t[0],w:2*t[1],h:2*t[0]};break;case 3:this._edgePadding={x:t[1],y:t[0],w:2*t[1],h:t[0]+t[2]};break;case 4:this._edgePadding={x:t[3],y:t[0],w:t[1]+t[3],h:t[0]+t[2]};break;default:throw new Error("Invalid values for PaddedZoneSource's edgePadding - must be between 1 to 4 `number` values.")}},i.prototype.getBoundingClientRect=function(){var t=this.root.getBoundingClientRect();return new DOMRect(t.left+this.edgePadding.x,t.top+this.edgePadding.y,t.width-this.edgePadding.w,t.height-this.edgePadding.h)},i}();function Yt(i){var t,e,n,c,l,r,s=(0,d.__assign)({},i);if(s.mouseEventRoot=(t=s.mouseEventRoot)!==null&&t!==void 0?t:s.targetRoot,s.touchEventRoot=(e=s.touchEventRoot)!==null&&e!==void 0?e:s.targetRoot,s.inputStartBounds=(n=s.inputStartBounds)!==null&&n!==void 0?n:s.targetRoot,s.maxRoamingBounds=(c=s.maxRoamingBounds)!==null&&c!==void 0?c:s.targetRoot,s.safeBounds=(l=s.safeBounds)!==null&&l!==void 0?l:new ye([2]),s.itemIdentifier=(r=s.itemIdentifier)!==null&&r!==void 0?r:function(){return null},s.recordingMode=!!s.recordingMode,i.paddedSafeBounds)delete s.safeBoundPadding;else{var o=i.safeBoundPadding;typeof o=="number"&&(o=[o]),o=o!=null?o:[3],s.paddedSafeBounds=new ye(s.safeBounds,o)}return s}var hi=R(H(),1);var Ii=R(H(),1);var wt=function(i){(0,d.__extends)(t,i);function t(){var e=i.call(this)||this;return e._isComplete=!1,e._stats=new Re,e}return Object.defineProperty(t.prototype,"stats",{get:function(){return this._stats},enumerable:!1,configurable:!0}),t.prototype.clone=function(){var e=new t;return e._isComplete=this._isComplete,e._wasCancelled=this._wasCancelled,e._stats=new Re(this._stats),e},Object.defineProperty(t.prototype,"isComplete",{get:function(){return this._isComplete},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wasCancelled",{get:function(){return this._wasCancelled},enumerable:!1,configurable:!0}),t.prototype.translateCoordSystem=function(e){this._stats=this._stats.translateCoordSystem(e)},t.prototype.replaceInitialSample=function(e){this._stats=this._stats.replaceInitialSample(e)},t.prototype.extend=function(e){if(this._isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this._stats=this._stats.extend(e),this.emit("step",e)},t.prototype.terminate=function(e){e===void 0&&(e=!1),!this._isComplete&&(this._wasCancelled=e,this._isComplete=!0,e?this.emit("invalidated"):this.emit("complete"),this.removeAllListeners())},t}(Ii.default);var je=function(i){(0,d.__extends)(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.samples=[],e}return t.prototype.clone=function(){var e=new t;return e.samples=[].concat(this.samples),e._isComplete=this._isComplete,e._wasCancelled=this._wasCancelled,e._stats=new Re(this._stats),e},t.deserialize=function(e){var n=new t;n.samples=[].concat(e.coords.map(function(l){return(0,d.__assign)({},l)})),n._isComplete=!0,n._wasCancelled=e.wasCancelled;var c=n.samples.reduce(function(l,r){return l.extend(r)},new Re);return n._stats=c,n},t.prototype.extend=function(e){if(this.isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this.samples.push(e),i.prototype.extend.call(this,e)},t.prototype.translateCoordSystem=function(e){i.prototype.translateCoordSystem.call(this,e);for(var n=0;n<this.samples.length;n++)this.samples[n]=e(this.samples[n])},Object.defineProperty(t.prototype,"coords",{get:function(){return this.samples},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){for(var e={coords:[].concat(this.samples.map(function(r){return{targetX:r.targetX,targetY:r.targetY,t:r.t,item:r.item}})),wasCancelled:this.wasCancelled},n=0,c=e.coords;n<c.length;n++){var l=c[n];delete l.clientX,delete l.clientY,l.item===void 0&&delete l.item}return e},t}(wt);var be=function(){function i(t,e,n,c){this.stateToken=null,this.rawIdentifier=t,this.isFromTouch=n,this._path=c?new c:new wt,this.recognizerConfigStack=Array.isArray(e)?e:[e]}return Object.defineProperty(i.prototype,"path",{get:function(){return this._path},enumerable:!1,configurable:!0}),i.prototype.setGestureMatchInspector=function(t){if(this._matchInspectionClosure)throw new Error("Invalid state:  the match-inspection closure has already been set");this._matchInspectionClosure=t},i.prototype.update=function(t){this.path.extend(t),this._baseItem||(this._baseItem=t.item)},Object.defineProperty(i.prototype,"baseItem",{get:function(){return this._baseItem},set:function(t){this._baseItem=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentSample",{get:function(){return this.path.stats.lastSample},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"potentialModelMatchIds",{get:function(){return this._matchInspectionClosure(this)},enumerable:!1,configurable:!0}),i.prototype.constructSubview=function(t,e,n){return new le(this,this.recognizerConfigStack,t,e,n)},i.prototype.terminate=function(t){this.path.terminate(t)},Object.defineProperty(i.prototype,"isPathComplete",{get:function(){return this.path.isComplete},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"identifier",{get:function(){var t=this.isFromTouch?"touch":"mouse";return"".concat(t,":").concat(this.rawIdentifier)},enumerable:!1,configurable:!0}),i.prototype.pushRecognizerConfig=function(t){var e=(0,d.__assign)((0,d.__assign)({},t),{mouseEventRoot:this.recognizerConfigStack[0].mouseEventRoot,touchEventRoot:this.recognizerConfigStack[0].touchEventRoot});this.recognizerConfigStack.push(Yt(e))},i.prototype.popRecognizerConfig=function(){if(this.recognizerConfigStack.length==1)throw new Error("Cannot 'pop' the original recognizer-configuration for this GestureSource.");return this.recognizerConfigStack.pop()},Object.defineProperty(i.prototype,"currentRecognizerConfig",{get:function(){return this.recognizerConfigStack[this.recognizerConfigStack.length-1]},enumerable:!1,configurable:!0}),i}();var le=function(i){(0,d.__extends)(t,i);function t(e,n,c,l,r){var s=this,o=0,a=e.path.stats.sampleCount;e instanceof t&&(o=e._baseStartIndex),s=i.call(this,e.rawIdentifier,n,e.isFromTouch,Object.getPrototypeOf(e.path).constructor)||this;var B=s._baseSource=e instanceof t?e._baseSource:e;s.stateToken=r!=null?r:e.stateToken;var g=function(Q){var h=s.recognizerTranslation,C=(0,d.__assign)((0,d.__assign)({},Q),{targetX:Q.targetX-h.x,targetY:Q.targetY-h.y});return s.stateToken&&(C.stateToken=s.stateToken),(s.stateToken!=B.stateToken||s.stateToken!=e.stateToken)&&(C.item=s.currentRecognizerConfig.itemIdentifier(C,null)),C},F=e.path.stats.lastSample;c?(s._baseStartIndex=o=Math.max(o+a-1,0),a=a>0?1:0):s._baseStartIndex=o,c?e.path.stats.sampleCount&&s._path.extend(e.path.stats.lastSample):s._path=e.path.clone(),s._path.translateCoordSystem(g),l?s._baseItem=e.baseItem:s._baseItem=F==null?void 0:F.item;var u=function(){return s.path.terminate(!1)},I=function(){return s.path.terminate(!0)},y=function(Q){i.prototype.update.call(s,g(Q))};return B.path.on("complete",u),B.path.on("invalidated",I),B.path.on("step",y),s.subviewDisconnector=function(){B.path.off("complete",u),B.path.off("invalidated",I),B.path.off("step",y)},B.isPathComplete&&(s.path.terminate(B.path.wasCancelled),s.disconnect()),s}return Object.defineProperty(t.prototype,"recognizerTranslation",{get:function(){if(this.recognizerConfigStack.length==1||!this.currentRecognizerConfig)return{x:0,y:0};var e=this.currentRecognizerConfig,n=e.targetRoot.getBoundingClientRect(),c=this.recognizerConfigStack[0].targetRoot.getBoundingClientRect();return{x:n.left-c.left,y:n.top-c.top}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseSource",{get:function(){return this._baseSource},enumerable:!1,configurable:!0}),t.prototype.disconnect=function(){this.subviewDisconnector&&(this.subviewDisconnector(),this.subviewDisconnector=null)},t.prototype.pushRecognizerConfig=function(e){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")},t.prototype.popRecognizerConfig=function(){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")},t.prototype.update=function(e){throw new Error("Updates should be provided through the base GestureSource.")},t.prototype.terminate=function(e){this.baseSource.terminate(e)},t}(be);var Qi=function(i){(0,d.__extends)(t,i);function t(e,n,c){var l=i.call(this,e,n,c,je)||this;return l.stateToken=null,l}return t.prototype.initPath=function(){return new je},t.deserialize=function(e,n){var c=n!==void 0?n:this._jsonIdSeed++,l=e.isFromTouch,r=je.deserialize(e.path),s=new t(c,null,l);return s._path=r,s},t.prototype.toJSON=function(){var e=this.path,n={isFromTouch:this.isFromTouch,path:e.toJSON()};return n},t}(be);var Ci=function(i){(0,d.__extends)(t,i);function t(e){var n=this,c;return n=i.call(this)||this,n._activeTouchpoints=[],n.identifierMap={},n.config=e,n.sourceConstructor=!((c=e==null?void 0:e.recordingMode)!==null&&c!==void 0)||c?Qi:be,n}return t.prototype.createTouchpoint=function(e,n){var c=t.IDENTIFIER_SEED++;this.identifierMap[e]=c;var l=new this.sourceConstructor(c,this.config,n);return l.stateToken=this.stateToken,l},t.prototype.maintainTouchpointsWithIds=function(e){var n=this,c=e.map(function(l){return n.identifierMap[l]});this._activeTouchpoints.filter(function(l){return!c.includes(l.rawIdentifier)}).forEach(function(l){return l.terminate(!0)})},t.prototype.hasActiveTouchpoint=function(e){return this.identifierMap[e]!==void 0},t.prototype.getTouchpointWithId=function(e){var n=this.identifierMap[e];return this._activeTouchpoints.find(function(c){return c.rawIdentifier==n})},t.prototype.getConfigForId=function(e){return this.getTouchpointWithId(e).currentRecognizerConfig},t.prototype.getStateTokenForId=function(e){var n;return(n=this.getTouchpointWithId(e).stateToken)!==null&&n!==void 0?n:null},t.prototype.dropTouchpoint=function(e){var n=e.rawIdentifier;this._activeTouchpoints=this._activeTouchpoints.filter(function(s){return e!=s});for(var c=0,l=Object.keys(this.identifierMap);c<l.length;c++){var r=l[c];this.identifierMap[r]==n&&delete this.identifierMap[r]}},t.prototype.addTouchpoint=function(e){this._activeTouchpoints.push(e)},Object.defineProperty(t.prototype,"activeSources",{get:function(){return[].concat(this._activeTouchpoints)},enumerable:!1,configurable:!0}),t.IDENTIFIER_SEED=0,t}(hi.default);function wn(i,t,e){var n=i.targetRoot.getBoundingClientRect();return{clientX:t,clientY:e,targetX:t-n.left,targetY:e-n.top}}var Ot=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.buildSampleFor=function(e,n,c,l,r){var s,o,a=(0,d.__assign)((0,d.__assign)({},wn(this.config,e,n)),{t:l,stateToken:(s=r==null?void 0:r.stateToken)!==null&&s!==void 0?s:this.stateToken}),B=(o=r==null?void 0:r.currentRecognizerConfig.itemIdentifier)!==null&&o!==void 0?o:this.config.itemIdentifier,g=B(a,c);return a.item=g,a},t.prototype.onInputStart=function(e,n,c,l){var r=this,s=this.createTouchpoint(e,l);s.update(n),this.addTouchpoint(s),s.path.on("invalidated",function(){r.dropTouchpoint(s)}),s.path.on("complete",function(){r.dropTouchpoint(s)}),this.emit("pointstart",s)},t.prototype.onInputMove=function(e,n,c){var l=this.getTouchpointWithId(e);!l||l.update(n)},t.prototype.onInputMoveCancel=function(e,n,c){var l=this.getTouchpointWithId(e);!l||(l.update(n),l.path.terminate(!0))},t.prototype.onInputEnd=function(e,n){var c,l=this.getTouchpointWithId(e);if(!!l){var r=l.path.stats.lastSample,s=this.buildSampleFor(r.clientX,r.clientY,n,r.t,l);s.t!=r.t&&l.update(s),(c=this.getTouchpointWithId(e))===null||c===void 0||c.path.terminate(!1)}},t}(Ci);var Ae=function(){function i(){}return i.getCoordZoneBitmask=function(t,e){var n=e.getBoundingClientRect(),c=0;return c|=t.clientX<n.left?i.FAR_LEFT:0,c|=t.clientX>n.right?i.FAR_RIGHT:0,c|=t.clientY<n.top?i.FAR_TOP:0,c|=t.clientY>n.bottom?i.FAR_BOTTOM:0,c},i.inputStartOutOfBoundsCheck=function(t,e){return!!this.getCoordZoneBitmask(t,e.inputStartBounds)},i.inputStartSafeBoundProximityCheck=function(t,e){return this.getCoordZoneBitmask(t,e.paddedSafeBounds)},i.inputMoveCancellationCheck=function(t,e,n){if(n=n||0,this.getCoordZoneBitmask(t,e.maxRoamingBounds))return!0;var c=this.getCoordZoneBitmask(t,e.safeBounds);return!!(c&~n)},i.FAR_TOP=8,i.FAR_LEFT=4,i.FAR_BOTTOM=2,i.FAR_RIGHT=1,i}();var bi=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this,e)||this;return n.hasActiveClick=!1,n.disabledSafeBounds=0,n._mouseStart=function(c){return n.onMouseStart(c)},n._mouseMove=function(c){return n.onMouseMove(c)},n._mouseEnd=function(c){return n.onMouseEnd(c)},n}return Object.defineProperty(t.prototype,"eventRoot",{get:function(){return this.config.mouseEventRoot},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeIdentifier",{get:function(){return 0},enumerable:!1,configurable:!0}),t.prototype.registerEventHandlers=function(){this.eventRoot.addEventListener("mousedown",this._mouseStart,!0),this.eventRoot.addEventListener("mousemove",this._mouseMove,!1),this.eventRoot.addEventListener("mouseup",this._mouseEnd,!0)},t.prototype.unregisterEventHandlers=function(){this.eventRoot.removeEventListener("mousedown",this._mouseStart,!0),this.eventRoot.removeEventListener("mousemove",this._mouseMove,!1),this.eventRoot.removeEventListener("mouseup",this._mouseEnd,!0)},t.prototype.preventPropagation=function(e){e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,typeof e.stopImmediatePropagation=="function"?e.stopImmediatePropagation():typeof e.stopPropagation=="function"&&e.stopPropagation()},t.prototype.buildSampleFromEvent=function(e,n){var c=this.getTouchpointWithId(n);return this.buildSampleFor(e.clientX,e.clientY,e.target,performance.now(),c)},t.prototype.onMouseStart=function(e){if(!!this.config.targetRoot.contains(e.target)){this.preventPropagation(e);var n=this.activeIdentifier,c=this.buildSampleFromEvent(e,n);Ae.inputStartOutOfBoundsCheck(c,this.config)||(this.disabledSafeBounds=Ae.inputStartSafeBoundProximityCheck(c,this.config)),this.onInputStart(n,c,e.target,!1)}},t.prototype.onMouseMove=function(e){if(!!this.hasActiveTouchpoint(this.activeIdentifier)){var n=this.buildSampleFromEvent(e,this.activeIdentifier);if(!e.buttons){this.hasActiveClick&&(this.hasActiveClick=!1,this.onInputMoveCancel(this.activeIdentifier,n,e.target));return}this.preventPropagation(e);var c=this.getConfigForId(this.activeIdentifier);Ae.inputMoveCancellationCheck(n,c,this.disabledSafeBounds)?this.onInputMoveCancel(this.activeIdentifier,n,e.target):this.onInputMove(this.activeIdentifier,n,e.target)}},t.prototype.onMouseEnd=function(e){!this.hasActiveTouchpoint(this.activeIdentifier)||(e.buttons||(this.hasActiveClick=!1),this.onInputEnd(this.activeIdentifier,e.target))},t}(Ot);function On(i){for(var t=[],e=0;e<i.length;e++)t.push(i.item(e));return t}var Ui=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this,e)||this;return n.safeBoundMaskMap={},n._touchStart=function(c){return n.onTouchStart(c)},n._touchMove=function(c){return n.onTouchMove(c)},n._touchEnd=function(c){return n.onTouchEnd(c)},n}return Object.defineProperty(t.prototype,"eventRoot",{get:function(){return this.config.touchEventRoot},enumerable:!1,configurable:!0}),t.prototype.registerEventHandlers=function(){this.eventRoot.addEventListener("touchstart",this._touchStart,{capture:!0,passive:!1}),this.eventRoot.addEventListener("touchmove",this._touchMove,{capture:!1,passive:!1}),this.eventRoot.addEventListener("touchend",this._touchEnd,{capture:!0,passive:!1})},t.prototype.unregisterEventHandlers=function(){this.eventRoot.removeEventListener("touchstart",this._touchStart,!0),this.eventRoot.removeEventListener("touchmove",this._touchMove,!1),this.eventRoot.removeEventListener("touchend",this._touchEnd,!0)},t.prototype.preventPropagation=function(e){e.cancelable&&e.preventDefault(),typeof e.stopImmediatePropagation=="function"?e.stopImmediatePropagation():typeof e.stopPropagation=="function"&&e.stopPropagation()},t.prototype.dropTouchpoint=function(e){i.prototype.dropTouchpoint.call(this,e);for(var n=0,c=Object.keys(this.safeBoundMaskMap);n<c.length;n++){var l=c[n];this.getTouchpointWithId(Number.parseInt(l,10))==e&&delete this.safeBoundMaskMap[l]}},t.prototype.buildSampleFromTouch=function(e,n){var c=this.getTouchpointWithId(e.identifier);return this.buildSampleFor(e.clientX,e.clientY,e.target,n,c)},t.prototype.onTouchStart=function(e){if(!!this.config.targetRoot.contains(e.target)){this.preventPropagation(e);var n=On(e.touches),c=On(e.changedTouches);this.maintainTouchpointsWithIds(n.filter(function(a){return c.findIndex(function(B){return a.identifier==B.identifier})==-1}).map(function(a){return a.identifier}));for(var l=performance.now(),r=0;r<e.changedTouches.length;r++){var s=e.changedTouches.item(r),o=this.buildSampleFromTouch(s,l);if(!Ae.inputStartOutOfBoundsCheck(o,this.config))this.safeBoundMaskMap[s.identifier]=Ae.inputStartSafeBoundProximityCheck(o,this.config);else continue;this.onInputStart(s.identifier,o,e.target,!0)}}},t.prototype.onTouchMove=function(e){var n=!0,c=performance.now();this.maintainTouchpointsWithIds(On(e.touches).map(function(a){return a.identifier}));for(var l=0;l<e.touches.length;l++){var r=e.touches.item(l);if(!!this.hasActiveTouchpoint(r.identifier)){n&&(this.preventPropagation(e),n=!1);var s=this.getConfigForId(r.identifier),o=this.buildSampleFromTouch(r,c);Ae.inputMoveCancellationCheck(o,s,this.safeBoundMaskMap[r.identifier])?this.onInputMoveCancel(r.identifier,o,r.target):this.onInputMove(r.identifier,o,r.target)}}},t.prototype.onTouchEnd=function(e){for(var n=!0,c=0;c<e.changedTouches.length;c++){var l=e.changedTouches.item(c);!this.hasActiveTouchpoint(l.identifier)||(n&&(this.preventPropagation(e),n=!1),this.onInputEnd(l.identifier,e.target))}},t}(Ot);var Zi=R(H(),1);var pi=R(H(),1);var xi=function(){function i(t,e,n){var c=this;if(!t||!e)throw new Error("A gesture-path source and contact-path model must be specified.");if(this.model=t,this.publishedPromise=new J,this.source=e,this.inheritedStats=n,this.lastStats=null,t.timer){var l=t.timer.inheritElapsed?Math.min(e.path.stats.duration,t.timer.duration):0;this.timerPromise=new Bt(t.timer.duration-l),this.publishedPromise.then(function(){c.timerPromise.resolve(!1)}),this.timerPromise.then(function(r){var s=e instanceof le?e.baseSource:e,o=performance.now();!s.isPathComplete&&s.currentSample.t!=o&&s.path.extend((0,d.__assign)((0,d.__assign)({},s.currentSample),{t:o})),r!=t.timer.expectedResult&&c.finalize(!1,"timer"),t.timer.validateItem?c.finalize(t.timer.validateItem(c.source.path.stats.lastSample.item,c.baseItem),"timer"):c.finalize(!0,"timer")})}}return Object.defineProperty(i.prototype,"promise",{get:function(){return this.publishedPromise.corePromise},enumerable:!1,configurable:!0}),i.prototype.finalize=function(t,e){if(this.publishedPromise.isFulfilled)return this._result;var n=this.model,c;return t?c={type:n.pathResolutionAction,cause:e}:c={type:"reject",cause:e},this.publishedPromise.resolve(c),this._result=c,c},Object.defineProperty(i.prototype,"stats",{get:function(){return this.source.path.stats},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"baseItem",{get:function(){return this.source.baseItem},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lastItem",{get:function(){return this.source.currentSample.item},enumerable:!1,configurable:!0}),i.prototype.update=function(){var t=this.model,e=this.source;if(e.path.wasCancelled)return this.finalize(!1,"path");if(t.itemChangeAction&&e.path.stats.sampleCount>0&&e.currentSample.item!=e.baseItem){var n=t.itemChangeAction=="resolve";return this.finalize(n,"item")}else{var n=t.pathModel.evaluate(e.path,this.lastStats,e.baseItem,this.inheritedStats)||"continue";return this.lastStats=e.path.stats,n!="continue"?this.finalize(n=="resolve","path"):e.path.isComplete?this.finalize(!1,"path"):{type:"continue"}}},i}();var Mn=function(){function i(t,e){var n=this,c;if(this._isCancelled=!1,!t||!e)throw new Error("Construction of GestureMatcher requires a gesture-model spec and a source for related contact points.");if(!t.sustainTimer&&!e)throw new Error("If the provided gesture-model spec lacks a sustain timer, there must be an active contact point.");var l=e instanceof be?null:e,r=l?null:e;this.predecessor=l,this.publishedPromise=new J,this.model=t,t.sustainTimer&&(this.sustainTimerPromise=new Bt(t.sustainTimer.duration),this.sustainTimerPromise.then(function(Q){var h=t.sustainTimer.expectedResult==Q;n.finalize(h,"timer")})),this.pathMatchers=[];var s=r?[r]:l.sources,o=s.map(function(Q){return r&&Q==r?r:Q.isPathComplete?null:Q}).reduce(function(Q,h){return h?Q.concat(h):Q},[]);if(t.sustainTimer&&o.length>0){this.finalize(!1,"path");return}else!t.sustainTimer&&o.length==0&&this.finalize(!1,"path");for(var a=0;a<o.length;a++){var B=o[a],g=B;B instanceof le&&(B.disconnect(),g=B.baseSource);var F=t.contacts[a];if(!F)throw new Error('No contact model for inherited path: gesture "'.concat(t.id,"', entry ").concat(a));var u=(c=F==null?void 0:F.model.pathInheritance)!==null&&c!==void 0?c:"chop",I=!1,y=void 0;switch(u){case"reject":this.finalize(!1,"path");return;case"full":y=B.constructSubview(!1,!0),this.addContactInternal(y,B.path.stats);continue;case"partial":I=!0;case"chop":y=B.constructSubview(!0,I),this.addContactInternal(y,B.path.stats);break}}}return Object.defineProperty(i.prototype,"sources",{get:function(){var t=this;return this.pathMatchers.map(function(e,n){if(!t.model.contacts[n].resetOnResolve)return e.source}).filter(function(e){return!!e})},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"promise",{get:function(){return this.publishedPromise.corePromise},enumerable:!1,configurable:!0}),i.prototype.cancel=function(){this._isCancelled=!0,this._result||this.finalize(!1,"cancelled")},Object.defineProperty(i.prototype,"isCancelled",{get:function(){return this._isCancelled},enumerable:!1,configurable:!0}),i.prototype.finalize=function(t,e){var n,c;if(this.publishedPromise.isFulfilled)return this._result;try{var l=void 0;t?l=this.model.resolutionAction:(!((n=this.model.rejectionActions)===null||n===void 0)&&n[e]&&(l=this.model.rejectionActions[e],l.item="none"),l=l||{type:"none",item:"none"});var r=void 0,s=(c=l.item)!==null&&c!==void 0?c:"current";switch(s){case"none":r=null;break;case"base":r=this.primaryPath.baseItem;break;case"current":r=this.primaryPath.currentSample.item;break}var o={matched:t,action:(0,d.__assign)((0,d.__assign)({},l),{item:r})};return this.publishedPromise.resolve(o),this._result=o,o}catch(a){this.publishedPromise.reject(a)}},i.prototype.finalizeSources=function(){if(!this._result)throw Error("Invalid state for source-finalization - the matcher's evaluation of the gesture model is not yet complete");for(var t=this._result.matched,e=0;e<this.pathMatchers.length;e++){var n=this.pathMatchers[e],c=this.model.contacts[e];n.source.isPathComplete||(t&&c.endOnResolve||!t&&c.endOnReject)&&n.source.terminate(!1)}},Object.defineProperty(i.prototype,"primaryPath",{get:function(){for(var t,e=Number.NEGATIVE_INFINITY,n=0,c=this.pathMatchers;n<c.length;n++){var l=c[n];l.model.itemPriority>e&&(e=l.model.itemPriority,t=l)}return!t&&this.predecessor?this.predecessor.primaryPath:t==null?void 0:t.source},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"baseItem",{get:function(){return this.primaryPath.baseItem},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentItem",{get:function(){return this.primaryPath.currentSample.item},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"allSourceIds",{get:function(){var t=this.sources.map(function(n){return n.identifier}),e=this.predecessor?this.predecessor.allSourceIds:[];return t=t.filter(function(n){return e.indexOf(n)==-1}),t.concat(e)},enumerable:!1,configurable:!0}),i.prototype.mayAddContact=function(){return this.pathMatchers.length<this.model.contacts.length},i.prototype.addContact=function(t){var e=this.pathMatchers.length;if(!this.mayAddContact())throw new Error("The specified gesture model does not support more than ".concat(e," contact points."));this.addContactInternal(t.constructSubview(!1,!0),null)},Object.defineProperty(i.prototype,"result",{get:function(){return this._result},enumerable:!1,configurable:!0}),i.prototype.addContactInternal=function(t,e){var n=this,c,l=this.pathMatchers.length,r=this.model.contacts[l],s=new xi(r.model,t,new Re(e));this.pathMatchers.push(s);var o=null,a=null;if(!l&&this.predecessor&&this.model.sustainTimer){o=this.predecessor.primaryPath;var B=(c=this.model.sustainTimer.baseItem)!==null&&c!==void 0?c:"result",g=void 0;switch(B){case"none":a=null;break;case"base":a=this.predecessor.primaryPath.baseItem,g=this.predecessor.primaryPath.stateToken;break;case"result":a=this.predecessor.result.action.item,g=this.predecessor.primaryPath.currentSample.stateToken;break}t.baseItem=a!=null?a:t.baseItem,t.stateToken=g,t.currentSample.stateToken=g,t.currentRecognizerConfig&&(t.currentSample.item=t.currentRecognizerConfig.itemIdentifier(t.currentSample,null))}else a=this.primaryPath.baseItem,o=this.primaryPath;if(r.model.baseCoordReplacer){var F=t.path.stats,u=r.model.baseCoordReplacer(F,a);if(u){var I=(0,d.__assign)((0,d.__assign)({},wn(t.currentRecognizerConfig,u.clientX,u.clientY)),{t:u.t||u.t===0?u.t:F.initialSample.t,item:a,stateToken:t.stateToken});t.path.replaceInitialSample(I)}}if(r.model.allowsInitialState){var y=r.model.allowsInitialState(t.currentSample,o.currentSample,a,o.stateToken);y||(this.pathMatchers.pop(),this.finalize(!1,"path"))}s.update(),s.promise.then(function(Q){n.finalize(Q.type=="resolve",Q.cause)})},i.prototype.update=function(){this.pathMatchers.forEach(function(t){return t.update()})},i}();var Mt=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n._sourceSelector=[],n.potentialMatchers=[],n.sustainMode=!1,n.attemptSynchronousUpdate=function(){var c=n._sourceSelector.filter(function(s){return!s.source.isPathComplete}),l=c.map(function(s){return s.source.currentSample.t}),r=l[0];l.find(function(s){return r!=s})||n.potentialMatchers.forEach(function(s){return s.update()})},n.baseGestureSetId=e||"default",n}return t.prototype.potentialMatchersForSource=function(e){return this.potentialMatchers.filter(function(n){return n.allSourceIds.find(function(c){return c==e.identifier})})},t.prototype.cascadeTermination=function(){var e=this,n=this.potentialMatchers,c=n.filter(function(o){return!o.model.sustainWhenNested}),l=n.filter(function(o){return o.model.sustainWhenNested});this.potentialMatchers=l;var r=l.map(function(o){return o.allSourceIds}).reduce(function(o,a){for(var B=0,g=a;B<g.length;B++){var F=g[B];o.indexOf(F)==-1&&o.push(F)}return o},[]),s=this._sourceSelector.filter(function(o){return!r.find(function(a){return a==o.source.identifier})});return s.forEach(function(o){o.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}});var a=e._sourceSelector.indexOf(o);a>-1&&e._sourceSelector.splice(a,1)}),c.forEach(function(o){return o.cancel()}),this.sustainMode=!0,this._sourceSelector.map(function(o){return o.source})},t.prototype.matchGesture=function(e,n){return(0,d.__awaiter)(this,void 0,void 0,function(){var c,l,r,s,o,a,B,g,F,u,I,y,Q,h,C,b,x,G,X=this;return(0,d.__generator)(this,function(m){switch(m.label){case 0:return c=e instanceof be,l=function(p){var Z=p.sources.map(function(W){return W.baseSource});return Z&&Z.length>0?Z:p.predecessor?l(p.predecessor):[]},r=c?[e instanceof le?e.baseSource:e]:l(e),s=c?e:null,o=c?null:e,this.pendingMatchSetup?[4,this.pendingMatchSetup]:[3,2];case 1:m.sent(),m.label=2;case 2:return c&&s.path.on("invalidated",function(){X.dropSourcesWithIds([s.identifier])}),a=new J,B=r.map(function(p){var Z={source:p,matchPromise:a};return X._sourceSelector.push(Z),Z}),g=B.map(function(p){return p.matchPromise}),c?(F=this.potentialMatchers.filter(function(p){return p.mayAddContact()}),F.forEach(function(p){p.addContact(s),p.promise.then(X.matcherSelectionFilter(p,g))}),F.length>0?(u=this.stateToken,I=new J,this.pendingMatchSetup=I.corePromise,[4,xe(0)]):[3,5]):[3,5];case 3:return m.sent(),[4,xe(0)];case 4:if(m.sent(),this.pendingMatchSetup=null,I.resolve(),y=this.stateToken,u!=y&&(Q=s.currentSample,s.stateToken=y,Q.stateToken=y,Q.item=e.currentRecognizerConfig.itemIdentifier(Q,null),s.baseItem=Q.item),h=F.find(function(p){return p.result}),h&&h.allSourceIds.includes(e.identifier))return a.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),[2,{selectionPromise:a.corePromise}];m.label=5;case 5:if(this.sustainMode&&s)return a.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),[2,{selectionPromise:a.corePromise,sustainModeWithoutMatch:!0}];for(C=n.map(function(p){return new Mn(p,s||o)}),C=C.filter(function(p){return!p.result||p.result.matched!==!1}),b=0,x=C;b<x.length;b++)G=x[b],G.promise.then(this.matcherSelectionFilter(G,g));return C.length>0?this.potentialMatchers=this.potentialMatchers.concat(C):a.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),this.potentialMatchers.sort(function(p,Z){return Z.model.resolutionPriority-p.model.resolutionPriority}),this.resetSourceHooks(),[2,{selectionPromise:a.corePromise}]}})})},t.prototype.resetSourceHooks=function(){var e=this,n=function(c){var l=c;l.path.off("step",e.attemptSynchronousUpdate),l.path.off("complete",e.attemptSynchronousUpdate),l.path.off("invalidated",e.attemptSynchronousUpdate),l.path.on("step",e.attemptSynchronousUpdate),l.path.on("complete",e.attemptSynchronousUpdate),l.path.on("invalidated",e.attemptSynchronousUpdate)};this._sourceSelector.forEach(function(c){return n(c.source)})},t.prototype.dropSourcesWithIds=function(e){for(var n=function(o){var a=c._sourceSelector.findIndex(function(g){return g.source.identifier==o});if(a>-1){var B=c._sourceSelector.splice(a,1)[0];B.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"none",item:null}}})}},c=this,l=0,r=e;l<r.length;l++){var s=r[l];n(s)}},t.prototype.matchersForSource=function(e){return this.potentialMatchers.filter(function(n){return!!n.sources.find(function(c){return c.identifier==e.identifier})})},t.prototype.matcherSelectionFilter=function(e,n){var c=this;return function(l){return(0,d.__awaiter)(c,void 0,void 0,function(){var r,s,o,a,B,g,F,u,I,y=this;return(0,d.__generator)(this,function(Q){if(e.isCancelled?l={matched:!1,action:{type:"none",item:null}}:e.finalizeSources(),r=e.allSourceIds,s=r.map(function(h){return y._sourceSelector.find(function(C){return C.source.identifier==h})}).filter(function(h){return!!h}),o=this.potentialMatchers.indexOf(e),o==-1)return[2];if(this.potentialMatchers.splice(o,1),l.action.type=="none")return this.finalizeMatcherlessTrackers(s),[2];if(l.matched)for(B=function(h){var C=g.matchersForSource(h.source);g.potentialMatchers=g.potentialMatchers.filter(function(b){return!C.find(function(x){return b==x})}),C.forEach(function(b){b.cancel()}),g._sourceSelector=g._sourceSelector.filter(function(b){return!s.find(function(x){return b==x})}),h.matchPromise.resolve({matcher:e,result:l})},g=this,F=0,u=s;F<u.length;F++)I=u[F],B(I);else return a=function(h){if(y.sustainMode&&!h.sustainWhenNested){y.finalizeMatcherlessTrackers(s);return}var C=new Mn(h,e);if(C.result&&C.result.matched==!1){y.finalizeMatcherlessTrackers(s);return}C.promise.then(y.matcherSelectionFilter(C,s.map(function(b){return b.matchPromise}))),y.potentialMatchers.push(C),y.resetSourceHooks()},this.emit("rejectionwithaction",{matcher:e,result:l},a),[2];return[2]})})}},t.prototype.finalizeMatcherlessTrackers=function(e){for(var n=this,c=e.map(function(o){return{tracker:o,pendingCount:n.potentialMatchers.filter(function(a){return!!a.allSourceIds.find(function(B){return o.source.identifier==B})}).length}}),l=0,r=c;l<r.length;l++){var s=r[l];s.pendingCount==0&&s.tracker.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}})}},t}(pi.default);var Xi=R(H(),1);function qe(i,t){var e=i.gestures.find(function(n){return n.id==t});if(!e)throw new Error("Could not find spec for gesture with id '".concat(t,"'"));return e}function Gi(i,t){var e=i.sets[t];if(!e)throw new Error("Could not find a defined gesture-set with id '".concat(t,"'"));var n=i.gestures.filter(function(l){return!!e.find(function(r){return l.id==r})}),c=e.filter(function(l){return!n.find(function(r){return r.id==l})});if(c.length>0)throw new Error("Set '".concat(t,"' cannot find definitions for gestures with ids ").concat(c));return n}var mi={gestures:[],sets:{default:[]}};var Pr=function(){function i(t){var e,n,c=t.matcher,l=t.result;this.matchedId=c==null?void 0:c.model.id,this.linkType=l.action.type,this.item=l.action.item,this.sources=c==null?void 0:c.sources,(e=this.sources)===null||e===void 0||e.forEach(function(r){return r.disconnect()}),(n=this.sources)===null||n===void 0||n.sort(function(r,s){return(c==null?void 0:c.primaryPath)==r?-1:(c==null?void 0:c.primaryPath)==s?1:0}),this.allSourceIds=(c==null?void 0:c.allSourceIds)||[]}return i}();var Vi=function(i){(0,d.__extends)(t,i);function t(e,n,c,l){var r=i.call(this)||this;return r.markedComplete=!1,r.selectionHandler=function(s){return(0,d.__awaiter)(r,void 0,void 0,function(){var o,a,B,g,F,u,I,y,Q,h,C,b,x=this,G,X,m,p,Z,W,A,k;return(0,d.__generator)(this,function(S){switch(S.label){case 0:return o=new Pr(s),s.matcher&&this.stageReports.push(o),a=(G=s.matcher)!==null&&G!==void 0?G:this.stageReports[this.stageReports.length-1],B=(X=a==null?void 0:a.sources.map(function(L){return L instanceof le?L.baseSource:L}))!==null&&X!==void 0?X:[],g=s.result.action.type,(g=="complete"||g=="none")&&(B.forEach(function(L){L.isPathComplete||L.terminate(g=="none")}),!s.result.matched)?(this.markedComplete||(this.markedComplete=!0,this.emit("complete")),[2]):g=="complete"&&this.touchpointCoordinator&&this.pushedSelector?(F=(m=this.touchpointCoordinator)===null||m===void 0?void 0:m.sustainSelectorSubstack(this.pushedSelector),u=F.map(function(L){var f=new J;return L.path.on("invalidated",function(){return f.resolve()}),L.path.on("complete",function(){return f.resolve()}),f.corePromise}),u.length>0&&s.result.action.awaitNested?[4,Promise.all(u)]:[3,3]):[3,4];case 1:return S.sent(),[4,xe(0)];case 2:S.sent(),S.label=3;case 3:(p=this.touchpointCoordinator)===null||p===void 0||p.popSelector(this.pushedSelector),this.pushedSelector=null,S.label=4;case 4:return this.emit("stage",o,function(L){L.type=="pop"?B.forEach(function(f){return f.popRecognizerConfig()}):B.forEach(function(f){return f.pushRecognizerConfig(L.config)})}),I=!1,this.touchpointCoordinator&&(I=!this.touchpointCoordinator.selectorStackIncludes(this.selector)),y=jr(s.result.action,this.gestureConfig,this.baseGestureSetId),I&&(y=y.filter(function(L){return L.sustainWhenNested})),y.length>0?(g=="chain"&&s.result.action.selectionMode==((Z=this.pushedSelector)===null||Z===void 0?void 0:Z.baseGestureSetId)||(this.pushedSelector&&(this.pushedSelector.off("rejectionwithaction",this.modelResetHandler),(W=this.touchpointCoordinator)===null||W===void 0||W.popSelector(this.pushedSelector),this.pushedSelector=null),g=="chain"&&(Q=s.result.action.selectionMode,Q&&(h=new Mt(Q),h.on("rejectionwithaction",this.modelResetHandler),this.pushedSelector=h,(A=this.touchpointCoordinator)===null||A===void 0||A.pushSelector(h)))),C=(k=this.pushedSelector)!==null&&k!==void 0?k:this.selector,b=C.matchGesture(s.matcher,y),b.then(function(L){return(0,d.__awaiter)(x,void 0,void 0,function(){var f;return(0,d.__generator)(this,function(E){switch(E.label){case 0:return f=this.selectionHandler,[4,L.selectionPromise];case 1:return[2,f.apply(this,[E.sent()])]}})})})):this.markedComplete||(this.markedComplete=!0,this.emit("complete")),[2]}})})},r.modelResetHandler=function(s,o){var a=s.matcher.allSourceIds;if(!r.allSourceIds.find(function(B){return a.indexOf(B)==-1}))if(s.result.action.type=="replace")o(qe(r.gestureConfig,s.result.action.replace));else throw new Error("Missed a case in implementation!")},r.stageReports=[],r.selector=c,r.selector.on("rejectionwithaction",r.modelResetHandler),r.once("complete",function(){var s;r.pushedSelector&&((s=r.touchpointCoordinator)===null||s===void 0||s.popSelector(r.pushedSelector),r.pushedSelector=null),r.selector.off("rejectionwithaction",r.modelResetHandler),r.selector.dropSourcesWithIds(r.allSourceIds),r.selector=null}),r.gestureConfig=n,r.touchpointCoordinator=l,Promise.resolve().then(function(){return r.selectionHandler(e)}),r}return Object.defineProperty(t.prototype,"allSourceIds",{get:function(){var e,n;return(n=(e=this.stageReports[this.stageReports.length-1])===null||e===void 0?void 0:e.allSourceIds)!==null&&n!==void 0?n:[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseGestureSetId",{get:function(){var e,n;return(n=(e=this.selector)===null||e===void 0?void 0:e.baseGestureSetId)!==null&&n!==void 0?n:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"potentialModelMatchIds",{get:function(){if(!this.selector)return[];var e=[this.selector];this.pushedSelector&&e.push(this.pushedSelector);var n=this.stageReports[this.stageReports.length-1],c=n.sources,l=c.map(function(r){return e.map(function(s){return s.potentialMatchersForSource(r).map(function(o){return o.model.id})})}).reduce(function(r,s){return r.concat(s)}).reduce(function(r,s){for(var o=0,a=s;o<a.length;o++){var B=a[o];r.indexOf(B)==-1&&r.push(B)}return r},[]);return l},enumerable:!1,configurable:!0}),t.prototype.cancel=function(){var e=this.stageReports[this.stageReports.length-1].sources;e.forEach(function(n){return n.baseSource.isPathComplete||n.baseSource.terminate(!0)}),this.markedComplete||(this.markedComplete=!0,this.emit("complete"))},t}(Xi.default);function jr(i,t,e){switch(i.type){case"none":case"complete":return[];case"replace":return[qe(t,i.replace)];case"chain":return[qe(t,i.next)];default:throw new Error("Unexpected case arose within `processGestureAction` method")}}var vi=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this)||this;if(c.selectorStack=[new Mt],c._activeSources=[],c._activeGestures=[],c.modelResetHandler=function(o,a){var B=o.matcher.allSourceIds;if(!c.activeGestures.find(function(g){return g.allSourceIds.find(function(F){return B.indexOf(F)!=-1})}))if(o.result.action.type=="replace")a(qe(c.gestureModelDefinitions,o.result.action.replace));else throw new Error("Missed a case in implementation!")},c.onNewTrackedPath=function(o){return(0,d.__awaiter)(c,void 0,void 0,function(){var a,B,g,F,u,I,y,Q,h,C,b,x,G,X=this;return(0,d.__generator)(this,function(m){switch(m.label){case 0:this.addSimpleSourceHooks(o),a=this.gestureModelDefinitions,m.label=1;case 1:return B=this.currentSelector,F=B.matchGesture(o,Gi(a,B.baseGestureSetId)),[4,F];case 2:return u=m.sent(),u.sustainModeWithoutMatch?(I=function(p){p.stateToken=X.stateToken,p.item=o.currentRecognizerConfig.itemIdentifier(p,null)},o.path instanceof je&&o.path.coords.forEach(I),o.stateToken=this.stateToken,o.baseItem=o.path.stats.initialSample.item,I(o.path.stats.initialSample),I(o.path.stats.lastSample),[3,3]):(g=u.selectionPromise,[3,4]);case 3:if(B!=this.currentSelector)return[3,1];m.label=4;case 4:return y=this.currentSelector,o.setGestureMatchInspector(this.buildGestureMatchInspector(y)),this.emit("inputstart",o),[4,g];case 5:if(Q=m.sent(),!Q||Q.result.matched==!1)return[2];for(h=Q.matcher.allSourceIds,C=0,b=this._activeGestures;C<b.length;C++)if(x=b[C],x.allSourceIds.find(function(p){return!!h.find(function(Z){return p==Z})}))return[2];return G=new Vi(Q,a,this.currentSelector,this),this._activeGestures.push(G),G.on("complete",function(){var p=X._activeGestures.indexOf(G);p!=-1&&X._activeGestures.splice(p,1)}),this.emit("recognizedgesture",G),[2]}})})},c.gestureModelDefinitions=e,c.inputEngines=[],n)for(var l=0,r=n;l<r.length;l++){var s=r[l];c.addEngine(s)}return c.selectorStack[0].on("rejectionwithaction",c.modelResetHandler),c}return t.prototype.pushSelector=function(e){this.selectorStack.push(e),e.on("rejectionwithaction",this.modelResetHandler)},t.prototype.sustainSelectorSubstack=function(e){if(!e)return[];var n=this.selectorStack.indexOf(e);if(n==-1)return[];if(this.selectorStack.length<=1)throw new Error("May not force the original, base gesture selector into sustain mode.");for(var c=[],l=n;l<this.selectorStack.length;l++)e=this.selectorStack[l],c=c.concat(e.cascadeTermination());return c},t.prototype.popSelector=function(e){if(!!e){var n=this.selectorStack.indexOf(e);if(n!=-1){if(this.selectorStack.length<=1)throw new Error("May not pop the original, base gesture selector.");for(;n<this.selectorStack.length;)e=this.selectorStack[n],e.off("rejectionwithaction",this.modelResetHandler),this.selectorStack.splice(n,1);this.currentSelector.stateToken=this.stateToken}}},t.prototype.selectorStackIncludes=function(e){return this.selectorStack.includes(e)},Object.defineProperty(t.prototype,"currentSelector",{get:function(){return this.selectorStack[this.selectorStack.length-1]},enumerable:!1,configurable:!0}),t.prototype.buildGestureMatchInspector=function(e){var n=this;return function(c){var l=n.selectorStack.indexOf(e),r=n.selectorStack.slice(l);return r.map(function(s){return s.potentialMatchersForSource(c).map(function(o){return o.model.id})}).reduce(function(s,o){return s.concat(o)})}},t.prototype.addEngine=function(e){e.on("pointstart",this.onNewTrackedPath),this.inputEngines.push(e)},Object.defineProperty(t.prototype,"activeGestures",{get:function(){return[].concat(this._activeGestures)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeSources",{get:function(){return[].concat(this.inputEngines.map(function(e){return e.activeSources}).reduce(function(e,n){return e.concat(n)},[]))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateToken",{get:function(){return this._stateToken},set:function(e){this._stateToken=e,this.inputEngines.forEach(function(n){return n.stateToken=e}),this.currentSelector.stateToken=e},enumerable:!1,configurable:!0}),t.prototype.addSimpleSourceHooks=function(e){var n=this;e.path.on("invalidated",function(){var c=n.activeGestures.find(function(r){return r.allSourceIds.includes(e.identifier)});c&&c.cancel();var l=n._activeSources.indexOf(e);n._activeSources=n._activeSources.splice(l,1)}),e.path.on("complete",function(){var c=n._activeSources.indexOf(e);n._activeSources=n._activeSources.splice(c,1)})},t}(Zi.default);var ht=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this,l=Yt(n);return e=e||mi,c=i.call(this,e)||this,c.config=l,c.mouseEngine=new bi(c.config),c.touchEngine=new Ui(c.config),c.mouseEngine.registerEventHandlers(),c.touchEngine.registerEventHandlers(),c.addEngine(c.mouseEngine),c.addEngine(c.touchEngine),c}return t.prototype.destroy=function(){this.activeGestures.forEach(function(e){return e.cancel()}),this.activeSources.forEach(function(e){return e.terminate(!0)}),this.mouseEngine.unregisterEventHandlers(),this.touchEngine.unregisterEventHandlers(),this.mouseEngine=null,this.touchEngine=null},t}(vi);var Dn=["n","ne","e","se","s","sw","w","nw"],fi=Math.PI,zn=function(){for(var i=new Map,t=fi/4,e=0;e<Dn.length;e++)i.set(Dn[e],[t*e,1]);return i}();function Dt(i){return Math.PI/4*Dn.indexOf(i)}function Ct(i,t){var e=Dt(t),n=i.initialSample,c=i.lastSample.targetX-n.targetX,l=i.lastSample.targetY-n.targetY,r=Math.max(0,-l*Math.cos(e)),s=Math.max(0,c*Math.sin(e));return s+r}function qr(i,t,e,n){return function(c){var l=Dt(t),r=n.flick.triggerDist-n.flick.dirLockDist,s=Math.max(0,Ct(i.path.stats,t)-n.flick.dirLockDist),o=.7,a=Math.min(1,o*s/r),B=Math.sin(l)*a,g=-Math.cos(l)*a;e==null||e.scrollFlickPreview(B,g)}}var zt=Math.PI/3,$r=function(){function i(t,e,n,c,l,r){var s=this;this.directlyEmitsKeys=!0,this.sequence=t,this.gestureParams=l,this.baseSpec=c.key.spec,this.baseKeyDistances=n.getSimpleTapCorrectionDistances(t.stageReports[0].sources[0].path.stats.initialSample,this.baseSpec);var o=t.stageReports[0].sources[0].baseSource,a=o;t.on("complete",function(){r.cancel()}),this.sequence.on("stage",function(g){var F,u=a.path.stats;s.computedFlickDistribution=s.flickDistribution(u,!0);var I=s.computedFlickDistribution[0].keySpec;if(g.matchedId=="flick-restart"){a.path.replaceInitialSample(g.sources[0].path.stats.initialSample);return}if(g.matchedId=="flick-reset-centering"){a=o.constructSubview(!0,!0);return}else if(g.matchedId=="flick-reset-end"){s.emitKey(n,s.baseSpec,a.path.stats);return}else if(g.matchedId=="flick-reset"){s.flickScroller&&(s.flickScroller(a.currentSample),a.path.off("step",s.flickScroller)),s.lockedDir=null,s.lockedSelectable=null,a instanceof le&&a.disconnect();return}else if(g.matchedId=="flick-mid"){if(I==s.baseSpec)return;var y=Object.keys(s.baseSpec.flick).find(function(h){return s.baseSpec.flick[h]==I});s.lockedDir=y,s.lockedSelectable=I,s.flickScroller&&a.path.off("step",s.flickScroller),s.flickScroller=qr(a,y,r,s.gestureParams),s.flickScroller(a.currentSample),a.path.on("step",s.flickScroller);return}var Q=(F=s.lockedSelectable)!==null&&F!==void 0?F:I;s.emitKey(n,Q,u)});var B=this.buildPopupRecognitionConfig(n);e({type:"push",config:B})}return i.prototype.emitKey=function(t,e,n){var c,l=Ct(n,this.lockedDir);l>this.gestureParams.flick.triggerDist?c=t.keyEventFromSpec(e):c=t.keyEventFromSpec(this.baseSpec),c.keyDistribution=this.currentStageKeyDistribution(this.baseKeyDistances),t.raiseKeyEvent(c,null)},i.prototype.buildPopupRecognitionConfig=function(t){var e={getBoundingClientRect:function(){var n=Number.MAX_SAFE_INTEGER;return new DOMRect(-n,-n,2*n,2*n)}};return(0,d.__assign)((0,d.__assign)({},t.gestureEngine.config),{maxRoamingBounds:e,safeBounds:e})},i.prototype.cancel=function(){},i.prototype.flickDistribution=function(t,e){var n=this.baseSpec.flick,c=[{spec:this.baseSpec,coord:[NaN,0]}];c=c.concat(Object.keys(n).map(function(F){return{spec:n[F],coord:zn.get(F)}}));var l=t.angle,r=this.gestureParams.flick.triggerDist,s=Math.min(r,e?r:t.netDistance),o=s/r,a=0,B=c.map(function(F){var u=0,I=F.coord;if(!isNaN(I[0])){var y=l-I[0],Q=2*fi+I[0]-l;u=Math.min(y*y,Q*Q)}var h=zt*(I[1]-o),C=h*h,b=1/(u+C+1e-6);return a+=b,{keySpec:F.spec,p:b}}),g=1/a;return B.forEach(function(F){return F.p*=g}),B.sort(function(F,u){return u.p-F.p})},i.prototype.currentStageKeyDistribution=function(t){var e=this.baseSpec,n=this.baseKeyDistances,c=this.computedFlickDistribution,l=n.get(e);if(!l){var r=c[0];return[{keySpec:r.keySpec,p:1}]}var s=c.findIndex(function(B){return B.keySpec==e}),o=c.splice(s,1)[0].p,a=Se(n);return c.concat(a.map(function(B){return{keySpec:B.keySpec,p:B.p*o}}))},i}(),Li=$r;var Kn={longpress:{permitsFlick:function(){return!0},flickDist:5,waitLength:500,noiseTolerance:10},multitap:{waitLength:500,holdLength:500},flick:{startDist:10,dirLockDist:25,triggerDist:40}};function Ji(i){var t=i.getBoundingClientRect();return{clientX:t.left+t.width/2,clientY:t.top+t.height/2}}function Si(i){var t=Ji(i);return function(e){var n=e.lastSample.clientX-t.clientX,c=e.lastSample.clientY-t.clientY;return Math.sqrt(n*n+c*c)}}function bt(i){var t,e,n=i.key.spec,c=["K_SHIFT","K_ALT","K_CTRL","K_NUMERALS","K_SYMBOLS","K_CURRENCIES"];try{for(var l=(0,d.__values)(c),r=l.next();!r.done;r=l.next()){var s=r.value;if(n.id==s)return!0}}catch(o){t={error:o}}finally{try{r&&!r.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}if(n.nextlayer)switch(n.sp){case 1:case 2:case 3:case 4:return!0;default:return!1}else return!1}function _n(i,t){var e=function(F,u){if(!F)return!1;var I=F.key.spec;switch(u){case"modipress-start":return bt(F);case"special-key-start":return["K_LOPT","K_ROPT","K_BKSP"].indexOf(I.baseKeyID)!=-1;case"longpress":return!0;case"multitap-start":case"modipress-multitap-start":return i.hasMultitaps?!!I.multitap:!1;case"flick-start":return!!I.flick;default:return!0}},n=t.roamingEnabled||(t.roamingEnabled=!i.hasFlicks),c=te(n?hs(t):Ti(t)),l=te(n?jn(t):Ei(t)),r=te(Wi(t,!0,n));function s(F,u){F=te(F);var I=F.id;return typeof u=="number"&&(u=[u]),F.contacts.forEach(function(y,Q){var h;if(u.indexOf(Q)!=-1){var C=(h=y.model.allowsInitialState)!==null&&h!==void 0?h:function(){return!0};y.model=(0,d.__assign)((0,d.__assign)({},y.model),{allowsInitialState:function(b,x,G){return e(G,I)&&C(b,x,G)}})}}),F}var o=rs(),a=bs(),B=[s(r,0),s(Is(t),0),Qs(t),c,l,s(o,0),ss(t),Cs(),s(a,0),Us(t),ps(),xs(),s(Gs(t),0),ms(t),Xs()],g=[r.id,c.id,a.id,o.id];return n?(B.push(s(os(t),0)),B.push(as())):(B.push(s(Ni(t),0)),B.push(ds(t)),B.push(gs(t)),B.push(Fs(t)),B.push(Bs(t)),B.push(us()),B.push(ys(t)),g.push("flick-start")),{gestures:B,sets:{default:g,modipress:g.filter(function(F){return F!=a.id}),none:[]}}}function Pn(){return{itemPriority:0,pathResolutionAction:"reject",pathModel:{evaluate:function(i){return"resolve"}}}}function Xe(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:function(i){return"resolve"}}}}function es(i){return{itemPriority:1,pathModel:{evaluate:function(t){return t.stats.netDistance>i.flick.startDist?"resolve":null}},pathResolutionAction:"resolve",pathInheritance:"partial"}}function Ri(i,t){var e,n,c=t.key.spec.flick,l=Object.keys(c),r,s=0;try{for(var o=(0,d.__values)(l),a=o.next();!a.done;a=o.next()){var B=a.value,g=Ct(i,B);g>s&&(s=g,r=B)}}catch(F){e={error:F}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return{dir:r,dist:s}}function ts(i){return{itemPriority:1,pathModel:{evaluate:function(t,e,n){var c=Ri(t.stats,n),l=c.dir,r=c.dist;if(r>i.flick.dirLockDist){var s=t.stats.angle,o=Dt(l),a=Math.abs(s-o),B=Math.abs(2*Math.PI+o-s);if(a<=zt||B<=zt)return"resolve"}else if(t.isComplete)return"reject"}},pathResolutionAction:"resolve",pathInheritance:"full"}}function ns(i){return{itemPriority:1,pathModel:{evaluate:function(t,e,n,c){if(t.isComplete)return"resolve";var l=Ri(c,n).dir;if(Ct(t.stats,l)<i.flick.dirLockDist)return"reject"}},pathResolutionAction:"resolve",pathInheritance:"full"}}function cs(i,t,e){var n=i.longpress;return{itemPriority:0,pathResolutionAction:"resolve",timer:{duration:n.waitLength,expectedResult:!0,validateItem:function(c){return!!(c!=null&&c.key.spec.sk)}},pathModel:{evaluate:function(c){var l,r,s=c.stats;if(t&&n.permitsFlick(s.lastSample.item)&&((r=((l=s.cardinalDirection)===null||l===void 0?void 0:l.indexOf("n"))!=-1)!==null&&r!==void 0?r:!1)){if(s.netDistance>n.flickDist)return"resolve"}else if(e){if(s.rawDistance>n.noiseTolerance||s.lastSample.item!=s.initialSample.item)return"reject"}else if(s.lastSample.item!=s.initialSample.item)return"reject";return c.isComplete?"reject":null}}}}function Ai(){return{itemPriority:-1,pathResolutionAction:"resolve",pathModel:{evaluate:function(i){return"resolve"}}}}function is(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:function(i){if(i.isComplete)return"reject"}}}}function Hi(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:function(i){if(i.isComplete)return"resolve"}}}}function Kt(i,t){var e,n=(e=i==null?void 0:i.roamingEnabled)!==null&&e!==void 0?e:!0;return{itemPriority:0,itemChangeAction:n?"reject":void 0,pathResolutionAction:"resolve",pathInheritance:!n&&t?"full":"chop",pathModel:{evaluate:function(c){if(c.isComplete&&!c.wasCancelled)return"resolve"}}}}function ls(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:function(i){if(i.isComplete&&!i.wasCancelled)return"resolve"}}}}function rs(){return{id:"special-key-start",resolutionPriority:0,contacts:[{model:(0,d.__assign)({},Xe()),endOnResolve:!1}],resolutionAction:{type:"chain",next:"special-key-end",item:"current"}}}function ss(i){return{id:"special-key-end",resolutionPriority:0,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Kt(i)),{itemChangeAction:"resolve"}),endOnResolve:!0}],resolutionAction:{type:"complete",item:"none"}}}function Wi(i,t,e){var n={id:"longpress",resolutionPriority:0,contacts:[{model:(0,d.__assign)((0,d.__assign)({},cs(i,t,e)),{itemPriority:1,pathInheritance:"chop"}),endOnResolve:!1},{model:Pn()}],resolutionAction:{type:"chain",next:"subkey-select",selectionMode:"none",item:"none"}};return e?(0,d.__assign)((0,d.__assign)({},n),{rejectionActions:{path:{type:"replace",replace:"longpress-roam"},timer:{type:"replace",replace:"longpress-roam-restore"}}}):n}function os(i){var t=Wi(i,!1,!0);return(0,d.__assign)((0,d.__assign)({},t),{id:"longpress-roam"})}function as(){return{id:"longpress-roam-restore",contacts:[{model:{pathModel:{evaluate:function(i){return null}},itemChangeAction:"reject",pathInheritance:"full",pathResolutionAction:"reject",itemPriority:0}}],resolutionPriority:-1,rejectionActions:{item:{type:"replace",replace:"longpress-roam"}},resolutionAction:{type:"chain",next:"longpress-roam"}}}function Ni(i){return{id:"flick-start",resolutionPriority:3,contacts:[{model:es(i)}],resolutionAction:{type:"chain",item:"none",next:"flick-mid"}}}function Bs(i){var t=Ni(i);return(0,d.__assign)((0,d.__assign)({},t),{contacts:[(0,d.__assign)((0,d.__assign)({},t.contacts[0]),{model:(0,d.__assign)((0,d.__assign)({},t.contacts[0].model),{baseCoordReplacer:function(e,n){var c=Ji(n),l=Si(n),r=e.initialSample,s=l(e);if(s>i.flick.triggerDist)return c;var o=i.flick.dirLockDist;if(s<o)return r;var a=o/s,B=r.clientX-c.clientX,g=r.clientY-c.clientY;return{clientX:c.clientX+B*a,clientY:c.clientY+g*a}}})})],id:"flick-restart",sustainWhenNested:!0,rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}}})}function ds(i){return{id:"flick-mid",resolutionPriority:0,contacts:[{model:ts(i),endOnReject:!0},{model:Pn(),resetOnResolve:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}},resolutionAction:{type:"chain",item:"none",next:"flick-end"},sustainWhenNested:!0}}function gs(i){return{id:"flick-reset",resolutionPriority:1,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Xe()),{pathInheritance:"partial"})}],resolutionAction:{type:"chain",next:"flick-reset-centering"},sustainWhenNested:!0}}function Fs(i){return{id:"flick-reset-centering",resolutionPriority:1,contacts:[{model:{pathModel:{evaluate:function(t,e,n){e||(e=t.stats);var c=Si(n),l=c(t.stats),r=c(e);if(r<l)return"resolve"}},itemPriority:0,pathResolutionAction:"resolve",pathInheritance:"full"}}],resolutionAction:{type:"chain",next:"flick-restart"},sustainWhenNested:!0}}function us(){return{id:"flick-reset-end",resolutionPriority:1,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"complete",item:"base"},sustainWhenNested:!0}}function ys(i){return{id:"flick-end",resolutionPriority:0,contacts:[{model:ns(i)},{model:Xe(),resetOnResolve:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset"}},resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}function Is(i){return{id:"multitap-start",resolutionPriority:2,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Xe()),{itemPriority:1,pathInheritance:"reject",allowsInitialState:function(t,e,n){return t.item==n}})}],sustainTimer:{duration:i.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"multitap-end",item:"current"}}}function Qs(i){return{id:"multitap-end",resolutionPriority:2,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Kt(i)),{itemPriority:1,timer:{duration:i.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Xe(),resetOnResolve:!0}],rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"none"}}}function Ti(i){return{id:"initial-tap",resolutionPriority:1,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Kt(i)),{pathInheritance:"chop",itemPriority:1,timer:{duration:i.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Xe(),resetOnResolve:!0}],sustainWhenNested:!0,rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"base"}}}function Ei(i){return{id:"simple-tap",resolutionPriority:1,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Kt(i,!0)),{itemPriority:1}),endOnResolve:!0},{model:Xe(),resetOnResolve:!0}],sustainWhenNested:!0,resolutionAction:{type:"complete",item:"base"}}}function hs(i){var t=Ti(i);return(0,d.__assign)((0,d.__assign)({},t),{rejectionActions:(0,d.__assign)((0,d.__assign)({},t.rejectionActions),{item:{type:"replace",replace:"initial-tap"}})})}function jn(i){var t=Ei(i);return(0,d.__assign)((0,d.__assign)({},t),{rejectionActions:(0,d.__assign)((0,d.__assign)({},t.rejectionActions),{item:{type:"replace",replace:"simple-tap"}})})}function Cs(){return{id:"subkey-select",resolutionPriority:0,contacts:[{model:(0,d.__assign)((0,d.__assign)({},ls()),{pathInheritance:"full",itemPriority:1}),endOnResolve:!0,endOnReject:!0}],resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}function bs(){return{id:"modipress-start",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Ai()),{allowsInitialState:function(i,t,e){return bt(e)},itemChangeAction:"reject",itemPriority:1})}],resolutionAction:{type:"chain",next:"modipress-hold",selectionMode:"modipress",item:"current"}}}function Us(i){return{id:"modipress-hold",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},is()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:i.multitap.holdLength,expectedResult:!0,inheritElapsed:!0}})},{model:(0,d.__assign)({},Xe()),resetOnResolve:!0}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"},rejectionActions:{path:{type:"replace",replace:"modipress-end-multitap-transition"}}}}function xs(){return{id:"modipress-end-multitap-transition",resolutionPriority:5,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"}}}function ps(){return{id:"modipress-end",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Hi()),{itemChangeAction:"reject",pathInheritance:"full"})}],resolutionAction:{type:"complete",item:"none",awaitNested:!0}}}function Gs(i){return{id:"modipress-multitap-start",resolutionPriority:6,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Ai()),{pathInheritance:"reject",allowsInitialState:function(t,e,n){return t.item!=n?!1:bt(n)},itemChangeAction:"reject",itemPriority:1})}],sustainTimer:{duration:i.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"modipress-multitap-end",selectionMode:"modipress",item:"current"}}}function ms(i){return{id:"modipress-multitap-end",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Hi()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:i.multitap.holdLength,expectedResult:!1}})},{model:(0,d.__assign)({},Pn()),resetOnResolve:!0}],resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"},rejectionActions:{timer:{type:"replace",replace:"modipress-multitap-lock-transition"},path:{type:"replace",replace:"modipress-multitap-lock-transition"}}}}function Xs(){return{id:"modipress-multitap-lock-transition",resolutionPriority:5,contacts:[{model:(0,d.__assign)((0,d.__assign)({},Xe()),{pathResolutionAction:"resolve"})}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"}}}var ki=(0,d.__assign)((0,d.__assign)({},te(jn(null))),{resolutionAction:{type:"complete",item:"current"}}),Yi={gestures:[ki],sets:{default:[ki.id]}};var _i=R(H(),1);function Ve(i){var t;return typeof i=="string"?t=i:(t=i.style.fontSize,t||(t=getComputedStyle(i).fontSize)),new v(t)}function wi(i,t,e){if(i.touchable){var n=i.formFactor=="phone"?1.6*(e?.65:.6)*1.2:2;return v.special(n,"em")}else return t?v.inPixels(t/8):void 0}var Ut;function xt(i,t,e){e={fontFamily:e.fontFamily,fontSize:e.fontSize},e.fontFamily||(e.fontFamily=getComputedStyle(document.body).fontFamily),(!e.fontSize||e.fontSize=="")&&(e.fontSize="1em");var n=e.fontFamily,c=Ve(e.fontSize),l;c.absolute?l=c.val+"px":l=c.val*t+"px",Ut=Ut!=null?Ut:document.createElement("canvas");var r=Ut.getContext("2d");r.font=l+" "+n;var s=r.measureText(i);return s}var Vs=10,Oi=function(){function i(t,e){this.totalLength=0,this.baseCoord=t,this.curCoord=t,this.baseScrollLeft=e,this.totalLength=0}return i.prototype.updateTo=function(t){var e=this.curCoord;this.curCoord=t;var n=this.baseCoord.targetX-this.curCoord.targetX+this.baseScrollLeft;return this.totalLength+=Math.abs(this.curCoord.targetX-e.targetX),n},Object.defineProperty(i.prototype,"hasScrolled",{get:function(){return this.totalLength>Vs},enumerable:!1,configurable:!0}),i}();var Mi="kmw-suggest-touched";var Zs="kmw-suggest-banner-scroller",Di=.666,zi="swallow-fade-transition",vs=function(){function i(t,e){this.index=t,this.rtl=e!=null?e:!1,this.constructRoot();var n=this.display=T("span");n.className="kmw-suggestion-text",this.container.appendChild(n)}return Object.defineProperty(i.prototype,"computedStyle",{get:function(){return getComputedStyle(this.display)},enumerable:!1,configurable:!0}),i.prototype.constructRoot=function(){var t=this.div=T("div"),e=t.style;t.className="kmw-suggest-option",t.id=i.BASE_ID+this.index,this.div.suggestion=this;var n=this.container=document.createElement("div");n.className="kmw-suggestion-container";var c=100-He.MARGIN*(He.LONG_SUGGESTION_DISPLAY_LIMIT-1),l=c/He.LONG_SUGGESTION_DISPLAY_LIMIT;n.style.minWidth=l+"%",t.appendChild(n)},i.prototype.matchKeyboardProperties=function(t){var e=this.div;if(t){t.KLC&&(e.lang=t.KLC);var n=t.KFont;n&&n.family&&n.family!=""&&(e.style.fontFamily=this.fontFamily=n.family)}},Object.defineProperty(i.prototype,"suggestion",{get:function(){return this._suggestion},enumerable:!1,configurable:!0}),i.prototype.update=function(t,e){this._suggestion=t;var n=this.generateSuggestionText(this.rtl);if(this.container.replaceChild(n,this.display),this.display=n,e.minWidth!==void 0&&(this._minWidth=e.minWidth),this._paddingWidth=e.paddingWidth,this._collapsedWidth=e.collapsedWidth,t&&t.displayAs){var c=xt(t.displayAs,e.emSize,e.styleForFont);this._textWidth=c.width}else this._textWidth=0;this.currentWidth=this.collapsedWidth,this.updateLayout()},i.prototype.updateLayout=function(){if(!this.suggestion&&this.index!=0){this.div.style.width="0px";return}else this.div.style.width="";var t=this.container.style;t.minWidth=this.collapsedWidth+"px",this.rtl?t.marginRight=this.collapsedWidth-this.expandedWidth+"px":t.marginLeft=this.collapsedWidth-this.expandedWidth+"px",this.updateFade()},i.prototype.updateFade=function(){var t=this;this.div.classList.add(zi),window.requestAnimationFrame(function(){t.div.classList.remove(zi)}),this.div.classList.add("kmw-hide-fade-".concat(this.rtl?"left":"right"));var e="kmw-hide-fade-".concat(this.rtl?"right":"left");this.expandedWidth-this.collapsedWidth?this.div.classList.remove(e):this.div.classList.add(e)},Object.defineProperty(i.prototype,"targetCollapsedWidth",{get:function(){return this._collapsedWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textWidth",{get:function(){return this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"paddingWidth",{get:function(){return this._paddingWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minWidth",{get:function(){return this._minWidth},set:function(t){this._minWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"expandedWidth",{get:function(){return this.minWidth>this.spanWidth?this.minWidth:this.spanWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"spanWidth",{get:function(){var t,e,n=(t=this.textWidth)!==null&&t!==void 0?t:0;return n&&(n+=(e=this.paddingWidth)!==null&&e!==void 0?e:0),n},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"collapsedWidth",{get:function(){var t=this.spanWidth<this.targetCollapsedWidth?this.spanWidth:this.targetCollapsedWidth,e=t<this.expandedWidth?t:this.expandedWidth;return this.minWidth>e?this.minWidth:e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentWidth",{get:function(){return this.div.offsetWidth},set:function(t){t<this.collapsedWidth?t=this.collapsedWidth:t>this.expandedWidth&&(t=this.expandedWidth),this.rtl?this.container.style.marginRight="".concat(t-this.expandedWidth,"px"):this.container.style.marginLeft="".concat(t-this.expandedWidth,"px")},enumerable:!1,configurable:!0}),i.prototype.highlight=function(t){var e=this.div;t?e.classList.add(Mi):e.classList.remove(Mi)},i.prototype.isEmpty=function(){return!this._suggestion},i.prototype.generateSuggestionText=function(t){var e=this._suggestion,n,c=T("span");if(c.className="kmw-suggestion-text",e==null)return c;if(e.displayAs==null||e.displayAs=="")n="\xA0";else{var l=t?8238:8237;n=String.fromCharCode(l)+e.displayAs}return c.innerHTML=n,c},i.BASE_ID="kmw-suggestion-",i}();var He=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,n||ue.DEFAULT_HEIGHT)||this;return c.type="suggestion",c.currentSuggestions=[],c.options=[],c.separators=[],c.isRTL=!1,c.onSuggestionUpdate=function(l){var r;c.currentSuggestions=l,(r=c.highlightAnimation)===null||r===void 0||r.cancel();for(var s=c.options[0].computedStyle,o={fontSize:s.fontSize,fontFamily:s.fontFamily},a=getComputedStyle(document.body).fontSize,B=Ve(a).val,g=getComputedStyle(c.options[0].container.firstChild),F=c.width/t.LONG_SUGGESTION_DISPLAY_LIMIT,u=new v(g.paddingLeft||"4px"),I=new v(g.paddingRight||"4px"),y={paddingWidth:u.val+I.val,emSize:B,styleForFont:o,collapsedWidth:F,minWidth:0},Q=0,h=0,C=[],b=0;b<t.SUGGESTION_LIMIT;b++){var x=c.options[b];if(l.length>b){var G=l[b];x.update(G,y),x.collapsedWidth<x.expandedWidth&&C.push(x),Q+=x.collapsedWidth,h++}else x.update(null,y)}if(h=h||1,Q<c.width){for(var X=c.width*.01*(h-1),m=function(){var Z=(c.width-Q-X)/C.length;C.sort(function(S,L){return S.expandedWidth-L.expandedWidth});var W=C[0],A=W.expandedWidth-W.collapsedWidth,k=Math.min(A,Z);k>0&&(C.forEach(function(S){return S.minWidth=S.collapsedWidth+k}),Q+=k*C.length),C.splice(0,1)};Q<c.width&&C.length>0;)m();for(var p=(c.width-Q-X)/h,b=0;b<h;b++){var x=c.options[b];x.minWidth=x.collapsedWidth+p,x.updateLayout()}}for(var b=0;b<t.SUGGESTION_LIMIT-1;b++)c.separators[b].style.display=b<h-1?"":"none"},c.hostDevice=e,c.getDiv().className=c.getDiv().className+" "+t.BANNER_CLASS,c.container=document.createElement("div"),c.container.className=Zs,c.getDiv().appendChild(c.container),c.buildInternals(!1),c.events=new _i.default,c.gestureEngine=c.setupInputHandling(),c}return t.prototype.buildInternals=function(e){this.isRTL=e,this.options.length>0&&(this.options=[],this.separators=[]);for(var n=0;n<t.SUGGESTION_LIMIT;n++){var c=new vs(n,e);this.options[n]=c}for(var n=0;n<t.SUGGESTION_LIMIT;n++){var l=e?t.SUGGESTION_LIMIT-n-1:n;if(this.container.appendChild(this.options[l].div),e&&(this.container.scrollLeft=this.container.scrollWidth),n!=t.SUGGESTION_LIMIT-1){var r=T("div");r.className="kmw-banner-separator";var s=r.style;s.marginLeft="calc(".concat(t.MARGIN/2,"% - 0.5px)"),s.marginRight="calc(".concat(t.MARGIN/2,"% - 0.5px)"),this.container.appendChild(r),this.separators[l-(e?1:0)]=r}}},t.prototype.setupInputHandling=function(){var e=this,n=new ye(this.getDiv(),[-Number.MAX_SAFE_INTEGER]);this.selectionBounds=new ye(this.getDiv(),[-Di*this.height,-Number.MAX_SAFE_INTEGER]);var c={targetRoot:this.getDiv(),maxRoamingBounds:n,safeBounds:n,itemIdentifier:function(a,B){var g,F,u=e.selectionBounds.getBoundingClientRect();if(a.clientX<u.left||a.clientX>u.right||a.clientY<u.top||a.clientY>u.bottom)return null;var I=null,y=Number.MAX_VALUE;try{for(var Q=(0,d.__values)(e.options),h=Q.next();!h.done;h=Q.next()){var C=h.value,b=C.div.getBoundingClientRect();if(b.left<=a.clientX&&a.clientX<b.right)return C;var x=(a.clientX<b.left?-1:1)*(a.clientX-b.left);x<y&&(y=x,I=C)}}catch(G){g={error:G}}finally{try{h&&!h.done&&(F=Q.return)&&F.call(Q)}finally{if(g)throw g.error}}return I}},l=new ht(Yi,c),r={source:null,scrollingHandler:null,suggestion:null},s=function(a){a.highlight(!0),e.highlightAnimation&&(e.highlightAnimation.cancel(),e.highlightAnimation.decouple()),e.highlightAnimation=new Ki(e.container,a,!1),e.highlightAnimation.expand()},o=function(a){a.highlight(!1),e.highlightAnimation||(e.highlightAnimation=new Ki(e.container,a,!1)),e.highlightAnimation.collapse()};return l.on("inputstart",function(a){if(r.source){a.terminate(!0);return}e.scrollState=new Oi(a.currentSample,e.container.scrollLeft);var B=a.baseItem;r.source=a,r.scrollingHandler=function(F){var u=e.scrollState.updateTo(F);e.highlightAnimation.setBaseScroll(u);var I=F.item?B:null;I!=r.suggestion&&(r.suggestion&&o(r.suggestion),r.suggestion=I,I&&s(I))},r.suggestion=a.currentSample.item,s(r.suggestion),a.currentSample.item.highlight(!0);var g=function(){r.suggestion&&(o(r.suggestion),r.suggestion=null),r.source=null,r.scrollingHandler=null};a.path.on("complete",g),a.path.on("invalidated",g),a.path.on("step",r.scrollingHandler)}),l.on("recognizedgesture",function(a){a.once("stage",function(B){var g=B.item;g&&!e.scrollState.hasScrolled&&e.predictionContext.accept(g.suggestion).then(function(){e.container.scrollLeft=e.isRTL?e.container.scrollWidth:0}),e.scrollState=null})}),l},t.prototype.update=function(){var e,n=i.prototype.update.call(this);return(e=this.selectionBounds)===null||e===void 0||e.updatePadding([-Di*this.height,-Number.MAX_SAFE_INTEGER]),n},t.prototype.configureForKeyboard=function(e,n){var c=e.isRTL;this.container.textContent="",this.buildInternals(c),this.options.forEach(function(l){return l.matchKeyboardProperties(n)}),this.onSuggestionUpdate(this.currentSuggestions)},Object.defineProperty(t.prototype,"predictionContext",{get:function(){return this._predictionContext},set:function(e){this._predictionContext&&this._predictionContext.off("update",this.onSuggestionUpdate),this._predictionContext=e,e&&(e.on("update",this.onSuggestionUpdate),this.onSuggestionUpdate(e.currentSuggestions))},enumerable:!1,configurable:!0}),t.SUGGESTION_LIMIT=8,t.LONG_SUGGESTION_DISPLAY_LIMIT=3,t.MARGIN=1,t}(ue);var Ki=function(){function i(t,e,n){var c=this;this.setScrollOffset=function(){if(!!c.scrollContainer){var l=c.option.currentWidth-c.option.collapsedWidth,r=c.option.rtl,s=Math.max(c.rootScrollOffset-c.option.div.offsetLeft,0),o=Math.max(c.option.div.offsetLeft+c.option.collapsedWidth-(c.rootScrollOffset+c.scrollContainer.offsetWidth)),a=Math.max(r?o:s,0),B=Math.max(c.collapsedScrollOffset+(r?0:1)*l,0)+(r?0:-1)*a,g=Math.max(c.rootScrollOffset+(r?0:1)*l,0)+(r?0:-1)*a,F=r?Math.max(B,g):Math.min(B,g),u=Math.max(r?c.option.div.offsetLeft+c.option.currentWidth-(F+c.scrollContainer.offsetWidth):F-c.option.div.offsetLeft,0),I=Math.min(l,u),y=B+(r?1:-1)*I+(r?0:1)*a;if(c.scrollContainer.scrollLeft=y,c.pendingAnimation){var Q=c.scrollContainer.scrollLeft-y;c.option.currentWidth+=Q}}},this._expand=function(l){if(c.startTimestamp!==void 0){var r=l-c.startTimestamp,s=r>i.TRANSITION_TIME;s&&(r=i.TRANSITION_TIME);var o=c.option.expandedWidth-c.option.collapsedWidth,a=r/i.TRANSITION_TIME,B=o*a;c.option.currentWidth=B+c.option.collapsedWidth,s?c.clear():c.pendingAnimation=window.requestAnimationFrame(c._expand),c.setScrollOffset()}},this._collapse=function(l){if(c.startTimestamp!==void 0){var r=l-c.startTimestamp,s=r>i.TRANSITION_TIME;s&&(r=i.TRANSITION_TIME);var o=c.option.expandedWidth-c.option.collapsedWidth,a=1-r/i.TRANSITION_TIME,B=o*a;c.option.currentWidth=B+c.option.collapsedWidth,s?c.clear():c.pendingAnimation=window.requestAnimationFrame(c._collapse),c.setScrollOffset()}},this.scrollContainer=t,this.option=e,this.collapsedScrollOffset=t.scrollLeft,this.rootScrollOffset=t.scrollLeft}return i.prototype.setBaseScroll=function(t){this.collapsedScrollOffset=t,this.option.rtl?t>this.rootScrollOffset&&(this.rootScrollOffset=t):t<this.rootScrollOffset&&(this.rootScrollOffset=t),window.requestAnimationFrame(this.setScrollOffset)},i.prototype.decouple=function(){this.cancel(),this.scrollContainer=null},i.prototype.clear=function(){this.startTimestamp=null,window.cancelAnimationFrame(this.pendingAnimation),this.pendingAnimation=null},i.prototype.cancel=function(){this.clear(),this.option.currentWidth=this.option.collapsedWidth},i.prototype.expand=function(){this.clear(),this.startTimestamp=performance.now();var t=this.option.currentWidth-this.option.collapsedWidth,e=this.option.expandedWidth-this.option.collapsedWidth;t!=0&&(this.startTimestamp-=t/e*i.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._expand)},i.prototype.collapse=function(){this.clear(),this.startTimestamp=performance.now();var t=this.option.expandedWidth-this.option.currentWidth,e=this.option.expandedWidth-this.option.collapsedWidth;t!=0&&(this.startTimestamp-=t/e*i.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._collapse)},i.TRANSITION_TIME=250,i}();var Pi=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;n.type="html";var c=n.getDiv(),l=document.createElement("div");return l.style.userSelect="none",l.style.height="100%",l.style.width="100%",c.appendChild(l),n.container=l.attachShadow?l.attachShadow({mode:"closed"}):l,n.container.innerHTML=e,n}return Object.defineProperty(t.prototype,"innerHTML",{get:function(){return this.container.innerHTML},set:function(e){this.container.innerHTML=e},enumerable:!1,configurable:!0}),t}(ue);var qn=function(){function i(t,e,n){this.ImageBanner=Fi,this.HTMLBanner=Pi,this.hostDevice=e,this.container=t,this.predictionContext=n,this.inactiveBanner=new Pe}return Object.defineProperty(i.prototype,"inactiveBanner",{get:function(){return this._inactiveBanner},set:function(t){this._inactiveBanner=t!=null?t:new Pe,this.container.banner instanceof He||(this.container.banner=this._inactiveBanner)},enumerable:!1,configurable:!0}),i.prototype.activateBanner=function(t){var e=this,n,c=this.container.banner;if(c instanceof He&&(c.predictionContext=null),!t)this.container.banner=this.inactiveBanner;else{var l=n=new He(this.hostDevice,this.container.activeBannerHeight);l.predictionContext=this.predictionContext,l.events.on("apply",function(r){return e.predictionContext.accept(r.suggestion)}),this.container.banner=l}},i.prototype.selectBanner=function(t){this.activateBanner(t=="active"||t=="configured"),this.keyboard&&this.container.banner.configureForKeyboard(this.keyboard,this.keyboardStub)},i.prototype.configureForKeyboard=function(t,e){this.keyboard=t,this.keyboardStub=e,this.container.banner.configureForKeyboard(t,e)},i.prototype.shutdown=function(){this.container.banner instanceof He&&(this.container.banner.predictionContext=null)},i}();var fs=function(){function i(){var t=this.element=document.createElement("div");t.style.userSelect="none",t.className="kmw-osk-none"}return i.prototype.postInsert=function(){},i.prototype.updateState=function(){},i.prototype.refreshLayout=function(){},Object.defineProperty(i.prototype,"layoutHeight",{get:function(){return v.inPixels(0)},enumerable:!1,configurable:!0}),i}(),_t=fs;var Ls=function(){function i(t){this.kbd=t;var e=this.element=document.createElement("div");e.style.userSelect="none",e.className="kmw-osk-static",e.id=i.ID,e.innerHTML=t.helpText}return i.prototype.postInsert=function(){if(!this.element.parentElement||!document.getElementById(i.ID))throw new Error("The HelpPage root element has not yet been inserted into the DOM.");this.kbd.hasScript&&this.kbd.embedScript(this.element.parentElement)},i.prototype.updateState=function(){},i.prototype.refreshLayout=function(){},Object.defineProperty(i.prototype,"layoutHeight",{get:function(){return v.inPercent(100)},enumerable:!1,configurable:!0}),i.ID="kmw-osk-help-page",i}(),ji=Ls;var ul=R(H(),1);var Js={"*Shift*":8,"*Enter*":5,"*Tab*":6,"*BkSp*":4,"*Menu*":11,"*Hide*":10,"*Alt*":25,"*Ctrl*":1,"*Caps*":3,"*ABC*":16,"*abc*":17,"*123*":19,"*Symbol*":21,"*Currency*":20,"*Shifted*":9,"*AltGr*":2,"*TabLeft*":7,"*LAlt*":86,"*RAlt*":87,"*LCtrl*":88,"*RCtrl*":89,"*LAltCtrl*":96,"*RAltCtrl*":97,"*LAltCtrlShift*":98,"*RAltCtrlShift*":99,"*AltShift*":100,"*CtrlShift*":101,"*AltCtrlShift*":102,"*LAltShift*":103,"*RAltShift*":104,"*LCtrlShift*":105,"*RCtrlShift*":112,"*LTREnter*":5,"*LTRBkSp*":4,"*RTLEnter*":113,"*RTLBkSp*":114,"*ShiftLock*":115,"*ShiftedLock*":116,"*ZWNJ*":117,"*ZWNJiOS*":117,"*ZWNJAndroid*":118,"*ZWNJGeneric*":121,"*Sp*":128,"*NBSp*":130,"*NarNBSp*":131,"*EnQ*":132,"*EmQ*":133,"*EnSp*":134,"*EmSp*":135,"*PunctSp*":140,"*ThSp*":141,"*HSp*":142,"*ZWSp*":129,"*ZWJ*":119,"*WJ*":120,"*CGJ*":122,"*LTRM*":144,"*RTLM*":145,"*SH*":161,"*HTab*":162},Pt=Js;var Ss=["default","shift","shift-on","special","special-on","","","","deadkey","blank","hidden"],we=Ss;function Oe(i,t){switch(i){case"*ZWNJ*":i=t.device.OS==V.OperatingSystem.Android?"*ZWNJAndroid*":"*ZWNJiOS*";break;case"*Enter*":i=t.isRTL?"*RTLEnter*":"*LTREnter*";break;case"*BkSp*":i=t.isRTL?"*RTLBkSp*":"*LTRBkSp*";break;default:}var e=57344+Pt[i];return Pt[i]?String.fromCharCode(e):i}var Rs=function(){function i(t,e){this.spec=t,this.layer=e}return i.prototype.setButtonClass=function(){var t,e=this.spec,n=this.btn,c=0;typeof e.dk=="string"&&e.dk=="1"&&(c=8),c=(t=e.sp)!==null&&t!==void 0?t:c,(c<0||c>10)&&(c=0),n.className="kmw-key kmw-key-"+we[c]},i.prototype.setToggleState=function(t){var e;switch(e=this.spec.sp,we[e]){case"shift":case"shift-on":t===void 0&&(t=we[e]=="shift"),this.spec.sp=1+(t?1:0);break;case"special":case"special-on":t===void 0&&(t=we[e]=="special"),this.spec.sp=3+(t?1:0);break;default:return}this.setButtonClass()},i.prototype.isFrameKey=function(){var t=this.spec.sp||0;switch(we[t]){case"default":case"deadkey":return!1;default:return!0}},i.prototype.allowsKeyTip=function(){return this.isFrameKey()?!1:!this.btn.classList.contains("kmw-spacebar")},i.prototype.highlight=function(t){var e=this.btn.classList;t?e.contains(i.HIGHLIGHT_CLASS)||e.add(i.HIGHLIGHT_CLASS):e.remove(i.HIGHLIGHT_CLASS)},i.prototype.getIdealFontSize=function(t,e,n,c){var l=getComputedStyle(this.btn),r=parseFloat(l.width),s=1,o=Ve(n.fontSize||"1em");l.fontSize?c||(n=l):(s=t.getKeyEmFontSize(),r=this.getKeyWidth(t));var a=Ve(n.fontSize||"1em"),B=xt(e,s,n),g=.9,F=.9,u=2,I,y;B.fontBoundingBoxAscent&&(I=B.fontBoundingBoxAscent+B.fontBoundingBoxDescent);var Q=I!=null?I:0;n.height&&n.height.indexOf("px")!=-1&&(y=Number.parseFloat(n.height.substring(0,n.height.indexOf("px"))));var h=r*g/(B.width+u),C=Q&&y?y*F/Q:void 0,b=h;return C&&C<h&&(b=C),b<1?o.absolute?b*a.val+"px":b*o.val+"em":o.absolute?a.val+"px":o.val+"em"},i.prototype.getKeyWidth=function(t){var e=this.spec;return e.proportionalWidth*t.width},Object.defineProperty(i.prototype,"keyText",{get:function(){var t=this.spec,e="\xA0",n=null;return t.text==null||t.text==""?n=e:(n=t.text,n=="*Tab*"&&this.layer=="shift"&&(n="*TabLeft*")),n},enumerable:!1,configurable:!0}),i.prototype.generateKeyText=function(t){var e=this.spec,n=document.createElement("span"),c=n.style;n.className="kmw-key-text";var l=this.keyText,r=Oe(l,t);r!=l&&(l=r,e.font="SpecialOSK"),typeof e.font=="string"&&e.font!=""&&(c.fontFamily=e.font),typeof e.fontsize=="string"&&e.fontsize!=""&&(c.fontSize=e.fontsize);var s={fontSize:c.fontSize};c.fontFamily?s.fontFamily=c.fontFamily:s.fontFamily=t.fontFamily;var o=t.getKeyEmFontSize(),a=xt(l,o,s).width;return a==0&&l!=""&&l!="\xA0"&&t.isRTL&&(l="\u200F"+l),c.fontSize=this.getIdealFontSize(t,l,s),n.innerText=l,n},i.prototype.refreshLayout=function(t){if(this.label)if(!this.label.classList.contains("kmw-spacebar-caption"))this.label.style.fontSize=this.getIdealFontSize(t,this.keyText,this.btn.style);else{this.label.style.fontSize="";var e=this.getIdealFontSize(t,this.label.textContent,getComputedStyle(this.label),!0);this.label.style.setProperty("font-size",e,"important")}},i.specialCharacters=Pt,i.BUTTON_CLASSES=we,i.HIGHLIGHT_CLASS="kmw-key-touched",i}(),We=Rs;var jt=function(){function i(t,e){this.key=t,this.keyId=e}return i}();function qt(i,t){var e=i;for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e}function As(i){return i&&"key"in i&&i.key instanceof We}function $t(i){return As(i)?i:null}var Hs=function(i){(0,d.__extends)(t,i);function t(e,n,c){var l=i.call(this,e,n)||this;return l.row=c,l}return t.prototype.getId=function(){return this.spec.elementID},t.prototype.getCoreId=function(){return this.spec.coreID},t.prototype.getBaseId=function(){return this.spec.baseKeyID},t.prototype.generateKeyCapLabel=function(){var e=U.keyCodes[this.spec.baseKeyID];switch(e){case 186:e=59;break;case 187:e=61;break;case 188:e=44;break;case 189:e=45;break;case 190:e=46;break;case 191:e=47;break;case 192:e=96;break;case 219:e=91;break;case 220:e=92;break;case 221:e=93;break;case 222:e=39;break;default:(e<48||e>90)&&(e=0)}var n=document.createElement("div");return n.className="kmw-key-label",e>0&&(n.innerText=String.fromCharCode(e)),n},t.prototype.processSubkeys=function(e,n){var c,l=e.subKeys=this.spec.sk;for(c=0;c<l.length;c++){if(l[c].sp==1||l[c].sp==2){var r=l[c].text;l[c].text=Oe(r,n)}l[c].layer||(l[c].layer=e.key.layer)}},t.prototype.construct=function(e){var n=this.spec,c=document.createElement("div");c.className="kmw-key-square";var l=document.createElement("div"),r=this.btn=qt(l,new jt(this,n.id));this.setButtonClass();var s=this.capLabel=this.generateKeyCapLabel();r.appendChild(s),r.id=this.getId(),r.appendChild(this.label=this.generateKeyText(e)),typeof n.sk!="undefined"&&n.sk!=null?this.processSubkeys(r,e):r.subKeys=null;var o=this.generateHint(e);return r.appendChild(o),c.appendChild(r),this.preview=document.createElement("div"),this.preview.style.display="none",r.appendChild(this.preview),this.square=c},t.prototype.generateHint=function(e){var n=document.createElement("div");n.className="kmw-key-popup-icon";var c=this.spec.hintSrc;if(!c)return n;if(c.font&&c.font!="SpecialOSK"?n.style.fontFamily=c.font:n.classList.add("kmw-key-text"),c.fontsize){var l=new v(c.fontsize);n.style.fontSize=l.scaledBy(.5).styleString}var r=c==this.spec?this.spec.hint:c.text,s=Oe(r,e);return s=="\u2022"&&(n.style.fontWeight="bold"),r!=s&&(n.style.fontFamily="SpecialOSK"),n.textContent=s,n},t.prototype.setPreview=function(e){var n=this,c=this.preview;e?(this.previewHost=e,this.preview=this.previewHost.element):(this.previewHost=null,this.preview=document.createElement("div"),this.preview.style.display="none"),e==null||e.setCancellationHandler(function(){n.setPreview(null)}),this.btn.replaceChild(this.preview,c)},t.prototype.refreshLayout=function(e){var n=this.spec;this.square.style.width=e.layoutWidth.scaledBy(n.proportionalWidth).styleString,this.square.style.marginLeft=e.layoutWidth.scaledBy(n.proportionalPad).styleString,this.btn.style.width=e.usesFixedWidthScaling?this.square.style.width:"100%",e.usesFixedHeightScaling?this.square.style.height=e.internalHeight.scaledBy(this.row.heightFraction).styleString:this.square.style.height="100%",i.prototype.refreshLayout.call(this,e);var c=e.device,l=c.OS==V.OperatingSystem.iOS&&c.formFactor==V.FormFactor.Phone&&ee();l&&this.capLabel&&(this.capLabel.style.fontSize="6px")},Object.defineProperty(t.prototype,"displaysKeyCap",{get:function(){return this.capLabel&&this.capLabel.style.display=="block"},set:function(e){if(!this.capLabel)throw new Error("Key element not yet constructed; cannot display key cap");this.capLabel.style.display=e?"block":"none"},enumerable:!1,configurable:!0}),t}(We),qi=Hs;var Ws=function(){function i(t,e,n){var c=this.element=document.createElement("div");c.className="kmw-key-row",this.heightFraction=1/e.row.length;var l=n.key;this.keys=[];for(var r=0;r<l.length;r++){var s=l[r],o=new qi(s,e.id,this),a=o.construct(t);this.keys.push(o),c.appendChild(a)}}return Object.defineProperty(i.prototype,"displaysKeyCaps",{get:function(){if(this.keys.length>0)return this.keys[0].displaysKeyCap},set:function(t){var e,n;try{for(var c=(0,d.__values)(this.keys),l=c.next();!l.done;l=c.next()){var r=l.value;r.displaysKeyCap=t}}catch(s){e={error:s}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}},enumerable:!1,configurable:!0}),i.prototype.refreshLayout=function(t){var e,n,c=this.element.style,l=t.internalHeight.scaledBy(this.heightFraction);c.maxHeight=c.lineHeight=c.height=l.styleString;var r=.15,s=t.usesFixedHeightScaling?l:v.forScalar(1),o=s.scaledBy(r/2),a=s.scaledBy(1-r);try{for(var B=(0,d.__values)(this.keys),g=B.next();!g.done;g=B.next()){var F=g.value,u=F.btn.parentElement,I=F.btn,y=u.style;y.height=y.minHeight=s.styleString;var Q=I.style;Q.top=o.styleString,Q.height=Q.lineHeight=Q.minHeight=a.styleString,I.key&&I.key.refreshLayout(t)}}catch(h){e={error:h}}finally{try{g&&!g.done&&(n=B.return)&&n.call(B)}finally{if(e)throw e.error}}},i}(),$i=Ws;var Ns=function(){function i(t,e,n){this.spec=n;var c=this.element=document.createElement("div"),l=c.style;c.className="kmw-key-layer";var r=n.row.length;r>4&&t.device.formFactor=="phone"&&(c.className=c.className+" kmw-5rows"),l.fontFamily="font"in e?e.font:"",this.nextlayer=c.layer=n.id,typeof n.nextlayer=="string"&&(c.nextLayer=this.nextlayer=n.nextlayer);var s=n.row;this.rows=[];for(var o=0;o<s.length;o++){var a=new $i(t,n,s[o]);a.displaysKeyCaps=e.displayUnderlying,c.appendChild(a.element),this.rows.push(a)}t.device.touchable&&(this.globeKey=this.findKey("K_LOPT"),this.hideKey=this.findKey("K_ROPT")),this.spaceBarKey=this.findKey("K_SPACE"),this.capsKey=this.findKey("K_CAPS"),this.numKey=this.findKey("K_NUMLOCK"),this.scrollKey=this.findKey("K_SCROLL")}return Object.defineProperty(i.prototype,"rowHeight",{get:function(){return this._rowHeight},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this.spec.id},enumerable:!1,configurable:!0}),i.prototype.findKey=function(t){var e,n,c,l;try{for(var r=(0,d.__values)(this.rows),s=r.next();!s.done;s=r.next()){var o=s.value;try{for(var a=(c=void 0,(0,d.__values)(o.keys)),B=a.next();!B.done;B=a.next()){var g=B.value;if(g.getBaseId()==t)return g}}catch(F){c={error:F}}finally{try{B&&!B.done&&(l=a.return)&&l.call(a)}finally{if(c)throw c.error}}}}catch(F){e={error:F}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return null},i.prototype.refreshLayout=function(t,e){var n=this.rows.length,c=this._rowHeight=Math.floor(e/(n==0?1:n));t.usesFixedHeightScaling&&(this.element.style.height=e+"px");for(var l=0;l<n;l++){var r=this.rows[l],s=(n-l-1)*c+1;t.usesFixedHeightScaling&&(this.spec.row[l].proportionalY=(e-s-c/2)/e,l==n-1&&(r.element.style.bottom="1px")),r.refreshLayout(t)}},i}(),el=Ns;var Ts=function(){function i(t,e,n){this.layers={},this._activeLayerId="default";var c=e.layout(n);this.spec=c;var l=this.element=document.createElement("div"),r=l.style;if(l.className="kmw-key-layer-group",c!=null){var s=c.fontsize;typeof s=="undefined"||s==null||s==""?r.fontSize="1em":r.fontSize=c.fontsize,r.width="100%",r.height="100%";var o,a,B,g;g=c.layer;var F=t.getDefaultKeyObject();for(F.fontsize=r.fontSize,o=0;o<g.length;o++){var u=g[o],I=new el(t,c,u);this.layers[u.id]=I,I.element.style.display=u.id=="default"?"block":"none",l.appendChild(I.element)}}}return Object.defineProperty(i.prototype,"activeLayerId",{get:function(){return this._activeLayerId},set:function(t){var e,n;this._activeLayerId=t;try{for(var c=(0,d.__values)(Object.keys(this.layers)),l=c.next();!l.done;l=c.next()){var r=l.value,s=this.layers[r],o=s.element;s.id==t?o.style.display="block":o.style.display="none"}}catch(a){e={error:a}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}},enumerable:!1,configurable:!0}),i.prototype.findNearestKey=function(t){if(!t)return null;var e=t.stateToken;if(!e)throw new Error("Layer id not set for input coordinate");var n=this.layers[e];if(!n)throw new Error("Layer id ".concat(e," could not be found"));return this.blinkLayer(n),this.nearestKey(t,n)},i.prototype.blinkLayer=function(t){var e=this;if(typeof t=="string"){var n=t;if(t=this.layers[n],!t)throw new Error("Layer id ".concat(n," could not be found"))}var c=t;if(c.element.style.display!="block")for(var l in this.layers){if(this.layers[l].element.style.display=="block"){var r=this.layers[l];r.element.style.display="none"}this.layers[l].element.style.display="none"}c.element.style.display="block",Promise.resolve().then(function(){var s=e.layers[e._activeLayerId];(c.element.style.display=="block"||s.element.style.display!="block")&&(c.element.style.display="none",s.element.style.display="block")})},i.prototype.nearestKey=function(t,e){var n,c,l=this.element.getBoundingClientRect(),r=null,s=Number.MAX_VALUE;try{for(var o=(0,d.__values)(e.rows),a=o.next();!a.done;a=o.next()){var B=a.value,g=B.element.getBoundingClientRect();if(g.top<=t.clientY&&t.clientY<g.bottom){r=B;break}else{var F=g.top>t.clientY?g.top-t.clientY:t.clientY-g.bottom;F<s&&(s=F,r=B)}}}catch(Z){n={error:Z}}finally{try{a&&!a.done&&(c=o.return)&&c.call(o)}finally{if(n)throw n.error}}for(var u=0,I,y=24,Q=1e5,h=t.clientX,C=0;C<r.keys.length;C++){var b=r.keys[C].square,x=b.getBoundingClientRect(),G=b.firstChild?b.firstChild:b;if(!(G.className!==void 0&&(G.className.indexOf("key-hidden")>=0||G.className.indexOf("key-blank")>=0))){var X=x.left,m=x.right;if(h>=X&&h<=m)return G;I=X-h,I>=0&&I<Q&&(u=C,Q=I),I=h-m,I>=0&&I<Q&&(u=C,Q=I)}}if(Q<1e5){var p=r.keys[u].square,x=p.getBoundingClientRect(),X=x.left,m=x.right;if(x.width>40&&(y=.6*x.width),X-h>=0&&X-h<y||h-m>=0&&h-m<y)return p.firstChild}return null},i}(),tl=Ts;var nl="kmw-",cl="top",Es=function(){function i(t,e){var n=this;this.state=!1,this.orientation=cl,this.vkbd=t;var c=this.element=document.createElement("div");c.className="kmw-keytip",c.id="kmw-keytip",c.style.pointerEvents="none",c.style.display="none",c.appendChild(this.tip=document.createElement("div")),c.appendChild(this.cap=document.createElement("div")),this.tip.appendChild(this.preview=document.createElement("div")),this.tip.className="kmw-keytip-tip",this.cap.className="kmw-keytip-cap",this.constrain=e,this.reorient=function(l){n.orientation=l,n.show(n.key,n.state,n.previewHost)}}return i.prototype.show=function(t,e,n){var c=this,l,r=this.vkbd;if(e&&r.layerGroup.blinkLayer(t.key.spec.displayLayer),e&&t.offsetParent){var s=t.key.row.element,o=t.getClientRects()[0],a=s.getClientRects()[0],B=o.left-a.left,g=o.width,F=o.height,u=t.key.label,I=1.8,y=this.element.style,Q=r.topContainer,h=Q.getBoundingClientRect(),C=t.getBoundingClientRect(),b=void 0,x=this.orientation,G=C.bottom-h.top;b=G+(x=="top"?1:-1);var X=b-Math.floor(b),m=g+Math.ceil(g*.3)*2,p=Math.ceil(2.3*F)+X;y.top="auto";var Z=x=="top"?"bottom":"top";this.tip.classList.remove("".concat(nl).concat(Z)),this.tip.classList.add("".concat(nl).concat(x)),x=="bottom"&&(b+=p-F),y.bottom=Math.floor(h.height-b)+"px",y.textAlign="center",y.overflow="visible",y.width=m+"px",y.height=p+"px";var W=this.vkbd.currentLayer.element.style.fontFamily,A=getComputedStyle(r.element);y.fontFamily=t.key.spec.font||W||A.fontFamily;var k=parseInt(A.fontSize,10);if(k==Number.NaN&&(k=0),k!=0){var S=I*k,L={fontFamily:y.fontFamily,fontSize:S+"px",height:1.6*F+"px"};y.fontSize=t.key.getIdealFontSize(r,t.key.keyText,L,!0)}var f=(m-g)/2;B<f?(this.cap.style.left="1px",B+=f-1):B>window.innerWidth-g-f?(this.cap.style.left=m-g-1+"px",B-=f-1):this.cap.style.left=f+"px",y.left=B-f+"px";var E=getComputedStyle(this.element),Y=h.height,N=parseFloat(E.bottom),Ne=parseFloat(E.height),Ue=Math.ceil(p/2);this.cap.style.width=g+"px",this.tip.style.height=Ue+"px";var nt=3,ct=Ue-nt+"px";x=="top"?(this.cap.style.top=ct,this.cap.style.bottom=""):(this.cap.style.top="",this.cap.style.bottom=ct);var it=G-Math.floor(b)+p-(x=="top"?Ue:-nt*2);if(this.cap.style.height=it+"px",this.constrain&&Ne+N>Y){var Te=Ne+N-Y;y.height=p-Te+"px";var lt=Math.max(0,p-Te-p/2+2);this.cap.style.height=lt+"px"}else N<0&&(y.bottom="0px",this.cap.style.height=Math.max(0,it+N)+"px");if(y.display="block",this.previewHost==n)return;var vt=this.preview;this.previewHost&&this.previewHost.off("preferredOrientation",this.reorient),this.previewHost=n,n&&(this.previewHost.on("preferredOrientation",this.reorient),this.preview=this.previewHost.element,this.tip.replaceChild(this.preview,vt),n.setCancellationHandler(function(){return c.show(null,!1,null)}),n.on("startFade",function(){c.element.classList.remove("kmw-preview-fade"),c.element.offsetWidth,c.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",(l=this.previewHost)===null||l===void 0||l.off("preferredOrientation",this.reorient),this.previewHost=null;var zl=this.preview;this.preview=document.createElement("div"),this.tip.replaceChild(this.preview,zl),this.element.classList.remove("kmw-preview-fade"),this.orientation=cl}this.key=t,this.state=e},i}(),il=Es;var $n="kmw-keypreview",ks="kmw-preview-overlay",Ys="kmw-keytip",ll=function(){function i(t){this.state=!1,this.vkbd=t;var e=this.element=document.createElement("div");e.className=$n,e.id="kmw-keytip",e.style.pointerEvents="none",e.style.display="none",this.preview=document.createElement("div"),e.appendChild(this.preview)}return i.prototype.show=function(t,e,n){var c=this,l=this.vkbd,r=t==null?void 0:t.key.spec.displayLayer;if(e&&l.layerGroup.blinkLayer(r),e&&(t==null?void 0:t.offsetParent)){var s=this.vkbd.topContainer.getBoundingClientRect(),o=t.getBoundingClientRect(),a=r!=l.layerId?ks:"";this.element.className="".concat($n," ").concat(t.className," ").concat(a),this.element.id="".concat(Ys,"-").concat(t.id);var B=this.element.style,g=this.vkbd.currentLayer.element.style.fontFamily;if(B.fontFamily=t.key.spec.font||g,B.left=o.left-s.left+"px",B.top=o.top-s.top+"px",B.width=o.width+"px",B.height=o.height+"px",this.element.style.display="block",this.previewHost==n)return;var F=this.preview;this.previewHost=n,n&&(this.preview=this.previewHost.element,this.element.replaceChild(this.preview,F),n.setCancellationHandler(function(){return c.show(null,!1,null)}),n.on("startFade",function(){c.element.classList.remove("kmw-preview-fade"),c.element.offsetWidth,c.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",this.element.className=$n,this.previewHost=null;var u=this.preview;this.preview=document.createElement("div"),this.element.replaceChild(this.preview,u),this.element.classList.remove("kmw-preview-fade")}this.key=t,this.state=e},i}();function Ie(i){try{if(i=="desktop")return 1;var t=document.documentElement.clientWidth;if(screen.width>t)return 1;var e=screen.width;return ee()?screen.width<screen.height&&(e=screen.height):screen.width>screen.height&&(e=screen.height),Math.round(100*e/t)/100}catch(n){return 1}}var rl=function(){function i(t,e){var n=this;this.directlyEmitsKeys=!0,this.hasModalVisualization=!1,this.deleteRepeater=function(){n.repeatClosure(),n.timerHandle=window.setTimeout(n.deleteRepeater,i.REPEAT_DELAY)},this.source=t;var c=t.stageReports[0].item;c.key.highlight(!0),this.repeatClosure=function(){e(),c.key.highlight(!0)},this.timerHandle=window.setTimeout(this.deleteRepeater,i.INITIAL_DELAY),this.source.on("complete",function(){window.clearTimeout(n.timerHandle),n.timerHandle=void 0,c.key.highlight(!1)})}return i.prototype.cancel=function(){this.deleteRepeater(),this.source.cancel()},i.prototype.currentStageKeyDistribution=function(){return null},i.INITIAL_DELAY=500,i.REPEAT_DELAY=100,i}();var ws=function(i){(0,d.__extends)(t,i);function t(e,n){if(typeof n!="string"||n=="")throw"The 'layer' parameter for subkey construction must be properly defined.";return i.call(this,e,n)||this}return t.prototype.getId=function(){return"popup-"+this.layer+"-"+this.spec.id},t.prototype.construct=function(e,n,c){var l=this.spec,r=document.createElement("div"),s=e.getDefaultKeyObject(),o=r.style;r.className="kmw-key-square-ex",c&&(o.marginTop="5px"),typeof l.width!="undefined"?o.width=l.width*n.offsetWidth/100+"px":o.width=n.offsetWidth+"px",o.height=n.offsetHeight+"px";var a=document.createElement("div"),B=this.btn=qt(a,new jt(this,l.id));this.setButtonClass(),B.id=this.getId();var g=B.style;return g.height=o.height,g.lineHeight=n.style.lineHeight,g.width=o.width,g.position="absolute",B.appendChild(this.label=this.generateKeyText(e)),r.appendChild(B),this.square=r},t.prototype.allowsKeyTip=function(){return!1},t}(We),sl=ws;var ol=.2,Os=1.2,Bl=3,Ms=5,al=6+Bl,Ds=function(){function i(t,e,n,c,l){var r=this;this.directlyEmitsKeys=!0,this.shouldLockLayer=!1,this.baseKey=c,this.source=t,this.gestureParams=l,n.layerLocked&&(this.shouldLockLayer=!0),t.on("complete",function(){var X;(X=r.currentSelection)===null||X===void 0||X.key.highlight(!1),r.clear()}),t.on("stage",function(){var X=r.currentSelection;if(X){var m=n.keyEventFromSpec(X.key.spec);m.keyDistribution=r.currentStageKeyDistribution(),n.raiseKeyEvent(m,X)}});var s=t.stageReports[0].sources[0].constructSubview(!0,!1);s.path.on("step",function(X){var m,p;s.path.stats.netDistance>=4&&((m=r.currentSelection)===null||m===void 0||m.key.highlight(!1),(p=X.item)===null||p===void 0||p.key.highlight(!0),r.currentSelection=X.item)}),this.currentSelection=c,c.key.highlight(!0);var o=c.subKeys,a=this.element=document.createElement("div"),B;a.id="kmw-popup-keys";var g=a.style;g.fontFamily=n.fontFamily;var F=getComputedStyle(c);g.fontSize=F.fontSize,g.visibility="hidden";var u=o.length,I,y;for(I=Math.min(Math.ceil(u/9),2),y=Math.ceil(u/I),this.menuWidth=y*c.offsetWidth+y*Ms,g.width=this.menuWidth+"px",this.subkeys=[],B=0;B<u;B++){var Q=!1,h=Math.floor(B/y);I>1&&h>0&&(Q=!0);var C=c.key.layer;(typeof C!="string"||C=="")&&(C=n.layerId);var b=new sl(o[B],C),x=b.construct(n,c,Q);this.subkeys.push(x.firstChild),a.appendChild(x)}this.shim=document.createElement("div"),this.shim.id="kmw-popup-shim",n.device.formFactor==V.FormFactor.Phone&&this.selectDefaultSubkey(c,a),n.element.appendChild(this.element),n.topContainer.appendChild(this.shim),this.reposition(n);var G=this.buildPopupRecognitionConfig(n);e({type:"push",config:G})}return i.prototype.buildPopupRecognitionConfig=function(t){var e=this,n=this.element.getBoundingClientRect(),c=this.baseKey.getBoundingClientRect(),l=this.subkeys[0].style,r=Number.parseInt(l.height,10),s=-.666*r,o=3,a=c.bottom-n.bottom,B=new ye(this.element,[s*o,s,-a<s?-a:s]),g={getBoundingClientRect:function(){var F=Number.MAX_SAFE_INTEGER;return new DOMRect(-F,-F,2*F,2*F)}};return{targetRoot:this.element,inputStartBounds:t.element,maxRoamingBounds:g,safeBounds:g,itemIdentifier:function(F,u){var I,y,Q=B.getBoundingClientRect(),h=null,C=Number.MAX_VALUE,b=Number.MAX_VALUE;if(F.clientX<Q.left||F.clientX>Q.right||F.clientY<Q.top||F.clientY>Q.bottom)return null;try{for(var x=(0,d.__values)(e.subkeys),G=x.next();!G.done;G=x.next()){var X=G.value,m=X.getBoundingClientRect(),p=Number.MAX_VALUE,Z=Number.MAX_VALUE;if(m.left<=F.clientX&&F.clientX<m.right?p=0:p=m.left>=F.clientX?m.left-F.clientX:F.clientX-m.right,m.top<=F.clientY&&F.clientY<m.bottom?Z=0:Z=m.top>=F.clientY?m.top-F.clientY:F.clientY-m.bottom,p==0&&Z==0)return X;(p<b||p==b&&Z<C)&&(b=p,h=X,C=Z)}}catch(W){I={error:W}}finally{try{G&&!G.done&&(y=x.return)&&y.call(x)}finally{if(I)throw I.error}}return h}}},i.prototype.reposition=function(t){var e=this.element,n=this.baseKey,c=t.topContainer,l=n.key.row.element,r=e.style,s=n.offsetParent?n.offsetParent.offsetLeft:0,o=n.offsetLeft+s+.5*(n.offsetWidth-e.offsetWidth),a=t.width-e.offsetWidth;o>a&&(o=a),o<0&&(o=0),r.left=o+"px";var B=c.getBoundingClientRect(),g=l.getBoundingClientRect();r.top=g.top-B.top-e.offsetHeight-Bl+"px",r.visibility="visible";var F=t.isEmbedded,u=getComputedStyle(e),I=parseFloat(u.top),y=0,Q=0;I<y&&F&&(Q=y-I,r.top=y+"px"),this.callout=this.addCallout(n,Q,t.element,t.topContainer,t.device.formFactor=="tablet")},i.prototype.addCallout=function(t,e,n,c,l){e=e||0;var r=getComputedStyle(this.element),s=Math.max(Number.parseInt(r.borderRadius),0),o=t.getBoundingClientRect(),a=c.getBoundingClientRect(),B=Math.floor(Number.parseInt(r.top,10)+Number.parseInt(r.height,10)+Number.parseInt(r.paddingTop,10)/2+Number.parseInt(r.paddingBottom,10)),g=ol*(o.height-e),F=ol*o.height,u=g+al,I=u/(F+al),y=o.bottom-a.top-B-1,Q=y<u?y:u;if(Q>0){var h=document.createElement("div"),C=h.style;h.id="kmw-popup-callout",n.appendChild(h),C.top=B+"px",C.borderTopWidth=Q+"px";var b=Os*I,x=o.width*b,G=this.menuWidth-2*s,X=G<x?G:x,m=o.left-a.left-(X-o.width)/2,p=Math.max(0,m+X-(a.right-s)),Z=Math.max(0,s-m);return C.left=o.left-a.left-(X-o.width)/2+Z+"px",C.borderLeftWidth=X/2-Z+"px",C.borderRightWidth=X/2-p+"px",h}else return null},i.prototype.selectDefaultSubkey=function(t,e){for(var n,c,l=t.subKeys,r=0;r<l.length;r++){var s=l[r],o=e.childNodes[r].firstChild;if(s.default){c=o;break}else if(!t.key||!t.key.spec)continue;s.elementID==t.key.spec.elementID&&(c=o)}c&&((n=this.currentSelection)===null||n===void 0||n.key.highlight(!1),this.currentSelection=c,c.key.highlight(!0))},Object.defineProperty(i.prototype,"hasModalVisualization",{get:function(){return this.element.style.visibility=="visible"},enumerable:!1,configurable:!0}),i.prototype.buildCorrectiveLayout=function(){var t=this.element.getBoundingClientRect(),e=t.width/t.height,n=this.subkeys.map(function(c){var l=c.getBoundingClientRect(),r={keySpec:c.key.spec,centerX:(l.right-l.width/2-t.left)/t.width,centerY:(l.bottom-l.height/2-t.top)/t.height,width:l.width/t.width,height:l.height/t.height};return r});return{keys:n,kbdScaleRatio:e}},i.prototype.currentStageKeyDistribution=function(){var t=this,e=this.source.stageReports[this.source.stageReports.length-1],n=this.source.stageReports[0],c=e.sources[0],l=c.currentSample,r=this.element.getBoundingClientRect(),s={x:l.targetX/r.width,y:l.targetY/r.height};s.x=s.x<0?0:s.x>1?1:s.x,s.y=s.y<0?0:s.y>1?1:s.y;var o=Nt(s,this.buildCorrectiveLayout()),a=o.get(l.item.key.spec),B=Math.min(c.path.stats.duration-n.sources[0].path.stats.duration,this.gestureParams.longpress.waitLength)/(2*this.gestureParams.longpress.waitLength),g=Math.min(c.path.stats.rawDistance,this.gestureParams.longpress.noiseTolerance*4)/(this.gestureParams.longpress.noiseTolerance*8),F=Math.min(B*B,g*g),u=a+F,I=new Map,y=this.subkeys.find(function(Q){return Q.keyId==t.baseKey.keyId});return y?I.set(y.key.spec,u):I.set(this.baseKey.key.spec,u),Se([o,I])},i.prototype.cancel=function(){this.clear(),this.source.cancel()},i.prototype.clear=function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.shim.parentNode&&this.shim.parentNode.removeChild(this.shim),this.callout&&this.callout.parentNode&&this.callout.parentNode.removeChild(this.callout)},i}(),ec=Ds;var zs=function(){function i(t,e,n){var c=this;this.directlyEmitsKeys=!0,this.shouldRestore=!1,this.hasModalVisualization=!1;var l=t.stageReports[0];this.originalLayer=l.sources[0].stateToken,this.source=t,this.completionCallback=function(){e.lockLayer(!1),c.shouldRestore&&(e.layerId=c.originalLayer,e.updateState()),n==null||n()},e.lockLayer(!0),t.on("stage",function(r){var s=r.matchedId;s.includes("modipress")&&s.includes("-end")?c.clear():s.includes("modipress")&&s.includes("-hold")&&(c.shouldRestore=!0)}),t.on("complete",function(){return c.cancel()})}return Object.defineProperty(i.prototype,"isLocked",{get:function(){return this.shouldRestore},enumerable:!1,configurable:!0}),i.prototype.setLocked=function(){this.shouldRestore=!0},Object.defineProperty(i.prototype,"completed",{get:function(){return this.completionCallback===null},enumerable:!1,configurable:!0}),i.prototype.clear=function(){var t=this.completionCallback;this.completionCallback=null,t==null||t()},i.prototype.cancel=function(){this.clear(),this.source.cancel()},i.prototype.currentStageKeyDistribution=function(t){return null},i}(),pt=zs;var Ks=function(){function i(t,e,n,c,l){var r=this;this.directlyEmitsKeys=!0,this.hasModalVisualization=!1,this.tapIndex=0,this.baseKey=n,this.baseContextToken=c,this.multitaps=[n.key.spec].concat(n.key.spec.multitap),this.sequence=t;var s=function(F){var u;(u=r.modipress)===null||u===void 0||u.clear();var I=new pt(t,e,function(){r.modipress=e.activeModipress=null});r.modipress=e.activeModipress=I};this.originalLayer=e.layerId;var o=function(F){return(r.tapIndex+F)%r.multitaps.length},a=function(){l==null||l.setMultitapHint(r.multitaps[o(0)],r.multitaps[o(1)],e)};t.on("complete",function(){var F;(F=r.modipress)===null||F===void 0||F.cancel(),r.clear()});var B=function(F){var u;switch(F.matchedId){case"modipress-hold":r.clear(),t.off("stage",B);return;case"modipress-end-multitap-transition":case"modipress-multitap-end":case"modipress-end":case"multitap-end":case"simple-tap":return;case"modipress-multitap-lock-transition":(u=r.modipress)===null||u===void 0||u.setLocked();return;case"modipress-multitap-start":case"multitap-start":break;default:throw new Error("Unsupported gesture state encountered during multitap: ".concat(F.matchedId))}r.tapIndex=o(1);var I=r.multitaps[r.tapIndex];a();var y=e.keyEventFromSpec(I);y.baseTranscriptionToken=r.baseContextToken;var Q=F.sources[0].currentSample,h=e.getSimpleTapCorrectionDistances(Q,r.baseKey.key.spec);if(Q.stateToken!=e.layerId&&!F.matchedId.includes("modipress")){var C=e.layerGroup.findNearestKey((0,d.__assign)((0,d.__assign)({},Q),{stateToken:e.layerId})),b=h.get(C.key.spec);b==null&&console.warn("Could not find current layer's key"),h.delete(C.key.spec),h.set(Q.item.key.spec,b)}y.keyDistribution=r.currentStageKeyDistribution(h),y.kNextLayer||(y.kNextLayer=r.originalLayer),e.raiseKeyEvent(y,null),F.matchedId=="modipress-multitap-start"&&s(F)};t.on("stage",B);var g=t.stageReports[0];g.matchedId=="modipress-start"&&s(t.stageReports[0]),a()}return i.prototype.currentStageKeyDistribution=function(t){var e=this,n=Se(t),c=n.findIndex(function(y){return y.keySpec==e.baseKey.key.spec});if(c==-1)return bt(this.baseKey)||console.warn("Could not find base key's probability for multitap correction"),n;for(var l=n.splice(c,1)[0].p,r=0,s=[],o=0;o<this.multitaps.length;o++){var a=this.multitaps[o],B=Math.abs(o-this.tapIndex)%this.multitaps.length,g=(o+this.multitaps.length-this.tapIndex)%this.multitaps.length,F=B<g?B:g,u=1/((1+F)*(1+F));r+=u,s.push({keySpec:a,p:u})}var I=l/r;return s.forEach(function(y){y.p=I*y.p}),n.concat(s).sort(function(y,Q){return Q.p-y.p})},i.prototype.cancel=function(){this.clear(),this.sequence.cancel()},i.prototype.clear=function(){},i}(),dl=Ks;var gl=R(H(),1);var Gt=1.4142,tc=function(i){return Math.abs(i)<1e-10?0:i},Fl=function(i){(0,d.__extends)(t,i);function t(e,n,c,l){var r=this,s;r=i.call(this)||this,r.flickPreviews=new Map,r.orientation="top";var o=e.key.spec,a=r.flickEdgeLength=Math.max(c,l),B=r.div=document.createElement("div");B.className=B.id="kmw-gesture-preview",B.style.pointerEvents="none";var g=r.previewImgContainer=document.createElement("div");r.previewImgContainer.id="kmw-preview-img-container";var F=r.label=document.createElement("span");if(F.className="kmw-gesture-base-label kmw-key-text",F.id="kmw-gesture-base-label",g.appendChild(F),F.textContent=e.key.label.textContent,r.div.appendChild(r.previewImgContainer),o.flick){var u=o.flick||{};Object.keys(u).forEach(function(y){var Q=document.createElement("div");Q.className="kmw-flick-preview kmw-key-text",Q.textContent=u[y].text;var h=Q.style,C=zn.get(y),b=tc(-Math.sin(C[0])),x=tc(Math.cos(C[0]));h.width="100%",h.textAlign="center",b<0?h.right=-b*Gt*a+"px":b>0?h.left=b*Gt*a+"px":h.left="0px",h.height="100%",h.lineHeight="100%",x<0?h.bottom=-x*Gt*a+"px":x>0?h.top=x*Gt*a+"px":h.top="0px",r.flickPreviews.set(y,Q),g.appendChild(Q)})}var I=r.hintLabel=document.createElement("div");return I.className="kmw-key-popup-icon",n||(I.textContent=o==o.hintSrc?o.hint:(s=o.hintSrc)===null||s===void 0?void 0:s.text,I.style.fontWeight=I.textContent=="\u2022"?"bold":""),B.appendChild(I),r}return Object.defineProperty(t.prototype,"element",{get:function(){return this.div},enumerable:!1,configurable:!0}),t.prototype.refreshLayout=function(){var e=getComputedStyle(this.div),n=Number.parseInt(e.height,10);this.flickPreviews.forEach(function(c){c.style.lineHeight=c.style.height="".concat(n,"px")})},t.prototype.cancel=function(){var e;(e=this.onCancel)===null||e===void 0||e.call(this),this.onCancel=null},t.prototype.setCancellationHandler=function(e){this.onCancel=e},t.prototype.setMultitapHint=function(e,n,c){var l,r,s=Oe(e.text,c),o=Oe(n.text,c);this.label.textContent=s,this.hintLabel.textContent=o,this.label.style.fontFamily=s!=e.text?"SpecialOSK":(l=e.font)!==null&&l!==void 0?l:this.label.style.fontFamily,this.hintLabel.style.fontFamily=o!=n.text?"SpecialOSK":(r=n.font)!==null&&r!==void 0?r:this.hintLabel.style.fontFamily,this.emit("startFade"),this.clearFlick()},t.prototype.scrollFlickPreview=function(e,n){this.clearHint();var c=this.previewImgContainer.style,l=this.flickEdgeLength*Gt;c.marginLeft="".concat(l*e,"px"),c.marginTop="".concat(l*n,"px");var r=tc(n)<0?"bottom":"top";this.orientation!=r&&(this.orientation=r,this.emit("preferredOrientation",r))},t.prototype.clearFlick=function(){this.previewImgContainer.style.marginTop="0px",this.previewImgContainer.style.marginLeft="0px",this.previewImgContainer.classList.add("kmw-flick-clear")},t.prototype.clearHint=function(){this.hintLabel.classList.add("kmw-hint-clear")},t.prototype.clearAll=function(){this.clearFlick()},t}(gl.default);var _s=function(i){(0,d.__extends)(t,i);function t(e){var n=this,c,l;n=i.call(this)||this,n.gestureParams=(0,d.__assign)({},Kn),n._layerId="default",n.layerLocked=!1,n.layerIndex=0,n.isStatic=!1,n._fixedWidthScaling=!1,n._fixedHeightScaling=!0,n.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1},n.activeGestures=[],n.activeModipress=null,n.repeatDelete=function(){this.deleting&&(this.modelKeyClick(this.deleteKey),this.deleting=window.setTimeout(this.repeatDelete,100))}.bind(n),n.config=e,n.config.device=e.device||e.hostDevice,n.config.isEmbedded=e.isEmbedded||!1,e.isStatic&&(n.isStatic=e.isStatic),n._fixedWidthScaling=n.device.touchable&&!n.isStatic,n._fixedHeightScaling=n.device.touchable&&!n.isStatic;var r=document.createElement("div");n.config.styleSheetManager=e.styleSheetManager||new Ce(r);var s;if(e.keyboard)s=n.kbdLayout=e.keyboard.layout(e.device.formFactor),n.layoutKeyboardProperties=e.keyboardMetadata,n.isRTL=e.keyboard.isRTL;else{var o=O.buildDefaultLayout(null,null,e.device.formFactor);s=n.kbdLayout=St.polyfill(o,null,e.device.formFactor),n.layoutKeyboardProperties=null,n.isRTL=!1}"font"in s?n.fontFamily=s.font:n.fontFamily="";var a=e.device.formFactor;n.layoutKeyboard=e.keyboard,n.layoutKeyboard||(n.layoutKeyboard=new q(null)),n.layerGroup=new tl(n,n.layoutKeyboard,a),n.layoutKeyboard.markLayoutCalibrated(a),r.appendChild(n.layerGroup.element),n.kbdDiv=r,n.isStatic||(n.gestureEngine=n.constructGestureEngine()),r.classList.add(e.device.formFactor,"kmw-osk-inner-frame");var B=(l=(c=n.layoutKeyboard)===null||c===void 0?void 0:c.id.replace("Keyboard_",""))!==null&&l!==void 0?l:"",g=B.indexOf("::");g!=-1&&(B=B.substring(g+2));var F="kmw-keyboard-"+B;return n.element.classList.add(F),n}return Object.defineProperty(t.prototype,"layerId",{get:function(){return this._layerId},set:function(e){var n=e!=this._layerId;if(this.layerGroup.layers[e])this._layerId=e,this.layerGroup.activeLayerId=e,this.gestureEngine&&(this.gestureEngine.stateToken=e);else throw new Error("Keyboard ".concat(this.layoutKeyboard.id," does not have a layer with id ").concat(e));n&&(this.updateState(),this.refreshLayout())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentLayer",{get:function(){var e;return this.layerId?(e=this.layerGroup)===null||e===void 0?void 0:e.layers[this.layerId]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lgKey",{get:function(){var e,n;return(n=(e=this.currentLayer)===null||e===void 0?void 0:e.globeKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hkKey",{get:function(){var e,n;return(n=(e=this.currentLayer)===null||e===void 0?void 0:e.hideKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spaceBar",{get:function(){var e,n;return(n=(e=this.currentLayer)===null||e===void 0?void 0:e.spaceBarKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),t.prototype.constructGestureEngine=function(){var e=this,n=this.kbdLayout.layerMap.default.row.length,c={targetRoot:this.element,mouseEventRoot:document.body,maxRoamingBounds:new ye(this.topContainer,[NaN]),itemIdentifier:function(a,B){return e.layerGroup.findNearestKey(a)}};this.gestureParams.longpress.permitsFlick=function(a){var B=a==null?void 0:a.key.spec.flick;return!B||!(B.n||B.nw||B.ne)};var l=new ht(_n(this.kbdLayout,this.gestureParams),c);l.stateToken=this.layerId;var r={},s=function(a){var B,g;try{for(var F=(0,d.__values)(Object.keys(r)),u=F.next();!u.done;u=F.next()){var I=u.value;if(I!=a){var y=r[I];y.source.terminate(!0)}}}catch(Q){B={error:Q}}finally{try{u&&!u.done&&(g=F.return)&&g.call(F)}finally{if(B)throw B.error}}},o=new Map;return l.on("inputstart",function(a){var B,g=e.highlightKey(a.currentSample.item,!0);g&&((B=e.gesturePreviewHost)===null||B===void 0||B.cancel(),e.gesturePreviewHost=g);var F=r[a.identifier]={source:a,roamingHighlightHandler:null,key:a.currentSample.item,previewHost:g},u=function(){xe(0).then(function(){var I=F.previewHost;I&&(I.cancel(),e.gesturePreviewHost=null,F.previewHost=null),F.key&&(e.highlightKey(F.key,!1),F.key=null)})};F.roamingHighlightHandler=function(I){var y,Q=I.item,h=r[a.identifier].key;if(!e.kbdLayout.hasFlicks&&Q!=h){e.highlightKey(h,!1),(y=e.gesturePreviewHost)===null||y===void 0||y.cancel(),e.gesturePreviewHost=null;var C=e.highlightKey(Q,!0);C&&(e.gesturePreviewHost=C,F.previewHost=C,r[a.identifier].key=Q)}},a.path.on("invalidated",u),a.path.on("complete",u),a.path.on("step",F.roamingHighlightHandler)}),l.on("recognizedgesture",function(a){var B;(B=e.activeModipress)===null||B===void 0||B.setLocked(),a.on("complete",function(){var g,F,u;try{for(var I=(0,d.__values)(a.allSourceIds),y=I.next();!y.done;y=I.next()){var Q=y.value;!((u=r[Q])===null||u===void 0)&&u.previewHost&&(e.gesturePreviewHost=null,r[Q].previewHost.cancel()),delete r[Q]}}catch(h){g={error:h}}finally{try{y&&!y.done&&(F=I.return)&&F.call(I)}finally{if(g)throw g.error}}}),a.on("stage",function(g,F){var u,I,y=a.allSourceIds.map(function(f){var E;return(E=r[f])===null||E===void 0?void 0:E.previewHost}).find(function(f){return!!f}),Q=o.get(a);!Q&&y&&!g.matchedId.includes("flick")&&y.clearFlick();var h,C=function(f){var E=function(N){N.key&&(e.highlightKey(N.key,!1),N.key=null),N.source.path.off("step",N.roamingHighlightHandler)};if(h=r[f],h)E(h);else{var Y=f;xe(0).then(function(){var N=r[Y];N&&E(N)})}};try{for(var b=(0,d.__values)(g.allSourceIds),x=b.next();!x.done;x=b.next()){var G=x.value;C(G)}}catch(f){u={error:f}}finally{try{x&&!x.done&&(I=b.return)&&I.call(b)}finally{if(u)throw u.error}}var X=g.item,m=g.sources[0],p=m?m.currentSample:null,Z=null;if(X&&!(Q&&Q[0].directlyEmitsKeys)){var W=void 0,A=e.getSimpleTapCorrectionDistances(m.currentSample,X.key.spec);Q&&(W=Q[0].currentStageKeyDistribution(A)),W||(W=Se(A));var k=!e.layerLocked&&Q&&Q[0]instanceof ec&&Q[0].shouldLockLayer;try{k&&e.lockLayer(!0),Z=e.modelKeyClick(g.item,p)}finally{k&&e.lockLayer(!1)}}if(!(a.stageReports.length>1&&g.matchedId!="modipress-end")){var S=a.stageReports[0].item;if(g.matchedId=="special-key-start")X.key.spec.baseKeyID=="K_BKSP"?(y==null||y.cancel(),Q=[new rl(a,function(){return e.modelKeyClick(X,p)})]):X.key.spec.baseKeyID=="K_LOPT"&&(a.on("complete",function(){return e.emit("globekey",X,!1)}),s(m.identifier));else if(g.matchedId.indexOf("longpress")>-1)y==null||y.cancel(),Q=[new ec(a,F,e,a.stageReports[0].sources[0].baseItem,e.gestureParams)];else if((S==null?void 0:S.key.spec.multitap)&&(g.matchedId=="initial-tap"||g.matchedId=="multitap"||g.matchedId=="modipress-start"))h.previewHost=null,a.on("complete",function(){y==null||y.cancel(),e.gesturePreviewHost=null}),Q=[new dl(a,e,S,Z.contextToken,y)];else if(g.matchedId.indexOf("flick")>-1)Q=[new Li(a,F,e,a.stageReports[0].sources[0].baseItem,e.gestureParams,y)];else if(g.matchedId.includes("modipress")&&g.matchedId.includes("-start"))if(y==null||y.cancel(),e.layerLocked)console.warn("Unexpected state:  modipress start attempt during an active modipress");else{Q||(Q=[]);var L=new pt(a,e,function(){var f=Q.indexOf(L);f>-1&&Q.splice(f,1),e.activeModipress=null});Q.push(L),e.activeModipress=L}else y==null||y.cancel();Q&&(e.activeGestures=e.activeGestures.concat(Q),o.set(a,Q),a.on("complete",function(){var f=e.activeGestures.filter(function(E){return Q.includes(E)});e.activeGestures=e.activeGestures.filter(function(E){return!Q.includes(E)}),f.forEach(function(E){E instanceof pt&&E.cancel()})}))}})}),l},Object.defineProperty(t.prototype,"element",{get:function(){return this.kbdDiv},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"device",{get:function(){return this.config.device},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hostDevice",{get:function(){return this.config.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontRootPath",{get:function(){return this.config.pathConfig.fonts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"styleSheetManager",{get:function(){return this.config.styleSheetManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"topContainer",{get:function(){return this.config.topContainer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmbedded",{get:function(){return this.config.isEmbedded},enumerable:!1,configurable:!0}),t.prototype.postInsert=function(){},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutWidth",{get:function(){if(this.usesFixedWidthScaling){var e=this.width,n=getComputedStyle(this.element);if(n.border){var c=new v(n.borderWidth).val;e-=c*2}return v.inPixels(e)}else return v.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutHeight",{get:function(){if(this.usesFixedHeightScaling){var e=this.height,n=getComputedStyle(this.element);if(n.border){var c=new v(n.borderWidth).val;e-=c*2}return v.inPixels(e)}else return v.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"internalHeight",{get:function(){return this.usesFixedHeightScaling?v.inPixels(this.layoutHeight.val-this.getVerticalLayerGroupPadding()):v.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize||(this._fontSize=new v("1em")),this._fontSize},set:function(e){this._fontSize=e,this.kbdDiv.style.fontSize=e.styleString},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usesFixedWidthScaling",{get:function(){return this._fixedWidthScaling},set:function(e){this._fixedWidthScaling=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usesFixedHeightScaling",{get:function(){return this._fixedHeightScaling},set:function(e){this._fixedHeightScaling=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usesFixedPositioning",{get:function(){for(var e=this.element;e;){if(getComputedStyle(e).position=="fixed")return!0;e=e.offsetParent}return!1},enumerable:!1,configurable:!0}),t.prototype.setSize=function(e,n,c){this._width=e,this._height=n,this.kbdDiv&&(this.kbdDiv.style.width=e?this._width+"px":"",this.kbdDiv.style.height=n?this._height+"px":"",!this.device.touchable&&n&&(this.fontSize=new v(this._height/8+"px")),c||this.refreshLayout())},t.prototype.getDefaultKeyObject=function(){var e=(0,d.__assign)({},M.DEFAULT_KEY);return M.polyfill(e,this.layoutKeyboard,this.kbdLayout,this.layerId),e},t.prototype.getTouchCoordinatesOnKeyboard=function(e){var n={x:e.targetX,y:e.targetY};return n.x/=this.layerGroup.element.offsetWidth,n.y/=this.kbdDiv.offsetHeight,n},t.prototype.getSimpleTapCorrectionDistances=function(e,n){var c=this.getTouchCoordinatesOnKeyboard(e),l=this.layerGroup.element,r=l.offsetWidth,s=this.kbdDiv.offsetHeight;if(!r||!s)return new Map;var o=r/s,a=ci(this.kbdLayout.getLayer(this.layerId),o);return Nt(c,a)},t.prototype.keyTarget=function(e){var n=e;try{if(n){if(n.classList.contains("kmw-key"))return $t(n);if(n.parentNode&&n.parentNode.classList.contains("kmw-key"))return $t(n.parentNode);if(n.firstChild&&n.firstChild.classList.contains("kmw-key"))return $t(n.firstChild)}}catch(c){}return null},t.prototype.cancelDelete=function(){this.deleting&&window.clearTimeout(this.deleting),this.deleting=0},t.prototype.modelKeyClick=function(e,n,c){var l=this.initKeyEvent(e);return n&&(l.source=n),c&&(l.keyDistribution=c),this.raiseKeyEvent(l,e)},t.prototype.initKeyEvent=function(e){this.highlightKey(e,!1);var n=e.key?e.key.spec:null;return n?this.keyEventFromSpec(n):null},t.prototype.keyEventFromSpec=function(e){var n=this.layoutKeyboard.constructKeyEvent(e,this.device,this.stateKeys);return n.srcKeyboard=this.layoutKeyboard,n},t.prototype._UpdateVKShiftStyle=function(e){var n,c;e||(e=this.layerId);var l=this.layerGroup.layers[e];if(!!l&&(this.gestureEngine&&(this.gestureEngine.stateToken=e),!!(!((n=this.layoutKeyboard)===null||n===void 0)&&n.usesDesktopLayoutOnDevice(this.device)))){var r=["K_CAPS","K_NUMLOCK","K_SCROLL"],s=[l.capsKey,l.numKey,l.scrollKey];for(c=0;c<s.length;c++)s[c]!=null&&s[c].setToggleState(this.stateKeys[r[c]])}},t.prototype.updateStateKeys=function(e){for(var n in this.stateKeys)this.stateKeys[n]=e[n];this._UpdateVKShiftStyle()},t.prototype.showLanguage=function(){var e,n=this.layoutKeyboardProperties,c=(e=n==null?void 0:n.displayName)!==null&&e!==void 0?e:"(System keyboard)";try{var l=this.spaceBar.key.label,r=l.parentNode;typeof r.className=="undefined"||r.className==""?r.className="kmw-spacebar":r.className.indexOf("kmw-spacebar")==-1&&(r.className+=" kmw-spacebar"),l.className!="kmw-spacebar-caption"&&(l.className="kmw-spacebar-caption"),(l.innerText!=c||c=="")&&(l.innerText=c),this.spaceBar.key.refreshLayout(this)}catch(s){}},t.prototype.highlightKey=function(e,n){if(!(!e||!e.key||e.className==""||e.className.indexOf("kmw-key-row")>=0)){var c=e.key.allowsKeyTip(),l=this.activeGestures.find(function(r){return r.hasModalVisualization});return n=l?!1:n,e.key.highlight(n),n&&c?this.gesturePreviewHost?null:this.showGesturePreview(e):null}},t.prototype.getKeyEmFontSize=function(){if(!this.fontSize)return 0;if(this.device.formFactor=="desktop"){var e=.8;return this.fontSize.scaledBy(e).val}else{var n=getComputedStyle(document.body).fontSize,c=Ve(n).val,l=1;if(!this.isStatic){if(this.fontSize.absolute)return this.fontSize.val;l=this.fontSize.val}return c*l}},t.prototype.updateState=function(){if(!!this.currentLayer){var e,n=this.kbdDiv.childNodes[0].childNodes;this.nextLayer=this.layerId,this.currentLayer.nextlayer&&(this.nextLayer=this.currentLayer.nextlayer),this.layerGroup.activeLayerId=this.layerId,this._UpdateVKShiftStyle()}},t.prototype.refreshLayout=function(){var e=this.device,n=1;e.OS==V.OperatingSystem.iOS&&!this.isEmbedded&&(n=n/Ie(this.device.formFactor));var c;this.height&&(c=this.computedAdjustedOskHeight(this.height));var l=this.layerGroup.element,r=this.kbdDiv.style,s=l.style;this.usesFixedHeightScaling&&this.height&&(r.height=r.maxHeight=this.height+"px"),r.fontSize=this.fontSize.styleString,s.fontSize=v.forScalar(n).styleString;var o=this.width&&this.height,a=getComputedStyle(this.kbdDiv),B=a.height!=""&&a.height!="auto";if(this.showLanguage(),o)this._computedWidth=this.width,this._computedHeight=this.height;else if(B){if(this._computedWidth=parseInt(a.width,10),!this._computedWidth){var g=getComputedStyle(this.kbdDiv.firstElementChild);this._computedWidth=parseInt(g.width,10)}this._computedHeight=parseInt(a.height,10)}else return;if(!this.isStatic){var F=this.gestureEngine.config.maxRoamingBounds;F.updatePadding([-.333*this.currentLayer.rowHeight]),this.gestureParams.longpress.flickDist=.25*this.currentLayer.rowHeight,this.gestureParams.flick.startDist=.15*this.currentLayer.rowHeight,this.gestureParams.flick.dirLockDist=.35*this.currentLayer.rowHeight,this.gestureParams.flick.triggerDist=.75*this.currentLayer.rowHeight}this.currentLayer&&this.currentLayer.refreshLayout(this,this._computedHeight-this.getVerticalLayerGroupPadding())},t.prototype.getVerticalLayerGroupPadding=function(){var e=getComputedStyle(this.layerGroup.element),n=parseInt(e.paddingTop,10)||0,c=parseInt(e.paddingBottom,10)||0;return n+c},t.prototype.computedAdjustedOskHeight=function(e){if(!this.layerGroup)return e;var n=this.layerGroup.layers,c=0;for(var l in n){var r=n[l],s=r.rows.length,o=Math.floor(e/(s==0?1:s)),a=s*o;a>c&&(c=a)}var B=0,g=c+B;return g},t.prototype.appendStyleSheet=function(){var e=this,n=this.layoutKeyboard,c=this.layoutKeyboardProperties;if(c!=null){this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet);var l=c.textFont,r=c.oskFont;this.styleSheetManager.addStyleSheetForFont(l,this.fontRootPath,this.device.OS),this.styleSheetManager.addStyleSheetForFont(r,this.fontRootPath,this.device.OS);var s=this.addFontStyle(l,r);n!=null&&typeof n.oskStyling=="string"&&(s=s+n.oskStyling),this.styleSheet=Je(s),this.styleSheet.addEventListener("load",function(){e.refreshLayout()}),this.styleSheetManager.linkStylesheet(this.styleSheet)}},t.prototype.addFontStyle=function(e,n){var c="",l=function(r){return r.family.replace(/\u0022/g,"").replace(/,/g,'","')};return(e||n)&&(c='\n.kmw-key-text {\n  font-family: "'.concat(l(n||e),'";\n}\n\n.kmw-suggestion-text {\n  font-family: "').concat(l(e||n),'";\n}\n')),c},t.buildDocumentationKeyboard=function(e,n,c,l,r,s){if(!e)return null;var o=typeof l=="undefined"?"desktop":l,a=typeof r=="undefined"?"default":r,B={};B.formFactor=o,o!="desktop"?(B.OS=V.OperatingSystem.iOS,B.touchable=!0):(B.OS=V.OperatingSystem.Windows,B.touchable=!1);var g=e.layout(o),F=new V("other",B.formFactor,B.OS,B.touchable),u=new t({keyboard:e,keyboardMetadata:n,hostDevice:F,isStatic:!0,topContainer:null,pathConfig:{fonts:c,resources:""},styleSheetManager:null});u.layerGroup.element.className=u.kbdDiv.className,u.layerGroup.element.classList.add(B.formFactor+"-static");var I=u.kbdDiv.childNodes[0],y=document.createElement("div");y.classList.add(B.OS.toLowerCase(),B.formFactor),g!=null?(u.layerId=a,u.layerGroup.activeLayerId=a,u.setSize(800,s),u.fontSize=wi(F,s,!1),u.refreshLayout(),I.style.fontSize=u.kbdDiv.style.fontSize,I.style.height=u.kbdDiv.style.height,I.style.maxHeight=u.kbdDiv.style.maxHeight):I.innerHTML="<p style='color:#c40; font-size:0.5em;margin:10px;'>No "+o+" layout is defined for "+e.name+".</p>",I.style.border="1px solid #ccc",u.updateState();var Q=function(){if(document.contains(I))try{getComputedStyle(I)&&I.style.fontSize&&(u.fontSize=new v(I.style.fontSize)),u.appendStyleSheet();var C=u.styleSheet,b=C.parentElement;u.refreshLayout(),I.style.fontSize=u.kbdDiv.style.fontSize,u.shutdown(),I.appendChild(C)}finally{h.disconnect()}},h=new MutationObserver(Q);return h.observe(document.body,{childList:!0,subtree:!0}),y.append(I),y},t.prototype.onHide=function(){this.hkKey&&this.highlightKey(this.hkKey,!1)},t.prototype.optionKey=function(e,n,c){n.indexOf("K_LOPT")>=0?this.emit("globekey",e,c):n.indexOf("K_ROPT")>=0&&c&&this.emit("hiderequested",e)},t.prototype.showGesturePreview=function(e){var n=this.keytip,c=getComputedStyle(e),l=Number.parseInt(c.height,10),r=Number.parseInt(c.width,10),s=new Fl(e,this.device.formFactor=="phone",r,l);if(n==null){var o=e.key;o.setPreview(s)}else n.show(e,!0,s);return s.refreshLayout(),s},t.prototype.createKeyTip=function(){if(this.keytip==null)if(this.device.formFactor=="phone"){var e=this.isEmbedded;this.keytip=new il(this,e)}else this.keytip=new ll(this);this.keytip&&this.keytip.element&&this.element.appendChild(this.keytip.element)},t.prototype.createGlobeHint=function(){return this.config.embeddedGestureConfig.createGlobeHint?this.config.embeddedGestureConfig.createGlobeHint(this):null},t.prototype.shutdown=function(){var e;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet),this.activeGestures.forEach(function(n){return n.cancel()}),this.gestureEngine&&this.gestureEngine.destroy(),this.deleting&&window.clearTimeout(this.deleting),(e=this.keytip)===null||e===void 0||e.show(null,!1,null)},t.prototype.lockLayer=function(e){this.layerLocked=e},t.prototype.raiseKeyEvent=function(e,n){if(e.kName=="K_LOPT"||e.kName=="K_ROPT")return this.optionKey(n,e.kName,!0),{};var c={},l=function(r,s){var o,a;c.contextToken=(o=r==null?void 0:r.transcription)===null||o===void 0?void 0:o.token;var B=(a=r==null?void 0:r.transcription)===null||a===void 0?void 0:a.transform;c.alteredText=r&&(!B||_e(B))};return this.layerLocked&&(e.kNextLayer=this.layerId),this.emit("keyevent",e,l),c},t.specialCharacters=We.specialCharacters,t}(ul.default),Ze=_s;var yl=R(H(),1),Il=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t}(yl.default),mt=Il,Xt=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"enabled",{get:function(){return!0},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activate",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"conditionsMet",{get:function(){return!0},enumerable:!1,configurable:!0}),t}(Il);var Ps=function(){function i(){this.map={}}return i.prototype.promiseForTouchpoint=function(t){return this.map[t]||(this.map[t]=new J),this.map[t]},i.prototype.maintainTouches=function(t){for(var e,n,c=Object.keys(this.map),l=0;l<t.length;l++){var r=c.indexOf(""+t.item(l).identifier);r!=-1&&c.splice(r,1)}try{for(var s=(0,d.__values)(c),o=s.next();!o.done;o=s.next()){var a=o.value;this.map[a].resolve(),delete this.map[a]}}catch(B){e={error:B}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}},i}(),Ql=Ps;var js=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.legacyEvents=new kt,n.needsLayout=!0,n.touchEventPromiseManager=new Ql,n.activationListener=function(c){if(!n.mayDisable&&!n.activationModel.enabled){n.activationModel.off("activate",n.activationListener);try{n.activationModel.enabled=!0}finally{n.activationModel.on("activate",n.activationListener)}}n.commonCheckAndDisplay()},n.layerChangeHandler=function(c,l){var r,s;return n.vkbd&&n.vkbd._UpdateVKShiftStyle(l),(n.vkbd&&n.vkbd.layerId!=l||c.value!=l)&&(((r=n.vkbd)===null||r===void 0?void 0:r.layerGroup.layers[l])&&!(!((s=n.vkbd)===null||s===void 0)&&s.layerLocked)&&(n.vkbd.layerId=l,n.vkbd.showLanguage()),n.keyboardView.updateState(),n.refreshLayout()),!1},n._Visible=!1,n.config=e=(0,d.__assign)({},e),n.config.allowHideAnimations===void 0&&(n.config.allowHideAnimations=!0),n.config.device=e.device||e.hostDevice,n.config.isEmbedded=e.isEmbedded||!1,n.config.embeddedGestureConfig=e.embeddedGestureConfig||{},n.config.activator.on("activate",n.activationListener),n._Box=T("div"),n.kbdStyleSheetManager=new Ce(n._Box,n.config.doCacheBusting||!1),n.uiStyleSheetManager=new Ce(n._Box),n.bannerView=new gi,n.bannerView.events.on("bannerchange",function(){return n.refreshLayout()}),n._bannerController=new qn(n.bannerView,n.hostDevice,n.config.predictionContextManager),n.keyboardView=null,n.setBaseMouseEventListeners(),n.hostDevice.touchable&&n.setBaseTouchEventListeners(),n}return Object.defineProperty(t.prototype,"keyCodes",{get:function(){return U.keyCodes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"modifierCodes",{get:function(){return U.modifierCodes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"modifierBitmasks",{get:function(){return U.modifierBitmasks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateBitmasks",{get:function(){return U.stateBitmasks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"configuration",{get:function(){return this.config},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bannerController",{get:function(){return this._bannerController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hostDevice",{get:function(){return this.config.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontRootPath",{get:function(){return this.config.pathConfig.fonts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmbedded",{get:function(){return this.config.isEmbedded},enumerable:!1,configurable:!0}),t.prototype.setBaseMouseEventListeners=function(){var e=this;this._Box.onmouseenter=this._VKbdMouseEnter=function(n){e.mouseEnterPromise&&e.mouseEnterPromise.resolve(),e.mouseEnterPromise=new J,e.emit("pointerinteraction",e.mouseEnterPromise.corePromise)},this._Box.onmouseleave=this._VKbdMouseLeave=function(n){e.mouseEnterPromise.resolve(),e.mouseEnterPromise=null}},t.prototype.removeBaseMouseEventListeners=function(){this._Box.onmouseenter=null,this._Box.onmouseleave=null},t.prototype.setBaseTouchEventListeners=function(){var e=this,n=function(c){return c.cancelable&&c.preventDefault(),c.stopPropagation(),!1};this._boxBaseTouchEventCancel=function(c){return e.touchEventPromiseManager.maintainTouches(c.touches),n(c)},this._boxBaseTouchStart=function(c){for(var l=0;l<c.changedTouches.length;l++){var r=e.touchEventPromiseManager.promiseForTouchpoint(c.changedTouches[l].identifier);e.emit("pointerinteraction",r.corePromise)}return e.touchEventPromiseManager.maintainTouches(c.touches),n(c)},this._Box.addEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.addEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchcancel",this._boxBaseTouchEventCancel,!1)},t.prototype.removeBaseTouchEventListeners=function(){!this._boxBaseTouchEventCancel||(this._Box.removeEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.removeEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchcancel",this._boxBaseTouchEventCancel,!1),this._boxBaseTouchEventCancel=null,this._boxBaseTouchStart=null)},Object.defineProperty(t.prototype,"targetDevice",{get:function(){return this.config.device},set:function(e){this.allowsDeviceChange(e)?(this.config.device=e,this.loadActiveKeyboard()):console.error("May not change target device for this OSKView type.")},enumerable:!1,configurable:!0}),t.prototype.allowsDeviceChange=function(e){return!1},Object.defineProperty(t.prototype,"activationModel",{get:function(){return this.config.activator},set:function(e){if(!e)throw new Error("The activation model may not be set to null or undefined!");this.config.activator.off("activate",this.activationListener),e.on("activate",this.activationListener),this.config.activator=e,this.commonCheckAndDisplay()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mayDisable",{get:function(){var e;return!(this.hostDevice.touchable||!((e=this.activeKeyboard)===null||e===void 0)&&e.keyboard.isCJK)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayIfActive",{get:function(){return this.activationModel.enabled},enumerable:!1,configurable:!0}),t.prototype.commonCheckAndDisplay=function(){this.activationModel.activate&&this.activeKeyboard?this.present():this.startHide(!1)},Object.defineProperty(t.prototype,"vkbd",{get:function(){return this.keyboardView instanceof Ze?this.keyboardView:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"banner",{get:function(){return this.bannerView},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computedWidth",{get:function(){return this.needsLayout&&this.refreshLayout(),this._computedWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computedHeight",{get:function(){return this.needsLayout&&this.refreshLayout(),this._computedHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseFontSize",{get:function(){var e;return((e=this.parsedBaseFontSize)===null||e===void 0?void 0:e.styleString)||""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parsedBaseFontSize",{get:function(){return this._baseFontSize||(this._baseFontSize=t.defaultFontSize(this.targetDevice,this.computedHeight,this.isEmbedded)),this._baseFontSize},enumerable:!1,configurable:!0}),t.defaultFontSize=function(e,n,c){if(e.touchable){var l=e.formFactor=="phone"?1.6*(c?.65:.6)*1.2:2;return v.special(l,"em")}else return n?v.inPixels(n/8):void 0},Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this.keyboardData},set:function(e){var n;this.keyboardData=e,this.loadActiveKeyboard(),!((n=this.keyboardData)===null||n===void 0)&&n.keyboard.isCJK&&(this.activationModel.enabled=!0)},enumerable:!1,configurable:!0}),t.prototype.computeFrameHeight=function(){var e,n;return(((e=this.headerView)===null||e===void 0?void 0:e.layoutHeight.val)||0)+(((n=this.footerView)===null||n===void 0?void 0:n.layoutHeight.val)||0)},t.prototype.setSize=function(e,n,c){var l=!1,r,s;!e&&e!==0||!n&&n!==0||(Number.isFinite(e)?r=v.inPixels(e):r=new v(e),Number.isFinite(n)?s=v.inPixels(n):s=new v(n),e&&n&&(l=!this._width||!this._height,l=l||r.styleString!=this._width.styleString,l=l||s.styleString!=this._height.styleString,this._width=r,this._height=s),this.needsLayout=this.needsLayout||l,this.refreshLayoutIfNeeded(c))},t.prototype.setNeedsLayout=function(){this.needsLayout=!0},t.prototype.refreshLayout=function(e){var n,c;if(!!this.keyboardView){var l=this.width&&this.height;if(!!l){var r=this.width.absolute&&this.height.absolute,s=getComputedStyle(this._Box),o=s.height!=""&&s.height!="auto";if(r)this._computedWidth=this.width.val,this._computedHeight=this.height.val;else if(o){var a=this._Box.parentElement;this._computedWidth=this.width.val*(this.width.absolute?1:a.offsetWidth),this._computedHeight=this.height.val*(this.height.absolute?1:a.offsetHeight)}else{console.warn("Unable to properly perform layout - specification uses a relative spec, thus relies upon insertion into the DOM for layout.");return}if(this.needsLayout=!1,this.banner.element.style.fontSize=this.baseFontSize,this.vkbd&&(this.vkbd.fontSize=this.parsedBaseFontSize),e||((n=this.headerView)===null||n===void 0||n.refreshLayout(),this.bannerView.refreshLayout(),this.bannerView.width=this.computedWidth,(c=this.footerView)===null||c===void 0||c.refreshLayout()),this.vkbd){var B=this.computedHeight-this.computeFrameHeight();this.bannerView.height>0&&(B-=this.bannerView.height+5),this.vkbd.setSize(this.computedWidth,B,e);var g=this._Box.style;g.width=g.maxWidth=this.computedWidth+"px",g.height=g.maxHeight=this.computedHeight+"px",this.vkbd.showLanguage()}else{var g=this._Box.style;g.width="auto",g.height="auto",g.maxWidth=g.maxHeight=""}}}},t.prototype.refreshLayoutIfNeeded=function(e){this.needsLayout&&this.refreshLayout(e)},t.prototype.postKeyboardLoad=function(){this._Visible=!1,this.postKeyboardAdjustments(),this.displayIfActive&&this.present()},t.prototype.loadActiveKeyboard=function(){var e,n,c,l,r,s,o;this.setBoxStyling(),this.vkbd&&this.vkbd.shutdown(),this.keyboardView=null,this.needsLayout=!0,this._Box.innerHTML="",this.uiStyleSheetManager.unlinkAll(),this.kbdStyleSheetManager.unlinkAll();var a="osk/";this.config.isEmbedded&&(a="");try{for(var B=(0,d.__values)(t.STYLESHEET_FILES),g=B.next();!g.done;g=B.next()){var F=g.value,u="".concat(this.config.pathConfig.resources,"/").concat(a).concat(F);this.uiStyleSheetManager.linkExternalSheet(u)}}catch(Q){e={error:Q}}finally{try{g&&!g.done&&(n=B.return)&&n.call(B)}finally{if(e)throw e.error}}this.headerView&&this._Box.appendChild(this.headerView.element),this._Box.appendChild(this.banner.element),(c=this.bannerController)===null||c===void 0||c.configureForKeyboard((l=this.keyboardData)===null||l===void 0?void 0:l.keyboard,(r=this.keyboardData)===null||r===void 0?void 0:r.metadata);var I=this.keyboardView=this._GenerateKeyboardView((s=this.keyboardData)===null||s===void 0?void 0:s.keyboard,(o=this.keyboardData)===null||o===void 0?void 0:o.metadata);if(this._Box.appendChild(I.element),I.postInsert(),this.footerView&&this._Box.appendChild(this.footerView.element),this.banner.appendStyles(),this.vkbd){this.vkbd.createKeyTip();var y=this.vkbd.createGlobeHint();y&&this._Box.appendChild(y.element),this.vkbd.appendStyleSheet()}this.postKeyboardLoad()},t.prototype._GenerateKeyboardView=function(e,n){var c=this.targetDevice;return this.vkbd&&this.vkbd.shutdown(),this._Box.className="",e==null&&!c.touchable?new _t:e&&e.layout(c.formFactor)?this._GenerateVisualKeyboard(e,n):!e||!n?this._GenerateVisualKeyboard(null,null):new ji(e)},t.prototype._GenerateVisualKeyboard=function(e,n){var c=this,l=this.targetDevice,r=new Ze({keyboard:e,keyboardMetadata:n,device:l,hostDevice:this.hostDevice,topContainer:this._Box,styleSheetManager:this.kbdStyleSheetManager,pathConfig:this.config.pathConfig,embeddedGestureConfig:this.config.embeddedGestureConfig,isEmbedded:this.config.isEmbedded});return r.on("keyevent",function(s,o){return c.emit("keyevent",s,o)}),r.on("globekey",function(s,o){return c.emit("globekey",s,o)}),r.on("hiderequested",function(s){c.doHide(!0),c.emit("hiderequested",s)}),this._Box.className=l.formFactor+" "+l.OS.toLowerCase()+" kmw-osk-frame",r},t.prototype.present=function(){if(!!this.mayShow()){if(this.keyboardView.updateState(),this._Box.style.display="block",this.refreshLayoutIfNeeded(),this.keyboardView instanceof Ze&&this.keyboardView.showLanguage(),this._Visible=!0,this._Box.style.opacity="1",this._Box.style.visibility=="hidden"){var e=this;window.setTimeout(function(){e._Box.style.visibility="visible"},0)}this.setDisplayPositioning()}},t.prototype.startHide=function(e){if(!!this.mayHide(e)){e&&(this.activationModel.enabled=!!(this.keyboardData.keyboard.isCJK||this.hostDevice.touchable));var n=null;this._Box&&this.hostDevice.touchable&&!(this.keyboardView instanceof _t)&&this.config.allowHideAnimations?n=this.useHideAnimation():n=Promise.resolve(!0);var c=this;n.then(function(l){l&&c.finalizeHide()}),this.doHide(e)}},t.prototype.finalizeHide=function(){if(!(document.body.className.indexOf("osk-always-visible")>=0&&this.hostDevice.formFactor=="desktop")){if(this._Box){var e=this._Box.style;e.display="none",e.transition="",e.opacity="1",this._Visible=!1}this.vkbd&&this.vkbd.onHide()}},t.prototype.mayShow=function(){return!(!this.activationModel.conditionsMet||!this.keyboardView||this.keyboardView instanceof _t||!this.activationModel.enabled||!this._Box)},t.prototype.mayHide=function(e){return!(this.activationModel.conditionsMet&&!this.mayDisable||this.activationModel instanceof Xt||!e&&this.hostDevice.formFactor=="desktop"&&document.body.className.indexOf("osk-always-visible")>=0)},t.prototype.useHideAnimation=function(){var e=this._Box.style,n=this;return new Promise(function(c){var l=function(){return n._Box.removeEventListener("transitionend",l,!1),n._Box.removeEventListener("webkitTransitionEnd",l,!1),n._Box.removeEventListener("transitioncancel",l,!1),n._Box.removeEventListener("webkitTransitionCancel",l,!1),n._animatedHideTimeout!=0&&window.clearTimeout(n._animatedHideTimeout),n._animatedHideTimeout=0,n._Visible&&n.activationModel.conditionsMet?(e.transition="",e.opacity="1",c(!1),!1):(c(!0),!0)},r=function(){n._Box.removeEventListener("transitionrun",r,!1),n._Box.removeEventListener("webkitTransitionRun",r,!1),n._Box.addEventListener("transitionend",l,!1),n._Box.addEventListener("webkitTransitionEnd",l,!1),n._Box.addEventListener("transitioncancel",l,!1),n._Box.addEventListener("webkitTransitionCancel",l,!1)};n._Box.addEventListener("transitionrun",r,!1),n._Box.addEventListener("webkitTransitionRun",r,!1),e.transition="opacity 0.5s linear 0",e.opacity="0",n._animatedHideTimeout=window.setTimeout(l,200)})},t.prototype.hideNow=function(){if(!(!this.mayHide(!1)||!this._Box)){this._animatedHideTimeout&&(window.clearTimeout(this._animatedHideTimeout),this._animatedHideTimeout=0);var e=this._Box.style;e.transition="",e.opacity="0",this.finalizeHide()}},t.prototype.shutdown=function(){this.removeBaseMouseEventListeners(),this.removeBaseTouchEventListeners();var e=this._Box;e.parentElement&&e.parentElement.removeChild(e),this.kbdStyleSheetManager.unlinkAll(),this.uiStyleSheetManager.unlinkAll(),this.bannerController.shutdown()},t.prototype.getRect=function(){var e={};return e.left=e.left=K(this._Box),e.top=e.top=_(this._Box),e.width=this.computedWidth,e.height=this.computedHeight,e},t.prototype.isEnabled=function(){return this.displayIfActive},t.prototype.isVisible=function(){return this._Visible},t.prototype.hide=function(){this.activationModel.enabled=!1,this.startHide(!0)},t.prototype.show=function(e){arguments.length>0?this.activationModel.enabled=e:this.activationModel.conditionsMet&&(this.activationModel.enabled=!this.activationModel.enabled)},t.prototype.doShow=function(e){this.legacyEvents.callEvent("show",e)},t.prototype.doHide=function(e){var n={HiddenByUser:e};this.legacyEvents.callEvent("hide",n)},t.prototype.addEventListener=function(e,n){this.legacyEvents.addEventListener(e,n)},t.prototype.removeEventListener=function(e,n){this.legacyEvents.removeEventListener(e,n)},t.STYLESHEET_FILES=["kmwosk.css","globe-hint.css"],t}(hl.default),Me=js;var Cl=R(H(),1);var qs=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.mouseCancellingHandler=function(c){return c.preventDefault(),c.cancelBubble=!0,!1},n._element=n.buildTitleBar(),n.helpEnabled=!1,n.configEnabled=!1,e&&(n.element.onmousedown=e.mouseDownHandler),n}return Object.defineProperty(t.prototype,"helpEnabled",{get:function(){return this._helpEnabled},set:function(e){this._helpEnabled=e,this._helpButton.style.display=e?"inline":"none"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"configEnabled",{get:function(){return this._configEnabled},set:function(e){this._configEnabled=e,this._configButton.style.display=e?"inline":"none"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutHeight",{get:function(){return t.DISPLAY_HEIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),t.prototype.setPinCJKOffset=function(){this._unpinButton.style.left="15px"},t.prototype.showPin=function(e){this._unpinButton.style.display=e?"block":"none"},t.prototype.setTitle=function(e){this._caption.innerHTML=e},t.prototype.setTitleFromKeyboard=function(e){var n="<span style='font-weight:bold'>"+(e==null?void 0:e.name)+"</span>";this._caption.innerHTML=n},t.prototype.buildTitleBar=function(){var e=this,n=T("div");n.id="keymanweb_title_bar",n.className="kmw-title-bar";var c=this._caption=T("span");c.className="kmw-title-bar-caption",c.style.color="#fff",n.appendChild(c);var l=this._closeButton=this.buildCloseButton();return this._closeButton.onclick=function(){return e.emit("close"),!1},n.appendChild(l),l=this._helpButton=this.buildHelpButton(),this._helpButton.onclick=function(){return e.emit("help"),!1},n.appendChild(l),l=this._configButton=this.buildConfigButton(),this._configButton.onclick=function(){return e.emit("config"),!1},n.appendChild(l),l=this._unpinButton=this.buildUnpinButton(),this._unpinButton.onclick=function(){return e.emit("unpin"),!1},n.appendChild(l),n},t.prototype.buildCloseButton=function(){var e=T("div");return e.id="kmw-close-button",e.className="kmw-title-bar-image",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.buildHelpButton=function(){var e=T("div");return e.id="kmw-help-image",e.className="kmw-title-bar-image",e.title="KeymanWeb Help",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.buildConfigButton=function(){var e=T("div");return e.id="kmw-config-image",e.className="kmw-title-bar-image",e.title="KeymanWeb Configuration Options",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.buildUnpinButton=function(){var e=T("div");return e.id="kmw-pin-image",e.className="kmw-title-bar-image",e.title="Pin the On Screen Keyboard to its default location on the active text box",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.refreshLayout=function(){},t.DISPLAY_HEIGHT=v.inPixels(20),t}(Cl.default),nc=qs;var bl=R(H(),1);var $s=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.mouseCancellingHandler=function(c){return c.preventDefault(),c.cancelBubble=!0,!1},n._element=n.buildResizeBar(),e&&(n._resizeHandle.onmousedown=e.mouseDownHandler),n}return Object.defineProperty(t.prototype,"layoutHeight",{get:function(){return t.DISPLAY_HEIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"handle",{get:function(){return this._resizeHandle},enumerable:!1,configurable:!0}),t.prototype.allowResizing=function(e){this._resizeHandle.style.display=e?"block":"none"},t.prototype.buildResizeBar=function(){var e=this,n=T("div");n.className="kmw-footer",n.onmousedown=this.mouseCancellingHandler;var c=T("div");c.className="kmw-footer-caption",c.innerHTML='<a href="https://keyman.com/developer/keymanweb/">KeymanWeb</a>',c.id="keymanweb-osk-footer-caption",c.addEventListener("dblclick",function(r){return e.emit("showbuild"),!1},!1),n.appendChild(c);var l=T("div");return l.className="kmw-footer-resize",n.appendChild(l),this._resizeHandle=l,n},t.prototype.refreshLayout=function(){},t.DISPLAY_HEIGHT=v.inPixels(16),t}(bl.default),Ul=$s;var xl=function(){function i(t,e,n){this.x=t,this.y=e,n&&(this.source=n)}return i.fromEvent=function(t){var e;if(window.TouchEvent&&t instanceof TouchEvent||t.changedTouches?e=t.changedTouches[0]:e=t,e.pageX)return new i(e.pageX,e.pageY,t);if(e.clientX){var n=e.clientX+document.body.scrollLeft,c=e.clientY+document.body.scrollTop;return new i(n,c,t)}else return new i(null,null,t)},i}(),eo=function(){function i(t){this._VPreviousMouseMove=document.onmousemove,this._VPreviousMouseUp=document.onmouseup,this._VPreviousCursor=document.body.style.cursor,this._VPreviousMouseButton=typeof t.which=="undefined"?t.button:t.which}return i.prototype.restore=function(){document.onmousemove=this._VPreviousMouseMove,document.onmouseup=this._VPreviousMouseUp,document.body.style.cursor&&(document.body.style.cursor=this._VPreviousCursor)},i.prototype.matchesCausingClick=function(t){return this._VPreviousMouseButton==(typeof t.which=="undefined"?t.button:t.which)},i}(),to=function(){function i(t){this.startHandler=this._VMoveMouseDown.bind(this),this.cursorType=t}return Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isActive",{get:function(){return!!this._mouseStartSnapshot},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"mouseDownHandler",{get:function(){return this.startHandler},enumerable:!1,configurable:!0}),i.prototype._VMoveMouseDown=function(t){return!t||!this._enabled?!0:(this._mouseStartSnapshot||(this._mouseStartSnapshot=new eo(t)),this._startCoord=xl.fromEvent(t),document.onmousemove=this._VMoveMouseMove.bind(this),document.onmouseup=this._VMoveMouseUp.bind(this),document.body.style.cursor&&(document.body.style.cursor=this.cursorType),t.preventDefault(),t.cancelBubble=!0,this.onDragStart(),!1)},i.prototype._VMoveMouseMove=function(t){if(!t||!this.enabled)return!0;if(t.preventDefault(),t.cancelBubble=!0,this._mouseStartSnapshot.matchesCausingClick(t)){var e=xl.fromEvent(t),n=e.x-this._startCoord.x,c=e.y-this._startCoord.y;return this.onDragMove(n,c),!1}else return this._VMoveMouseUp(t)},i.prototype._VMoveMouseUp=function(t){return t?(this._mouseStartSnapshot.restore(),this._mouseStartSnapshot=null,t.preventDefault(),t.cancelBubble=!0,this.onDragRelease(),!1):!0},i}(),cc=to;var no=function(i){(0,d.__extends)(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._enabled=!0,e.actValue=null,e}return Object.defineProperty(t.prototype,"activate",{get:function(){return this._enabled&&!!this.actValue},enumerable:!1,configurable:!0}),t.prototype.checkState=function(e){this.activate!=e&&this.emit("activate",this.activate)},Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(e){var n=this.activate;this._enabled=e,this.checkState(n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activationTrigger",{get:function(){return this.actValue},set:function(e){var n=this.activate,c=this.actValue;this.actValue=e,this.checkState(n),c!=e&&this.emit("triggerchange",e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"conditionsMet",{get:function(){return!!this.activationTrigger},enumerable:!1,configurable:!0}),t}(mt),Vt=no;var pl=function(i){(0,d.__extends)(t,i);function t(){return i.call(this,"KeymanWeb_OnScreenKeyboard")||this}return t.prototype.loadWithDefaults=function(e){return(0,d.__assign)((0,d.__assign)({},e),this.load())},t.prototype.load=function(){var e=i.prototype.load.call(this,function(n,c){switch(c){case"version":return n;default:return Number.parseInt(n,10)}});return e.width||delete e.width,e.height||delete e.height,e},t.prototype.save=function(e){i.prototype.save.call(this,e)},t}(Fe);var co=function(i){(0,d.__extends)(t,i);function t(e){var n,c,l=this;e.activator=e.activator||new Vt,l=i.call(this,e)||this,l.userPositioned=!1,l.specifiedPosition=!1,l.noDrag=!1,l.layoutSerializer=new pl,l.restorePosition=function(F){var u=this._Visible,I=new J;this.emit("dragmove",I.corePromise),this.loadPersistedLayout(),this.userPositioned=!1,F||(delete this.dfltX,delete this.dfltY),this.savePersistedLayout(),u&&this.present(),this.titleBar.showPin(!1),I.resolve(),this.doResizeMove()}.bind(l),l.typedActivationModel.on("triggerchange",function(){return l.setDisplayPositioning()}),document.body.appendChild(l._Box),l.titleBar=new nc(l.titleDragHandler),l.titleBar.on("help",function(){l.legacyEvents.callEvent("helpclick",{})}),l.titleBar.on("config",function(){l.legacyEvents.callEvent("configclick",{})}),l.titleBar.on("close",function(){return l.startHide(!0)}),l.titleBar.on("unpin",function(){return l.restorePosition(!0)}),l.resizeBar=new Ul(l.resizeDragHandler),l.resizeBar.on("showbuild",function(){return l.emit("showbuild")}),l.headerView=l.titleBar;var r=function(F){var u=l.headerView;if(u&&u instanceof nc)switch(F){case"configclick":u.configEnabled=l.legacyEvents.listenerCount("configclick")>0;break;case"helpclick":u.helpEnabled=l.legacyEvents.listenerCount("helpclick")>0;break;default:return}},s=new Et(l),o=new Et(l.legacyEvents);try{for(var a=(0,d.__values)([s,o]),B=a.next();!B.done;B=a.next()){var g=B.value;g.on("listeneradded",r),g.on("listenerremoved",r)}}catch(F){n={error:F}}finally{try{B&&!B.done&&(c=a.return)&&c.call(a)}finally{if(n)throw n.error}}return l.loadPersistedLayout(),l}return Object.defineProperty(t.prototype,"typedActivationModel",{get:function(){return this.activationModel},enumerable:!1,configurable:!0}),t.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},t.prototype.setBoxStyling=function(){var e=this._Box.style;e.zIndex="9999",e.display="none",e.width="auto",e.position="absolute"},t.prototype.postKeyboardAdjustments=function(){this.enableMoveResizeHandlers(),this.activeKeyboard&&this.titleBar.setTitleFromKeyboard(this.activeKeyboard.keyboard),this.vkbd?(this.footerView=this.resizeBar,this._Box.appendChild(this.footerView.element)):(this.footerView&&this._Box.removeChild(this.footerView.element),this.footerView=null),this.loadPersistedLayout(),this.setNeedsLayout()},t.prototype.isEnabled=function(){return this.displayIfActive},t.prototype.isVisible=function(){return this._Visible},t.prototype.savePersistedLayout=function(){var e=this.getPos(),n={visible:this.displayIfActive?1:0,userSet:this.userPositioned?1:0,left:e.left,top:e.top,_version:ne.CURRENT.toString()};this.vkbd&&(n.width=this.width.val,n.height=this.height.val),this.layoutSerializer.save(n)},t.prototype.loadPersistedLayout=function(){var e=this.layoutSerializer.loadWithDefaults({visible:1,userSet:0,left:-1,top:-1,_version:void 0,width:.3*screen.width,height:.15*screen.height});this.activationModel.enabled=e.visible==1,this.userPositioned=e.userSet==1,this.x=e.left,this.y=e.top;var n=e._version,c=n===void 0,l=e.width,r=e.height;l<.2*screen.width&&(l=.2*screen.width),r<.1*screen.height&&(r=.1*screen.height),l>.9*screen.width&&(l=.9*screen.width),r>.5*screen.height&&(r=.5*screen.height),(c||!n)&&(this.headerView&&this.headerView.layoutHeight.absolute&&(r+=this.headerView.layoutHeight.val),this.footerView&&this.footerView.layoutHeight.absolute&&(r+=this.footerView.layoutHeight.val)),this.setSize(l,r),(this.x==-1||this.y==-1||!this._Box)&&(this.userPositioned=!1),this.x<window.pageXOffset-.8*l&&(this.x=window.pageXOffset-.8*l),this.y<0&&(this.x=-1,this.y=-1,this.userPositioned=!1),this.userPositioned&&this._Box&&this.setPos({left:this.x,top:this.y})},t.prototype.getDefaultKeyboardHeight=function(){if(this.configuration.heightOverride)return this.configuration.heightOverride();var e=Math.floor(Math.min(screen.availHeight,screen.availWidth)/2),n=e;if(this.targetDevice.formFactor=="phone"){var c=Math.min(screen.height,screen.width),l=Math.max(screen.height,screen.width);ee()?n=n*(l/c)/1.6:n=Math.floor(Math.max(screen.availHeight,screen.availWidth)/3)}return this.targetDevice.OS==V.OperatingSystem.iOS&&(n=n/Ie(this.targetDevice.formFactor)),n},t.prototype.getDefaultWidth=function(){if(this.configuration.widthOverride)return this.configuration.widthOverride();var e;if(this.targetDevice.OS==V.OperatingSystem.iOS)e=window.innerWidth;else if(this.targetDevice.OS==V.OperatingSystem.Android)try{e=document.documentElement.clientWidth}catch(n){e=screen.availWidth}else e=screen.width;return e},t.prototype.doResizeMove=function(e){this.legacyEvents.callEvent("resizemove",e)},t.prototype.setRect=function(e){if(!(this._Box==null||this.targetDevice.formFactor!="desktop")){var n=this._Box,c=n.style;if("left"in e&&(this.x=e.left-K(n)+n.offsetLeft,c.left=this.x+"px",this.dfltX=c.left),"top"in e&&(this.y=e.top-_(n)+n.offsetTop,c.top=this.y+"px",this.dfltY=c.top),this.vkbd!=null){var l=this.vkbd.kbdDiv,r=l.style;if("width"in e){var s=e.width-(n.offsetWidth-l.offsetWidth);s<.2*screen.width&&(s=.2*screen.width),s>.9*screen.width&&(s=.9*screen.width),r.width=s+"px",this.setSize(s,this.computedHeight,!0)}if("height"in e){var o=e.height-(n.offsetHeight-l.offsetHeight);o<.1*screen.height&&(o=.1*screen.height),o>.5*screen.height&&(o=.5*screen.height),r.height=o+"px",r.fontSize=o/8+"px",this.setSize(this.computedWidth,o,!0)}"nosize"in e&&(this.resizingEnabled=!e.nosize)}"nomove"in e&&(this.noDrag=e.nomove,this.movementEnabled=!this.noDrag),this.savePersistedLayout()}},t.prototype.getPos=function(){var e=this._Box,n={left:this._Visible?e.offsetLeft:this.x,top:this._Visible?e.offsetTop:this.y};return n},t.prototype.setPos=function(e){if(typeof this._Box!="undefined"){if(this.userPositioned){var n=e.left,c=e.top;typeof n!="undefined"&&(n<-.8*this._Box.offsetWidth&&(n=-.8*this._Box.offsetWidth),this.userPositioned&&(this._Box.style.left=n+"px",this.x=n)),typeof c!="undefined"&&(c<0&&(c=0),this.userPositioned&&(this._Box.style.top=c+"px",this.y=c))}this.titleBar.showPin(this.userPositioned)}},t.prototype.setDisplayPositioning=function(){var e=this._Box.style;if(e.position="absolute",this.activationModel.activate&&(e.display="block"),e.left="0px",this.specifiedPosition||this.userPositioned)e.left=this.x+"px",e.top=this.y+"px";else{var n=this.typedActivationModel.activationTrigger||null;this.dfltX?e.left=this.dfltX:typeof n!="undefined"&&n!=null&&(e.left=K(n)+"px"),this.dfltY?e.top=this.dfltY:typeof n!="undefined"&&n!=null&&(e.top=_(n)+n.offsetHeight+"px")}this.specifiedPosition=!1},t.prototype.presentAtPosition=function(e,n){!this.mayShow()||(this.specifiedPosition=e>=0||n>=0,this.specifiedPosition&&(this.x=e,this.y=n),this.specifiedPosition=this.specifiedPosition||this.userPositioned,this.present())},t.prototype.present=function(){if(!!this.mayShow()){this.titleBar.showPin(this.userPositioned),i.prototype.present.call(this);var e={};e.x=this._Box.offsetLeft,e.y=this._Box.offsetTop,e.userLocated=this.userPositioned,this.doShow(e)}},t.prototype.startHide=function(e){i.prototype.startHide.call(this,e),e&&this.savePersistedLayout()},t.prototype.show=function(e){e!==void 0?i.prototype.show.call(this,e):i.prototype.show.call(this),this.savePersistedLayout()},t.prototype.userLocated=function(){return this.userPositioned},Object.defineProperty(t.prototype,"movementEnabled",{get:function(){return this.titleDragHandler.enabled},set:function(e){this.titleDragHandler.enabled=e,this.titleBar.showPin(e&&this.userPositioned)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resizingEnabled",{get:function(){return this.resizeDragHandler.enabled},set:function(e){this.resizeDragHandler.enabled=e,this.resizeBar.allowResizing(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBeingMoved",{get:function(){return this.titleDragHandler.isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBeingResized",{get:function(){return this.resizeDragHandler.isActive},enumerable:!1,configurable:!0}),t.prototype.enableMoveResizeHandlers=function(){this.titleDragHandler.enabled=!this.noDrag,this.resizeDragHandler.enabled=!0},Object.defineProperty(t.prototype,"titleDragHandler",{get:function(){var e=this;return this._moveHandler?this._moveHandler:(this._moveHandler=new(function(n){(0,d.__extends)(c,n);function c(){return n.call(this,"move")||this}return c.prototype.onDragStart=function(){this.startX=e._Box.offsetLeft,this.startY=e._Box.offsetTop,e.activeKeyboard.keyboard.isCJK&&e.titleBar.setPinCJKOffset(),this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new J,e.emit("dragmove",this.dragPromise.corePromise)},c.prototype.onDragMove=function(l,r){e.titleBar.showPin(!0),e.userPositioned=!0,e._Box.style.left=this.startX+l+"px",e._Box.style.top=this.startY+r+"px";var s=e.getRect();e.setSize(s.width,s.height,!0),e.x=s.left,e.y=s.top},c.prototype.onDragRelease=function(){e.vkbd&&(e.vkbd.currentKey=null),this.dragPromise.resolve(),this.dragPromise.then(function(){e.userPositioned=!0,e.doResizeMove(),e.savePersistedLayout()}),this.dragPromise=null},c}(cc)),this._moveHandler)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resizeDragHandler",{get:function(){var e=this;return this._resizeHandler?this._resizeHandler:(this._resizeHandler=new(function(n){(0,d.__extends)(c,n);function c(){return n.call(this,"se-resize")||this}return c.prototype.onDragStart=function(){this.startWidth=e.computedWidth,this.startHeight=e.computedHeight,this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new J,e.emit("resizemove",this.dragPromise.corePromise)},c.prototype.onDragMove=function(l,r){var s=this.startWidth+l,o=this.startHeight+r;s<.2*screen.width&&(s=.2*screen.width),o<.1*screen.height&&(o=.1*screen.height),s>.9*screen.width&&(s=.9*screen.width),o>.5*screen.height&&(o=.5*screen.height),e.setSize(s,o,!0)},c.prototype.onDragRelease=function(){e.vkbd&&(e.vkbd.currentKey=null),e.vkbd&&(this.startWidth=e.computedWidth,this.startHeight=e.computedHeight),e.refreshLayout(),this.dragPromise.resolve(),this.dragPromise.then(function(){e.doResizeMove(),e.savePersistedLayout()}),this.dragPromise=null},c}(cc)),this._resizeHandler)},enumerable:!1,configurable:!0}),t}(Me),$e=co;var io=function(i){(0,d.__extends)(t,i);function t(e){var n=this;return e.isEmbedded?e.activator=e.activator||new Xt:e.activator=e.activator||new Vt,n=i.call(this,e)||this,n.isResizing=!1,n.restorePosition=function(c){}.bind(n),document.body.appendChild(n._Box),n}return t.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},t.prototype.setBoxStyling=function(){var e=this._Box.style;e.zIndex="9999",e.display="none",e.width="100%",e.position="fixed"},t.prototype.refreshLayout=function(e){if(!this.isResizing){try{this.isResizing=!0,this.doResize()}finally{this.isResizing=!1}i.prototype.refreshLayout.call(this,e)}},t.prototype.doResize=function(){if(this.vkbd){var e=this.getDefaultKeyboardHeight();this.setSize(this.getDefaultWidth(),e+this.banner.height)}},t.prototype.postKeyboardAdjustments=function(){this.doResize()},t.prototype.getDefaultKeyboardHeight=function(){var e,n,c=this.targetDevice;if(this.configuration.heightOverride)return this.configuration.heightOverride();var l=(e=document==null?void 0:document.documentElement)===null||e===void 0?void 0:e.clientWidth,r=(n=document==null?void 0:document.documentElement)===null||n===void 0?void 0:n.clientHeight;if(typeof l=="undefined"&&(l=Math.min(screen.height,screen.width),r=Math.max(screen.height,screen.width),ee())){var s=l;l=r,r=s}var o=Math.floor(Math.min(r,l)/2),a=o;return c.formFactor=="phone"&&(ee()?a=Math.floor(r/1.6):a=Math.floor(r/2.4)),this.targetDevice.OS==V.OperatingSystem.iOS&&(a=a/Ie(this.targetDevice.formFactor)),a},t.prototype.getDefaultWidth=function(){var e,n=this.targetDevice;if(this.configuration.widthOverride)return this.configuration.widthOverride();var c;return c=(e=document==null?void 0:document.documentElement)===null||e===void 0?void 0:e.clientWidth,typeof c=="undefined"&&(this.targetDevice.OS==V.OperatingSystem.iOS?c=window.innerWidth:n.OS==V.OperatingSystem.Android?c=screen.availWidth:c=screen.width),c},t.prototype.setRect=function(e){},t.prototype.getPos=function(){var e=this._Box,n={left:this._Visible?e.offsetLeft:this.x,top:this._Visible?e.offsetTop:this.y};return n},t.prototype.setPos=function(e){},t.prototype.setDisplayPositioning=function(){var e=this._Box.style;this.vkbd&&(e.position="fixed",e.left=e.bottom="0px",e.border="none",e.borderTop="1px solid gray")},t.prototype.present=function(){i.prototype.present.call(this),this.legacyEvents.callEvent("show",{})},t}(Me),ic=io;var lo=function(i){(0,d.__extends)(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.flag=!0,e}return Object.defineProperty(t.prototype,"enabled",{get:function(){return this.flag},set:function(e){this.activate=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activate",{get:function(){return this.flag},set:function(e){this.flag!=e&&(this.flag=e,this.emit("activate",e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"conditionsMet",{get:function(){return!0},enumerable:!1,configurable:!0}),t}(mt),lc=lo;var ro=function(i){(0,d.__extends)(t,i);function t(e){var n=this;return e.activator=e.activator||new lc,n=i.call(this,e)||this,n.restorePosition=function(c){}.bind(n),n}return Object.defineProperty(t.prototype,"element",{get:function(){return this._Box},enumerable:!1,configurable:!0}),t.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},t.prototype.setBoxStyling=function(){var e=this._Box.style;e.display="none",e.position="relative"},t.prototype.postKeyboardAdjustments=function(){},t.prototype.getDefaultKeyboardHeight=function(){return this.keyboardView instanceof Ze?this.keyboardView.height:this.computedHeight},t.prototype.getDefaultWidth=function(){return this.computedWidth},t.prototype.setRect=function(e){},t.prototype.getPos=function(){var e=this._Box,n={left:this._Visible?e.offsetLeft:void 0,top:this._Visible?e.offsetTop:void 0};return n},t.prototype.setPos=function(e){},t.prototype.present=function(){i.prototype.present.call(this),this.legacyEvents.callEvent("show",{})},t.prototype.setDisplayPositioning=function(){},t.prototype.allowsDeviceChange=function(e){return!0},t}(Me),rc=ro;var Bc={};bc(Bc,{AnchoredOSKView:function(){return oc},FloatingOSKView:function(){return ac},InlinedOSKView:function(){return so}});function sc(i){return{hostDevice:i.config.hostDevice,pathConfig:i.config.paths,predictionContextManager:i.contextManager.predictionContext,isEmbedded:!1}}var oc=function(i){(0,d.__extends)(t,i);function t(e,n){var c=(0,d.__assign)((0,d.__assign)({},sc(e)),n||{});return i.call(this,c)||this}return t}(ic),ac=function(i){(0,d.__extends)(t,i);function t(e,n){var c=(0,d.__assign)((0,d.__assign)({},sc(e)),n||{});return i.call(this,c)||this}return t}($e),so=function(i){(0,d.__extends)(t,i);function t(e,n){var c=(0,d.__assign)((0,d.__assign)({},sc(e)),n||{});return i.call(this,c)||this}return t}(rc);var Gl=R(H(),1),oo=function(i){(0,d.__extends)(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.events=new Gl.default,e.changed=!1,e}return t.prototype.focus=function(){var e=this.getElement();e.focus&&e.focus()},t.prototype.isForcingScroll=function(){return!1},t.prototype.dispatchInputEventOn=function(e){var n;window.InputEvent&&(n=new InputEvent("input",{bubbles:!0,cancelable:!1})),e&&n&&e.dispatchEvent(n)},t}(In),ce=oo;var ao=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.root=e,n._cachedSelectionStart=-1,n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.isSupportedType=function(e){return e=="email"||e=="search"||e=="text"||e=="url"},t.prototype.getElement=function(){return this.root},t.prototype.clearSelection=function(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)},t.prototype.isSelectionEmpty=function(){return this.root.selectionStart==this.root.selectionEnd},t.prototype.hasSelection=function(){return!0},t.prototype.invalidateSelection=function(){this._cachedSelectionStart=-1},t.prototype.getCaret=function(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart},t.prototype.getDeadkeyCaret=function(){return this.getCaret()},t.prototype.setCaret=function(e){this.setSelection(e,e,"none")},t.prototype.setSelection=function(e,n,c){var l=this.root.value._kmwCodePointToCodeUnit(e),r=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(l,r,c),this.processedSelectionStart=e,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(l,r,c)},t.prototype.forceScroll=function(){var e=this.getElement(),n=e.selectionStart,c=e.selectionEnd;this._activeForcedScroll=!0;try{e.blur(),e.focus()}finally{e.selectionStart=n,e.selectionEnd=c,this._activeForcedScroll=!1}},t.prototype.isForcingScroll=function(){return this._activeForcedScroll},t.prototype.getSelectionDirection=function(){return this.root.selectionDirection},t.prototype.getTextBeforeCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)},t.prototype.getSelectedText=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)},t.prototype.setTextBeforeCaret=function(e){this.getCaret();var n=this.processedSelectionEnd-this.processedSelectionStart,c=this.getSelectionDirection(),l=e._kmwLength();this.root.value=e+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(l,l+n,c)},t.prototype.setTextAfterCaret=function(e){var n=this.getCaret(),c=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+e,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,c)},t.prototype.getTextAfterCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)},t.prototype.getText=function(){return this.root.value},t.prototype.deleteCharsBeforeCaret=function(e){if(e>0){var n=this.getTextBeforeCaret(),c=this.processedSelectionStart;e>c&&(e=c),this.adjustDeadkeys(-e),this.setTextBeforeCaret(n.kmwSubstring(0,c-e)),this.setCaret(c-e)}},t.prototype.insertTextBeforeCaret=function(e){if(!!e){var n=this.getCaret(),c=this.getTextBeforeCaret(),l=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(e._kmwLength()),this.root.value=c+e+l,this.setCaret(n+e._kmwLength())}},t.prototype.handleNewlineAtCaret=function(){var e=this.root;e&&(e.type=="search"||e.type=="submit")?(e.disabled=!1,e.form.submit()):this.events.emit("unhandlednewline",e)},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(ce),et=ao;var Bo=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.root=e,n._cachedSelectionStart=-1,n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getElement=function(){return this.root},t.prototype.clearSelection=function(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)},t.prototype.isSelectionEmpty=function(){return this.root.selectionStart==this.root.selectionEnd},t.prototype.hasSelection=function(){return!0},t.prototype.invalidateSelection=function(){this._cachedSelectionStart=-1},t.prototype.getCaret=function(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart},t.prototype.getDeadkeyCaret=function(){return this.getCaret()},t.prototype.setCaret=function(e){this.setSelection(e,e,"none")},t.prototype.setSelection=function(e,n,c){var l=this.root.value._kmwCodePointToCodeUnit(e),r=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(l,r,c),this.processedSelectionStart=e,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(l,r,c)},t.prototype.forceScroll=function(){var e=this.getElement(),n=e.selectionStart,c=e.selectionEnd;this._activeForcedScroll=!0;try{e.blur(),e.focus()}finally{e.selectionStart=n,e.selectionEnd=c,this._activeForcedScroll=!1}},t.prototype.isForcingScroll=function(){return this._activeForcedScroll},t.prototype.getSelectionDirection=function(){return this.root.selectionDirection},t.prototype.getTextBeforeCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)},t.prototype.setTextBeforeCaret=function(e){this.getCaret();var n=this.processedSelectionEnd-this.processedSelectionStart,c=this.getSelectionDirection(),l=e._kmwLength();this.root.value=e+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(l,l+n,c)},t.prototype.setTextAfterCaret=function(e){var n=this.getCaret(),c=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+e,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,c)},t.prototype.getTextAfterCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)},t.prototype.getSelectedText=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)},t.prototype.getText=function(){return this.root.value},t.prototype.deleteCharsBeforeCaret=function(e){if(e>0){var n=this.getTextBeforeCaret(),c=this.processedSelectionStart;e>c&&(e=c),this.adjustDeadkeys(-e),this.setTextBeforeCaret(n.kmwSubstring(0,c-e)),this.setCaret(c-e)}},t.prototype.insertTextBeforeCaret=function(e){if(!!e){var n=this.getCaret(),c=this.getTextBeforeCaret(),l=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(e._kmwLength()),this.root.value=c+e+l,this.setCaret(n+e._kmwLength())}},t.prototype.handleNewlineAtCaret=function(){this.insertTextBeforeCaret("\n")},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(ce),dc=Bo;var gc=function(){function i(t,e){this.node=t,this.offset=e}return i}(),Fc=function(){function i(t,e){this.start=t,this.end=e}return i}(),Qe=function(){function i(t,e){this.cmd=t,this.stateType=e}return i}(),go=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;if(n.root=e,e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.designMode=="on")n.doc=e.contentWindow.document,n.docRoot=e.contentWindow.document.documentElement;else throw"Specified IFrame is not in design-mode!";return n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getElement=function(){return this.root},t.prototype.focus=function(){this.doc.defaultView.focus()},t.prototype.isSelectionEmpty=function(){return this.hasSelection()?this.doc.getSelection().isCollapsed:!0},t.prototype.hasSelection=function(){var e=this.doc.getSelection(),n=document.getSelection();return n.anchorNode==e.anchorNode&&n.focusNode==e.focusNode,!0},t.prototype.clearSelection=function(){if(this.hasSelection()){var e=this.doc.getSelection();e.isCollapsed||e.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")},t.prototype.invalidateSelection=function(){},t.prototype.getCarets=function(){var e=this.doc.getSelection(),n=e.anchorNode.compareDocumentPosition(e.focusNode);if(e.isCollapsed){var c=new gc(e.anchorNode,e.anchorOffset);return new Fc(c,c)}else{var l=new gc(e.anchorNode,e.anchorOffset),r=new gc(e.focusNode,e.focusOffset);return l.node==r.node&&(n=r.offset-l.offset>0?2:4),n&2?new Fc(l,r):new Fc(r,l)}},t.prototype.getDeadkeyCaret=function(){return this.getTextBeforeCaret().kmwLength()},t.prototype.getTextBeforeCaret=function(){if(!this.hasSelection())return this.getText();var e=this.getCarets().start;return e.node.nodeType!=3?"":e.node.textContent.substr(0,e.offset)},t.prototype.getSelectedText=function(){return""},t.prototype.getTextAfterCaret=function(){if(!this.hasSelection())return"";var e=this.getCarets().end;return e.node.nodeType!=3?"":e.node.textContent.substr(e.offset)},t.prototype.getText=function(){return this.docRoot.innerText},t.prototype.deleteCharsBeforeCaret=function(e){if(!(!this.hasSelection()||e<=0)){var n=this.getCarets().start;if(e>n.offset&&(e=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}var c=this.doc.createRange(),l=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-e).length;c.setStart(n.node,l),c.setEnd(n.node,n.offset),this.adjustDeadkeys(-e),c.deleteContents()}},t.prototype.insertTextBeforeCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().start,c=e._kmwLength(),l=this.doc.getSelection();if(c!=0){this.adjustDeadkeys(c);var r=this.root.ownerDocument.createRange();if(n.node.nodeType==3){var s=n.node;s.insertData(n.offset,e),r.setStart(s,n.offset+e.length)}else{var o=this.doc.createTextNode(e),a=this.doc.createRange();a.setStart(n.node,n.offset),a.collapse(!0),a.insertNode(o),r.setStart(o,e.length)}r.collapse(!0),l.removeAllRanges();try{l.addRange(r)}catch(B){n.node.parentElement.scrollIntoView(),l.addRange(r)}l.collapseToEnd()}}},t.prototype.handleNewlineAtCaret=function(){},t.prototype.setTextAfterCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().end,c=e._kmwLength(),l=this.doc.getSelection();if(c!=0)if(n.node.nodeType==3){var r=n.node;r.replaceData(n.offset,r.length,e)}else{var s=n.node.ownerDocument.createTextNode(e),o=this.root.ownerDocument.createRange();o.setStart(n.node,n.offset),o.collapse(!0),o.insertNode(s)}}},t.prototype.saveProperties=function(){var e=[new Qe("backcolor",1),new Qe("fontname",1),new Qe("fontsize",1),new Qe("forecolor",1),new Qe("bold",0),new Qe("italic",0),new Qe("strikethrough",0),new Qe("subscript",0),new Qe("superscript",0),new Qe("underline",0)];this.doc.defaultView&&e.push(new Qe("hilitecolor",1));for(var n=0;n<e.length;n++){var c=e[n];c.stateType==1?c.cache=this.doc.queryCommandValue(c.cmd):c.cache=this.doc.queryCommandState(c.cmd)}this.commandCache=e},t.prototype.restoreProperties=function(e){this.commandCache||console.error("No command cache exists to restore!");for(var n=0;n<this.commandCache.length;n++){var c=this.commandCache[n];c.stateType==1?this.doc.queryCommandValue(c.cmd)!=c.cache&&(e&&e(),this.doc.execCommand(c.cmd,!1,c.cache)):this.doc.queryCommandState(c.cmd)!=c.cache&&(e&&e(),this.doc.execCommand(c.cmd,!1,null))}},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(ce),re=go;var uc=function(){function i(t,e){this.node=t,this.offset=e}return i}(),yc=function(){function i(t,e){this.start=t,this.end=e}return i}(),Fo=function(i){(0,d.__extends)(t,i);function t(e){var n=this;if(e.isContentEditable)n=i.call(this)||this,n.root=e;else throw"Specified element is not already content-editable!";return n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getElement=function(){return this.root},t.prototype.isSelectionEmpty=function(){return this.hasSelection()?this.root.ownerDocument.getSelection().isCollapsed:!0},t.prototype.hasSelection=function(){var e=this.root.ownerDocument.getSelection();return!(this.root!=e.anchorNode&&!this.root.contains(e.anchorNode)||this.root!=e.focusNode&&!this.root.contains(e.focusNode))},t.prototype.clearSelection=function(){if(this.hasSelection()){var e=this.root.ownerDocument.getSelection();e.isCollapsed||e.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")},t.prototype.invalidateSelection=function(){},t.prototype.getCarets=function(){var e=this.root.ownerDocument.getSelection(),n=e.anchorNode.compareDocumentPosition(e.focusNode);if(e.isCollapsed){var c=new uc(e.anchorNode,e.anchorOffset);return new yc(c,c)}else{var l=new uc(e.anchorNode,e.anchorOffset),r=new uc(e.focusNode,e.focusOffset);return l.node==r.node&&(n=r.offset-l.offset>0?2:4),n&2?new yc(l,r):new yc(r,l)}},t.prototype.getDeadkeyCaret=function(){return this.getTextBeforeCaret().kmwLength()},t.prototype.getTextBeforeCaret=function(){if(!this.hasSelection())return this.getText();var e=this.getCarets().start;return e.node.nodeType!=3?"":e.node.textContent.substr(0,e.offset)},t.prototype.getSelectedText=function(){return""},t.prototype.getTextAfterCaret=function(){if(!this.hasSelection())return"";var e=this.getCarets().end;return e.node.nodeType!=3?"":e.node.textContent.substr(e.offset)},t.prototype.getText=function(){return this.root.innerText},t.prototype.deleteCharsBeforeCaret=function(e){if(!(!this.hasSelection()||e<=0)){var n=this.getCarets().start;if(e>n.offset&&(e=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}var c=this.root.ownerDocument.createRange(),l=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-e).length;c.setStart(n.node,l),c.setEnd(n.node,n.offset),this.adjustDeadkeys(-e),c.deleteContents()}},t.prototype.insertTextBeforeCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().start,c=e._kmwLength(),l=this.root.ownerDocument.getSelection();if(c!=0){this.adjustDeadkeys(c);var r=this.root.ownerDocument.createRange();if(n.node.nodeType==3){var s=n.node;s.insertData(n.offset,e),r.setStart(s,n.offset+e.length)}else{var o=n.node.ownerDocument.createTextNode(e),a=this.root.ownerDocument.createRange();a.setStart(n.node,n.offset),a.collapse(!0),a.insertNode(o),r.setStart(o,e.length)}r.collapse(!0),l.removeAllRanges();try{l.addRange(r)}catch(B){n.node.parentElement.scrollIntoView(),l.addRange(r)}l.collapseToEnd()}}},t.prototype.handleNewlineAtCaret=function(){},t.prototype.setTextAfterCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().end,c=e._kmwLength(),l=this.root.ownerDocument.getSelection();if(c!=0)if(n.node.nodeType==3){var r=n.node;r.replaceData(n.offset,r.length,e)}else{var s=n.node.ownerDocument.createTextNode(e),o=this.root.ownerDocument.createRange();o.setStart(n.node,n.offset),o.collapse(!0),o.insertNode(s)}}},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(ce),en=Fo;function P(i,t){var e;if(!i)return!1;if(i.Window)return t=="Window";if(i.defaultView)e=i.defaultView[t];else if(i.ownerDocument)e=i.ownerDocument.defaultView[t];else if(i.target){var n=i;this.instanceof(n.target,"Window")?e=n.target[t]:this.instanceof(n.target,"Document")?e=n.target.defaultView[t]:this.instanceof(n.target,"HTMLElement")&&(e=n.target.ownerDocument.defaultView[t])}return e?i instanceof e:!1}function tn(i){if(P(i,"HTMLInputElement"))return new et(i);if(P(i,"HTMLTextAreaElement"))return new dc(i);if(P(i,"HTMLIFrameElement")){var t=i;return t.contentWindow&&t.contentWindow.document&&t.contentWindow.document.designMode=="on"?new re(t):i.isContentEditable?new en(i):null}else if(i.isContentEditable)return new en(i);return null}var tt=function(){function i(){var t=this;this.pending=!1;var e=this.bg=document.createElement("div"),n=this.lb=document.createElement("div"),c=this.lt=document.createElement("div"),l=this.gr=document.createElement("div"),r=this.bx=document.createElement("div");e.className="kmw-wait-background",n.className="kmw-wait-box",this.dismiss=null,c.className="kmw-wait-text",l.className="kmw-wait-graphic",r.className="kmw-alert-close",n.onmousedown=n.onclick=function(s){r.style.display=="block"&&(e.style.display="none",t.dismiss&&t.dismiss())},n.addEventListener("touchstart",n.onclick,!1),e.onmousedown=e.onclick=function(s){s.preventDefault(),s.stopPropagation()},e.addEventListener("touchstart",e.onclick,!1),n.appendChild(r),n.appendChild(c),n.appendChild(l),e.appendChild(n),document.body.appendChild(e)}return Object.defineProperty(i.prototype,"rootElement",{get:function(){return this.bg},enumerable:!1,configurable:!0}),i.prototype.wait=function(t){var e=this,n=this.bg;typeof n=="undefined"||n==null||(t?(this.pending=!0,window.setTimeout(function(){e.pending&&(window.scrollTo(0,0),e.bx.style.display="none",e.lt.className="kmw-wait-text",e.lt.innerHTML=t,e.gr.style.display="block",n.style.display="block")},1e3)):this.pending&&(this.lt.innerHTML="",this.pending=!1,n.style.display="none"))},i.prototype.alert=function(t,e){var n=this.bg;this.bx.style.display="block",this.lt.className="kmw-alert-text",this.lt.innerHTML=t,this.gr.style.display="none",n.style.display="block",this.dismiss=arguments.length>1?e:null},i.prototype.shutdown=function(){this.bg.parentNode.removeChild(this.bg)},i}();function Zt(){return document.readyState==="complete"?Promise.resolve():new Promise(function(i,t){var e=function(){window.removeEventListener("load",e),i()};window.addEventListener("load",e)})}var ml=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.initialize=function(e){var n=this;this._options?this._options=(0,d.__assign)((0,d.__assign)({},this._options),e):this._options=(0,d.__assign)({},e),i.prototype.initialize.call(this,e),this._options=e,this._ui=e.ui,this._attachType=e.attachType,Zt().then(function(){var c;e.useAlerts&&!n.alertHost?n._alertHost=new tt:!e.useAlerts&&n.alertHost&&((c=n._alertHost)===null||c===void 0||c.shutdown(),n._alertHost=null)})},Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachType",{get:function(){return this._attachType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alertHost",{get:function(){return this._alertHost},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"signalUser",{set:function(e){(!e||e!=this.alertHost)&&this.alertHost.shutdown(),this._alertHost=e},enumerable:!1,configurable:!0}),t.prototype.debugReport=function(){var e=i.prototype.debugReport.call(this);return e.attachType=this.attachType,e.ui=this._ui,e.keymanEngine="app/browser",e},t.prototype.onRuleFinalization=function(e,n){var c=e.transcription.transform;_e(c)||n instanceof ce&&(n.changed=!0)},t}(bn);var Xl=(0,d.__assign)({ui:"",attachType:"",useAlerts:!0},Un);var Ic=function(){function i(t,e,n){this.interface=t,this.keyboard=e}return i}();function ve(i){var t=i==null?void 0:i.target;return fe(t)}function fe(i){var t;if(i==null)return null;if(i.body&&(i=i.body),i.nodeType==3&&(i=i.parentNode),P(i,"HTMLInputElement")){var e=i.type.toLowerCase();if(!(e=="text"||e=="search"))return null}return(t=i._kmwAttachment)===null||t===void 0?void 0:t.interface}var Vl=R(H(),1);var Qc=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this;if(!e)throw new Error("Cannot attach to a null/undefined document");return c=i.call(this)||this,c.baseFont="",c.appliedFont="",c.embeddedPageContexts=[],c._inputList=[],c._sortedInputs=[],c._InputModeObserverCore=function(l){c.disableInputModeObserver();try{for(var r=0,s=l;r<s.length;r++){var o=s[r],a=o.target;!c.isAttached(a)||(a._kmwAttachment.inputMode=a.inputMode,c.device.touchable&&(a.inputMode="none"))}}finally{c.enableInputModeObserver()}},c._EnablementMutationObserverCore=function(l){for(var r=0;r<l.length;r++){var s=l[r],o=s.oldValue?s.oldValue.indexOf("kmw-disabled")>=0:!1,a=s.target.className.indexOf("kmw-disabled")>=0;if(o&&!a?c._EnableControl(s.target):!o&&a&&c._DisableControl(s.target),!a&&s.attributeName=="readonly"){var B=s.oldValue?s.oldValue!=null:!1,g=s.target;if(g instanceof g.ownerDocument.defaultView.HTMLInputElement||g instanceof g.ownerDocument.defaultView.HTMLTextAreaElement){var F=g.readOnly;B&&!F?c._EnableControl(s.target):!B&&F&&c._DisableControl(s.target)}}}},c._AutoAttachObserverCore=function(l){for(var r=[],s=[],o=0;o<l.length;o++){for(var a=l[o],B=0;B<a.addedNodes.length;B++)r=r.concat(c._GetDocumentEditables(a.addedNodes[B]));for(B=0;B<a.removedNodes.length;B++)s=s.concat(c._GetDocumentEditables(a.removedNodes[B]))}for(var g=0;g<r.length;g++)c.isKMWInput(r[g])&&c._MutationAdditionObserved(r[g]);for(g=0;g<s.length;g++){var F=!1,u=s[g];if(u instanceof u.ownerDocument.defaultView.HTMLIFrameElement){for(var I=0;I<c.embeddedPageContexts.length;I++)if(c.embeddedPageContexts[I].options.owner==u){c.embeddedPageContexts[I].shutdown(),c.embeddedPageContexts.splice(I,1),F=!0;break}if(!F){for(var y=0;y<c._inputList.length;y++)if(c._inputList[y]==u){c.detachFromControl(u),c._inputList[y]==u&&c._inputList.splice(y,1);break}}}else c.isKMWInput(u)&&c._MutationRemovalObserved(u)}(r.length||s.length)&&(c.device.touchable?c.device.touchable&&window.setTimeout(function(){c.listInputs()},1):c.listInputs())},c._MutationAdditionObserved=function(l){if(l instanceof l.ownerDocument.defaultView.HTMLIFrameElement){var r=function(){window.setTimeout(function(){c.attachToControl(l)},1)};l.addEventListener("load",r)}else c.attachToControl(l)},c._MutationRemovalObserved=function(l){c.detachFromControl(l)},c.options=n,c.document=e,c.stylesheetManager=new Ce(c.document.body),c}return Object.defineProperty(t.prototype,"device",{get:function(){return this.options.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return this.document.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inputList",{get:function(){var e=this.embeddedPageContexts.map(function(n){return n.inputList}).reduce(function(n,c){return n.concat(c)},[]);return[].concat(this._inputList).concat(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sortedInputs",{get:function(){return this._sortedInputs},enumerable:!1,configurable:!0}),t.prototype.install=function(e){this.manualAttach=e,this.baseFont=this.getBaseFont(),this.manualAttach||(this._SetupDocument(this.document.documentElement),this.listInputs()),this.options.owner||this.initMutationObservers(this.document,e)},t.prototype.setupElementAttachment=function(e){if(!e._kmwAttachment){var n=tn(e);n||P(e,"HTMLIFrameElement")||console.warn("Could not create processing interface for newly-attached element!"),e._kmwAttachment=new Ic(n,null,this.device.touchable)}},t.prototype.clearElementAttachment=function(e){e._kmwAttachment=null},t.prototype.isKMWInput=function(e){if(e instanceof e.ownerDocument.defaultView.HTMLTextAreaElement)return!0;if(e instanceof e.ownerDocument.defaultView.HTMLInputElement){if(et.isSupportedType(e.type))return!0}else if(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)try{if(e.contentWindow){var n=e.contentWindow.document;if(n)return!(this.device.touchable&&n.designMode.toLowerCase()=="on")}else return!!e._kmwAttachment}catch(c){console.warn("Error during attachment to / detachment from iframe: "),console.warn(c)}else if(e.isContentEditable)return!0;return!1},t.prototype.isAttached=function(e){if(e._kmwAttachment)return!0;if(P(e,"HTMLIFrameElement")){var n=e;if(n.contentDocument==this.document)return!0;for(var c=0,l=this.embeddedPageContexts;c<l.length;c++){var r=l[c];if(r.isAttached(e))return!0}}return!1},t.prototype.isKMWDisabled=function(e){var n=e.className;return e.readOnly?!0:!!(n&&n.indexOf("kmw-disabled")>=0)},t.prototype.enableInputElement=function(e){var n;this.isKMWDisabled(e)||(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement?this._AttachToIframe(e):(this.setupElementAttachment(e),e._kmwAttachment.inputMode=(n=e.inputMode)!==null&&n!==void 0?n:"text",this.disableInputModeObserver(),e.inputMode="none",this.enableInputModeObserver(),e.classList.add("keymanweb-font"),this._inputList.push(e),this.emit("enabled",e)))},t.prototype.disableInputElement=function(e){var n;if(!!e)if(e.ownerDocument.defaultView&&e instanceof e.ownerDocument.defaultView.HTMLIFrameElement||e instanceof HTMLIFrameElement)this._DetachFromIframe(e);else{if(this.isAttached(e)){var c=(n=e._kmwAttachment)===null||n===void 0?void 0:n.inputMode;this.disableInputModeObserver(),e.inputMode=c,this.enableInputModeObserver()}var l=e.className.indexOf("keymanweb-font");l>=0&&(e.className=e.className.replace("keymanweb-font","").trim());var r=this.inputList.indexOf(e);r>-1&&this._inputList.splice(r,1),this.emit("disabled",e)}},t.prototype.enableTouchElement=function(e){return this.isKMWDisabled(e)?(this.emit("disabled",e),!1):(this.isAttached(e)||this.setupElementAttachment(e),this.enableInputElement(e),!0)},t.prototype.disableTouchElement=function(e){if(this.isAttached(e)){var n=e._kmwAttachment.inputMode;this.disableInputModeObserver(),e.inputMode=n,this.enableInputModeObserver()}},t.prototype._AttachToIframe=function(e){var n=this;try{var c=e.contentWindow.document;if(c){if(c.designMode.toLowerCase()=="on")this.setupElementAttachment(e),c.body._kmwAttachment=e._kmwAttachment,this._inputList.push(e),this.emit("enabled",e);else if(this.embeddedPageContexts.filter(function(r){return r.document==c}).length==0){var l=new t(c,(0,d.__assign)((0,d.__assign)({},this.options),{owner:e}));this.embeddedPageContexts.push(l),l.on("enabled",function(r){return n.emit("enabled",r)}),l.on("disabled",function(r){return n.emit("disabled",r)}),l.install(this.manualAttach)}}}catch(r){}},t.prototype._DetachFromIframe=function(e){var n=this,c=function(){n.clearElementAttachment(e);var o=n._inputList.indexOf(e);o!=-1&&n._inputList.splice(o,1),n.emit("disabled",e)};try{var l=e.contentWindow.document;if(l){if(l.designMode.toLowerCase()=="on")l.body._kmwAttachment=null,c();else for(var r=0;r<this.embeddedPageContexts.length;r++)if(this.embeddedPageContexts[r].document==l){var s=this.embeddedPageContexts.splice(r,1)[0];s._ClearDocument(l.body),s.shutdown(),this.embeddedPageContexts.splice(r,1);break}}}catch(o){e._kmwAttachment&&c()}},t.prototype.attachToControl=function(e){var n=this.device.touchable;this.isAttached(e)&&!(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(e)?this.isKMWDisabled(e)?this.emit("disabled",e):n?this.enableTouchElement(e):this.enableInputElement(e):n&&this.emit("disabled",e))},t.prototype.detachFromControl=function(e){!(this.isAttached(e)||e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(e)&&(this.isKMWDisabled(e)||this._DisableControl(e)),this.clearElementAttachment(e))},t.prototype._DisableControl=function(e){(this.isAttached(e)||e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)&&(this.device.touchable&&this.disableTouchElement(e),this.listInputs(),this.disableInputElement(e))},t.prototype._EnableControl=function(e){this.isAttached(e)?(this.device.touchable?this.enableTouchElement(e):this.enableInputElement(e),this.listInputs()):P(e,"HTMLIFrameElement")&&this._AttachToIframe(e)},t.prototype.disableControl=function(e){this.isAttached(e)||console.warn("KeymanWeb is not attached to element "+e);var n=e.className;n.indexOf("kmw-disabled")<0&&(e.className=n?n+" kmw-disabled":"kmw-disabled")},t.prototype.enableControl=function(e){!this.isAttached(e)&&!P(e,"HTMLIFrameElement")&&console.warn("KeymanWeb is not attached to element "+e);var n=e.className,c=n.indexOf("kmw-disabled");c>=0&&(e.className=n.replace("kmw-disabled","").trim())},t.prototype.listInputs=function(){for(var e=[],n=document.getElementsByTagName("input"),c=document.getElementsByTagName("textarea"),l=0;l<n.length;l++)et.isSupportedType(n[l].type)&&n[l].className.indexOf("kmw-disabled")<0&&e.push({ip:n[l],x:K(n[l]),y:_(n[l])});for(var l=0;l<c.length;l++)c[l].className.indexOf("kmw-disabled")<0&&e.push({ip:c[l],x:K(c[l]),y:_(c[l])});e.sort(function(s,o){return s.y!=o.y?s.y-o.y:s.x-o.x});for(var r=[],l=0;l<e.length;l++)r.push(e[l].ip);this._sortedInputs=r},t.prototype.findNeighboringInput=function(e,n){var c,l=this.sortedInputs;if(l.length==0)return null;for(c=0;c<l.length&&l[c]!=e;c++);return c==l.length&&!n&&c--,c=n?c-1:c+1,c=c>=l.length?c-l.length:c,c=c<0?c+l.length:c,l[c]},t.prototype._GetDocumentEditables=function(e){var n=[];if(e.ownerDocument&&e instanceof e.ownerDocument.defaultView.HTMLElement){var c=e.ownerDocument.defaultView;(e instanceof c.HTMLInputElement||e instanceof c.HTMLTextAreaElement||e instanceof c.HTMLIFrameElement)&&n.push(e)}if(e.getElementsByTagName){var l=function(r){return Wt(e.getElementsByTagName(r))};n=n.concat(l("INPUT"),l("TEXTAREA"),l("IFRAME"))}return e.querySelectorAll&&(n=n.concat(Wt(e.querySelectorAll("[contenteditable]")))),e.ownerDocument&&e instanceof e.ownerDocument.defaultView.HTMLElement&&e.isContentEditable&&n.push(e),n},t.prototype._SetupDocument=function(e){for(var n=this._GetDocumentEditables(e),c=0;c<n.length;c++)this.attachToControl(n[c])},t.prototype._ClearDocument=function(e){for(var n=this._GetDocumentEditables(e),c=0;c<n.length;c++)this.detachFromControl(n[c])},t.prototype.initMutationObservers=function(e,n){if(typeof MutationObserver=="function"){var c=e.querySelector("body"),l;n||(l={childList:!0,subtree:!0},this.attachmentObserver=new MutationObserver(this._AutoAttachObserverCore),this.attachmentObserver.observe(c,l)),l={subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["class","readonly"]},this.enablementObserver=new MutationObserver(this._EnablementMutationObserverCore),this.enablementObserver.observe(c,l),this.inputModeObserver=new MutationObserver(this._InputModeObserverCore),this.enableInputModeObserver()}else console.warn("Your browser is outdated and does not support MutationObservers, a web feature needed by KeymanWeb to support dynamically-added elements.")},t.prototype.enableInputModeObserver=function(){var e,n=document.querySelector("body"),c={subtree:!0,attributes:!0,attributeFilter:["inputmode"]};(e=this.inputModeObserver)===null||e===void 0||e.observe(n,c)},t.prototype.disableInputModeObserver=function(){var e;(e=this.inputModeObserver)===null||e===void 0||e.disconnect()},t.prototype.getBaseFont=function(){var e=document.getElementsByTagName("input"),n=document.getElementsByTagName("textarea"),c=0,l,r="Arial,sans-serif";if(e.length==0&&n.length==0)c=0;else if(e.length>0&&n.length==0)c=1;else if(e.length==0&&n.length>0)c=2;else{var s=e[0],o=n[0];s.offsetTop<o.offsetTop?c=1:s.offsetTop>o.offsetTop?c=2:s.offsetLeft<o.offsetLeft?c=1:s.offsetLeft>o.offsetLeft&&(c=2)}switch(c){case 0:l=r;break;case 1:l=getComputedStyle(e[0]).fontFamily||"";break;case 2:l=getComputedStyle(n[0]).fontFamily||"";break}return(typeof l=="undefined"||l=="monospace")&&(l=r),l},t.prototype.buildAttachmentFontStyle=function(e){var n=e,c=this.baseFont;n&&typeof n.family!="undefined"&&(c=n.family),c=c.replace(/\u0022/g,"");var l=new RegExp("\\s?"+c+",?"),r=this.appliedFont.replace(/\u0022/g,"");r=r.replace(l,""),r=r.replace(/,$/,""),r==""?r=c:r=c+","+r,r='"'+r.replace(/\,\s?/g,'","')+'"';var s=".keymanweb-font{\nfont-family:"+r+" !important;\n}\n";return this.appliedFont=r,s},t.prototype.setAttachmentFont=function(e,n,c){this.stylesheetManager.unlinkAll(),this.stylesheetManager.addStyleSheetForFont(e,n,c),this.stylesheetManager.linkStylesheet(Je(this.buildAttachmentFontStyle(e)))},t.prototype.shutdown=function(){var e,n,c,l;try{(e=this.enablementObserver)===null||e===void 0||e.disconnect(),(n=this.attachmentObserver)===null||n===void 0||n.disconnect(),(c=this.inputModeObserver)===null||c===void 0||c.disconnect(),(l=this.stylesheetManager)===null||l===void 0||l.unlinkAll(),this.inputModeObserver=null,this.embeddedPageContexts.forEach(function(a){try{a.shutdown()}catch(B){}});for(var r=0,s=this.inputList;r<s.length;r++){var o=s[r];try{this.detachFromControl(o)}catch(a){this.emit("disabled",o)}}this._inputList=[]}catch(a){console.error("Error occurred during shutdown"),console.error(a)}},t}(Vl.default);var Zl=R(H(),1),uo=function(){function i(t,e){this.activationPending=t,this.activated=e}return i}();var vl=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n._maintainingFocus=!1,n.restoringFocus=!1,n._IgnoreNextSelChange=0,n.isTargetForcingScroll=e,n}return Object.defineProperty(t.prototype,"maintainingFocus",{get:function(){return this._maintainingFocus},set:function(e){var n=this._maintainingFocus;this._maintainingFocus=e,n&&!e&&this.emit("maintainingfocusend")},enumerable:!1,configurable:!0}),t.prototype.getUIState=function(){return new uo(this.maintainingFocus,this.restoringFocus)},t.prototype.setMaintainingFocus=function(e){this.maintainingFocus=!!e},t.prototype.setFocusTimer=function(){this.focusing=!0,this.focusTimer=window.setTimeout(function(){this.focusing=!1}.bind(this),50)},t}(Zl.default);function fl(i,t){var e=t!=null&&t.isRTL?"rtl":"ltr";i&&(i instanceof i.ownerDocument.defaultView.HTMLInputElement||i instanceof i.ownerDocument.defaultView.HTMLTextAreaElement?i.value.length==0&&(i.dir=e):typeof i.textContent=="string"&&i.textContent.length==0&&(i.dir=e))}var yo=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e)||this;return c.cookieManager=new Fe("KeymanWeb_Keyboard"),c.focusAssistant=new vl(function(){var l;return(l=c.activeTarget)===null||l===void 0?void 0:l.isForcingScroll()}),c.domEventTracker=new me,c._ControlFocus=function(l){var r=ve(l);return r&&c.setActiveTarget(r,!0),!0},c._ControlBlur=function(l){if(c.focusAssistant._IgnoreNextSelChange)return c.focusAssistant._IgnoreNextSelChange--,l.cancelBubble=!0,l.stopPropagation(),!0;if(c.focusAssistant.isTargetForcingScroll())return l.cancelBubble=!0,l.stopPropagation(),!0;var r=ve(l);if(r==null)return!0;c.lastActiveTarget&&c._BlurKeyboardSettings(c.lastActiveTarget.getElement());var s=c.activeTarget;c.currentTarget=null,(s||c.lastActiveTarget)&&(c.mostRecentTarget=r),c.focusAssistant.restoringFocus=!1;var o=c.activeKeyboard,a=c.focusAssistant.maintainingFocus;return!a&&o&&o.keyboard.notify(0,r,0),s&&!c.activeTarget&&c.emit("targetchange",null),c.apiEvents.callEvent("controlblurred",{target:r.getElement(),event:l,isActivating:a}),c.doChangeEvent(r),c.resetContext(),!0},c._Click=function(l){return c.resetContext(),!0},c.nonKMWTouchHandler=function(l){c.focusAssistant.focusing=!1,clearTimeout(c.focusAssistant.focusTimer),c.forgetActiveTarget()},c._eventsObj=n,c.page=new Qc(window.document,{hostDevice:c.engineConfig.hostDevice}),c.focusAssistant.on("maintainingfocusend",function(){!c.activeTarget&&c.mostRecentTarget&&c.emit("targetchange",c.activeTarget)}),c}return Object.defineProperty(t.prototype,"apiEvents",{get:function(){return this._eventsObj()},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){var e=this;this.on("keyboardasyncload",function(n,c){var l;(l=e.engineConfig.alertHost)===null||l===void 0||l.wait("Installing keyboard<br/>"+n.name),c.then(function(){var r;(r=e.engineConfig.alertHost)===null||r===void 0||r.wait()})}),this.engineConfig.deferForInitialization.then(function(){var n=e.engineConfig.hostDevice,c=function(l){return l.stopPropagation()};e.page.on("enabled",function(l){if(!(l._kmwAttachment.interface instanceof re))n.touchable&&(e.domEventTracker.detachDOMEvent(l,"touchstart",e.nonKMWTouchHandler),e.domEventTracker.attachDOMEvent(l,"touchmove",c,!1),e.domEventTracker.attachDOMEvent(l,"touchend",c,!1)),e.domEventTracker.attachDOMEvent(l,"focus",e._ControlFocus),e.domEventTracker.attachDOMEvent(l,"blur",e._ControlBlur),e.domEventTracker.attachDOMEvent(l,"click",e._Click);else{var r=l.contentWindow.document;n.browser=="firefox"?(e.domEventTracker.attachDOMEvent(r,"focus",e._ControlFocus),e.domEventTracker.attachDOMEvent(r,"blur",e._ControlBlur)):(e.domEventTracker.attachDOMEvent(r.body,"focus",e._ControlFocus),e.domEventTracker.attachDOMEvent(r.body,"blur",e._ControlBlur))}}),e.page.on("disabled",function(l){var r;if(!P(l,"HTMLIFrameElement"))n.touchable&&e.domEventTracker.attachDOMEvent(l,"touchstart",e.nonKMWTouchHandler,!1),e.domEventTracker.detachDOMEvent(l,"focus",e._ControlFocus),e.domEventTracker.detachDOMEvent(l,"blur",e._ControlBlur),e.domEventTracker.detachDOMEvent(l,"click",e._Click);else{var s=l.contentWindow.document;n.browser=="firefox"?(e.domEventTracker.detachDOMEvent(s,"focus",e._ControlFocus),e.domEventTracker.detachDOMEvent(s,"blur",e._ControlBlur)):(e.domEventTracker.detachDOMEvent(s.body,"focus",e._ControlFocus),e.domEventTracker.detachDOMEvent(s.body,"blur",e._ControlBlur))}var o=(r=e.mostRecentTarget)===null||r===void 0?void 0:r.getElement();o&&o==l&&e.forgetActiveTarget()}),e.page.install(e.engineConfig.attachType=="manual")})},Object.defineProperty(t.prototype,"activeTarget",{get:function(){var e=this.focusAssistant.maintainingFocus;return this.currentTarget||(e?this.mostRecentTarget:null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastActiveTarget",{get:function(){return this.mostRecentTarget},enumerable:!1,configurable:!0}),t.prototype.deactivateCurrentTarget=function(){var e=this.activeTarget||this.lastActiveTarget;e&&this.page.isAttached(e.getElement())&&this._BlurKeyboardSettings(e.getElement()),this.activeTarget||this.setActiveTarget(null,!0)},t.prototype.forgetActiveTarget=function(){this.focusAssistant.maintainingFocus=!1,this.focusAssistant.restoringFocus=!1;var e=this.activeTarget||this.mostRecentTarget;e&&this._BlurKeyboardSettings(e.getElement()),this.setActiveTarget(null,!0),e==this.lastActiveTarget&&(this.mostRecentTarget=null)},t.prototype.setActiveTarget=function(e,n){var c,l=this.mostRecentTarget,r=this.activeTarget;if(e==r){r&&(this.currentTarget=r);return}var s=!!l;if(this.currentTarget=this.mostRecentTarget=e,this.predictionContext.setCurrentTarget(e),this.focusAssistant.restoringFocus?this._BlurKeyboardSettings(e.getElement()):e&&this._FocusKeyboardSettings(e.getElement(),!s),this._CommonFocusHelper(e))return!0;var o=e==null?void 0:e.getElement();e instanceof re&&(o=e.docRoot),o&&o.ownerDocument&&o instanceof o.ownerDocument.defaultView.HTMLElement&&fl(o,(c=this.activeKeyboard)===null||c===void 0?void 0:c.keyboard),e!=r&&this.emit("targetchange",e),n&&this.apiEvents.callEvent("controlfocused",{target:(e==null?void 0:e.getElement())||null,activeControl:l==null?void 0:l.getElement()})},Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this._activeKeyboard},enumerable:!1,configurable:!0}),t.prototype.restoreLastActiveTarget=function(){!this.mostRecentTarget||(this.focusAssistant.restoringFocus=!0,this.mostRecentTarget.focus(),this.focusAssistant.restoringFocus=!1)},t.prototype.insertText=function(e,n,c){this.restoreLastActiveTarget();var l=this.activeTarget;return l==null&&this.mostRecentTarget&&(l=this.activeTarget),l!=null?i.prototype.insertText.call(this,e,n,c):!1},t.prototype.currentKeyboardSrcTarget=function(){var e=this.currentTarget||this.mostRecentTarget;return this.isTargetKeyboardIndependent(e)?e:null},t.prototype.isTargetKeyboardIndependent=function(e){var n=e==null?void 0:e.getElement()._kmwAttachment;return!!((n==null?void 0:n.keyboard)||(n==null?void 0:n.keyboard)==="")},t.prototype.activateKeyboardForTarget=function(e,n){var c,l,r=n==null?void 0:n.getElement()._kmwAttachment;if(r?(r.keyboard=(c=e==null?void 0:e.metadata.id)!==null&&c!==void 0?c:"",r.languageCode=(l=e==null?void 0:e.metadata.langId)!==null&&l!==void 0?l:""):this.globalKeyboard=e,this.currentKeyboardSrcTarget()==n){this._activeKeyboard=e;var s=e==null?void 0:e.metadata;this.page.setAttachmentFont(s==null?void 0:s.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS)}},t.prototype.setKeyboardForTarget=function(e,n,c){if(e instanceof re){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}var l=e.getElement()._kmwAttachment,r=this.currentKeyboardSrcTarget()==e;if(l){if(l.keyboard=n||null,l.languageCode=c||null,r||this.currentKeyboardSrcTarget()==e){var s=this.globalKeyboard.metadata;this.activateKeyboard(l.keyboard||s.id,l.languageCode||s.langId,!0)}}else return},t.prototype.getKeyboardStubForTarget=function(e){if(this.isTargetKeyboardIndependent(e)){var n=e.getElement()._kmwAttachment;return this.keyboardCache.getStub(n.keyboard,n.languageCode)}else return this.globalKeyboard.metadata},t.prototype.getFallbackStubKey=function(){var e={id:"",langId:""};return this.engineConfig.hostDevice.touchable&&this.keyboardCache.defaultStub||e},t.prototype.activateKeyboard=function(e,n,c){var l,r,s,o,a,B;return(0,d.__awaiter)(this,void 0,void 0,function(){var g,F,u,I,y,Q=this;return(0,d.__generator)(this,function(h){switch(h.label){case 0:c||(c=!1),g=this.currentKeyboardSrcTarget(),e||(e=this.getFallbackStubKey().id,n=this.getFallbackStubKey().langId),h.label=1;case 1:return h.trys.push([1,3,,7]),[4,i.prototype.activateKeyboard.call(this,e,n,c)];case 2:return F=h.sent(),(l=this.engineConfig.alertHost)===null||l===void 0||l.wait(),c&&!g&&this.cookieManager.save({current:"".concat(e,":").concat(n)}),g==this.currentKeyboardSrcTarget()&&(fl((r=this.currentTarget)===null||r===void 0?void 0:r.getElement(),this.keyboardCache.getKeyboard(e)),this.page.setAttachmentFont((o=(s=this.activeKeyboard)===null||s===void 0?void 0:s.metadata)===null||o===void 0?void 0:o.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS),this.restoreLastActiveTarget()),[2,F];case 3:return u=h.sent(),I=function(){return(0,d.__awaiter)(Q,void 0,void 0,function(){var C;return(0,d.__generator)(this,function(b){switch(b.label){case 0:return C=this.getFallbackStubKey(),C.id==e?[3,2]:[4,this.activateKeyboard(C.id,C.langId,!0).catch(function(){})];case 1:b.sent(),b.label=2;case 2:return[2]}})})},(a=this.engineConfig.alertHost)===null||a===void 0||a.wait(),y=(u==null?void 0:u.message)||"Sorry, the "+e+" keyboard for "+n+" is not currently available.",u instanceof ut?console.error(u||y):console.warn(u||y),this.engineConfig.alertHost?((B=this.engineConfig.alertHost)===null||B===void 0||B.alert(y,I),[3,6]):[3,4];case 4:return[4,I()];case 5:h.sent(),h.label=6;case 6:throw u;case 7:return[2]}})})},t.prototype._BlurKeyboardSettings=function(e,n,c){var l,r=this.activeKeyboard?this.activeKeyboard.keyboard.id:"",s=(l=this.activeKeyboard)===null||l===void 0?void 0:l.metadata.langId;n!==void 0&&c!==void 0&&(r=n,s=c),e&&e._kmwAttachment.keyboard!=null?(e._kmwAttachment.keyboard=r,e._kmwAttachment.languageCode=s):this.globalKeyboard=this.activeKeyboard},t.prototype._FocusKeyboardSettings=function(e,n){var c,l=e._kmwAttachment,r=this.globalKeyboard;l.keyboard!=null?this.activateKeyboard(l.keyboard,l.languageCode,!0):!n&&(r==null?void 0:r.metadata)!=((c=this._activeKeyboard)===null||c===void 0?void 0:c.metadata)&&this.activateKeyboard(r==null?void 0:r.metadata.id,r==null?void 0:r.metadata.langId,!0)},t.prototype._CommonFocusHelper=function(e){var n,c=this.focusAssistant,l=(n=this.activeKeyboard)===null||n===void 0?void 0:n.keyboard;return c.restoringFocus||(e==null||e.deadkeys().clear(),l==null||l.notify(0,e,1)),!c.restoringFocus&&this.mostRecentTarget!=e&&(c.maintainingFocus=!1),c.restoringFocus=!1,this.resetContext(),!1},t.prototype.doChangeEvent=function(e){if(e.changed){var n=new Event("change",{bubbles:!0,cancelable:!1});e.getElement().dispatchEvent(n)}e.changed=!1},t.prototype.getSavedKeyboardRaw=function(){var e=new Fe("KeymanWeb_Keyboard"),n=e.load(decodeURIComponent);return typeof n.current!="string"||n.current=="Keyboard_us:eng"?"Keyboard_us:en":n.current},t.prototype.getSavedKeyboard=function(){for(var e=this.getSavedKeyboardRaw(),n=this.keyboardCache.getStubList(),c,l=0;l<n.length;l++)if(c=n[l].KI+":"+n[l].KLC,c==e)return c;for(var l=0;l<n.length;l++)if(c=n[l].KI+":"+n[l].KLC,c=="Keyboard_us:en")return c;return n.length>0?n[0].KI+":"+n[0].KLC:"Keyboard_us:en"},t.prototype.restoreSavedKeyboard=function(e){var n=e,c=n.split(":");c.length<2&&(c[1]="");var l=this.keyboardCache.getStub(c[0],c[1])||this.keyboardCache.defaultStub;l&&this.activateKeyboard(c[0],c[1])},t.prototype.shutdown=function(){this.page.shutdown(),this.domEventTracker.shutdown()},t}(xn),Ll=yo;var Io=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.contextManager=e,n}return t.prototype.isCommand=function(e){var n=this.codeForEvent(e);switch(n){case U.keyCodes.K_TAB:case U.keyCodes.K_TABBACK:case U.keyCodes.K_TABFWD:return!0;default:return i.prototype.isCommand.call(this,e)}},t.prototype.applyCommand=function(e,n){var c=this,l=this.codeForEvent(e),r=function(s){var o,a=c.contextManager,B=(o=a.activeTarget)===null||o===void 0?void 0:o.getElement(),g=a.page.findNeighboringInput(B,s);g.focus()};switch(l){case U.keyCodes.K_TAB:r((e.Lmodifiers&U.modifierCodes.SHIFT)!=0);break;case U.keyCodes.K_TABBACK:r(!0);break;case U.keyCodes.K_TABFWD:r(!1);break}i.prototype.applyCommand.call(this,e,n)},t}(Ee),Jl=Io;function hc(i){return i.keyCode?i.keyCode:i.which?i.which:null}function nn(i,t,e){if(i.cancelBubble===!0)return null;var n=hc(i);if(n==null)return null;var c=t.modStateFlags,l=0,r=!1,s=!1,o=U.keyCodes;switch(n){case o.K_CTRL:case o.K_LCTRL:case o.K_RCTRL:case o.K_CONTROL:case o.K_LCONTROL:case o.K_RCONTROL:r=!0;break;case o.K_LMENU:case o.K_RMENU:case o.K_ALT:case o.K_LALT:case o.K_RALT:s=!0;break}l|=i.getModifierState("Shift")?16:0;var a=U.modifierCodes;i.getModifierState("Control")&&(l|=i.location!=0&&r?i.location==1?a.LCTRL:a.RCTRL:c&3),i.getModifierState("Alt")&&(l|=i.location!=0&&s?i.location==1?a.LALT:a.RALT:c&12);var B=0;B|=i.getModifierState("CapsLock")?a.CAPS:a.NO_CAPS,B|=i.getModifierState("NumLock")?a.NUM_LOCK:a.NO_NUM_LOCK,B|=i.getModifierState("ScrollLock")?a.SCROLL_LOCK:a.NO_SCROLL_LOCK,l|=B;var g=t.modStateFlags!=l;t.modStateFlags=l;var F=a.RALT|a.LCTRL;(c&F)==F&&(l&F)!=F&&(l&=~F),l&a.RALT&&(l&=~a.LCTRL);var u=U.modifierBitmasks,I=t.activeKeyboard,y;I&&I.isChiral?(y=l&u.CHIRAL,I.emulatesAltGr&&(y&u.ALT_GR_SIM)==u.ALT_GR_SIM&&(y^=u.ALT_GR_SIM,y|=a.RALT)):y=l&16|(l&(a.LCTRL|a.RCTRL)?32:0)|(l&(a.LALT|a.RALT)?64:0),y|=i.metaKey?a.META:0,e.browser==V.Browser.Firefox&&ae.browserMap.FF["k"+n]&&(n=ae.browserMap.FF["k"+n]);var Q=new oe({device:e,kName:"",Lcode:n,Lmodifiers:y,Lstates:B,LmodifierChange:g,isSynthetic:!1}),h=typeof i.charCode!="undefined"&&i.charCode!=null&&(i.charCode==0||(y&111)!=0);Q.LisVirtualKey=h||i.type!="keypress",Q=Gn(Q,I,t.baseLayout);var C=new oe(Q);return C.source=i,C}var Qo=function(i){(0,d.__extends)(t,i);function t(e,n,c){var l=i.call(this)||this;l.domEventTracker=new me,l.swallowKeypress=!1,l._KeyDown=function(o){var a,B=l.contextManager.activeKeyboard,g=ve(o);if(!g||B==null)return!0;var F=g.getElement();return((a=F==null?void 0:F.className)===null||a===void 0?void 0:a.indexOf("kmw-disabled"))>=0?!0:l.keyDown(o)},l._KeyPress=function(o){var a=ve(o);return!a||l.activeKeyboard==null?!0:l.keyPress(o)},l._KeyUp=function(o){var a=ve(o),B=nn(o,l.processor,l.hardDevice);if(B==null||a==null)return!0;var g=a.getElement();if(B.Lcode==13){var F=!1;if(P(g,"HTMLTextAreaElement")&&(F=!0),!F){if(g instanceof g.ownerDocument.defaultView.HTMLInputElement)if(g.form&&(g.type=="search"||g.type=="submit"))g.form.submit();else{var u=l.contextManager.page.findNeighboringInput(g,!1);u.focus()}return!0}}return l.keyUp(o)},l.hardDevice=e,l.contextManager=c,l.processor=n;var r=c.page,s=l.domEventTracker;return r.on("enabled",function(o){var a=fe(o);if(!(a instanceof re))s.attachDOMEvent(o,"keypress",l._KeyPress),s.attachDOMEvent(o,"keydown",l._KeyDown),s.attachDOMEvent(o,"keyup",l._KeyUp);else{var B=a.getElement().contentDocument;s.attachDOMEvent(B.body,"keydown",l._KeyDown),s.attachDOMEvent(B.body,"keypress",l._KeyPress),s.attachDOMEvent(B.body,"keyup",l._KeyUp)}}),r.on("disabled",function(o){var a=fe(o);if(!(a instanceof re))s.detachDOMEvent(o,"keypress",l._KeyPress),s.detachDOMEvent(o,"keydown",l._KeyDown),s.detachDOMEvent(o,"keyup",l._KeyUp);else{var B=a.getElement().contentDocument;s.detachDOMEvent(B.body,"keydown",l._KeyDown),s.detachDOMEvent(B.body,"keypress",l._KeyPress),s.detachDOMEvent(B.body,"keyup",l._KeyUp)}}),l}return Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this.contextManager.activeKeyboard.keyboard},enumerable:!1,configurable:!0}),t.prototype.keyDown=function(e){var n=this;this.swallowKeypress=!1;var c=nn(e,this.processor,this.hardDevice);if(c==null)return!0;var l={LeventMatched:!1};return this.emit("keyevent",c,function(r,s){l.LeventMatched=r&&!r.triggerKeyDefault,l.LeventMatched?(e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),n.swallowKeypress=!!c.Lcode,c.Lcode==8&&(n.swallowKeypress=!1)):n.swallowKeypress=!1}),!l.LeventMatched},t.prototype.keyUp=function(e){var n=nn(e,this.processor,this.hardDevice);if(n==null)return!0;var c=ve(e);return this.processor.doModifierPress(n,c,!1)},t.prototype.keyPress=function(e){var n=nn(e,this.processor,this.hardDevice);if(n==null||n.LisVirtualKey)return!0;if(!this.activeKeyboard.isMnemonic)return!this.swallowKeypress||n.Lcode<32||this.hardDevice.browser==V.Browser.Safari&&n.Lcode>63232&&n.Lcode<63744;var c={};return this.swallowKeypress||this.emit("keyevent",n,function(l,r){c.preventDefaultKeystroke=!!l}),this.swallowKeypress||c.preventDefaultKeystroke?(this.swallowKeypress=!1,e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),!1):(this.swallowKeypress=!1,!0)},t.prototype.shutdown=function(){this.domEventTracker.shutdown()},t}(pn),Sl=Qo;var Rl=function(){function i(){this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}return i.prototype.equals=function(t){return this.innerWidth==t.innerWidth&&this.innerHeight==t.innerHeight},i}(),Al=function(){function i(t){this.idlePermutationCounter=i.IDLE_PERMUTATION_CAP,this.keyman=t}return i.prototype.resolve=function(){var t,e=this.keyman.osk;(t=this.keyman.touchLanguageMenu)===null||t===void 0||t.hide(),this.keyman.touchLanguageMenu=null,e.setNeedsLayout(),this.oskVisible&&e.present(),this.isActive=!1,this.updateTimer&&(window.clearInterval(this.updateTimer),this.rotState=null)},i.prototype.initNewRotation=function(){this.oskVisible=this.keyman.osk.isVisible(),this.keyman.osk.hideNow(),this.isActive=!0},i.prototype.init=function(){var t=this,e=this.keyman.config.hostDevice.OS,n=this.keyman.util;e=="ios"?(n.attachDOMEvent(window,"orientationchange",function(){return t.iOSEventHandler(),!1}),n.attachDOMEvent(window,"resize",function(){return t.iOSEventHandler(),!1})):e=="android"&&("onmozorientationchange"in screen?n.attachDOMEvent(screen,"mozorientationchange",function(){return t.initNewRotation(),!1}):n.attachDOMEvent(window,"orientationchange",function(){return t.initNewRotation(),!1}),n.attachDOMEvent(window,"resize",function(){return t.resolve(),!1}))},i.prototype.iOSEventHandler=function(){this.isActive||(this.initNewRotation(),this.rotState=new Rl,this.updateTimer=window.setInterval(this.iOSEventUpdate.bind(this),i.UPDATE_INTERVAL)),this.idlePermutationCounter=0},i.prototype.iOSEventUpdate=function(){var t=new Rl;this.rotState.equals(t)?++this.idlePermutationCounter==i.IDLE_PERMUTATION_CAP&&this.resolve():(this.rotState=t,this.idlePermutationCounter=0)},i.IDLE_PERMUTATION_CAP=15,i.UPDATE_INTERVAL=20,i}();var Hl=function(){function i(t,e){var n=this;this.domEventTracker=new me,this.suppressFocusCheck=function(c){return n.focusAssistant.isTargetForcingScroll()&&(c.stopPropagation(),c.cancelBubble=!0),!0},this.pageFocusHandler=function(){var c;return!n.focusAssistant.maintainingFocus&&((c=n.engine.osk)===null||c===void 0?void 0:c.vkbd)&&(n.engine.contextManager.deactivateCurrentTarget(),n.engine.contextManager.resetContext()),!1},this.touchStartActivationHandler=function(c){var l=n.engine.osk;if(!l)return!1;var r=n.engine.config.hostDevice;if(n.deactivateOnRelease=!0,n.touchY=c.touches[0].screenY,n.deactivateOnScroll=!1,r.OS=="android"&&r.browser=="chrome"){if(typeof l._Box=="undefined"||typeof l._Box.style=="undefined")return!1;var s=c.target.parentElement;if(typeof s!="undefined"&&s!=null&&(s.className.indexOf("kmw-key-")>=0||typeof s.parentElement!="undefined"&&s.parentElement!=null&&(s=s.parentElement,s.className.indexOf("kmw-key-")>=0)))return!1;n.deactivateOnScroll=!0}return!1},this.touchMoveActivationHandler=function(c){n.deactivateOnScroll&&(n.focusAssistant.focusing=!1,n.engine.contextManager.deactivateCurrentTarget());var l=c.touches[0].screenY,r=n.touchY;return(l-r>5||r-l<5)&&(n.deactivateOnRelease=!1),!1},this.touchEndActivationHandler=function(c){return n.deactivateOnRelease&&!n.engine.touchLanguageMenu&&!n.focusAssistant.focusing&&n.engine.contextManager.deactivateCurrentTarget(),n.deactivateOnRelease=!1,!1},this._WindowLoad=function(){document.body.scrollTop=0,typeof document.documentElement!="undefined"&&(document.documentElement.scrollTop=0)},this._WindowUnload=function(){n.engine.shutdown()},this.window=t,this.engine=e,this.attachHandlers(),e.config.hostDevice.touchable&&(this.buildPageTrailer(),this.rotationProcessor=new Al(this.engine),this.rotationProcessor.init())}return i.prototype.buildPageTrailer=function(){var t=this.mobilePageTrailer=document.createElement("div"),e=t.style;e.width="100%",e.height=screen.width/2+"px",document.body.appendChild(t)},Object.defineProperty(i.prototype,"focusAssistant",{get:function(){return this.engine.contextManager.focusAssistant},enumerable:!1,configurable:!0}),i.prototype.attachHandlers=function(){var t=this.domEventTracker,e=this.engine.config.hostDevice,n=this.window.document.body;t.attachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),t.attachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),t.attachDOMEvent(n,"focus",this.suppressFocusCheck,!0),t.attachDOMEvent(n,"blur",this.suppressFocusCheck,!0),e.touchable&&(t.attachDOMEvent(n,"touchstart",this.touchStartActivationHandler,!1),t.attachDOMEvent(n,"touchmove",this.touchMoveActivationHandler,!1),t.attachDOMEvent(n,"touchend",this.touchEndActivationHandler,!1)),t.attachDOMEvent(window,"load",this._WindowLoad,!1),t.attachDOMEvent(window,"unload",this._WindowUnload,!1),t.attachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)},i.prototype.shutdown=function(){var t,e=this.domEventTracker,n=this.engine.config.hostDevice,c=this.window.document.body;e.detachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),e.detachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),e.detachDOMEvent(c,"focus",this.suppressFocusCheck,!0),e.detachDOMEvent(c,"blur",this.suppressFocusCheck,!0),n.touchable&&(e.detachDOMEvent(c,"touchstart",this.touchStartActivationHandler,!1),e.detachDOMEvent(c,"touchmove",this.touchMoveActivationHandler,!1),e.detachDOMEvent(c,"touchend",this.touchEndActivationHandler,!1),(t=this.mobilePageTrailer)===null||t===void 0||t.parentElement.removeChild(this.mobilePageTrailer)),e.detachDOMEvent(window,"load",this._WindowLoad,!1),e.detachDOMEvent(window,"unload",this._WindowUnload,!1),e.detachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)},i}();function se(i){var t=document.createElement(i);return t.style.userSelect="none",t.style.MozUserSelect="none",t.style.KhtmlUserSelect="none",t.style.UserSelect="none",t.style.WebkitUserSelect="none",t}function De(i,t){try{if(i&&typeof window.getComputedStyle!="undefined")return window.getComputedStyle(i,"").getPropertyValue(t)}catch(e){}return""}var Wl=function(){function i(t){this.keyman=t,this.scrolling=!1,this.shim=this.constructShim()}return i.prototype.constructShim=function(){var t=this,e=this,n=se("div"),c=this.keyman.osk;return n.id="kmw-language-menu-background",n.addEventListener("touchstart",function(l){if(l.preventDefault(),e.hide(),l.touches.length>2){var r=l.touches[1].pageX,s=l.touches[1].pageY,o=c.vkbd.spaceBar;r>o.offsetLeft&&r<o.offsetLeft+o.offsetWidth&&s>o.offsetTop&&s<o.offsetTop+o.offsetHeight&&t.keyman.osk.emit("showbuild")}},!1),n},i.prototype.show=function(){var t=this.keyman.config.hostDevice,e=this.keyman.keyboardRequisitioner.cache.getStubList(),n=e.length;if(!(n<1)){var c=this.lgList=se("div");this.lgList.id="kmw-language-menu";var l=this;document.body.appendChild(this.shim);var r=se("div"),s=r.style,o=se("div"),a=o.style;r.id="kmw-menu-scroll-container",o.id="kmw-menu-scroller","WebkitOverflowScrolling"in s&&(s.WebkitOverflowScrolling="touch"),r.appendChild(o),c.appendChild(r);var B,g,F=se("div");for(F.id="kmw-menu-index",B=1;B<=26;B++)g=se("p"),g.innerHTML=String.fromCharCode(B+64),F.appendChild(g);F.addEventListener("touchstart",function(X){l.scrollToLanguage(X,r,o)},!1),F.addEventListener("touchend",function(X){X.stopPropagation()},!1),c.appendChild(F),c.addEventListener("scroll",function(X){l.scrolling=!0},!1),r.addEventListener("scroll",function(X){r.scrollTop<1&&(r.scrollTop=1),r.scrollTop>r.scrollHeight-r.offsetHeight-1&&(r.scrollTop=r.scrollHeight-r.offsetHeight-1)},!1),this.activeLgNo=this.addLanguages(o,e);var u=o.childNodes.length-1;if(this.lgList.style.visibility="hidden",document.body.appendChild(this.lgList),t.OS=="android"&&"devicePixelRatio"in window&&(this.lgList.style.fontSize=2/window.devicePixelRatio+"em"),t.OS=="android"&&t.formFactor=="tablet"&&"devicePixelRatio"in window){var I=parseInt(De(c,"width"),10),y=c.style;isNaN(I)||(y.width=y.maxWidth=2*I/window.devicePixelRatio+"px"),I=parseInt(De(r,"width"),10),y=r.style,isNaN(I)||(y.width=y.maxWidth=2*I/window.devicePixelRatio+"px"),I=parseInt(De(o,"width"),10),y=o.style,isNaN(I)||(y.width=y.maxWidth=2*I/window.devicePixelRatio+"px")}this.adjust(0);var Q=F.childNodes[1].offsetTop-F.childNodes[0].offsetTop,h=Math.floor(c.offsetHeight/26),C=Math.round(100*h/Q)/100,b=C>.6?1:2;for(C>1.25&&(C=1.25),B=0;B<26;B++){var x=F.childNodes[B].style;b==2&&B%2==1?x.display="none":(x.fontSize=C*b+"em",x.lineHeight=h*b+"px")}var G=r.offsetWidth;r.scrollHeight>r.offsetHeight+3?G=G+F.offsetWidth:F.style.display="none",c.style.width=G+"px",this.lgList.style.visibility="",this.scrollToIndex(this.activeLgNo,r,o)}},i.prototype.adjust=function(t){var e=this.keyman.osk,n=this.keyman.config.hostDevice,c=this.lgList,l=c.firstChild,r=l.firstChild,s=0,o=c.style,a=c.childNodes[1],B=window.innerHeight-e.vkbd.lgKey.offsetHeight-16,g=r.childNodes.length+t-1,F=r.firstChild.firstChild.offsetHeight,u=g*F;n.OS=="ios"&&(n.formFactor=="phone"?(s=ee()?36:0,B=(window.innerHeight-s-16)*Ie(n.formFactor)):n.formFactor=="tablet"&&(s=ee()?16:0,B=B-s)),o.left=K(e.vkbd.lgKey)+"px",u>B&&(u=B),o.height=u+"px",o.bottom="0px",a.style.height=l.style.height=o.height},i.prototype.scrollToLanguage=function(t,e,n){t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault();var c=t.touches[0].target;if(c.nodeName=="P"){var l,r,s=c.innerHTML.charCodeAt(0),o=n.childNodes;try{for(l=0;l<o.length-1&&(r=o[l].firstChild.innerHTML.toUpperCase().charCodeAt(0),!(r>=s));l++);}catch(a){}this.scrollToIndex(l,e,n)}},i.prototype.scrollToIndex=function(t,e,n){var c,l=.5;try{c=n.firstChild.getBoundingClientRect().height*(t-l)+1,e.scrollTop=c}catch(r){c=0}try{e.scrollTop<0&&(e.scrollTop=0),e.scrollTop>e.scrollHeight-e.offsetHeight-1&&(e.scrollTop=e.scrollHeight-e.offsetHeight-1)}catch(r){}},i.prototype.addLanguages=function(t,e){var n,c=e.length,l=this.keyman.config.hostDevice,r,s,o,a=[];for(s=0;s<c;s++)o=e[s].KL,a.indexOf(o)==-1&&a.push(o);a.sort();var B=Math.round(100/Ie(l.formFactor))/100,g,F,u,I,y=-1,Q=function(){for(g=se("div"),g.className="kbd-list-closed",F=se("p"),F.kList=[],s=0;s<c;s++)e[s].KL==a[r]&&F.kList.push(e[s]);l.OS=="ios"&&(F.style.fontSize=B+"em"),g.appendChild(F),t.appendChild(g),a[r]==((n=h.keyman.contextManager.activeKeyboard)===null||n===void 0?void 0:n.metadata.langName)&&(y=r);var x=h;if(F.kList.length>1)for(F.className="kbd-list",F.innerHTML=a[r]+"...",F.scrolled=!1,F.ontouchend=function(G){G.stopPropagation(),G.target.scrolled?G.target.scrolled=!1:this.parentNode.className=this.parentNode.className=="kbd-list-closed"?"kbd-list-open":"kbd-list-closed",x.adjust(this.parentNode.className=="kbd-list-closed"?0:this.kList.length)},F.addEventListener("touchstart",function(G){G.stopPropagation()},!1),F.addEventListener("touchmove",function(G){G.target.scrolled=!0,G.stopPropagation()},!1),u=0;u<F.kList.length;u++)I=se("p"),I.className="kbd-list-entry",l.OS=="ios"&&(I.style.fontSize=B+"em"),h.addKeyboard(F.kList[u],I,!1),g.appendChild(I);else F.innerHTML=a[r],F.className="kbd-single-entry",h.addKeyboard(F.kList[0],F,!0);r==y&&(F.className=F.className+" current")},h=this;for(r=0;r<a.length;r++)Q();var C=se("div");C.id="kmw-menu-footer";var b=function(x){x.cancelable&&x.preventDefault(),x.stopPropagation()};return C.addEventListener("touchstart",b,!1),C.addEventListener("touchmove",b,!1),C.addEventListener("touchend",b,!1),t.appendChild(C),y},i.prototype.addKeyboard=function(t,e,n){var c=this;e.kn=t.KI,e.kc=t.KLC,e.innerHTML=n?t.KL:t.KN.replace(" Keyboard","");var l=this,r=function(){if(c.originalBodyStyle){console.error("Unexpected state:  `originalBodyStyle` was not cleared by a previous `unlockBodyScroll()` call");return}c.originalBodyStyle={};var F=c.originalBodyStyle,u=document.body.style;return F.overflowY=u.overflowY,F.height=u.height,u.overflowY="hidden",u.height="100%",!0},s=function(){if(!c.originalBodyStyle){console.error("Unexpected state:  `originalBodyStyle` is unset; cannot restore original body style");return}var F=c.originalBodyStyle,u=document.body.style;u.overflowY=F.overflowY,u.height=F.height,c.originalBodyStyle=null},o=function(F){F.stopPropagation(),this.className.indexOf("selected")<=0&&(this.className=this.className+" selected"),l.scrolling=!1,l.y0=F.touches[0].pageY,r()},a=function(F){F.stopImmediatePropagation();var u=l.lgList.childNodes[0],I=u.scrollHeight-u.offsetHeight,y,Q;if(typeof F.pageY!="undefined")y=F.pageY;else if(typeof F.touches!="undefined")y=F.touches[0].pageY;else return;if(Q=y-l.y0,Q<0)u.scrollTop>=I-1&&(l.y0=y);else if(Q>0)u.scrollTop<2&&(l.y0=y);else return;return(Q<-5||Q>5)&&(l.scrolling=!0,this.className=this.className.replace(/\s*selected/,""),l.y0=y),!0},B=function(F){return typeof F.stopImmediatePropagation!="undefined"?F.stopImmediatePropagation():F.stopPropagation(),l.scrolling?this.className=this.className.replace(/\s*selected/,""):(l.keyman.contextManager.focusAssistant.setFocusTimer(),l.lgList.style.display="none",l.keyman.contextManager.activateKeyboard(this.kn,this.kc,!0),l.keyman.contextManager.restoreLastActiveTarget(),l.hide()),s(),!0},g=function(F){s()};e.onmspointerdown=o,e.addEventListener("touchstart",o,!1),e.onmspointermove=a,e.addEventListener("touchmove",a,!1),e.onmspointerout=B,e.addEventListener("touchend",B,!1),e.addEventListener("touchcancel",g,!1)},i.prototype.hide=function(){var t=this,e=this.keyman.osk;this.lgList&&(e.vkbd.highlightKey(e.vkbd.lgKey,!1),this.lgList.style.visibility="hidden",window.setTimeout(function(){t.shim.parentElement&&(document.body.removeChild(t.shim),document.body.removeChild(t.lgList))},500)),this.keyman.touchLanguageMenu=null},i}();function Nl(i,t,e){var n=this,c=e.focusAssistant;t.on("globekey",function(l,r){r&&t.hostDevice.touchable&&(i.touchLanguageMenu=new Wl(i),i.touchLanguageMenu.show()),t.vkbd&&t.vkbd.highlightKey(l,!1)}),t.on("hiderequested",function(l){t&&(t.startHide(!0),e.forgetActiveTarget())}),t.addEventListener("hide",function(l){var r;l!=null&&l.HiddenByUser&&((r=e.activeTarget)===null||r===void 0||r.focus())}),t.on("showbuild",function(){var l;(l=i.config.alertHost)===null||l===void 0||l.alert("KeymanWeb Version "+Bn.VERSION+'<br /><br /><span style="font-size:0.8em">Copyright &copy; 2007-2023 SIL International</span>')}),t.on("dragmove",function(l){return(0,d.__awaiter)(n,void 0,void 0,function(){return(0,d.__generator)(this,function(r){switch(r.label){case 0:return c.restoringFocus=!0,[4,l];case 1:return r.sent(),e.restoreLastActiveTarget(),c.restoringFocus=!1,c.setMaintainingFocus(!1),[2]}})})}),t.on("resizemove",function(l){return(0,d.__awaiter)(n,void 0,void 0,function(){return(0,d.__generator)(this,function(r){switch(r.label){case 0:return c.restoringFocus=!0,[4,l];case 1:return r.sent(),e.restoreLastActiveTarget(),c.restoringFocus=!1,c.setMaintainingFocus(!1),[2]}})})}),t.on("pointerinteraction",function(l){return(0,d.__awaiter)(n,void 0,void 0,function(){return(0,d.__generator)(this,function(r){switch(r.label){case 0:return c.setMaintainingFocus(!0),[4,l];case 1:return r.sent(),c.setMaintainingFocus(!1),[2]}})})})}function Co(i){var t=document.createElement(i);return t.style.userSelect="none",t}var Tl=function(){function i(t){this.getAbsoluteX=K,this.getAbsoluteY=_,this._GetAbsoluteX=K,this._GetAbsoluteY=_,this._GetAbsolute=this.getAbsolute,this.toNzString=this.nzString,this.createElement=Co,this.getStyleValue=De,this.config=t,this.stylesheetManager=new Ce(document.body,t.applyCacheBusting),this.domEventTracker=new me}return i.prototype.isTouchDevice=function(){return this.config.hostDevice.touchable},i.prototype.getAbsolute=function(t){return{x:K(t),y:_(t)}},i.prototype.getOption=function(t,e){return t in this.config.paths?this.config.paths[t]:t in this.config.options?this.config.options[t]:arguments.length>1?e:""},i.prototype.setOption=function(t,e){switch(t){case"attachType":break;case"ui":break;case"useAlerts":this.config.signalUser=e?new tt:null;break;case"setActiveOnRegister":this.config.activateFirstKeyboard=!!e;break;case"spacebarText":this.config.spacebarText=e;break;default:throw new Error("Path-related options may not be changed after the engine has initialized.")}},i.prototype.loadCookie=function(t){var e=new Fe(t);return e.load(decodeURIComponent)},i.prototype.saveCookie=function(t,e){var n=new Fe(t);n.save(e,encodeURIComponent)},i.prototype.addStyleSheet=function(t){var e=Je(t);return this.stylesheetManager.linkStylesheet(e),e},i.prototype.removeStyleSheet=function(t){return this.stylesheetManager.unlink(t)},i.prototype.linkStyleSheet=function(t){this.stylesheetManager.linkExternalSheet(t)},i.prototype.getLanguageCodes=function(t){return t.indexOf("-")==-1?[t]:t.split("-")},i.prototype.attachDOMEvent=function(t,e,n,c){this.domEventTracker.attachDOMEvent(t,e,n,c)},i.prototype.detachDOMEvent=function(t,e,n,c){this.domEventTracker.detachDOMEvent(t,e,n,c)},Object.defineProperty(i.prototype,"alertHost",{get:function(){return this.config.alertHost?this.config.alertHost:(this._alertHost||(this._alertHost=new tt),this._alertHost)},enumerable:!1,configurable:!0}),i.prototype.alert=function(t,e){this.alertHost.alert(t,e)},i.prototype.nzString=function(t,e){var n="";return arguments.length>1&&(n=e),typeof t=="undefined"||t==null||t==0||t==""?n:""+t},i.prototype.toNumber=function(t,e){var n=parseInt(t,10);return isNaN(n)?e:n},i.prototype.toFloat=function(t,e){var n=parseFloat(t);return isNaN(n)?e:n},i.prototype.rgba=function(t,e,n,c,l){var r="transparent";try{r="rgba("+e+","+n+","+c+","+l+")"}catch(s){r="rgb("+e+","+n+","+c+")"}return r},i.prototype.shutdown=function(){var t,e,n;(t=this.stylesheetManager)===null||t===void 0||t.unlinkAll(),(e=this.domEventTracker)===null||e===void 0||e.shutdown(),(n=this._alertHost)===null||n===void 0||n.shutdown()},i}();var bo=function(){function i(t,e,n){this.code=t,this.shift=e,this.handler=n}return i.prototype.matches=function(t,e){return this.code==t&&this.shift==e},i}(),El=function(){function i(){var t=this;this.hotkeys=[],this._Process=function(e){e||(e=window.event);var n=hc(e);if(n==null)return!1;for(var c=(e.shiftKey?16:0)|(e.ctrlKey?32:0)|(e.altKey?64:0),l=0;l<t.hotkeys.length;l++)if(t.hotkeys[l].matches(n,c))return t.hotkeys[l].handler(),e.returnValue=!1,e&&e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1;return!0}}return i.prototype.addHotKey=function(t,e,n){for(var c=0;c<this.hotkeys.length;c++)if(this.hotkeys[c].code==t&&this.hotkeys[c].shift==e){this.hotkeys[c].handler=n;return}this.hotkeys.push(new bo(t,e,n))},i.prototype.removeHotkey=function(t,e){for(var n=0;n<this.hotkeys.length;n++)if(this.hotkeys[n].matches(t,e)){this.hotkeys.splice(n,1);return}},i}();var Uo=function(){function i(t){this.e=t,this.c=t.style.backgroundColor}return i.prototype.reset=function(){this.e.style.backgroundColor=this.c},i}(),kl=function(){function i(t){var e=this;this._BeepObjects=[],this._BeepTimeout=0,this.reset=function(){e.keyboardInterface.resetContextCache();var n;for(e._BeepTimeout=0,n=0;n<e._BeepObjects.length;n++)e._BeepObjects[n].reset();e._BeepObjects=[]},this.keyboardInterface=t}return i.prototype.beep=function(t){if(t instanceof ce){var e=t.getElement();if(t instanceof re&&(e=t.docRoot),!!e&&!(!e.style||typeof e.style.backgroundColor=="undefined")){for(var n=0;n<this._BeepObjects.length;n++)if(this._BeepObjects[n].e==e)return;this._BeepObjects.push(new Uo(e)),e.style.backgroundColor="#000000",this._BeepTimeout==0&&(this._BeepTimeout=1,window.setTimeout(this.reset,50))}}},i}();var Yl=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e,n)||this;return c.GetLastActiveElement=c.getLastActiveElement,c.FocusLastActiveElement=c.focusLastActiveElement,c.HideHelp=c.hideHelp,c.ShowHelp=c.showHelp,c.ShowPinnedHelp=c.showPinnedHelp,c}return t.prototype.saveFocus=function(){this.engine.contextManager.focusAssistant._IgnoreNextSelChange=1},t.prototype.getLastActiveElement=function(){return this.engine.contextManager.lastActiveTarget},t.prototype.focusLastActiveElement=function(){this.engine.contextManager.restoreLastActiveTarget()},t.prototype.hideHelp=function(){var e=this.engine.osk;e.startHide(!0)},t.prototype.showHelp=function(e,n){var c=this.engine.osk;c instanceof $e?c.presentAtPosition(e,n):c.present()},t.prototype.showPinnedHelp=function(){var e=this.engine.osk;e instanceof $e&&(!e.activeKeyboard.keyboard.isCJK||!this.ruleBehavior)&&(e.userPositioned=!0),e.present()},t}(Rn),wl=Yl;(function(){Yl.__publishShorthandAPI()})();var xo=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this,l=new ml(n);return c=i.call(this,e,l,new Ll(l,function(){return c.legacyAPIEvents}),function(r){return{keyboardInterface:new wl(window,r),defaultOutputRules:new Jl(r.contextManager)}})||this,c._initialized=0,c.hotkeyManager=new El,c.helpURL="https://help.keyman.com/go",c.keyEventRefocus=function(){c.contextManager.restoreLastActiveTarget()},c._GetKeyboardDetail=function(r,s){var o={Name:r.KN,InternalName:r.KI,LanguageName:r.KL,LanguageCode:r.KLC,RegionName:r.KR,RegionCode:r.KRC,CountryName:r.KC,CountryCode:r.KCC,KeyboardID:r.KD,Font:r.KFont,OskFont:r.KOskFont,HasLoaded:!!s,IsRTL:s?s.isRTL:null};return o},c._util=new Tl(l),c.beepHandler=new kl(c.core.keyboardInterface),c.core.keyboardProcessor.beepHandler=function(){return c.beepHandler.beep(c.contextManager.activeTarget)},c.hardKeyboard=new Sl(l.hardDevice,c.core.keyboardProcessor,c.contextManager),c.contextManager.on("targetchange",function(r){var s=r==null?void 0:r.getElement();if(c.osk.activationModel.activationTrigger=s,c.config.hostDevice.touchable){if(!s||!r||!c.osk)return;var o=_(s),a=window.pageYOffset,B=o-a;o>=a&&(B-=window.innerHeight-c.osk._Box.offsetHeight-s.offsetHeight-2,B<0&&(B=0)),B!=0&&window.scrollTo(0,B+a)}}),c}return Object.defineProperty(t.prototype,"util",{get:function(){return this._util},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"views",{get:function(){return Bc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"initialized",{get:function(){return this._initialized},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ui",{get:function(){return this._ui},set:function(e){this._ui&&this._ui.shutdown(),this._ui=e,this.config.deferForInitialization.isFulfilled&&e.initialize()},enumerable:!1,configurable:!0}),t.prototype.init=function(e){return(0,d.__awaiter)(this,void 0,void 0,function(){var n,c,l,r,s=this;return(0,d.__generator)(this,function(o){switch(o.label){case 0:return n=new At,c=n.detect(),l=(0,d.__assign)((0,d.__assign)({},Xl),e),this.config.hostDevice=c,this.config.initialize(l),this._initialized=1,[4,Zt()];case 1:return o.sent(),this.config.deferForInitialization.isResolved?[2,Promise.resolve()]:[4,i.prototype.init.call(this,l)];case 2:return o.sent(),this.keyboardRequisitioner.cloudQueryEngine.once("unboundregister",function(){var a;!((a=s.contextManager.activeKeyboard)===null||a===void 0)&&a.keyboard||s.setActiveKeyboard("","")}),this.contextManager.initialize(),r=this.contextManager.getSavedKeyboardRaw(),c.touchable?this.osk=new oc(this):this.osk=new ac(this),Nl(this,this.osk,this.contextManager),this.pageIntegration=new Hl(window,this),String.kmwEnableSupplementaryPlane(!0),this.config.finalizeInit(),this.ui&&(this.ui.initialize(),this.legacyAPIEvents.callEvent("loaduserinterface",{})),this._initialized=2,[4,Promise.resolve()];case 3:return o.sent(),this.contextManager.restoreSavedKeyboard(r),[4,Promise.resolve()];case 4:return o.sent(),[2]}})})},Object.defineProperty(t.prototype,"register",{get:function(){return this.keyboardRequisitioner.cloudQueryEngine.registerFromCloud},enumerable:!1,configurable:!0}),t.prototype.getUIState=function(){return this.contextManager.focusAssistant.getUIState()},t.prototype.activatingUI=function(e){this.contextManager.focusAssistant.setMaintainingFocus(!!e)},t.prototype.setKeyboardForControl=function(e,n,c){if(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}if(!this.isAttached(e)){console.error("KeymanWeb is not attached to element "+e);return}var l=null;if(n&&(l=this.keyboardRequisitioner.cache.getStub(n,c),!l))throw new Error("No keyboard has been registered with id ".concat(n," and language code ").concat(c,"."));this.contextManager.setKeyboardForTarget(e._kmwAttachment.interface,n,c)},t.prototype.getKeyboardForControl=function(e){var n=fe(e);return this.contextManager.getKeyboardStubForTarget(n).id},t.prototype.getLanguageForControl=function(e){var n=fe(e);return this.contextManager.getKeyboardStubForTarget(n).langId},t.prototype.isAttached=function(e){return this.contextManager.page.isAttached(e)},t.prototype.addKeyboards=function(){for(var e=this,n=[],c=0;c<arguments.length;c++)n[c]=arguments[c];return this.config.deferForInitialization.then(function(){if(!n||!n[0]||n[0].length==0)return e.keyboardRequisitioner.fetchCloudCatalog().catch(function(r){return console.error(r[0].error),r});var l=[];return Array.isArray(n[0])?l=l.concat(n[0]):Array.isArray(n)&&(l=l.concat(n)),e.keyboardRequisitioner.addKeyboardArray(l)})},t.prototype.addKeyboardsForLanguage=function(e){var n=this;return this.config.deferForInitialization.then(function(){return typeof e=="string"?n.keyboardRequisitioner.addLanguageKeyboards(e.split(",").map(function(c){return c.trim()})):n.keyboardRequisitioner.addLanguageKeyboards(e)})},t.prototype.isCJK=function(e){var n;if(e){var c=e;c.KeyboardID?n=this.keyboardRequisitioner.cache.getKeyboard(e.KeyboardID):n=new q(e)}else n=this.core.activeKeyboard;return n&&n.isCJK},t.prototype.getKeyboard=function(e,n){var c=this.keyboardRequisitioner.cache.getStub(e,n),l=this.keyboardRequisitioner.cache.getKeyboardForStub(c);return c&&this._GetKeyboardDetail(c,l)},t.prototype.getKeyboards=function(){for(var e=[],n=this.keyboardRequisitioner.cache,c=n.getStubList(),l=0;l<c.length;l++){var r=c[l],s=n.getKeyboardForStub(r),o=this._GetKeyboardDetail(r,s);e.push(o)}return e},t.prototype.removeKeyboards=function(){for(var e,n=[],c=0;c<arguments.length;c++)n[c]=arguments[c];for(var l=0;l<n.length;l++)this.keyboardRequisitioner.cache.forgetKeyboard(n[l],!0),((e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata.id)==$(n[l])&&this.contextManager.activateKeyboard("","");return!0},t.prototype.getSavedKeyboard=function(){return this.contextManager.getSavedKeyboard()},t.prototype.focusLastActiveElement=function(){var e;(e=this.contextManager.lastActiveTarget)===null||e===void 0||e.focus()},t.prototype.getLastActiveElement=function(){var e;return(e=this.contextManager.lastActiveTarget)===null||e===void 0?void 0:e.getElement()},t.prototype.setActiveElement=function(e,n){if(typeof e=="string"){var c=e;if(e=document.getElementById(e),!e)throw new Error("Could not find the specified element (id: ".concat(c))}var l=fe(e);if(!l)throw new Error("KMW is not attached to the specified element (id: ".concat(e.id,")."));this.contextManager.setActiveTarget(l,n)},t.prototype.moveToElement=function(e){typeof e=="string"&&(e=document.getElementById(e)),e.focus()},t.prototype.addHotKey=function(e,n,c){this.hotkeyManager.addHotKey(e,n,c)},t.prototype.removeHotKey=function(e,n){this.hotkeyManager.removeHotkey(e,n)},t.prototype.attachToControl=function(e){this.contextManager.page.attachToControl(e)},t.prototype.detachFromControl=function(e){this.contextManager.page.detachFromControl(e)},t.prototype.disableControl=function(e){this.contextManager.page.disableControl(e)},t.prototype.enableControl=function(e){this.contextManager.page.enableControl(e)},t.prototype.BuildVisualKeyboard=function(e,n,c,l){var r=null;e!=null&&(r=this.keyboardRequisitioner.cache.getKeyboard(e)),r=r||this.core.activeKeyboard;var s=this.keyboardRequisitioner.cache.getStub(r),o=this.getOskHeight,a=(typeof o=="function"?o():null)||this.osk.computedHeight||200;return Ze.buildDocumentationKeyboard(r,s,this.config.paths.fonts,c,l,a)},t.prototype.shutdown=function(){var e,n;this.pageIntegration.shutdown(),this.contextManager.shutdown(),(e=this.osk)===null||e===void 0||e.shutdown(),this.core.languageProcessor.shutdown(),this.hardKeyboard.shutdown(),this.util.shutdown(),this.legacyAPIEvents.callEvent("unloaduserinterface",{}),(n=this.ui)===null||n===void 0||n.shutdown()},t}(Yn),Ol=xo;var Ml=document.getElementsByTagName("script"),Dl=Ml[Ml.length-1].src,po=Dl.substr(0,Dl.lastIndexOf("/")+1);window.keyman=new Ol(Hn.constructInstance(),po);})();
//# sourceMappingURL=keymanweb.es5.js.map
