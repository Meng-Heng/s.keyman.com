"use strict";(()=>{var cQ=Object.create;var Ne=Object.defineProperty,iQ=Object.defineProperties,lr=Object.getOwnPropertyDescriptor,lQ=Object.getOwnPropertyDescriptors,rQ=Object.getOwnPropertyNames,cr=Object.getOwnPropertySymbols,rr=Object.getPrototypeOf,Qr=Object.prototype.hasOwnProperty,QQ=Object.prototype.propertyIsEnumerable,aQ=Reflect.get;var ir=(Q,e,t)=>e in Q?Ne(Q,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):Q[e]=t,b=(Q,e)=>{for(var t in e||(e={}))Qr.call(e,t)&&ir(Q,t,e[t]);if(cr)for(var t of cr(e))QQ.call(e,t)&&ir(Q,t,e[t]);return Q},L=(Q,e)=>iQ(Q,lQ(e)),r=(Q,e)=>Ne(Q,"name",{value:e,configurable:!0});var FQ=(Q,e)=>()=>(e||Q((e={exports:{}}).exports,e),e.exports),Vn=(Q,e)=>{for(var t in e)Ne(Q,t,{get:e[t],enumerable:!0})},oQ=(Q,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of rQ(e))!Qr.call(Q,s)&&s!==t&&Ne(Q,s,{get:()=>e[s],enumerable:!(n=lr(e,s))||n.enumerable});return Q};var UQ=(Q,e,t)=>(t=Q!=null?cQ(rr(Q)):{},oQ(e||!Q||!Q.__esModule?Ne(t,"default",{value:Q,enumerable:!0}):t,Q));var xt=(Q,e,t,n)=>{for(var s=n>1?void 0:n?lr(e,t):e,B=Q.length-1,c;B>=0;B--)(c=Q[B])&&(s=(n?c(e,t,s):c(s))||s);return n&&s&&Ne(e,t,s),s};var vs=(Q,e,t)=>aQ(rr(Q),t,e);var E=(Q,e,t)=>new Promise((n,s)=>{var B=l=>{try{i(t.next(l))}catch(a){s(a)}},c=l=>{try{i(t.throw(l))}catch(a){s(a)}},i=l=>l.done?n(l.value):Promise.resolve(l.value).then(B,c);i((t=t.apply(Q,e)).next())});var Fr=FQ((Ia,qB)=>{"use strict";var dQ=Object.prototype.hasOwnProperty,_="~";function Zn(){}r(Zn,"Events");Object.create&&(Zn.prototype=Object.create(null),new Zn().__proto__||(_=!1));function gQ(Q,e,t){this.fn=Q,this.context=e,this.once=t||!1}r(gQ,"EE");function ar(Q,e,t,n,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var B=new gQ(t,n||Q,s),c=_?_+e:e;return Q._events[c]?Q._events[c].fn?Q._events[c]=[Q._events[c],B]:Q._events[c].push(B):(Q._events[c]=B,Q._eventsCount++),Q}r(ar,"addListener");function Ns(Q,e){--Q._eventsCount===0?Q._events=new Zn:delete Q._events[e]}r(Ns,"clearEvent");function M(){this._events=new Zn,this._eventsCount=0}r(M,"EventEmitter");M.prototype.eventNames=r(function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)dQ.call(t,n)&&e.push(_?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e},"eventNames");M.prototype.listeners=r(function(e){var t=_?_+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,B=n.length,c=new Array(B);s<B;s++)c[s]=n[s].fn;return c},"listeners");M.prototype.listenerCount=r(function(e){var t=_?_+e:e,n=this._events[t];return n?n.fn?1:n.length:0},"listenerCount");M.prototype.emit=r(function(e,t,n,s,B,c){var i=_?_+e:e;if(!this._events[i])return!1;var l=this._events[i],a=arguments.length,F,o;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),a){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,s),!0;case 5:return l.fn.call(l.context,t,n,s,B),!0;case 6:return l.fn.call(l.context,t,n,s,B,c),!0}for(o=1,F=new Array(a-1);o<a;o++)F[o-1]=arguments[o];l.fn.apply(l.context,F)}else{var d=l.length,U;for(o=0;o<d;o++)switch(l[o].once&&this.removeListener(e,l[o].fn,void 0,!0),a){case 1:l[o].fn.call(l[o].context);break;case 2:l[o].fn.call(l[o].context,t);break;case 3:l[o].fn.call(l[o].context,t,n);break;case 4:l[o].fn.call(l[o].context,t,n,s);break;default:if(!F)for(U=1,F=new Array(a-1);U<a;U++)F[U-1]=arguments[U];l[o].fn.apply(l[o].context,F)}}return!0},"emit");M.prototype.on=r(function(e,t,n){return ar(this,e,t,n,!1)},"on");M.prototype.once=r(function(e,t,n){return ar(this,e,t,n,!0)},"once");M.prototype.removeListener=r(function(e,t,n,s){var B=_?_+e:e;if(!this._events[B])return this;if(!t)return Ns(this,B),this;var c=this._events[B];if(c.fn)c.fn===t&&(!s||c.once)&&(!n||c.context===n)&&Ns(this,B);else{for(var i=0,l=[],a=c.length;i<a;i++)(c[i].fn!==t||s&&!c[i].once||n&&c[i].context!==n)&&l.push(c[i]);l.length?this._events[B]=l.length===1?l[0]:l:Ns(this,B)}return this},"removeListener");M.prototype.removeAllListeners=r(function(e){var t;return e?(t=_?_+e:e,this._events[t]&&Ns(this,t)):(this._events=new Zn,this._eventsCount=0),this},"removeAllListeners");M.prototype.off=M.prototype.removeListener;M.prototype.addListener=M.prototype.on;M.prefixed=_;M.EventEmitter=M;typeof qB!="undefined"&&(qB.exports=M)});var V=UQ(Fr(),1);var I={LCTRLFLAG:1,RCTRLFLAG:2,LALTFLAG:4,RALTFLAG:8,K_SHIFTFLAG:16,K_CTRLFLAG:32,K_ALTFLAG:64,K_METAFLAG:128,CAPITALFLAG:256,NOTCAPITALFLAG:512,NUMLOCKFLAG:1024,NOTNUMLOCKFLAG:2048,SCROLLFLAG:4096,NOTSCROLLFLAG:8192,ISVIRTUALKEY:16384,VIRTUALCHARKEY:32768};var Ts={K_BKSP:8,K_TAB:9,K_ENTER:13,K_SHIFT:16,K_CONTROL:17,K_ALT:18,K_PAUSE:19,K_CAPS:20,K_ESC:27,K_SPACE:32,K_PGUP:33,K_PGDN:34,K_END:35,K_HOME:36,K_LEFT:37,K_UP:38,K_RIGHT:39,K_DOWN:40,K_SEL:41,K_PRINT:42,K_EXEC:43,K_INS:45,K_DEL:46,K_HELP:47,K_0:48,K_1:49,K_2:50,K_3:51,K_4:52,K_5:53,K_6:54,K_7:55,K_8:56,K_9:57,K_A:65,K_B:66,K_C:67,K_D:68,K_E:69,K_F:70,K_G:71,K_H:72,K_I:73,K_J:74,K_K:75,K_L:76,K_M:77,K_N:78,K_O:79,K_P:80,K_Q:81,K_R:82,K_S:83,K_T:84,K_U:85,K_V:86,K_W:87,K_X:88,K_Y:89,K_Z:90,K_NP0:96,K_NP1:97,K_NP2:98,K_NP3:99,K_NP4:100,K_NP5:101,K_NP6:102,K_NP7:103,K_NP8:104,K_NP9:105,K_NPSTAR:106,K_NPPLUS:107,K_SEPARATOR:108,K_NPMINUS:109,K_NPDOT:110,K_NPSLASH:111,K_F1:112,K_F2:113,K_F3:114,K_F4:115,K_F5:116,K_F6:117,K_F7:118,K_F8:119,K_F9:120,K_F10:121,K_F11:122,K_F12:123,K_NUMLOCK:144,K_SCROLL:145,K_LSHIFT:160,K_RSHIFT:161,K_LCONTROL:162,K_RCONTROL:163,K_LALT:164,K_RALT:165,K_COLON:186,K_EQUAL:187,K_COMMA:188,K_HYPHEN:189,K_PERIOD:190,K_SLASH:191,K_BKQUOTE:192,K_LBRKT:219,K_BKSLASH:220,K_RBRKT:221,K_QUOTE:222,K_oE2:226,K_OE2:226,K_oC1:193,K_OC1:193,"K_?C1":193,"k_?C1":193,K_oDF:223,K_ODF:223,K_LOPT:50001,K_ROPT:50002,K_NUMERALS:50003,K_SYMBOLS:50004,K_CURRENCIES:50005,K_UPPER:50006,K_LOWER:50007,K_ALPHA:50008,K_SHIFTED:50009,K_ALTGR:50010,K_TABBACK:50011,K_TABFWD:50012},X=Ts,xa={2:X.K_1,3:X.K_2,4:X.K_3,5:X.K_4,6:X.K_5,7:X.K_6,8:X.K_7,9:X.K_8,10:X.K_9,11:X.K_0,12:X.K_HYPHEN,13:X.K_EQUAL,16:X.K_Q,17:X.K_W,18:X.K_E,19:X.K_R,20:X.K_T,21:X.K_Y,22:X.K_U,23:X.K_I,24:X.K_O,25:X.K_P,26:X.K_LBRKT,27:X.K_RBRKT,30:X.K_A,31:X.K_S,32:X.K_D,33:X.K_F,34:X.K_G,35:X.K_H,36:X.K_J,37:X.K_K,38:X.K_L,39:X.K_COLON,40:X.K_QUOTE,41:X.K_BKQUOTE,43:X.K_BKSLASH,44:X.K_Z,45:X.K_X,46:X.K_C,47:X.K_V,48:X.K_B,49:X.K_N,50:X.K_M,51:X.K_COMMA,52:X.K_PERIOD,53:X.K_SLASH,57:X.K_SPACE,86:X.K_oE2,115:X.K_oC1,125:X.K_oE2};var yQ={};Vn(yQ,{PRIVATE_USE_IDS:()=>uQ,TouchLayoutKeySp:()=>or});var uQ=["T_*_MT_SHIFT_TO_SHIFT","T_*_MT_SHIFT_TO_CAPS","T_*_MT_SHIFT_TO_DEFAULT"],or=(l=>(l[l.normal=0]="normal",l[l.special=1]="special",l[l.specialActive=2]="specialActive",l[l.customSpecial=3]="customSpecial",l[l.customSpecialActive=4]="customSpecialActive",l[l.deadkey=8]="deadkey",l[l.blank=9]="blank",l[l.spacer=10]="spacer",l))(or||{});var IQ=55296,bQ=56319,hQ=56320,mQ=57343;function fs(Q){return Q>=IQ&&Q<=bQ}r(fs,"Uni_IsSurrogate1");function ks(Q){return Q>=hQ&&Q<=mQ}r(ks,"Uni_IsSurrogate2");var Ur={modifierCodes:{LCTRL:I.LCTRLFLAG,RCTRL:I.RCTRLFLAG,LALT:I.LALTFLAG,RALT:I.RALTFLAG,SHIFT:I.K_SHIFTFLAG,CTRL:I.K_CTRLFLAG,ALT:I.K_ALTFLAG,META:I.K_METAFLAG,CAPS:I.CAPITALFLAG,NO_CAPS:I.NOTCAPITALFLAG,NUM_LOCK:I.NUMLOCKFLAG,NO_NUM_LOCK:I.NOTNUMLOCKFLAG,SCROLL_LOCK:I.SCROLLFLAG,NO_SCROLL_LOCK:I.NOTSCROLLFLAG,VIRTUAL_KEY:I.ISVIRTUALKEY,VIRTUAL_CHAR_KEY:I.VIRTUALCHARKEY},modifierBitmasks:{ALL:127,ALT_GR_SIM:5,CHIRAL:31,IS_CHIRAL:15,NON_CHIRAL:112,NON_LEGACY:111},stateBitmasks:{ALL:16128,CAPS:768,NUM_LOCK:3072,SCROLL_LOCK:12288},keyCodes:b({},Ts),codesUS:[["0123456789",";=,-./`","[\\]'"],[")!@#$%^&*(",":+<_>?~",'{|}"']],isFrameKey(Q){switch(Q){case"K_SHIFT":case"K_LOPT":case"K_ROPT":case"K_NUMLOCK":case"K_CAPS":return!0;default:if(Ur.keyCodes[Q]>=5e4)return!0}return!1},getModifierState(Q){var e=0;Q.indexOf("shift")>=0&&(e|=I.K_SHIFTFLAG);var t=!1;Q.indexOf("leftctrl")>=0&&(e|=I.LCTRLFLAG,t=!0),Q.indexOf("rightctrl")>=0&&(e|=I.RCTRLFLAG,t=!0),Q.indexOf("ctrl")>=0&&!t&&(e|=I.K_CTRLFLAG);var n=!1;return Q.indexOf("leftalt")>=0&&(e|=I.LALTFLAG,n=!0),Q.indexOf("rightalt")>=0&&(e|=I.RALTFLAG,n=!0),Q.indexOf("alt")>=0&&!n&&(e|=I.K_ALTFLAG),e},getStateFromLayer(Q){var e=0;return Q.indexOf("caps")>=0?e|=I.CAPITALFLAG:e|=I.NOTCAPITALFLAG,e}},m=Ur;var $B=class $B{codeForEvent(e){return m.keyCodes[e.kName]||e.Lcode}forAny(e,t,n){var s="";if((s=this.forSpecialEmulation(e))!=null)return s;if(!t&&(s=this.forNumpadKeys(e))!=null)return s;if((s=this.forUnicodeKeynames(e,n))!=null)return s;if((s=this.forBaseKeys(e,n))!=null)return s;switch(this.codeForEvent(e)){default:return null}}isCommand(e){switch(this.codeForEvent(e)){default:return!1}}applyCommand(e,t){}forSpecialEmulation(e){switch(this.codeForEvent(e)){case m.keyCodes.K_BKSP:return"\b";case m.keyCodes.K_ENTER:return`
`;default:return null}}forNumpadKeys(e){if(e.Lcode>=m.keyCodes.K_NP0&&e.Lcode<=m.keyCodes.K_NPSLASH){if(e.Lcode<106)var t=e.Lcode-48;else t=e.Lcode-64;return String._kmwFromCharCode(t)}else return null}forUnicodeKeynames(e,t){let n=e.kName;if(!n||n.substr(0,2)!="U_")return null;let s="",B=n.substr(2).split("_");for(let c of B){let i=parseInt(c,16);if(0<=i&&i<=31||128<=i&&i<=159||isNaN(i)){t&&(t.errorLog="Suppressing Unicode control code in "+n);continue}else s+=String.kmwFromCharCode(i)}return s||null}forBaseKeys(e,t){let n=e.Lcode,s=e.Lmodifiers;if(s==I.K_SHIFTFLAG)s=1;else if(s!=0)return t&&(t.warningLog="KMW only defines default key output for the 'default' and 'shift' layers!"),null;try{if(n==m.keyCodes.K_SPACE)return" ";if(n>=m.keyCodes.K_0&&n<=m.keyCodes.K_9)return m.codesUS[s][0][n-m.keyCodes.K_0];if(n>=m.keyCodes.K_A&&n<=m.keyCodes.K_Z)return String.fromCharCode(n+(s?0:32));if(n>=m.keyCodes.K_COLON&&n<=m.keyCodes.K_BKQUOTE)return m.codesUS[s][1][n-m.keyCodes.K_COLON];if(n>=m.keyCodes.K_LBRKT&&n<=m.keyCodes.K_QUOTE)return m.codesUS[s][2][n-m.keyCodes.K_LBRKT];if(n==m.keyCodes.K_oE2)return s?"|":"\\"}catch(B){t&&(t.errorLog="Error detected with default mapping for key:  code = "+n+", shift state = "+(s==1?"shift":"default"))}return null}};r($B,"DefaultRules");var Lt=$B;var xQ=new Lt,Ln=class Ln{constructor(e){this.isSynthetic=!0;for(let t in e)e[t]!==void 0&&(this[t]=e[t])}static constructNullKeyEvent(e){return new Ln({Lcode:0,kName:"",device:e,Lstates:void 0,Lmodifiers:void 0,vkCode:void 0,LisVirtualKey:void 0})}get isModifier(){switch(this.Lcode){case 16:case 17:case 18:case 20:case 144:case 145:return!0;default:return!1}}setMnemonicCode(e,t){if(this.Lcode!=m.keyCodes.K_SPACE){let s=new Ln(this);for(let B in this)s[B]=this[B];s.kName="K_xxxx",s.Lmodifiers=e?16:0;var n=xQ.forAny(s,!0);this.vkCode=this.Lcode,n?this.Lcode=n.charCodeAt(0):this.isModifier||delete this.Lcode}t&&(this.Lcode>=65&&this.Lcode<=90||this.Lcode>=97&&this.Lcode<=122)&&(this.Lmodifiers^=16,this.Lcode^=32)}};r(Ln,"KeyEvent");var tt=Ln;var nc=class nc{};r(nc,"KeyMap");var Tt=nc,sc=class sc{constructor(){this.FF=new Tt;this.Safari=new Tt;this.Opera=new Tt;this.FF.k61=187,this.FF.k59=186,this.FF.k173=189}};r(sc,"BrowserKeyMaps");var tc=sc,Bc=class Bc{constructor(){this.se=new Tt,this.se.k220=192,this.se.k187=189,this.se.k219=187,this.se.k221=219,this.se.k186=221,this.se.k191=220,this.se.k192=186,this.se.k189=191,this.uk=new Tt,this.uk.k223=192,this.uk.k192=222,this.uk.k222=226,this.uk.k220=220}};r(Bc,"LanguageKeyMaps");var ec=Bc,Et=class Et{constructor(){}static _usCodeInit(){var e=new Tt,t=new Tt;e.k192=96,e.k49=49,e.k50=50,e.k51=51,e.k52=52,e.k53=53,e.k54=54,e.k55=55,e.k56=56,e.k57=57,e.k48=48,e.k189=45,e.k187=61,e.k81=113,e.k87=119,e.k69=101,e.k82=114,e.k84=116,e.k89=121,e.k85=117,e.k73=105,e.k79=111,e.k80=112,e.k219=91,e.k221=93,e.k220=92,e.k65=97,e.k83=115,e.k68=100,e.k70=102,e.k71=103,e.k72=104,e.k74=106,e.k75=107,e.k76=108,e.k186=59,e.k222=39,e.k90=122,e.k88=120,e.k67=99,e.k86=118,e.k66=98,e.k78=110,e.k77=109,e.k188=44,e.k190=46,e.k191=47,t.k192=126,t.k49=33,t.k50=64,t.k51=35,t.k52=36,t.k53=37,t.k54=94,t.k55=38,t.k56=42,t.k57=40,t.k48=41,t.k189=95,t.k187=43,t.k81=81,t.k87=87,t.k69=69,t.k82=82,t.k84=84,t.k89=89,t.k85=85,t.k73=73,t.k79=79,t.k80=80,t.k219=123,t.k221=125,t.k220=124,t.k65=65,t.k83=83,t.k68=68,t.k70=70,t.k71=71,t.k72=72,t.k74=74,t.k75=75,t.k76=76,t.k186=58,t.k222=34,t.k90=90,t.k88=88,t.k67=67,t.k86=86,t.k66=66,t.k78=78,t.k77=77,t.k188=60,t.k190=62,t.k191=63,Et._usCharCodes=[e,t]}static _USKeyCodeToCharCode(e){return Et.usCharCodes[e.Lmodifiers&16?1:0]["k"+e.Lcode]}static get usCharCodes(){return Et._usCharCodes||Et._usCodeInit(),Et._usCharCodes}};r(Et,"KeyMapping"),Et.browserMap=new tc,Et.languageMap=new ec;var et=Et;function lt(Q){if(typeof Q!="object"||!Q)return Q;{let e=Array.isArray(Q)?[]:{},t=Object.keys(Q);for(let n of t)Q[n]!==void 0&&(e[n]=lt(Q[n]));return e}}r(lt,"deepCopy");var T=class T{constructor(e,t,n,s){switch(e.toLowerCase()){case T.Browser.Chrome:case T.Browser.Edge:case T.Browser.Firefox:case T.Browser.Native:case T.Browser.Opera:case T.Browser.Safari:this.browser=e.toLowerCase();break;default:this.browser=T.Browser.Other}switch(t.toLowerCase()){case T.FormFactor.Desktop:case T.FormFactor.Phone:case T.FormFactor.Tablet:this.formFactor=t.toLowerCase();break;default:throw"Invalid form factor specified for device: "+t}switch(n.toLowerCase()){case T.OperatingSystem.Windows.toLowerCase():case T.OperatingSystem.macOS.toLowerCase():case T.OperatingSystem.Linux.toLowerCase():case T.OperatingSystem.Android.toLowerCase():case T.OperatingSystem.iOS.toLowerCase():this.OS=n.toLowerCase();break;default:this.OS=T.OperatingSystem.Other}this.touchable=s}};r(T,"DeviceSpec");var ye=T;(n=>{let Q;(o=>(o.Chrome="chrome",o.Edge="edge",o.Firefox="firefox",o.Native="native",o.Opera="opera",o.Safari="safari",o.Other="other"))(Q=n.Browser||(n.Browser={}));let e;(F=>(F.Windows="windows",F.macOS="macosx",F.Linux="linux",F.Android="android",F.iOS="ios",F.Other="other"))(e=n.OperatingSystem||(n.OperatingSystem={}));let t;(i=>(i.Desktop="desktop",i.Phone="phone",i.Tablet="tablet"))(t=n.FormFactor||(n.FormFactor={}))})(ye||(ye={}));function cc(Q){return new ye(Q.browser,"desktop",Q.OS,!1)}r(cc,"physicalKeyDeviceAlias");var Z=ye;var rt=class rt{};r(rt,"KEYMAN_VERSION"),rt.VERSION="18.0.92",rt.VERSION_RELEASE="18.0",rt.VERSION_MAJOR="18",rt.VERSION_MINOR="0",rt.VERSION_PATCH="92",rt.TIER="alpha",rt.VERSION_TAG="-alpha",rt.VERSION_WITH_TAG="18.0.92-alpha",rt.VERSION_ENVIRONMENT="alpha",rt.VERSION_GIT_TAG="release@18.0.92-alpha";var En=rt,te=En;var dt=class dt{constructor(e){if(e==null){this.components=[].concat(dt.DEVELOPER_VERSION_FALLBACK.components);return}if(Array.isArray(e)){let s=e;if(s.length<2)throw new Error("Version string must have at least a major and minor component!");this.components=[].concat(s);return}let t=e.split("."),n=[];if(t.length<2)throw new Error("Version string must have at least a major and minor component!");for(let s=0;s<t.length;s++){let B=parseInt(t[s],10);if(isNaN(B))throw new Error("Version string components must be numerical!");n.push(B)}this.components=n}get major(){return this.components[0]}get minor(){return this.components[1]}toString(){return this.components.join(".")}toJSON(){return this.toString()}equals(e){return this.compareTo(e)==0}precedes(e){return this.compareTo(e)<0}compareTo(e){var t=this.components.length<e.components.length,n=this.components.length<e.components.length?this.components.length:e.components.length,s;for(s=0;s<n;s++){let c=this.components[s]-e.components[s];if(c!=0)return c}var B=t?e.components:this.components;do{if(B[s]>0)return t?-1:1;s++}while(s<B.length);return 0}};r(dt,"Version"),dt.CURRENT=new dt(te.VERSION_RELEASE),dt.DEVELOPER_VERSION_FALLBACK=new dt([9,0,0]),dt.NO_DEFAULT_KEYCAPS=new dt([12,0]),dt.MAC_POSSIBLE_IPAD_ALIAS=new dt([10,15]);var O=dt;function Te(){return typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof self!="undefined"?self:global}r(Te,"getGlobalObject");function Jn(){String.kmwFromCharCode=function(Q){var e=[],t;for(t=0;t<arguments.length;t++){var n=Number(arguments[t]);if(!isFinite(n)||n<0||n>1114111||Math.floor(n)!==n)throw new RangeError("Invalid code point "+n);n<65536?e.push(n):(n-=65536,e.push((n>>10)+55296),e.push(n%1024+56320))}return String.fromCharCode.apply(void 0,e)},String.prototype.kmwCharCodeAt=function(Q){var e=String(this),t=0;if(Q<0||Q>=e.length)return NaN;for(var n=0;n<Q;n++)if(t=e.kmwNextChar(t),t===null)return NaN;var s=e.charCodeAt(t);if(s>=55296&&s<=56319&&e.length>t+1){var B=e.charCodeAt(t+1);if(B>=56320&&B<=57343)return(s-55296<<10)+(B-56320)+65536}return s},String.prototype.kmwIndexOf=function(Q,e){var t=String(this),n=t.indexOf(Q,e);if(n<0)return n;for(var s=0,B=0;B!==null&&B<n;B=t.kmwNextChar(B))s++;return s},String.prototype.kmwLastIndexOf=function(Q,e){var t=String(this),n=t.lastIndexOf(Q,e);if(n<0)return n;for(var s=0,B=0;B!==null&&B<n;B=t.kmwNextChar(B))s++;return s},String.prototype.kmwLength=function(){var Q=String(this);if(Q.length==0)return 0;for(var e=0,t=0;t!==null;e++)t=Q.kmwNextChar(t);return e},String.prototype.kmwSlice=function(Q,e){var t=String(this),n=t.kmwCodePointToCodeUnit(Q),s=t.kmwCodePointToCodeUnit(e);return n===null||s===null?"":t.slice(n,s)},String.prototype.kmwSubstr=function(Q,e){var t=String(this);Q<0&&(Q=t.kmwLength()+Q),Q<0&&(Q=0);var n=t.kmwCodePointToCodeUnit(Q),s=n;if(n===null)return"";if(arguments.length<2)s=t.length;else for(var B=0;B<e;B++)s=t.kmwNextChar(s);return s===null?t.substring(n):t.substring(n,s)},String.prototype.kmwSubstring=function(Q,e){var t=String(this),n,s;if(typeof e=="undefined")n=t.kmwCodePointToCodeUnit(Q),s=t.length;else{if(Q>e){var B=Q;Q=e,e=B}n=t.kmwCodePointToCodeUnit(Q),s=t.kmwCodePointToCodeUnit(e)}return(isNaN(n)||n===null)&&(n=0),(isNaN(s)||s===null)&&(s=t.length),t.substring(n,s)},String.prototype.kmwNextChar=function(Q){var e=String(this);if(Q===null||Q<0||Q>=e.length-1)return null;var t=e.charCodeAt(Q);if(t>=55296&&t<=56319&&e.length>Q+1){var n=e.charCodeAt(Q+1);if(n>=56320&&n<=57343)return Q==e.length-2?null:Q+2}return Q+1},String.prototype.kmwPrevChar=function(Q){var e=String(this);if(Q==null||Q<=0||Q>e.length)return null;var t=e.charCodeAt(Q-1);if(t>=56320&&t<=57343&&Q>1){var n=e.charCodeAt(Q-2);if(n>=55296&&n<=56319)return Q-2}return Q-1},String.prototype.kmwCodePointToCodeUnit=function(Q){if(Q===null)return null;var e=String(this),t=0;if(Q<0){t=e.length;for(var n=0;n>Q;n--)t=e.kmwPrevChar(t);return t}if(Q==e.kmwLength())return e.length;for(var n=0;n<Q;n++)t=e.kmwNextChar(t);return t},String.prototype.kmwCodeUnitToCodePoint=function(Q){var e=String(this);return Q===null?null:Q==0?0:Q<0?e.substr(Q).kmwLength():e.substr(0,Q).kmwLength()},String.prototype.kmwCharAt=function(Q){var e=String(this);return Q>=0?e.kmwSubstr(Q,1):""},String.prototype.kmwBMPNextChar=function(Q){var e=String(this);return Q<0||Q>=e.length-1?null:Q+1},String.prototype.kmwBMPPrevChar=function(Q){var e=String(this);return Q<=0||Q>e.length?null:Q-1},String.prototype.kmwBMPCodePointToCodeUnit=function(Q){return Q},String.prototype.kmwBMPCodeUnitToCodePoint=function(Q){return Q},String.prototype.kmwBMPLength=function(){var Q=String(this);return Q.length},String.prototype.kmwBMPSubstr=function(Q,e){var t=String(this);return Q>-1?t.substr(Q,e):t.substr(t.length+Q,-Q)},String.kmwEnableSupplementaryPlane=function(Q){var e=String.prototype;String._kmwFromCharCode=Q?String.kmwFromCharCode:String.fromCharCode,e._kmwCharAt=Q?e.kmwCharAt:e.charAt,e._kmwCharCodeAt=Q?e.kmwCharCodeAt:e.charCodeAt,e._kmwIndexOf=Q?e.kmwIndexOf:e.indexOf,e._kmwLastIndexOf=Q?e.kmwLastIndexOf:e.lastIndexOf,e._kmwSlice=Q?e.kmwSlice:e.slice,e._kmwSubstring=Q?e.kmwSubstring:e.substring,e._kmwSubstr=Q?e.kmwSubstr:e.kmwBMPSubstr,e._kmwLength=Q?e.kmwLength:e.kmwBMPLength,e._kmwNextChar=Q?e.kmwNextChar:e.kmwBMPNextChar,e._kmwPrevChar=Q?e.kmwPrevChar:e.kmwBMPPrevChar,e._kmwCodePointToCodeUnit=Q?e.kmwCodePointToCodeUnit:e.kmwBMPCodePointToCodeUnit,e._kmwCodeUnitToCodePoint=Q?e.kmwCodeUnitToCodePoint:e.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}r(Jn,"extendString");Jn();var ic=class ic{constructor(e){this._isFulfilled=!1;this._isRejected=!1;this._promise=new Promise((t,n)=>{this._resolve=s=>{this._isFulfilled=!0,t(s)},this._reject=s=>{this._isRejected=!0,n(s)},e&&e(this._resolve,this._reject)})}get resolve(){return this._resolve}get reject(){return this._reject}get isFulfilled(){return this._isFulfilled}get isRejected(){return this._isRejected}get isResolved(){return this.isFulfilled||this.isRejected}then(e,t){return this._promise.then(e,t)}catch(e){return this._promise.catch(e)}finally(e){return this._promise.finally(e)}get corePromise(){return this._promise}};r(ic,"ManagedPromise");var J=ic;var lc=class lc extends J{constructor(t){let n=null;super(c=>{n=setTimeout(()=>{this.isResolved||c(!0)},t)});this.timerHandle=n;let s=this._resolve;this._resolve=c=>{clearTimeout(this.timerHandle),s(c)};let B=this._reject;this._reject=c=>{clearTimeout(this.timerHandle),B(c)}}};r(lc,"TimeoutPromise");var ft=lc,Qt=r(Q=>new ft(Q).corePromise,"timedPromise");var v=yQ.TouchLayoutKeySp;var CQ=200,W=class W{static buildDefaultLayout(e,t,n){var Sn;let s=n;typeof W.dfltLayout[s]!="object"&&(s="desktop");let B=m.modifierBitmasks.NON_CHIRAL,c=O.CURRENT;t&&(B=t.modifierBitmask,c=t.compilerVersion),e||(e=this.DEFAULT_RAW_SPEC);var i=lt(W.dfltLayout[s]),l,a=i.layer,F=e.KLS,o=e.K102,d,U,u,g,y,x,G=(B&m.modifierBitmasks.IS_CHIRAL)!=0;if(e.F){let Nt=/^(?:(?:italic|bold) )* *[0-9.eE-]+(?:[a-z]+) "(.+)"$/.exec(e.F);Nt&&(i.font=Nt[1])}var C=!(typeof F=="undefined"||!F);C||(F=e.KLS=W.processLegacyDefinitions(e.BK));var h=Object.getOwnPropertyNames(F),S=[];if(h.splice(h.indexOf("default"),1),h=["default"].concat(h),t&&t.emulatesAltGr&&(h.indexOf("leftctrl-leftalt")==-1&&h.indexOf("rightalt")!=-1&&(h.push("leftctrl-leftalt"),F["leftctrl-leftalt"]=F.rightalt),h.indexOf("leftctrl-leftalt-shift")==-1&&h.indexOf("rightalt-shift")!=-1&&(h.push("leftctrl-leftalt-shift"),F["leftctrl-leftalt-shift"]=F["rightalt-shift"])),i.displayUnderlying=t?!!t.scriptObject.KDU:!1,n=="desktop")for(S=W.generateLayerIds(G),l=0;l<S.length;l++)h.indexOf(S[l])!=-1&&S.splice(l--,1);var H=h.concat(S);if(C&&n!="desktop"){var R=null;g=a[0].row;for(var Y=0;Y<g.length;Y++){x=g[Y].key;for(var _t=0;_t<x.length;_t++)y=x[_t],y.id=="K_SHIFT"&&(R=y)}if(R){R.sk=[];for(let Nt in F){if(Nt=="default"||Nt=="shift")continue;var As=W.modifierSpecials[Nt];let $t={id:`K_${As}`,text:As,sp:1,nextlayer:Nt};R.sk.push($t)}}else console.warn("Error in default layout - cannot find default Shift key!")}for(l=0;l<H.length;l++)l>0&&(a[l]=lt(a[0])),a[l].id=H[l],a[l].nextlayer=H[l],W.formatDefaultLayer(a[l],G,n,!!o);for(l=0;l<a.length;l++){var mt=a[l],vt,R=null,Gn=null,ue=null,pn=null,qt=F[mt.id],ve=mt.id=="shift"?1:0,Xn=mt.id=="default"||ve?1:0;for(g=mt.row,d=0;d<g.length;d++)for(x=g[d].key,U=0;U<x.length;U++){switch(y=x[U],vt=W.dfltCodes.indexOf(y.id),(qt||Xn)&&(qt&&vt>=0&&vt<qt.length&&(y.text=qt[vt]),Xn&&c.precedes(O.NO_DEFAULT_KEYCAPS)&&y.id!="K_SPACE"&&vt+65*ve<W.dfltText.length&&y.text!==null&&(y.text=y.text||W.dfltText[vt+65*ve])),y.text!==null&&(y.text=y.text||""),y.id){case"K_SHIFT":R=y;break;case"K_CAPS":Gn=y;break;case"K_NUMLOCK":ue=y;break;case"K_SCROLL":pn=y;break}if(y.sk!=null){for(u=0;u<y.sk.length;u++)h.indexOf(y.sk[u].nextlayer)==-1&&y.sk.splice(u--,1);y.sk.length==0&&(y.sk=null)}}mt.shiftKey=R,mt.capsKey=Gn,mt.numKey=ue,mt.scrollKey=pn;let $t=a[l].id;n!="desktop"&&l>0&&R!=null&&(R.sp=v.specialActive,R.sk=null,R.text=(Sn=W.modifierSpecials[$t])!=null?Sn:"*Shift*")}return i}static getLayerId(e){var t="";return e==0?"default":(e&I.LCTRLFLAG&&(t=(t.length>0?t+"-":"")+"leftctrl"),e&I.RCTRLFLAG&&(t=(t.length>0?t+"-":"")+"rightctrl"),e&I.LALTFLAG&&(t=(t.length>0?t+"-":"")+"leftalt"),e&I.RALTFLAG&&(t=(t.length>0?t+"-":"")+"rightalt"),e&I.K_SHIFTFLAG&&(t=(t.length>0?t+"-":"")+"shift"),e&I.K_CTRLFLAG&&(t=(t.length>0?t+"-":"")+"ctrl"),e&I.K_ALTFLAG&&(t=(t.length>0?t+"-":"")+"alt"),t)}static generateLayerIds(e){var t,n;e?(t=32,n=1):(t=8,n=16);for(var s=[],B=0;B<t;B++)s.push(W.getLayerId(B*n));return s}static formatDefaultLayer(e,t,n,s){for(var B=e.id,c=0;c<e.row.length;c++)for(var i=e.row[c],l=i.key,a=0;a<l.length;a++){var F=l[a];switch(F.id){case"K_SHIFT":case"K_LSHIFT":case"K_RSHIFT":B.indexOf("shift")!=-1&&(F.sp=v.specialActive),n!="desktop"&&(B!="default"?F.nextlayer="default":F.nextlayer="shift");break;case"K_LCTRL":case"K_LCONTROL":if(t){B.indexOf("leftctrl")!=-1&&(F.sp=v.specialActive);break}case"K_RCTRL":case"K_RCONTROL":if(t){B.indexOf("rightctrl")!=-1&&(F.sp=v.specialActive);break}case"K_CONTROL":B.indexOf("ctrl")!=-1&&(!t||B.indexOf("leftctrl")!=-1&&B.indexOf("rightctrl")!=-1)&&(F.sp=v.specialActive);break;case"K_LALT":if(t){B.indexOf("leftalt")!=-1&&(F.sp=v.specialActive);break}case"K_RALT":if(t){B.indexOf("rightalt")!=-1&&(F.sp=v.specialActive);break}case"K_ALT":B.indexOf("alt")!=-1&&(!t||B.indexOf("leftalt")!=-1&&B.indexOf("rightalt")!=-1)&&(F.sp=v.specialActive);break;case"K_oE2":(typeof s=="undefined"||!s)&&(n=="desktop"?(l.splice(a--,1),l[0].width=CQ):l[a].sp=v.spacer);break}}}static processLegacyDefinitions(e){for(var t=W.generateLayerIds(!1),n={},s=0;s<t.length;s++){for(var B=t[s],c=[],i=!1,l=0;l<65;l++){var a=l+65*s;c.push(e[a]),a<e.length&&e[a]!=""&&l!=W.dfltCodes.indexOf("K_SPACE")&&(i=!0)}i&&(n[B]=c)}return(typeof n.default=="undefined"||!n.default)&&(n.default=[""]),(typeof n.shift=="undefined"||!n.shift)&&(n.shift=[""]),n}};r(W,"Layouts"),W.dfltCodes=["K_BKQUOTE","K_1","K_2","K_3","K_4","K_5","K_6","K_7","K_8","K_9","K_0","K_HYPHEN","K_EQUAL","K_*","K_*","K_*","K_Q","K_W","K_E","K_R","K_T","K_Y","K_U","K_I","K_O","K_P","K_LBRKT","K_RBRKT","K_BKSLASH","K_*","K_*","K_*","K_A","K_S","K_D","K_F","K_G","K_H","K_J","K_K","K_L","K_COLON","K_QUOTE","K_*","K_*","K_*","K_*","K_*","K_oE2","K_Z","K_X","K_C","K_V","K_B","K_N","K_M","K_COMMA","K_PERIOD","K_SLASH","K_*","K_*","K_*","K_*","K_*","K_SPACE"],W.dfltText="`1234567890-=\xA7~~qwertyuiop[]\\~~~asdfghjkl;'~~~~~?zxcvbnm,./~~~~~ ~!@#$%^&*()_+\xA7~~QWERTYUIOP{}\\~~~ASDFGHJKL:\"~~~~~?ZXCVBNM<>?~~~~~ ",W.DEFAULT_RAW_SPEC={F:"Tahoma",BK:W.dfltText.split("")},W.modifierSpecials={leftalt:"*LAlt*",rightalt:"*RAlt*",alt:"*Alt*",leftctrl:"*LCtrl*",rightctrl:"*RCtrl*",ctrl:"*Ctrl*","ctrl-alt":"*AltGr*","leftctrl-leftalt":"*LAltCtrl*","rightctrl-rightalt":"*RAltCtrl*","leftctrl-leftalt-shift":"*LAltCtrlShift*","rightctrl-rightalt-shift":"*RAltCtrlShift*",shift:"*Shift*","shift-alt":"*AltShift*","shift-ctrl":"*CtrlShift*","shift-ctrl-alt":"*AltCtrlShift*","leftalt-shift":"*LAltShift*","rightalt-shift":"*RAltShift*","leftctrl-shift":"*LCtrlShift*","rightctrl-shift":"*RCtrlShift*"},W.dfltShiftToCaps={id:"T_*_MT_SHIFT_TO_CAPS",text:"*ShiftLock*",sp:1,nextlayer:"caps"},W.dfltShiftToDefault={id:"T_*_MT_SHIFT_TO_DEFAULT",text:"*Shift*",sp:1,nextlayer:"default"},W.dfltShiftToShift={id:"T_*_MT_SHIFT_TO_SHIFT",text:"*Shift*",sp:1,nextlayer:"shift"},W.dfltLayout={desktop:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:1,key:[{id:"K_BKQUOTE"},{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{id:"K_BKSP",text:"*BkSp*",sp:1,width:130}]},{id:2,key:[{id:"K_TAB",text:"*Tab*",sp:1,width:130},{id:"K_Q"},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{id:"K_BKSLASH"}]},{id:3,key:[{id:"K_CAPS",text:"*Caps*",sp:1,width:165},{id:"K_A"},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_ENTER",text:"*Enter*",sp:1,width:165}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:130},{id:"K_oE2"},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_RSHIFT",text:"*Shift*",sp:1,width:130}]},{id:5,key:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:170},{id:"K_LALT",text:"*Alt*",sp:1,width:160},{id:"K_SPACE",text:"",width:770},{id:"K_RALT",text:"*Alt*",sp:1,width:160},{id:"K_RCONTROL",text:"*Ctrl*",sp:1,width:170}]}]}]},tablet:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",sp:1,width:150},{id:"K_SPACE",text:"",width:570},{id:"K_BKSP",text:"*BkSp*",sp:1,width:150},{id:"K_ENTER",text:"*Enter*",sp:1,width:200}]}]}]},phone:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",width:150,sp:1},{id:"K_SPACE",width:570,text:""},{id:"K_BKSP",text:"*BkSp*",width:150,sp:1},{id:"K_ENTER",text:"*Enter*",width:200,sp:1}]}]}]}};var f=W;function Jt(Q,e,t){t.enumerable=!0}r(Jt,"Enumerable");var dr={id:"string",text:"string",layer:"string",nextlayer:"string",font:"string",fontsize:"string",sp:"number",pad:"number",width:"number",sk:"subkeys",flick:"flicks",multitap:"subkeys",hint:"string",default:"boolean"},gr=["n","ne","e","se","s","sw","w","nw"];function rc(Q,e){let t=Object.getPrototypeOf(e);for(let n in e)if(!Q.hasOwnProperty(n)){let s=Object.getOwnPropertyDescriptor(t,n);s?Object.defineProperty(Q,n,s):Q[n]=e[n]}return Q}r(rc,"assignDefaultsWithPropDefs");var q=class q{constructor(e,t,n){this.isMnemonic=!1;Object.assign(this,e),!this.text&&typeof this.id=="string"&&(this.text=nt.unicodeIDToText(this.id)),this.displayLayer=n,this.layer=this.layer||n,this._baseKeyEvent=()=>this.constructBaseKeyEvent(t,n)}get baseKeyID(){if(typeof this.id!="undefined")return this.id}get isPadding(){return this.sp==v.spacer}get coreID(){if(typeof this.id=="undefined")return;let e=this.id||"";return this.displayLayer!=this.layer&&(e=e+"+"+this.layer),e}get elementID(){if(typeof this.id!="undefined")return this.displayLayer+"-"+this.coreID}get baseKeyEvent(){let e=this._baseKeyEvent;return typeof e=="function"&&(e=e()),new tt(e)}static unicodeIDToText(e,t){if(!e||e.substring(0,2)!="U_")return null;let n="",s=e.substring(2).split("_");for(let B of s){let c=parseInt(B,16);if(0<=c&&c<=31||128<=c&&c<=159||isNaN(c)){t&&t(B);continue}else n+=String.kmwFromCharCode(c)}return n||null}static sanitize(e){typeof e.width=="string"&&(e.width=parseInt(e.width,10)),e.width||(e.width=nt.DEFAULT_KEY_WIDTH),typeof e.pad=="string"&&(e.pad=parseInt(e.pad,10)),e.pad||(e.pad=nt.DEFAULT_PAD),typeof e.sp=="string"&&(e.sp=Number.parseInt(e.sp,10)),e.sp||(e.sp=nt.DEFAULT_KEY.sp);for(let t of Object.keys(dr)){let n=dr[t];switch(n){case"subkeys":let s=e[t];if(s===void 0)break;if(!Array.isArray(s))delete e[t];else for(let i=0;i<s.length;i++){let l=s[i];typeof l!="object"?s.splice(i--,1):nt.sanitize(l)}break;case"flicks":let B=e[t];if(B===void 0)break;if(typeof B!="object")delete e[t];else for(let i of gr){let l=B[i];if(l===void 0)break;typeof l!="object"?delete B[i]:nt.sanitize(l)}break;default:let c=e[t];c!==void 0&&typeof c!=n&&delete e[t]}}e.text||(e.text=nt.DEFAULT_KEY.text)}constructBaseKeyEvent(e,t){let n=this.layer||t||"",s=this.id?this.id.toUpperCase():null,B={Lmodifiers:m.getModifierState(n),Lstates:m.getStateFromLayer(n),Lcode:s?m.keyCodes[s]:0,LisVirtualKey:!0,vkCode:0,kName:s,kLayer:n,kbdLayer:t,kNextLayer:this.nextlayer,device:null,isSynthetic:!0},c=new tt(B);if(e.keyboard){let i=e.keyboard;i.isMnemonic&&!(e.isDefault&&e.formFactor!="desktop")?c.Lcode!=m.keyCodes.K_SPACE&&(c.vkCode=c.Lcode,this.isMnemonic=!0):c.vkCode=c.Lcode,i.definesPositionalOrMnemonic||(c.Lcode=et._USKeyCodeToCharCode(c),c.LisVirtualKey=!1)}return c}};r(q,"ActiveKeyBase"),q.DEFAULT_PAD=15,q.DEFAULT_RIGHT_MARGIN=15,q.DEFAULT_KEY_WIDTH=100,q.DEFAULT_KEY={text:"",width:q.DEFAULT_KEY_WIDTH,sp:v.normal,pad:q.DEFAULT_PAD},xt([Jt],q.prototype,"baseKeyID",1),xt([Jt],q.prototype,"isPadding",1),xt([Jt],q.prototype,"coreID",1),xt([Jt],q.prototype,"elementID",1),xt([Jt],q.prototype,"baseKeyEvent",1),xt([Jt],q.prototype,"constructBaseKeyEvent",1);var Rn=q,Os=class Os extends Rn{getSubkey(e){if(this.sk){for(let t of this.sk)if(t.coreID==e)return t}return null}constructor(e,t,n){super(e,t,n);let s=this.sk;if(s)for(let i=0;i<s.length;i++)s[i]=new Ie(s[i],t,n);let B=this.multitap;if(B)for(let i=0;i<B.length;i++)B[i]=new Ie(B[i],t,n);let c=this.flick;if(c)for(let i in c)c[i]=new Ie(c[i],t,n);Os.determineHint(this,t.defaultHint)}static determineHint(e,t){var n;if(e.hint){e.hintSrc=e;return}if(t!=null&&t.includes("flick-")){if(e.flick){let s=t.substring(6);(n=e.flick[s])!=null&&n.text&&(e.hintSrc=e.flick[s])}return}switch(t){case"none":return;case"multitap":e.multitap&&(e.hintSrc=e.multitap[0]);return;case"flick":if(e.flick){for(let s of gr)if(e.flick[s]){e.hintSrc=e.flick[s];return}}return;case"longpress":e.sk&&(e.hintSrc=e.sk[0]);return;case"dot":default:e.sk&&(e.hint="\u2022",e.hintSrc=e);return}}};r(Os,"ActiveKey");var nt=Os,Qc=class Qc extends Rn{};r(Qc,"ActiveSubKey");var Ie=Qc,ee=class ee{constructor(){}static sanitize(e){for(let t of e.key)t==null?e.key.length=e.key.length-1:nt.sanitize(t);typeof e.id=="string"&&(e.id=Number.parseInt(e.id,10))}static polyfill(e,t,n,s,B){let c=e.key,i=Rn.DEFAULT_KEY;for(let d=0;d<c.length;d++){let U=c[d],u=Object.keys(i);for(let y of u){let x=y;typeof U[x]!="string"&&typeof U[x]!="number"&&(U[x]=i[x])}switch(U.sp){case v.special:!ee.SPECIAL_LABEL.test(U.text)&&U.text!=""&&(U.sp=v.customSpecial);break;case v.specialActive:!ee.SPECIAL_LABEL.test(U.text)&&U.text!=""&&(U.sp=v.customSpecialActive);break}let g=new nt(U,t,n);c[d]=g}let l=r(function(d,U,u,g){d.proportionalPad=U,d.proportionalWidth=u,d.proportionalX=g+U+u/2},"setProportions"),a=0;for(let d=0;d<c.length-1;d++){let U=c[d];l(U,U.pad/s,U.width/s,a),a+=U.proportionalPad,a+=U.proportionalWidth}let F=nt.DEFAULT_RIGHT_MARGIN/s;if(c.length>0){let d=c[c.length-1];if(c.length==1&&d.pad<0){let U=d.width/s,u=1-(a+U+F);l(d,u,U,a)}else{let U=d.pad/s,u=1-(a+U+F);l(d,U,u,a)}}rc(e,new ee);let o=e;o.proportionalY=B}populateKeyMap(e){this.key.forEach(function(t){t.coreID&&(e[t.coreID]=t)})}};r(ee,"ActiveRow"),ee.SPECIAL_LABEL=/\*\w+\*/,xt([Jt],ee.prototype,"populateKeyMap",1);var Ys=ee,fe=class fe{constructor(){}static sanitize(e){for(let t of e.row)Ys.sanitize(t)}static polyfill(e,t){e.aligned=!1;let n=e.row,s=0;for(let i of n){let l=0,a=i.key;for(let F of a)l+=F.width+F.pad;l>s&&(s=l)}t.formFactor=="desktop"?s+=5:s+=nt.DEFAULT_RIGHT_MARGIN;let B=e.row.length;for(let i=0;i<B;i++){let l=(i+.5)/B;Ys.polyfill(e.row[i],t,e.id,s,l)}rc(e,new fe);let c=e;c.totalWidth=s,c.defaultKeyProportionalWidth=nt.DEFAULT_KEY.width/s,c.rowProportionalHeight=1/B,c.keyMap=c.constructKeyMap()}constructKeyMap(){let e={};return this.row.forEach(function(t){t.populateKeyMap(e)}),e}getKey(e){e.indexOf(this.id+"-")==0&&(e=e.replace(this.id+"-",""));let t=e.split("::");return t.length>1?this.keyMap[t[0]].getSubkey(t[1]):this.keyMap[e]}};r(fe,"ActiveLayer"),xt([Jt],fe.prototype,"constructKeyMap",1),xt([Jt],fe.prototype,"getKey",1);var Ms=fe,ke=class ke{constructor(){this.hasFlicks=!1;this.hasLongpresses=!1;this.hasMultitaps=!1}getLayer(e){if(!this.layerMap[e]){let t=this.layer.find(n=>n.id==e);if(!t)return null;Ms.sanitize(t),Ms.polyfill(t,this),this.layerMap[e]=t}return this.layerMap[e]}static correctLayerEmptyRowBug(e){for(let t=0;t<e.length;t++){let s=e[t].row,B;for(B=s.length-1;B>=0;B--)(!Array.isArray(s[B].key)||s[B].key.length==0)&&s.splice(B,1)}}static sanitize(e){ke.correctLayerEmptyRowBug(e.layer)}static polyfill(e,t,n){if(e==null)throw new Error("Cannot build an ActiveLayout for a null specification.");let s={hasFlicks:!1,hasLongpresses:!1,hasMultitaps:!1};this.sanitize(e);for(let i of e.layer)for(let l of i.row)for(let a of l.key)s.hasLongpresses||(s.hasLongpresses=!!a.sk),s.hasFlicks||(s.hasFlicks=!!a.flick),s.hasMultitaps||(s.hasMultitaps=!!a.multitap);let B={};rc(e,new ke);let c=e;if(c.keyboard=t,c.formFactor=n,c.layerMap=B,n!="desktop"&&e.layer.find(i=>i.id=="caps")){let i=c.getLayer("default"),l=c.getLayer("shift"),a=i.getKey("K_SHIFT"),F=l==null?void 0:l.getKey("K_SHIFT");a&&F&&!a.multitap&&!F.multitap&&!a.sk&&!F.sk&&(s.hasMultitaps=!0,a.multitap=[b({},f.dfltShiftToCaps),b({},f.dfltShiftToDefault)],F.multitap=[b({},f.dfltShiftToCaps),b({},f.dfltShiftToShift)],a.multitap.forEach((o,d)=>a.multitap[d]=new Ie(o,c,"default")),F.multitap.forEach((o,d)=>F.multitap[d]=new Ie(o,c,"shift")))}return c.hasFlicks=s.hasFlicks,c.hasLongpresses=s.hasLongpresses,c.hasMultitaps=s.hasMultitaps,c}};r(ke,"ActiveLayout"),xt([Jt],ke.prototype,"getLayer",1);var Ye=ke;var Fc=class Fc{constructor(){this.stores={}}};r(Fc,"CacheTag");var ac=Fc,zs=(n=>(n[n.NOT_LOADED=void 0]="NOT_LOADED",n[n.POLYFILLED=1]="POLYFILLED",n[n.CALIBRATED=2]="CALIBRATED",n))(zs||{}),Me=class Me{constructor(e){e?this.scriptObject=e:this.scriptObject=Me.DEFAULT_SCRIPT_OBJECT,this.layoutStates={}}process(e,t){return this.scriptObject.gs(e,t)}processNewContextEvent(e,t){return this.scriptObject.gn?this.scriptObject.gn(e,t):!1}processPostKeystroke(e,t){return this.scriptObject.gpk?this.scriptObject.gpk(e,t):!1}get isHollow(){return this.scriptObject==Me.DEFAULT_SCRIPT_OBJECT}get id(){return this.scriptObject.KI}get name(){return this.scriptObject.KN}get variableStores(){let e=this.scriptObject.KVS,t={};if(Array.isArray(e))for(let n of e)t[n]=this.scriptObject[n];return t}set variableStores(e){let t=this.scriptObject.KVS;if(Array.isArray(t))for(let n of t)typeof e[n]=="string"&&(this.scriptObject[n]=e[n])}get _legacyLayoutSpec(){return this.scriptObject.KV}get _layouts(){return this.scriptObject.KVKL}set _layouts(e){this.scriptObject.KVKL=e}get compilerVersion(){return new O(this.scriptObject.KVER)}get isMnemonic(){return!!this.scriptObject.KM}get definesPositionalOrMnemonic(){return typeof this.scriptObject.KM!="undefined"}get helpText(){return this.scriptObject.KH}get hasScript(){return!!this.scriptObject.KHF}embedScript(e){this.scriptObject.KHF(e)}get oskStyling(){return this.scriptObject.KCSS}get isCJK(){var e;return typeof this.scriptObject.KLC!="undefined"?e=this.scriptObject.KLC:typeof this.scriptObject.LanguageCode!="undefined"&&(e=this.scriptObject.LanguageCode),e=="cmn"||e=="jpn"||e=="kor"}get isRTL(){return!!this.scriptObject.KRTL}get modifierBitmask(){return this.scriptObject.KMBM||m.modifierBitmasks.NON_CHIRAL}get isChiral(){return!!(this.modifierBitmask&m.modifierBitmasks.IS_CHIRAL)}get desktopFont(){return this.scriptObject.KV?this.scriptObject.KV.F:null}get cacheTag(){let e=this.scriptObject._kmw;return e||(e=new ac,this.scriptObject._kmw=e),e}get explodedStores(){return this.cacheTag.stores}get emulatesAltGr(){if(!this.isChiral||this._legacyLayoutSpec==null)return!1;let e=this._legacyLayoutSpec.KLS;if(!e)return!1;var t=I.LCTRLFLAG|I.LALTFLAG,n=e[f.getLayerId(t)],s=e[f.getLayerId(I.K_SHIFTFLAG|t)];if(n!=null&&n!=e[f.getLayerId(I.RALTFLAG)]||s!=null&&s!=e[f.getLayerId(I.RALTFLAG|I.K_SHIFTFLAG)])return!1;var B=this.modifierBitmask;return(B&t)!=t||n==null&&s==null,!0}get usesSupplementaryPlaneChars(){let e=this.scriptObject;return e&&(e.KS&&e.KS==1||e.KN=="Hieroglyphic")}get version(){return this.scriptObject.KBVER||""}usesDesktopLayoutOnDevice(e){return this.scriptObject.KVKL?e.formFactor==Z.FormFactor.Desktop:!0}notify(e,t,n){typeof this.scriptObject.KNS=="function"&&this.scriptObject.KNS(e,t,n)}findOrConstructLayout(e){if(this._layouts){if(this._layouts[e]!==void 0)return this._layouts[e];if(e==Z.FormFactor.Phone&&this._layouts[Z.FormFactor.Tablet])return this._layouts[Z.FormFactor.Phone]=this._layouts[Z.FormFactor.Tablet];if(e==Z.FormFactor.Tablet&&this._layouts[Z.FormFactor.Phone])return this._layouts[Z.FormFactor.Tablet]=this._layouts[Z.FormFactor.Phone]}let t=null;if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.KLS)t=this._legacyLayoutSpec;else if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.BK!=null){for(var n=this._legacyLayoutSpec.BK,s=0;s<n.length;s++)if(n[s].length>0){t=this._legacyLayoutSpec;break}}if(!t&&(this.helpText==""||e!=Z.FormFactor.Desktop)&&(t={F:"Tahoma",BK:f.dfltText}),this._layouts||(this._layouts={}),t){let B=this._layouts[e]=f.buildDefaultLayout(t,this,e);return B.isDefault=!0,B}else return this._layouts[e]=null,null}layout(e){let t=this.findOrConstructLayout(e);if(t)if(this.layoutStates[e]==zs.NOT_LOADED){let n=Ye.polyfill(t,this,e);return this.layoutStates[e]=1,n}else return t;else return null}refreshLayouts(){let e=[Z.FormFactor.Desktop,Z.FormFactor.Phone,Z.FormFactor.Tablet],t=this;e.forEach(function(n){t.layoutStates[n]=zs.NOT_LOADED})}markLayoutCalibrated(e){this.layoutStates[e]!=zs.NOT_LOADED&&(this.layoutStates[e]=2)}getLayoutState(e){return this.layoutStates[e]}constructNullKeyEvent(e,t){t=t||{K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};let n=tt.constructNullKeyEvent(e);return this.setSyntheticEventDefaults(n,t),n}constructKeyEvent(e,t,n){let s=e.baseKeyEvent;s.device=t,this.isMnemonic&&s.setMnemonicCode(e.layer.indexOf("shift")!=-1,n.K_CAPS),this.setSyntheticEventDefaults(s,n);let c={K_CAPS:m.stateBitmasks.CAPS,K_NUMLOCK:m.stateBitmasks.NUM_LOCK,K_SCROLL:m.stateBitmasks.SCROLL_LOCK}[s.kName];return c&&(s.Lstates^=c,s.LmodifierChange=!0),s}setSyntheticEventDefaults(e,t){e.device.touchable||(e.Lstates=0,e.Lstates|=t.K_CAPS?I.CAPITALFLAG:I.NOTCAPITALFLAG,e.Lstates|=t.K_NUMLOCK?I.NUMLOCKFLAG:I.NOTNUMLOCKFLAG,e.Lstates|=t.K_SCROLL?I.SCROLLFLAG:I.NOTSCROLLFLAG),e.kName&&e.kName.substr(0,2)=="U_"&&(e.LisVirtualKey=!1),typeof e.Lcode=="undefined"&&(e.Lcode=this.getVKDictionaryCode(e.kName),e.Lcode||(e.Lcode=1)),(e.Lmodifiers&m.modifierBitmasks.ALT_GR_SIM)==m.modifierBitmasks.ALT_GR_SIM&&this.emulatesAltGr&&(e.Lmodifiers&=~m.modifierBitmasks.ALT_GR_SIM,e.Lmodifiers|=I.RALTFLAG)}getVKDictionaryCode(e){let t=this.scriptObject.VKDictionary||{};if(!this.scriptObject.VKDictionary){if(typeof this.scriptObject.KVKD=="string"){let B=this.scriptObject.KVKD.split(" ");for(var n=0;n<B.length;n++)t[B[n].toUpperCase()]=n+256}this.scriptObject.VKDictionary=t}let s=t[e.toUpperCase()];return s||0}};r(Me,"Keyboard"),Me.DEFAULT_SCRIPT_OBJECT={gs:function(e,t){return!1},KI:"",KN:"",KV:f.DEFAULT_RAW_SPEC,KM:0};var k=Me;var Hn={osk:m},oc=class oc{constructor(e,t){this.loadedKeyboard=null;this._jsGlobal=e,this.keymanGlobal=t,this.install()}KR(e){if(this.loadedKeyboard)throw new Error("Unexpected state:  the most-recently loaded keyboard field was not properly reset.");this.loadedKeyboard=new k(e)}KLOAD(e,t,n){return n}install(){this._jsGlobal.KeymanWeb=this,this._jsGlobal.keyman=this.keymanGlobal}uninstall(){this._jsGlobal.KeymanWeb==this&&delete this._jsGlobal.KeymanWeb,this._jsGlobal.keyman==this.keymanGlobal&&delete this._jsGlobal.keyman}};r(oc,"KeyboardHarness");var be=oc;var gc=class gc extends Error{constructor(t,n){super(t);this.cause=n}};r(gc,"KeyboardScriptError");var he=gc,uc=class uc extends Error{constructor(t,n){super(t);this.cause=n}};r(uc,"KeyboardMissingError");var Wn=uc,yc=class yc{constructor(e){this.uri=e}missingError(e){let t=`Cannot find the keyboard at ${this.uri}.`;return new Wn(t,e)}scriptError(e){let t=`Error registering the keyboard script at ${this.uri}; it may contain an error.`;return new he(t,e)}};r(yc,"UriBasedErrorBuilder");var Uc=yc,Ic=class Ic{constructor(e){this.stub=e}missingError(e){let t=this.stub,n=`Cannot find the ${t.name} keyboard for ${t.langName} at ${t.filename}.`;return new Wn(n,e)}scriptError(e){let t=this.stub,n=`Error registering the ${t.name} keyboard for ${t.langName}; keyboard script at ${t.filename} may contain an error.`;return new he(n,e)}};r(Ic,"StubBasedErrorBuilder");var dc=Ic,bc=class bc{get harness(){return this._harness}constructor(e){this._harness=e}loadKeyboardFromPath(e){return this.harness.install(),this.loadKeyboardInternal(e,new Uc(e))}loadKeyboardFromStub(e){return this.harness.install(),this.loadKeyboardInternal(e.filename,new dc(e),e.id)}};r(bc,"KeyboardLoaderBase");var Oe=bc;var ur=(s=>(s.KEYBOARD="keyboard",s.LANGUAGE="language",s.LANGUAGE_KEYBOARD="languageKeyboard",s.BLANK="blank",s))(ur||{}),Ct=ur;function hc(Q,e){if(Q)return{family:Q.family,path:e,files:Q.filename||Q.source}}r(hc,"internalizeFont");var ne=class ne{static get spacebarTextMode(){return typeof this.spacebarTextModeSrc=="string"?this.spacebarTextModeSrc:this.spacebarTextModeSrc()}static set spacebarTextMode(e){this.spacebarTextModeSrc=e}constructor(e,t){if(typeof e!="string")if(e.KI||e.KL||e.KLC||e.KFont||e.KOskFont){let n=e;this.KI=n.KI,this.KN=n.KN,this.KL=n.KL,this.KLC=n.KLC,this.KFont=n.KFont,this.KOskFont=n.KOskFont,this._displayName=n instanceof ne?n._displayName:n.displayName}else{let n=e;n.languages||(n.languages=n.language),this.KI=n.id,this.KN=n.name,this.KL=n.languages.name,this.KLC=n.languages.id,this.KFont=hc(n.languages.font,t),this.KOskFont=hc(n.languages.oskFont,t)}else this.KI=e,this.KLC=t}static fromMultilanguageAPIStub(e){let t=[];e.languages||(e.languages=e.language);for(let n of e.languages){let s={id:e.id,name:e.name,languages:n};t.push(new ne(s))}return t}get id(){return this.KI}get name(){return this.KN}get langId(){return this.KLC}get langName(){return this.KL}get displayName(){if(this._displayName)return this._displayName;let e=this.KN,t=this.KL;switch(ne.spacebarTextMode){case Ct.KEYBOARD:return e;case Ct.LANGUAGE:return t;case Ct.LANGUAGE_KEYBOARD:return e==t?t:t+" - "+e;case Ct.BLANK:return"";default:return e}}set displayName(e){this._displayName=e}get textFont(){return this.KFont}get oskFont(){return this.KOskFont}validateForOSK(){return this.KLC?this.displayName===void 0||ne.spacebarTextMode!=Ct.BLANK&&!this.displayName?new Error("A display name is missing for this keyboard and cannot be generated under current settings."):null:this.KI||this.KN?new Error(`No language code was specified for use with the ${this.KI||this.KN} keyboard`):new Error("No language code was specified for use with the corresponding keyboard")}validateForCustomKeyboard(){return!this.KI||!this.KN||!this.KL||!this.KLC?new Error("To use a custom keyboard, you must specify keyboard id, keyboard name, language and language code."):null}};r(ne,"KeyboardProperties"),ne.spacebarTextModeSrc=Ct.KEYBOARD;var kt=ne;var yr=r(Q=>Q.substring(Q.length-1)!="/"?Q+"/":Q,"addDelimiter"),mc=class mc{constructor(e,t){t=yr(t),this.sourcePath=t,this.protocol=t.replace(/(.{3,5}:)(.*)/,"$1"),this.updateFromOptions(e)}updateFromOptions(e){let t=this.sourcePath.replace(/(https?:\/\/)([^\/]*)(.*)/,"$1$2/");this._root=t,e.root!=""?this._root=this.fixPath(e.root):this._root=this.fixPath(t);let n=e.resources;n==""&&(n=this.sourcePath),this._resources=this.fixPath(n),this._keyboards=this.fixPath(e.keyboards),this._fonts=this.fixPath(e.fonts)}fixPath(e){return e.length==0||(e=yr(e),e.replace(/^(http)s?:.*/,"$1")=="http"||e.replace(/^(file):.*/,"$1")=="file")?e:e.substring(0,2)=="//"?this.protocol+e:e.substring(0,1)=="/"?this.root+e.substring(1):this.sourcePath+e}get fonts(){return this._fonts}updateFontPath(e){this._fonts=this.fixPath(e)}get root(){return this._root}get resources(){return this._resources}get keyboards(){return this._keyboards}};r(mc,"PathConfiguration");var ze=mc;var xc={root:"",resources:"",keyboards:"",fonts:""};var Cc=class Cc{constructor(e,t){this.suggestions=e,this.transcriptionID=t}};r(Cc,"ReadySuggestions");var me=Cc;var Gc=class Gc extends V.default{constructor(t,n){super();this.initNewContext=!0;this._currentSuggestions=[];this.swallowPrediction=!1;this.doRevert=!1;this.recentRevert=!1;this.doTryAccept=r((t,n)=>{let s=this.recentAcceptCause;if(!s&&this.selected)this.accept(this.selected),n.shouldSwallow=!0,this.recentAcceptCause="key";else if(s&&t=="space"){if(this.recentAcceptCause=null,s=="key"){n.shouldSwallow=!1;return}n.shouldSwallow=!!this.langProcessor.wordbreaksAfterSuggestions}else n.shouldSwallow=!1},"doTryAccept");this.doTryRevert=r(()=>{this.doRevert?(this.doRevert=!1,this.recentAcceptCause=null):this.recentAcceptCause&&(this.showRevert(),this.swallowPrediction=!0)},"doTryRevert");this.invalidateSuggestions=r(t=>{this.initNewContext=!1,this.selected=null,(!this.swallowPrediction||t=="context")&&(this.recentAcceptCause=null,this.doRevert=!1,this.recentRevert=!1,t=="context"&&(this.swallowPrediction=!1,this.initNewContext=!0)),t!="new"&&this.clearSuggestions()},"invalidateSuggestions");this.updateSuggestions=r(t=>{let n=t.suggestions;this._currentSuggestions=n,this.selected=null,this.keepSuggestion=null;for(let s of n)s.tag=="keep"&&(this.keepSuggestion=s),s.autoAccept&&!this.selected&&(this.selected=s);this.keepSuggestion&&this._currentSuggestions.splice(this._currentSuggestions.indexOf(this.keepSuggestion),1),this.swallowPrediction?this.swallowPrediction=!1:(this.recentAcceptCause=null,this.doRevert=!1,this.recentRevert=!1),this.sendUpdateEvent()},"updateSuggestions");this.onModelStateChange=r(t=>{(t=="configured"||t=="inactive")&&this.resetContext()},"onModelStateChange");this.langProcessor=t,this.kbdProcessor=n;let s=r(()=>this.currentTarget&&t.state=="configured","validSuggestionState");this.suggestionApplier=B=>s()?t.applySuggestion(B,this.currentTarget,()=>n.layerId):null,this.suggestionReverter=B=>E(this,null,function*(){if(s()){let c=yield t.applyReversion(B,this.currentTarget);this.swallowPrediction=!0,this.updateSuggestions(new me(c,B.id?-B.id:void 0))}}),this.postApplicationHandler=()=>{var B;n.newLayerStore.set(""),n.oldLayerStore.set(""),(B=n.processPostKeystroke(n.contextDevice,this.currentTarget))==null||B.finalize(n,this.currentTarget,!0)},this.connect()}get currentTarget(){return this._currentTarget}setCurrentTarget(t){let n=this._currentTarget;return this._currentTarget=t,n!=t?this.resetContext():Promise.resolve([])}connect(){this.langProcessor.addListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.addListener("suggestionsready",this.updateSuggestions),this.langProcessor.addListener("tryaccept",this.doTryAccept),this.langProcessor.addListener("tryrevert",this.doTryRevert),this.langProcessor.addListener("statechange",this.onModelStateChange),this.langProcessor.addListener("suggestionapplied",this.postApplicationHandler)}disconnect(){this.langProcessor.removeListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.removeListener("suggestionsready",this.updateSuggestions),this.langProcessor.removeListener("tryaccept",this.doTryAccept),this.langProcessor.removeListener("tryrevert",this.doTryRevert),this.langProcessor.removeListener("statechange",this.onModelStateChange),this.langProcessor.removeListener("suggestionapplied",this.postApplicationHandler),this.clearSuggestions()}get currentSuggestions(){let t=[],n=this.activateKeep()&&this.keepSuggestion,s=this.selected&&this.keepSuggestion!=this.selected;return n&&(s||this.keepSuggestion.matchesModel)?t.push(this.keepSuggestion):this.doRevert&&t.push(this.revertSuggestion),t.concat(this._currentSuggestions)}acceptInternal(t){return t?t.tag=="revert"?(this.suggestionReverter(t),null):this.suggestionApplier(t):null}accept(t){let n=this;return this.selected=null,this.doRevert=!1,this.revertAcceptancePromise=this.acceptInternal(t),this.revertAcceptancePromise?(this.revertAcceptancePromise.then(function(s){s&&(n.revertSuggestion=s)}),this.recentAcceptCause="banner",this.recentRevert=!1,this.swallowPrediction=!0,this.revertAcceptancePromise):(t&&t.tag=="revert"&&(this.recentAcceptCause=null,this.recentRevert=!0),Promise.resolve(null))}showRevert(){this.doRevert=!0,this.sendUpdateEvent()}clearSuggestions(){this.updateSuggestions({suggestions:[],transcriptionID:0})}activateKeep(){return!this.recentAcceptCause&&!this.recentRevert&&!this.initNewContext}sendUpdateEvent(){this.emit("update",this.currentSuggestions)}resetContext(){let t=this.currentTarget;return t?this.langProcessor.invalidateContext(t,this.kbdProcessor.layerId):Promise.resolve([])}};r(Gc,"PredictionContext");var xe=Gc;var ws=class ws{constructor(e){e.OS==Z.OperatingSystem.Android?this.popupCanvasBackgroundColor="#999":this.popupCanvasBackgroundColor=ws.prefersDarkMode()?"#0f1319":"#ffffff"}static prefersDarkMode(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}};r(ws,"StyleConstants");var An=ws;var pc=class pc{constructor(){this.touchable="ontouchstart"in window,this.OS="",this.formFactor="desktop",this.browser="",this.dyPortrait=0,this.dyLandscape=0,this.version="0",this.orientation=window.orientation}getDPI(){var e=document.createElement("DIV"),t=e.style,n=96;return document.readyState!=="complete"||(e.id="calculateDPI",t.position="absolute",t.display="block",t.visibility="hidden",t.left="10px",t.top="10px",t.width="1in",t.height="10px",document.body.appendChild(e),n=typeof window.devicePixelRatio=="undefined"?e.offsetWidth:e.offsetWidth*window.devicePixelRatio,document.body.removeChild(e)),n}detect(){var e=!1;if(navigator&&navigator.userAgent){var t=navigator.userAgent;if(t.indexOf("iPad")>=0)this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;else if(t.indexOf("iPhone")>=0)this.OS="iOS",this.formFactor="phone",this.dyPortrait=this.dyLandscape=25;else if(t.indexOf("Android")>=0){this.OS="Android",this.formFactor="phone",this.dyPortrait=75,this.dyLandscape=25;try{var n=new RegExp("(?:Android\\s+)(\\d+\\.\\d+\\.\\d+)");this.version=t.match(n)[1]}catch(a){}}else if(t.indexOf("Linux")>=0)this.OS="Linux";else if(t.indexOf("Macintosh")>=0){let F=/Intel Mac OS X (\d+(?:[_\.]\d+)+)/i.exec(t);if(!F)console.warn("KMW could not properly parse the user agent string.A suboptimal keyboard layout may result."),this.OS="MacOSX";else if(F.length>1&&F[1]){let o=F[1].replace("_","."),d=new O(o);e=O.MAC_POSSIBLE_IPAD_ALIAS.compareTo(d)<=0,this.OS="MacOSX"}}else t.indexOf("Windows NT")>=0&&(this.OS="Windows",t.indexOf("Touch")>=0&&(this.formFactor="phone"),typeof navigator.msMaxTouchPoints=="number"&&navigator.msMaxTouchPoints>0&&(this.touchable=!0))}let s=Math.min(screen.width,screen.height),B=Math.max(screen.width,screen.height),c=s/B;this.OS!="iOS"&&this.formFactor=="phone"&&(s>=600&&c>.5625||c>=.625)&&(this.formFactor="tablet");let i=navigator.platform=="Win32"||navigator.platform=="MacIntel";this.OS=="iOS"&&!("ongesturestart"in window)&&!i&&(this.OS="Android"),this.browser="web",(this.OS=="iOS"||this.OS.toLowerCase()=="macosx")&&(this.browser="safari");var l=/Firefox|Chrome|OPR|Safari|Edge/;if(l.test(navigator.userAgent)&&(navigator.userAgent.indexOf("Firefox")>=0&&"onmozorientationchange"in screen?this.browser="firefox":navigator.userAgent.indexOf("OPR")>=0?this.browser="opera":navigator.userAgent.indexOf(" Edge/")>=0?this.browser="edge":navigator.userAgent.indexOf("Chrome")>=0?this.browser="chrome":navigator.userAgent.indexOf("Safari")>=0&&(this.browser="safari")),e&&this.browser=="safari"&&window.TouchEvent){this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;let a=screen.height/screen.width;a<1&&(a=1/a),a>1.6&&(this.formFactor="phone",this.dyPortrait=this.dyLandscape=25)}return this.colorScheme=An.prefersDarkMode()?"dark":"light",this.coreSpec}get coreSpec(){return new Z(this.browser,this.formFactor,this.OS,this.touchable)}};r(pc,"Device");var we=pc;var Sc=class Sc extends V.default{constructor(t,n){super();this.applyCacheBusting=!1;if(!n){let s=new we;s.detect(),n=s.coreSpec}this.sourcePath=t,this.hostDevice=n,this.deferForInitialization=new J}initialize(t){this._paths?this._paths.updateFromOptions(t):this._paths=new ze(t,this.sourcePath),typeof t.setActiveOnRegister=="boolean"?this.activateFirstKeyboard=t.setActiveOnRegister:this.activateFirstKeyboard=!0,this._spacebarText=t.spacebarText,kt.spacebarTextMode=()=>this.spacebarText}finalizeInit(){this.deferForInitialization.resolve()}get paths(){return this._paths}get spacebarText(){return this._spacebarText}set spacebarText(t){this._spacebarText!=t&&(this._spacebarText=t,this.emit("spacebartext",t))}get softDevice(){return this.hostDevice}get hardDevice(){return cc(this.hostDevice)}get stubNamespacer(){return this._stubNamespacer}set stubNamespacer(t){this._stubNamespacer=t}debugReport(){return{hostDevice:this.hostDevice,initialized:this.deferForInitialization.isResolved}}onRuleFinalization(t,n){}};r(Sc,"EngineConfiguration");var vn=Sc,Xc=b({setActiveOnRegister:!0,spacebarText:Ct.LANGUAGE_KEYBOARD},xc);var Nn=class Nn extends V.default{constructor(t){super();this.pendingActivations=[];this.engineConfig=t}get predictionContext(){return this._predictionContext}configure(t){this._resetContext=t.resetContext,this._predictionContext=t.predictionContext,this.keyboardCache=t.keyboardCache}insertText(t,n,s){let B=this.activeTarget;return B!=null?(n!=null&&t.output(0,B,n),typeof s!="undefined"&&s!==null&&t.deadkeyOutput(0,B,s),B.invalidateSelection(),!0):!1}resetContext(){this._resetContext(this.activeTarget),this.predictionContext.resetContext()}findAndPopActivation(t){let n;for(n=0;n<this.pendingActivations.length&&this.pendingActivations[n].target!=t;n++);return n==this.pendingActivations.length?null:this.pendingActivations.splice(n,1)[0]}deferredKeyboardActivation(t,n,s){return E(this,null,function*(){let B={target:s,keyboard:t,stub:n};this.findAndPopActivation(s),this.pendingActivations.push(B),yield t;let c=this.findAndPopActivation(s);return c==B?B:(c&&this.pendingActivations.push(c),null)})}activateKeyboard(t,n,s){return E(this,null,function*(){let B=!this.activeKeyboard;this.findAndPopActivation(this.currentKeyboardSrcTarget());let c=this.prepareKeyboardForActivation(t,n),i=this.currentKeyboardSrcTarget(),l=yield c.keyboard;if(l==null&&c.metadata)return!1;this.currentKeyboardSrcTarget()==i&&this.emit("beforekeyboardchange",c.metadata);let a=null;return l&&(a={keyboard:l,metadata:c.metadata}),this.activateKeyboardForTarget(a,i),this.currentKeyboardSrcTarget()==i&&(!B||l)&&this.emit("keyboardchange",this.activeKeyboard),!0})}prepareKeyboardForActivation(t,n){var c;n||(n="");let s=null;if(t?s=this.keyboardCache.getStub(t,n):n=="",!s){if(t)throw new Error("No matching stub has been registered.");return{keyboard:Promise.resolve(null),metadata:null}}if((c=this.activeKeyboard)!=null&&c.metadata&&t==this.activeKeyboard.metadata.id){let i=this.activeKeyboard.keyboard;return{keyboard:Promise.resolve(i),metadata:s}}let B;if(B=this.keyboardCache.getKeyboardForStub(s))return{keyboard:Promise.resolve(B),metadata:s};{this.emit("beforekeyboardchange",s);let i=this.engineConfig.deferForInitialization.then(()=>{let a=new J;this.emit("keyboardasyncload",s,a.corePromise);let F=this.keyboardCache.fetchKeyboardForStub(s),o=new Promise((U,u)=>{let g=`Sorry, the ${s.name} keyboard for ${s.langName} is not currently available.`;window.setTimeout(()=>u(new Error(g)),Nn.TIMEOUT_THRESHOLD)}),d=Promise.race([F,o]);return d.then(()=>{a.resolve(null),o.catch(()=>{})}),d.catch(U=>{throw a.resolve(U),U}),d});return{keyboard:this.deferredKeyboardActivation(i,s,this.currentKeyboardSrcTarget()).then(a=>E(this,null,function*(){return a?i:Promise.resolve(null)})),metadata:s}}}};r(Nn,"ContextManagerBase"),Nn.TIMEOUT_THRESHOLD=1e4;var Tn=Nn;var Zc=class Zc extends V.default{};r(Zc,"HardKeyboard");var De=Zc;function Vc(Q,e,t){if(e&&e.isMnemonic&&Q.setMnemonicCode(!!(Q.Lmodifiers&I.K_SHIFTFLAG),!!(Q.Lmodifiers&I.CAPITALFLAG)),e&&!e.isMnemonic){var n=et.languageMap[t];n&&n["k"+Q.Lcode]&&(Q.Lcode=n["k"+Q.Lcode]),!e.definesPositionalOrMnemonic&&!(Q.Lmodifiers&m.modifierBitmasks.NON_LEGACY)&&!Q.isModifier&&(Q=new tt({Lcode:et._USKeyCodeToCharCode(Q),Lmodifiers:0,LisVirtualKey:!1,vkCode:Q.Lcode,Lstates:Q.Lstates,kName:"",device:Q.device,isSynthetic:!1}))}return Q}r(Vc,"processForMnemonicsAndLegacy");function Lc(Q,e,t){let n=Math.min(Q.length,e.length),s,B,c,i,l;for(t?(s=B=Q.length-1,c=B-n,i=-1,l=e.length-Q.length):(s=B=0,c=n,i=1,l=0);B!=c&&Q.charAt(B)==e.charAt(B+l);B+=i);if(B!=s&&B!=c){let a=Q.charCodeAt(B-i),F=Q.charCodeAt(B),o=e.charCodeAt(B+l),d=t?ks:fs,U=t?fs:ks;if(d(a)&&(U(F)||U(o)))return B-i}return B}r(Lc,"findCommonSubstringEndIndex");var Ce=class Ce{constructor(e,t){this.p=e,this.d=t,this.o=Ce.ordinalSeed++}match(e,t){var n=this.p==e&&this.d==t;return n}set(){this.matched=1}reset(){this.matched=0}before(e){return this.o<e.o}clone(){let e=new Ce(this.p,this.d);return e.o=this.o,e}equal(e){return this.d==e.d&&this.p==e.d&&this.o==e.o}};r(Ce,"Deadkey"),Ce.ordinalSeed=0,Ce.sortFunc=r(function(e,t){return e.p!=t.p?t.p-e.p:t.o-e.o},"sortFunc");var fn=Ce,Ks=class Ks{constructor(){this.dks=[]}toSortedArray(){return this.dks=this.dks.sort(fn.sortFunc),[].concat(this.dks)}clone(){let e=new Ks,t=this.toSortedArray();return e.dks=[],t.forEach(function(n){e.dks.push(n.clone())}),e}isMatch(e,t,n){if(this.dks.length==0)return!1;var s=e;t=s-t;for(var B=0;B<this.dks.length;B++)if(this.dks[B].match(t,n)&&!this.dks[B].matched)return this.dks[B].set(),!0;return this.resetMatched(),!1}add(e){this.dks=this.dks.concat(e)}remove(e){var t=this.dks.indexOf(e);this.dks.splice(t,1)}clear(){this.dks=[]}resetMatched(){for(let e of this.dks)e.reset()}deleteMatched(){for(var e=0;e<this.dks.length;e++)this.dks[e].matched&&this.dks.splice(e--,1)}adjustPositions(e,t){if(t!=0)for(let n of this.dks)n.p>e&&(n.p+=t)}equal(e){if(this.dks.length!=e.dks.length)return!1;let t=e.dks,n=[];for(let s of this.dks)if(!t.find(c=>s.equal(c)))return!1;return n.length==t.length}count(){return this.dks.length}};r(Ks,"DeadkeyTracker");var Ds=Ks;Jn();function Ge(Q){var e;return Q?Q.insert===""&&Q.deleteLeft===0&&((e=Q.deleteRight)!=null?e:0)===0:!0}r(Ge,"isEmptyTransform");var kn=class kn{constructor(e,t,n,s){this.insert=e,this.deleteLeft=t,this.deleteRight=n,this.erasedSelection=s}};r(kn,"TextTransform"),kn.nil=new kn("",0,0,!1);var Ec=kn,Yn=class Yn{constructor(e,t,n,s){let B=this.token=Yn.tokenSeed++;this.keystroke=e,this.transform=t,this.alternates=s,this.preInput=n,this.transform.id=this.token,s&&s.forEach(function(c){c.sample.id=B})}};r(Yn,"Transcription"),Yn.tokenSeed=0;var Jc=Yn,Rc=class Rc{constructor(){this._dks=new Ds}get isSynthetic(){return!0}resetContext(){this.deadkeys().clear()}deadkeys(){return this._dks}hasDeadkeyMatch(e,t){return this.deadkeys().isMatch(this.getDeadkeyCaret(),e,t)}insertDeadkeyBeforeCaret(e){var t=new fn(this.getDeadkeyCaret(),e);this.deadkeys().add(t)}adjustDeadkeys(e){this.deadkeys().adjustPositions(this.getDeadkeyCaret(),e)}setDeadkeys(e){this._dks=e.clone()}buildTransformFrom(e){let t=this.getTextBeforeCaret(),n=e.getTextBeforeCaret(),s=Lc(n,t,!1),B=n.substring(s)._kmwLength(),c=t.substring(s),i=this.getTextAfterCaret(),l=e.getTextAfterCaret(),a=Lc(l,i,!0),F=l.substring(0,a+1)._kmwLength();return new Ec(c,B,F,e.getSelectedText()&&!this.getSelectedText())}buildTranscriptionFrom(e,t,n,s){let B=this.buildTransformFrom(e);return new Jc(t,B,N.from(e,n),s)}restoreTo(e){this.clearSelection(),this.setTextBeforeCaret(e.getTextBeforeCaret()),this.setTextAfterCaret(e.getTextAfterCaret()),this._dks=e._dks.clone()}apply(e){this.clearSelection(),e.deleteRight&&this.setTextAfterCaret(this.getTextAfterCaret()._kmwSubstr(e.deleteRight)),e.deleteLeft&&this.deleteCharsBeforeCaret(e.deleteLeft),e.insert&&this.insertTextBeforeCaret(e.insert),this._dks.clear()}setTextBeforeCaret(e){this.deleteCharsBeforeCaret(this.getTextBeforeCaret()._kmwLength()),this.insertTextBeforeCaret(e)}saveProperties(){}restoreProperties(){}};r(Rc,"OutputTarget");var se=Rc;var Ke=class Ke extends se{constructor(t,n,s){super();this.selForward=!0;this.text=t||"";var B=this.text._kmwLength();this.selStart=typeof n=="number"?n:B,this.selEnd=typeof s=="number"?s:this.selStart,this.selForward=this.selEnd>=this.selStart}static from(t,n){let s;if(t instanceof Ke){let B=t;s=new Ke(B.text,B.selStart,B.selEnd)}else{let B=t.getText(),c=B._kmwLength(),i=c,l=0;if(t.hasSelection()){let a=t.getTextBeforeCaret(),F=t.getTextAfterCaret();i=a._kmwLength(),l=c-F._kmwLength()}s=new Ke(B,i,l)}return s.setDeadkeys(t.deadkeys()),s}clearSelection(){this.text=this.getTextBeforeCaret()+this.getTextAfterCaret(),this.selEnd=this.selStart,this.selForward=!0}invalidateSelection(){}isSelectionEmpty(){return this.selStart==this.selEnd}hasSelection(){return!0}getDeadkeyCaret(){return this.selStart}setSelection(t,n){if(this.selStart=t,this.selEnd=typeof n=="number"?n:t,this.selForward=n>=t,!this.selForward){let s=this.selStart;this.selStart=this.selEnd,this.selEnd=s}}getTextBeforeCaret(){return this.text.kmwSubstr(0,this.selStart)}getSelectedText(){return this.text.kmwSubstr(this.selStart,this.selEnd-this.selStart)}getTextAfterCaret(){return this.text.kmwSubstr(this.selEnd)}getText(){return this.text}deleteCharsBeforeCaret(t){t>=0&&(t>this.selStart&&(t=this.selStart),this.adjustDeadkeys(-t),this.text=this.text.kmwSubstr(0,this.selStart-t)+this.text.kmwSubstr(this.selStart),this.selStart-=t,this.selEnd-=t)}insertTextBeforeCaret(t){this.adjustDeadkeys(t._kmwLength()),this.text=this.getTextBeforeCaret()+t+this.text.kmwSubstr(this.selStart),this.selStart+=t.kmwLength(),this.selEnd+=t.kmwLength()}handleNewlineAtCaret(){this.insertTextBeforeCaret(`
`)}setTextAfterCaret(t){this.text=this.getTextBeforeCaret()+t}isEqual(t){return this.text==t.text&&this.selStart==t.selStart&&this.selEnd==t.selEnd&&this.deadkeys().equal(t.deadkeys())}doInputEvent(){}};r(Ke,"Mock");var N=Ke;var Hc=class Hc{constructor(){this.transcription=null;this.setStore={};this.saveStore={};this.variableStores={};this.triggersDefaultCommand=!1}finalize(e,t,n){if(!this.transcription)throw"Cannot finalize a RuleBehavior with no transcription.";e.beepHandler&&this.beep&&e.beepHandler(t);for(let s in this.setStore){let B=e.keyboardInterface.systemStores[s];if(B)try{B.set(this.setStore[s])}catch(c){e.errorLogger&&e.errorLogger("Rule attempted to perform illegal operation - 'platform' may not be changed.")}else e.warningLogger&&e.warningLogger("Unknown store affected by keyboard rule: "+s)}if(e.keyboardInterface.applyVariableStores(this.variableStores),e.keyboardInterface.variableStoreSerializer)for(let s in this.saveStore)e.keyboardInterface.variableStoreSerializer.saveStore(e.activeKeyboard.id,s,this.saveStore[s]);if(this.triggersDefaultCommand){let s=this.transcription.keystroke;e.defaultRules.applyCommand(s,t)}e.warningLogger&&this.warningLog?e.warningLogger(this.warningLog):e.errorLogger&&this.errorLog&&e.errorLogger(this.errorLog)}mergeInDefaults(e){let t=this.transcription.keystroke,n=e.transcription.keystroke;if(t.Lcode!=n.Lcode||t.Lmodifiers!=n.Lmodifiers)throw"RuleBehavior default-merge not supported unless keystrokes are identical!";this.triggersDefaultCommand=this.triggersDefaultCommand||e.triggersDefaultCommand;let s=N.from(this.transcription.preInput,!1);s.apply(this.transcription.transform),s.apply(e.transcription.transform),this.transcription=s.buildTranscriptionFrom(this.transcription.preInput,t,!1,this.transcription.alternates)}};r(Hc,"RuleBehavior");var st=Hc;var Wc=class Wc{constructor(e){this.id=e}set(e){throw new Error("System store with ID "+this.id+" may not be directly set.")}};r(Wc,"SystemStore");var Ps=Wc,Ac=class Ac extends Ps{constructor(t,n){super(t);this.handler=null;this._value=n}get value(){return this._value}matches(t){return this._value==t}set(t){this.handler&&this.handler(this,t)||(this._value=t)}};r(Ac,"MutableSystemStore");var Pe=Ac,vc=class vc extends Ps{constructor(t){super(31);this.kbdInterface=t}matches(t){var n,s,B=t.split(" ");let c=this.kbdInterface.activeDevice;for(n=0;n<B.length;n++)switch(s=B[n].toLowerCase(),s){case"touch":case"hardware":if(c.touchable!=(s=="touch"))return!1;break;case"macos":case"mac":s="macosx";case"macosx":case"windows":case"android":case"ios":case"linux":if(c.OS!=s)return!1;break;case"tablet":case"phone":case"desktop":if(c.formFactor!=s)return!1;break;case"web":if(c.browser=="native")return!1;break;case"native":case"chrome":case"firefox":case"safari":case"edge":case"opera":if(c.browser!=s)return!1;break;default:return!1}return!0}};r(vc,"PlatformSystemStore");var js=vc;var kc=class kc{};r(kc,"KeyInformation");var Nc=kc;var Yc=class Yc{reset(){this._cache=[]}get(e,t){return typeof this._cache[e]=="undefined"||typeof this._cache[e][t]=="undefined"?null:this._cache[e][t]}set(e,t,n){typeof this._cache[e]=="undefined"&&(this._cache[e]=[]),this._cache[e][t]=n}};r(Yc,"CachedContext");var Tc=Yc,_s=class _s{reset(){this._cache=[]}get(e,t){return typeof this._cache[e]=="undefined"||typeof this._cache[e][t]=="undefined"?null:this._cache[e][t]}set(e,t,n){typeof this._cache[e]=="undefined"&&(this._cache[e]=[]),this._cache[e][t]=n}clone(){let e=new _s;return e._cache=this._cache,e}};r(_s,"CachedContextEx");var fc=_s,Mn=class Mn extends be{constructor(t,n,s=null){super(t,n);this.cachedContext=new Tc;this.cachedContextEx=new fc;this._AnyIndices=[];this.systemStores={},this.systemStores[31]=new js(this),this.systemStores[33]=new Pe(33,"default"),this.systemStores[42]=new Pe(42,""),this.systemStores[43]=new Pe(43,""),this.variableStoreSerializer=s}get Codes(){return m}saveFocus(){}registerKeyboard(t){let n=new k(t);this.loadedKeyboard=n}context(t,n,s){var B=this.cachedContext.get(t,n);if(B!==null)return B;var c=this.KC_(t,n,s);return this.cachedContext.set(t,n,c),c}KC_(t,n,s){var B="";return B=s.isSelectionEmpty()?s.getTextBeforeCaret():"",B._kmwLength()<t&&(B=Array(t-B._kmwLength()+1).join("\uFFFE")+B),B._kmwSubstr(-t)._kmwSubstr(0,n)}nul(t,n){var s=this.context(t+1,1,n);return s==="\uFFFE"}contextMatch(t,n,s,B){var c=this.context(t,B,n);return c===s?!0:(n.deadkeys().resetMatched(),!1)}_BuildExtendedContext(t,n,s){var B=this.cachedContextEx.get(t,n);if(B!==null)return B;if(B=this.cachedContextEx.get(t,t),B===null){let d=s.deadkeys().toSortedArray();var c=0;for(B={valContext:[],deadContext:[]};B.valContext.length<t;){var i=s.getDeadkeyCaret(),l=i-c;if(d.length>0&&d[0].p>l){d.splice(0,1);continue}else if(d.length>0&&d[0].p==l)B.deadContext[t-B.valContext.length-1]=d[0],B.valContext=[d[0].d].concat(B.valContext),d.splice(0,1);else{var a=this.context(++c,1,s);B.valContext=[a].concat(B.valContext)}}this.cachedContextEx.set(t,t,B)}var F=B;F.valContext=F.valContext.slice(0,n);for(var o=0;o<F.valContext.length;o++)F.valContext[o]=="\uFFFE"&&(F.valContext.splice(0,1),F.deadContext.splice(0,1));return F.valContext.length==0&&(F.valContext=["\uFFFE"],F.deadContext=[]),this.cachedContextEx.set(t,n,F),F}fullContextMatch(t,n,s){var B=this._BuildExtendedContext(t,s.length,n);this.ruleContextEx=this.cachedContextEx.clone();var c=B.valContext,i=B.deadContext,l=!1;let a="\uFFFE";for(var F=r(function(x){throw new Error("Unexpected object in fullContextMatch specification: "+x)},"assertNever"),o=0;o<s.length;o++)if(typeof s[o]=="string"){var d=s[o];if(d!==c[o]){l=!0;break}}else{var U=s[o];switch(U.t){case"d":U.d!==c[o]?l=!0:i[o].set();break;case"a":var u;typeof c[o]=="string"?u=c[o]:u={t:"d",d:c[o]};var g=this.any(o,u,U.a);U.n?U.n&&(g||c[o]===a)&&(l=!0):g?i[o]!==void 0&&i[o].set():l=!0;break;case"i":var y=this._Index(U.i,U.o);y!==void 0&&(typeof y=="string"?y:y.d)!==c[o]?l=!0:i[o]!==void 0&&i[o].set();break;case"c":c[U.c-1]!==c[o]?l=!0:i[o]!==void 0&&i[o].set();break;case"n":c[o]!=a&&(l=!0);break;default:F(U)}}return l&&(n.deadkeys().resetMatched(),this._AnyIndices=[]),!l}isKeypress(t){return this.activeKeyboard.isMnemonic?!t.LisVirtualKey:!!et._USKeyCodeToCharCode(t)}static matchModifiersToRuleChirality(t,n){let s=I.LALTFLAG|I.RALTFLAG,B=I.LCTRLFLAG|I.RCTRLFLAG,c=t;if(!(n&s)){let i=c&s;i&&(c^=i|I.K_ALTFLAG)}if(!(n&B)){let i=c&B;i&&(c^=i|I.K_CTRLFLAG)}return c}keyMatch(t,n,s){var B=!1,c=t.Lcode==173?189:t.Lcode;let i=this.activeKeyboard.modifierBitmask;var l=i&m.modifierBitmasks.ALL,a=i&m.stateBitmasks.ALL;let F=Mn.matchModifiersToRuleChirality(t.Lmodifiers,n);return t.vkCode>255&&(c=t.vkCode),t.LisVirtualKey||c>255?((n&16384)==16384||c>255)&&(B=s==c&&(n&l)==F,B=B&&this.stateMatch(t,n&a)):n&16384||(B=c==s),B||this.activeTargetOutput.deadkeys().resetMatched(),B}stateMatch(t,n){return(n&t.Lstates)==n}keyInformation(t){var n=new Nc;return n.vk=t.LisVirtualKey,n.code=t.Lcode,n.modifiers=t.Lmodifiers,n}deadkeyMatch(t,n,s){return n.hasDeadkeyMatch(t,s)}beep(t){this.resetContextCache(),this.ruleBehavior.beep=!0}_ExplodeStore(t){if(typeof t=="string"){let B=this.activeKeyboard.explodedStores;if(B[t])return B[t];for(var n=[],s=0;s<t._kmwLength();s++)n.push(t._kmwCharAt(s));return B[t]=n,n}else return t}any(t,n,s){if(n=="")return!1;s=this._ExplodeStore(s);for(var B=-1,c=0;c<s.length;c++){let i=s[c];if(typeof i=="string"){if(s[c]==n){B=c;break}}else if(i.d===n.d){B=c;break}}return this._AnyIndices[t]=B,B>=0}_Index(t,n){return t=this._ExplodeStore(t),this._AnyIndices[n-1]<t.length?t[this._AnyIndices[n-1]]:(console.warn("Unmatched contextual index() statement detected in rule with index "+n+"!"),"")}indexOutput(t,n,s,B){this.resetContextCache();var c=r(function(l){throw new Error("Unexpected object in fullContextMatch specification: "+l)},"assertNever"),i=this._Index(n,s);if(i!=="")if(typeof i=="string")this.output(t,B,i);else if(i.t)switch(i.t){case"b":this.beep(B);break;case"d":this.deadkeyOutput(t,B,i.d);break;default:c(i)}else this.deadkeyOutput(t,B,i.d)}deleteContext(t,n){var s;if(t>0){s=this._BuildExtendedContext(t,t,n);let i=0;for(var B=0;B<s.valContext.length;B++){var c=s.deadContext[B];c?(n.deadkeys().remove(c),t--):s.valContext[B]=="\uFFFE"&&i++}let l=s.valContext.length-i;t>l&&(t=l)}n.deadkeys().resetMatched(),this.output(t,n,"")}output(t,n,s){this.resetContextCache(),n.saveProperties(),n.clearSelection(),n.deadkeys().deleteMatched(),t>=0&&n.deleteCharsBeforeCaret(t),n.insertTextBeforeCaret(s),n.restoreProperties()}contextExOutput(t,n,s,B){this.resetContextCache(),t>=0&&this.output(t,n,"");let c=this.ruleContextEx.get(s,s),i=c.deadContext[B-1],l=c.valContext[B-1];if(i)n.insertDeadkeyBeforeCaret(i.d);else if(typeof l=="string")this.output(-1,n,l);else throw new Error("contextExOutput: should never be a numeric valContext with no corresponding deadContext")}deadkeyOutput(t,n,s){this.resetContextCache(),t>=0&&this.output(t,n,""),n.insertDeadkeyBeforeCaret(s)}ifStore(t,n,s){var B=!0;let c=this.systemStores[t];return c&&(B=c.matches(n)),B}setStore(t,n,s){return this.resetContextCache(),t==33&&this.activeDevice.touchable?(this.ruleBehavior.setStore[t]=n,!0):!1}loadStore(t,n,s){return this.resetContextCache(),this.variableStoreSerializer&&this.variableStoreSerializer.loadStore(t,n)[n]||s}saveStore(t,n){this.resetContextCache();var s=this.activeKeyboard;if(!s||typeof s.id=="undefined"||s.id=="")return!1;let B={};return B[t]=n,this.ruleBehavior?this.ruleBehavior.saveStore[t]=B:this.variableStoreSerializer.saveStore(this.activeKeyboard.id,t,B),!0}resetContextCache(){this.cachedContext.reset(),this.cachedContextEx.reset()}defaultBackspace(t){t.isSelectionEmpty()?this.output(1,t,""):this.output(0,t,"")}processNewContextEvent(t,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processNewContextEvent.bind(this.activeKeyboard),t,n,!0)}processPostKeystroke(t,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processPostKeystroke.bind(this.activeKeyboard),t,n,!0)}processKeystroke(t,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.process.bind(this.activeKeyboard),t,n,!1)}process(t,n,s,B){if(n)if(this.activeKeyboard){if(!t)throw"No callee for keystroke processing!"}else throw"No active keyboard for keystroke processing!";else throw"No target specified for keyboard output!";n.invalidateSelection(),n.deadkeys().resetMatched(),this.resetContextCache();let c=N.from(n,!0),i=this.activeKeyboard.variableStores;this.ruleBehavior=new st,this.activeDevice=s.device,this.activeTargetOutput=n;var l=t(n,s);this.activeTargetOutput=null,this.ruleBehavior.transcription=n.buildTranscriptionFrom(c,s,B),this.ruleBehavior.variableStores=this.activeKeyboard.variableStores,this.activeKeyboard.variableStores=i,this.ruleBehavior.triggerKeyDefault=!l;let a=this.ruleBehavior;return this.ruleBehavior=null,a}applyVariableStores(t){this.activeKeyboard.variableStores=t}static __publishShorthandAPI(){let t=this.prototype;var n=r(function(s,B){t[B]&&(t[s]=t[B])},"exportKBCallback");n("KSF","saveFocus"),n("KBR","beepReset"),n("KT","insertText"),n("KR","registerKeyboard"),n("KRS","registerStub"),n("KC","context"),n("KN","nul"),n("KCM","contextMatch"),n("KFCM","fullContextMatch"),n("KIK","isKeypress"),n("KKM","keyMatch"),n("KSM","stateMatch"),n("KKI","keyInformation"),n("KDM","deadkeyMatch"),n("KB","beep"),n("KA","any"),n("KDC","deleteContext"),n("KO","output"),n("KDO","deadkeyOutput"),n("KCXO","contextExOutput"),n("KIO","indexOutput"),n("KIFS","ifStore"),n("KSETS","setStore"),n("KLOAD","loadStore"),n("KSAVE","saveStore")}};r(Mn,"KeyboardInterface"),Mn.GLOBAL_NAME="KeymanWeb";var Yt=Mn;(function(){Yt.__publishShorthandAPI()})();var pe=class pe extends V.default{constructor(t,n){super();this.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};this.modStateFlags=0;n||(n=pe.DEFAULT_OPTIONS),this.contextDevice=t,this.baseLayout=n.baseLayout||pe.DEFAULT_OPTIONS.baseLayout,this.keyboardInterface=n.keyboardInterface||new Yt(Te(),Hn),this.defaultRules=n.defaultOutputRules||pe.DEFAULT_OPTIONS.defaultOutputRules}get activeKeyboard(){return this.keyboardInterface.activeKeyboard}set activeKeyboard(t){this.keyboardInterface.activeKeyboard=t,this.resetContext()}get layerStore(){return this.keyboardInterface.systemStores[33]}get newLayerStore(){return this.keyboardInterface.systemStores[42]}get oldLayerStore(){return this.keyboardInterface.systemStores[43]}get layerId(){return this.layerStore.value}set layerId(t){this.layerStore.set(t)}defaultRuleBehavior(t,n,s){let B=N.from(n,s),c=new st,i=!1;var l="",a;if(t.isSynthetic||n.isSynthetic)if(i=!0,this.defaultRules.isCommand(t))c.triggersDefaultCommand=!0;else if((a=this.defaultRules.forSpecialEmulation(t))!=null)switch(a){case"\b":this.keyboardInterface.defaultBackspace(n);break;case`
`:n.handleNewlineAtCaret();break;default:c.errorLog="Unexpected 'special emulation' character (\\u"+a.kmwCharCodeAt(0).toString(16)+") went unhandled!"}else i=!1;let F=this.activeKeyboard&&this.activeKeyboard.isMnemonic;if(!i)if((l=this.defaultRules.forAny(t,F,c))!=null)if(a=this.defaultRules.forSpecialEmulation(t),a=="\b")this.keyboardInterface.defaultBackspace(n);else{if(a||this.defaultRules.isCommand(t))return null;this.keyboardInterface.output(0,n,l)}else return null;if(c.errorLog)return c;let o=n.buildTranscriptionFrom(B,t,s);return c.transcription=o,c}processNewContextEvent(t,n){return this.activeKeyboard?this.keyboardInterface.processNewContextEvent(n,this.activeKeyboard.constructNullKeyEvent(t,this.stateKeys)):null}processPostKeystroke(t,n){return this.activeKeyboard?this.keyboardInterface.processPostKeystroke(n,this.activeKeyboard.constructNullKeyEvent(t,this.stateKeys)):null}processKeystroke(t,n){var s;let B=n.getTextBeforeCaret().kmwLength()==0&&n.isSelectionEmpty();if(this.activeKeyboard&&t.Lcode!=0&&(s=this.keyboardInterface.processKeystroke(n,t)),B&&t.Lcode==m.keyCodes.K_BKSP&&s.triggerKeyDefault)s=this.defaultRuleBehavior(t,n,!1),s.triggerKeyDefault=!0,s.transcription.transform.deleteLeft=1;else if(!s||s.triggerKeyDefault){t.Lcode=t.vkCode||t.Lcode,this.keyboardInterface.activeTargetOutput=n;let c=this.defaultRuleBehavior(t,n,!1);c&&(s?s.mergeInDefaults(c):s=c,s.triggerKeyDefault=!1),this.keyboardInterface.activeTargetOutput=null}return s}_UpdateVKShift(t){let n=0,s=["CAPS","NUM_LOCK","SCROLL_LOCK"],B=["K_CAPS","K_NUMLOCK","K_SCROLL"],c=[I.CAPITALFLAG,I.NUMLOCKFLAG,I.SCROLLFLAG];if(!this.activeKeyboard)return!0;if(t){n=t.Lmodifiers,this.activeKeyboard.isChiral&&this.activeKeyboard.emulatesAltGr&&(this.modStateFlags&m.modifierBitmasks.ALT_GR_SIM)==m.modifierBitmasks.ALT_GR_SIM&&(n|=m.modifierBitmasks.ALT_GR_SIM,n&=~I.RALTFLAG);let i=!1;for(let l=0;l<s.length;l++)t.Lstates&m.stateBitmasks[s[l]]&&(this.stateKeys[B[l]]=!!(t.Lstates&c[l]),i=!0);i&&this.emit("statekeychange",this.stateKeys)}return this.updateStates(),this.activeKeyboard.isMnemonic&&this.stateKeys.K_CAPS&&(!t||!t.isModifier)&&(n^=I.K_SHIFTFLAG),this.layerId=this.getLayerId(n),!0}updateStates(){let t=["K_CAPS","K_NUMLOCK","K_SCROLL"],n=[I.CAPITALFLAG,I.NUMLOCKFLAG,I.SCROLLFLAG],s=[I.NOTCAPITALFLAG,I.NOTNUMLOCKFLAG,I.NOTSCROLLFLAG];for(let B=0;B<t.length;B++){let c=t[B];this.stateKeys[c]?(this.modStateFlags|=n[B],this.modStateFlags&=~s[B]):(this.modStateFlags&=~n[B],this.modStateFlags|=s[B])}}getLayerId(t){return f.getLayerId(t)}selectLayer(t){let n=t.kName;var s=t.kNextLayer,B=this.activeKeyboard&&this.activeKeyboard.isChiral;if(typeof s=="number"&&(s=this.getLayerId(s*16)),!s)switch(n){case"K_LSHIFT":case"K_RSHIFT":case"K_SHIFT":s="shift";break;case"K_LCONTROL":case"K_LCTRL":if(B){s="leftctrl";break}case"K_RCONTROL":case"K_RCTRL":if(B){s="rightctrl";break}case"K_CTRL":s="ctrl";break;case"K_LMENU":case"K_LALT":if(B){s="leftalt";break}case"K_RMENU":case"K_RALT":if(B){s="rightalt";break}case"K_ALT":s="alt";break;case"K_ALTGR":B?s="leftctrl-rightalt":s="ctrl-alt";break;case"K_CURRENCIES":case"K_NUMERALS":case"K_SHIFTED":case"K_UPPER":case"K_LOWER":case"K_SYMBOLS":s="default";break}return s?(this.updateLayer(t,s),!0):!1}updateLayer(t,n){let s=this.layerId;var B=s;if(n==s&&t.device.formFactor!=Z.FormFactor.Desktop)return;var c=n,i;if(t.device.formFactor==Z.FormFactor.Desktop){var l=["leftctrl","rightctrl","ctrl","leftalt","rightalt","alt","shift"];for(i=0;i<l.length;i++)c=c.replace(l[i]+"-",""),c=c.replace(l[i],"");if(s=="default"||s=="numeric"||s=="symbol"||s=="currency"||c!="")B=n;else{var a=m.getModifierState(B);for(i=0;i<l.length;i++)B=B.replace(l[i]+"-",""),B=B.replace(l[i],"");switch(n){case"shift":a^=I.K_SHIFTFLAG;break;case"leftctrl":a^=I.LCTRLFLAG;break;case"rightctrl":a^=I.RCTRLFLAG;break;case"ctrl":a^=I.K_CTRLFLAG;break;case"leftalt":a^=I.LALTFLAG;break;case"rightalt":a^=I.RALTFLAG;break;case"alt":a^=I.K_ALTFLAG;break;default:B=n}B!="default"&&(B==""?B=this.getLayerId(a):B=this.getLayerId(a)+"-"+B)}B==""&&(B="default")}else B=n;this.activeKeyboard.layout(t.device.formFactor).getLayer(B)?this.layerId=B:this.layerId="default";let o=m.getModifierState(this.layerId);this.modStateFlags=o|t.Lstates}doModifierPress(t,n,s){return this.activeKeyboard?t.isModifier?(this.activeKeyboard.notify(t.Lcode,n,s?1:0),t.device.touchable?!0:this._UpdateVKShift(t)):(t.LmodifierChange&&(this.activeKeyboard.notify(0,n,1),t.device.touchable||this._UpdateVKShift(t)),!1):!1}performNewContextEvent(t){let n=this.processNewContextEvent(this.contextDevice,t);return n&&n.finalize(this,t,!0),n}resetContext(t){this.layerId="default",t==null||t.resetContext(),this.keyboardInterface.resetContextCache(),t&&this.performNewContextEvent(t),this.contextDevice.touchable||this._UpdateVKShift(null)}setNumericLayer(t){this.activeKeyboard&&this.activeKeyboard.layout(t.formFactor).getLayer("numeric")&&(this.layerId="numeric")}};r(pe,"KeyboardProcessor"),pe.DEFAULT_OPTIONS={baseLayout:"us",defaultOutputRules:new Lt};var je=pe;var qs="Keyboard_";function Bt(Q){return Q.startsWith(qs)?Q:qs+Q}r(Bt,"prefixed");function Mt(Q){return Q.startsWith(qs)?Q.substring(qs.length):Q}r(Mt,"withoutPrefix");var Mc=class Mc extends V.default{constructor(t){super();this.stubSetTable={};this.keyboardTable={};this.keyboardLoader=t}getKeyboardForStub(t){return t?this.getKeyboard(t.KI):null}getKeyboard(t){if(!t)return null;let n=this.keyboardTable[Bt(t)];return n instanceof Promise?null:n}get defaultStub(){function t(s){let B=Object.keys(s);if(B.length!=0)return s[B[0]]}r(t,"getFirstValue");let n=t(this.stubSetTable);if(n)return t(n)}addKeyboard(t){let n=Bt(t.id);this.keyboardTable[n]=t,this.emit("keyboardadded",t)}fetchKeyboardForStub(t){return this.fetchKeyboard(t.KI)}isFetchingKeyboard(t){if(!t)throw new Error("Keyboard ID must be specified");return t=Bt(t),this.keyboardTable[t]instanceof Promise}fetchKeyboard(t){if(!t)throw new Error("Keyboard ID must be specified");if(!this.keyboardLoader)throw new Error("Cannot load keyboards; this cache was configured without a loader");t=Bt(t);let n=this.keyboardTable[t];if(n instanceof k)return Promise.resolve(n);if(n instanceof Promise)return n;let s=this.getStub(t,null);if(!s)throw new Error(`No stub for ${Mt(t)} has been registered`);if(!s.filename)throw new Error(`The registered stub for ${Mt(t)} lacks a path to the main keyboard file`);let B=this.keyboardLoader.loadKeyboardFromStub(s);return this.keyboardTable[t]=B,B.then(c=>{c.scriptObject.KI=t,this.addKeyboard(c)}).catch(c=>{throw delete this.keyboardTable[t],c}),B}addStub(t){var B;let n=Bt(t.KI),s=this.stubSetTable[n]=(B=this.stubSetTable[n])!=null?B:{};s[t.KLC]=t,this.emit("stubadded",t)}findMatchingStub(t){return this.getStub(t.KI,t.KLC)}getStub(t,n){var i;let s,B=n||"---";t instanceof k?s=t.id:s=t,s&&(s=Bt(s));let c=(i=this.stubSetTable[s])!=null?i:{};if(B!="---")return c[B];{let l=Object.keys(c);return l.length==0?null:c[l[0]]}}forgetKeyboard(t,n=!1){let s=t instanceof k?t.id:Bt(t);this.stubSetTable[s]&&delete this.stubSetTable[s],n&&this.keyboardTable[s]&&delete this.keyboardTable[s]}getStubList(){let t=[],n=Object.keys(this.stubSetTable);for(let s of n){let B=this.stubSetTable[s],c=Object.keys(B);for(let i of c)t.push(B[i])}return t}};r(Mc,"StubAndKeyboardCache");var _e=Mc;var Oc=["World","Africa","Asia","Europe","South America","North America","Oceania","Central America","Middle East"],zc=["un","af","as","eu","sa","na","oc","ca","me"],GQ=RegExp("^(([\\.]/)|([\\.][\\.]/)|(/))|(:)");function br(Q,e){return e=e||"",Q&&!GQ.test(Q)?e+Q:Q}r(br,"configureFilePathing");var $s=class $s extends kt{constructor(t,n,s){var e=(...args)=>{super(...args)};if(typeof t!="string")if(t.id!==void 0){let B=t;B.id=Bt(B.id),e(B,s),this.KF=br(B.filename,n),this.mapRegion(B.languages)}else{let B=t;B.KI=Bt(B.KI),e(B,s),this.KF=br(B.KF,n),this.KP=B.KP,this.KR=B.KR,this.KRC=B.KRC;return}else e(Bt(t),n)}mapRegion(t){let n=t.region,s=0;if(typeof n=="number")n<1||n>9?s=0:s=n-1;else if(typeof n=="string"){let B=n.length==2?zc:Oc;for(let c=0;c<B.length;c++)if(n.toLowerCase()==B[c].toLowerCase()){s=c;break}}this.KR=Oc[s],this.KRC=zc[s]}get region(){return this.KR}get regionCode(){return this.KRC}get filename(){return this.KF}static toStubs(t,n,s){let B="";if(typeof t.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),t.languages||(t.languages=t.language),t?t.id?t.languages||(B="KeyboardStub has undefined languages"):B="KeyboardStub has undefined id":B="Stub undefined",B!="")return[{error:new Error(B)}];let c=[];Array.isArray(t.languages)?c=c.concat(t.languages):c.push(t.languages);let i=[];return c.forEach(l=>{let a=L(b({},t),{languages:l,language:void 0}),F=new $s(a,n,s);i.push(F)}),i}merge(t){this.KL||(this.KL=t.KL),this.KR||(this.KR=t.KR),this.KRC||(this.KRC=t.KRC),this.KN||(this.KN=t.KN),this.KF||(this.KF=t.KF),this.KFont||(this.KFont=t.KFont),this.KOskFont||(this.KOskFont=t.KOskFont),t._displayName&&(this._displayName||(this._displayName=t._displayName))}validateForCustomKeyboard(){return super.validateForCustomKeyboard()||!this.KF||!this.KR?new Error("To use a custom keyboard, you must specify file name, keyboard id, keyboard name, language, language code, and region."):null}};r($s,"KeyboardStub");var $=$s;function On(Q,e){if(e.length==0)return Promise.resolve(Q);if(Q.length==0)return Promise.reject(e);{let t=Q;return Promise.resolve(t.concat(e))}}r(On,"mergeAndResolveStubPromises");var hr="The Cloud API request timed out.",wc="Could not find a keyboard with that ID.",mr="The Cloud API failed to find an appropriate keyboard.",pQ="Error occurred while registering keyboards: ",XQ=r(function(Q){return Q+" keyboard not found."},"MISSING_KEYBOARD"),zn=class zn extends V.default{constructor(t,n){super();this.cloudResolutionPromises=new Map;this.languageFetchStarted=!1;this.registerFromCloud=r(t=>{let n=Number.parseInt(t.timerid),s;try{s=this._registerCore(t)}catch(B){s=new Error(pQ+B)}if(n){let B=this.cloudResolutionPromises.get(n);if(B)try{s instanceof Error?B.reject(s):B.resolve(s)}finally{this.cloudResolutionPromises.delete(n)}else{this.emit("unboundregister",s);return}}else{this.emit("unboundregister",s);return}},"registerFromCloud");this.requestEngine=t,this.pathConfig=n,this._languageListPromise=new J}get languageListPromise(){return this.languageFetchStarted||(this.languageFetchStarted=!0,this.keymanCloudRequest("",!0).catch(t=>{this.languageFetchStarted=!1,this._languageListPromise.reject(t),this._languageListPromise=new J})),this._languageListPromise.corePromise}keymanCloudRequest(t,n){let s="https://api.keyman.com/cloud/4.0/"+(arguments.length>1&&n?"languages":"keyboards"),B="?jsonp=keyman.register&languageidtype=bcp47&version="+O.CURRENT.toString(),c=s+B+t,{promise:i,queryId:l}=this.requestEngine.request(c);return this.cloudResolutionPromises.set(l,i),i.finally(()=>{this.cloudResolutionPromises.delete(l)}),i.corePromise}_registerCore(t){let n=t.options,s=n.fontBaseUri;if(this.pathConfig.fonts!=""?s=this.pathConfig.fonts:this.pathConfig.updateFontPath(s),typeof t.error=="string"){var B="";if(typeof t.options.keyboardid=="string"){let i=t.options.keyboardid;B=i.substring(0,1).toUpperCase()+i.substring(1)}return new Error(XQ(B))}if(typeof n=="undefined"||typeof n.context=="undefined")return new Error(wc);let c=[];if(n.context=="keyboard"){let i,l=t.keyboard;if(Array.isArray(l))for(i=0;i<l.length;i++)c=c.concat(zn.registerLanguagesForKeyboard(l[i],n,i));else c=c.concat(zn.registerLanguagesForKeyboard(l,n,0))}else if(n.context=="language"){let i=t.languages;return this._languageListPromise.resolve(i),i}return c}static registerLanguagesForKeyboard(t,n,s){let B="";if(typeof t=="undefined")return[];if(typeof n.keyboardid=="string"&&(B=n.keyboardid.split(",")[s]),Array.isArray(t))if(t.length==1||B.substr(-1,1)=="$"||B==""){let c=[];for(let i=0;i<t.length;i++)c=c.concat(this.registerLanguagesForKeyboard(t[i],n,s));return c}else{let c=0;for(let i=0;i<t.length;i++){let l=t[i].id.toLowerCase();if(l=="us"&&(l="english"),Array.isArray(t[i].languages)){let a=t[i].languages;for(let F=0;F<a.length;F++)if(l==a[F].name.toLowerCase()){c=i;break}}}return this.registerLanguagesForKeyboard(t[c],n,s)}else{let c=n.fontBaseUri||"",i=$.toStubs(t,n.keyboardBaseUri,c),l=B.split("@")[1];if(i.length==1&&typeof i[0].error!="undefined")throw i[0].error;return typeof l!="string"?i:(l=l.replace(/\$$/,""),[i.find(a=>a.KLC==l)])}}fetchCloudStubs(t){return E(this,null,function*(){if(t.length==0)return Promise.resolve([]);let n="&keyboardid=",s="";for(let c=0;c<t.length;c++)n=n+s+t[c].toString(),s=",";let B=[];try{let c=yield this.keymanCloudRequest(n,!1);return On(c,B)}catch(c){console.error(c);let i={error:c};return B.push(i),Promise.reject(B)}})}};r(zn,"CloudQueryEngine");var qe=zn;var Pc=class Pc{constructor(e,t){this.id=e,this.language=t}toString(){let e=this.id;return this.language?(e=e+"@"+this.language,this.version&&(e=e+"@"+this.version)):this.version&&(e=e+"@@"+this.version),e}};r(Pc,"CloudRequestEntry");var Kc=Pc;function Dc(Q,e){return{keyboard:{id:Q.id,name:Q.name},error:typeof e=="string"?new Error(e):e}}r(Dc,"convertToErrorStub");function xr(Q,e,t){let n=new Kc(Q,e);return t&&(n.version=t),n}r(xr,"toQuerySpecs");function Cr(Q,e,t){if(Q.getStub(t.id,t.language)==null){for(let n=0;n<e.length;n++)if(e[n].id==t.id&&e[n].language==t.language)return!1;return!0}else return!1}r(Cr,"isUniqueRequest");var jc=class jc{constructor(e,t,n){this.pathConfig=n,this.cache=new _e(e),this.cloudQueryEngine=new qe(t,this.pathConfig),this.cloudQueryEngine.on("unboundregister",s=>{Array.isArray(s)&&s.forEach(B=>{B instanceof $&&this.cache.addStub(B)})})}addKeyboardArray(e){let t=[],n=[],s=[],B=[],c=[];for(let a of e)if(typeof a=="string")a.length>0&&B.push(a);else if(a.KI||a.KL||a.KLC||a.KFont||a.KOskFont)s.push(new $(a));else{let F=a;if(typeof F.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),F.languages||(F.languages=F.language),typeof F.languages=="undefined"){let o="To use keyboard '"+F.id+"', you must specify languages.";c.push(Dc(F,o))}else if(Array.isArray(F.languages)){let o=$.toStubs(F,this.pathConfig.keyboards,this.pathConfig.fonts);for(let d of o)d instanceof $?s.push(d):c.push(d)}else{let o=F;s.push(new $(o,this.pathConfig.keyboards,this.pathConfig.fonts))}}for(let a of s)if(a.KF){let F=a.validateForCustomKeyboard();F?c.push(Dc(a,F)):t.push(a)}else n.push(a);let i=[];for(let a of n){if(!a.KI&&!a.KLC){c.push(Dc(a,"Cannot fetch keyboard information without a keyboard ID or language code."));continue}let F=xr(Mt(a.id),a.langId);Cr(this.cache,i,F)&&i.push(F)}for(let a of B){let F=a.split("@"),o=[""];F[0].toLowerCase()=="english"&&(F[0]="us"),F.length>1&&(o=F[1].split(","));for(let d=0;d<o.length;d++){if(d>0&&o[d]=="")continue;let U=xr(F[0],o[d],F[2]);Cr(this.cache,i,U)&&i.push(U)}}return t.forEach(a=>this.cache.addStub(a)),this.cloudQueryEngine.fetchCloudStubs(i.map(a=>a.toString())).then(a=>{for(let F of a)F instanceof $?(this.cache.addStub(F),t.push(F)):c.push(F);return[].concat(c).concat(t)})}addLanguageKeyboards(e){return E(this,null,function*(){let t=[],n=[];try{n=yield this.cloudQueryEngine.languageListPromise}catch(c){return console.error(c),t.push({error:c}),t}let s=n,B="";for(let c=0;c<e.length;c++){let i=e[c].toLowerCase(),l=i.substr(-1,1)=="$";l&&(i=i.substr(0,i.length-1));let a=!1;for(let F=0;F<s.length;F++)if(i==s[F].name.toLowerCase()){B!=""&&(B=B+","),B=B+"@"+s[F].id,l&&(B=B+"$"),a=!0;break}if(!a){let F={language:{name:i},error:new Error(this.alertLanguageUnavailable(i))};t.push(F)}}return B==""?Promise.reject(t):this.cloudQueryEngine.keymanCloudRequest("&keyboardid="+B,!1).then(c=>E(this,null,function*(){let i=yield On(c,t);for(let l of i)typeof l.error=="undefined"&&this.cache.addStub(l);return i}),c=>{console.error(c);let i={error:c};return t.push(i),Promise.reject(t)})})}fetchCloudCatalog(){return E(this,null,function*(){try{let e=yield this.cloudQueryEngine.keymanCloudRequest("",!1);return e.forEach(t=>this.cache.addStub(t)),e}catch(e){return Promise.reject([{error:e}])}})}alertLanguageUnavailable(e){return"No keyboards are available for "+e+". Does it have another language name?"}};r(jc,"KeyboardRequisitioner");var $e=jc;var _c=class _c{constructor(){this.registeredModels={};this.languageModelMap={}}modelForLanguage(e){return this.languageModelMap[e]}register(e){if(e.id=e.id.toLowerCase(),JSON.stringify(e)==JSON.stringify(this.registeredModels[e.id]))return;this.registeredModels[e.id]=e;let t=this;e.languages.forEach(function(n){if(!n){console.warn("Null / undefined language codes are not permitted for registration.");return}t.languageModelMap[n]=e})}unregister(e){let t;if(e=e.toLowerCase(),this.registeredModels[e])t=this.registeredModels[e],delete this.registeredModels[e];else return null;let n=this;return t.languages.forEach(function(s){n.languageModelMap[s].id==e&&delete n.languageModelMap[s]}),t}isRegistered(e){return!!this.registeredModels[e.id.toLowerCase()]}};r(_c,"ModelManager");var tn=_c;function tB(Q){let e=[];for(let t=0;t<Q.length;t++)e.push(Q[t]);return e}r(tB,"arrayFromNodeList");function A(Q){let e=document.createElement(Q);return e.style.userSelect="none",e.style.webkitUserSelect="none",e}r(A,"createUnselectableElement");var qc=class qc{constructor(e,t){this.fontStyleDefinitions={};this.linkedSheets=[];this.fontPromises=[];if(!e){let n=document.getElementsByTagName("HEAD");n.length>0?e=n[0]:e=document.body}this.linkNode=e,this.doCacheBusting=t||!1}get sheets(){return this.linkedSheets.map(e=>e.sheet)}linkStylesheet(e){if(!(e instanceof HTMLLinkElement)&&!e.innerHTML)return;let t=new J;e instanceof HTMLLinkElement?e.onload=()=>t.resolve():t.resolve(),this.linkedSheets.push({sheet:e,load:t}),this.linkNode.appendChild(e)}allLoadedPromise(){return E(this,null,function*(){let e=this.linkedSheets.map(t=>t.load.corePromise);Promise.allSettled?yield Promise.allSettled(e):yield Promise.all(e)})}addStyleSheetForFont(e,t,n){if(!e||typeof e.files=="undefined")return null;let s=e.family,B,c,i="",l="",a=[],F="";n||(n=Z.OperatingSystem.Other);let o=this.fontStyleDefinitions[n]=this.fontStyleDefinitions[n]||{};if(o[s]){let x=o[s];return x.parentNode||this.linkStylesheet(x),null}for(typeof e.files=="string"?a[0]=e.files:a=e.files,c=0;c<a.length;c++)a[c].toLowerCase().indexOf("data:font")==0&&(F=a[c]),a[c].toLowerCase().indexOf(".otf")>0&&(i=a[c]),a[c].toLowerCase().indexOf(".ttf")>0&&(i=a[c]),a[c].toLowerCase().indexOf(".woff")>0&&(l=a[c]);i!=""&&i.indexOf("/")<0&&(i=t+i),l!=""&&l.indexOf("/")<0&&(l=t+l);var d=`@font-face {
font-family:`+e.family+`;
font-style:normal;
font-weight:normal;
`;if(F){let G=F.substring(10,F.indexOf(";",10));d+=`src:url('${F}'), format('${G}');`}else n==Z.OperatingSystem.iOS?i!=""&&(this.doCacheBusting&&(i=this.cacheBust(i)),B="url('"+encodeURI(i)+"') format('truetype')"):(l!=""&&(B="url('"+encodeURI(l)+"') format('woff')"),i!=""&&(B="url('"+encodeURI(i)+"') format('truetype')"));if(!B)return null;d+="src:"+B+";",d=d+`
}
`;let U=Be(d);o[s]=U;let g=new FontFace(e.family,B).load(),y=r(()=>{this.fontPromises=this.fontPromises.filter(x=>x!=g)},"clearPromise");return this.fontPromises.push(g.then(y).catch(y)),this.linkStylesheet(U),U}cacheBust(e){return e+"?v="+new Date().getTime()}linkExternalSheet(e,t){try{if(!t&&document.querySelector("link[href="+JSON.stringify(e)+"]")!=null)return null}catch(s){return null}let n=document.createElement("link");return n.type="text/css",n.rel="stylesheet",n.href=e,this.linkStylesheet(n),n}unlink(e){let t=this.linkedSheets.findIndex(n=>n.sheet==e);return t>-1?(this.linkedSheets.splice(t,1)[0].load.resolve(),e.parentNode.removeChild(e),!0):!1}unlinkAll(){for(let e of this.linkedSheets){let t=e.sheet;t.parentNode&&t.parentNode.removeChild(t),e.load.resolve()}this.linkedSheets.splice(0,this.linkedSheets.length)}};r(qc,"StylesheetManager");var at=qc;function Be(Q){var e=document.createElement("style");return e.type="text/css",e.appendChild(document.createTextNode(Q)),e}r(Be,"createStyleSheet");function gt(){var Q;return typeof window.orientation!="undefined"?Q=window.orientation:typeof window.screen.orientation!="undefined"&&(Q=window.screen.orientation.angle),Q!==void 0?Math.abs(Q/90)==1:!1}r(gt,"landscapeView");var $c=class $c{constructor(e){this.name=e}load(e){return this.loadCookie(this.name,e||(t=>t))}save(e,t){this.saveCookie(this.name,e,t||(n=>n))}_loadRawCookies(){let e={};if(typeof document.cookie!="undefined"&&document.cookie!=""){let t=document.cookie.split(/;\s*/);for(let n=0;n<t.length;n++){let s=t[n].split("=");s.length==2&&(e[s[0]]=s[1])}}return e}loadCookie(e,t){let n={},B=this._loadRawCookies()[e];if(B){let c=decodeURIComponent(B).split(";");for(let i=0;i<c.length&&!(i==c.length-1&&!c[i]);i++){let l=c[i].split("=");if(l.length>1){let[a,F]=l;n[a]=t(F,a)}else n[l[0]]=""}}return n}saveCookie(e,t,n){let s="";for(let i in t)s+=i+"="+n(t[i],i)+";";let c=" path=/; expires="+new Date(new Date().valueOf()+1e3*60*60*24*30).toUTCString();document.cookie=`${e}=${encodeURIComponent(s)}; ${c}`}};r($c,"CookieSerializer");var ct=$c;function z(Q){var e;if(!Q)return 0;var t=Q.offsetLeft?Q.offsetLeft:0;if(e=Q,e.offsetParent){for(;e.offsetParent;)e=e.offsetParent,t+=e.offsetLeft;let s=e.ownerDocument;e.style.position=="fixed"&&s&&s.scrollingElement&&(t+=s.scrollingElement.scrollLeft)}if(e&&e.ownerDocument&&Q.ownerDocument!=window.document){var n=e.ownerDocument;if(n&&n.defaultView&&n.defaultView.frameElement)return t+z(n.defaultView.frameElement)-n.documentElement.scrollLeft}return t}r(z,"getAbsoluteX");function w(Q){var e;if(!Q)return 0;var t=Q.offsetTop?Q.offsetTop:0;if(e=Q,e.ownerDocument&&e instanceof e.ownerDocument.defaultView.HTMLElement){for(;e.offsetParent;)e=e.offsetParent,t+=e.offsetTop;let s=e.ownerDocument;e.style.position=="fixed"&&s&&s.scrollingElement&&(t+=s.scrollingElement.scrollTop)}if(e&&e.ownerDocument&&Q.ownerDocument!=window.document){var n=e.ownerDocument;if(n&&n.defaultView&&n.defaultView.frameElement)return t+w(n.defaultView.frameElement)}return t}r(w,"getAbsoluteY");var ti=class ti extends ct{constructor(e,t){super(`KeymanWeb_${e}_Option_${t}`)}load(){return super.load(decodeURIComponent)}save(e){super.save(e,encodeURIComponent)}};r(ti,"VarStoreSerializer");var eB=ti,ei=class ei{loadStore(e,t){return new eB(e,t).load()}saveStore(e,t,n){new eB(e,t).save(n)}};r(ei,"VariableStoreCookieSerializer");var wn=ei;var ni=class ni extends Yt{constructor(t,n,s){super(t,n,new wn);this.insertText=r((t,n)=>{this.resetContextCache(),this.engine.contextManager.insertText(this,t,n)},"insertText");this.KT=this.insertText;this.engine=n,this.stubNamespacer=s}preserveID(t){var n;if(document.currentScript)n=document.currentScript.id;else{var s=document.getElementsByTagName("script"),B=s[s.length-1];n=B.id}if(n)n.indexOf(Mt(t.KI))!=-1?t.KI=n:console.error("Error when registering keyboard:  current SCRIPT tag's ID does not match!");else return}registerKeyboard(t){super.registerKeyboard(t);let n=this.loadedKeyboard;this.preserveID(t),this.engine.config.deferForInitialization.then(()=>{this.engine.keyboardRequisitioner.cache.isFetchingKeyboard(n.id)||(this.engine.keyboardRequisitioner.cache.addKeyboard(n),this.loadedKeyboard=null)})}registerStub(t){var s;this.stubNamespacer&&this.stubNamespacer(t);let n=r(()=>{let B=this.engine.config.paths;return new $(t,B.keyboards,B.fonts)},"buildStub");if(!this.engine.config.deferForInitialization.isResolved)this.engine.config.deferForInitialization.then(()=>this.engine.keyboardRequisitioner.cache.addStub(n()));else{let B=n();if((s=this.engine.keyboardRequisitioner)!=null&&s.cache.findMatchingStub(B))return 1;this.engine.keyboardRequisitioner.cache.addStub(B)}return null}};r(ni,"KeyboardInterface");var Xe=ni;(function(){Xe.__publishShorthandAPI()})();var si=class si extends Oe{constructor(t,n){var e=(...args)=>{super(...args)};t&&t._jsGlobal!=window&&(t._jsGlobal.String=window.String),e(t||new be(window,Hn)),this.performCacheBusting=n||!1}loadKeyboardInternal(t,n,s){let B=new J;this.performCacheBusting&&(t=this.cacheBust(t));try{let c=this.harness._jsGlobal.document,i=c.createElement("script");s&&(i.id=s),c.head.appendChild(i),i.onerror=l=>{B.reject(n.missingError(l))},i.onload=()=>{if(this.harness.loadedKeyboard){let l=this.harness.loadedKeyboard;this.harness.loadedKeyboard=null,B.resolve(l)}else B.reject(n.scriptError())},B.then(()=>{i.remove()}).catch(()=>{i.remove()}),i.src=t}catch(c){return Promise.reject(c)}return B.corePromise}cacheBust(t){return t+"?v="+new Date().getTime()}};r(si,"DOMKeyboardLoader");var nB=si;var sB=class sB{constructor(e,t,n){this.left=e.getTextBeforeCaret(),this.startOfBuffer=this.left._kmwLength()<=t.leftContextCodePoints,this.startOfBuffer||(this.left=this.left._kmwSubstr(-t.leftContextCodePoints)),this.right=e.getTextAfterCaret(),this.endOfBuffer=this.right._kmwLength()<=t.rightContextCodePoints,this.endOfBuffer||(this.right=this.right._kmwSubstr(0,t.rightContextCodePoints)),this.casingForm=n=="shift"?"initial":n=="caps"?"upper":null}toMock(){let e=this.left._kmwLength();return new N(this.left+(this.right||""),e)}};r(sB,"ContextWindow"),sB.ENGINE_RULE_WINDOW={leftContextCodePoints:64,rightContextCodePoints:32};var Gt=sB;var Bi=class Bi{constructor(){this._promises=new Map}get length(){return this._promises.size}make(e,t,n){if(this._promises.has(e))return n(`Existing request with token ${e}`);this._promises.set(e,{reject:n,resolve:t})}keep(e,t){let n=this._promises.get(e);if(!n)throw new Error(`No promise associated with token: ${e}`);let s=n.resolve;return this._promises.delete(e),s(t)}break(e,t){let n=this._promises.get(e);if(!n)throw new Error(`No promise associated with token: ${e}`);this._promises.delete(e),n.reject(t)}};r(Bi,"PromiseStore");var ce=Bi;var ci=class ci{constructor(e,t,n){this._worker=t,this._worker.onmessage=this.onMessage.bind(this),this._declareLMLayerReady=null,this._predictPromises=new ce,this._wordbreakPromises=new ce,this._acceptPromises=new ce,this._revertPromises=new ce,this._nextToken=Number.MIN_SAFE_INTEGER,this.sendConfig(e,!!n)}sendConfig(e,t){this._worker.postMessage({message:"config",capabilities:e,testMode:t})}loadModel(e,t="file"){return new Promise((n,s)=>{this._declareLMLayerReady=n;let B={type:t};t=="file"?B.file=e:B.code=e,this._worker.postMessage({message:"load",source:B})})}unloadModel(){this._worker.postMessage({message:"unload"})}predict(e,t){let n=this._nextToken++;return new Promise((s,B)=>{this._predictPromises.make(n,s,B),this._worker.postMessage({message:"predict",token:n,transform:e,context:t})})}wordbreak(e){let t=this._nextToken++;return new Promise((n,s)=>{this._wordbreakPromises.make(t,n,s),this._worker.postMessage({message:"wordbreak",token:t,context:e})})}acceptSuggestion(e,t,n){let s=this._nextToken++;return new Promise((B,c)=>{this._acceptPromises.make(s,B,c),this._worker.postMessage({message:"accept",token:s,suggestion:e,context:t,postTransform:n})})}revertSuggestion(e,t){let n=this._nextToken++;return new Promise((s,B)=>{this._revertPromises.make(n,s,B),this._worker.postMessage({message:"revert",token:n,reversion:e,context:t})})}resetContext(e){this._worker.postMessage({message:"reset-context",context:e})}onMessage(e){let t=e.data;if(t.message==="error")console.error(t.log),t.error&&console.error(t.error);else if(t.message==="ready")this._declareLMLayerReady(e.data.configuration);else if(t.message==="suggestions")this._predictPromises.keep(t.token,t.suggestions);else if(t.message==="currentword")this._wordbreakPromises.keep(t.token,t.word);else if(t.message==="postaccept")this._acceptPromises.keep(t.token,t.reversion);else if(t.message==="postrevert")this._revertPromises.keep(t.token,t.suggestions);else throw new Error(`Message not implemented: ${t.message}`)}shutdown(){this._worker.terminate()}};r(ci,"LMLayer");var en=ci;function BB(Q){return Q}r(BB,"unwrap");var Gr=`"use strict";(()=>{var vr=Object.defineProperty,Ue=Object.defineProperties;var qe=Object.getOwnPropertyDescriptors;var ye=Object.getOwnPropertySymbols;var Ke=Object.prototype.hasOwnProperty,Qe=Object.prototype.propertyIsEnumerable;var Pe=(n,r)=>{if(r=Symbol[n])return r;throw Error("Symbol."+n+" is not defined")};var We=(n,r,e)=>r in n?vr(n,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[r]=e,b=(n,r)=>{for(var e in r||(r={}))Ke.call(r,e)&&We(n,e,r[e]);if(ye)for(var e of ye(r))Qe.call(r,e)&&We(n,e,r[e]);return n},Mr=(n,r)=>Ue(n,qe(r)),l=(n,r)=>vr(n,"name",{value:r,configurable:!0});var Nr=(n,r)=>{for(var e in r)vr(n,e,{get:r[e],enumerable:!0})};var N=(n,r,e)=>new Promise((t,o)=>{var a=d=>{try{p(e.next(d))}catch(s){o(s)}},i=d=>{try{p(e.throw(d))}catch(s){o(s)}},p=d=>d.done?t(d.value):Promise.resolve(d.value).then(a,i);p((e=e.apply(n,r)).next())}),Ar=function(n,r){this[0]=n,this[1]=r},ce=(n,r,e)=>{var t=(i,p,d,s)=>{try{var x=e[i](p),u=(p=x.value)instanceof Ar,h=x.done;Promise.resolve(u?p[0]:p).then(k=>u?t(i==="return"?i:"next",p[1]?{done:k.done,value:k.value}:k,d,s):d({value:k,done:h})).catch(k=>t("throw",k,d,s))}catch(k){s(k)}},o=i=>a[i]=p=>new Promise((d,s)=>t(i,p,d,s)),a={};return e=e.apply(n,r),a[Symbol.asyncIterator]=()=>a,o("next"),o("throw"),o("return"),a};var me=(n,r,e)=>(r=n[Pe("asyncIterator")])?r.call(n):(n=n[Pe("iterator")](),r={},e=(t,o)=>(o=n[t])&&(r[t]=a=>new Promise((i,p,d)=>(a=o.call(n,a),d=a.done,Promise.resolve(a.value).then(s=>i({value:s,done:d}),p)))),e("next"),e("return"),r);function w(){String.kmwFromCharCode=function(n){var r=[],e;for(e=0;e<arguments.length;e++){var t=Number(arguments[e]);if(!isFinite(t)||t<0||t>1114111||Math.floor(t)!==t)throw new RangeError("Invalid code point "+t);t<65536?r.push(t):(t-=65536,r.push((t>>10)+55296),r.push(t%1024+56320))}return String.fromCharCode.apply(void 0,r)},String.prototype.kmwCharCodeAt=function(n){var r=String(this),e=0;if(n<0||n>=r.length)return NaN;for(var t=0;t<n;t++)if(e=r.kmwNextChar(e),e===null)return NaN;var o=r.charCodeAt(e);if(o>=55296&&o<=56319&&r.length>e+1){var a=r.charCodeAt(e+1);if(a>=56320&&a<=57343)return(o-55296<<10)+(a-56320)+65536}return o},String.prototype.kmwIndexOf=function(n,r){var e=String(this),t=e.indexOf(n,r);if(t<0)return t;for(var o=0,a=0;a!==null&&a<t;a=e.kmwNextChar(a))o++;return o},String.prototype.kmwLastIndexOf=function(n,r){var e=String(this),t=e.lastIndexOf(n,r);if(t<0)return t;for(var o=0,a=0;a!==null&&a<t;a=e.kmwNextChar(a))o++;return o},String.prototype.kmwLength=function(){var n=String(this);if(n.length==0)return 0;for(var r=0,e=0;e!==null;r++)e=n.kmwNextChar(e);return r},String.prototype.kmwSlice=function(n,r){var e=String(this),t=e.kmwCodePointToCodeUnit(n),o=e.kmwCodePointToCodeUnit(r);return t===null||o===null?"":e.slice(t,o)},String.prototype.kmwSubstr=function(n,r){var e=String(this);n<0&&(n=e.kmwLength()+n),n<0&&(n=0);var t=e.kmwCodePointToCodeUnit(n),o=t;if(t===null)return"";if(arguments.length<2)o=e.length;else for(var a=0;a<r;a++)o=e.kmwNextChar(o);return o===null?e.substring(t):e.substring(t,o)},String.prototype.kmwSubstring=function(n,r){var e=String(this),t,o;if(typeof r=="undefined")t=e.kmwCodePointToCodeUnit(n),o=e.length;else{if(n>r){var a=n;n=r,r=a}t=e.kmwCodePointToCodeUnit(n),o=e.kmwCodePointToCodeUnit(r)}return(isNaN(t)||t===null)&&(t=0),(isNaN(o)||o===null)&&(o=e.length),e.substring(t,o)},String.prototype.kmwNextChar=function(n){var r=String(this);if(n===null||n<0||n>=r.length-1)return null;var e=r.charCodeAt(n);if(e>=55296&&e<=56319&&r.length>n+1){var t=r.charCodeAt(n+1);if(t>=56320&&t<=57343)return n==r.length-2?null:n+2}return n+1},String.prototype.kmwPrevChar=function(n){var r=String(this);if(n==null||n<=0||n>r.length)return null;var e=r.charCodeAt(n-1);if(e>=56320&&e<=57343&&n>1){var t=r.charCodeAt(n-2);if(t>=55296&&t<=56319)return n-2}return n-1},String.prototype.kmwCodePointToCodeUnit=function(n){if(n===null)return null;var r=String(this),e=0;if(n<0){e=r.length;for(var t=0;t>n;t--)e=r.kmwPrevChar(e);return e}if(n==r.kmwLength())return r.length;for(var t=0;t<n;t++)e=r.kmwNextChar(e);return e},String.prototype.kmwCodeUnitToCodePoint=function(n){var r=String(this);return n===null?null:n==0?0:n<0?r.substr(n).kmwLength():r.substr(0,n).kmwLength()},String.prototype.kmwCharAt=function(n){var r=String(this);return n>=0?r.kmwSubstr(n,1):""},String.prototype.kmwBMPNextChar=function(n){var r=String(this);return n<0||n>=r.length-1?null:n+1},String.prototype.kmwBMPPrevChar=function(n){var r=String(this);return n<=0||n>r.length?null:n-1},String.prototype.kmwBMPCodePointToCodeUnit=function(n){return n},String.prototype.kmwBMPCodeUnitToCodePoint=function(n){return n},String.prototype.kmwBMPLength=function(){var n=String(this);return n.length},String.prototype.kmwBMPSubstr=function(n,r){var e=String(this);return n>-1?e.substr(n,r):e.substr(e.length+n,-n)},String.kmwEnableSupplementaryPlane=function(n){var r=String.prototype;String._kmwFromCharCode=n?String.kmwFromCharCode:String.fromCharCode,r._kmwCharAt=n?r.kmwCharAt:r.charAt,r._kmwCharCodeAt=n?r.kmwCharCodeAt:r.charCodeAt,r._kmwIndexOf=n?r.kmwIndexOf:r.indexOf,r._kmwLastIndexOf=n?r.kmwLastIndexOf:r.lastIndexOf,r._kmwSlice=n?r.kmwSlice:r.slice,r._kmwSubstring=n?r.kmwSubstring:r.substring,r._kmwSubstr=n?r.kmwSubstr:r.kmwBMPSubstr,r._kmwLength=n?r.kmwLength:r.kmwBMPLength,r._kmwNextChar=n?r.kmwNextChar:r.kmwBMPNextChar,r._kmwPrevChar=n?r.kmwPrevChar:r.kmwBMPPrevChar,r._kmwCodePointToCodeUnit=n?r.kmwCodePointToCodeUnit:r.kmwBMPCodePointToCodeUnit,r._kmwCodeUnitToCodePoint=n?r.kmwCodeUnitToCodePoint:r.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}l(w,"extendString");w();var Ir=class Ir{constructor(r){this._isFulfilled=!1;this._isRejected=!1;this._promise=new Promise((e,t)=>{this._resolve=o=>{this._isFulfilled=!0,e(o)},this._reject=o=>{this._isRejected=!0,t(o)},r&&r(this._resolve,this._reject)})}get resolve(){return this._resolve}get reject(){return this._reject}get isFulfilled(){return this._isFulfilled}get isRejected(){return this._isRejected}get isResolved(){return this.isFulfilled||this.isRejected}then(r,e){return this._promise.then(r,e)}catch(r){return this._promise.catch(r)}finally(r){return this._promise.finally(r)}get corePromise(){return this._promise}};l(Ir,"ManagedPromise");var or=Ir;var _r=class _r extends or{constructor(e){let t=null;super(i=>{t=setTimeout(()=>{this.isResolved||i(!0)},e)});this.timerHandle=t;let o=this._resolve;this._resolve=i=>{clearTimeout(this.timerHandle),o(i)};let a=this._reject;this._reject=i=>{clearTimeout(this.timerHandle),a(i)}}};l(_r,"TimeoutPromise");var ar=_r,Rr=l(n=>new ar(n).corePromise,"timedPromise");var F=class F{constructor(r,e){if(typeof r!="function"){this.comparator=r.comparator,this.heap=[].concat(r.heap);return}let t=r;this.comparator=t,this.heap=(e!=null?e:[]).slice(0),this.heapify()}static leftChildIndex(r){return r*2+1}static rightChildIndex(r){return r*2+2}static parentIndex(r){return Math.floor((r-1)/2)}heapify(r,e){if(r==null||e==null){this.heapify(0,this.count-1);return}let t=[],o=-1;for(let a=e;a>=r;a--){let i=F.parentIndex(a);this.siftDown(a)&&i<r&&o!=i&&(t.push(i),o=i)}for(o=-1;t.length>0;){let a=t.shift(),i=F.parentIndex(a);this.siftDown(a)&&i>=0&&o!=i&&(t.push(i),o=i)}}get count(){return this.heap.length}peek(){return this.heap[0]}enqueue(r){let e=this.heap.length;this.heap.push(r);let t=F.parentIndex,o=t(e);for(;e!==0&&this.comparator(this.heap[e],this.heap[o])<0;){let a=this.heap[e];this.heap[e]=this.heap[o],this.heap[o]=a,e=o,o=t(e)}}enqueueAll(r){if(r.length==0)return;let e=this.count;this.heap=this.heap.concat(r);let t=F.parentIndex(e);this.heapify(t>=0?t:0,F.parentIndex(this.count-1))}dequeue(){if(this.count==0)return;let r=this.heap[0],e=this.heap.pop();return this.heap.length>0&&(this.heap[0]=e,this.siftDown(0)),r}siftDown(r){let e=F.leftChildIndex(r),t=F.rightChildIndex(r),o=r;if(e<this.heap.length&&this.comparator(this.heap[e],this.heap[o])<0&&(o=e),t<this.heap.length&&this.comparator(this.heap[t],this.heap[o])<0&&(o=t),o!=r){let a=this.heap[r];return this.heap[r]=this.heap[o],this.heap[o]=a,this.siftDown(o),!0}else return!1}toArray(){return this.heap.slice(0)}};l(F,"PriorityQueue");var f=F;var Cr={};Nr(Cr,{DummyModel:()=>Ce,QuoteBehavior:()=>j,SENTINEL_CODE_UNIT:()=>D,TrieModel:()=>sr,applyTransform:()=>y,buildMergedTransform:()=>I,defaultApplyCasing:()=>Er,getLastPreCaretToken:()=>dr,isHighSurrogate:()=>R,isLowSurrogate:()=>Ur,isSentinel:()=>fr,tokenize:()=>ir,transformToSuggestion:()=>_,wordbreak:()=>X});w();var D="\\uFDD0";function y(n,r){var x,u;let e=r.left||"",t=e.kmwLength(),o=t<n.deleteLeft?t:n.deleteLeft,a=e.kmwSubstr(0,t-o)+(n.insert||""),i=r.right||"",p=i.kmwLength(),d=p<((x=n.deleteRight)!=null?x:0)?p:(u=n.deleteRight)!=null?u:0,s=i.kmwSubstr(d);return{left:a,right:s,startOfBuffer:r.startOfBuffer,endOfBuffer:r.endOfBuffer,casingForm:r.casingForm}}l(y,"applyTransform");function I(n,r){let e=n.insert,t=r.deleteLeft;if(r.deleteLeft){let o=n.insert.kmwLength();o<=r.deleteLeft?(e="",t=r.deleteLeft-o):(e=n.insert.kmwSubstr(0,o-r.deleteLeft),t=0)}return{insert:e+r.insert,deleteLeft:n.deleteLeft+t,deleteRight:(n.deleteRight||0)+(r.deleteRight||0)}}l(I,"buildMergedTransform");function R(n){return typeof n=="string"&&(n=n.charCodeAt(0)),n>=55296&&n<=56319}l(R,"isHighSurrogate");function Ur(n){return typeof n=="string"&&(n=n.charCodeAt(0)),n>=56320&&n<=57343}l(Ur,"isLowSurrogate");function fr(n){return n==D}l(fr,"isSentinel");function _(n,r){let e={transform:n,displayAs:n.insert};return n.id!==void 0&&(e.transformId=n.id),(r===0||r)&&(e.p=r),e}l(_,"transformToSuggestion");function Er(n,r){switch(n){case"lower":return r.toLowerCase();case"upper":return r.toUpperCase();case"initial":let e=1;return r.length>1&&R(r.charAt(0))&&Ur(r.charCodeAt(1))&&(e=2),r.substring(0,e).toUpperCase().concat(r.substring(e))}}l(Er,"defaultApplyCasing");var nr=(t=>(t.noQuotes="no-quotes",t.useQuotes="use-quotes",t.default="default-quotes",t))(nr||{});(r=>{function n(e,t,o,a){if(a=="default-quotes"||!a)throw"Specified quote behavior may be ambiguous - default behavior not specified (may not be .default)";switch(e=="default-quotes"&&(e=a),e){case"no-quotes":return t;case"use-quotes":let{open:i,close:p}=o.quotesForKeepSuggestion;return i+t+p;default:throw"Unsupported quote behavior state detected; implementation missing!"}}r.apply=n,l(n,"apply")})(nr||(nr={}));var j=nr;function ir(n,r,e){let t=(e==null?void 0:e.rejoins)||["'"];r=r||{left:void 0,startOfBuffer:void 0,endOfBuffer:void 0};let o=n(r.left||"")||[],a=n(r.right||"")||[],i={left:[],right:[],caretSplitsToken:!1},p=0;for(;o.length>0;){let x=o[0];x.start!=p?(i.left.push({text:r.left.substring(p,x.start),isWhitespace:!0}),p=x.start):(o.shift(),i.left.push({text:x.text}),p=x.end)}r.left!=null&&p!=r.left.length&&(i.left.push({text:r.left.substring(p,r.left.length),isWhitespace:!0}),p=r.left.length);let d=i.left.length;if(d>1){let x=i.left[d-2],u=i.left[d-1];!x.isWhitespace&&!u.isWhitespace&&t.indexOf(u.text)!=-1&&(i.left.pop(),i.left.pop(),i.left.push({text:x.text+u.text}),d--)}p=0;let s=!0;for(;a.length>0;){let x=a[0];if(x.start!=p)i.right.push({text:r.right.substring(p,x.start),isWhitespace:!0}),p=x.start;else{let u=i.left[d-1];u&&s&&!u.isWhitespace&&n(u.text+x.text).length==1&&(i.caretSplitsToken=!0),a.shift(),i.right.push({text:x.text}),p=x.end}s=!1}return r.right&&p!=r.right.length&&(i.right.push({text:r.right.substring(p,r.right.length),isWhitespace:!0}),p=r.right.length),i}l(ir,"tokenize");function dr(n,r){let e=ir(n,r);if(e.left.length>0){let t=e.left.pop();return t.isWhitespace?"":t.text}return""}l(dr,"getLastPreCaretToken");function X(n,r){return dr(n,r)}l(X,"wordbreak");var pr={};Nr(pr,{ascii:()=>Qr,default:()=>v,defaultWordbreaker:()=>v,placeholder:()=>qr});function qr(n){let r=0;return n.split(/\\s+/).map(e=>{let t={start:r,end:r+e.length,text:e,length:e.length};return r=t.end,t})}l(qr,"placeholder");function Qr(n){let r=/[A-Za-z0-9']+/g,e=[],t;for(;(t=r.exec(n))!==null;)e.push(new Kr(t[0],t.index));return e}l(Qr,"ascii");var Hr=class Hr{constructor(r,e){this.text=r,this.start=e}get length(){return this.text.length}get end(){return this.start+this.text.length}};l(Hr,"RegExpDerivedSpan");var Kr=Hr;var Ae=["Other","LF","Newline","CR","WSegSpace","Double_Quote","Single_Quote","MidNum","MidNumLet","Numeric","MidLetter","ALetter","ExtendNumLet","Format","Extend","Hebrew_Letter","ZWJ","Katakana","Regional_Indicator","sot","eot"];var gr=[[0,0],[10,1],[11,2],[13,3],[14,0],[32,4],[33,0],[34,5],[35,0],[39,6],[40,0],[44,7],[45,0],[46,8],[47,0],[48,9],[58,10],[59,7],[60,0],[65,11],[91,0],[95,12],[96,0],[97,11],[123,0],[133,2],[134,0],[170,11],[171,0],[173,13],[174,0],[181,11],[182,0],[183,10],[184,0],[186,11],[187,0],[192,11],[215,0],[216,11],[247,0],[248,11],[728,0],[734,11],[768,14],[880,11],[885,0],[886,11],[888,0],[890,11],[894,7],[895,11],[896,0],[902,11],[903,10],[904,11],[907,0],[908,11],[909,0],[910,11],[930,0],[931,11],[1014,0],[1015,11],[1154,0],[1155,14],[1162,11],[1328,0],[1329,11],[1367,0],[1369,11],[1373,0],[1374,11],[1375,10],[1376,11],[1417,7],[1418,11],[1419,0],[1425,14],[1470,0],[1471,14],[1472,0],[1473,14],[1475,0],[1476,14],[1478,0],[1479,14],[1480,0],[1488,15],[1515,0],[1519,15],[1523,11],[1524,10],[1525,0],[1536,13],[1542,0],[1548,7],[1550,0],[1552,14],[1563,0],[1564,13],[1565,0],[1568,11],[1611,14],[1632,9],[1642,0],[1643,9],[1644,7],[1645,0],[1646,11],[1648,14],[1649,11],[1748,0],[1749,11],[1750,14],[1757,13],[1758,0],[1759,14],[1765,11],[1767,14],[1769,0],[1770,14],[1774,11],[1776,9],[1786,11],[1789,0],[1791,11],[1792,0],[1807,13],[1808,11],[1809,14],[1810,11],[1840,14],[1867,0],[1869,11],[1958,14],[1969,11],[1970,0],[1984,9],[1994,11],[2027,14],[2036,11],[2038,0],[2040,7],[2041,0],[2042,11],[2043,0],[2045,14],[2046,0],[2048,11],[2070,14],[2074,11],[2075,14],[2084,11],[2085,14],[2088,11],[2089,14],[2094,0],[2112,11],[2137,14],[2140,0],[2144,11],[2155,0],[2208,11],[2229,0],[2230,11],[2248,0],[2259,14],[2274,13],[2275,14],[2308,11],[2362,14],[2365,11],[2366,14],[2384,11],[2385,14],[2392,11],[2402,14],[2404,0],[2406,9],[2416,0],[2417,11],[2433,14],[2436,0],[2437,11],[2445,0],[2447,11],[2449,0],[2451,11],[2473,0],[2474,11],[2481,0],[2482,11],[2483,0],[2486,11],[2490,0],[2492,14],[2493,11],[2494,14],[2501,0],[2503,14],[2505,0],[2507,14],[2510,11],[2511,0],[2519,14],[2520,0],[2524,11],[2526,0],[2527,11],[2530,14],[2532,0],[2534,9],[2544,11],[2546,0],[2556,11],[2557,0],[2558,14],[2559,0],[2561,14],[2564,0],[2565,11],[2571,0],[2575,11],[2577,0],[2579,11],[2601,0],[2602,11],[2609,0],[2610,11],[2612,0],[2613,11],[2615,0],[2616,11],[2618,0],[2620,14],[2621,0],[2622,14],[2627,0],[2631,14],[2633,0],[2635,14],[2638,0],[2641,14],[2642,0],[2649,11],[2653,0],[2654,11],[2655,0],[2662,9],[2672,14],[2674,11],[2677,14],[2678,0],[2689,14],[2692,0],[2693,11],[2702,0],[2703,11],[2706,0],[2707,11],[2729,0],[2730,11],[2737,0],[2738,11],[2740,0],[2741,11],[2746,0],[2748,14],[2749,11],[2750,14],[2758,0],[2759,14],[2762,0],[2763,14],[2766,0],[2768,11],[2769,0],[2784,11],[2786,14],[2788,0],[2790,9],[2800,0],[2809,11],[2810,14],[2816,0],[2817,14],[2820,0],[2821,11],[2829,0],[2831,11],[2833,0],[2835,11],[2857,0],[2858,11],[2865,0],[2866,11],[2868,0],[2869,11],[2874,0],[2876,14],[2877,11],[2878,14],[2885,0],[2887,14],[2889,0],[2891,14],[2894,0],[2901,14],[2904,0],[2908,11],[2910,0],[2911,11],[2914,14],[2916,0],[2918,9],[2928,0],[2929,11],[2930,0],[2946,14],[2947,11],[2948,0],[2949,11],[2955,0],[2958,11],[2961,0],[2962,11],[2966,0],[2969,11],[2971,0],[2972,11],[2973,0],[2974,11],[2976,0],[2979,11],[2981,0],[2984,11],[2987,0],[2990,11],[3002,0],[3006,14],[3011,0],[3014,14],[3017,0],[3018,14],[3022,0],[3024,11],[3025,0],[3031,14],[3032,0],[3046,9],[3056,0],[3072,14],[3077,11],[3085,0],[3086,11],[3089,0],[3090,11],[3113,0],[3114,11],[3130,0],[3133,11],[3134,14],[3141,0],[3142,14],[3145,0],[3146,14],[3150,0],[3157,14],[3159,0],[3160,11],[3163,0],[3168,11],[3170,14],[3172,0],[3174,9],[3184,0],[3200,11],[3201,14],[3204,0],[3205,11],[3213,0],[3214,11],[3217,0],[3218,11],[3241,0],[3242,11],[3252,0],[3253,11],[3258,0],[3260,14],[3261,11],[3262,14],[3269,0],[3270,14],[3273,0],[3274,14],[3278,0],[3285,14],[3287,0],[3294,11],[3295,0],[3296,11],[3298,14],[3300,0],[3302,9],[3312,0],[3313,11],[3315,0],[3328,14],[3332,11],[3341,0],[3342,11],[3345,0],[3346,11],[3387,14],[3389,11],[3390,14],[3397,0],[3398,14],[3401,0],[3402,14],[3406,11],[3407,0],[3412,11],[3415,14],[3416,0],[3423,11],[3426,14],[3428,0],[3430,9],[3440,0],[3450,11],[3456,0],[3457,14],[3460,0],[3461,11],[3479,0],[3482,11],[3506,0],[3507,11],[3516,0],[3517,11],[3518,0],[3520,11],[3527,0],[3530,14],[3531,0],[3535,14],[3541,0],[3542,14],[3543,0],[3544,14],[3552,0],[3558,9],[3568,0],[3570,14],[3572,0],[3633,14],[3634,0],[3636,14],[3643,0],[3655,14],[3663,0],[3664,9],[3674,0],[3761,14],[3762,0],[3764,14],[3773,0],[3784,14],[3790,0],[3792,9],[3802,0],[3840,11],[3841,0],[3864,14],[3866,0],[3872,9],[3882,0],[3893,14],[3894,0],[3895,14],[3896,0],[3897,14],[3898,0],[3902,14],[3904,11],[3912,0],[3913,11],[3949,0],[3953,14],[3973,0],[3974,14],[3976,11],[3981,14],[3992,0],[3993,14],[4029,0],[4038,14],[4039,0],[4139,14],[4159,0],[4160,9],[4170,0],[4182,14],[4186,0],[4190,14],[4193,0],[4194,14],[4197,0],[4199,14],[4206,0],[4209,14],[4213,0],[4226,14],[4238,0],[4239,14],[4240,9],[4250,14],[4254,0],[4256,11],[4294,0],[4295,11],[4296,0],[4301,11],[4302,0],[4304,11],[4347,0],[4348,11],[4681,0],[4682,11],[4686,0],[4688,11],[4695,0],[4696,11],[4697,0],[4698,11],[4702,0],[4704,11],[4745,0],[4746,11],[4750,0],[4752,11],[4785,0],[4786,11],[4790,0],[4792,11],[4799,0],[4800,11],[4801,0],[4802,11],[4806,0],[4808,11],[4823,0],[4824,11],[4881,0],[4882,11],[4886,0],[4888,11],[4955,0],[4957,14],[4960,0],[4992,11],[5008,0],[5024,11],[5110,0],[5112,11],[5118,0],[5121,11],[5741,0],[5743,11],[5760,4],[5761,11],[5787,0],[5792,11],[5867,0],[5870,11],[5881,0],[5888,11],[5901,0],[5902,11],[5906,14],[5909,0],[5920,11],[5938,14],[5941,0],[5952,11],[5970,14],[5972,0],[5984,11],[5997,0],[5998,11],[6001,0],[6002,14],[6004,0],[6068,14],[6100,0],[6109,14],[6110,0],[6112,9],[6122,0],[6155,14],[6158,13],[6159,0],[6160,9],[6170,0],[6176,11],[6265,0],[6272,11],[6277,14],[6279,11],[6313,14],[6314,11],[6315,0],[6320,11],[6390,0],[6400,11],[6431,0],[6432,14],[6444,0],[6448,14],[6460,0],[6470,9],[6480,0],[6608,9],[6618,0],[6656,11],[6679,14],[6684,0],[6741,14],[6751,0],[6752,14],[6781,0],[6783,14],[6784,9],[6794,0],[6800,9],[6810,0],[6832,14],[6849,0],[6912,14],[6917,11],[6964,14],[6981,11],[6988,0],[6992,9],[7002,0],[7019,14],[7028,0],[7040,14],[7043,11],[7073,14],[7086,11],[7088,9],[7098,11],[7142,14],[7156,0],[7168,11],[7204,14],[7224,0],[7232,9],[7242,0],[7245,11],[7248,9],[7258,11],[7294,0],[7296,11],[7305,0],[7312,11],[7355,0],[7357,11],[7360,0],[7376,14],[7379,0],[7380,14],[7401,11],[7405,14],[7406,11],[7412,14],[7413,11],[7415,14],[7418,11],[7419,0],[7424,11],[7616,14],[7674,0],[7675,14],[7680,11],[7958,0],[7960,11],[7966,0],[7968,11],[8006,0],[8008,11],[8014,0],[8016,11],[8024,0],[8025,11],[8026,0],[8027,11],[8028,0],[8029,11],[8030,0],[8031,11],[8062,0],[8064,11],[8117,0],[8118,11],[8125,0],[8126,11],[8127,0],[8130,11],[8133,0],[8134,11],[8141,0],[8144,11],[8148,0],[8150,11],[8156,0],[8160,11],[8173,0],[8178,11],[8181,0],[8182,11],[8189,0],[8192,4],[8199,0],[8200,4],[8203,0],[8204,14],[8205,16],[8206,13],[8208,0],[8216,8],[8218,0],[8228,8],[8229,0],[8231,10],[8232,2],[8234,13],[8239,12],[8240,0],[8255,12],[8257,0],[8260,7],[8261,0],[8276,12],[8277,0],[8287,4],[8288,13],[8293,0],[8294,13],[8304,0],[8305,11],[8306,0],[8319,11],[8320,0],[8336,11],[8349,0],[8400,14],[8433,0],[8450,11],[8451,0],[8455,11],[8456,0],[8458,11],[8468,0],[8469,11],[8470,0],[8473,11],[8478,0],[8484,11],[8485,0],[8486,11],[8487,0],[8488,11],[8489,0],[8490,11],[8494,0],[8495,11],[8506,0],[8508,11],[8512,0],[8517,11],[8522,0],[8526,11],[8527,0],[8544,11],[8585,0],[9398,11],[9450,0],[11264,11],[11311,0],[11312,11],[11359,0],[11360,11],[11493,0],[11499,11],[11503,14],[11506,11],[11508,0],[11520,11],[11558,0],[11559,11],[11560,0],[11565,11],[11566,0],[11568,11],[11624,0],[11631,11],[11632,0],[11647,14],[11648,11],[11671,0],[11680,11],[11687,0],[11688,11],[11695,0],[11696,11],[11703,0],[11704,11],[11711,0],[11712,11],[11719,0],[11720,11],[11727,0],[11728,11],[11735,0],[11736,11],[11743,0],[11744,14],[11776,0],[11823,11],[11824,0],[12288,4],[12289,0],[12293,11],[12294,0],[12330,14],[12336,0],[12337,17],[12342,0],[12347,11],[12349,0],[12441,14],[12443,17],[12445,0],[12448,17],[12539,0],[12540,17],[12544,0],[12549,11],[12592,0],[12593,11],[12687,0],[12704,11],[12736,0],[12784,17],[12800,0],[13008,17],[13055,0],[13056,17],[13144,0],[40960,11],[42125,0],[42192,11],[42238,0],[42240,11],[42509,0],[42512,11],[42528,9],[42538,11],[42540,0],[42560,11],[42607,14],[42611,0],[42612,14],[42622,0],[42623,11],[42654,14],[42656,11],[42736,14],[42738,0],[42760,11],[42944,0],[42946,11],[42955,0],[42997,11],[43010,14],[43011,11],[43014,14],[43015,11],[43019,14],[43020,11],[43043,14],[43048,0],[43052,14],[43053,0],[43072,11],[43124,0],[43136,14],[43138,11],[43188,14],[43206,0],[43216,9],[43226,0],[43232,14],[43250,11],[43256,0],[43259,11],[43260,0],[43261,11],[43263,14],[43264,9],[43274,11],[43302,14],[43310,0],[43312,11],[43335,14],[43348,0],[43360,11],[43389,0],[43392,14],[43396,11],[43443,14],[43457,0],[43471,11],[43472,9],[43482,0],[43493,14],[43494,0],[43504,9],[43514,0],[43520,11],[43561,14],[43575,0],[43584,11],[43587,14],[43588,11],[43596,14],[43598,0],[43600,9],[43610,0],[43643,14],[43646,0],[43696,14],[43697,0],[43698,14],[43701,0],[43703,14],[43705,0],[43710,14],[43712,0],[43713,14],[43714,0],[43744,11],[43755,14],[43760,0],[43762,11],[43765,14],[43767,0],[43777,11],[43783,0],[43785,11],[43791,0],[43793,11],[43799,0],[43808,11],[43815,0],[43816,11],[43823,0],[43824,11],[43882,0],[43888,11],[44003,14],[44011,0],[44012,14],[44014,0],[44016,9],[44026,0],[44032,11],[55204,0],[55216,11],[55239,0],[55243,11],[55292,0],[64256,11],[64263,0],[64275,11],[64280,0],[64285,15],[64286,14],[64287,15],[64297,0],[64298,15],[64311,0],[64312,15],[64317,0],[64318,15],[64319,0],[64320,15],[64322,0],[64323,15],[64325,0],[64326,15],[64336,11],[64434,0],[64467,11],[64830,0],[64848,11],[64912,0],[64914,11],[64968,0],[65008,11],[65020,0],[65024,14],[65040,7],[65041,0],[65043,10],[65044,7],[65045,0],[65056,14],[65072,0],[65075,12],[65077,0],[65101,12],[65104,7],[65105,0],[65106,8],[65107,0],[65108,7],[65109,10],[65110,0],[65136,11],[65141,0],[65142,11],[65277,0],[65279,13],[65280,0],[65287,8],[65288,0],[65292,7],[65293,0],[65294,8],[65295,0],[65296,9],[65306,10],[65307,7],[65308,0],[65313,11],[65339,0],[65343,12],[65344,0],[65345,11],[65371,0],[65382,17],[65438,14],[65440,11],[65471,0],[65474,11],[65480,0],[65482,11],[65488,0],[65490,11],[65496,0],[65498,11],[65501,0],[65529,13],[65532,0],[65536,11],[65548,0],[65549,11],[65575,0],[65576,11],[65595,0],[65596,11],[65598,0],[65599,11],[65614,0],[65616,11],[65630,0],[65664,11],[65787,0],[65856,11],[65909,0],[66045,14],[66046,0],[66176,11],[66205,0],[66208,11],[66257,0],[66272,14],[66273,0],[66304,11],[66336,0],[66349,11],[66379,0],[66384,11],[66422,14],[66427,0],[66432,11],[66462,0],[66464,11],[66500,0],[66504,11],[66512,0],[66513,11],[66518,0],[66560,11],[66718,0],[66720,9],[66730,0],[66736,11],[66772,0],[66776,11],[66812,0],[66816,11],[66856,0],[66864,11],[66916,0],[67072,11],[67383,0],[67392,11],[67414,0],[67424,11],[67432,0],[67584,11],[67590,0],[67592,11],[67593,0],[67594,11],[67638,0],[67639,11],[67641,0],[67644,11],[67645,0],[67647,11],[67670,0],[67680,11],[67703,0],[67712,11],[67743,0],[67808,11],[67827,0],[67828,11],[67830,0],[67840,11],[67862,0],[67872,11],[67898,0],[67968,11],[68024,0],[68030,11],[68032,0],[68096,11],[68097,14],[68100,0],[68101,14],[68103,0],[68108,14],[68112,11],[68116,0],[68117,11],[68120,0],[68121,11],[68150,0],[68152,14],[68155,0],[68159,14],[68160,0],[68192,11],[68221,0],[68224,11],[68253,0],[68288,11],[68296,0],[68297,11],[68325,14],[68327,0],[68352,11],[68406,0],[68416,11],[68438,0],[68448,11],[68467,0],[68480,11],[68498,0],[68608,11],[68681,0],[68736,11],[68787,0],[68800,11],[68851,0],[68864,11],[68900,14],[68904,0],[68912,9],[68922,0],[69248,11],[69290,0],[69291,14],[69293,0],[69296,11],[69298,0],[69376,11],[69405,0],[69415,11],[69416,0],[69424,11],[69446,14],[69457,0],[69552,11],[69573,0],[69600,11],[69623,0],[69632,14],[69635,11],[69688,14],[69703,0],[69734,9],[69744,0],[69759,14],[69763,11],[69808,14],[69819,0],[69821,13],[69822,0],[69837,13],[69838,0],[69840,11],[69865,0],[69872,9],[69882,0],[69888,14],[69891,11],[69927,14],[69941,0],[69942,9],[69952,0],[69956,11],[69957,14],[69959,11],[69960,0],[69968,11],[70003,14],[70004,0],[70006,11],[70007,0],[70016,14],[70019,11],[70067,14],[70081,11],[70085,0],[70089,14],[70093,0],[70094,14],[70096,9],[70106,11],[70107,0],[70108,11],[70109,0],[70144,11],[70162,0],[70163,11],[70188,14],[70200,0],[70206,14],[70207,0],[70272,11],[70279,0],[70280,11],[70281,0],[70282,11],[70286,0],[70287,11],[70302,0],[70303,11],[70313,0],[70320,11],[70367,14],[70379,0],[70384,9],[70394,0],[70400,14],[70404,0],[70405,11],[70413,0],[70415,11],[70417,0],[70419,11],[70441,0],[70442,11],[70449,0],[70450,11],[70452,0],[70453,11],[70458,0],[70459,14],[70461,11],[70462,14],[70469,0],[70471,14],[70473,0],[70475,14],[70478,0],[70480,11],[70481,0],[70487,14],[70488,0],[70493,11],[70498,14],[70500,0],[70502,14],[70509,0],[70512,14],[70517,0],[70656,11],[70709,14],[70727,11],[70731,0],[70736,9],[70746,0],[70750,14],[70751,11],[70754,0],[70784,11],[70832,14],[70852,11],[70854,0],[70855,11],[70856,0],[70864,9],[70874,0],[71040,11],[71087,14],[71094,0],[71096,14],[71105,0],[71128,11],[71132,14],[71134,0],[71168,11],[71216,14],[71233,0],[71236,11],[71237,0],[71248,9],[71258,0],[71296,11],[71339,14],[71352,11],[71353,0],[71360,9],[71370,0],[71453,14],[71468,0],[71472,9],[71482,0],[71680,11],[71724,14],[71739,0],[71840,11],[71904,9],[71914,0],[71935,11],[71943,0],[71945,11],[71946,0],[71948,11],[71956,0],[71957,11],[71959,0],[71960,11],[71984,14],[71990,0],[71991,14],[71993,0],[71995,14],[71999,11],[72e3,14],[72001,11],[72002,14],[72004,0],[72016,9],[72026,0],[72096,11],[72104,0],[72106,11],[72145,14],[72152,0],[72154,14],[72161,11],[72162,0],[72163,11],[72164,14],[72165,0],[72192,11],[72193,14],[72203,11],[72243,14],[72250,11],[72251,14],[72255,0],[72263,14],[72264,0],[72272,11],[72273,14],[72284,11],[72330,14],[72346,0],[72349,11],[72350,0],[72384,11],[72441,0],[72704,11],[72713,0],[72714,11],[72751,14],[72759,0],[72760,14],[72768,11],[72769,0],[72784,9],[72794,0],[72818,11],[72848,0],[72850,14],[72872,0],[72873,14],[72887,0],[72960,11],[72967,0],[72968,11],[72970,0],[72971,11],[73009,14],[73015,0],[73018,14],[73019,0],[73020,14],[73022,0],[73023,14],[73030,11],[73031,14],[73032,0],[73040,9],[73050,0],[73056,11],[73062,0],[73063,11],[73065,0],[73066,11],[73098,14],[73103,0],[73104,14],[73106,0],[73107,14],[73112,11],[73113,0],[73120,9],[73130,0],[73440,11],[73459,14],[73463,0],[73648,11],[73649,0],[73728,11],[74650,0],[74752,11],[74863,0],[74880,11],[75076,0],[77824,11],[78895,0],[78896,13],[78905,0],[82944,11],[83527,0],[92160,11],[92729,0],[92736,11],[92767,0],[92768,9],[92778,0],[92880,11],[92910,0],[92912,14],[92917,0],[92928,11],[92976,14],[92983,0],[92992,11],[92996,0],[93008,9],[93018,0],[93027,11],[93048,0],[93053,11],[93072,0],[93760,11],[93824,0],[93952,11],[94027,0],[94031,14],[94032,11],[94033,14],[94088,0],[94095,14],[94099,11],[94112,0],[94176,11],[94178,0],[94179,11],[94180,14],[94181,0],[94192,14],[94194,0],[110592,17],[110593,0],[110948,17],[110952,0],[113664,11],[113771,0],[113776,11],[113789,0],[113792,11],[113801,0],[113808,11],[113818,0],[113821,14],[113823,0],[113824,13],[113828,0],[119141,14],[119146,0],[119149,14],[119155,13],[119163,14],[119171,0],[119173,14],[119180,0],[119210,14],[119214,0],[119362,14],[119365,0],[119808,11],[119893,0],[119894,11],[119965,0],[119966,11],[119968,0],[119970,11],[119971,0],[119973,11],[119975,0],[119977,11],[119981,0],[119982,11],[119994,0],[119995,11],[119996,0],[119997,11],[120004,0],[120005,11],[120070,0],[120071,11],[120075,0],[120077,11],[120085,0],[120086,11],[120093,0],[120094,11],[120122,0],[120123,11],[120127,0],[120128,11],[120133,0],[120134,11],[120135,0],[120138,11],[120145,0],[120146,11],[120486,0],[120488,11],[120513,0],[120514,11],[120539,0],[120540,11],[120571,0],[120572,11],[120597,0],[120598,11],[120629,0],[120630,11],[120655,0],[120656,11],[120687,0],[120688,11],[120713,0],[120714,11],[120745,0],[120746,11],[120771,0],[120772,11],[120780,0],[120782,9],[120832,0],[121344,14],[121399,0],[121403,14],[121453,0],[121461,14],[121462,0],[121476,14],[121477,0],[121499,14],[121504,0],[121505,14],[121520,0],[122880,14],[122887,0],[122888,14],[122905,0],[122907,14],[122914,0],[122915,14],[122917,0],[122918,14],[122923,0],[123136,11],[123181,0],[123184,14],[123191,11],[123198,0],[123200,9],[123210,0],[123214,11],[123215,0],[123584,11],[123628,14],[123632,9],[123642,0],[124928,11],[125125,0],[125136,14],[125143,0],[125184,11],[125252,14],[125259,11],[125260,0],[125264,9],[125274,0],[126464,11],[126468,0],[126469,11],[126496,0],[126497,11],[126499,0],[126500,11],[126501,0],[126503,11],[126504,0],[126505,11],[126515,0],[126516,11],[126520,0],[126521,11],[126522,0],[126523,11],[126524,0],[126530,11],[126531,0],[126535,11],[126536,0],[126537,11],[126538,0],[126539,11],[126540,0],[126541,11],[126544,0],[126545,11],[126547,0],[126548,11],[126549,0],[126551,11],[126552,0],[126553,11],[126554,0],[126555,11],[126556,0],[126557,11],[126558,0],[126559,11],[126560,0],[126561,11],[126563,0],[126564,11],[126565,0],[126567,11],[126571,0],[126572,11],[126579,0],[126580,11],[126584,0],[126585,11],[126589,0],[126590,11],[126591,0],[126592,11],[126602,0],[126603,11],[126620,0],[126625,11],[126628,0],[126629,11],[126634,0],[126635,11],[126652,0],[127280,11],[127306,0],[127312,11],[127338,0],[127344,11],[127370,0],[127462,18],[127488,0],[127995,14],[128e3,0],[130032,9],[130042,0],[917505,13],[917506,0],[917536,14],[917632,0],[917760,14],[918e3,0]];function v(n,r){let e=Ve(n,r);if(e.length==0)return[];let t=[];for(let o=0;o<e.length-1;o++){let a=e[o],i=e[o+1],p=new Or(n,a,i);He(p.text,r)?t.push(p):o==e.length-2&&(p=new Or(n,i,i),t.push(p))}return t}l(v,"default_");var jr=class jr{constructor(r,e,t){this._source=r,this.start=e,this.end=t}get text(){return this._source.substring(this.start,this.end)}get length(){return this.end-this.start}};l(jr,"LazySpan");var Or=jr,Y=class Y{constructor(r,e,t,o,a,i){this.lookbehind=19;this.left=19;this.right=19;this.text=r,this.options=e,arguments.length==3?this.lookahead=this.wordbreakPropertyAt(t):(this.lookbehind=t,this.left=o,this.right=a,this.lookahead=i)}next(r){let e=this.wordbreakPropertyAt(r);return new Y(this.text,this.options,this.left,this.right,this.lookahead,e)}ignoringRight(r){let e=this.wordbreakPropertyAt(r);return new Y(this.text,this.options,this.lookbehind,this.left,this.lookahead,e)}ignoringLookahead(r){let e=this.wordbreakPropertyAt(r);return new Y(this.text,this.options,this.lookbehind,this.left,this.right,e)}wordbreakPropertyAt(r){return r<0?19:r>=this.text.length?20:fe(this.text[r])?zr(this.text[r]+this.text[r+1]):zr(this.text[r],this.options)}match(r,e,t,o){var i,p,d,s;let a=(i=r==null?void 0:r.includes(this.lookbehind))!=null?i:!0;return a=a&&((p=e==null?void 0:e.includes(this.left))!=null?p:!0),a=a&&((d=t==null?void 0:t.includes(this.right))!=null?d:!0),a&&((s=o==null?void 0:o.includes(this.lookahead))!=null?s:!0)}propertyMatch(r,e,t,o){let a=l(i=>Ee(i,this.options),"propMapper");return this.match(r==null?void 0:r.map(a),e==null?void 0:e.map(a),t==null?void 0:t.map(a),o==null?void 0:o.map(a))}};l(Y,"BreakerContext");var Vr=Y;function He(n,r){return!n.split("").map(e=>zr(e,r)).every(e=>e===3||e===1||e===2||e===4)}l(He,"isNonSpace");function Ve(n,r){if(n.length===0)return[];r&&!r.rules&&(r.rules=[]);let e=[],t,o=0,a=new Vr(n,r,o),i=0;do{if(t=o,o=p(o),a=a.next(o),a.match(null,[19],null,null)){e.push(t);continue}if(a.match(null,null,[20],null)){e.push(t);break}if(a.match(null,[3],[1],null))continue;let d=[2,3,1];if(a.match(null,d,null,null)){e.push(t);continue}if(a.match(null,null,d,null)){e.push(t);continue}if(a.match(null,[4],[4],null))continue;let s=[13,14,16];for(;a.match(null,null,s,null);)[t,o]=[o,p(o)],a=a.ignoringRight(o);if(a.right===20){e.push(t);break}for(;a.match(null,null,null,s);)o=p(o),a=a.ignoringLookahead(o);let x=[11,15],u=[8,6];if(r!=null&&r.rules){let m=!1;for(let B of r.rules)if(m=B.match(a),m){B.breakIfMatch&&e.push(t);break}if(m)continue}if(a.match(null,x,x,null))continue;let h=[10].concat(u);if(a.match(null,x,h,x)||a.match(x,h,x,null)||a.match(null,[15],[6],null)||a.match(null,[15],[5],[15])||a.match([15],[5],[15],null)||a.match(null,[9],[9],null)||a.match(null,x,[9],null)||a.match(null,[9],x,null))continue;let k=[7].concat(u);if(a.match([9],k,[9],null)||a.match(null,[9],k,[9])||a.match(null,[17],[17],null))continue;let W=[17,9].concat(x);if(!a.match(null,W,[12],null)&&!a.match(null,[12],[12],null)&&!a.match(null,[12],W,null)){if(a.right===18){if(i+=1,i%2==1)continue}else i=0;e.push(t)}}while(t<n.length);return e;function p(d){return d>=n.length?n.length:fe(n[d])?d+2:d+1}}l(Ve,"findBoundaries");function fe(n){let r=n.charCodeAt(0);return r>=55296&&r<=56319}l(fe,"isStartOfSurrogatePair");function zr(n,r){if(r!=null&&r.propertyMapping){let t=r.propertyMapping(n);if(t)return Ee(t,r)}let e=n.codePointAt(0);return Gr(e,0,gr.length-1)}l(zr,"property");function Ee(n,r){var o,a;let e=l(i=>i.toLowerCase()==n.toLowerCase(),"matcher"),t=(a=(o=r==null?void 0:r.customProperties)==null?void 0:o.findIndex(e))!=null?a:-1;return t!=-1?-t-1:Ae.findIndex(e)}l(Ee,"propertyVal");function Gr(n,r,e){if(e<r)return 0;let t=r+~~((e-r)/2),o=gr[t],a=gr[t+1],i=a?a[0]:1/0;return n<o[0]?Gr(n,r,t-1):n>=i?Gr(n,t+1,e):o[1]}l(Gr,"searchForProperty");w();var Oe=12,M=class M{constructor(r,e,t){this.root=r,this.prefix=e,this.totalWeight=t}child(r){if(r=="")return this;let e=r.split(""),t=this;for(;e.length>0&&t;){let o=e.shift();t=t._child(o)}return t}_child(r){let e=this.root,t=this.totalWeight,o=this.prefix+r;if(e.type=="internal"){let a=e.children[r];return a?new M(a,o,t):void 0}else return e.entries.filter(function(i){return i.key.indexOf(o)==0}).length?new M(e,o,t):void 0}*children(){let r=this.root,e=this.totalWeight;if(r.type=="internal"){for(let t of r.values){let o=r.children[t];if(R(t))if(o.type=="internal"){let a=o;for(let i of a.values){let p=this.prefix+t+i;yield{char:t+i,traversal:function(){return new M(a.children[i],p,e)}}}}else{let a=o.entries[0].key;t=t+a[this.prefix.length+1];let i=this.prefix+t;yield{char:t,traversal:function(){return new M(o,i,e)}}}else{if(fr(t))continue;if(t){let a=this.prefix+t;yield{char:t,traversal:function(){return new M(o,a,e)}}}else continue}}return}else{let t=this.prefix,o=r.entries.filter(function(a){return a.key!=t&&t.length<a.key.length});for(let{key:a}of o){let i=a[t.length];R(i)&&(i=i+a[t.length+1]),yield{char:i,traversal:function(){return new M(r,t+i,e)}}}return}}get entries(){let r=l(e=>({text:e.content,p:e.weight/this.totalWeight}),"entryMapper");if(this.root.type=="leaf"){let e=this.prefix;return this.root.entries.filter(function(o){return o.key==e}).map(r)}else{let e=this.root.children[D];return e&&e.type=="leaf"?e.entries.map(r):[]}}get p(){return this.root.weight/this.totalWeight}};l(M,"Traversal");var Xr=M,Zr=class Zr{constructor(r,e={}){this.languageUsesCasing=e.languageUsesCasing,this.applyCasing=e.applyCasing,this._trie=new Yr(r.root,r.totalWeight,e.searchTermToKey||ze),this.breakWords=e.wordBreaker||v,this.punctuation=e.punctuation}configure(r){var e;return this.configuration={leftContextCodePoints:r.maxLeftContextCodePoints,rightContextCodePoints:(e=r.maxRightContextCodePoints)!=null?e:0}}toKey(r){return this._trie.toKey(r)}predict(r,e){if(!r.insert&&!e.left&&!e.right&&e.startOfBuffer&&e.endOfBuffer)return i(this._trie.firstN(Oe).map(({text:p,p:d})=>({transform:{insert:p,deleteLeft:0},displayAs:p,p:d})));let t=y(r,e),o=r.deleteLeft-r.insert.kmwLength(),a=dr(this.breakWords,t);return i(this._trie.lookup(a).map(({text:p,p:d})=>_({insert:p,deleteLeft:o+a.kmwLength()},d)));function i(p){let d=[];for(let s of p)d.push({sample:s,p:s.p});return d}}get wordbreaker(){return this.breakWords}traverseFromRoot(){return this._trie.traverseFromRoot()}};l(Zr,"TrieModel");var sr=Zr,Jr=class Jr{constructor(r,e,t){this.root=r,this.toKey=t,this.totalWeight=e}traverseFromRoot(){return new Xr(this.root,"",this.totalWeight)}lookup(r){let e=this.toKey(r),t=this.traverseFromRoot().child(e);if(!t)return[];let o=t.entries,a={};for(let d of o)a[d.text]=d.text;let p=ge(t).filter(d=>!a[d.text]);return o.concat(p)}firstN(r){return ge(this.traverseFromRoot(),r)}};l(Jr,"Trie");var Yr=Jr;function ge(n,r=Oe){let e=new f(function(o,a){return(a?a.p:0)-(o?o.p:0)}),t=[];for(e.enqueue(n);e.count>0;){let o=e.dequeue();if(o.text!==void 0){let a=o;if(t.push(a),t.length>=r)return t}else{let a=o;e.enqueueAll(a.entries);let i=[];for(let p of a.children())i.push(p.traversal());e.enqueueAll(i)}}return t}l(ge,"getSortedResults");function ze(n){return n.normalize("NFD").replace(/[\\u0300-\\u036f]/g,"").toLowerCase()}l(ze,"defaultSearchTermToKey");var ee=class ee{constructor(r){r=r||{},this._futureSuggestions=r.futureSuggestions?r.futureSuggestions.slice():[],r.punctuation&&(this.punctuation=r.punctuation),this.toKey=r.toKey,this.wordbreaker=r.wordbreaker,this.applyCasing=r.applyCasing,this.languageUsesCasing=r.languageUsesCasing}configure(r){return this.configuration={leftContextCodePoints:r.maxLeftContextCodePoints,rightContextCodePoints:r.maxRightContextCodePoints},this.configuration}predict(r,e,t){let o=l(function(i){let p=[];for(let d of i)p.push({sample:d,p:d.p!==void 0?d.p:1});return p},"makeUniformDistribution");if(t)return o(t);let a=this._futureSuggestions.shift();return a?o(a):[]}};l(ee,"DummyModel");var re=ee,Ce=re;var Wr={};Nr(Wr,{ClassicalDistanceCalculation:()=>K,ContextTracker:()=>Pr,ExecutionBucket:()=>xr,ExecutionSpan:()=>Q,ExecutionTimer:()=>lr,QUEUE_NODE_COMPARATOR:()=>Tr,STANDARD_TIME_BETWEEN_DEFERS:()=>Lr,SearchNode:()=>Sr,SearchResult:()=>kr,SearchSpace:()=>O,TrackedContextState:()=>V,TrackedContextSuggestion:()=>se,TrackedContextToken:()=>z});var P=class P{constructor(r){this.diagonalWidth=2;this.inputSequence=[];this.matchSequence=[];if(r){let e=r.resolvedDistances.length;this.resolvedDistances=Array(e);for(let t=0;t<e;t++)this.resolvedDistances[t]=r.resolvedDistances[t].slice(0);this.inputSequence=r.inputSequence.slice(0),this.matchSequence=r.matchSequence.slice(0),this.diagonalWidth=r.diagonalWidth}else this.resolvedDistances=[]}getTrueIndex(r,e,t){let o={row:r,col:e-r+t,sparse:!1};return(o.col<0||o.col>2*t)&&(o.sparse=!0),o}getCostAt(r,e,t=this.diagonalWidth){if(r<0||e<0)return r==-1&&e>=-1?e+1:e==-1&&r>=-1?r+1:Number.MAX_VALUE;let o=this.getTrueIndex(r,e,t);return o.sparse?Number.MAX_VALUE:this.resolvedDistances[o.row][o.col]}getFinalCost(){let r=this,e=r.getHeuristicFinalCost();for(;e>r.diagonalWidth;)r=r.increaseMaxDistance(),e=r.getHeuristicFinalCost();return e}getHeuristicFinalCost(){return this.getCostAt(this.inputSequence.length-1,this.matchSequence.length-1)}hasFinalCostWithin(r){let e=this,t=e.getHeuristicFinalCost(),o=this.diagonalWidth;do{if(t<=r)return!0;if(o<r)e=e.increaseMaxDistance(),o++,t=e.getHeuristicFinalCost();else break}while(!0);return!1}editPath(r=this.inputSequence.length-1,e=this.matchSequence.length-1){let t=this.getCostAt(r,e),o=null,a=null,i=this.getCostAt(r,e-1),p=this.getCostAt(r-1,e),d=this.getCostAt(r-1,e-1),[s,x]=P.getTransposeParent(this,r,e);if(s>=0&&x>=0){let u=1;if(o=["transpose-start"],s!=r-1){let h=r-s-1;o=o.concat(Array(h).fill("transpose-delete")),u+=h}else{let h=e-x-1;o=o.concat(Array(h).fill("transpose-insert")),u+=h}o.push("transpose-end"),this.getCostAt(s-1,x-1)!=t-u&&(o=null),a=[s-1,x-1]}return o||(d==t-1?(o=["substitute"],a=[r-1,e-1]):i==t-1?(o=["insert"],a=[r,e-1]):p==t-1?(o=["delete"],a=[r-1,e]):(o=["match"],a=[r-1,e-1])),a[0]>=0&&a[1]>=0?this.editPath(a[0],a[1]).concat(o):a[0]>-1?Array(a[0]+1).fill("delete").concat(o):a[1]>-1?Array(a[1]+1).fill("insert").concat(o):o}static getTransposeParent(r,e,t){if(e<0||t<0||r.inputSequence[e].key==r.matchSequence[t].key)return[-1,-1];let o=-1;for(let i=e-1;i>=0;i--)if(r.inputSequence[i].key==r.matchSequence[t].key){o=i;break}let a=-1;for(let i=t-1;i>=0;i--)if(r.matchSequence[i].key==r.inputSequence[e].key){a=i;break}return[o,a]}static initialCostAt(r,e,t,o,a){var i=r.inputSequence[e].key==r.matchSequence[t].key?0:1,p=r.getCostAt(e-1,t-1)+i,d=o||r.getCostAt(e,t-1)+1,s=a||r.getCostAt(e-1,t)+1,x=Number.MAX_VALUE;if(e>0&&t>0){let[u,h]=P.getTransposeParent(r,e,t);x=r.getCostAt(u-1,h-1)+(e-u-1)+1+(t-h-1)}return Math.min(p,s,d,x)}getSubset(r,e){let t=new P(this);if(r>this.inputSequence.length||e>this.matchSequence.length)throw"Invalid dimensions specified for trim operation";t.inputSequence.splice(r),t.matchSequence.splice(e),t.resolvedDistances.splice(r);let o=this.getTrueIndex(r-1,e-1,this.diagonalWidth);for(let a=o.col;a<=2*this.diagonalWidth;a++){let i=o.row-(a-o.col);if(i<0)break;if(a<0)t.resolvedDistances[i]=Array(2*t.diagonalWidth+1).fill(Number.MAX_VALUE);else{let p=2*this.diagonalWidth-a,d=t.resolvedDistances[i].splice(0,a+1),s=Array(p).fill(Number.MAX_VALUE);t.resolvedDistances[i]=d.concat(s)}}return t}static forDiagonalOfAxis(r,e,t,o){let a=t-e<r?t-e+r:2*r,i=e-r,p=i<0?0:i;for(let d=p-i;d<=a;d++)o(i+d,d)}addInputChar(r){let e=new P(this),t=e.inputSequence.length;e.inputSequence.push(r);let o=Array(2*e.diagonalWidth+1).fill(Number.MAX_VALUE);return e.resolvedDistances[t]=o,e.matchSequence.length==0||P.forDiagonalOfAxis(e.diagonalWidth,t,e.matchSequence.length-1,function(a,i){o[i]=P.initialCostAt(e,t,a)}),e}addMatchChar(r){let e=new P(this),t=e.matchSequence.length;return e.matchSequence.push(r),e.inputSequence.length==0||P.forDiagonalOfAxis(e.diagonalWidth,t,e.inputSequence.length-1,function(o,a){var i=e.resolvedDistances[o];i[2*e.diagonalWidth-a]=P.initialCostAt(e,o,t)}),e}increaseMaxDistance(){let r=new P(this);if(r.diagonalWidth++,r.inputSequence.length<1||r.matchSequence.length<1)return r;function e(o,a,i,p){let d=2*(r.diagonalWidth-1),s=i.length-1;d=d<s-o?d:s-o;for(let x=0;x<=d;x++)a==i[o+x].key&&p(o+x,x)}l(e,"forPossibleTranspositionsInDiagonal");for(let o=0;o<r.inputSequence.length;o++){let a=Number.MAX_VALUE,i=o-r.diagonalWidth;if(i>=0){let d=i==0?o+2:Number.MAX_VALUE;a=P.initialCostAt(r,o,i,d,void 0);let s=a;if(i<r.matchSequence.length-1){P.propagateUpdateFrom(r,o,i+1,s+1,0);let x=o+2;if(o+2<this.inputSequence.length){let u=r.inputSequence[o+1].key;e(i+3,u,r.matchSequence,function(h,k){P.propagateUpdateFrom(r,x,h,s+k+2,k)})}}}let p=Number.MAX_VALUE;if(i=o+r.diagonalWidth,i<r.matchSequence.length){let d=o==0?i+2:Number.MAX_VALUE;var t=r.getCostAt(o,i-1,this.diagonalWidth)+1;p=P.initialCostAt(r,o,i,t,d);let s=p;if(o<r.inputSequence.length-1){P.propagateUpdateFrom(r,o+1,i,s+1,2*this.diagonalWidth);let x=i+2;if(i+2<this.matchSequence.length){let u=r.matchSequence[o+1].key;e(o+3,u,r.inputSequence,function(h,k){let W=2*(r.diagonalWidth-1)-k;P.propagateUpdateFrom(r,h,x,s+k+2,W)})}}}r.resolvedDistances[o]=[a].concat(r.resolvedDistances[o],p)}return r}static propagateUpdateFrom(r,e,t,o,a){if(o<r.resolvedDistances[e][a])r.resolvedDistances[e][a]=o;else return;let i=e<r.inputSequence.length-1,p=t<r.matchSequence.length-1;if(a<2*(r.diagonalWidth-1)&&p){let d=o+1;this.propagateUpdateFrom(r,e,t+1,d,a+1)}if(a>0&&i){let d=o+1;this.propagateUpdateFrom(r,e+1,t,d,a-1)}if(i&&p){let d=o+(r.inputSequence[e+1].key==r.matchSequence[t+1].key?0:1);this.propagateUpdateFrom(r,e+1,t+1,d,a);let s=-1;for(let u=e+2;u<r.inputSequence.length;u++)if(r.inputSequence[u].key==r.matchSequence[t+1].key){s=u;break}let x=-1;for(let u=t+2;u<r.matchSequence.length;u++)if(r.matchSequence[u].key==r.inputSequence[e+1].key){x=u;break}if(s>0&&x>0){let u=o+(s-e-2)+1+(x-t-2);this.propagateUpdateFrom(r,s,x,u,r.diagonalWidth-1+x-s)}}}get mapKey(){let r=this.inputSequence.map(t=>t.key).join(""),e=this.matchSequence.map(t=>t.key).join("");return r+D+e+D+this.diagonalWidth}get lastInputEntry(){return this.inputSequence[this.inputSequence.length-1]}get lastMatchEntry(){return this.matchSequence[this.matchSequence.length-1]}static computeDistance(r,e,t=1){let o=new P;t=t||1,o.diagonalWidth=t;for(let a=0;a<r.length;a++)o=o.addInputChar(r[a]);for(let a=0;a<e.length;a++)o=o.addMatchChar(e[a]);return o}};l(P,"ClassicalDistanceCalculation");var K=P;var Ge=1,Le=5,Lr=5,te=class te{constructor(r){this.timeSpent=0;this.eventCount=0;this.timeSquared=0;this.nearOutliers=[];this.outliers=[];this.preventOutliers=!1;this.preventOutliers=!!r}add(r){if(r<0)throw new Error("time may not be negative");this.eventCount++,this.timeSpent+=r,this.timeSquared+=r*r,r>=Ge&&(this.nearOutliers.length<Le||this.nearOutliers[Le-1]<r)&&(this.nearOutliers.push(r),this.nearOutliers.sort((e,t)=>t-e)),this.checkForOutlier()}checkForOutlier(){if(this.preventOutliers||this.eventCount<4||this.nearOutliers.length==0)return;let r=this.nearOutliers[0];this.timeSpent-=r,this.timeSquared-=r*r,this.eventCount--;let e=this.average,t=r-e,o=this.variance,a=t*t/o;a>=49||this.eventCount>=8&&a>=9?(this.nearOutliers.shift(),this.outliers.push(r)):(this.timeSpent+=r,this.timeSquared+=r*r,this.eventCount++)}get average(){return this.timeSpent/this.eventCount}get variance(){let r=this.eventCount;return r<=1?NaN:this.timeSquared/r-this.timeSpent*this.timeSpent/(r*r)}get outlierTime(){let r=0;for(let e=0;e<this.outliers.length;e++)r+=this.outliers[e];return r}};l(te,"ExecutionBucket");var xr=te,oe=class oe{constructor(r,e){this.bucket=r,this.finalizer=e,this.start=performance.now()}end(){var r,e;this.finish=performance.now(),(r=this.bucket)==null||r.add(this.duration),(e=this.finalizer)==null||e.call(this)}get duration(){var r;return((r=this.finish)!=null?r:performance.now())-this.start}};l(oe,"ExecutionSpan");var Q=oe,ae=class ae{constructor(r,e){this.buckets={};this.deferBucket=new xr(!0);this.activeSpan=null;this.spanSinceLastDefer=null;this.trueStart=performance.now(),this.maxExecutionTime=r,this.maxTrueTime=e,this.spanSinceLastDefer=new Q}validateStart(){if(this.activeSpan)throw new Error("illegal state - span-based timer still pending")}getBucket(r){r!=null||(r=-1);let e=this.buckets[r];return e||(e=this.buckets[r]=new xr),e}get executionTime(){let r=Object.values(this.buckets),e=0;for(let t of r)e+=t.timeSpent;return e}get deferredTime(){let r=Object.values(this.buckets),e=0;for(let t of r)e+=t.outlierTime;return e+=this.deferBucket.timeSpent,e}time(r,e){this.validateStart();let t=performance.now(),o=r(),a=performance.now()-t;return this.getBucket(e).add(a),o}defer(r){return N(this,null,function*(){this.validateStart(),r!=null||(r=0),this.activeSpan=new Q(this.deferBucket,()=>this.activeSpan=null),yield Rr(r),this.activeSpan.end(),this.spanSinceLastDefer=new Q})}get timeSinceLastDefer(){return this.spanSinceLastDefer.duration}start(r){this.validateStart();let e=this.getBucket(r);return this.activeSpan=new Q(e,()=>{this.activeSpan=null}),this.activeSpan}terminate(){this.maxTrueTime=0}get elapsed(){return performance.now()-this.trueStart>=this.maxTrueTime?!0:this.executionTime>=this.maxExecutionTime}};l(ae,"ExecutionTimer");var lr=ae;var Tr=l(function(n,r){return n.currentCost-r.currentCost},"QUEUE_NODE_COMPARATOR");var H=class H{constructor(r,e){this.toKey=l(r=>r,"toKey");if(e=e||(t=>t),r instanceof H){let t=r;this.calculation=t.calculation,this.currentTraversal=t.currentTraversal,this.priorInput=t.priorInput,this.toKey=t.toKey}else this.calculation=new K,this.currentTraversal=r,this.priorInput=[],this.toKey=e}get knownCost(){return this.calculation.getHeuristicFinalCost()}get inputSamplingCost(){if(this._inputCost!==void 0)return this._inputCost;{let r=O.MIN_KEYSTROKE_PROBABILITY;return this._inputCost=this.priorInput.map(e=>e.p>r?e.p:r).reduce((e,t)=>e-Math.log(t),0),this._inputCost}}get currentCost(){return O.EDIT_DISTANCE_COST_SCALE*this.knownCost+this.inputSamplingCost}buildInsertionEdges(){let r=[];for(let e of this.currentTraversal.children()){let t=e.traversal(),o={key:e.char,traversal:t},a=this.calculation.addMatchChar(o),i=new H(this);i.calculation=a,i.priorInput=this.priorInput,i.currentTraversal=t,r.push(i)}return r}buildDeletionEdges(r){let e=[];for(let t of r){if(t.p<r[0].p*Math.exp(-O.EDIT_DISTANCE_COST_SCALE))break;let o=this.calculation,a=t.sample;a.deleteLeft&&(o=o.getSubset(o.inputSequence.length-a.deleteLeft,o.matchSequence.length));let i=this.priorInput.slice(0);i.push(t);for(let d=0;d<a.insert.length;d++){let s=a.insert[d];R(s)&&(d++,s=s+a.insert[d]);let x=this.toKey(s);x&&(o=o.addInputChar({key:x}))}let p=new H(this);p.calculation=o,p.priorInput=i,e.push(p)}return e}buildSubstitutionEdges(r){let e=this.buildDeletionEdges(r),t=[];for(let o of this.currentTraversal.children())for(let a of e){let i=o.traversal(),p={key:o.char,traversal:i},d=a.calculation.addMatchChar(p),s=new H(this);s.calculation=d,s.priorInput=a.priorInput,s.currentTraversal=i,t.push(s)}return t}get pathKey(){let r=this.priorInput.map(t=>"+"+t.sample.insert+"-"+t.sample.deleteLeft).join(""),e=this.calculation.matchSequence.map(t=>t.key).join("");return r+D+e}get resultKey(){return this.calculation.matchSequence.map(r=>r.key).join("")}get isFullReplacement(){return this.knownCost&&this.knownCost==this.priorInput.length}};l(H,"SearchNode");var Sr=H,ne=class ne{constructor(r,e){this.processed=[];if(typeof r=="number"){this.index=r,this.correctionQueue=new f(Tr,e);return}else this.index=r.index,this.processed=[].concat(r.processed),this.correctionQueue=new f(r.correctionQueue)}increaseMaxEditDistance(){let r=this.correctionQueue.toArray();r.forEach(function(e){e.calculation=e.calculation.increaseMaxDistance()}),this.correctionQueue=new f(Tr,r)}};l(ne,"SearchSpaceTier");var ur=ne,ie=class ie{constructor(r){this.resultNode=r}get inputSequence(){return this.resultNode.priorInput}get matchSequence(){return this.resultNode.calculation.matchSequence}get matchString(){return this.resultNode.resultKey}get knownCost(){return this.resultNode.knownCost}get inputSamplingCost(){return this.resultNode.inputSamplingCost}get totalCost(){return this.resultNode.currentCost}get finalTraversal(){return this.resultNode.currentTraversal}};l(ie,"SearchResult");var kr=ie,U=class U{constructor(r){this.tierOrdering=[];this.inputSequence=[];this.minInputCost=[];this.returnedValues={};this.processedEdgeSet={};if(this.buildQueueSpaceComparator(),r instanceof U){this.inputSequence=[].concat(r.inputSequence),this.minInputCost=[].concat(r.minInputCost),this.rootNode=r.rootNode,this.completedPaths=[].concat(r.completedPaths),this.returnedValues=b({},r.returnedValues),this.processedEdgeSet=b({},r.processedEdgeSet),this.tierOrdering=r.tierOrdering.map(o=>new ur(o)),this.selectionQueue=new f(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering);return}let e=r;if(e){if(!e.traverseFromRoot)throw"The provided model does not implement the \`traverseFromRoot\` function, which is needed to support robust correction searching."}else throw"The LexicalModel parameter must not be null / undefined.";this.selectionQueue=new f(this.QUEUE_SPACE_COMPARATOR),this.rootNode=new Sr(e.traverseFromRoot(),e.toKey?e.toKey.bind(e):null),this.completedPaths=[this.rootNode];let t=new ur(0,[this.rootNode]);this.tierOrdering.push(t),this.selectionQueue.enqueue(t)}buildQueueSpaceComparator(){let r=this;this.QUEUE_SPACE_COMPARATOR=function(e,t){let o=e.correctionQueue.peek(),a=t.correctionQueue.peek(),i=e.index,p=t.index,d=0,s=1;if(p<i){let x=p;p=i,i=x,s=-1}for(let x=i;x<p;x++)d=d+r.minInputCost[x];return o&&a?o.currentCost-a.currentCost+s*d:a?1:-1}}increaseMaxEditDistance(){this.tierOrdering.forEach(function(r){r.increaseMaxEditDistance()})}addInput(r){this.inputSequence.push(r),this.minInputCost.push(-Math.log(r[0].p));let e=[],t=this.completedPaths.map(function(a){let i=a.buildDeletionEdges(r),p=a.buildSubstitutionEdges(r);return i.concat(p)});this.completedPaths=[],this.returnedValues={},t.forEach(function(a){e=e.concat(a)});let o=new ur(this.tierOrdering.length,e);this.tierOrdering.push(o),this.selectionQueue.enqueue(o)}removeLastInput(){}hasNextMatchEntry(){let r=this.selectionQueue.peek();return r?r.correctionQueue.count>0:!1}handleNextNode(){if(!this.hasNextMatchEntry())return{type:"none"};let r=this.selectionQueue.dequeue(),e=r.correctionQueue.dequeue(),t={type:"intermediate",cost:e.currentCost};if(this.processedEdgeSet[e.pathKey])return this.selectionQueue.enqueue(r),t;this.processedEdgeSet[e.pathKey]=!0;let o=!1;if(e.knownCost>2)return t;e.knownCost==2&&(o=!0);let a=0;for(let i=0;i<=r.index;i++)a+=this.minInputCost[i];if(e.currentCost>a+2.5*U.EDIT_DISTANCE_COST_SCALE)return t;if(!o){let i=e.buildInsertionEdges();r.correctionQueue.enqueueAll(i)}if(r.index==this.tierOrdering.length-1)return this.completedPaths.push(e),this.selectionQueue.enqueue(r),{type:"complete",cost:e.currentCost,finalNode:e};{let i=this.tierOrdering[r.index+1],p=i.index,d=[];o||(d=e.buildDeletionEdges(this.inputSequence[p-1]));let s=e.buildSubstitutionEdges(this.inputSequence[p-1]);i.correctionQueue.enqueueAll(d.concat(s)),this.selectionQueue=new f(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering)}return t}getBestMatches(r){return ce(this,null,function*(){let e={},t=Object.values(this.returnedValues);if(t.length>0){let o=new f(Tr,t);for(;o.count>0;){let a=r.time(()=>{let i=o.dequeue();return i.isFullReplacement?null:(e[i.resultKey]=i,new kr(i))},0);if(a){let i=r.start(1);yield a,i.end(),r.timeSinceLastDefer>Lr&&(yield new Ar(r.defer()))}}}do{let o=r.time(()=>{var i,p;let a=this.handleNextNode();if(a.type=="none")return null;if(a.type=="complete"){if(a.finalNode.isFullReplacement)return null;let s=a.finalNode;if(((p=(i=e[s.resultKey])==null?void 0:i.currentCost)!=null?p:Number.MAX_VALUE)>s.currentCost)return e[s.resultKey]=s,this.returnedValues[s.resultKey]=s,new kr(s)}return null},2);if(o){let a=r.start(1);yield o,a.end()}r.timeSinceLastDefer>Lr&&(yield new Ar(r.defer()))}while(!r.elapsed&&this.hasNextMatchEntry());return null})}};l(U,"SearchSpace"),U.EDIT_DISTANCE_COST_SCALE=5,U.MIN_KEYSTROKE_PROBABILITY=1e-4,U.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL=33;var O=U;var de=class de{static isWhitespace(r){let e=/^[\\u0009\\u000A\\u000D\\u0020\\u00a0\\u1680\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u200b\\u2028\\u2029\\u202f\\u205f\\u3000]+$/i;return r.insert.match(e)!=null}static isBackspace(r){return r.insert==""&&r.deleteLeft>0&&!r.deleteRight}static isEmpty(r){return r.insert==""&&r.deleteLeft==0&&!r.deleteRight}};l(de,"TransformUtils");var E=de;var je={quotesForKeepSuggestion:{open:"\\u201C",close:"\\u201D"},insertAfterWord:" "};function Br(n){let r=je;if(!n.punctuation)return r;let e=n.punctuation,t=e.insertAfterWord;t!==""&&!t&&(t=r.insertAfterWord);let o=e.quotesForKeepSuggestion;o||(o=r.quotesForKeepSuggestion);let a=e.isRTL;return{insertAfterWord:t,quotesForKeepSuggestion:o,isRTL:a}}l(Br,"determinePunctuationFromModel");function q(n){return r=>{if(n.wordbreaker||!n.wordbreak){let e=n.wordbreaker||v;return X(e,r)}else return n.wordbreak(r)}}l(q,"determineModelWordbreaker");function Z(n){return r=>n.wordbreaker?ir(n.wordbreaker,r):null}l(Z,"determineModelTokenizer");function Te(n,r){var a;let e=n,o=q(n)(r);if(!e.languageUsesCasing)throw"Invalid attempt to detect casing: languageUsesCasing is set to false";if(!e.applyCasing)throw"Invalid LMLayer state:  languageUsesCasing is set to true, but no applyCasing function exists";return r.casingForm=="upper"||r.casingForm=="initial"?r.casingForm:e.applyCasing("lower",o)==o?"lower":e.applyCasing("upper",o)==o?o.kmwLength()>1?"upper":"initial":e.applyCasing("initial",o)==o?"initial":(a=r.casingForm)!=null?a:null}l(Te,"detectCurrentCasing");function pe(n,r,e){let t=y(e,r),o=n(t).left,a=e.insert,i=[];for(let p=o.length-1;p>=0;p--){let d=o[p],s=d.text.length;if(s<a.length)i.unshift({insert:d.text,deleteLeft:0}),a=a.substring(0,a.length-s);else{i.unshift({insert:a,deleteLeft:e.deleteLeft});break}}return i}l(pe,"tokenizeTransform");function Se(n,r,e){return e.map(t=>({sample:pe(n,r,t.sample),p:t.p}))}l(Se,"tokenizeTransformDistribution");function Fe(n,r){let e=[];for(let t=0;t<n.kmwLength();t++){let a={insert:n.kmwCharAt(t),deleteLeft:0,id:r};e.push(a)}return e}l(Fe,"textToCharTransforms");var le=class le{};l(le,"TrackedContextSuggestion");var se=le,ue=class ue{constructor(){this.transformDistributions=[];this.activeReplacementId=-1}get currentText(){return this.replacementText===void 0||this.replacementText===null?this.raw:this.replacementText}get replacement(){let r=this.activeReplacementId;return this.replacements.find(function(e){return e.suggestion.id==r})}revert(){delete this.activeReplacementId}updateWithBackspace(r,e){let t=Fe(r,e).map(function(o){return[{sample:o,p:1}]});this.raw=r,this.transformDistributions=t}update(r,e){e=e||(e===""?"":this.raw),(r==null?void 0:r.length)>0&&this.transformDistributions.push(r),this.raw=e}};l(ue,"TrackedContextToken");var z=ue,Fr=class Fr{constructor(r){this.searchSpace=[];if(r instanceof Fr){let e=r;this.tokens=e.tokens.map(function(o){let a=new z;return a.raw=o.raw,a.replacements=[].concat(o.replacements),a.activeReplacementId=o.activeReplacementId,a.transformDistributions=[].concat(o.transformDistributions),o.replacementText&&(a.replacementText=o.replacementText),a}),this.indexOffset=0;let t=this.model=r.model;this.taggedContext=r.taggedContext,t!=null&&t.traverseFromRoot&&(this.searchSpace=r.searchSpace.map(o=>new O(o)))}else{let e=r;this.tokens=[],this.indexOffset=Number.MIN_SAFE_INTEGER,this.model=e,e&&e.traverseFromRoot&&(this.searchSpace=[new O(e)])}}get head(){return this.tokens[0]}get tail(){return this.tokens[this.tokens.length-1]}popHead(){this.tokens.splice(0,1),this.indexOffset-=1}pushTail(r){this.model&&this.model.traverseFromRoot?this.searchSpace=[new O(this.model)]:this.searchSpace=[],this.tokens.push(r);let e=this;e.searchSpace.length>0&&r.transformDistributions.forEach(t=>e.searchSpace[0].addInput(t))}toRawTokenization(){let r=[];for(let e of this.tokens)e.currentText!==null&&r.push(e.currentText);return r}};l(Fr,"TrackedContextState");var V=Fr,hr=class hr{constructor(r=hr.DEFAULT_ARRAY_SIZE){this.currentHead=0;this.currentTail=0;this.circle=Array(r)}get count(){let r=this.currentHead-this.currentTail;return r<0&&(r=r+this.circle.length),r}get maxCount(){return this.circle.length}get oldest(){if(this.count!=0)return this.item(0)}get newest(){if(this.count!=0)return this.item(this.count-1)}enqueue(r){var e=null;let t=(this.currentHead+1)%this.maxCount;return t==this.currentTail&&(e=this.circle[this.currentTail],this.currentTail=(this.currentTail+1)%this.maxCount),this.circle[this.currentHead]=r,this.currentHead=t,e}dequeue(){if(this.currentTail==this.currentHead)return null;{let r=this.circle[this.currentTail];return this.currentTail=(this.currentTail+1)%this.maxCount,r}}popNewest(){if(this.currentTail==this.currentHead)return null;{let r=this.circle[this.currentHead];return this.currentHead=(this.currentHead-1+this.maxCount)%this.maxCount,r}}item(r){if(r>=this.count)return;let e=(this.currentTail+r)%this.maxCount;return this.circle[e]}};l(hr,"CircularArray"),hr.DEFAULT_ARRAY_SIZE=5;var xe=hr,yr=class yr extends xe{static attemptMatchContext(r,e,t){var W,m;let o=e.toRawTokenization(),i=K.computeDistance(o.map(B=>({key:B})),r.map(B=>({key:B.text})),3).editPath();i.length==2&&i[0]=="insert"&&i[1]=="substitute"&&(i[0]="substitute",i[1]="insert");let p=i.indexOf("match"),d=i.lastIndexOf("match");if(i.length>=2&&i[i.length-2]=="substitute"&&i[i.length-1]=="match"&&(d=i.lastIndexOf("match",i.length-2)),p){for(let B=p+1;B<d;B++)if(i[B]!="match")return null}if(p==0&&d==i.length-1)return{state:e,baseState:e};let s=e,x,u=0;for(let B=0;B<p;B++)switch(i[B]){case"delete":if(x&&x!="delete")return null;s==e&&(s=new V(s)),s.popHead(),u++;break;case"substitute":break;default:return null}let h=t&&Array.isArray(t);x=void 0;let k;for(let B=d+1;B<i.length;B++){let A=B==i.length-1;if(!h)return null;let g=B-(d+1),L=t.map(G=>({sample:G.sample[g],p:G.p})),C=h?(W=L[0])==null?void 0:W.sample:null;C&&C.insert==""&&C.deleteLeft==0&&!C.deleteRight&&(C=null),A||(k=k?I(k,C):C);let Re=C&&E.isBackspace(C),er=r[B-u];switch(i[B]){case"substitute":A&&(s=new V(s));let G=s.tokens[B-u],c=e.tokens[B];Re?(G.updateWithBackspace(er.text,C.id),A&&(s.tokens.pop(),s.pushTail(G))):(G.update(L,er.text),A&&((m=s.searchSpace[0])==null||m.addInput(L))),s!=e&&!A&&(c.replacementText=er.text);break;case"insert":if(x&&x!="substitute"&&x!="match"&&x!="insert")return null;k||(k={insert:"",deleteLeft:0}),s==e&&(s=new V(s));let T=new z;T.raw=er.text,C&&(T.transformDistributions=L?[L]:[]),T.isWhitespace=er.isWhitespace,s.pushTail(T);break;case"match":if(x=="substitute"&&r[r.length-1].text=="")continue;default:return null}x=i[B]}return{state:s,baseState:e,preservationTransform:k}}static modelContextState(r,e){let t=r.map(function(a){let i=new z;return i.raw=a.text,a.isWhitespace&&(i.isWhitespace=!0),i.raw?i.transformDistributions=Fe(i.raw).map(function(p){return[{sample:p,p:1}]}):i.transformDistributions=[],i}),o=new V(e);for(;t.length>0;)t.length==1&&t[0].updateWithBackspace(t[0].raw,null),o.pushTail(t.splice(0,1)[0]);if(o.tokens.length==0){let a=new z;a.raw="",o.pushTail(a)}return o}analyzeState(r,e,t){if(!r.traverseFromRoot)throw"This lexical model does not provide adequate data for correction algorithms and context reuse";let o=Z(r),a=t==null?void 0:t[0],i=0,p=null;a&&(i=pe(o,e,a.sample).length,p=Se(o,e,t),e=y(a.sample,e),p=p.filter(x=>x.sample.length==i));let d=o(e);if(d.left.length>0)for(let x=this.count-1;x>=0;x--){let u=this.item(x),h=u.taggedContext;if(h&&t&&t.length>0){if(y(t[0].sample,h).left!=e.left)continue}else if((h==null?void 0:h.left)!=e.left)continue;let k=yr.attemptMatchContext(d.left,this.item(x),p);if(k!=null&&k.state)return this.newest!=k.state&&this.newest!=u&&this.enqueue(u),k.state.taggedContext=e,k.state!=this.item(x)&&this.enqueue(k.state),k}let s=yr.modelContextState(d.left,r);return s.taggedContext=e,this.enqueue(s),{state:s,baseState:null}}clearCache(){for(;this.count>0;)this.dequeue()}};l(yr,"ContextTracker");var Pr=yr;var Xe=.66,De={MAX_SEARCH_THRESHOLD:8,REPLACEMENT_SEARCH_THRESHOLD:4};function ke(n,r){let e=r.matchLevel-n.matchLevel;return e!=0?e:r.totalProb-n.totalProb}l(ke,"tupleDisplayOrderSort");function we(n,r,e,t,o){return N(this,null,function*(){let a=q(r),i=t[0].sample,p=y(i,o),d=[];if(!n){let c,T=E.isWhitespace(i),wr=E.isBackspace(i);return T?c=[{sample:i,p:1}]:c=t.map(S=>{let cr=S.sample;return E.isWhitespace(cr)&&!T||E.isBackspace(cr)&&!wr?null:S}),c=c.filter(S=>!!S),d=be(r,c,o),T&&d.forEach(S=>S.preservationTransform=i),{postContextState:null,rawPredictions:d}}let{state:s}=n.analyzeState(r,o,null),x=n.analyzeState(r,o,E.isEmpty(i)?null:t),u=x.state,h=u.searchSpace[0],k=0,W=u.tokens,m=W.length-s.tokens.length;x.preservationTransform?(k=0,o=y(x.preservationTransform,o)):m<0?k=a(p).kmwLength()+i.deleteLeft:k=a(o).kmwLength();let B=W[W.length-1];B.raw==""&&(k=0);let A=B.transformDistributions.length<=1,g,L={};try{for(var C=me(h.getBestMatches(e)),Re,er,G;Re=!(er=yield C.next()).done;Re=!1){let c=er.value;let T=c.matchString;if(c.matchSequence.length==0&&c.inputSequence.length!=0||c.matchSequence.length!=0&&c.matchSequence.length==c.knownCost)continue;let wr={insert:T,deleteLeft:k,id:i.id},S=c.totalCost;A&&(S*=J.SINGLE_CHAR_KEY_PROB_EXPONENT);let cr={sample:wr,p:Math.exp(-S)},mr=be(r,[cr],o);mr.forEach(tr=>tr.preservationTransform=x.preservationTransform),mr.length>0&&g===void 0&&(g=S);let he=L[c.matchString];if(he&&(d=d.filter(tr=>!he.find(_e=>tr.prediction.sample==_e.sample))),L[c.matchString]=mr.map(tr=>tr.prediction),d=d.concat(mr),Ye(g,c.totalCost,d))break}}catch(er){G=[er]}finally{try{Re&&(er=C.return)&&(yield er.call(C))}finally{if(G)throw G[0]}}return{postContextState:u,rawPredictions:d}})}l(we,"correctAndEnumerate");function Ye(n,r,e){if(r>=n+De.MAX_SEARCH_THRESHOLD)return!0;if(e.length>=J.MAX_SUGGESTIONS){if(r>=n+De.REPLACEMENT_SEARCH_THRESHOLD)return!0;if(e.sort(ke),e[J.MAX_SUGGESTIONS-1].totalProb>Math.exp(-r))return!0}return!1}l(Ye,"shouldStopSearchingEarly");function be(n,r,e){let t=[],o=q(n);for(let a of r){let i=n.predict(a.sample,e),{sample:p,p:d}=a,s=o(y(a.sample,e)),x=i.map(u=>(p.id!==void 0&&(u.sample.transformId=p.id),{prediction:u,correction:{sample:s,p:d},totalProb:u.p*d,matchLevel:0}));t=t.concat(x)}return t}l(be,"predictFromCorrections");function ve(n,r,e){let t=q(n),o={},a=[];for(let i of r){let p=t(y(i.prediction.sample.transform,e)),d=o[p];d?d.totalProb+=i.totalProb:o[p]=i}for(let i in o){let p=o[i];a.push(p)}return a}l(ve,"dedupeSuggestions");function Me(n,r,e,t){let{sample:o,p:a}=t,i=q(n),p=y(o,e),d=i(p),s=l(B=>n.toKey?n.toKey(B):B,"keyed"),x=l(B=>n.applyCasing?n.applyCasing("lower",B):B,"keyCased"),u=s(d),h=x(d),k;for(let B of r){o.id!==void 0&&(B.prediction.sample.transformId=o.id);let A=i(y(B.prediction.sample.transform,e));s(B.correction.sample)==u?A==d?(B.matchLevel=3,k=Dr(n,B.prediction.sample,"keep",j.noQuotes),k.matchesModel=!0,Object.assign(B.prediction.sample,k),k=B.prediction.sample):x(A)==h?B.matchLevel=2:s(A)==u?B.matchLevel=1:B.matchLevel=0:B.matchLevel=0}if(k||d=="")return;let W=b({},o),m=_(W,1);m.displayAs=d,k=Dr(n,m,"keep"),o.id!==void 0&&(k.transformId=o.id),k.matchesModel=!1,r.unshift({totalProb:k.p,prediction:{sample:k,p:k.p},correction:{sample:d,p:a},matchLevel:3})}l(Me,"processSimilarity");function Ne(n){if(n.length==0)return;let r=n[0].prediction.sample;if(r.tag=="keep"&&r.matchesModel){r.autoAccept=!0;return}else if(n.length==1)return;if(n=n.slice(1),n.length==1){n[0].prediction.sample.autoAccept=!0;return}let e=n[0];if(e.correction.sample.length==0||n.reduce((d,s)=>(d==null?void 0:d.correction.p)>s.correction.p?d:s,null).correction.p>e.correction.p)return;let a=e.matchLevel,i=n.reduce((d,s)=>d+(s.matchLevel==a?s.totalProb:0),0);e.totalProb/i<Xe||(e.prediction.sample.autoAccept=!0)}l(Ne,"predictionAutoSelect");function Ie(n,r,e,t,o){let a=Br(n),i=Z(n),p=r.map(d=>{let s=d.prediction;if(d.preservationTransform){let x=I(d.preservationTransform,s.sample.transform);x.id=s.sample.transformId;let u=s.sample;u.transform=x}return o?Mr(b({},s.sample),{p:d.totalProb,"lexical-p":s.p,"correction-p":d.correction.p}):Mr(b({},s.sample),{p:d.totalProb})});return p.forEach(d=>{let s=i(e);s&&s.caretSplitsToken?d.transform.insert+=a.insertAfterWord:e.right?a.insertAfterWord!=""&&e.right.indexOf(a.insertAfterWord)!=0&&(d.transform.insert+=a.insertAfterWord):d.transform.insert+=a.insertAfterWord}),p}l(Ie,"finalizeSuggestions");function Dr(n,r,e,t=j.default){let o=j,a=Br(n),i=o.noQuotes;(e=="keep"||e=="revert")&&(i=o.useQuotes);let p={transform:r.transform,displayAs:o.apply(t,r.displayAs,a,i),tag:e,p:r.p};return r.transformId!==void 0&&(p.transformId=r.transformId),p}l(Dr,"toAnnotatedSuggestion");var $=class \${constructor(r,e){this.SUGGESTION_ID_SEED=0;this.testMode=!1;this.verbose=!0;this.lexicalModel=r,r.traverseFromRoot&&(this.contextTracker=new Pr),this.punctuation=Br(r),this.testMode=!!e}predict(r,e){return N(this,null,function*(){var A;let t=this.lexicalModel;(A=this.activeTimer)==null||A.terminate(),r instanceof Array?r.length==0&&r.push({sample:{insert:"",deleteLeft:0},p:1}):r=[{sample:r,p:1}],r.sort(function(g,L){return L.p-g.p});let o=r[0].sample,a=E.isBackspace(o),i=E.isWhitespace(o),p=y(o,e),d=this.wordbreak(p),s=a||i?d:this.wordbreak(e),x=t.languageUsesCasing?Te(t,p):null,u=O.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL,h=this.activeTimer=new lr(this.testMode?Number.MAX_VALUE:u,this.testMode?Number.MAX_VALUE:u*1.5),{postContextState:k,rawPredictions:W}=yield we(this.contextTracker,this.lexicalModel,h,r,e);this.activeTimer==h&&(this.activeTimer=null);for(let g of W)x&&x!="lower"&&this.applySuggestionCasing(g.prediction.sample,s,x);let m=ve(this.lexicalModel,W,e);Me(this.lexicalModel,m,e,r[0]),m.sort(ke),Ne(m);let B=Ie(this.lexicalModel,m.splice(0,$.MAX_SUGGESTIONS),e,o,this.verbose);return B.forEach(g=>{g.id=this.SUGGESTION_ID_SEED,this.SUGGESTION_ID_SEED++}),k&&(k.tail.replacements=B.map(function(g){return{suggestion:g,tokenWidth:1}})),B})}applySuggestionCasing(r,e,t){let o=e.kmwLength()-r.transform.deleteLeft;o>0&&(r.transform.deleteLeft+=o,r.transform.insert=e.kmwSubstr(0,o)+r.transform.insert),r.transform.insert=this.lexicalModel.applyCasing(t,r.transform.insert),r.displayAs=this.lexicalModel.applyCasing(t,r.displayAs)}acceptSuggestion(r,e,t){let o=r.transform,a=e.left.kmwSubstr(-o.deleteLeft,o.deleteLeft),i=o.insert.kmwLength(),p={insert:a,deleteLeft:i},d=e;t&&(p=I(p,t),d=y(t,d));let s,x=this.tokenize(d);if(x){let k=x.left[x.left.length-1];s=k&&!k.isWhitespace?k.text:"",s+=x.caretSplitsToken?x.right[0]:""}else s=this.wordbreak(d);let u=_(p);u.displayAs=s;let h=Dr(this.lexicalModel,u,"revert");if(r.transformId!=null&&(h.transformId=-r.transformId),r.id!=null?h.id=-r.id:(h.id=-this.SUGGESTION_ID_SEED,this.SUGGESTION_ID_SEED++),this.contextTracker){let k=this.contextTracker.newest;k||(k=this.contextTracker.analyzeState(this.lexicalModel,e).state),k.tail.activeReplacementId=r.id;let W=y(r.transform,e);this.contextTracker.analyzeState(this.lexicalModel,W)}return h}applyReversion(r,e){return N(this,null,function*(){let t=this,o=l(function(){return N(this,null,function*(){let p=y(r.transform,e),d=yield t.predict({insert:"",deleteLeft:0},p);return d.forEach(function(s){s.transformId=-r.transformId,s.autoAccept=!1}),d})},"fallbackSuggestions");if(!this.contextTracker)return o();let a=!1;for(let p=this.contextTracker.count-1;p>=0;p--)if(this.contextTracker.item(p).tail.activeReplacementId==-r.id){a=!0;break}if(!a)return o();for(;this.contextTracker.newest.tail.activeReplacementId!=-r.id;)this.contextTracker.popNewest();this.contextTracker.newest.tail.revert();let i=this.contextTracker.newest.tail.replacements.map(function(p){return p.suggestion});return i.forEach(function(p){p.transformId=-r.transformId,p.autoAccept=!1}),i})}wordbreak(r){return q(this.lexicalModel)(r)}tokenize(r){return Z(this.lexicalModel)(r)}resetContext(r){var e;(e=this.activeTimer)==null||e.terminate(),this.contextTracker&&(this.contextTracker.clearCache(),this.contextTracker.analyzeState(this.lexicalModel,r,null))}};l($,"ModelCompositor"),$.MAX_SUGGESTIONS=12,$.SINGLE_CHAR_KEY_PROB_EXPONENT=16;var Be=$,J=Be;w();var br=class br{constructor(r={importScripts:null,postMessage:null}){this._testMode=!1;this._postMessage=r.postMessage||postMessage,this._importScripts=r.importScripts||importScripts,this.setupConfigState()}error(r,e){this.cast("error",{log:r,error:e&&e.stack?e.stack:void 0})}onMessage(r){let{message:e}=r.data;if(!e)throw new Error(\`Missing required 'message' property: \${r.data}\`);let t=r.data;if(t.message=="load"){let o=t,a=!1;if(this._currentModelSource&&o.source.type==this._currentModelSource.type&&(o.source.type=="file"&&o.source.file==this._currentModelSource.file||o.source.type=="raw"&&o.source.code==this._currentModelSource.code)&&(a=!0),a){typeof console!="undefined"&&console.warn("Duplicate model load message detected - squashing!");return}else this._currentModelSource=o.source}else t.message=="unload"&&(this._currentModelSource=null);this.state.handleMessage(t)}cast(r,e){let t=this._postMessage;t(b({message:r},e))}loadModel(r){try{let e=r.configure(this._platformCapabilities);e.leftContextCodePoints||(e.leftContextCodePoints=e.leftContextCodeUnits),e.rightContextCodePoints||(e.rightContextCodePoints=e.rightContextCodeUnits),e.leftContextCodePoints||(e.leftContextCodePoints=this._platformCapabilities.maxLeftContextCodePoints),e.rightContextCodePoints||(e.rightContextCodePoints=this._platformCapabilities.maxRightContextCodePoints||0),r.languageUsesCasing&&!r.applyCasing&&(r.applyCasing=Er);let t=this.transitionToReadyState(r);e.wordbreaksAfterSuggestions===void 0&&(e.wordbreaksAfterSuggestions=t.punctuation.insertAfterWord!=""),this.cast("ready",{configuration:e})}catch(e){this.error("loadModel failed!",e)}}loadModelFile(r){try{this._importScripts(r)}catch(e){this.error("Error occurred when attempting to load dictionary",e)}}unloadModel(){this.transitionToLoadingState()}setupConfigState(){this.state={name:"unconfigured",handleMessage:r=>{if(r.message!=="config")throw new Error(\`invalid message; expected 'config' but got \${r.message}\`);this._platformCapabilities=r.capabilities,this._testMode=!!r.testMode,this.transitionToLoadingState()}}}transitionToLoadingState(){let r=this;this.state={name:"modelless",handleMessage:e=>{if(e.message!=="load")throw new Error(\`invalid message; expected 'load' but got \${e.message}\`);if(e.source.type=="file")r.loadModelFile(e.source.file);else{let t=e.source.code;new Function("LMLayerWorker","models","correction","wordBreakers",t)(r,Cr,Wr,pr)}}}}transitionToReadyState(r){let e=new J(r,this._testMode);return this.state={name:"ready",handleMessage:t=>{switch(t.message){case"predict":var{transform:o,context:d}=t;e.predict(o,d).then(x=>{this.cast("suggestions",{token:t.token,suggestions:x})});break;case"wordbreak":let s=X(r.wordbreaker||v,t.context);this.cast("currentword",{token:t.token,word:s});break;case"unload":this.unloadModel();break;case"accept":var{suggestion:a,context:d,postTransform:i}=t,p=e.acceptSuggestion(a,d,i);this.cast("postaccept",{token:t.token,reversion:p});break;case"revert":var{reversion:p,context:d}=t;e.applyReversion(p,d).then(x=>{this.cast("postrevert",{token:t.token,suggestions:x})});break;case"reset-context":var{context:d}=t;e.resetContext(d);break;default:throw new Error(\`invalid message; expected one of {'predict', 'wordbreak', 'accept', 'revert', 'reset-context', 'unload'} but got \${t.message}\`)}},compositor:e},e}static install(r){let e=new br({postMessage:r.postMessage,importScripts:r.importScripts.bind(r)});return r.onmessage=e.onMessage.bind(e),e.self=r,r.LMLayerWorker=e,r.models=Cr,r.correction=Wr,r.wordBreakers=pr,e}};l(br,"LMLayerWorker");var rr=br;typeof self!="undefined"&&"postMessage"in self&&"importScripts"in self?rr.install(self):window.LMLayerWorker=rr;})();
//# sourceMappingURL=worker-main.min.js.map
`,pr="";var ii=class ii{static constructInstance(){return new Worker(this.asBlobURI(Gr))}static asBlobURI(e){let t=BB(e);t+=`
`+pr;let n=new Blob([t],{type:"text/javascript"});return URL.createObjectURL(n)}};r(ii,"DefaultWorker");var nn=ii;var li=class li extends V.default{constructor(t,n,s=!1){super();this._mayPredict=!0;this._mayCorrect=!0;this._state="inactive";this.recentTranscriptions=n;let B={maxLeftContextCodePoints:64,maxRightContextCodePoints:s?0:64};t&&(this.lmEngine=new en(B,t))}get activeModel(){return this.currentModel}get isConfigured(){return!!this.configuration}get state(){return this._state}unloadModel(){this.lmEngine.unloadModel(),delete this.currentModel,delete this.configuration,this._state="inactive",this.emit("statechange","inactive")}loadModel(t){if(!t)throw new Error("Null reference not allowed.");let n=t.path?"file":"raw",s=n=="file"?t.path:t.code;return this.currentModel=t,this.mayPredict&&(this._state="active",this.emit("statechange","active")),this.lmEngine.loadModel(s,n).then(B=>{this.configuration=B,this.mayPredict&&(this._state="configured",this.emit("statechange","configured"))}).catch(B=>{let c;B instanceof Error?c=B.message:c=String(B),console.error("Could not load model '"+t.id+"': "+c),this.currentModel=null,this._state="inactive",this.emit("statechange","inactive")})}invalidateContext(t,n){if(this.emit("invalidatesuggestions","context"),!this.currentModel||!this.configuration)return Promise.resolve([]);if(this.isActive)if(t){let s=t.buildTranscriptionFrom(t,null,!1);return this.predict_internal(s,!0,n)}else return Promise.resolve([]);else return Promise.resolve([])}wordbreak(t,n){if(!this.isActive)return null;let s=new Gt(N.from(t,!1),this.configuration,n);return this.lmEngine.wordbreak(s)}predict(t,n){return!this.isActive||!this.currentModel||!this.configuration?null:(this.emit("invalidatesuggestions","new"),this.predict_internal(t,!1,n))}applySuggestion(t,n,s){if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";if(!this.isConfigured)return console.warn("Could not apply suggestion; the corresponding model has been unloaded"),null;let B=this.getPredictionState(t.transformId);if(B){let c=N.from(B.preInput,!1);c.apply(t.transform);let i=c.buildTransformFrom(n);n.apply(i),this.emit("suggestionapplied",n),N.from(B.preInput,!1).apply(B.transform);let a=new Gt(B.preInput,this.configuration,s()),F=this.lmEngine.acceptSuggestion(t,a,B.transform);return F=F.then(o=>{let d={transform:B.transform,transformId:-B.token,displayAs:o.displayAs,id:o.id,tag:o.tag};return this.predictFromTarget(n,s()),d}),F}else return console.warn("Could not apply the Suggestion!"),null}applyReversion(t,n){if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";let s=this.getPredictionState(-t.transformId);if(!s)return console.warn("Could not apply the Suggestion!"),Promise.resolve([]);let B=N.from(s.preInput,!1);B.apply(t.transform);let c=B.buildTransformFrom(n);n.apply(c);let i=this.currentPromise=this.lmEngine.revertSuggestion(t,new Gt(s.preInput,this.configuration,null));return i.then(()=>this.currentPromise=this.currentPromise==i?null:this.currentPromise),i}predictFromTarget(t,n){if(!t)return null;let s=t.buildTranscriptionFrom(t,null,!1);return this.predict(s,n)}predict_internal(t,n,s){if(!t)return null;let B=new Gt(t.preInput,this.configuration,s);this.recordTranscription(t),n&&this.lmEngine.resetContext(B);let c=t.alternates;(!c||c.length==0)&&(c=[{sample:t.transform,p:1}]);let i=t.transform;var l=this.currentPromise=this.lmEngine.predict(c,B);return l.then(a=>{if(l==this.currentPromise){let F=new me(a,i.id);this.emit("suggestionsready",F),this.currentPromise=null}return a})}recordTranscription(t){this.recentTranscriptions.save(t)}getPredictionState(t){return this.recentTranscriptions.get(t)}shutdown(){this.lmEngine.shutdown()}get isActive(){return this.canEnable()?(this.activeModel||!1)&&this._mayPredict:(this._mayPredict=!1,!1)}canEnable(){return!!this.lmEngine}get mayPredict(){return this._mayPredict}set mayPredict(t){if(!this.canEnable())return;let n=this._mayPredict;if(this._mayPredict=t,n!=t&&this.activeModel){let s=t?"active":"inactive";this._state=s,this.emit("statechange",s),t&&this.isConfigured&&(this._state="configured",this.emit("statechange","configured"))}}get mayCorrect(){return this._mayCorrect}set mayCorrect(t){this._mayCorrect=t}get wordbreaksAfterSuggestions(){return this.configuration.wordbreaksAfterSuggestions}tryAcceptSuggestion(t){var s;let n={shouldSwallow:!1};return this.emit("tryaccept",t,n),(s=n.shouldSwallow)!=null?s:!1}tryRevertSuggestion(){return this.emit("tryrevert"),!1}};r(li,"LanguageProcessor");var Dn=li;var SQ=10,ri=class ri{constructor(){this.map=new Map}get(e){let t=this.map.get(e);return t&&this.save(t),t}save(e){let t=e.token>=0?e.token:-e.token;this.map.delete(t),this.map.set(t,e),this.map.size>SQ&&this.map.delete(this.map.keys().next().value)}};r(ri,"TranscriptionCache");var Kn=ri;var Pn=class Pn{constructor(e,t,n){this.contextCache=new Kn;if(!e)throw new Error("device must be defined");n||(n=Pn.DEFAULT_OPTIONS),this.contextDevice=e,this.kbdProcessor=new je(e,n),this.lngProcessor=new Dn(t,this.contextCache)}get languageProcessor(){return this.lngProcessor}get keyboardProcessor(){return this.kbdProcessor}get keyboardInterface(){return this.keyboardProcessor.keyboardInterface}get activeKeyboard(){return this.keyboardInterface.activeKeyboard}set activeKeyboard(e){this.keyboardInterface.activeKeyboard=e,this.resetContext()}get activeModel(){return this.languageProcessor.activeModel}processKeyEvent(e,t){let n=e.srcKeyboard&&this.activeKeyboard!=e.srcKeyboard,s=this.activeKeyboard;try{if(n&&(this.keyboardInterface.activeKeyboard=e.srcKeyboard),e.baseTranscriptionToken){let B=this.contextCache.get(e.baseTranscriptionToken);B?(!Ge(B.transform)||!B.preInput.isEqual(N.from(t)))&&t.restoreTo(B.preInput):console.warn("The base context for the multitap could not be found")}return this._processKeyEvent(e,t)}finally{n&&(this.keyboardInterface.activeKeyboard=s)}}_processKeyEvent(e,t){var d;let n=e.device.formFactor,s=e.isSynthetic;if((n==Z.FormFactor.Desktop||!this.activeKeyboard||this.activeKeyboard.usesDesktopLayoutOnDevice(e.device))&&s&&this.keyboardProcessor.selectLayer(e))return new st;if(this.keyboardProcessor.doModifierPress(e,t,!s)&&!s)return new st;if(this.languageProcessor.isActive){if((e.kName=="K_BKSP"||e.Lcode==m.keyCodes.K_BKSP)&&this.languageProcessor.tryRevertSuggestion())return new st;if((e.kName=="K_SPACE"||e.Lcode==m.keyCodes.K_SPACE)&&this.languageProcessor.tryAcceptSuggestion("space"))return new st}let B=N.from(t,!0),c=this.keyboardProcessor.layerId,i=this.keyboardProcessor.processKeystroke(e,t);e.kNextLayer&&this.keyboardProcessor.selectLayer(e);let l=m.isFrameKey(e.kName);Ge((d=i==null?void 0:i.transcription)==null?void 0:d.transform)&&e.kNextLayer&&(l=!0);let a=i!=null;if(a){let U=l?null:this.buildAlternates(i,e,B);i.finalize(this.keyboardProcessor,t,!1),U&&U.length>0&&(i.transcription.alternates=U)}else i=new st,i.transcription=t.buildTranscriptionFrom(t,null,!1),i.triggersDefaultCommand=!0;this.contextCache.save(i.transcription);let F=i.setStore[33]||e.kNextLayer;this.keyboardProcessor.newLayerStore.set(F?this.keyboardProcessor.layerId:""),this.keyboardProcessor.oldLayerStore.set(F?c:"");let o=this.keyboardProcessor.processPostKeystroke(this.contextDevice,t);return o&&o.finalize(this.keyboardProcessor,t,!0),i.predictionPromise=this.languageProcessor.predict(i.transcription,this.keyboardProcessor.layerId),i.triggersDefaultCommand||t.doInputEvent(),a?i:null}buildAlternates(e,t,n){let s;if(this.languageProcessor.isActive&&!e.triggersDefaultCommand){let B=t.keyDistribution,i=new Gt(n,Gt.ENGINE_RULE_WINDOW,this.keyboardProcessor.layerId).toMock();if(this.languageProcessor.isActive&&B&&t.kbdLayer){let l=Number.MAX_VALUE,a=Te(),F;a.performance&&a.performance.now&&(F=r(function(){return a.performance.now()},"timer"),l=F()+16);let o=Math.exp(-5);B.sort((U,u)=>u.p-U.p),s=[];let d=0;for(let U of B){if(U.p<o){d+=U.p;break}else if(F&&F()>=l)break;let u=N.from(i,!1),g=U.keySpec;if(!g){console.warn("Internal error:  failed to properly filter set of keys for corrections");continue}let y=this.keyboardProcessor.activeKeyboard.constructKeyEvent(g,t.device,this.keyboardProcessor.stateKeys),x=this.keyboardProcessor.processKeystroke(y,u);if(x&&!x.beep&&U.p>0){let G=x.transcription.transform;G.id=e.transcription.token,s.push({sample:G,p:U.p}),d+=U.p}}s.forEach(function(U){U.p/=d})}}return s}resetContext(e){this.keyboardProcessor.resetContext(e),this.languageProcessor.invalidateContext(e,this.keyboardProcessor.layerId)}};r(Pn,"InputProcessor"),Pn.DEFAULT_OPTIONS={baseLayout:"us"};var jn=Pn;var Qi=class Qi{constructor(e,t,n,s){this.Pelem=e,this.Peventname=t.toLowerCase(),this.Phandler=n,this.PuseCapture=s}equals(e){return this.Pelem==e.Pelem&&this.Peventname==e.Peventname&&this.Phandler==e.Phandler&&this.PuseCapture==e.PuseCapture}};r(Qi,"DomEventTracking");var cB=Qi,ai=class ai{constructor(){this.domEvents=[]}attachDOMEvent(e,t,n,s){this.detachDOMEvent(e,t,n,s),e.addEventListener(t,n,!!s);var B=new cB(e,t,n,s);this.domEvents.push(B)}detachDOMEvent(e,t,n,s){e.removeEventListener(t,n,s);for(var B=new cB(e,t,n,s),c=0;c<this.domEvents.length;c++)if(this.domEvents[c].equals(B)){this.domEvents.splice(c,1);break}}shutdown(){for(let e of this.domEvents)this.detachDOMEvent(e.Pelem,e.Peventname,e.Phandler,e.PuseCapture)}};r(ai,"DomEventTracker");var pt=ai;var Fi=class Fi extends V.default{constructor(e){super(),e instanceof V.default?(e.on=this.listenerRegistrationSpy("listeneradded",e,e.on),e.addListener=this.listenerRegistrationSpy("listeneradded",e,e.addListener),e.off=this.listenerRegistrationSpy("listenerremoved",e,e.off),e.removeListener=this.listenerRegistrationSpy("listenerremoved",e,e.off)):(e.addEventListener=this.listenerRegistrationSpy("listeneradded",e,e.addEventListener),e.removeEventListener=this.listenerRegistrationSpy("listenerremoved",e,e.removeEventListener))}listenerRegistrationSpy(e,t,n){return(s,B)=>{let c=n.apply(t,[s,B]);return this.emit(e,s),c}}};r(Fi,"EmitterListenerSpy");var sn=Fi;var oi=class oi{constructor(){this.events={};this.currentEvents=[]}addEventListener(e,t){return this._removeEventListener(e,t),this.events[e].push(t),!0}removeEventListener(e,t){return this._removeEventListener(e,t)}_removeEventListener(e,t){typeof this.events[e]=="undefined"&&(this.events[e]=[]);for(var n=0;n<this.events[e].length;n++)if(this.events[e][n]==t)return this.events[e].splice(n,1),!0;return!1}callEvent(e,t){if(typeof this.events[e]=="undefined")return!0;if(this.currentEvents.indexOf(e)!=-1)return!1;this.currentEvents.push(e);for(var n=0;n<this.events[e].length;n++){var s=this.events[e][n],B=!1;try{B=s(t)}catch(c){console.error(c),B=!1}if(B===!1)return this.currentEvents.pop(),!1}return this.currentEvents.pop(),!0}listenerCount(e){let t=this.events[e];return t?t.length:0}shutdown(){this.events={}}};r(oi,"LegacyEventEmitter");var Bn=oi;var Ui=class Ui{constructor(e=!1){this.fileLocal=e}request(e){let t=new J,n=window.setTimeout(()=>{t.reject(new Error(hr))},1e4),s="&timerid="+n,B=e+s,c=document.createElement("script");c.onload=i=>{window.clearTimeout(n),t.isResolved||t.reject(new Error(mr))},c.onerror=(i,l,a,F,o)=>{window.clearTimeout(n);let d=wc;o&&(d=d+": "+o.message),t.reject(new Error(d))},this.fileLocal?c.src=e:c.src=B;try{document.body.appendChild(c)}catch(i){document.getElementsByTagName("head")[0].appendChild(c)}return t.finally(()=>{clearTimeout(n)}),{promise:t,queryId:n}}};r(Ui,"DOMCloudRequester");var _n=Ui;function VQ(){return typeof window.KeymanWeb_BaseLayout!="undefined"?window.KeymanWeb_BaseLayout:"us"}r(VQ,"determineBaseLayout");var di=class di{constructor(e,t,n,s){this.legacyAPIEvents=new Bn;this.keyEventListener=r((e,t)=>{var B;let n=this.contextManager.activeTarget;if(!this.contextManager.activeKeyboard||!n){t&&t(null,null);return}if(this.keyEventRefocus&&this.keyEventRefocus(),n.invalidateSelection(),n.deadkeys().deleteMatched(),e.isSynthetic){let c=this.osk.vkbd.layerId;c&&c!=this.core.keyboardProcessor.layerId&&(this.core.keyboardProcessor.layerId=c)}let s=this.core.processKeyEvent(e,n);s&&((B=s.transcription)!=null&&B.transform)&&this.config.onRuleFinalization(s,this.contextManager.activeTarget),t&&t(s,null)},"keyEventListener");this.config=t,this.contextManager=n;let B=s(this);B.baseLayout=VQ(),this.interface=B.keyboardInterface,this.core=new jn(t.hostDevice,e,B),this.core.languageProcessor.on("statechange",c=>{var i,l;(i=this.osk)==null||i.bannerController.selectBanner(c),(l=this.osk)==null||l.refreshLayout()}),this.core.keyboardProcessor.on("statekeychange",c=>{var i,l;(l=(i=this.osk)==null?void 0:i.vkbd)==null||l.updateStateKeys(c)}),this.contextManager.on("beforekeyboardchange",c=>{this.legacyAPIEvents.callEvent("beforekeyboardchange",{internalName:c==null?void 0:c.id,languageCode:c==null?void 0:c.langId})}),this.contextManager.on("keyboardchange",c=>{c||this.osk.startHide(!1);let i=r(()=>{var l,a;this.refreshModel(),this.core.activeKeyboard=c==null?void 0:c.keyboard,this.legacyAPIEvents.callEvent("keyboardchange",{internalName:(l=c==null?void 0:c.metadata.id)!=null?l:"",languageCode:(a=c==null?void 0:c.metadata.langId)!=null?a:""})},"prepareKeyboardSwap");this.osk?this.osk.batchLayoutAfter(()=>{i(),this.osk.activeKeyboard=c,this.contextManager.resetContext(),this.osk.present()}):(i(),this.contextManager.resetContext())}),this.contextManager.on("keyboardasyncload",c=>{var i,l;this.config.hostDevice.touchable&&((i=this.osk)!=null&&i.activationModel)&&(this.osk.activationModel.enabled=!0),(l=this.osk)==null||l.startHide(!1)})}init(e){return E(this,null,function*(){let t=this.config;if(t.deferForInitialization.isResolved)return Promise.resolve();t.initialize(e),String.kmwEnableSupplementaryPlane(!0);let n=new nB(this.interface,t.applyCacheBusting);this.keyboardRequisitioner=new $e(n,new _n,this.config.paths),this.modelCache=new tn;let s=this.keyboardRequisitioner.cache;this.contextManager.configure({resetContext:B=>{this.osk?this.osk.batchLayoutAfter(()=>{this.core.resetContext(B)}):this.core.resetContext(B)},predictionContext:new xe(this.core.languageProcessor,this.core.keyboardProcessor),keyboardCache:this.keyboardRequisitioner.cache}),this.config.on("spacebartext",()=>{var B;(B=this.osk)==null||B.refreshLayout()}),s.on("stubadded",B=>{let c=r(()=>{this.legacyAPIEvents.callEvent("keyboardregistered",{internalName:B.KI,language:B.KL,keyboardName:B.KN,languageCode:B.KLC,package:B.KP}),this.config.activateFirstKeyboard&&this.keyboardRequisitioner.cache.defaultStub==B&&this.contextManager.activateKeyboard(B.id,B.langId,!0)},"eventRaiser");this.config.deferForInitialization.isResolved?c():this.config.deferForInitialization.then(c)}),s.on("keyboardadded",B=>{let c=r(()=>{this.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:B.id})},"eventRaiser");this.config.deferForInitialization.isResolved?c():this.config.deferForInitialization.then(c)}),this.keyboardRequisitioner.cache.on("keyboardadded",B=>{this.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:B.id})})})}get build(){return Number.parseInt(te.VERSION_PATCH,10)}get version(){return te.VERSION_RELEASE}get hardKeyboard(){return this._hardKeyboard}set hardKeyboard(e){this._hardKeyboard&&this._hardKeyboard.off("keyevent",this.keyEventListener),this._hardKeyboard=e,e.on("keyevent",this.keyEventListener)}get osk(){return this._osk}set osk(e){var t;this._osk&&(this._osk.off("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=this.osk.layerChangeHandler),this._osk=e,this.core.keyboardProcessor.contextDevice=(t=e==null?void 0:e.targetDevice)!=null?t:this.config.softDevice,e&&(this.contextManager.activeKeyboard&&(e.activeKeyboard=this.contextManager.activeKeyboard),e.on("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=e.layerChangeHandler)}getDebugInfo(){var n,s,B,c,i,l,a,F,o,d,U,u,g,y;let e=(n=this.contextManager)==null?void 0:n.activeKeyboard;return{configReport:(s=this.config)==null?void 0:s.debugReport(),keyboard:{id:Mt((c=(B=e==null?void 0:e.metadata)==null?void 0:B.id)!=null?c:""),langId:((i=e==null?void 0:e.metadata)==null?void 0:i.langId)||"",version:(a=(l=e==null?void 0:e.keyboard)==null?void 0:l.version)!=null?a:""},model:{id:((o=(F=this.core)==null?void 0:F.activeModel)==null?void 0:o.id)||""},osk:{banner:(u=(U=(d=this.osk)==null?void 0:d.banner)==null?void 0:U.banner.type)!=null?u:"",layer:((y=(g=this.osk)==null?void 0:g.vkbd)==null?void 0:y.layerId)||""}}}refreshModel(){let e=this.contextManager.activeKeyboard,t=this.modelCache.modelForLanguage(e==null?void 0:e.metadata.langId);return this.core.activeModel!=t&&(this.core.activeModel&&this.core.languageProcessor.unloadModel(),t)?this.core.languageProcessor.loadModel(t).then(()=>t):Promise.resolve(t)}addEventListener(e,t){this.legacyAPIEvents.addEventListener(e,t)}removeEventListener(e,t){this.legacyAPIEvents.removeEventListener(e,t)}shutdown(){var e;this.legacyAPIEvents.shutdown(),(e=this.osk)==null||e.shutdown()}addModel(e){var n;this.modelCache.register(e);let t=(n=this.contextManager.activeKeyboard)==null?void 0:n.metadata;return t&&e.languages.indexOf(t.langId)!=-1?this.refreshModel().then(()=>{}):Promise.resolve()}removeModel(e){this.modelCache.unregister(e),this.core.activeModel&&this.core.activeModel.id==e&&this.core.languageProcessor.unloadModel()}setActiveKeyboard(e,t){return E(this,null,function*(){return this.contextManager.activateKeyboard(e,t,!0)})}getActiveKeyboard(){var e,t;return(t=(e=this.contextManager.activeKeyboard)==null?void 0:e.metadata.id)!=null?t:""}getActiveLanguage(e){var n,s,B;let t=(n=this.contextManager.activeKeyboard)==null?void 0:n.metadata;return e?(B=t==null?void 0:t.langName)!=null?B:"":(s=t==null?void 0:t.langId)!=null?s:""}isChiral(e){let t;if(e){if(typeof e=="string"){let n=this.keyboardRequisitioner.cache.getKeyboard(e);if(n)e=n;else throw new Error(`Keyboard '${e}' has not been loaded.`)}t=e}else t=this.core.activeKeyboard;return t.isChiral}resetContext(){this.contextManager.resetContext()}setNumericLayer(){this.core.keyboardProcessor.setNumericLayer(this.config.softDevice)}};r(di,"KeymanEngine");var cn=di;var ie=class ie{get height(){return this._height}set height(e){this._height=e>0?e:0,this.update()}get width(){return this._width}set width(e){this._width=e,this.update()}update(){let e=this.div.style,t=e.height,n=e.display;return this._height>0?(e.height=this._height+"px",e.display="block"):(e.height="0px",e.display="none"),t!==e.height||n!==e.display}constructor(e){let t=A("div");t.id=ie.BANNER_ID,t.className=ie.BANNER_CLASS,this.div=t,this.height=e,this.update()}appendStyleSheet(){}getDiv(){return this.div}configureForKeyboard(e,t){}shutdown(){}};r(ie,"Banner"),ie.DEFAULT_HEIGHT=37,ie.BANNER_CLASS="kmw-banner-bar",ie.BANNER_ID="kmw-banner-bar";var Ft=ie;var Ot=class Ot{constructor(e){let t=typeof e=="string"?Ot.parseLengthStyle(e):e;this.val=t.val,this.absolute=t.absolute,t.special&&(this.special=t.special)}get styleString(){return this.absolute?this.val+"px":this.special?this.val+this.special:this.val*100+"%"}scaledBy(e){return new Ot({val:e*this.val,absolute:this.absolute})}static inPixels(e){return new Ot({val:e,absolute:!0})}static inPercent(e){return new Ot({val:e/100,absolute:!1})}static forScalar(e){return new Ot({val:e,absolute:!1})}static special(e,t){return new Ot({val:e,absolute:!1,special:t})}static parseLengthStyle(e){if(e=="")return Xr;let t=parseFloat(e);return isNaN(t)?(console.error("Could not properly parse specified length style info: '"+e+"'."),Xr):e.indexOf("px")!=-1?{val:t,absolute:!0}:e.indexOf("pt")!=-1?{val:4*t/3,absolute:!0}:e.indexOf("%")!=-1?{val:t/100,absolute:!1}:e.indexOf("rem")!=-1?{val:t,absolute:!1,special:"rem"}:e.indexOf("em")!=-1?{val:t,absolute:!1,special:"em"}:{val:4*t/3,absolute:!0}}};r(Ot,"ParsedLengthStyle");var p=Ot,Xr=new p("1em");var gi=class gi extends Ft{constructor(){super(0);this.type="blank"}};r(gi,"BlankBanner");var le=gi;var ui=class ui{constructor(){this._activeBannerHeight=Ft.DEFAULT_HEIGHT;this.events=new V.default;this.constructContainer()}constructContainer(){let e=A("div");return e.id="keymanweb_banner_container",e.className="kmw-banner-container",this.bannerContainer=e}get element(){return this.bannerContainer}appendStyles(){this.currentBanner&&this.currentBanner.appendStyleSheet()}get banner(){return this.currentBanner}set banner(e){if(this.currentBanner){if(e==this.currentBanner)return;{let t=this.currentBanner;this.currentBanner=e,this.bannerContainer.replaceChild(e.getDiv(),t.getDiv()),t.shutdown()}}else this.currentBanner=e,e&&this.bannerContainer.appendChild(e.getDiv());e instanceof le||(e.height=this.activeBannerHeight),this.events.emit("bannerchange")}get height(){return this.currentBanner?this.currentBanner.height:0}get activeBannerHeight(){return this._activeBannerHeight}set activeBannerHeight(e){this._activeBannerHeight=e,this.currentBanner&&!(this.currentBanner instanceof le)&&(this.currentBanner.height=e)}get layoutHeight(){return p.inPixels(this.height)}get width(){var e;return(e=this.currentBanner)==null?void 0:e.width}set width(e){this.currentBanner&&(this.currentBanner.width=e)}refreshLayout(){var e,t;(t=(e=this.currentBanner).refreshLayout)==null||t.call(e)}};r(ui,"BannerView");var iB=ui;var yi=class yi extends Ft{constructor(t,n){var e=(...args)=>{super(...args)};t.length>0?(e(),n&&(this.height=n)):e(0),this.type="image",t.indexOf("base64")>=0?console.log("Loading img from base64 data"):console.log("Loading img with src '"+t+"'"),this.img=document.createElement("img"),this.img.setAttribute("src",t);let s=this.img.style;s.width="100%",s.height="100%",this.getDiv().appendChild(this.img),console.log("Image loaded.")}setImagePath(t){this.img&&this.img.setAttribute("src",t)}};r(yi,"ImageBanner");var lB=yi;function Rt(Q,e){e instanceof Error?console.error(`${Q}: ${e.message}

${e.stack}`):(console.error(Q),console.error(e))}r(Rt,"reportError");var Ii=class Ii{constructor(e){this.queue=[],this.defaultWaitFactory=e||(()=>Qt(0))}get defaultWait(){return this.defaultWaitFactory()}get ready(){return this.queue.length==0&&!this.waitLock}triggerNextClosure(){return E(this,null,function*(){if(this.queue.length==0)return;let e=this.queue.shift();this.waitLock=Promise.resolve();let t;try{t=e()}catch(n){Rt("Error from queued closure",n)}t=t!=null?t:this.defaultWaitFactory(),this.waitLock=t;try{yield t}catch(n){Rt("Async error from queued closure",n)}this.waitLock=null,this.triggerNextClosure()})}runAsync(e){let t=this.ready;this.queue.push(e),t&&this.triggerNextClosure()}};r(Ii,"AsyncClosureDispatchQueue");var rB=Ii;function Sr(Q){return"targetX"in Q&&"targetY"in Q&&"t"in Q}r(Sr,"isAnInputSample");var re=class re{constructor(e){this.rawLinearSums={x:0,y:0,t:0};this.coordArcSum=0;this._sampleCount=0;if(e)if(e instanceof re)Object.assign(this,e),this.rawLinearSums=b({},e.rawLinearSums);else if(Sr(e))Object.assign(this,this.extend(e));else throw new Error("A constructor for this input pattern has not yet been implemented")}extend(e){return this._extend(new re(this),e)}_extend(e,t){e._initialSample||(e._initialSample=t,e.baseSample=t);let n=e.baseSample;this.followingSample=t;let s=t.targetX-n.targetX,B=t.targetY-n.targetY,c=t.t-n.t;if(e.rawLinearSums.x+=s,e.rawLinearSums.y+=B,e.rawLinearSums.t+=c,this.lastSample){let i=t.targetX-this.lastSample.targetX,l=t.targetY-this.lastSample.targetY,a=i*i+l*l,F=Math.sqrt(a);e.coordArcSum+=F}return e._lastSample=t,e.sampleCount=this.sampleCount+1,e}deaccumulate(e){let t=new re(this);return this._deaccumulate(t,e)}_deaccumulate(e,t){if(!t)return e;if(!t.followingSample||!t.lastSample)throw"Invalid argument:  stats missing necessary tracking variable.";for(let n in e.rawLinearSums){let s=n;e.rawLinearSums[s]-=t.rawLinearSums[s]}if(t.followingSample&&t.lastSample){let n=t.followingSample.targetX-t.lastSample.targetX,s=t.followingSample.targetY-t.lastSample.targetY,B=n*n+s*s,c=Math.sqrt(B);e.coordArcSum-=c,e.coordArcSum-=t.coordArcSum}return e.sampleCount-=t.sampleCount,e._initialSample=t.followingSample,e}translateCoordSystem(e){let t=new re(this);return this._translateCoordSystem(t,e)}_translateCoordSystem(e,t){if(this.sampleCount==0)return e;let n=e.initialSample==e.lastSample;return e._initialSample=t(e.initialSample),e.baseSample=t(e.baseSample),e._lastSample=n?e._initialSample:t(e.lastSample),e}replaceInitialSample(e){let t=new re(this);return this._replaceInitialSample(t,e)}_replaceInitialSample(e,t){if(this.sampleCount==0)throw new Error("no sample available to replace");let n=e.initialSample;if(e._initialSample=t,this.sampleCount>1){let s=t.targetX-n.targetX,B=t.targetY-n.targetY,c=t.t-n.t;e.rawLinearSums.x+=s,e.rawLinearSums.y+=B,e.rawLinearSums.t+=c;let i=s*s+B*B,l=Math.sqrt(i);e.coordArcSum+=l}else e._lastSample=t;return e}get lastSample(){return this._lastSample}get lastTimestamp(){var e;return(e=this.lastSample)==null?void 0:e.t}get sampleCount(){return this._sampleCount}set sampleCount(e){this._sampleCount=e}get initialSample(){return this._initialSample}mappingConstant(e){if(this.baseSample)return e=="t"?this.baseSample.t:e=="x"?this.baseSample.targetX:e=="y"?this.baseSample.targetY:0}mean(e){return this.rawLinearSums[e]/this.sampleCount+this.mappingConstant(e)}get netDistance(){if(!this.lastSample||!this.initialSample)return 0;let e=this.lastSample.targetX-this.initialSample.targetX,t=this.lastSample.targetY-this.initialSample.targetY;return Math.sqrt(e*e+t*t)}get duration(){return!this.lastSample||!this.initialSample?0:this.lastSample.t-this.initialSample.t}get angle(){if(this.sampleCount==1||!this.lastSample||!this.initialSample)return;if(this.netDistance<1)return;let e=this.lastSample.targetX-this.initialSample.targetX,t=this.lastSample.targetY-this.initialSample.targetY,n=Math.acos(-t/this.netDistance);return e<0?2*Math.PI-n:n}get angleInDegrees(){return this.angle*180/Math.PI}get cardinalDirection(){if(this.sampleCount==1||!this.lastSample||!this.initialSample||isNaN(this.angle)||this.angle===null||this.angle===void 0)return;let e=["n","ne","e","se","s","sw","w","nw","n"],t=Math.ceil((this.angleInDegrees-22.5)/45);return e[t]}get speed(){return this.duration?this.netDistance/this.duration:0}get rawDistance(){return this.coordArcSum}toJSON(){return{angle:this.angle,cardinal:this.cardinalDirection,netDistance:this.netDistance,duration:this.duration,sampleCount:this.sampleCount,rawDistance:this.rawDistance}}};r(re,"CumulativePathStats");var Ht=re;function Se(Q,e){let t=Q.gestures.find(n=>n.id==e);if(!t)throw new Error(`Could not find spec for gesture with id '${e}'`);return t}r(Se,"getGestureModel");function bi(Q,e){let t=Q.sets[e];if(!t)throw new Error(`Could not find a defined gesture-set with id '${e}'`);let n=Q.gestures.filter(B=>!!t.find(c=>B.id==c)),s=t.filter(B=>!n.find(c=>c.id==B));if(s.length>0)throw new Error(`Set '${e}' cannot find definitions for gestures with ids ${s}`);return n}r(bi,"getGestureModelSet");var hi={gestures:[],sets:{default:[]}};var mi=class mi{constructor(){}getBoundingClientRect(){return new DOMRect(0,0,Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0))}};r(mi,"ViewportZoneSource");var QB=mi;var xi=class xi{get edgePadding(){return this._edgePadding}constructor(e,t){Array.isArray(e)&&(t=e,e=new QB),this.root=e,t=t||[0,0,0,0],this.updatePadding(t)}updatePadding(e){switch(e.length){case 1:let t=e[0];this._edgePadding={x:t,y:t,w:2*t,h:2*t};break;case 2:this._edgePadding={x:e[1],y:e[0],w:2*e[1],h:2*e[0]};break;case 3:this._edgePadding={x:e[1],y:e[0],w:2*e[1],h:e[0]+e[2]};break;case 4:this._edgePadding={x:e[3],y:e[0],w:e[1]+e[3],h:e[0]+e[2]};break;default:throw new Error("Invalid values for PaddedZoneSource's edgePadding - must be between 1 to 4 `number` values.")}}getBoundingClientRect(){let e=this.root.getBoundingClientRect();return new DOMRect(e.left+this.edgePadding.x,e.top+this.edgePadding.y,e.width-this.edgePadding.w,e.height-this.edgePadding.h)}};r(xi,"PaddedZoneSource");var ot=xi;function aB(Q){var t,n,s,B,c,i,l;let e=b({},Q);if(e.mouseEventRoot=(t=e.mouseEventRoot)!=null?t:e.targetRoot,e.touchEventRoot=(n=e.touchEventRoot)!=null?n:e.targetRoot,e.inputStartBounds=(s=e.inputStartBounds)!=null?s:e.targetRoot,e.maxRoamingBounds=(B=e.maxRoamingBounds)!=null?B:e.targetRoot,e.safeBounds=(c=e.safeBounds)!=null?c:new ot([2]),e.itemIdentifier=(i=e.itemIdentifier)!=null?i:()=>null,e.recordingMode=!!e.recordingMode,e.historyLength=((l=e.historyLength)!=null?l:0)>0?e.historyLength:0,Q.paddedSafeBounds)delete e.safeBoundPadding;else{let a=Q.safeBoundPadding;typeof a=="number"&&(a=[a]),a=a!=null?a:[3],e.paddedSafeBounds=new ot(e.safeBounds,a)}return e}r(aB,"preprocessRecognizerConfig");var FB=class FB extends V.default{constructor(){super();this._isComplete=!1;this._stats=new Ht}get stats(){return this._stats}clone(){let t=new FB;return t._isComplete=this._isComplete,t._wasCancelled=this._wasCancelled,t._stats=new Ht(this._stats),t}get isComplete(){return this._isComplete}get wasCancelled(){return this._wasCancelled}translateCoordSystem(t){this._stats=this._stats.translateCoordSystem(t)}replaceInitialSample(t){this._stats=this._stats.replaceInitialSample(t)}extend(t){if(this._isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this._stats=this._stats.extend(t),this.emit("step",t)}terminate(t=!1){this._isComplete||(this._wasCancelled=t,this._isComplete=!0,t?this.emit("invalidated"):this.emit("complete"),this.removeAllListeners())}toJSON(){return{stats:this.stats,wasCancelled:this.wasCancelled}}};r(FB,"GesturePath");var ln=FB;var qn=class qn extends ln{constructor(){super(...arguments);this.samples=[]}clone(){let t=new qn;return t.samples=[].concat(this.samples),t._isComplete=this._isComplete,t._wasCancelled=this._wasCancelled,t._stats=new Ht(this._stats),t}static deserialize(t){let n=new qn;n.samples=[].concat(t.coords.map(B=>b({},B))),n._isComplete=!0,n._wasCancelled=t.wasCancelled;let s=n.samples.reduce((B,c)=>B.extend(c),new Ht);return n._stats=s,n}extend(t){if(this.isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this.samples.push(t),super.extend(t)}translateCoordSystem(t){super.translateCoordSystem(t);for(let n=0;n<this.samples.length;n++)this.samples[n]=t(this.samples[n])}get coords(){return this.samples}toJSON(){let t={coords:[].concat(this.samples.map(n=>({targetX:n.targetX,targetY:n.targetY,t:n.t,item:n.item}))),wasCancelled:this.wasCancelled,stats:this.stats};for(let n of t.coords)delete n.clientX,delete n.clientY,n.item===void 0&&delete n.item;return t}};r(qn,"GestureDebugPath");var Qe=qn;var Ci=class Ci{constructor(e,t,n,s){this.stateToken=null;this.rawIdentifier=e,this.isFromTouch=n,this._path=s?new s:new ln,this.recognizerConfigStack=Array.isArray(t)?t:[t]}get path(){return this._path}setGestureMatchInspector(e){if(this._matchInspectionClosure)throw new Error("Invalid state:  the match-inspection closure has already been set");this._matchInspectionClosure=e}update(e){this.path.extend(e),this._baseItem||(this._baseItem=e.item)}get baseItem(){return this._baseItem}set baseItem(e){this._baseItem=e}get currentSample(){return this.path.stats.lastSample}get potentialModelMatchIds(){return this._matchInspectionClosure(this)}constructSubview(e,t,n){return new it(this,this.recognizerConfigStack,e,t,n)}terminate(e){this.path.terminate(e)}get isPathComplete(){return this.path.isComplete}get identifier(){return`${this.isFromTouch?"touch":"mouse"}:${this.rawIdentifier}`}pushRecognizerConfig(e){let t=L(b({},e),{mouseEventRoot:this.recognizerConfigStack[0].mouseEventRoot,touchEventRoot:this.recognizerConfigStack[0].touchEventRoot});this.recognizerConfigStack.push(aB(t))}popRecognizerConfig(){if(this.recognizerConfigStack.length==1)throw new Error("Cannot 'pop' the original recognizer-configuration for this GestureSource.");return this.recognizerConfigStack.pop()}get currentRecognizerConfig(){return this.recognizerConfigStack[this.recognizerConfigStack.length-1]}toJSON(){return{identifier:this.identifier,isFromTouch:this.isFromTouch,path:this.path.toJSON(),stateToken:this.stateToken}}};r(Ci,"GestureSource");var ut=Ci,$n=class $n extends ut{constructor(t,n,s,B,c){let i=0,l=t.path.stats.sampleCount;t instanceof $n&&(i=t._baseStartIndex);super(t.rawIdentifier,n,t.isFromTouch,Object.getPrototypeOf(t.path).constructor);let a=this._baseSource=t instanceof $n?t._baseSource:t;this.stateToken=c!=null?c:t.stateToken;let F=r(g=>{let y=this.recognizerTranslation,x=L(b({},g),{targetX:g.targetX-y.x,targetY:g.targetY-y.y});return this.stateToken&&(x.stateToken=this.stateToken),(this.stateToken!=a.stateToken||this.stateToken!=t.stateToken)&&(x.item=this.currentRecognizerConfig.itemIdentifier(x,null)),x},"translateSample"),o=t.path.stats.lastSample;s?(this._baseStartIndex=i=Math.max(i+l-1,0),l=l>0?1:0):this._baseStartIndex=i,s?t.path.stats.sampleCount&&this._path.extend(t.path.stats.lastSample):this._path=t.path.clone(),this._path.translateCoordSystem(F),B?this._baseItem=t.baseItem:this._baseItem=o==null?void 0:o.item;let d=r(()=>this.path.terminate(!1),"completeHook"),U=r(()=>this.path.terminate(!0),"invalidatedHook"),u=r(g=>{super.update(F(g))},"stepHook");a.path.on("complete",d),a.path.on("invalidated",U),a.path.on("step",u),this.subviewDisconnector=()=>{a.path.off("complete",d),a.path.off("invalidated",U),a.path.off("step",u)},a.isPathComplete&&(this.path.terminate(a.path.wasCancelled),this.disconnect())}get recognizerTranslation(){if(this.recognizerConfigStack.length==1||!this.currentRecognizerConfig)return{x:0,y:0};let n=this.currentRecognizerConfig.targetRoot.getBoundingClientRect(),s=this.recognizerConfigStack[0].targetRoot.getBoundingClientRect();return{x:n.left-s.left,y:n.top-s.top}}get baseSource(){return this._baseSource}disconnect(){this.subviewDisconnector&&(this.subviewDisconnector(),this.subviewDisconnector=null)}pushRecognizerConfig(t){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")}popRecognizerConfig(){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")}update(t){throw new Error("Updates should be provided through the base GestureSource.")}terminate(t){this.baseSource.terminate(t)}};r($n,"GestureSourceSubview");var it=$n;var UB=class UB extends ut{constructor(t,n,s){super(t,n,s,Qe);this.stateToken=null}initPath(){return new Qe}static deserialize(t,n){let s=n!==void 0?n:this._jsonIdSeed++,B=t.isFromTouch,c=Qe.deserialize(t.path),i=new UB(s,null,B);return i._path=c,i}};r(UB,"GestureDebugSource");var oB=UB;var ts=class ts extends V.default{constructor(t){var n;super();this._activeTouchpoints=[];this.identifierMap={};this.config=t,this.sourceConstructor=(n=t==null?void 0:t.recordingMode)==null||n?oB:ut}createTouchpoint(t,n){let s=ts.IDENTIFIER_SEED++;this.identifierMap[t]=s;let B=new this.sourceConstructor(s,this.config,n);return B.stateToken=this.stateToken,B}fulfillInputStart(t){}maintainTouchpoints(t){t||(t=[]),this._activeTouchpoints.filter(n=>!t.includes(n)).forEach(n=>n.terminate(!0))}hasActiveTouchpoint(t){return this.identifierMap[t]!==void 0}getTouchpointWithId(t){let n=this.identifierMap[t];return this._activeTouchpoints.find(s=>s.rawIdentifier==n)}getConfigForId(t){return this.getTouchpointWithId(t).currentRecognizerConfig}getStateTokenForId(t){var n;return(n=this.getTouchpointWithId(t).stateToken)!=null?n:null}dropTouchpoint(t){let n=t.rawIdentifier;this._activeTouchpoints=this._activeTouchpoints.filter(s=>t!=s);for(let s of Object.keys(this.identifierMap)){let B=Number.parseInt(s,10);this.identifierMap[B]==n&&delete this.identifierMap[B]}}addTouchpoint(t){this._activeTouchpoints.push(t)}get activeSources(){return[].concat(this._activeTouchpoints)}};r(ts,"InputEngineBase"),ts.IDENTIFIER_SEED=0;var dB=ts;function Gi(Q,e,t){let n=Q.targetRoot.getBoundingClientRect();return{clientX:e,clientY:t,targetX:e-n.left,targetY:t-n.top}}r(Gi,"processSampleClientCoords");var pi=class pi extends dB{buildSampleFor(e,t,n,s,B){var a,F;let c=L(b({},Gi(this.config,e,t)),{t:s,stateToken:(a=B==null?void 0:B.stateToken)!=null?a:this.stateToken}),l=((F=B==null?void 0:B.currentRecognizerConfig.itemIdentifier)!=null?F:this.config.itemIdentifier)(c,n);return c.item=l,c}onInputStart(e,t,n,s){let B=this.createTouchpoint(e,s);B.update(t),this.addTouchpoint(B),B.path.on("invalidated",()=>{this.dropTouchpoint(B)}),B.path.on("complete",()=>{this.dropTouchpoint(B)});try{this.emit("pointstart",B)}catch(c){Rt("Engine-internal error while initializing gesture matching for new source",c)}return B}onInputMove(e,t,n){if(e)try{e.update(t)}catch(s){Rt("Error occurred while updating source",s)}}onInputMoveCancel(e,t,n){if(e)try{e.update(t),e.path.terminate(!0)}catch(s){Rt("Error occurred while cancelling further input for source",s)}}onInputEnd(e,t){if(e)try{e.path.terminate(!1)}catch(n){Rt("Error occurred while finalizing input for source",n)}}};r(pi,"InputEventEngine");var rn=pi;var Xt=class Xt{constructor(){}static getCoordZoneBitmask(e,t){let n=t.getBoundingClientRect(),s=0;return s|=e.clientX<n.left?Xt.FAR_LEFT:0,s|=e.clientX>n.right?Xt.FAR_RIGHT:0,s|=e.clientY<n.top?Xt.FAR_TOP:0,s|=e.clientY>n.bottom?Xt.FAR_BOTTOM:0,s}static inputStartOutOfBoundsCheck(e,t){return!!this.getCoordZoneBitmask(e,t.inputStartBounds)}static inputStartSafeBoundProximityCheck(e,t){return this.getCoordZoneBitmask(e,t.paddedSafeBounds)}static inputMoveCancellationCheck(e,t,n){return n=n||0,this.getCoordZoneBitmask(e,t.maxRoamingBounds)?!0:!!(this.getCoordZoneBitmask(e,t.safeBounds)&~n)}};r(Xt,"ZoneBoundaryChecker"),Xt.FAR_TOP=8,Xt.FAR_LEFT=4,Xt.FAR_BOTTOM=2,Xt.FAR_RIGHT=1;var Wt=Xt;var Xi=class Xi extends rn{constructor(t){super(t);this.hasActiveClick=!1;this.disabledSafeBounds=0;this.currentSource=null;this.activeIdentifier=0;this._mouseStart=n=>this.onMouseStart(n),this._mouseMove=n=>this.onMouseMove(n),this._mouseEnd=n=>this.onMouseEnd(n)}get eventRoot(){return this.config.mouseEventRoot}registerEventHandlers(){this.eventRoot.addEventListener("mousedown",this._mouseStart,!0),this.eventRoot.addEventListener("mousemove",this._mouseMove,!1),this.eventRoot.addEventListener("mouseup",this._mouseEnd,!0)}unregisterEventHandlers(){this.eventRoot.removeEventListener("mousedown",this._mouseStart,!0),this.eventRoot.removeEventListener("mousemove",this._mouseMove,!1),this.eventRoot.removeEventListener("mouseup",this._mouseEnd,!0)}preventPropagation(t){t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,typeof t.stopImmediatePropagation=="function"?t.stopImmediatePropagation():typeof t.stopPropagation=="function"&&t.stopPropagation()}buildSampleFromEvent(t){return this.buildSampleFor(t.clientX,t.clientY,t.target,performance.now(),this.currentSource)}onMouseStart(t){if(!this.config.targetRoot.contains(t.target))return;this.preventPropagation(t);let n=this.buildSampleFromEvent(t);Wt.inputStartOutOfBoundsCheck(n,this.config)||(this.disabledSafeBounds=Wt.inputStartSafeBoundProximityCheck(n,this.config));let s=this.onInputStart(this.activeIdentifier,n,t.target,!1);this.currentSource=s;let B=r(()=>{this.currentSource=null},"cleanup");s.path.on("complete",B),s.path.on("invalidated",B)}onMouseMove(t){let n=this.currentSource;if(!n)return;let s=this.buildSampleFromEvent(t);if(!t.buttons){this.hasActiveClick&&(this.hasActiveClick=!1,this.onInputMoveCancel(n,s,t.target));return}this.preventPropagation(t);let B=n.currentRecognizerConfig;Wt.inputMoveCancellationCheck(s,B,this.disabledSafeBounds)?this.onInputMoveCancel(n,s,t.target):this.onInputMove(n,s,t.target)}onMouseEnd(t){let n=this.currentSource;n&&(t.buttons||(this.hasActiveClick=!1),this.onInputEnd(n,t.target))}};r(Xi,"MouseEventEngine");var gB=Xi;function Vr(Q){let e=[];for(let t=0;t<Q.length;t++)e.push(Q.item(t));return e}r(Vr,"touchListToArray");var Si=class Si extends rn{constructor(t){super(t);this.eventDispatcher=new rB;this.safeBoundMaskMap={};this.pendingSourcePromises=new Map;this.inputStartSignalMap=new Map;this._touchStart=n=>this.onTouchStart(n),this._touchMove=n=>this.onTouchMove(n),this._touchEnd=n=>this.onTouchEnd(n)}get eventRoot(){return this.config.touchEventRoot}registerEventHandlers(){this.eventRoot.addEventListener("touchstart",this._touchStart,{capture:!0,passive:!1}),this.eventRoot.addEventListener("touchmove",this._touchMove,{capture:!1,passive:!1}),this.eventRoot.addEventListener("touchend",this._touchEnd,{capture:!0,passive:!1})}unregisterEventHandlers(){this.eventRoot.removeEventListener("touchstart",this._touchStart,!0),this.eventRoot.removeEventListener("touchmove",this._touchMove,!1),this.eventRoot.removeEventListener("touchend",this._touchEnd,!0)}preventPropagation(t){t.cancelable&&t.preventDefault(),typeof t.stopImmediatePropagation=="function"?t.stopImmediatePropagation():typeof t.stopPropagation=="function"&&t.stopPropagation()}dropTouchpoint(t){super.dropTouchpoint(t);for(let n of Object.keys(this.safeBoundMaskMap)){let s=Number.parseInt(n,10);this.getTouchpointWithId(s)==t&&delete this.safeBoundMaskMap[s]}}fulfillInputStart(t){let n=this.inputStartSignalMap.get(t);n&&(this.inputStartSignalMap.delete(t),n.resolve())}hasActiveTouchpoint(t){return super.hasActiveTouchpoint(t)||!!this.pendingSourcePromises.has(t)}buildSampleFromTouch(t,n,s){return this.buildSampleFor(t.clientX,t.clientY,t.target,n,s)}onTouchStart(t){if(!this.config.targetRoot.contains(t.target))return;this.preventPropagation(t);let n=Vr(t.touches),s=Vr(t.changedTouches),c=n.filter(l=>s.findIndex(a=>l.identifier==a.identifier)==-1).map(l=>this.pendingSourcePromises.get(l.identifier));this.eventDispatcher.runAsync(()=>E(this,null,function*(){let l=yield Promise.all(c);return this.maintainTouchpoints(l),this.eventDispatcher.defaultWait}));let i=new Map;for(let l=0;l<t.changedTouches.length;l++){let a=t.changedTouches.item(l),F=new J;this.pendingSourcePromises.set(a.identifier,F),i.set(a.identifier,F)}this.eventDispatcher.runAsync(()=>{let l=performance.now(),a=null;for(let F=0;F<t.changedTouches.length;F++){let o=t.changedTouches.item(F),d=o.identifier,U=this.buildSampleFromTouch(o,l,null);if(!Wt.inputStartOutOfBoundsCheck(U,this.config))this.safeBoundMaskMap[d]=Wt.inputStartSafeBoundProximityCheck(U,this.config);else{i.get(d).resolve(null);continue}a=this.onInputStart(d,U,t.target,!0);let u=i.get(d);u.resolve(a);let g=r(()=>{this.pendingSourcePromises.get(d)==u&&this.pendingSourcePromises.delete(d)},"cleanup");a.path.on("complete",g),a.path.on("invalidated",g)}if(a){let F=new J;return this.inputStartSignalMap.set(a,F),F.corePromise}else return Promise.resolve()})}onTouchMove(t){var s;for(let B=0;B<t.touches.length;B++){let c=t.touches.item(B);if(this.hasActiveTouchpoint(c.identifier)){this.preventPropagation(t);break}}let n=new Map;for(let B=0;B<t.touches.length;B++){let c=t.touches.item(B).identifier;n.set(c,(s=this.pendingSourcePromises.get(c))==null?void 0:s.corePromise)}this.eventDispatcher.runAsync(()=>E(this,null,function*(){let B=yield Promise.all(n.values());return this.maintainTouchpoints(B),this.eventDispatcher.defaultWait})),this.eventDispatcher.runAsync(()=>E(this,null,function*(){let B=performance.now();for(let c=0;c<t.touches.length;c++){let i=t.touches.item(c),l=i.identifier,a=yield n.get(l);if(!a||a.isPathComplete)continue;let F=a.currentRecognizerConfig,o=this.buildSampleFromTouch(i,B,a);Wt.inputMoveCancellationCheck(o,F,this.safeBoundMaskMap[l])?this.onInputMoveCancel(a,o,i.target):this.onInputMove(a,o,i.target)}return this.eventDispatcher.defaultWait}))}onTouchEnd(t){var s;for(let B=0;B<t.changedTouches.length;B++){let c=t.changedTouches.item(B);if(this.hasActiveTouchpoint(c.identifier)){this.preventPropagation(t);break}}let n=new Map;for(let B=0;B<t.changedTouches.length;B++){let c=t.changedTouches.item(B).identifier,i=(s=this.pendingSourcePromises.get(c))==null?void 0:s.corePromise;n.set(c,i)}this.eventDispatcher.runAsync(()=>E(this,null,function*(){for(let B=0;B<t.changedTouches.length;B++){let c=t.changedTouches.item(B),i=yield n.get(c.identifier);!i||i.isPathComplete||this.onInputEnd(i,t.target)}return this.eventDispatcher.defaultWait}))}};r(Si,"TouchEventEngine");var uB=Si;var Vi=class Vi{get promise(){return this.publishedPromise.corePromise}constructor(e,t,n){if(!e||!t)throw new Error("A gesture-path source and contact-path model must be specified.");if(this.model=e,this.publishedPromise=new J,this.source=t,this.inheritedStats=n,this.lastStats=null,e.timer){let s=e.timer.inheritElapsed?Math.min(t.path.stats.duration,e.timer.duration):0;this.timerPromise=new ft(e.timer.duration-s),this.publishedPromise.then(()=>{this.timerPromise.resolve(!1)}),this.timerPromise.then(B=>{let c=t instanceof it?t.baseSource:t,i=performance.now();!c.isPathComplete&&c.currentSample.t!=i&&c.path.extend(L(b({},c.currentSample),{t:i})),B!=e.timer.expectedResult&&this.finalize(!1,"timer"),this.finalize(!0,"timer")})}}finalize(e,t){if(this.publishedPromise.isFulfilled)return this._result;let n=this.model;n.validateItem&&e&&(e=n.validateItem(this.source.path.stats.lastSample.item,this.baseItem));let s;return e?s={type:n.pathResolutionAction,cause:t}:s={type:"reject",cause:t},this.publishedPromise.resolve(s),this._result=s,s}get stats(){return this.source.path.stats}get baseItem(){return this.source.baseItem}get lastItem(){return this.source.currentSample.item}update(){let e=this.model,t=this.source;if(t.path.wasCancelled)return this.finalize(!1,"path");if(e.itemChangeAction&&t.path.stats.sampleCount>0&&t.currentSample.item!=t.baseItem){let n=e.itemChangeAction=="resolve";return this.finalize(n,"item")}else{let n=e.pathModel.evaluate(t.path,this.lastStats,t.baseItem,this.inheritedStats)||"continue";return this.lastStats=t.path.stats,n!="continue"?this.finalize(n=="resolve","path"):t.path.isComplete?this.finalize(!1,"path"):{type:"continue"}}}};r(Vi,"PathMatcher");var Qn=Vi;var Zi=class Zi{constructor(e,t){this._isCancelled=!1;var i;if(!e||!t)throw new Error("Construction of GestureMatcher requires a gesture-model spec and a source for related contact points.");if(!e.sustainTimer&&!t)throw new Error("If the provided gesture-model spec lacks a sustain timer, there must be an active contact point.");let n=t instanceof ut?null:t,s=n?null:t;this.predecessor=n,this.publishedPromise=new J,this.model=e,e.sustainTimer&&(this.sustainTimerPromise=new ft(e.sustainTimer.duration),this.sustainTimerPromise.then(l=>{let a=e.sustainTimer.expectedResult==l;this.finalize(a,"timer")})),this.pathMatchers=[];let c=(s?[s]:n.sources).map(l=>s&&l==s?s:l.isPathComplete?null:l).reduce((l,a)=>a?l.concat(a):l,[]);if(e.sustainTimer&&c.length>0){this.finalize(!1,"path");return}else!e.sustainTimer&&c.length==0&&this.finalize(!1,"path");for(let l=0;l<c.length;l++){let a=c[l];a instanceof it&&a.disconnect();let F=e.contacts[l];if(!F)throw new Error(`No contact model for inherited path: gesture "${e.id}', entry ${l}`);let o=(i=F==null?void 0:F.model.pathInheritance)!=null?i:"chop",d=!1,U;switch(o){case"reject":this.finalize(!1,"path");return;case"full":U=a.constructSubview(!1,!0),this.addContactInternal(U,a.path.stats,!0);continue;case"partial":d=!0;case"chop":U=a.constructSubview(!0,d),this.addContactInternal(U,a.path.stats,!0);break}}}get sources(){return this.pathMatchers.map((e,t)=>{if(!this.model.contacts[t].resetOnInstantFulfill)return e.source}).filter(e=>!!e)}get promise(){return this.publishedPromise.corePromise}cancel(){this._isCancelled=!0,this._result||this.finalize(!1,"cancelled")}get isCancelled(){return this._isCancelled}finalize(e,t){var n,s;if(this.publishedPromise.isFulfilled)return this._result;try{let B;e?B=this.model.resolutionAction:(t!="cancelled"&&((n=this.model.rejectionActions)!=null&&n[t])&&(B=this.model.rejectionActions[t],B.item="none"),B=B||{type:"none",item:"none"});let c;switch((s=B.item)!=null?s:"current"){case"none":c=null;break;case"base":c=this.primaryPath.baseItem;break;case"current":c=this.primaryPath.currentSample.item;break}let l={matched:e,action:L(b({},B),{item:c})};return this.publishedPromise.resolve(l),this._result=l,l}catch(B){return this.publishedPromise.reject(B),{matched:!1,action:{type:"none",item:null}}}}finalizeSources(){if(!this._result)throw Error("Invalid state for source-finalization - the matcher's evaluation of the gesture model is not yet complete");let e=this._result.matched;for(let t=0;t<this.pathMatchers.length;t++){let n=this.pathMatchers[t],s=this.model.contacts[t];n.source.isPathComplete||(e&&s.endOnResolve||!e&&s.endOnReject)&&n.source.terminate(!1)}}get primaryPath(){let e,t=Number.NEGATIVE_INFINITY;for(let n of this.pathMatchers)n.model.itemPriority>t&&(t=n.model.itemPriority,e=n);return!e&&this.predecessor?this.predecessor.primaryPath:e==null?void 0:e.source}get baseItem(){return this.primaryPath.baseItem}get currentItem(){return this.primaryPath.currentSample.item}get allSourceIds(){let e=this.sources.map(n=>n.identifier),t=this.predecessor?this.predecessor.allSourceIds:[];return e=e.filter(n=>t.indexOf(n)==-1),e.concat(t)}mayAddContact(){return this.pathMatchers.length<this.model.contacts.length}addContact(e){let t=this.pathMatchers.length;if(!this.mayAddContact())throw new Error(`The specified gesture model does not support more than ${t} contact points.`);this.addContactInternal(e.constructSubview(!1,!0),null)}get result(){return this._result}addContactInternal(e,t,n){var F;let s=this.pathMatchers.length,B=this.model.contacts[s],c=new Qn(B.model,e,new Ht(t));this.pathMatchers.push(c);let i=null,l=null;if(!s&&this.predecessor&&this.model.sustainTimer){i=this.predecessor.primaryPath;let o=(F=this.model.sustainTimer.baseItem)!=null?F:"result",d;switch(o){case"none":l=null;break;case"base":l=this.predecessor.primaryPath.baseItem,d=this.predecessor.primaryPath.stateToken;break;case"result":l=this.predecessor.result.action.item,d=this.predecessor.primaryPath.currentSample.stateToken;break}e.baseItem=l!=null?l:e.baseItem,e.stateToken=d,e.currentSample.stateToken=d,e.currentRecognizerConfig&&(e.currentSample.item=e.currentRecognizerConfig.itemIdentifier(e.currentSample,null))}else l=this.primaryPath.baseItem,i=this.primaryPath;if(B.model.baseCoordReplacer){let o=e.path.stats,d=B.model.baseCoordReplacer(o,l);if(d){let U=L(b({},Gi(e.currentRecognizerConfig,d.clientX,d.clientY)),{t:d.t||d.t===0?d.t:o.initialSample.t,item:l,stateToken:e.stateToken});e.path.replaceInitialSample(U)}}if(B.model.allowsInitialState&&!B.model.allowsInitialState(e.currentSample,i.currentSample,l,i.stateToken)){this.pathMatchers.pop(),this.finalize(!1,"cancelled");return}let a=c.update();if((a==null?void 0:a.type)=="reject"){this.finalize(!1,n?"cancelled":"path");return}c.promise.then(o=>{this.finalize(o.type=="resolve",o.cause)})}update(){this.pathMatchers.forEach(e=>{try{e.update()}catch(t){console.error(t),this.finalize(!1,"cancelled")}})}};r(Zi,"GestureMatcher");var Ve=Zi;var Li=class Li extends V.default{constructor(t){super();this._sourceSelector=[];this.potentialMatchers=[];this.sustainMode=!1;this.attemptSynchronousUpdate=r(()=>{let n=this._sourceSelector.filter(B=>!B.source.isPathComplete).map(B=>B.source.currentSample.t),s=n[0];n.find(B=>s!=B)||this.potentialMatchers.forEach(B=>B.update())},"attemptSynchronousUpdate");this.baseGestureSetId=t||"default"}potentialMatchersForSource(t){return this.potentialMatchers.filter(n=>n.allSourceIds.find(s=>s==t.identifier))}cascadeTermination(){let t=this.potentialMatchers,n=t.filter(i=>!i.model.sustainWhenNested),s=t.filter(i=>i.model.sustainWhenNested);this.potentialMatchers=s;let B=s.map(i=>i.allSourceIds).reduce((i,l)=>{for(let a of l)i.indexOf(a)==-1&&i.push(a);return i},[]);return this._sourceSelector.filter(i=>!B.find(l=>l==i.source.identifier)).forEach(i=>{i.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}});let l=this._sourceSelector.indexOf(i);l>-1&&this._sourceSelector.splice(l,1)}),n.forEach(i=>i.cancel()),this.sustainMode=!0,this._sourceSelector.map(i=>i.source)}matchGesture(t,n){return E(this,null,function*(){let s=t instanceof ut,B=r(U=>{let u=U.sources.map(g=>g.baseSource);return u&&u.length>0?u:U.predecessor?B(U.predecessor):[]},"determinePredecessorSources"),c=s?[t instanceof it?t.baseSource:t]:B(t),i=s?t:null,l=s?null:t;if(this.pendingMatchSetup){let U=this.pendingMatchSetup,u=new J;this.pendingMatchSetup=u.corePromise,yield U,this.pendingMatchSetup==u.corePromise&&(this.pendingMatchSetup=null),u.resolve()}s&&i.path.on("invalidated",()=>{this.dropSourcesWithIds([i.identifier])});let a=new J,F=c.map(U=>{let u={source:U,matchPromise:a,preserve:!0};return this._sourceSelector.push(u),u}),o=F.map(U=>U.matchPromise);if(s){let U=this.potentialMatchers.filter(u=>u.mayAddContact());if(U.forEach(u=>{u.addContact(i),u.promise.then(this.matcherSelectionFilter(u,o))}),U.length>0){let u=this.stateToken,g=new J;this.pendingMatchSetup=g.corePromise,yield Qt(0),yield Qt(0),this.pendingMatchSetup==g.corePromise&&(this.pendingMatchSetup=null),g.resolve();let y=this.stateToken;if(u!=y){let G=i.currentSample;i.stateToken=y,G.stateToken=y,G.item=t.currentRecognizerConfig.itemIdentifier(G,null),i.baseItem=G.item}let x=U.find(G=>G.result);if(x&&x.allSourceIds.includes(t.identifier))return a.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),{selectionPromise:a.corePromise}}}if(F.forEach(U=>{U.preserve=!1}),this.sustainMode&&i)return a.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),{selectionPromise:a.corePromise,sustainModeWithoutMatch:!0};let d=n.map(U=>{try{return new Ve(U,i||l)}catch(u){return console.error(u),null}}).filter(U=>!!U);d=d.filter(U=>!U.result||U.result.matched!==!1);for(let U of d)U.promise.then(this.matcherSelectionFilter(U,o));return d.length>0?this.potentialMatchers=this.potentialMatchers.concat(d):a.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),this.potentialMatchers.sort((U,u)=>u.model.resolutionPriority-U.model.resolutionPriority),this.resetSourceHooks(),{selectionPromise:a.corePromise}})}resetSourceHooks(){let t=r(n=>{let s=n;s.path.off("step",this.attemptSynchronousUpdate),s.path.off("complete",this.attemptSynchronousUpdate),s.path.off("invalidated",this.attemptSynchronousUpdate),s.path.on("step",this.attemptSynchronousUpdate),s.path.on("complete",this.attemptSynchronousUpdate),s.path.on("invalidated",this.attemptSynchronousUpdate)},"resetHooks");this._sourceSelector.forEach(n=>t(n.source))}dropSourcesWithIds(t){for(let n of t){let s=this._sourceSelector.findIndex(B=>B.source.identifier==n);s>-1&&this._sourceSelector.splice(s,1)[0].matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"none",item:null}}})}}matchersForSource(t){return this.potentialMatchers.filter(n=>!!n.sources.find(s=>s.identifier==t.identifier))}matcherSelectionFilter(t,n){return s=>E(this,null,function*(){t.isCancelled?s={matched:!1,action:{type:"none",item:null}}:t.finalizeSources();let c=t.allSourceIds.map(l=>this._sourceSelector.find(a=>a.source.identifier==l)).filter(l=>!!l),i=this.potentialMatchers.indexOf(t);if(i!=-1){if(this.potentialMatchers.splice(i,1),s.action.type=="none"){this.finalizeMatcherlessTrackers(c);return}if(s.matched)for(let l of c){let a=this.matchersForSource(l.source);this.potentialMatchers=this.potentialMatchers.filter(F=>!a.find(o=>F==o)),a.forEach(F=>{F.cancel()}),this._sourceSelector=this._sourceSelector.filter(F=>!c.find(o=>F==o)),l.matchPromise.resolve({matcher:t,result:s})}else{let l=r(a=>{if(this.sustainMode&&!a.sustainWhenNested){this.finalizeMatcherlessTrackers(c);return}let F=new Ve(a,t);if(F.result&&F.result.matched==!1){this.finalizeMatcherlessTrackers(c);return}F.promise.then(this.matcherSelectionFilter(F,c.map(o=>o.matchPromise))),this.potentialMatchers.push(F),this.resetSourceHooks()},"replacer");this.emit("rejectionwithaction",{matcher:t,result:s},l);return}}})}finalizeMatcherlessTrackers(t){let n=t.map(s=>({tracker:s,pendingCount:this.potentialMatchers.filter(B=>!!B.allSourceIds.find(c=>s.source.identifier==c)).length}));for(let s of n)s.pendingCount==0&&!s.tracker.preserve&&s.tracker.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}})}};r(Li,"MatcherSelector");var ae=Li;var Ji=class Ji{constructor(e,t){var B,c;let{matcher:n,result:s}=e;this.gestureSetId=t,this.matchedId=n==null?void 0:n.model.id,this.linkType=s.action.type,this.item=s.action.item,this.sources=n==null?void 0:n.sources,(B=this.sources)==null||B.forEach(i=>i.disconnect()),(c=this.sources)==null||c.sort((i,l)=>(n==null?void 0:n.primaryPath)==i?-1:(n==null?void 0:n.primaryPath)==l?1:0),this.allSourceIds=(n==null?void 0:n.allSourceIds)||[]}};r(Ji,"GestureStageReport");var es=Ji,Ri=class Ri extends V.default{constructor(t,n,s,B){super();this.markedComplete=!1;this.selectionHandler=r(t=>E(this,null,function*(){var F,o,d,U,u,g,y,x,G,C;let n=((F=this.pushedSelector)==null?void 0:F.baseGestureSetId)||((o=this.selector)==null?void 0:o.baseGestureSetId),s=new es(t,n);t.matcher&&this.stageReports.push(s);let B=(d=t.matcher)!=null?d:this.stageReports[this.stageReports.length-1],c=(U=B==null?void 0:B.sources.map(h=>h instanceof it?h.baseSource:h))!=null?U:[],i=t.result.action.type;if((i=="complete"||i=="none")&&(c.forEach(h=>{h.isPathComplete||h.terminate(i=="none")}),!t.result.matched)){this.markedComplete||(this.markedComplete=!0,this.emit("complete"));return}if(i=="complete"&&this.touchpointCoordinator&&this.pushedSelector){let S=((u=this.touchpointCoordinator)==null?void 0:u.sustainSelectorSubstack(this.pushedSelector)).map(H=>{let R=new J;return H.path.on("invalidated",()=>R.resolve()),H.path.on("complete",()=>R.resolve()),R.corePromise});S.length>0&&t.result.action.awaitNested&&(yield Promise.all(S),yield Qt(0)),(g=this.touchpointCoordinator)==null||g.popSelector(this.pushedSelector),this.pushedSelector=null}this.emit("stage",s,h=>{h.type=="pop"?c.forEach(S=>S.popRecognizerConfig()):c.forEach(S=>S.pushRecognizerConfig(h.config))});let l=!1;this.touchpointCoordinator&&(l=!this.touchpointCoordinator.selectorStackIncludes(this.selector));let a=Ei(t.result.action,this.gestureConfig,this.baseGestureSetId);if(l&&(a=a.filter(h=>h.sustainWhenNested)),a.length>0){if(!(i=="chain"&&t.result.action.selectionMode==((y=this.pushedSelector)==null?void 0:y.baseGestureSetId))){if(this.pushedSelector&&(this.pushedSelector.off("rejectionwithaction",this.modelResetHandler),(x=this.touchpointCoordinator)==null||x.popSelector(this.pushedSelector),this.pushedSelector=null),i=="chain"){let H=t.result.action.selectionMode;if(H){let R=new ae(H);R.on("rejectionwithaction",this.modelResetHandler),this.pushedSelector=R,(G=this.touchpointCoordinator)==null||G.pushSelector(R)}}}((C=this.pushedSelector)!=null?C:this.selector).matchGesture(t.matcher,a).then(H=>E(this,null,function*(){return this.selectionHandler(yield H.selectionPromise)}))}else this.markedComplete||(this.markedComplete=!0,this.emit("complete"))}),"selectionHandler");this.modelResetHandler=r((t,n)=>{let s=t.matcher.allSourceIds;if(!this.allSourceIds.find(B=>s.indexOf(B)==-1))if(t.result.action.type=="replace")n(Se(this.gestureConfig,t.result.action.replace));else throw new Error("Missed a case in implementation!")},"modelResetHandler");this.stageReports=[],this.selector=s,this.selector.on("rejectionwithaction",this.modelResetHandler),this.once("complete",()=>{var c;this.pushedSelector&&((c=this.touchpointCoordinator)==null||c.popSelector(this.pushedSelector),this.pushedSelector=null),this.selector.off("rejectionwithaction",this.modelResetHandler),this.selector.dropSourcesWithIds(this.allSourceIds),this.selector=null}),this.gestureConfig=n,this.touchpointCoordinator=B,Promise.resolve().then(()=>this.selectionHandler(t))}get allSourceIds(){var t,n;return(n=(t=this.stageReports[this.stageReports.length-1])==null?void 0:t.allSourceIds)!=null?n:[]}get baseGestureSetId(){var t,n;return(n=(t=this.selector)==null?void 0:t.baseGestureSetId)!=null?n:null}get potentialModelMatchIds(){if(!this.selector)return[];let t=[this.selector];return this.pushedSelector&&t.push(this.pushedSelector),this.stageReports[this.stageReports.length-1].sources.map(c=>t.map(i=>i.potentialMatchersForSource(c).map(l=>l.model.id))).reduce((c,i)=>c.concat(i)).reduce((c,i)=>{for(let l of i)c.indexOf(l)==-1&&c.push(l);return c},[])}cancel(){this.stageReports[this.stageReports.length-1].sources.forEach(n=>n.baseSource.isPathComplete||n.baseSource.terminate(!0)),this.markedComplete||(this.markedComplete=!0,this.emit("complete"))}toJSON(){return this.stageReports}};r(Ri,"GestureSequence");var an=Ri;function Ei(Q,e,t){switch(Q.type){case"none":case"complete":return[];case"replace":return[Se(e,Q.replace)];case"chain":return[Se(e,Q.next)];default:throw new Error("Unexpected case arose within `processGestureAction` method")}}r(Ei,"modelSetForAction");var Hi=class Hi extends V.default{constructor(t,n,s){super();this.selectorStack=[new ae];this._activeSources=[];this._activeGestures=[];this._history=[];this.modelResetHandler=r((t,n)=>{let s=t.matcher.allSourceIds;if(!this.activeGestures.find(B=>B.allSourceIds.find(c=>s.indexOf(c)!=-1)))if(t.result.action.type=="replace")n(Se(this.gestureModelDefinitions,t.result.action.replace));else throw new Error("Missed a case in implementation!")},"modelResetHandler");this.onNewTrackedPath=r(t=>E(this,null,function*(){this.addSimpleSourceHooks(t);let n=this.gestureModelDefinitions,s,B;do{s=this.currentSelector;let d=yield s.matchGesture(t,bi(n,s.baseGestureSetId));if(d.sustainModeWithoutMatch){let U=r(u=>{u.stateToken=this.stateToken,u.item=t.currentRecognizerConfig.itemIdentifier(u,null)},"correctSample");t.path instanceof Qe&&t.path.coords.forEach(U),t.stateToken=this.stateToken,t.baseItem=t.path.stats.initialSample.item,U(t.path.stats.initialSample),U(t.path.stats.lastSample);continue}else{B=d.selectionPromise;break}}while(s!=this.currentSelector);let c=this.currentSelector;t.setGestureMatchInspector(this.buildGestureMatchInspector(c));let i=r(()=>{this.recordHistory(t)},"preGestureScribe");try{t.path.on("invalidated",i),this.emit("inputstart",t)}catch(o){Rt("Error from 'inputstart' event listener",o)}this.inputEngines.forEach(o=>{o.fulfillInputStart(t)});let l=yield B;if(!l||l.result.matched==!1)return;let a=l.matcher.allSourceIds;for(let o of this._activeGestures)if(o.allSourceIds.find(d=>!!a.find(U=>d==U)))return;let F=new an(l,n,this.currentSelector,this);this._activeGestures.push(F),F.on("complete",()=>{let o=this._activeGestures.indexOf(F);o!=-1&&this._activeGestures.splice(o,1)}),t.path.wasCancelled||(t.path.off("invalidated",i),F.on("complete",()=>this.recordHistory(F))),this.emit("recognizedgesture",F)}),"onNewTrackedPath");if(this.historyMax=s>0?s:0,this.gestureModelDefinitions=t,this.inputEngines=[],n)for(let B of n)this.addEngine(B);this.selectorStack[0].on("rejectionwithaction",this.modelResetHandler)}pushSelector(t){this.selectorStack.push(t),t.on("rejectionwithaction",this.modelResetHandler)}sustainSelectorSubstack(t){if(!t)return[];let n=this.selectorStack.indexOf(t);if(n==-1)return[];if(this.selectorStack.length<=1)throw new Error("May not force the original, base gesture selector into sustain mode.");let s=[];for(let B=n;B<this.selectorStack.length;B++)t=this.selectorStack[B],s=s.concat(t.cascadeTermination());return s}popSelector(t){if(!t)return;let n=this.selectorStack.indexOf(t);if(n!=-1){if(this.selectorStack.length<=1)throw new Error("May not pop the original, base gesture selector.");for(;n<this.selectorStack.length;)t=this.selectorStack[n],t.off("rejectionwithaction",this.modelResetHandler),this.selectorStack.splice(n,1);this.currentSelector.stateToken=this.stateToken}}selectorStackIncludes(t){return this.selectorStack.includes(t)}get currentSelector(){return this.selectorStack[this.selectorStack.length-1]}buildGestureMatchInspector(t){return n=>{let s=this.selectorStack.indexOf(t);return this.selectorStack.slice(s).map(c=>c.potentialMatchersForSource(n).map(i=>i.model.id)).reduce((c,i)=>c.concat(i))}}addEngine(t){t.on("pointstart",this.onNewTrackedPath),this.inputEngines.push(t)}recordHistory(t){let n=this.historyMax;n>0&&(this._history.length==n&&this._history.shift(),this._history.push(t))}get activeGestures(){return[].concat(this._activeGestures)}get activeSources(){return[].concat(this.inputEngines.map(t=>t.activeSources).reduce((t,n)=>t.concat(n),[]))}get history(){return this._history}get historyJSON(){let t=r(function(n,s){return n=="item"?s==null?void 0:s.id:s},"sanitizingReplacer");return JSON.stringify(this.history,t,2)}get stateToken(){return this._stateToken}set stateToken(t){this._stateToken=t,this.inputEngines.forEach(n=>n.stateToken=t),this.currentSelector.stateToken=t}addSimpleSourceHooks(t){t.path.on("invalidated",()=>{let n=this.activeGestures.find(B=>B.allSourceIds.includes(t.identifier));n&&n.cancel();let s=this._activeSources.indexOf(t);this._activeSources=this._activeSources.splice(s,1)}),t.path.on("complete",()=>{let n=this._activeSources.indexOf(t);this._activeSources=this._activeSources.splice(n,1)})}};r(Hi,"TouchpointCoordinator");var yB=Hi;var IB={};Vn(IB,{EMPTY_GESTURE_DEFS:()=>hi,getGestureModel:()=>Se,getGestureModelSet:()=>bi});var Wi=class Wi extends yB{constructor(t,n){let s=aB(n);t=t||hi;super(t,null,s.historyLength);this.config=s,this.mouseEngine=new gB(this.config),this.touchEngine=new uB(this.config),this.mouseEngine.registerEventHandlers(),this.touchEngine.registerEventHandlers(),this.addEngine(this.mouseEngine),this.addEngine(this.touchEngine)}destroy(){this.activeGestures.forEach(t=>t.cancel()),this.activeSources.forEach(t=>t.terminate(!0)),this.mouseEngine.unregisterEventHandlers(),this.touchEngine.unregisterEventHandlers(),this.mouseEngine=null,this.touchEngine=null}};r(Wi,"GestureRecognizer");var Ze=Wi;var Ai={};Vn(Ai,{matchers:()=>bB,specs:()=>IB});var bB={};Vn(bB,{GestureMatcher:()=>Ve,GestureSequence:()=>an,GestureStageReport:()=>es,MatcherSelector:()=>ae,PathMatcher:()=>Qn,modelSetForAction:()=>Ei});function hB(Q,e){let t=new Map;return e.keys.forEach(n=>{let s=Math.abs(Q.x-n.centerX),B=Math.abs(Q.y-n.centerY),c,i;s>.5*n.width?(c=s-.5*n.width,s=.5):(c=0,s/=n.width),B>.5*n.height?(i=B-.5*n.height,B=.5):(i=0,B/=n.height),c*=e.kbdScaleRatio,c+=s*n.height,i+=B*n.height;let l=c*c+i*i;t.set(n.keySpec,l)}),t}r(hB,"keyTouchDistances");function Fe(Q){var s;let e=new Map,t=0;Array.isArray(Q)||(Q=[Q]);for(let B of Q)for(let c of B.keys()){let i=1/(Math.pow(B.get(c),2)+3e-5);t+=i,e.set(c,(s=e.get(c))!=null?s:0+i)}let n=[];for(let B of e.keys())n.push({keySpec:B,p:e.get(B)/t});return n.sort(function(B,c){return c.p-B.p})}r(Fe,"distributionFromDistanceMaps");var vi=["n","ne","e","se","s","sw","w","nw"],Zr=Math.PI,Ni=(()=>{let Q=new Map,e=Zr/4;for(let t=0;t<vi.length;t++)Q.set(vi[t],[e*t,1]);return Q})();function mB(Q){return Math.PI/4*vi.indexOf(Q)}r(mB,"lockedAngleForDir");function ss(Q,e){let t=mB(e),n=Q.initialSample,s=Q.lastSample.targetX-n.targetX,B=Q.lastSample.targetY-n.targetY,c=Math.max(0,-B*Math.cos(t));return Math.max(0,s*Math.sin(t))+c}r(ss,"calcLockedDistance");function ZQ(Q,e,t,n){return s=>{let B=mB(e),c=n.flick.triggerDist-n.flick.dirLockDist,i=Math.max(0,ss(Q.path.stats,e)-n.flick.dirLockDist),a=Math.min(1,.7*i/c),F=Math.sin(B)*a,o=-Math.cos(B)*a;t==null||t.scrollFlickPreview(F,o)}}r(ZQ,"buildFlickScroller");var xB=Math.PI/3,Ti=class Ti{constructor(e,t,n,s,B,c){this.directlyEmitsKeys=!0;this.sequence=e,this.gestureParams=B,this.baseSpec=s.key.spec,this.baseKeyDistances=n.getSimpleTapCorrectionDistances(e.stageReports[0].sources[0].path.stats.initialSample,this.baseSpec);let i=e.stageReports[0].sources[0].baseSource,l=i;e.on("complete",()=>{c==null||c.cancel()}),this.sequence.on("stage",F=>{var u;let o=l.path.stats;this.computedFlickDistribution=this.flickDistribution(o,!0);let d=this.computedFlickDistribution[0].keySpec;if(F.matchedId=="flick-restart"){l.path.replaceInitialSample(F.sources[0].path.stats.initialSample);return}if(F.matchedId=="flick-reset-centering"){l=i.constructSubview(!0,!0);return}else if(F.matchedId=="flick-reset-end"){this.emitKey(n,this.baseSpec,l.path.stats);return}else if(F.matchedId=="flick-reset"){this.flickScroller&&(this.flickScroller(l.currentSample),l.path.off("step",this.flickScroller)),this.lockedDir=null,this.lockedSelectable=null,l instanceof it&&l.disconnect();return}else if(F.matchedId=="flick-mid"){if(d==this.baseSpec)return;let g=Object.keys(this.baseSpec.flick).find(y=>this.baseSpec.flick[y]==d);this.lockedDir=g,this.lockedSelectable=d,this.flickScroller&&l.path.off("step",this.flickScroller),this.flickScroller=ZQ(l,g,c,this.gestureParams),this.flickScroller(l.currentSample),l.path.on("step",this.flickScroller);return}let U=(u=this.lockedSelectable)!=null?u:d;this.emitKey(n,U,o)});let a=this.buildPopupRecognitionConfig(n);t({type:"push",config:a})}emitKey(e,t,n){let s;ss(n,this.lockedDir)>this.gestureParams.flick.triggerDist?s=e.keyEventFromSpec(t):s=e.keyEventFromSpec(this.baseSpec),s.keyDistribution=this.currentStageKeyDistribution(this.baseKeyDistances),e.raiseKeyEvent(s,null)}buildPopupRecognitionConfig(e){let t={getBoundingClientRect(){let n=Number.MAX_SAFE_INTEGER;return new DOMRect(-n,-n,2*n,2*n)}};return L(b({},e.gestureEngine.config),{maxRoamingBounds:t,safeBounds:t})}cancel(){}flickDistribution(e,t){let n=this.baseSpec.flick,s=[{spec:this.baseSpec,coord:[NaN,0]}];s=s.concat(Object.keys(n).map(d=>({spec:n[d],coord:Ni.get(d)})));let B=e.angle,c=this.gestureParams.flick.triggerDist,l=Math.min(c,t?c:e.netDistance)/c,a=0,F=s.map(d=>{let U=0,u=d.coord;if(!isNaN(u[0])){let G=B-u[0],C=2*Zr+u[0]-B;U=Math.min(G*G,C*C)}let g=xB*(u[1]-l),y=g*g,x=1/(U+y+1e-6);return a+=x,{keySpec:d.spec,p:x}}),o=1/a;return F.forEach(d=>d.p*=o),F.sort((d,U)=>U.p-d.p)}currentStageKeyDistribution(e){let t=this.baseSpec,n=this.baseKeyDistances,s=this.computedFlickDistribution;if(!n.get(t))return[{keySpec:s[0].keySpec,p:1}];let c=s.findIndex(a=>a.keySpec==t),i=s.splice(c,1)[0].p,l=Fe(n);return s.concat(l.map(a=>({keySpec:a.keySpec,p:a.p*i})))}};r(Ti,"Flick");var ns=Ti;var CB=yQ.TouchLayoutKeySp,Bs={longpress:{flickDistStart:8,flickDistFinal:40,waitLength:500,noiseTolerance:10},multitap:{waitLength:300,holdLength:150},flick:{startDist:10,dirLockDist:25,triggerDist:40}};function Lr(Q){let e=Q.getBoundingClientRect();return{clientX:e.left+e.width/2,clientY:e.top+e.height/2}}r(Lr,"getKeyCentroid");function Er(Q){let e=Lr(Q);return t=>{let n=t.lastSample.clientX-e.clientX,s=t.lastSample.clientY-e.clientY;return Math.sqrt(n*n+s*s)}}r(Er,"buildDistFromKeyCentroidFunctor");function cs(Q){let e=Q.key.spec;if(e.sk)return!1;let t=["K_SHIFT","K_ALT","K_CTRL","K_NUMERALS","K_SYMBOLS","K_CURRENCIES"];for(let n of t)if(e.id==n)return!0;if(e.nextlayer)switch(e.sp){case CB.special:case CB.specialActive:case CB.customSpecial:case CB.customSpecialActive:return!0;default:return!1}else return!1}r(cs,"keySupportsModipress");function fi(Q,e){let t=r((g,y)=>{if(!g)return!1;let x=g.key.spec;switch(y){case"modipress-start":return cs(g);case"special-key-start":return["K_LOPT","K_ROPT","K_BKSP"].indexOf(x.baseKeyID)!=-1;case"longpress":return!0;case"multitap-start":case"modipress-multitap-start":return Q.hasMultitaps?!!x.multitap:!1;case"flick-start":return!!x.flick;default:return!0}},"gestureKeyFilter"),n=e;n.longpress.permitsFlick=g=>{let y=g==null?void 0:g.key.spec.flick;return!y||!(y.n||y.nw||y.ne)};let s=n.roamingEnabled=!Q.hasFlicks,B=lt(s?KQ(n):vr(n)),c=lt(s?Yi(n):Nr(n)),i=F(lt(Wr(n,!0,s)),0),l=F(wQ(n),0),a=F(ta(n),0);Object.defineProperty(i.contacts[0].model.timer,"duration",{get:()=>n.longpress.waitLength}),Object.defineProperty(l.sustainTimer,"duration",{get:()=>n.multitap.waitLength}),Object.defineProperty(a.sustainTimer,"duration",{get:()=>n.multitap.waitLength});function F(g,y){g=lt(g);let x=g.id;return typeof y=="number"&&(y=[y]),g.contacts.forEach((G,C)=>{var h;if(y.indexOf(C)!=-1){let S=(h=G.model.allowsInitialState)!=null?h:()=>!0;G.model=L(b({},G.model),{allowsInitialState:(H,R,Y)=>t(Y,x)&&S(H,R,Y)})}}),g}r(F,"withKeySpecFiltering");let o=AQ(),d=jQ(),U=[i,l,DQ(n),B,c,F(o,0),vQ(n),PQ(),F(d,0),_Q(n),$Q(),qQ(),a,ea(n),na()],u=[i.id,B.id,d.id,o.id];return s?(U.push(F(NQ(n),0)),U.push(TQ())):(U.push(F(Ar(n),0)),U.push(kQ(n)),U.push(YQ(n)),U.push(MQ(n)),U.push(fQ(n)),U.push(OQ()),U.push(zQ(n)),u.push("flick-start")),{gestures:U,sets:{default:u,modipress:u.filter(g=>g!=d.id),none:[]}}}r(fi,"gestureSetForLayout");function ki(){return{itemPriority:0,pathResolutionAction:"reject",pathModel:{evaluate:Q=>"resolve"}}}r(ki,"instantContactRejectionModel");function zt(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:Q=>"resolve"}}}r(zt,"instantContactResolutionModel");function LQ(Q){let e=Q.flick;return{itemPriority:1,pathModel:{evaluate:(t,n,s)=>{let B=t.stats,c=s==null?void 0:s.key.spec;if(c&&c.sk){let i=c.flick;if(!(i.nw||i.n||i.ne)){let a=B.netDistance,F=B.angle;if(a*Math.cos(F)>Q.longpress.flickDistStart)return"reject"}}return B.netDistance>e.startDist?"resolve":null}},pathResolutionAction:"resolve",pathInheritance:"partial"}}r(LQ,"flickStartContactModel");function Jr(Q,e){let t=e.key.spec.flick,n=Object.keys(t),s,B=0;for(let c of n){let i=ss(Q,c);i>B&&(B=i,s=c)}return{dir:s,dist:B}}r(Jr,"determineLockFromStats");function EQ(Q){return{itemPriority:1,pathModel:{evaluate:(e,t,n)=>{let{dir:s,dist:B}=Jr(e.stats,n);if(B>Q.flick.dirLockDist){let c=e.stats.angle,i=mB(s),l=Math.abs(c-i),a=Math.abs(2*Math.PI+i-c);if(l<=xB||a<=xB)return"resolve"}else if(e.isComplete)return"reject"}},pathResolutionAction:"resolve",pathInheritance:"full"}}r(EQ,"flickMidContactModel");function JQ(Q){return{itemPriority:1,pathModel:{evaluate:(e,t,n,s)=>{if(e.isComplete)return"resolve";{let{dir:B}=Jr(s,n);if(ss(e.stats,B)<Q.flick.dirLockDist)return"reject"}}},pathResolutionAction:"resolve",pathInheritance:"full"}}r(JQ,"flickEndContactModel");function RQ(Q,e,t){let n=Q.longpress;return{itemPriority:0,pathResolutionAction:"resolve",timer:{get duration(){return n.waitLength},expectedResult:!0},validateItem:(s,B)=>!!(B!=null&&B.key.spec.sk),pathModel:{evaluate:s=>{var c;let B=s.stats;if(e&&n.permitsFlick(B.lastSample.item)&&((c=B.cardinalDirection)==null?void 0:c.indexOf("n"))!=-1){let i=B.netDistance,l=B.angle;if(i*Math.cos(l)>n.flickDistFinal)return"resolve"}else if(t){if(B.rawDistance>n.noiseTolerance||B.lastSample.item!=B.initialSample.item)return"reject"}else if(B.lastSample.item!=B.initialSample.item)return"reject";return s.isComplete?"reject":null}}}}r(RQ,"longpressContactModel");function Rr(){return{itemPriority:-1,pathResolutionAction:"resolve",pathModel:{evaluate:Q=>"resolve"}}}r(Rr,"modipressContactStartModel");function HQ(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:Q=>{if(Q.isComplete)return"reject"}}}}r(HQ,"modipressContactHoldModel");function Hr(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:Q=>{if(Q.isComplete)return"resolve"}}}}r(Hr,"modipressContactEndModel");function GB(Q,e){var n;let t=(n=Q==null?void 0:Q.roamingEnabled)!=null?n:!0;return{itemPriority:0,itemChangeAction:t?"reject":void 0,pathResolutionAction:"resolve",pathInheritance:!t&&e?"full":"chop",pathModel:{evaluate:s=>{if(s.isComplete&&!s.wasCancelled)return"resolve"}}}}r(GB,"simpleTapContactModel");function WQ(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:Q=>{if(Q.isComplete&&!Q.wasCancelled)return"resolve"}}}}r(WQ,"subkeySelectContactModel");function AQ(){return{id:"special-key-start",resolutionPriority:0,contacts:[{model:b({},zt()),endOnResolve:!1}],resolutionAction:{type:"chain",next:"special-key-end",item:"current"}}}r(AQ,"specialKeyStartModel");function vQ(Q){return{id:"special-key-end",resolutionPriority:0,contacts:[{model:L(b({},GB(Q)),{itemChangeAction:"resolve"}),endOnResolve:!0}],resolutionAction:{type:"complete",item:"none"}}}r(vQ,"specialKeyEndModel");function Wr(Q,e,t){let n={id:"longpress",resolutionPriority:4,contacts:[{model:L(b({},RQ(Q,e,t)),{itemPriority:1,pathInheritance:"chop"}),endOnResolve:!1},{model:ki(),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"subkey-select",selectionMode:"none",item:"none"}};return t?L(b({},n),{rejectionActions:{path:{type:"replace",replace:"longpress-roam"},timer:{type:"replace",replace:"longpress-roam-restore"}}}):n}r(Wr,"longpressModel");function NQ(Q){let e=Wr(Q,!1,!0);return L(b({},e),{id:"longpress-roam"})}r(NQ,"longpressModelAfterRoaming");function TQ(){return{id:"longpress-roam-restore",contacts:[{model:{pathModel:{evaluate:Q=>null},itemChangeAction:"reject",pathInheritance:"full",pathResolutionAction:"reject",itemPriority:0}}],resolutionPriority:-1,rejectionActions:{item:{type:"replace",replace:"longpress-roam"}},resolutionAction:{type:"chain",next:"longpress-roam"}}}r(TQ,"longpressRoamRestoration");function Ar(Q){return{id:"flick-start",resolutionPriority:3,contacts:[{model:LQ(Q)}],resolutionAction:{type:"chain",item:"none",next:"flick-mid"}}}r(Ar,"flickStartModel");function fQ(Q){let e=Ar(Q);return L(b({},e),{contacts:[L(b({},e.contacts[0]),{model:L(b({},e.contacts[0].model),{baseCoordReplacer:(t,n)=>{let s=Lr(n),B=Er(n),c=t.initialSample,i=B(t);if(i>Q.flick.triggerDist)return s;let l=Q.flick.dirLockDist;if(i<l)return c;let a=l/i,F=c.clientX-s.clientX,o=c.clientY-s.clientY;return{clientX:s.clientX+F*a,clientY:s.clientY+o*a}}})})],id:"flick-restart",sustainWhenNested:!0,rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}}})}r(fQ,"flickRestartModel");function kQ(Q){return{id:"flick-mid",resolutionPriority:0,contacts:[{model:EQ(Q),endOnReject:!0},{model:ki(),resetOnInstantFulfill:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}},resolutionAction:{type:"chain",item:"none",next:"flick-end"},sustainWhenNested:!0}}r(kQ,"flickMidModel");function YQ(Q){return{id:"flick-reset",resolutionPriority:1,contacts:[{model:L(b({},zt()),{pathInheritance:"partial"})}],resolutionAction:{type:"chain",next:"flick-reset-centering"},sustainWhenNested:!0}}r(YQ,"flickResetModel");function MQ(Q){return{id:"flick-reset-centering",resolutionPriority:1,contacts:[{model:{pathModel:{evaluate(e,t,n){t||(t=e.stats);let s=Er(n),B=s(e.stats);if(s(t)<B)return"resolve"}},itemPriority:0,pathResolutionAction:"resolve",pathInheritance:"full"}}],resolutionAction:{type:"chain",next:"flick-restart"},sustainWhenNested:!0}}r(MQ,"flickResetCenteringModel");function OQ(){return{id:"flick-reset-end",resolutionPriority:1,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"complete",item:"base"},sustainWhenNested:!0}}r(OQ,"flickResetEndModel");function zQ(Q){return{id:"flick-end",resolutionPriority:0,contacts:[{model:JQ(Q)},{model:zt(),resetOnInstantFulfill:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset"}},resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}r(zQ,"flickEndModel");function wQ(Q){return{id:"multitap-start",resolutionPriority:2,contacts:[{model:L(b({},zt()),{itemPriority:1,pathInheritance:"reject",allowsInitialState(e,t,n){return e.item==n}})}],sustainTimer:{duration:Q.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"multitap-end",item:"current"}}}r(wQ,"multitapStartModel");function DQ(Q){return{id:"multitap-end",resolutionPriority:2,contacts:[{model:L(b({},GB(Q)),{itemPriority:1,timer:{duration:Q.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:zt(),resetOnInstantFulfill:!0}],rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"none"}}}r(DQ,"multitapEndModel");function vr(Q){return{id:"initial-tap",resolutionPriority:1,contacts:[{model:L(b({},GB(Q)),{pathInheritance:"chop",itemPriority:1,timer:{duration:Q.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:zt(),resetOnInstantFulfill:!0}],sustainWhenNested:!0,rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"base"}}}r(vr,"initialTapModel");function Nr(Q){return{id:"simple-tap",resolutionPriority:1,contacts:[{model:L(b({},GB(Q,!0)),{itemPriority:1}),endOnResolve:!0},{model:zt(),resetOnInstantFulfill:!0}],sustainWhenNested:!0,resolutionAction:{type:"complete",item:"base"}}}r(Nr,"simpleTapModel");function KQ(Q){let e=vr(Q);return L(b({},e),{rejectionActions:L(b({},e.rejectionActions),{item:{type:"replace",replace:"initial-tap"}})})}r(KQ,"initialTapModelWithReset");function Yi(Q){let e=Nr(Q);return L(b({},e),{rejectionActions:L(b({},e.rejectionActions),{item:{type:"replace",replace:"simple-tap"}})})}r(Yi,"simpleTapModelWithReset");function PQ(){return{id:"subkey-select",resolutionPriority:0,contacts:[{model:L(b({},WQ()),{pathInheritance:"full",itemPriority:1}),endOnResolve:!0,endOnReject:!0}],resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}r(PQ,"subkeySelectModel");function jQ(){return{id:"modipress-start",resolutionPriority:5,contacts:[{model:L(b({},Rr()),{allowsInitialState(Q,e,t){return cs(t)},itemChangeAction:"reject",itemPriority:1})}],resolutionAction:{type:"chain",next:"modipress-hold",selectionMode:"modipress",item:"current"}}}r(jQ,"modipressStartModel");function _Q(Q){return{id:"modipress-hold",resolutionPriority:5,contacts:[{model:L(b({},HQ()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:Q.multitap.holdLength,expectedResult:!0,inheritElapsed:!0}})},{model:b({},zt()),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"},rejectionActions:{path:{type:"replace",replace:"modipress-end-multitap-transition"}}}}r(_Q,"modipressHoldModel");function qQ(){return{id:"modipress-end-multitap-transition",resolutionPriority:5,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"}}}r(qQ,"modipressMultitapTransitionModel");function $Q(){return{id:"modipress-end",resolutionPriority:5,contacts:[{model:L(b({},Hr()),{itemChangeAction:"reject",pathInheritance:"full"})}],resolutionAction:{type:"complete",item:"none",awaitNested:!0}}}r($Q,"modipressEndModel");function ta(Q){return{id:"modipress-multitap-start",resolutionPriority:6,contacts:[{model:L(b({},Rr()),{pathInheritance:"reject",allowsInitialState(e,t,n){return e.item!=n?!1:cs(n)},itemChangeAction:"reject",itemPriority:1})}],sustainTimer:{duration:Q.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"modipress-multitap-end",selectionMode:"modipress",item:"current"}}}r(ta,"modipressMultitapStartModel");function ea(Q){return{id:"modipress-multitap-end",resolutionPriority:5,contacts:[{model:L(b({},Hr()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:Q.multitap.holdLength,expectedResult:!1}})},{model:b({},ki()),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"},rejectionActions:{timer:{type:"replace",replace:"modipress-multitap-lock-transition"},path:{type:"replace",replace:"modipress-multitap-lock-transition"}}}}r(ea,"modipressMultitapEndModel");function na(){return{id:"modipress-multitap-lock-transition",resolutionPriority:5,contacts:[{model:L(b({},zt()),{pathResolutionAction:"resolve"})}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"}}}r(na,"modipressMultitapLockModel");var Tr=L(b({},lt(Yi(null))),{resolutionAction:{type:"complete",item:"current"}}),fr={gestures:[Tr],sets:{default:[Tr.id]}};function pB(Q){var e;return typeof Q=="string"?e=Q:(e=Q.style.fontSize,e||(e=getComputedStyle(Q).fontSize)),new p(e)}r(pB,"getFontSizeStyle");function kr(Q,e,t){if(Q.touchable){let n=Q.formFactor=="phone"?1.6*(t?.65:.6)*1.2:2;return p.special(n,"em")}else return e?p.inPixels(e/8):void 0}r(kr,"defaultFontSize");var is;function XB(Q,e,t){t={fontFamily:t.fontFamily,fontSize:t.fontSize},t.fontFamily||(t.fontFamily=getComputedStyle(document.body).fontFamily),(!t.fontSize||t.fontSize=="")&&(t.fontSize="1em");let n=t.fontFamily,s=pB(t.fontSize);var B;s.absolute?B=s.val+"px":B=s.val*e+"px",is=is!=null?is:document.createElement("canvas");var c=is.getContext("2d");c.font=B+" "+n;var i=c.measureText(Q);return i}r(XB,"getTextMetrics");var sa=10,Mi=class Mi{constructor(e,t){this.totalLength=0;this.baseCoord=e,this.curCoord=e,this.baseScrollLeft=t,this.totalLength=0}updateTo(e){let t=this.curCoord;this.curCoord=e;let n=this.baseCoord.targetX-this.curCoord.targetX+this.baseScrollLeft;return this.totalLength+=Math.abs(this.curCoord.targetX-t.targetX),n}get hasScrolled(){return this.totalLength>sa}};r(Mi,"BannerScrollState");var SB=Mi;var Yr="kmw-suggest-touched",Ba="kmw-suggest-banner-scroller",Mr=.666,Or="swallow-fade-transition",ls=class ls{constructor(e,t){this.index=e,this.rtl=t!=null?t:!1,this.constructRoot();let n=this.display=A("span");n.className="kmw-suggestion-text",this.container.appendChild(n)}get computedStyle(){return getComputedStyle(this.display)}constructRoot(){let e=this.div=A("div");e.className="kmw-suggest-option",e.id=ls.BASE_ID+this.index,this.div.suggestion=this;let t=this.container=document.createElement("div");t.className="kmw-suggestion-container";let s=(100-At.MARGIN*(At.LONG_SUGGESTION_DISPLAY_LIMIT-1))/At.LONG_SUGGESTION_DISPLAY_LIMIT;t.style.minWidth=s+"%",e.appendChild(t)}matchKeyboardProperties(e){let t=this.div;if(e){e.KLC&&(t.lang=e.KLC);let n=e.KFont;n&&n.family&&n.family!=""&&(t.style.fontFamily=n.family)}}get suggestion(){return this._suggestion}update(e,t){this._suggestion=e;let n=this.generateSuggestionText(this.rtl);if(this.container.replaceChild(n,this.display),this.display=n,t.minWidth!==void 0&&(this._minWidth=t.minWidth),this._paddingWidth=t.paddingWidth,this._collapsedWidth=t.collapsedWidth,e&&e.displayAs){let s=XB(e.displayAs,t.emSize,t.styleForFont);this._textWidth=s.width}else this._textWidth=0;this.currentWidth=this.collapsedWidth,this.highlight(e==null?void 0:e.autoAccept),this.updateLayout()}updateLayout(){if(!this.suggestion&&this.index!=0){this.div.style.width="0px";return}else this.div.style.width="";let e=this.container.style;e.minWidth=this.collapsedWidth+"px",this.rtl?e.marginRight=this.collapsedWidth-this.expandedWidth+"px":e.marginLeft=this.collapsedWidth-this.expandedWidth+"px",this.updateFade()}updateFade(){this.div.classList.add(Or),window.requestAnimationFrame(()=>{this.div.classList.remove(Or)}),this.div.classList.add(`kmw-hide-fade-${this.rtl?"left":"right"}`);let e=`kmw-hide-fade-${this.rtl?"right":"left"}`;this.expandedWidth-this.collapsedWidth?this.div.classList.remove(e):this.div.classList.add(e)}get targetCollapsedWidth(){return this._collapsedWidth}get textWidth(){return this._textWidth}get paddingWidth(){return this._paddingWidth}get minWidth(){return this._minWidth}set minWidth(e){this._minWidth=e}get expandedWidth(){return this.minWidth>this.spanWidth?this.minWidth:this.spanWidth}get spanWidth(){var t,n;let e=(t=this.textWidth)!=null?t:0;return e&&(e+=(n=this.paddingWidth)!=null?n:0),e}get collapsedWidth(){let e=this.spanWidth<this.targetCollapsedWidth?this.spanWidth:this.targetCollapsedWidth,t=e<this.expandedWidth?e:this.expandedWidth;return this.minWidth>t?this.minWidth:t}get currentWidth(){return this.div.offsetWidth}set currentWidth(e){e<this.collapsedWidth?e=this.collapsedWidth:e>this.expandedWidth&&(e=this.expandedWidth),this.rtl?this.container.style.marginRight=`${e-this.expandedWidth}px`:this.container.style.marginLeft=`${e-this.expandedWidth}px`}highlight(e){let t=this.div;e?t.classList.add(Yr):t.classList.remove(Yr)}isEmpty(){return!this._suggestion}generateSuggestionText(e){let t=this._suggestion;var n,s=A("span");if(s.className="kmw-suggestion-text",t==null)return s;if(t.displayAs==null||t.displayAs=="")n="\xA0";else{let B=e?8238:8237;n=String.fromCharCode(B)+t.displayAs}return s.innerHTML=n,s}};r(ls,"BannerSuggestion"),ls.BASE_ID="kmw-suggestion-";var Oi=ls,D=class D extends Ft{constructor(t,n){super(n||Ft.DEFAULT_HEIGHT);this.type="suggestion";this.currentSuggestions=[];this.options=[];this.separators=[];this.isRTL=!1;this.onSuggestionUpdate=r(t=>{var d;this.currentSuggestions=t,(d=this.highlightAnimation)==null||d.cancel();let n=this.options[0].computedStyle,s={fontSize:n.fontSize,fontFamily:n.fontFamily},B=getComputedStyle(document.body).fontSize,c=pB(B).val,i=getComputedStyle(this.options[0].container.firstChild),l=this.width/D.LONG_SUGGESTION_DISPLAY_LIMIT,a=new p(i.paddingLeft||"4px"),F=new p(i.paddingRight||"4px"),o={paddingWidth:a.val+F.val,emSize:c,styleForFont:s,collapsedWidth:l,minWidth:0};for(let U=0;U<D.SUGGESTION_LIMIT;U++){let u=this.options[U];if(t.length>U){let g=t[U];u.update(g,o)}else u.update(null,o)}this.refreshLayout()},"onSuggestionUpdate");this.refreshLayout=r(()=>{let t=[],n=0,s=Math.min(this.currentSuggestions.length,8);for(let B=0;B<s;B++){let c=this.options[B];c.minWidth=0,n+=c.collapsedWidth,c.collapsedWidth<c.expandedWidth&&t.push(c)}if(s=s||1,n<this.width){let B=this.width*.01*(s-1);for(;n<this.width&&t.length>0;){let i=(this.width-n-B)/t.length;t.sort((o,d)=>o.expandedWidth-d.expandedWidth);let l=t[0],a=l.expandedWidth-l.collapsedWidth,F=Math.min(a,i);F>0&&(t.forEach(o=>o.minWidth=o.collapsedWidth+F),n+=F*t.length),t.splice(0,1)}let c=(this.width-n-B)/s;for(let i=0;i<s;i++){let l=this.options[i];l.minWidth=l.collapsedWidth+c,l.updateLayout()}}for(let B=0;B<D.SUGGESTION_LIMIT-1;B++)this.separators[B].style.display=B<s-1?"":"none"},"refreshLayout");this.getDiv().className=this.getDiv().className+" "+D.BANNER_CLASS,this.container=document.createElement("div"),this.container.className=Ba,this.getDiv().appendChild(this.container),this.buildInternals(!1),this.gestureEngine=this.setupInputHandling()}shutdown(){this.gestureEngine.destroy()}buildInternals(t){this.isRTL=t,this.options.length>0&&(this.options=[],this.separators=[]);for(var n=0;n<D.SUGGESTION_LIMIT;n++){let s=new Oi(n,t);this.options[n]=s}for(var n=0;n<D.SUGGESTION_LIMIT;n++){let B=t?D.SUGGESTION_LIMIT-n-1:n;if(this.container.appendChild(this.options[B].div),t&&(this.container.scrollLeft=this.container.scrollWidth),n!=D.SUGGESTION_LIMIT-1){let c=A("div");c.className="kmw-banner-separator";let i=c.style;i.marginLeft=`calc(${D.MARGIN/2}% - 0.5px)`,i.marginRight=`calc(${D.MARGIN/2}% - 0.5px)`,this.container.appendChild(c),this.separators[B-(t?1:0)]=c}}}setupInputHandling(){let t=new ot(this.getDiv(),[-Number.MAX_SAFE_INTEGER]);this.selectionBounds=new ot(this.getDiv(),[-Mr*this.height,-Number.MAX_SAFE_INTEGER]);let n={targetRoot:this.getDiv(),maxRoamingBounds:t,safeBounds:t,itemIdentifier:l=>{let a=this.selectionBounds.getBoundingClientRect();if(l.clientX<a.left||l.clientX>a.right||l.clientY<a.top||l.clientY>a.bottom)return null;let F=null,o=Number.MAX_VALUE;for(let d of this.options){let U=d.div.getBoundingClientRect();if(U.left<=l.clientX&&l.clientX<U.right)return d.suggestion?d:null;{let u=(l.clientX<U.left?-1:1)*(l.clientX-U.left);u<o&&(o=u,F=d)}}return F.suggestion?F:null}},s=new Ze(fr,n),B={source:null,scrollingHandler:null,suggestion:null},c=r(l=>{l.highlight(!0),this.highlightAnimation&&(this.highlightAnimation.cancel(),this.highlightAnimation.decouple()),this.highlightAnimation=new VB(this.container,l,!1),this.highlightAnimation.expand()},"markSelection"),i=r(l=>{l.highlight(!1),this.highlightAnimation||(this.highlightAnimation=new VB(this.container,l,!1)),this.highlightAnimation.collapse()},"clearSelection");return s.on("inputstart",l=>{if(B.source){l.terminate(!0);return}let a=this._predictionContext.selected;this._predictionContext.selected=null,a&&this.options.forEach(d=>{d.suggestion==a&&d.highlight(!1)}),this.scrollState=new SB(l.currentSample,this.container.scrollLeft);let F=l.baseItem;B.source=l,B.scrollingHandler=d=>{var g;let U=this.scrollState.updateTo(d);(g=this.highlightAnimation)==null||g.setBaseScroll(U);let u=d.item?F:null;u!=B.suggestion&&(B.suggestion&&i(B.suggestion),B.suggestion=u,u&&c(u))},B.suggestion=l.currentSample.item,B.suggestion&&c(B.suggestion);let o=r(()=>{let d=this.currentSuggestions;Qt(0).then(()=>E(this,null,function*(){if(d==this.currentSuggestions&&(this._predictionContext.selected=a,a)){for(let U of this.options)if(U.suggestion==a){U.highlight(!0);break}}})),B.suggestion&&(i(B.suggestion),B.suggestion=null),B.source=null,B.scrollingHandler=null},"terminationHandler");l.path.on("complete",o),l.path.on("invalidated",o),l.path.on("step",B.scrollingHandler)}),s.on("recognizedgesture",l=>{l.once("stage",a=>{let F=a.item;F&&!this.scrollState.hasScrolled&&this.currentSuggestions.length>0&&(this.currentSuggestions=[],this.predictionContext.accept(F.suggestion).then(()=>{this.container.scrollLeft=this.isRTL?this.container.scrollWidth:0})),this.scrollState=null})}),s}update(){var n;let t=super.update();return(n=this.selectionBounds)==null||n.updatePadding([-Mr*this.height,-Number.MAX_SAFE_INTEGER]),t}configureForKeyboard(t,n){let s=t.isRTL;this.container.textContent="",this.buildInternals(s),this.options.forEach(B=>B.matchKeyboardProperties(n)),this.onSuggestionUpdate(this.currentSuggestions)}get predictionContext(){return this._predictionContext}set predictionContext(t){this._predictionContext&&this._predictionContext.off("update",this.onSuggestionUpdate),this._predictionContext=t,t&&(t.on("update",this.onSuggestionUpdate),this.onSuggestionUpdate(t.currentSuggestions))}};r(D,"SuggestionBanner"),D.SUGGESTION_LIMIT=8,D.LONG_SUGGESTION_DISPLAY_LIMIT=3,D.MARGIN=1;var At=D,yt=class yt{constructor(e,t,n){this.setScrollOffset=r(()=>{if(!this.scrollContainer)return;let e=this.option.currentWidth-this.option.collapsedWidth,t=this.option.rtl,n=Math.max(this.rootScrollOffset-this.option.div.offsetLeft,0),s=Math.max(this.option.div.offsetLeft+this.option.collapsedWidth-(this.rootScrollOffset+this.scrollContainer.offsetWidth)),B=Math.max(t?s:n,0),c=Math.max(this.collapsedScrollOffset+(t?0:1)*e,0)+(t?0:-1)*B,i=Math.max(this.rootScrollOffset+(t?0:1)*e,0)+(t?0:-1)*B,l=t?Math.max(c,i):Math.min(c,i),a=Math.max(t?this.option.div.offsetLeft+this.option.currentWidth-(l+this.scrollContainer.offsetWidth):l-this.option.div.offsetLeft,0),F=Math.min(e,a),o=c+(t?1:-1)*F+(t?0:1)*B;if(this.scrollContainer.scrollLeft=o,this.pendingAnimation){let d=this.scrollContainer.scrollLeft-o;this.option.currentWidth+=d}},"setScrollOffset");this._expand=r(e=>{if(this.startTimestamp===void 0)return;let t=e-this.startTimestamp,n=t>yt.TRANSITION_TIME;n&&(t=yt.TRANSITION_TIME);let s=this.option.expandedWidth-this.option.collapsedWidth,B=t/yt.TRANSITION_TIME,c=s*B;this.option.currentWidth=c+this.option.collapsedWidth,n?this.clear():this.pendingAnimation=window.requestAnimationFrame(this._expand),this.setScrollOffset()},"_expand");this._collapse=r(e=>{if(this.startTimestamp===void 0)return;let t=e-this.startTimestamp,n=t>yt.TRANSITION_TIME;n&&(t=yt.TRANSITION_TIME);let s=this.option.expandedWidth-this.option.collapsedWidth,B=1-t/yt.TRANSITION_TIME,c=s*B;this.option.currentWidth=c+this.option.collapsedWidth,n?this.clear():this.pendingAnimation=window.requestAnimationFrame(this._collapse),this.setScrollOffset()},"_collapse");this.scrollContainer=e,this.option=t,this.collapsedScrollOffset=e.scrollLeft,this.rootScrollOffset=e.scrollLeft}setBaseScroll(e){this.collapsedScrollOffset=e,this.option.rtl?e>this.rootScrollOffset&&(this.rootScrollOffset=e):e<this.rootScrollOffset&&(this.rootScrollOffset=e),window.requestAnimationFrame(this.setScrollOffset)}decouple(){this.cancel(),this.scrollContainer=null}clear(){this.startTimestamp=null,window.cancelAnimationFrame(this.pendingAnimation),this.pendingAnimation=null}cancel(){this.clear(),this.option.currentWidth=this.option.collapsedWidth}expand(){this.clear(),this.startTimestamp=performance.now();let e=this.option.currentWidth-this.option.collapsedWidth,t=this.option.expandedWidth-this.option.collapsedWidth;e!=0&&(this.startTimestamp-=e/t*yt.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._expand)}collapse(){this.clear(),this.startTimestamp=performance.now();let e=this.option.expandedWidth-this.option.currentWidth,t=this.option.expandedWidth-this.option.collapsedWidth;e!=0&&(this.startTimestamp-=e/t*yt.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._collapse)}};r(yt,"SuggestionExpandContractAnimation"),yt.TRANSITION_TIME=250;var VB=yt;var zi=class zi extends Ft{constructor(t){super();this.type="html";let n=this.getDiv(),s=document.createElement("div");s.style.userSelect="none",s.style.height="100%",s.style.width="100%",n.appendChild(s),this.container=s.attachShadow?s.attachShadow({mode:"closed"}):s,this.container.innerHTML=t}get innerHTML(){return this.container.innerHTML}set innerHTML(t){this.container.innerHTML=t}};r(zi,"HTMLBanner");var ZB=zi;var wi=class wi{constructor(e,t,n){this.ImageBanner=lB;this.HTMLBanner=ZB;this.hostDevice=t,this.container=e,this.predictionContext=n,this.inactiveBanner=new le}get inactiveBanner(){return this._inactiveBanner}set inactiveBanner(e){this._inactiveBanner=e!=null?e:new le,this.container.banner instanceof At||(this.container.banner=this._inactiveBanner)}activateBanner(e){let t=this.container.banner;if(t instanceof At&&(t.predictionContext=null),!e)this.container.banner=this.inactiveBanner;else{let n=new At(this.hostDevice,this.container.activeBannerHeight);n.predictionContext=this.predictionContext,this.container.banner=n}}selectBanner(e){this.activateBanner(e=="active"||e=="configured"),this.keyboard&&this.container.banner.configureForKeyboard(this.keyboard,this.keyboardStub)}configureForKeyboard(e,t){this.keyboard=e,this.keyboardStub=t,this.container.banner.configureForKeyboard(e,t)}shutdown(){this.container.banner instanceof At&&(this.container.banner.predictionContext=null)}};r(wi,"BannerController");var rs=wi;var Di=class Di{constructor(){let e=this.element=document.createElement("div");e.style.userSelect="none",e.className="kmw-osk-none"}postInsert(){}updateState(){}refreshLayout(){}get layoutHeight(){return p.inPixels(0)}};r(Di,"EmptyView");var Le=Di;var Fn=class Fn{constructor(e){this.kbd=e;var t=this.element=document.createElement("div");t.style.userSelect="none",t.className="kmw-osk-static",t.id=Fn.ID,t.innerHTML=e.helpText}postInsert(){if(!this.element.parentElement||!document.getElementById(Fn.ID))throw new Error("The HelpPage root element has not yet been inserted into the DOM.");this.kbd.hasScript&&this.kbd.embedScript(this.element.parentElement)}updateState(){}refreshLayout(){}get layoutHeight(){return p.inPercent(100)}};r(Fn,"HelpPageView"),Fn.ID="kmw-osk-help-page";var Qs=Fn;var Pi=class Pi{constructor(e,t,n){this.keySpec=n,this.centerX=n.proportionalX,this.centerY=t.proportionalY,this.width=n.proportionalWidth,this.height=e.rowProportionalHeight}};r(Pi,"CorrectiveBaseKeyLayout");var Ki=Pi;function ca(Q){return Q.baseKeyID?m.isFrameKey(Q.baseKeyID)?!1:!Q.isPadding:!1}r(ca,"correctionKeyFilter");function zr(Q,e){return{keys:Q.row.map(t=>t.key.map(n=>new Ki(Q,t,n))).reduce((t,n)=>t.concat(n),[]).filter(t=>ca(t.keySpec)),kbdScaleRatio:e}}r(zr,"buildCorrectiveLayout");var ia={"*Shift*":8,"*Enter*":5,"*Tab*":6,"*BkSp*":4,"*Menu*":11,"*Hide*":10,"*Alt*":25,"*Ctrl*":1,"*Caps*":3,"*ABC*":16,"*abc*":17,"*123*":19,"*Symbol*":21,"*Currency*":20,"*Shifted*":9,"*AltGr*":2,"*TabLeft*":7,"*LAlt*":86,"*RAlt*":87,"*LCtrl*":88,"*RCtrl*":89,"*LAltCtrl*":96,"*RAltCtrl*":97,"*LAltCtrlShift*":98,"*RAltCtrlShift*":99,"*AltShift*":100,"*CtrlShift*":101,"*AltCtrlShift*":102,"*LAltShift*":103,"*RAltShift*":104,"*LCtrlShift*":105,"*RCtrlShift*":112,"*LTREnter*":5,"*LTRBkSp*":4,"*RTLEnter*":113,"*RTLBkSp*":114,"*ShiftLock*":115,"*ShiftedLock*":116,"*ZWNJ*":117,"*ZWNJiOS*":117,"*ZWNJAndroid*":118,"*ZWNJGeneric*":121,"*Sp*":128,"*NBSp*":130,"*NarNBSp*":131,"*EnQ*":132,"*EmQ*":133,"*EnSp*":134,"*EmSp*":135,"*PunctSp*":140,"*ThSp*":141,"*HSp*":142,"*ZWSp*":129,"*ZWJ*":119,"*WJ*":120,"*CGJ*":122,"*LTRM*":144,"*RTLM*":145,"*SH*":161,"*HTab*":162},ji=ia;var la=["default","shift","shift-on","special","special-on","","","","deadkey","blank","hidden"],Ee=la;function Je(Q,e){switch(Q){case"*ZWNJ*":Q=e.device.OS==Z.OperatingSystem.Android?"*ZWNJAndroid*":"*ZWNJiOS*";break;case"*Enter*":Q=e.isRTL?"*RTLEnter*":"*LTREnter*";break;case"*BkSp*":Q=e.isRTL?"*RTLBkSp*":"*LTRBkSp*";break;default:}let t=ji[Q],n=57344+t;return t?String.fromCharCode(n):Q}r(Je,"renameSpecialKey");var wt=class wt{constructor(e,t){this.spec=e,this.layer=t}setButtonClass(){var s;let e=this.spec,t=this.btn;var n=0;typeof e.dk=="string"&&e.dk=="1"&&(n=8),n=(s=e.sp)!=null?s:n,(n<0||n>10)&&(n=0),t.className="kmw-key kmw-key-"+Ee[n]}setToggleState(e){let t;switch(t=this.spec.sp,Ee[t]){case"shift":case"shift-on":e===void 0&&(e=Ee[t]=="shift"),this.spec.sp=1+(e?1:0);break;case"special":case"special-on":e===void 0&&(e=Ee[t]=="special"),this.spec.sp=3+(e?1:0);break;default:return}this.setButtonClass()}isFrameKey(){let e=this.spec.sp||0;switch(Ee[e]){case"default":case"deadkey":return!1;default:return!0}}allowsKeyTip(){return this.isFrameKey()?!1:!this.btn.classList.contains("kmw-spacebar")}highlight(e){var t=this.btn.classList;e?t.contains(wt.HIGHLIGHT_CLASS)||t.add(wt.HIGHLIGHT_CLASS):t.remove(wt.HIGHLIGHT_CLASS)}getIdealFontSize(e,t,n){if(!this._fontFamily)return new p("1em");n!=null||(n=1);let s=t.keyWidth,B=t.keyHeight,c=t.baseEmFontSize.scaledBy(t.layoutFontSize.val),i=this._fontSize;i.absolute||(i=c.scaledBy(i.val));let l={fontFamily:this._fontFamily,fontSize:i.styleString,height:t.keyHeight},a=XB(e,c.scaledBy(n).val,l),F=.9,o=.9,d=2;var U;a.fontBoundingBoxAscent&&(U=a.fontBoundingBoxAscent+a.fontBoundingBoxDescent);let u=U!=null?U:0,g=s*F/(a.width+d),y=u&&B?B*o/u:void 0;var x=g;return y&&y<g&&(x=y),p.forScalar(n*Math.min(x,1))}get keyText(){let e=this.spec,t="\xA0",n=null;return e.text==null||e.text==""?n=t:(n=e.text,n=="*Tab*"&&this.layer=="shift"&&(n="*TabLeft*")),n}generateKeyText(e){let t=this.spec,n=document.createElement("span"),s=n.style;n.className="kmw-key-text";let B=this.keyText,c=Je(B,e);c!=B&&(B=c,t.font="SpecialOSK"),typeof t.font=="string"&&t.font!=""&&(s.fontFamily=t.font),typeof t.fontsize=="string"&&t.fontsize!=""&&(s.fontSize=t.fontsize);let i={fontSize:s.fontSize};return s.fontFamily?i.fontFamily=s.fontFamily:i.fontFamily=e.fontFamily,e.isRTL&&(B="\u200F"+B),n.innerText=B,n}resetFontPrecalc(){this._fontFamily=void 0,this._fontSize=void 0,this.label.style.fontSize=""}detectStyles(e){if(!(this.spec.sp==v.spacer||this.spec.sp==v.blank)&&this._fontFamily===void 0){let t=getComputedStyle(this.label);if(!t.fontFamily)return;this._fontFamily=t.fontFamily;let n=new p(t.fontSize),s=e.layoutFontSize;if(s.absolute)this._fontSize=n;else{let B=e.baseEmFontSize,c=s.scaledBy(B.val),i=n.val/c.val;this._fontSize=p.forScalar(i)}}}refreshLayout(e){if(this.label)if(this.label.classList.contains("kmw-spacebar-caption")){let t=this.getIdealFontSize(this.keyText,e);this.label.style.setProperty("font-size",t.styleString,"important")}else{let t=this.label.textContent,n=this.getIdealFontSize(t,e);this.label.style.fontSize=n.styleString}}};r(wt,"OSKKey"),wt.specialCharacters=ji,wt.BUTTON_CLASSES=Ee,wt.HIGHLIGHT_CLASS="kmw-key-touched";var St=wt;var _i=class _i{constructor(e,t){this.key=e,this.keyId=t}};r(_i,"KeyData");var on=_i;function LB(Q,e){let t=Q;for(let n in e)t.hasOwnProperty(n)||(t[n]=e[n]);return t}r(LB,"link");function ra(Q){return Q&&"key"in Q&&Q.key instanceof St}r(ra,"isKey");function EB(Q){return ra(Q)?Q:null}r(EB,"getKeyFrom");var qi=class qi extends St{constructor(t,n,s){super(t,n);this.row=s}getId(){return this.spec.elementID}getCoreId(){return this.spec.coreID}getBaseId(){return this.spec.baseKeyID}generateKeyCapLabel(){var t=m.keyCodes[this.spec.baseKeyID];switch(t){case 186:t=59;break;case 187:t=61;break;case 188:t=44;break;case 189:t=45;break;case 190:t=46;break;case 191:t=47;break;case 192:t=96;break;case 219:t=91;break;case 220:t=92;break;case 221:t=93;break;case 222:t=39;break;default:(t<48||t>90)&&(t=0)}let n=document.createElement("div");return n.className="kmw-key-label",t>0&&(n.innerText=String.fromCharCode(t)),n}processSubkeys(t,n){var s,B=t.subKeys=this.spec.sk;for(s=0;s<B.length;s++){if(B[s].sp==1||B[s].sp==2){var c=B[s].text;B[s].text=Je(c,n)}B[s].layer||(B[s].layer=t.key.layer)}}construct(t){let n=this.spec,s=document.createElement("div");s.className="kmw-key-square";let B=document.createElement("div"),c=this.btn=LB(B,new on(this,n.id));this.setButtonClass();let i=this.capLabel=this.generateKeyCapLabel();c.appendChild(i),c.id=this.getId(),c.appendChild(this.label=this.generateKeyText(t)),typeof n.sk!="undefined"&&n.sk!=null?this.processSubkeys(c,t):c.subKeys=null;let l=this.generateHint(t);return c.appendChild(l),s.appendChild(c),this.preview=document.createElement("div"),this.preview.style.display="none",c.appendChild(this.preview),this.square=s}generateHint(t){let n=document.createElement("div");n.className="kmw-key-popup-icon";let s=this.spec.hintSrc;if(!s)return n;if(s.font&&s.font!="SpecialOSK"?n.style.fontFamily=s.font:n.classList.add("kmw-key-text"),s.fontsize){let i=new p(s.fontsize);n.style.fontSize=i.scaledBy(.5).styleString}let B=s==this.spec?this.spec.hint:s.text,c=Je(B,t);return c=="\u2022"&&(n.style.fontWeight="bold"),B!=c&&(n.style.fontFamily="SpecialOSK"),n.textContent=c,n}setPreview(t){let n=this.preview;t?(this.previewHost=t,this.preview=this.previewHost.element):(this.previewHost=null,this.preview=document.createElement("div"),this.preview.style.display="none"),t==null||t.setCancellationHandler(()=>{this.setPreview(null)}),this.btn.replaceChild(this.preview,n)}refreshLayout(t){super.refreshLayout(t),t.baseEmFontSize.val<12?this.capLabel.style.fontSize="6px":this.capLabel.style.fontSize=p.forScalar(.5).styleString}get displaysKeyCap(){return this.capLabel&&this.capLabel.style.display=="block"}set displaysKeyCap(t){if(!this.capLabel)throw new Error("Key element not yet constructed; cannot display key cap");this.capLabel.style.display=t?"block":"none"}};r(qi,"OSKBaseKey");var as=qi;var JB=.15,$i=class $i{constructor(e,t,n){let s=this.element=document.createElement("div");s.className="kmw-key-row",this.heightFraction=1/t.row.length;let B=n.key;this.spec=n,this.keys=[];for(let l=0;l<B.length;l++){let a=B[l];var c=new as(a,t.id,this),i=c.construct(e);this.keys.push(c),s.appendChild(i)}}get displaysKeyCaps(){if(this.keys.length>0)return this.keys[0].displaysKeyCap}set displaysKeyCaps(e){for(let t of this.keys)t.displaysKeyCap=e}refreshLayout(e){let t=this.element.style,n=e.heightStyle.scaledBy(this.heightFraction);t.maxHeight=t.lineHeight=t.height=n.styleString;let s=e.heightStyle.absolute?n:p.forScalar(1),B=s.scaledBy(JB/2),c=s.scaledBy(1-JB);this.keys.forEach(i=>{let l=i.square,a=i.btn,F=l.style;F.height=F.minHeight=s.styleString;let o=a.style;o.top=B.styleString,o.height=o.lineHeight=o.minHeight=c.styleString})}buildKeyLayout(e,t){let n=e.widthStyle.scaledBy(t.spec.proportionalWidth),s=e.heightStyle.scaledBy(this.heightFraction).scaledBy(1-JB);return{keyWidth:n.val*(n.absolute?1:e.keyboardWidth),keyHeight:s.val*(s.absolute?1:e.keyboardHeight),baseEmFontSize:e.baseEmFontSize,layoutFontSize:e.layoutFontSize}}detectStyles(e){this.keys.forEach(t=>{t.detectStyles(this.buildKeyLayout(e,t))})}refreshKeyLayouts(e){this.keys.forEach(t=>{var o;let n=t.btn,s=e.widthStyle,B=e.heightStyle,c=s.scaledBy(t.spec.proportionalWidth),i=s.scaledBy(t.spec.proportionalPad),l=B.scaledBy(this.heightFraction).scaledBy(1-JB),a=B.absolute?l.styleString:"100%",F=this.buildKeyLayout(e,t);(o=n.key)==null||o.refreshLayout(F),t.square.style.width=c.styleString,t.square.style.marginLeft=i.styleString,t.btn.style.width=s.absolute?c.styleString:"100%",t.square.style.height=a})}};r($i,"OSKRow");var Fs=$i;var tl=class tl{get rowHeight(){return this._rowHeight}get id(){return this.spec.id}constructor(e,t,n){this.spec=n;let s=this.element=document.createElement("div"),B=s.style;s.className="kmw-key-layer";var c=n.row.length;c>4&&e.device.formFactor=="phone"&&(s.className=s.className+" kmw-5rows"),B.fontFamily="font"in t?t.font:"",this.nextlayer=n.id,s.layer=n.id,typeof n.nextlayer=="string"&&(s.nextLayer=this.nextlayer=n.nextlayer);let i=n.row;this.rows=[];for(let l=0;l<i.length;l++){let a=new Fs(e,n,i[l]);a.displaysKeyCaps=t.displayUnderlying,s.appendChild(a.element),this.rows.push(a)}if(e.device.touchable&&(this.globeKey=this.findKey("K_LOPT"),this.hideKey=this.findKey("K_ROPT")),this.spaceBarKey=this.findKey("K_SPACE"),this.capsKey=this.findKey("K_CAPS"),this.numKey=this.findKey("K_NUMLOCK"),this.scrollKey=this.findKey("K_SCROLL"),this.spaceBarKey){let l=this.spaceBarKey.label,a=this.spaceBarKey.btn;typeof a.className=="undefined"||a.className==""?a.className="kmw-spacebar":a.className.indexOf("kmw-spacebar")==-1&&(a.className+=" kmw-spacebar"),l.className!="kmw-spacebar-caption"&&(l.className="kmw-spacebar-caption")}}findKey(e){for(let t of this.rows)for(let n of t.keys)if(n.getBaseId()==e)return n;return null}showLanguage(e){if(this.spaceBarKey)try{let t=this.spaceBarKey.label;this.spaceBarKey.spec.text=e,(t.innerText!=e||e=="")&&(t.innerText=e)}catch(t){}}refreshLayout(e){this.rows.forEach(c=>c.detectStyles(e));let t=e.keyboardHeight,n=this.rows.length,s=this._rowHeight=Math.floor(t/(n==0?1:n)),B=e.widthStyle.absolute;B&&(this.element.style.height=t+"px"),this.showLanguage(e.spacebarText);for(let c=0;c<n;c++){let i=this.rows[c],l=(n-c-1)*s+1;B&&(this.spec.row[c].proportionalY=(t-l-s/2)/t),i.refreshLayout(e),c==n-1&&(i.element.style.bottom="1px")}for(let c of this.rows)c.refreshKeyLayouts(e)}};r(tl,"OSKLayer");var os=tl;var Qa=.06,el=class el{constructor(e,t,n){this._layers={};this._activeLayerId="default";let s=t.layout(n);this.spec=s,this.vkbd=e;let B=this.element=document.createElement("div"),c=B.style;if(B.className="kmw-key-layer-group",s==null)return;let i=s.fontsize;typeof i=="undefined"||i==null||i==""?c.fontSize="1em":c.fontSize=s.fontsize,c.width="100%",c.height="100%",this.activeLayerId="default"}buildLayer(e){let t=this.spec,n=t.getLayer(e);if(!n)return null;let s=new os(this.vkbd,t,n);return this._layers[e]=s,this.element.appendChild(s.element),s}getLayer(e){let t=this._layers[e];return t||(t=this.buildLayer(e),t&&(this._layers[e]=t,t.element.style.display="none")),t}get activeLayer(){return this.activeLayerId?this._layers[this.activeLayerId]:null}get layers(){let t=this.spec.layer.map(n=>n.id);for(let n of t)this.buildLayer(n);return this._layers}get activeLayerId(){return this._activeLayerId}set activeLayerId(e){this._activeLayerId=e,this.getLayer(e);for(let t of Object.keys(this._layers)){let n=this._layers[t],s=n.element;n.id==e?s.style.display="block":s.style.display="none"}}findNearestKey(e){if(!e)return null;let t=e.stateToken;if(!t)throw new Error("Layer id not set for input coordinate");let n=this._layers[t];if(!n)throw new Error(`Layer id ${t} could not be found`);return this.nearestKey(e,n)}blinkLayer(e){if(typeof e=="string"){let n=e;if(e=this.getLayer(n),!e)throw new Error(`Layer id ${n} could not be found`)}let t=e;if(t.element.style.display!="block")for(let n in this._layers){if(this._layers[n].element.style.display=="block"){let s=this._layers[n];s.element.style.display="none"}this._layers[n].element.style.display="none"}t.element.style.display="block",Promise.resolve().then(()=>{let n=this._layers[this._activeLayerId];(t.element.style.display=="block"||n.element.style.display!="block")&&(t.element.style.display="none",n.element.style.display="block")})}nearestKey(e,t){if(t.rows.length==0)return null;let n={x:e.targetX/this.computedWidth,y:e.targetY/this.computedHeight};if(!isFinite(n.x)||!isFinite(n.y))return null;let s=Math.max(0,Math.min(t.rows.length-1,Math.floor(n.y*t.rows.length))),B=t.rows[s],c=null,i=Number.MAX_VALUE;for(let l of B.keys){let a=l.spec;if(a.sp==v.blank||a.sp==v.spacer)continue;let F=a.proportionalWidth/2,o=Math.abs(n.x-a.proportionalX);if(o-F<=0)return l.btn;{let d=o-F;d<i&&(i=d,c=l)}}return i<=Qa?c.btn:null}resetPrecalcFontSizes(){for(let e of Object.values(this._layers))for(let t of e.rows)for(let n of t.keys)n.resetFontPrecalc();this._heightPadding=void 0}refreshLayout(e){if(!(isNaN(e.keyboardWidth)||isNaN(e.keyboardHeight))){if(this.computedWidth=e.keyboardWidth,this.computedHeight=e.keyboardHeight,this._heightPadding===void 0){let t=getComputedStyle(this.element),n=parseInt(t.paddingTop,10)||0,s=parseInt(t.paddingBottom,10)||0;this._heightPadding=n+s}this.activeLayer&&this.activeLayer.refreshLayout(e)}}get verticalPadding(){var e;return(e=this._heightPadding)!=null?e:0}};r(el,"OSKLayerGroup");var Us=el;var wr="kmw-",Dr="top",nl=class nl{constructor(e,t){this.state=!1;this.orientation=Dr;this.vkbd=e;let n=this.element=document.createElement("div");n.className="kmw-keytip",n.id="kmw-keytip",n.style.pointerEvents="none",n.style.display="none",n.appendChild(this.tip=document.createElement("div")),n.appendChild(this.cap=document.createElement("div")),this.tip.appendChild(this.preview=document.createElement("div")),this.tip.className="kmw-keytip-tip",this.cap.className="kmw-keytip-cap",this.constrain=t,this.reorient=s=>{this.orientation=s,this.show(this.key,this.state,this.previewHost)}}show(e,t,n){var i;let s=this.vkbd;if(t&&s.layerGroup.blinkLayer(e.key.spec.displayLayer),t&&e.offsetParent){let l=e.key.row.element,a=e.getClientRects()[0],F=l.getClientRects()[0],o=a.left-F.left,d=a.width,U=a.height,u=1.8,g=this.element.style,x=s.topContainer.getBoundingClientRect(),G=e.getBoundingClientRect(),C,h=this.orientation,S=G.bottom-x.top;C=S+(h=="top"?1:-1);let H=C-Math.floor(C),R=d+Math.ceil(d*.3)*2,Y=Math.ceil(2.3*U)+H;h=="bottom"&&(C+=Y-U),g.top="auto";let _t=h=="top"?"bottom":"top";this.tip.classList.remove(`${wr}${_t}`),this.tip.classList.add(`${wr}${h}`),g.bottom=Math.floor(x.height-C)+"px",g.textAlign="center",g.overflow="visible",g.width=R+"px",g.height=Y+"px";let As=this.vkbd.currentLayer.element.style.fontFamily,mt=getComputedStyle(s.element);g.fontFamily=e.key.spec.font||As||mt.fontFamily;var B=parseInt(mt.fontSize,10);if(B==Number.NaN&&(B=0),B!=0){let $t={keyWidth:1.6*d,keyHeight:1.6*U,baseEmFontSize:s.getKeyEmFontSize(),layoutFontSize:new p(s.kbdDiv.style.fontSize)};g.fontSize=e.key.getIdealFontSize(e.key.keyText,$t,u).styleString}var c=(R-d)/2;o<c?(this.cap.style.left="1px",o+=c-1):o>window.innerWidth-d-c?(this.cap.style.left=R-d-1+"px",o-=c-1):this.cap.style.left=c+"px",g.left=o-c+"px";let vt=getComputedStyle(this.element),Gn=x.height,ue=parseFloat(vt.bottom),pn=parseFloat(vt.height),qt=Math.ceil(Y/2);this.cap.style.width=d+"px",this.tip.style.height=qt+"px";let ve=3,Xn=qt-ve+"px";h=="top"?(this.cap.style.top=Xn,this.cap.style.bottom=""):(this.cap.style.top="",this.cap.style.bottom=Xn);let Sn=S-Math.floor(C)+Y-(h=="top"?qt:-ve*2);if(this.cap.style.height=Sn+"px",this.constrain&&pn+ue>Gn){let $t=pn+ue-Gn;g.height=Y-$t+"px";let BQ=Math.max(0,Y-$t-Y/2+2);this.cap.style.height=BQ+"px"}else ue<0&&(g.bottom="0px",this.cap.style.height=Math.max(0,Sn+ue)+"px");if(g.display="block",this.previewHost==n)return;let Nt=this.preview;this.previewHost&&this.previewHost.off("preferredOrientation",this.reorient),this.previewHost=n,n&&(this.previewHost.on("preferredOrientation",this.reorient),this.preview=this.previewHost.element,this.tip.replaceChild(this.preview,Nt),n.setCancellationHandler(()=>this.show(null,!1,null)),n.on("startFade",()=>{this.element.classList.remove("kmw-preview-fade"),this.element.offsetWidth,this.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",(i=this.previewHost)==null||i.off("preferredOrientation",this.reorient),this.previewHost=null;let l=this.preview;this.preview=document.createElement("div"),this.tip.replaceChild(this.preview,l),this.element.classList.remove("kmw-preview-fade"),this.orientation=Dr}this.key=e,this.state=t}};r(nl,"KeyTip");var ds=nl;var sl="kmw-keypreview",aa="kmw-preview-overlay",Fa="kmw-keytip",Bl=class Bl{constructor(e){this.state=!1;this.vkbd=e;let t=this.element=document.createElement("div");t.className=sl,t.id="kmw-keytip",t.style.pointerEvents="none",t.style.display="none",this.preview=document.createElement("div"),t.appendChild(this.preview)}show(e,t,n){let s=this.vkbd,B=e==null?void 0:e.key.spec.displayLayer;if(t&&s.layerGroup.blinkLayer(B),t&&(e!=null&&e.offsetParent)){let c=this.vkbd.topContainer.getBoundingClientRect(),i=e.getBoundingClientRect(),l=B!=s.layerId?aa:"";this.element.className=`${sl} ${e.className} ${l}`,this.element.id=`${Fa}-${e.id}`;let a=this.element.style,F=this.vkbd.currentLayer.element.style.fontFamily;if(a.fontFamily=e.key.spec.font||F,a.left=i.left-c.left+"px",a.top=i.top-c.top+"px",a.width=i.width+"px",a.height=i.height+"px",this.element.style.display="block",this.previewHost==n)return;let o=this.preview;this.previewHost=n,n&&(this.preview=this.previewHost.element,this.element.replaceChild(this.preview,o),n.setCancellationHandler(()=>this.show(null,!1,null)),n.on("startFade",()=>{this.element.classList.remove("kmw-preview-fade"),this.element.offsetWidth,this.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",this.element.className=sl,this.previewHost=null;let c=this.preview;this.preview=document.createElement("div"),this.element.replaceChild(this.preview,c),this.element.classList.remove("kmw-preview-fade")}this.key=e,this.state=t}};r(Bl,"TabletKeyTip");var RB=Bl;function Vt(Q){try{if(Q=="desktop")return 1;var e=document.documentElement.clientWidth;if(screen.width>e)return 1;var t=screen.width;return gt()?screen.width<screen.height&&(t=screen.height):screen.width>screen.height&&(t=screen.height),Math.round(100*t/e)/100}catch(n){return 1}}r(Vt,"getViewportScale");var Re=class Re{constructor(e,t){this.directlyEmitsKeys=!0;this.hasModalVisualization=!1;this.deleteRepeater=r(()=>{this.repeatClosure(),this.timerHandle=window.setTimeout(this.deleteRepeater,Re.REPEAT_DELAY)},"deleteRepeater");this.source=e;let n=e.stageReports[0].item;n.key.highlight(!0),this.repeatClosure=()=>{t(),n.key.highlight(!0)},this.timerHandle=window.setTimeout(this.deleteRepeater,Re.INITIAL_DELAY),this.source.on("complete",()=>{window.clearTimeout(this.timerHandle),this.timerHandle=void 0,n.key.highlight(!1)})}cancel(){this.deleteRepeater(),this.source.cancel()}currentStageKeyDistribution(){return null}};r(Re,"HeldRepeater"),Re.INITIAL_DELAY=500,Re.REPEAT_DELAY=100;var HB=Re;var cl=class cl extends St{constructor(e,t){if(typeof t!="string"||t=="")throw"The 'layer' parameter for subkey construction must be properly defined.";super(e,t)}getId(){return"popup-"+this.spec.elementID}construct(e,t,n,s){let B=this.spec,c=document.createElement("div"),i=c.style;c.className="kmw-key-square-ex",s&&(i.marginTop="5px"),i.width=n+"px",i.height=t.offsetHeight+"px";let l=document.createElement("div"),a=this.btn=LB(l,new on(this,B.id));this.setButtonClass(),a.id=this.getId();let F=a.style;return F.height=i.height,F.lineHeight=t.style.lineHeight,F.width=i.width,F.position="absolute",a.appendChild(this.label=this.generateKeyText(e)),c.appendChild(a),this.square=c}allowsKeyTip(){return!1}};r(cl,"OSKSubKey");var gs=cl;var Kr=.2,oa=1.2,jr=3,Un=5,Pr=6+jr,il=class il{constructor(e,t,n,s,B){this.directlyEmitsKeys=!0;this.shouldLockLayer=!1;var G;this.baseKey=s,this.source=e,this.gestureParams=B,n.layerLocked&&(this.shouldLockLayer=!0),e.on("complete",()=>{var C;(C=this.currentSelection)==null||C.key.highlight(!1),this.clear()}),e.on("stage",()=>{let C=this.currentSelection;if(C){let h=n.keyEventFromSpec(C.key.spec);h.keyDistribution=this.currentStageKeyDistribution(),n.raiseKeyEvent(h,C)}});let c=e.stageReports[0].sources[0].constructSubview(!0,!1);c.path.on("step",C=>{var h,S;c.path.stats.netDistance>=4&&((h=this.currentSelection)==null||h.key.highlight(!1),(S=C.item)==null||S.key.highlight(!0),this.currentSelection=C.item)}),this.currentSelection=s,s.key.highlight(!0);let i=s.subKeys,l=this.element=document.createElement("div");l.id="kmw-popup-keys";var a=l.style;a.fontFamily=n.fontFamily;let F=getComputedStyle(s);a.fontSize=F.fontSize,a.visibility="hidden";let o=s.key.layer;(typeof o!="string"||o=="")&&(o=n.layerId);let d=i.length,U=Math.ceil(d/9),u=Math.ceil(d/U);this.subkeys=[];let g=Un,y=0;for(let C=0,h=0;C<d;C++,h++){let S=typeof i[C].width!="undefined"?i[C].width*s.offsetWidth/100:s.offsetWidth;S>n.width-2*Un&&(S=n.width-2*Un),(g+S+Un>n.width||h>=u)&&(y++,h=0,g=Un);let R=new gs(i[C],o).construct(n,s,S,y>0);g+=S+Un,this.menuWidth=Math.max((G=this.menuWidth)!=null?G:0,g),this.subkeys.push(R.firstChild),l.appendChild(R)}a.width=this.menuWidth+"px",this.shim=document.createElement("div"),this.shim.id="kmw-popup-shim",n.device.formFactor==Z.FormFactor.Phone&&this.selectDefaultSubkey(s,l),n.element.appendChild(this.element),n.topContainer.appendChild(this.shim),this.reposition(n);let x=this.buildPopupRecognitionConfig(n);t({type:"push",config:x})}buildPopupRecognitionConfig(e){let t=this.element.getBoundingClientRect(),n=this.baseKey.getBoundingClientRect(),s=this.subkeys[0].style,c=-.666*Number.parseInt(s.height,10),i=3,l=n.bottom-t.bottom,a=new ot(this.element,[c*i,c,-l<c?-l:c]),F={getBoundingClientRect(){let o=Number.MAX_SAFE_INTEGER;return new DOMRect(-o,-o,2*o,2*o)}};return{targetRoot:this.element,inputStartBounds:e.element,maxRoamingBounds:F,safeBounds:F,itemIdentifier:(o,d)=>{let U=a.getBoundingClientRect(),u=null,g=Number.MAX_VALUE,y=Number.MAX_VALUE;if(o.clientX<U.left||o.clientX>U.right||o.clientY<U.top||o.clientY>U.bottom)return null;for(let x of this.subkeys){let G=x.getBoundingClientRect(),C=Number.MAX_VALUE,h=Number.MAX_VALUE;if(G.left<=o.clientX&&o.clientX<G.right?C=0:C=G.left>=o.clientX?G.left-o.clientX:o.clientX-G.right,G.top<=o.clientY&&o.clientY<G.bottom?h=0:h=G.top>=o.clientY?G.top-o.clientY:o.clientY-G.bottom,C==0&&h==0)return x;(C<y||C==y&&h<g)&&(y=C,u=x,g=h)}return u}}}reposition(e){let t=this.element,n=this.baseKey,s=e.topContainer,B=n.key.row.element,c=t.style,i=n.offsetParent?n.offsetParent.offsetLeft:0;var l=n.offsetLeft+i+.5*(n.offsetWidth-t.offsetWidth),a=e.width-t.offsetWidth;l>a&&(l=a),l<0&&(l=0),c.left=l+"px";let F=s.getBoundingClientRect(),o=B.getBoundingClientRect();c.top=o.top-F.top-t.offsetHeight-jr+"px",c.visibility="visible";let d=e.isEmbedded,U=getComputedStyle(t),u=parseFloat(U.top),g=0,y=0;u<g&&d&&(y=g-u,c.top=g+"px"),this.callout=this.addCallout(n,y,e.element,e.topContainer,e.device.formFactor=="tablet")}addCallout(e,t,n,s,B){t=t||0;let c=getComputedStyle(this.element),i=Math.max(Number.parseInt(c.borderRadius),0),l=e.getBoundingClientRect(),a=s.getBoundingClientRect(),F=Math.floor(Number.parseInt(c.top,10)+Number.parseInt(c.height,10)+Number.parseInt(c.paddingTop,10)/2+Number.parseInt(c.paddingBottom,10)),o=Kr*(l.height-t),d=Kr*l.height,U=o+Pr,u=U/(d+Pr),g=l.bottom-a.top-F-1,y=g<U?g:U;if(y>0){let x=document.createElement("div"),G=x.style;x.id="kmw-popup-callout",n.appendChild(x),G.top=F+"px",G.borderTopWidth=y+"px";let C=oa*u,h=l.width*C,S=this.menuWidth-2*i,H=S<h?S:h,R=l.left-a.left-(H-l.width)/2,Y=Math.max(0,R+H-(a.right-i)),_t=Math.max(0,i-R);return G.left=l.left-a.left-(H-l.width)/2+_t+"px",G.borderLeftWidth=H/2-_t+"px",G.borderRightWidth=H/2-Y+"px",x}else return null}selectDefaultSubkey(e,t){var B;var n;let s=e.subKeys;for(let c=0;c<s.length;c++){let i=s[c],l=t.childNodes[c].firstChild;if(i.default){n=l;break}else if(!e.key||!e.key.spec)continue;i.elementID==e.key.spec.elementID&&(n=l)}n&&((B=this.currentSelection)==null||B.key.highlight(!1),this.currentSelection=n,n.key.highlight(!0))}get hasModalVisualization(){return this.element.style.visibility=="visible"}buildCorrectiveLayout(){let e=this.element.getBoundingClientRect(),t=e.width/e.height;return{keys:this.subkeys.map(s=>{let B=s.getBoundingClientRect();return{keySpec:s.key.spec,centerX:(B.right-B.width/2-e.left)/e.width,centerY:(B.bottom-B.height/2-e.top)/e.height,width:B.width/e.width,height:B.height/e.height}}),kbdScaleRatio:t}}currentStageKeyDistribution(){let e=this.source.stageReports[this.source.stageReports.length-1],t=this.source.stageReports[0],n=e.sources[0],s=n.currentSample,B=this.element.getBoundingClientRect(),c={x:s.targetX/B.width,y:s.targetY/B.height};c.x=c.x<0?0:c.x>1?1:c.x,c.y=c.y<0?0:c.y>1?1:c.y;let i=hB(c,this.buildCorrectiveLayout()),l=i.get(s.item.key.spec),a=Math.min(n.path.stats.duration-t.sources[0].path.stats.duration,this.gestureParams.longpress.waitLength)/(2*this.gestureParams.longpress.waitLength),F=Math.min(n.path.stats.rawDistance,this.gestureParams.longpress.noiseTolerance*4)/(this.gestureParams.longpress.noiseTolerance*8),o=Math.min(a*a,F*F),d=l+o,U=new Map,u=this.subkeys.find(g=>g.keyId==this.baseKey.keyId);return u?U.set(u.key.spec,d):U.set(this.baseKey.key.spec,d),Fe([i,U])}cancel(){this.clear(),this.source.cancel()}clear(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.shim.parentNode&&this.shim.parentNode.removeChild(this.shim),this.callout&&this.callout.parentNode&&this.callout.parentNode.removeChild(this.callout)}};r(il,"SubkeyPopup");var dn=il;var ll=class ll{constructor(e,t,n){this.directlyEmitsKeys=!0;this.shouldRestore=!1;this.hasModalVisualization=!1;let s=e.stageReports[0];this.originalLayer=s.sources[0].stateToken,this.source=e,this.completionCallback=()=>{t.lockLayer(!1),this.shouldRestore&&(t.layerId=this.originalLayer,t.updateState()),n==null||n()},t.lockLayer(!0),e.on("stage",B=>{let c=B.matchedId;c.includes("modipress")&&c.includes("-end")?this.clear():c.includes("modipress")&&c.includes("-hold")&&(this.shouldRestore=!0)}),e.on("complete",()=>this.cancel())}get isLocked(){return this.shouldRestore}setLocked(){this.shouldRestore=!0}get completed(){return this.completionCallback===null}clear(){let e=this.completionCallback;this.completionCallback=null,e==null||e()}cancel(){this.clear(),this.source.cancel()}currentStageKeyDistribution(e){return null}};r(ll,"Modipress");var oe=ll;var rl=class rl{constructor(e,t,n,s,B){this.directlyEmitsKeys=!0;this.hasModalVisualization=!1;this.tapIndex=0;this.baseKey=n,this.baseContextToken=s,this.multitaps=[n.key.spec].concat(n.key.spec.multitap),this.sequence=e;let c=r(o=>{var U;(U=this.modipress)==null||U.clear();let d=new oe(e,t,()=>{this.modipress=t.activeModipress=null});this.modipress=t.activeModipress=d},"startModipress");this.originalLayer=t.layerId;let i=r(o=>(this.tapIndex+o)%this.multitaps.length,"tapLookahead"),l=r(()=>{B==null||B.setMultitapHint(this.multitaps[i(0)],this.multitaps[i(1)],t)},"updatePreview");e.on("complete",()=>{var o;(o=this.modipress)==null||o.cancel(),this.clear()});let a=r(o=>{var y;switch(o.matchedId){case"modipress-hold":this.clear(),e.off("stage",a);return;case"modipress-end-multitap-transition":case"modipress-multitap-end":case"modipress-end":case"multitap-end":case"simple-tap":return;case"modipress-multitap-lock-transition":(y=this.modipress)==null||y.setLocked();return;case"modipress-multitap-start":case"multitap-start":break;default:throw new Error(`Unsupported gesture state encountered during multitap: ${o.matchedId}`)}this.tapIndex=i(1);let d=this.multitaps[this.tapIndex];l();let U=t.keyEventFromSpec(d);U.baseTranscriptionToken=this.baseContextToken;let u=o.sources[0].currentSample,g=t.getSimpleTapCorrectionDistances(u,this.baseKey.key.spec);if(u.stateToken!=t.layerId&&!o.matchedId.includes("modipress")){let x=t.layerGroup.findNearestKey(L(b({},u),{stateToken:t.layerId})),G=g.get(x.key.spec);G==null&&console.warn("Could not find current layer's key"),g.delete(x.key.spec),g.set(u.item.key.spec,G)}U.keyDistribution=this.currentStageKeyDistribution(g),U.kNextLayer||(U.kNextLayer=this.originalLayer),t.raiseKeyEvent(U,null),o.matchedId=="modipress-multitap-start"&&c(o)},"stageHandler");e.on("stage",a),e.stageReports[0].matchedId=="modipress-start"&&c(e.stageReports[0]),l()}currentStageKeyDistribution(e){let t=Fe(e),n=t.findIndex(l=>l.keySpec==this.baseKey.key.spec);if(n==-1)return cs(this.baseKey)||console.warn("Could not find base key's probability for multitap correction"),t;let s=t.splice(n,1)[0].p,B=0,c=[];for(let l=0;l<this.multitaps.length;l++){let a=this.multitaps[l],F=Math.abs(l-this.tapIndex)%this.multitaps.length,o=(l+this.multitaps.length-this.tapIndex)%this.multitaps.length,d=F<o?F:o,U=1/((1+d)*(1+d));B+=U,c.push({keySpec:a,p:U})}let i=s/B;return c.forEach(l=>{l.p=i*l.p}),t.concat(c).sort((l,a)=>a.p-l.p)}cancel(){this.clear(),this.sequence.cancel()}clear(){}};r(rl,"Multitap");var us=rl;var ys=1.4142,Ql=r(Q=>Math.abs(Q)<1e-10?0:Q,"coerceZeroes"),al=class al extends V.default{constructor(t,n,s,B){var d;super();this.flickPreviews=new Map;this.orientation="top";let c=t.key.spec,i=this.flickEdgeLength=Math.max(s,B),l=this.div=document.createElement("div");l.className=l.id="kmw-gesture-preview",l.style.pointerEvents="none";let a=this.previewImgContainer=document.createElement("div");this.previewImgContainer.id="kmw-preview-img-container";let F=this.label=document.createElement("span");if(F.className="kmw-gesture-base-label kmw-key-text",F.id="kmw-gesture-base-label",a.appendChild(F),F.textContent=t.key.label.textContent,this.div.appendChild(this.previewImgContainer),c.flick){let U=c.flick||{};Object.keys(U).forEach(u=>{let g=document.createElement("div");g.className="kmw-flick-preview kmw-key-text",g.textContent=U[u].text;let y=g.style,x=Ni.get(u),G=Ql(-Math.sin(x[0])),C=Ql(Math.cos(x[0]));y.width="100%",y.textAlign="center",G<0?y.right=-G*ys*i+"px":G>0?y.left=G*ys*i+"px":y.left="0px",y.height="100%",y.lineHeight="100%",C<0?y.bottom=-C*ys*i+"px":C>0?y.top=C*ys*i+"px":y.top="0px",this.flickPreviews.set(u,g),a.appendChild(g)})}let o=this.hintLabel=document.createElement("div");o.className="kmw-key-popup-icon",n||(o.textContent=c==c.hintSrc?c.hint:(d=c.hintSrc)==null?void 0:d.text,o.style.fontWeight=o.textContent=="\u2022"?"bold":""),l.appendChild(o)}get element(){return this.div}refreshLayout(){let t=getComputedStyle(this.div),n=Number.parseInt(t.height,10);this.flickPreviews.forEach(s=>{s.style.lineHeight=s.style.height=`${n}px`})}cancel(){var t;(t=this.onCancel)==null||t.call(this),this.onCancel=null}setCancellationHandler(t){this.onCancel=t}setMultitapHint(t,n,s){var i,l;let B=Je(t.text,s),c=Je(n.text,s);this.label.textContent=B,this.hintLabel.textContent=c,this.label.style.fontFamily=B!=t.text?"SpecialOSK":(i=t.font)!=null?i:this.label.style.fontFamily,this.hintLabel.style.fontFamily=c!=n.text?"SpecialOSK":(l=n.font)!=null?l:this.hintLabel.style.fontFamily,this.emit("startFade"),this.clearFlick()}scrollFlickPreview(t,n){this.clearHint();let s=this.previewImgContainer.style,B=this.flickEdgeLength*ys;s.marginLeft=`${B*t}px`,s.marginTop=`${B*n}px`;let c=Ql(n)<0?"bottom":"top";this.orientation!=c&&(this.orientation=c,this.emit("preferredOrientation",c))}clearFlick(){this.previewImgContainer.style.marginTop="0px",this.previewImgContainer.style.marginLeft="0px",this.previewImgContainer.classList.add("kmw-flick-clear")}clearHint(){this.hintLabel.classList.add("kmw-hint-clear")}clearAll(){this.clearFlick()}};r(al,"GesturePreviewHost");var WB=al;var _r=te.TIER!="stable"||te.VERSION_ENVIRONMENT!="",Ua=_r?10:0,Is=class Is extends V.default{constructor(t){var a,F,o;super();this.layerLocked=!1;this.layerIndex=0;this.isStatic=!1;this._fixedWidthScaling=!1;this._fixedHeightScaling=!0;this._borderWidth=0;this.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};this.activeGestures=[];this.activeModipress=null;this.repeatDelete=function(){this.deleting&&(this.modelKeyClick(this.deleteKey),this.deleting=window.setTimeout(this.repeatDelete,100))}.bind(this);this.config=t,this.config.device=t.device||t.hostDevice,this.config.isEmbedded=t.isEmbedded||!1,t.isStatic&&(this.isStatic=t.isStatic),(a=this.config).gestureParams||(a.gestureParams=b({},Bs)),this._fixedWidthScaling=this.device.touchable&&!this.isStatic,this._fixedHeightScaling=this.device.touchable&&!this.isStatic;var n=document.createElement("div");this.config.styleSheetManager=t.styleSheetManager||new at(n);let s;if(t.keyboard)s=this.kbdLayout=t.keyboard.layout(t.device.formFactor),this.layoutKeyboardProperties=t.keyboardMetadata,this.isRTL=t.keyboard.isRTL;else{let d=f.buildDefaultLayout(null,null,t.device.formFactor);s=this.kbdLayout=Ye.polyfill(d,null,t.device.formFactor),this.layoutKeyboardProperties=null,this.isRTL=!1}"font"in s?this.fontFamily=s.font:this.fontFamily="";let B=t.device.formFactor;this.layoutKeyboard=t.keyboard,this.layoutKeyboard||(this.layoutKeyboard=new k(null)),this.layerGroup=new Us(this,this.layoutKeyboard,B),this.layoutKeyboard.markLayoutCalibrated(B),n.appendChild(this.layerGroup.element),this.kbdDiv=n,this.isStatic||(this.gestureEngine=this.constructGestureEngine()),n.classList.add(t.device.formFactor,"kmw-osk-inner-frame");let c=(o=(F=this.layoutKeyboard)==null?void 0:F.id.replace("Keyboard_",""))!=null?o:"",i=c.indexOf("::");i!=-1&&(c=c.substring(i+2));let l="kmw-keyboard-"+c;this.element.classList.add(l)}get gestureParams(){return this.config.gestureParams}get layerId(){var t,n;return(n=(t=this.layerGroup)==null?void 0:t.activeLayerId)!=null?n:"default"}set layerId(t){let n=t!=this.layerId;if(this.layerGroup.getLayer(t))this.layerGroup.activeLayerId=t,this.gestureEngine&&(this.gestureEngine.stateToken=t);else throw new Error(`Keyboard ${this.layoutKeyboard.id} does not have a layer with id ${t}`);n&&!this.deferLayout&&(this.updateState(),this.layerGroup.refreshLayout(this.constructLayoutParams()))}get currentLayer(){var t;return(t=this.layerGroup)==null?void 0:t.activeLayer}get lgKey(){var t,n;return(n=(t=this.currentLayer)==null?void 0:t.globeKey)==null?void 0:n.btn}get hkKey(){var t,n;return(n=(t=this.currentLayer)==null?void 0:t.hideKey)==null?void 0:n.btn}get spaceBar(){var t,n;return(n=(t=this.currentLayer)==null?void 0:t.spaceBarKey)==null?void 0:n.btn}constructGestureEngine(){let t={targetRoot:this.element,mouseEventRoot:document.body,maxRoamingBounds:new ot(this.topContainer,[NaN]),itemIdentifier:(i,l)=>this.layerGroup.findNearestKey(i),recordingMode:_r,historyLength:Ua},n=new Ze(fi(this.kbdLayout,this.gestureParams),t);n.stateToken=this.layerId;let s={},B=r(i=>{for(let l of Object.keys(s)){if(l==i)continue;s[l].source.terminate(!0)}},"clearActiveGestures"),c=new Map;return n.on("inputstart",i=>{var o;let l=this.highlightKey(i.currentSample.item,!0);l&&((o=this.gesturePreviewHost)==null||o.cancel(),this.gesturePreviewHost=l),s[i.identifier]={source:i,roamingHighlightHandler:null,key:i.currentSample.item,previewHost:l};let a=s[i.identifier],F=r(()=>{Qt(0).then(()=>{let d=a.previewHost;d&&(d.cancel(),this.gesturePreviewHost=null,a.previewHost=null),a.key&&(this.highlightKey(a.key,!1),a.key=null)})},"endHighlighting");a.roamingHighlightHandler=d=>{var g;let U=d.item,u=s[i.identifier].key;if(!this.kbdLayout.hasFlicks&&U!=u){this.highlightKey(u,!1),(g=this.gesturePreviewHost)==null||g.cancel(),this.gesturePreviewHost=null,a.previewHost=null;let y=this.highlightKey(U,!0);y&&(this.gesturePreviewHost=y,a.previewHost=y),s[i.identifier].key=U}},i.path.on("invalidated",F),i.path.on("complete",F),i.path.on("step",a.roamingHighlightHandler)}),n.on("recognizedgesture",i=>{var l;(l=this.activeModipress)==null||l.setLocked(),i.on("complete",()=>{var a;for(let F of i.allSourceIds)(a=s[F])!=null&&a.previewHost&&(this.gesturePreviewHost=null,s[F].previewHost.cancel()),delete s[F]}),i.on("stage",(a,F)=>{let o=i.allSourceIds.map(h=>{var S;return(S=s[h])==null?void 0:S.previewHost}).find(h=>!!h),d=r(()=>{o&&(o.cancel(),this.gesturePreviewHost=null)},"clearPreviewHost"),U=c.get(i);!U&&o&&!a.matchedId.includes("flick")&&o.clearFlick();let u;for(let h of a.allSourceIds){let S=r(H=>{H.key&&(this.highlightKey(H.key,!1),H.key=null),H.source.path.off("step",H.roamingHighlightHandler)},"clearRoaming");if(u=s[h],u)S(u);else{let H=h;Qt(0).then(()=>{let R=s[H];R&&S(R)})}}let g=a.item,y=a.sources[0],x=y?y.currentSample:null,G=null;if(g&&!(U&&U[0].directlyEmitsKeys)){let h,S=this.getSimpleTapCorrectionDistances(y.currentSample,g.key.spec);U&&(h=U[0].currentStageKeyDistribution(S)),h||(h=Fe(S));let H=!this.layerLocked&&U&&U[0]instanceof dn&&U[0].shouldLockLayer;try{H&&this.lockLayer(!0),G=this.modelKeyClick(a.item,x,h)}finally{H&&this.lockLayer(!1)}}if(i.stageReports.length>1&&a.matchedId!="modipress-end")return;let C=i.stageReports[0].item;if(a.matchedId=="special-key-start")g.key.spec.baseKeyID=="K_BKSP"?(d(),U=[new HB(i,()=>this.modelKeyClick(g,x))]):g.key.spec.baseKeyID=="K_LOPT"&&(i.on("complete",()=>{g.key.highlight(!1),this.emit("globekey",g,!1)}),B(y.identifier),g.key.highlight(!0));else if(a.matchedId.indexOf("longpress")>-1)d(),U=[new dn(i,F,this,i.stageReports[0].sources[0].baseItem,this.gestureParams)];else if(C!=null&&C.key.spec.multitap&&(a.matchedId=="initial-tap"||a.matchedId=="multitap"||a.matchedId=="modipress-start"))u.previewHost=null,i.on("complete",()=>{d()}),U=[new us(i,this,C,G.contextToken,o)];else if(a.matchedId.indexOf("flick")>-1)U=[new ns(i,F,this,i.stageReports[0].sources[0].baseItem,this.gestureParams,o)];else if(a.matchedId.includes("modipress")&&a.matchedId.includes("-start"))if(d(),this.layerLocked)console.warn("Unexpected state:  modipress start attempt during an active modipress");else{U||(U=[]);let h=new oe(i,this,()=>{let S=U.indexOf(h);S>-1&&U.splice(S,1),this.activeModipress=null});U.push(h),this.activeModipress=h}else d();U&&(this.activeGestures=this.activeGestures.concat(U),c.set(i,U),i.on("complete",()=>{let h=this.activeGestures.filter(S=>U.includes(S));this.activeGestures=this.activeGestures.filter(S=>!U.includes(S)),h.forEach(S=>{S instanceof oe&&S.cancel()})}))})}),n}get element(){return this.kbdDiv}get device(){return this.config.device}get hostDevice(){return this.config.hostDevice}get fontRootPath(){return this.config.pathConfig.fonts}get styleSheetManager(){return this.config.styleSheetManager}get topContainer(){return this.config.topContainer}get isEmbedded(){return this.config.isEmbedded}postInsert(){}get width(){return this._width}get height(){return this._height}get layoutWidth(){if(this.usesFixedWidthScaling){let t=this.width;return t-=this._borderWidth*2,p.inPixels(t)}else return p.forScalar(1)}get layoutHeight(){if(this.usesFixedHeightScaling){let t=this.height;return t-=this._borderWidth*2,p.inPixels(t)}else return p.forScalar(1)}get internalHeight(){return this.usesFixedHeightScaling?p.inPixels(this.layoutHeight.val-this._borderWidth*2-this.layerGroup.verticalPadding):p.forScalar(1)}get fontSize(){return this._fontSize||(this._fontSize=new p("1em")),this._fontSize}set fontSize(t){this._fontSize=t,this.kbdDiv.style.fontSize=t.styleString}get usesFixedWidthScaling(){return this._fixedWidthScaling}set usesFixedWidthScaling(t){this._fixedWidthScaling=t}get usesFixedHeightScaling(){return this._fixedHeightScaling}set usesFixedHeightScaling(t){this._fixedHeightScaling=t}get usesFixedPositioning(){let t=this.element;for(;t;){if(getComputedStyle(t).position=="fixed")return!0;t=t.offsetParent}return!1}setSize(t,n,s){this._width=t,this._height=n,this.kbdDiv&&(this.kbdDiv.style.width=t?this._width+"px":"",this.kbdDiv.style.height=n?this._height+"px":"",!this.device.touchable&&n&&(this.fontSize=new p(this._height/8+"px")),s||this.refreshLayout())}getTouchCoordinatesOnKeyboard(t){let n={x:t.targetX,y:t.targetY};return n.x/=this.layerGroup.element.offsetWidth,n.y/=this.kbdDiv.offsetHeight,n}getSimpleTapCorrectionDistances(t,n){let s=this.getTouchCoordinatesOnKeyboard(t),c=this.layerGroup.element.offsetWidth,i=this.kbdDiv.offsetHeight;if(!c||!i)return new Map;let l=c/i,a=zr(this.kbdLayout.getLayer(this.layerId),l);return hB(s,a)}keyTarget(t){let n=t;try{if(n){if(n.classList.contains("kmw-key"))return EB(n);if(n.parentNode&&n.parentNode.classList.contains("kmw-key"))return EB(n.parentNode);if(n.firstChild&&n.firstChild.classList.contains("kmw-key"))return EB(n.firstChild)}}catch(s){}return null}cancelDelete(){this.deleting&&window.clearTimeout(this.deleting),this.deleting=0}modelKeyClick(t,n,s){let B=this.initKeyEvent(t);return n&&(B.source=n),s&&(B.keyDistribution=s),this.raiseKeyEvent(B,t)}initKeyEvent(t){this.highlightKey(t,!1);let n=t.key?t.key.spec:null;return n?this.keyEventFromSpec(n):null}keyEventFromSpec(t){let n=this.layoutKeyboard.constructKeyEvent(t,this.device,this.stateKeys);return n.srcKeyboard=this.layoutKeyboard,n}_UpdateVKShiftStyle(t){var i;var n;t||(t=this.layerId);let s=this.layerGroup.getLayer(t);if(!s||(this.gestureEngine&&(this.gestureEngine.stateToken=t),!((i=this.layoutKeyboard)!=null&&i.usesDesktopLayoutOnDevice(this.device))))return;let B=["K_CAPS","K_NUMLOCK","K_SCROLL"],c=[s.capsKey,s.numKey,s.scrollKey];for(n=0;n<c.length;n++)c[n]!=null&&c[n].setToggleState(this.stateKeys[B[n]])}updateStateKeys(t){for(let n of Object.keys(this.stateKeys))this.stateKeys[n]=t[n];this._UpdateVKShiftStyle()}highlightKey(t,n){if(!t||!t.key||t.className==""||t.className.indexOf("kmw-key-row")>=0)return null;let s=t.key.allowsKeyTip();return n=this.activeGestures.find(c=>c.hasModalVisualization)?!1:n,t.key.highlight(n),n&&s?this.gesturePreviewHost?null:this.showGesturePreview(t):null}getKeyEmFontSize(){if(!this.fontSize)return new p("0px");if(this.device.formFactor=="desktop"){let t=.8;return this.fontSize.scaledBy(t)}else{let t=getComputedStyle(document.body).fontSize,n=new p(t),s=1;if(!this.isStatic){if(this.fontSize.absolute)return this.fontSize;s=this.fontSize.val}return n.scaledBy(s)}}updateState(){this.currentLayer&&(this.nextLayer=this.layerId,this.currentLayer.nextlayer&&(this.nextLayer=this.currentLayer.nextlayer),this.layerGroup.activeLayerId=this.layerId,this._UpdateVKShiftStyle())}refreshLayout(){if(this.deferLayout)return;let t=this.device;var n=1;t.OS==Z.OperatingSystem.iOS&&!this.isEmbedded&&(n=n/Vt(this.device.formFactor));let s=this.kbdDiv.style;this.usesFixedHeightScaling&&this.height&&(s.height=s.maxHeight=this.height+"px"),s.fontSize=this.fontSize.scaledBy(n).styleString;let B=this.width&&this.height,c=getComputedStyle(this.kbdDiv),i=getComputedStyle(this.layerGroup.element),l=c.height!=""&&c.height!="auto";if(c.border&&(this._borderWidth=new p(c.borderWidth).val),B)this._computedWidth=this.width,this._computedHeight=this.height;else if(l)this._computedWidth=parseInt(c.width,10),this._computedWidth||(this._computedWidth=parseInt(i.width,10)),this._computedHeight=parseInt(c.height,10);else return;this.layerGroup.refreshLayout(this.constructLayoutParams()),this.isStatic||(this.gestureEngine.config.maxRoamingBounds.updatePadding([-.333*this.currentLayer.rowHeight]),this.gestureParams.longpress.flickDistStart=.24*this.currentLayer.rowHeight,this.gestureParams.flick.startDist=.3*this.currentLayer.rowHeight,this.gestureParams.flick.dirLockDist=.35*this.currentLayer.rowHeight,this.gestureParams.flick.triggerDist=.75*this.currentLayer.rowHeight,this.gestureParams.longpress.flickDistFinal=.75*this.currentLayer.rowHeight)}constructLayoutParams(){var t,n;return{keyboardWidth:this._computedWidth-2*this._borderWidth,keyboardHeight:this._computedHeight-2*this._borderWidth-this.layerGroup.verticalPadding,widthStyle:this.layoutWidth,heightStyle:this.internalHeight,baseEmFontSize:this.getKeyEmFontSize(),layoutFontSize:new p(this.layerGroup.element.style.fontSize),spacebarText:(n=(t=this.layoutKeyboardProperties)==null?void 0:t.displayName)!=null?n:"(System keyboard)"}}computedAdjustedOskHeight(t){if(!this.layerGroup)return t;let n=this.layerGroup.spec.layer,s=0;for(let i in n){let a=n[i].row.length,F=Math.floor(t/(a==0?1:a)),o=a*F;o>s&&(s=o)}return s+0}appendStyleSheet(){var t=this.layoutKeyboard,n=this.layoutKeyboardProperties;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet);var s=n==null?void 0:n.textFont,B=n==null?void 0:n.oskFont;this.styleSheetManager.addStyleSheetForFont(s,this.fontRootPath,this.device.OS),this.styleSheetManager.addStyleSheetForFont(B,this.fontRootPath,this.device.OS),this.config.specialFont&&this.styleSheetManager.addStyleSheetForFont(this.config.specialFont,"",this.device.OS);var c=this.addFontStyle(s,B);t!=null&&typeof t.oskStyling=="string"&&(c=c+t.oskStyling),c&&(this.styleSheet=Be(c),this.styleSheetManager.linkStylesheet(this.styleSheet)),this.styleSheetManager.allLoadedPromise().then(()=>{this.layerGroup.resetPrecalcFontSizes(),this.refreshLayout()})}addFontStyle(t,n){let s="",B=r(c=>c.family.replace(/\u0022/g,"").replace(/,/g,'","'),"family");return(t||n)&&(s=`
.kmw-key-text {
  font-family: "${B(n||t)}";
}

.kmw-suggestion-text {
  font-family: "${B(t||n)}";
}
`),s}static buildDocumentationKeyboard(t,n,s,B,c,i){if(!t)return null;var l=typeof B=="undefined"?"desktop":B,a=typeof c=="undefined"?"default":c,F={};F.formFactor=l,l!="desktop"?(F.OS=Z.OperatingSystem.iOS,F.touchable=!0):(F.OS=Z.OperatingSystem.Windows,F.touchable=!1);let o=t.layout(l),d=new Z("other",F.formFactor,F.OS,F.touchable),U=new Is({keyboard:t,keyboardMetadata:n,hostDevice:d,isStatic:!0,topContainer:null,pathConfig:s,styleSheetManager:null,specialFont:{family:"SpecialOSK",files:[`${s.resources}/osk/keymanweb-osk.ttf`],path:""}});U.layerGroup.element.className=U.kbdDiv.className,U.layerGroup.element.classList.add(F.formFactor+"-static");let u=U.kbdDiv.childNodes[0],g=document.createElement("div");g.classList.add(F.OS.toLowerCase(),F.formFactor),o!=null?(U.layerId=a,U.layerGroup.activeLayerId=a,U.setSize(800,i),U.fontSize=kr(d,i,!1),g.style.fontSize=U.element.style.fontSize,U.refreshLayout(),u.style.height=U.kbdDiv.style.height,u.style.maxHeight=U.kbdDiv.style.maxHeight):u.innerHTML="<p style='color:#c40; font-size:0.5em;margin:10px;'>No "+l+" layout is defined for "+t.name+".</p>",u.style.border="1px solid #ccc",U.updateState();let y=r(()=>E(this,null,function*(){if(document.contains(u))try{yield U.styleSheetManager.allLoadedPromise();let G=U.styleSheet;G&&u.appendChild(G);let C=[].concat(U.styleSheetManager.sheets);for(let h of C)h!=G&&(h.href||(U.styleSheetManager.unlink(h),document.head.appendChild(h)));U.refreshLayout(),U.styleSheet=null,U.shutdown()}finally{x.disconnect()}}),"detectAndHandleInsertion"),x=new MutationObserver(y);x.observe(document.body,{childList:!0,subtree:!0}),g.append(u);for(let G of bt.STYLESHEET_FILES){let C=`${s.resources}/osk/${G}`,h=U.styleSheetManager.linkExternalSheet(C,!0);h.parentNode.removeChild(h),g.appendChild(h)}return U.appendStyleSheet(),g}onHide(){this.hkKey&&this.highlightKey(this.hkKey,!1)}optionKey(t,n,s){n.indexOf("K_LOPT")>=0?this.emit("globekey",t,s):n.indexOf("K_ROPT")>=0&&s&&this.emit("hiderequested",t)}showGesturePreview(t){let n=this.keytip,s=this.constructLayoutParams(),B=s.keyboardWidth*t.key.spec.proportionalWidth,c=s.keyboardHeight/this.currentLayer.rows.length,i=new WB(t,this.device.formFactor=="phone",B,c);return n==null?t.key.setPreview(i):n.show(t,!0,i),i.refreshLayout(),i}createKeyTip(){if(this.keytip==null)if(this.device.formFactor=="phone"){let t=this.isEmbedded;this.keytip=new ds(this,t)}else this.keytip=new RB(this);this.keytip&&this.keytip.element&&this.element.appendChild(this.keytip.element)}createGlobeHint(){return this.config.embeddedGestureConfig.createGlobeHint?this.config.embeddedGestureConfig.createGlobeHint(this):null}shutdown(){var t;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet),this.activeGestures.forEach(n=>n.cancel()),this.gestureEngine&&this.gestureEngine.destroy(),this.deleting&&window.clearTimeout(this.deleting),(t=this.keytip)==null||t.show(null,!1,null)}lockLayer(t){this.layerLocked=t}raiseKeyEvent(t,n){if(t.kName=="K_LOPT"||t.kName=="K_ROPT")return this.optionKey(n,t.kName,!0),{};let s={},B=r((c,i)=>{var a,F;s.contextToken=(a=c==null?void 0:c.transcription)==null?void 0:a.token;let l=(F=c==null?void 0:c.transcription)==null?void 0:F.transform;s.alteredText=c&&(!l||Ge(l))},"keyEventCallback");return this.layerLocked&&(t.kNextLayer=this.layerId),this.emit("keyevent",t,B),s}};r(Is,"VisualKeyboard"),Is.specialCharacters=St.specialCharacters;var It=Is;var Fl=class Fl extends V.default{};r(Fl,"Activator");var Dt=Fl,ol=class ol extends Dt{get enabled(){return!0}set enabled(e){}get activate(){return!0}get conditionsMet(){return!0}};r(ol,"StaticActivator");var He=ol;var Ul=class Ul{constructor(){this.map=new Map}promiseForTouchpoint(e){return this.map.get(e)||this.map.set(e,new J),this.map.get(e)}maintainTouches(e){let t=Array.from(this.map.keys());for(let n=0;n<e.length;n++){let s=t.indexOf(e.item(n).identifier);s!=-1&&t.splice(s,1)}for(let n of t)this.map.get(n).resolve(),this.map.delete(n)}};r(Ul,"TouchEventPromiseMap");var bs=Ul;function qr(Q){let e="osk/";return Q.isEmbedded&&(e=""),`${Q.pathConfig.resources}/${e}`}r(qr,"getResourcePath");var gn=class gn extends V.default{constructor(t){var s;super();this.legacyEvents=new Bn;this.needsLayout=!0;this.touchEventPromiseManager=new bs;this.activationListener=r(t=>{if(!this.mayDisable&&!this.activationModel.enabled){this.activationModel.off("activate",this.activationListener);try{this.activationModel.enabled=!0}finally{this.activationModel.on("activate",this.activationListener)}}this.commonCheckAndDisplay()},"activationListener");this.layerChangeHandler=r((t,n)=>{var s,B;return this.vkbd&&this.vkbd._UpdateVKShiftStyle(n),(this.vkbd&&this.vkbd.layerId!=n||t.value!=n)&&(s=this.vkbd)!=null&&s.layerGroup.getLayer(n)&&!((B=this.vkbd)!=null&&B.layerLocked)&&(this.vkbd.layerId=n),!1},"layerChangeHandler");this._Visible=!1;this.config=t=b({},t),(s=this.config).gestureParams||(s.gestureParams=Bs),this.config.allowHideAnimations===void 0&&(this.config.allowHideAnimations=!0),this.config.device=t.device||t.hostDevice,this.config.isEmbedded=t.isEmbedded||!1,this.config.embeddedGestureConfig=t.embeddedGestureConfig||{},this.config.activator.on("activate",this.activationListener),this._Box=A("div"),this.kbdStyleSheetManager=new at(this._Box,this.config.doCacheBusting||!1),this.uiStyleSheetManager=new at(this._Box),this.bannerView=new iB,this.bannerView.events.on("bannerchange",()=>this.refreshLayout()),this._Box.appendChild(this.bannerView.element),this._bannerController=new rs(this.bannerView,this.hostDevice,this.config.predictionContextManager),this.keyboardView=this._GenerateKeyboardView(null,null),this._Box.appendChild(this.keyboardView.element);let n=qr(this.config);for(let B of gn.STYLESHEET_FILES){let c=`${n}${B}`;this.uiStyleSheetManager.linkExternalSheet(c)}this.setBaseMouseEventListeners(),this.hostDevice.touchable&&this.setBaseTouchEventListeners(),this._Box.style.display="none"}get keyCodes(){return m.keyCodes}get modifierCodes(){return m.modifierCodes}get modifierBitmasks(){return m.modifierBitmasks}get stateBitmasks(){return m.stateBitmasks}get gestureParams(){return this.config.gestureParams}get configuration(){return this.config}get bannerController(){return this._bannerController}get hostDevice(){return this.config.hostDevice}get fontRootPath(){return this.config.pathConfig.fonts}get isEmbedded(){return this.config.isEmbedded}setBaseMouseEventListeners(){this._Box.onmouseenter=t=>{this.mouseEnterPromise&&this.mouseEnterPromise.resolve(),this.mouseEnterPromise=new J,this.emit("pointerinteraction",this.mouseEnterPromise.corePromise)},this._Box.onmouseleave=t=>{this.mouseEnterPromise.resolve(),this.mouseEnterPromise=null}}removeBaseMouseEventListeners(){this._Box.onmouseenter=null,this._Box.onmouseleave=null}setBaseTouchEventListeners(){let t=r(function(n){return n.cancelable&&n.preventDefault(),n.stopPropagation(),!1},"commonPrevention");this._boxBaseTouchEventCancel=n=>(this.touchEventPromiseManager.maintainTouches(n.touches),t(n)),this._boxBaseTouchStart=n=>{for(let s=0;s<n.changedTouches.length;s++){let B=this.touchEventPromiseManager.promiseForTouchpoint(n.changedTouches[s].identifier);this.emit("pointerinteraction",B.corePromise)}return this.touchEventPromiseManager.maintainTouches(n.touches),t(n)},this._Box.addEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.addEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchcancel",this._boxBaseTouchEventCancel,!1)}removeBaseTouchEventListeners(){this._boxBaseTouchEventCancel&&(this._Box.removeEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.removeEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchcancel",this._boxBaseTouchEventCancel,!1),this._boxBaseTouchEventCancel=null,this._boxBaseTouchStart=null)}get targetDevice(){return this.config.device}set targetDevice(t){this.allowsDeviceChange(t)?(this.config.device=t,this.loadActiveKeyboard()):console.error("May not change target device for this OSKView type.")}allowsDeviceChange(t){return!1}get activationModel(){return this.config.activator}set activationModel(t){if(!t)throw new Error("The activation model may not be set to null or undefined!");this.config.activator.off("activate",this.activationListener),t.on("activate",this.activationListener),this.config.activator=t,this.commonCheckAndDisplay()}get mayDisable(){var t;return!(this.hostDevice.touchable||(t=this.activeKeyboard)!=null&&t.keyboard.isCJK)}get displayIfActive(){return this.activationModel.enabled}commonCheckAndDisplay(){this.activationModel.activate&&this.activeKeyboard?this.present():this.startHide(!1)}get vkbd(){return this.keyboardView instanceof It?this.keyboardView:null}get banner(){return this.bannerView}get width(){return this._width}get height(){return this._height}get computedWidth(){return this.needsLayout&&this.refreshLayout(),this._computedWidth}get computedHeight(){return this.needsLayout&&this.refreshLayout(),this._computedHeight}get baseFontSize(){var t;return((t=this.parsedBaseFontSize)==null?void 0:t.styleString)||""}get parsedBaseFontSize(){return this._baseFontSize||(this._baseFontSize=gn.defaultFontSize(this.targetDevice,this.computedHeight,this.isEmbedded)),this._baseFontSize}static defaultFontSize(t,n,s){if(t.touchable){let B=t.formFactor=="phone"?1.6*(s?.65:.6)*1.2:2;return p.special(B,"em")}else return n?p.inPixels(n/8):void 0}get activeKeyboard(){return this.keyboardData}set activeKeyboard(t){var n;this.keyboardData=t,this.loadActiveKeyboard(),(n=this.keyboardData)!=null&&n.keyboard.isCJK&&(this.activationModel.enabled=!0)}computeFrameHeight(){var t,n;return(((t=this.headerView)==null?void 0:t.layoutHeight.val)||0)+(((n=this.footerView)==null?void 0:n.layoutHeight.val)||0)}setSize(t,n,s){let B=!1,c,i;!t&&t!==0||!n&&n!==0||(Number.isFinite(t)?c=p.inPixels(t):c=new p(t),Number.isFinite(n)?i=p.inPixels(n):i=new p(n),t&&n&&(B=!this._width||!this._height,B=B||c.styleString!=this._width.styleString,B=B||i.styleString!=this._height.styleString,this._width=c,this._height=i),this.needsLayout=this.needsLayout||B,this.refreshLayoutIfNeeded(s))}setNeedsLayout(){this.needsLayout=!0}batchLayoutAfter(t){if(this.deferLayout){t();return}try{this.deferLayout=!0,this.vkbd&&(this.vkbd.deferLayout=!0),t()}finally{this.deferLayout=!1,this.vkbd&&(this.vkbd.deferLayout=!1),this.refreshLayout()}}refreshLayout(t){var i,l;if(!this.keyboardView||this.deferLayout||!(this.width&&this.height))return;let s=this.width.absolute&&this.height.absolute,B=getComputedStyle(this._Box),c=B.height!=""&&B.height!="auto";if(s)this._computedWidth=this.width.val,this._computedHeight=this.height.val;else if(c){let a=this._Box.parentElement;this._computedWidth=this.width.val*(this.width.absolute?1:a.offsetWidth),this._computedHeight=this.height.val*(this.height.absolute?1:a.offsetHeight)}else{console.warn("Unable to properly perform layout - specification uses a relative spec, thus relies upon insertion into the DOM for layout.");return}if(this.needsLayout=!1,this.banner.element.style.fontSize=this.baseFontSize,this.vkbd&&(this.vkbd.fontSize=this.parsedBaseFontSize),t||((i=this.headerView)==null||i.refreshLayout(),this.bannerView.width=this.computedWidth,this.bannerView.refreshLayout(),(l=this.footerView)==null||l.refreshLayout()),this.vkbd){let a=this.computedHeight-this.computeFrameHeight();this.bannerView.height>0&&(a-=this.bannerView.height+5),this.vkbd.setSize(this.computedWidth,a,t);let F=this._Box.style;F.width=F.maxWidth=this.computedWidth+"px",F.height=F.maxHeight=this.computedHeight+"px"}else{let a=this._Box.style;a.width="auto",a.height="auto",a.maxWidth=a.maxHeight=""}}refreshLayoutIfNeeded(t){this.needsLayout&&this.refreshLayout(t)}postKeyboardLoad(){this._Visible=!1,this.postKeyboardAdjustments(),this.displayIfActive&&this.present()}loadActiveKeyboard(){var B,c,i,l,a;this.setBoxStyling(),this.needsLayout=!0;let t=this.keyboardView,n=this.kbdStyleSheetManager;this.kbdStyleSheetManager=new at(this._Box,this.config.doCacheBusting||!1);let s=this.keyboardView=this._GenerateKeyboardView((B=this.keyboardData)==null?void 0:B.keyboard,(c=this.keyboardData)==null?void 0:c.metadata);if(this._Box.replaceChild(s.element,t.element),s.postInsert(),(a=this.bannerController)==null||a.configureForKeyboard((i=this.keyboardData)==null?void 0:i.keyboard,(l=this.keyboardData)==null?void 0:l.metadata),t instanceof It&&t.shutdown(),n.unlinkAll(),this.banner.appendStyles(),this.vkbd){this.vkbd.createKeyTip();let F=this.vkbd.createGlobeHint();F&&this._Box.appendChild(F.element),this.vkbd.appendStyleSheet()}this.postKeyboardLoad()}_GenerateKeyboardView(t,n){let s=this.targetDevice;return this._Box.className="",t==null&&!s.touchable?new Le:t&&t.layout(s.formFactor)?this._GenerateVisualKeyboard(t,n):!t||!n?this._GenerateVisualKeyboard(null,null):new Qs(t)}_GenerateVisualKeyboard(t,n){let s=this.targetDevice,B=qr(this.config),c=new It({keyboard:t,keyboardMetadata:n,device:s,hostDevice:this.hostDevice,topContainer:this._Box,styleSheetManager:this.kbdStyleSheetManager,pathConfig:this.config.pathConfig,embeddedGestureConfig:this.config.embeddedGestureConfig,isEmbedded:this.config.isEmbedded,specialFont:{family:"SpecialOSK",files:[`${B}/keymanweb-osk.ttf`],path:""},gestureParams:this.config.gestureParams});return c.on("keyevent",(i,l)=>this.emit("keyevent",i,l)),c.on("globekey",(i,l)=>this.emit("globekey",i,l)),c.on("hiderequested",i=>{this.doHide(!0),this.emit("hiderequested",i)}),this._Box.className=s.formFactor+" "+s.OS.toLowerCase()+" kmw-osk-frame",c}present(){if(this.mayShow()){if(this.keyboardView.updateState(),this._Box.style.display="block",this.refreshLayoutIfNeeded(),this._Visible=!0,this._Box.style.opacity="1",this._Box.style.visibility=="hidden"){let t=this;window.setTimeout(function(){t._Box.style.visibility="visible"},0)}this.setDisplayPositioning()}}startHide(t){if(!this.mayHide(t))return;t&&(this.activationModel.enabled=!!(this.keyboardData.keyboard.isCJK||this.hostDevice.touchable));let n=null;this._Box&&this.hostDevice.touchable&&!(this.keyboardView instanceof Le)&&this.config.allowHideAnimations?n=this.useHideAnimation():n=Promise.resolve(!0);let s=this;n.then(function(B){B&&s.finalizeHide()}),this.doHide(t)}finalizeHide(){if(!(document.body.className.indexOf("osk-always-visible")>=0&&this.hostDevice.formFactor=="desktop")){if(this._Box){let t=this._Box.style;t.display="none",t.transition="",t.opacity="1",this._Visible=!1}this.vkbd&&this.vkbd.onHide()}}mayShow(){return!(!this.activationModel.conditionsMet||!this.keyboardView||this.keyboardView instanceof Le||!this.activationModel.enabled||!this._Box)}mayHide(t){return!(this.activationModel.conditionsMet&&!this.mayDisable||this.activationModel instanceof He||!t&&this.hostDevice.formFactor=="desktop"&&document.body.className.indexOf("osk-always-visible")>=0)}useHideAnimation(){let t=this._Box.style,n=this;return new Promise(function(s){let B=r(function(){return n._Box.removeEventListener("transitionend",B,!1),n._Box.removeEventListener("webkitTransitionEnd",B,!1),n._Box.removeEventListener("transitioncancel",B,!1),n._Box.removeEventListener("webkitTransitionCancel",B,!1),n._animatedHideTimeout!=0&&window.clearTimeout(n._animatedHideTimeout),n._animatedHideTimeout=0,n._Visible&&n.activationModel.conditionsMet?(t.transition="",t.opacity="1",s(!1),!1):(s(!0),!0)},"cleanup"),c=r(function(){n._Box.removeEventListener("transitionrun",c,!1),n._Box.removeEventListener("webkitTransitionRun",c,!1),n._Box.addEventListener("transitionend",B,!1),n._Box.addEventListener("webkitTransitionEnd",B,!1),n._Box.addEventListener("transitioncancel",B,!1),n._Box.addEventListener("webkitTransitionCancel",B,!1)},"startup");n._Box.addEventListener("transitionrun",c,!1),n._Box.addEventListener("webkitTransitionRun",c,!1),t.transition="opacity 0.5s linear 0",t.opacity="0",n._animatedHideTimeout=window.setTimeout(B,200)})}hideNow(){if(!this.mayHide(!1)||!this._Box)return;this._animatedHideTimeout&&(window.clearTimeout(this._animatedHideTimeout),this._animatedHideTimeout=0);let t=this._Box.style;t.transition="",t.opacity="0",this.finalizeHide()}shutdown(){this.removeBaseMouseEventListeners(),this.removeBaseTouchEventListeners();var t=this._Box;t.parentElement&&t.parentElement.removeChild(t),this.kbdStyleSheetManager.unlinkAll(),this.uiStyleSheetManager.unlinkAll(),this.bannerController.shutdown()}getRect(){var t={};return t.left=t.left=z(this._Box),t.top=t.top=w(this._Box),t.width=this.computedWidth,t.height=this.computedHeight,t}isEnabled(){return this.displayIfActive}isVisible(){return this._Visible}hide(){this.activationModel.enabled=!1,this.startHide(!0)}show(t){arguments.length>0?this.activationModel.enabled=t:this.activationModel.conditionsMet&&(this.activationModel.enabled=!this.activationModel.enabled)}doShow(t){this.legacyEvents.callEvent("show",t)}doHide(t){let n={HiddenByUser:t};this.legacyEvents.callEvent("hide",n)}addEventListener(t,n){this.legacyEvents.addEventListener(t,n)}removeEventListener(t,n){this.legacyEvents.removeEventListener(t,n)}};r(gn,"OSKView"),gn.STYLESHEET_FILES=["kmwosk.css","globe-hint.css"];var bt=gn;var hs=class hs extends V.default{constructor(t){super();this.mouseCancellingHandler=r(function(t){return t.preventDefault(),t.cancelBubble=!0,!1},"mouseCancellingHandler");this._element=this.buildTitleBar(),this.helpEnabled=!1,this.configEnabled=!1,t&&(this.element.onmousedown=t.mouseDownHandler)}get helpEnabled(){return this._helpEnabled}set helpEnabled(t){this._helpEnabled=t,this._helpButton.style.display=t?"inline":"none"}get configEnabled(){return this._configEnabled}set configEnabled(t){this._configEnabled=t,this._configButton.style.display=t?"inline":"none"}get layoutHeight(){return hs.DISPLAY_HEIGHT}get element(){return this._element}setPinCJKOffset(){this._unpinButton.style.left="15px"}showPin(t){this._unpinButton.style.display=t?"block":"none"}setTitle(t){this._caption.innerHTML=t}setTitleFromKeyboard(t){let n="<span style='font-weight:bold'>"+(t==null?void 0:t.name)+"</span>";this._caption.innerHTML=n}buildTitleBar(){let t=A("div");t.id="keymanweb_title_bar",t.className="kmw-title-bar";var n=this._caption=A("span");n.className="kmw-title-bar-caption",n.style.color="#fff",t.appendChild(n);var s=this._closeButton=this.buildCloseButton();return this._closeButton.onclick=()=>(this.emit("close"),!1),t.appendChild(s),s=this._helpButton=this.buildHelpButton(),this._helpButton.onclick=()=>(this.emit("help"),!1),t.appendChild(s),s=this._configButton=this.buildConfigButton(),this._configButton.onclick=()=>(this.emit("config"),!1),t.appendChild(s),s=this._unpinButton=this.buildUnpinButton(),this._unpinButton.onclick=()=>(this.emit("unpin"),!1),t.appendChild(s),t}buildCloseButton(){var t=A("div");return t.id="kmw-close-button",t.className="kmw-title-bar-image",t.onmousedown=this.mouseCancellingHandler,t}buildHelpButton(){let t=A("div");return t.id="kmw-help-image",t.className="kmw-title-bar-image",t.title="KeymanWeb Help",t.onmousedown=this.mouseCancellingHandler,t}buildConfigButton(){let t=A("div");return t.id="kmw-config-image",t.className="kmw-title-bar-image",t.title="KeymanWeb Configuration Options",t.onmousedown=this.mouseCancellingHandler,t}buildUnpinButton(){let t=A("div");return t.id="kmw-pin-image",t.className="kmw-title-bar-image",t.title="Pin the On Screen Keyboard to its default location on the active text box",t.onmousedown=this.mouseCancellingHandler,t}refreshLayout(){}};r(hs,"TitleBar"),hs.DISPLAY_HEIGHT=p.inPixels(20);var un=hs;var ms=class ms extends V.default{constructor(t){super();this.mouseCancellingHandler=r(function(t){return t.preventDefault(),t.cancelBubble=!0,!1},"mouseCancellingHandler");this._element=this.buildResizeBar(),t&&(this._resizeHandle.onmousedown=t.mouseDownHandler)}get layoutHeight(){return ms.DISPLAY_HEIGHT}get element(){return this._element}get handle(){return this._resizeHandle}allowResizing(t){this._resizeHandle.style.display=t?"block":"none"}buildResizeBar(){var t=A("div");t.className="kmw-footer",t.onmousedown=this.mouseCancellingHandler;var n=A("div");n.className="kmw-footer-caption",n.innerHTML='<a href="https://keyman.com/developer/keymanweb/">KeymanWeb</a>',n.id="keymanweb-osk-footer-caption",n.addEventListener("dblclick",B=>(this.emit("showbuild"),!1),!1),t.appendChild(n);var s=A("div");return s.className="kmw-footer-resize",t.appendChild(s),this._resizeHandle=s,t}refreshLayout(){}};r(ms,"ResizeBar"),ms.DISPLAY_HEIGHT=p.inPixels(16);var xs=ms;var yn=class yn{constructor(e,t,n){this.x=e,this.y=t}static fromEvent(e){let t;if(window.TouchEvent&&e instanceof TouchEvent||e.changedTouches?t=e.changedTouches[0]:t=e,t.pageX)return new yn(t.pageX,t.pageY,e);if(t.clientX){let n=t.clientX+document.body.scrollLeft,s=t.clientY+document.body.scrollTop;return new yn(n,s,e)}else return new yn(null,null,e)}};r(yn,"InputEventCoordinate");var AB=yn,gl=class gl{constructor(e){this._VPreviousMouseMove=document.onmousemove,this._VPreviousMouseUp=document.onmouseup,this._VPreviousCursor=document.body.style.cursor,this._VPreviousMouseButton=typeof e.which=="undefined"?e.button:e.which}restore(){document.onmousemove=this._VPreviousMouseMove,document.onmouseup=this._VPreviousMouseUp,document.body.style.cursor&&(document.body.style.cursor=this._VPreviousCursor)}matchesCausingClick(e){return this._VPreviousMouseButton==(typeof e.which=="undefined"?e.button:e.which)}};r(gl,"MouseStartSnapshot");var dl=gl,ul=class ul{constructor(e){this.startHandler=this._VMoveMouseDown.bind(this),this.cursorType=e}get enabled(){return this._enabled}set enabled(e){this._enabled=e}get isActive(){return!!this._mouseStartSnapshot}get mouseDownHandler(){return this.startHandler}_VMoveMouseDown(e){return!e||!this._enabled?!0:(this._mouseStartSnapshot||(this._mouseStartSnapshot=new dl(e)),this._startCoord=AB.fromEvent(e),document.onmousemove=this._VMoveMouseMove.bind(this),document.onmouseup=this._VMoveMouseUp.bind(this),document.body.style.cursor&&(document.body.style.cursor=this.cursorType),e.preventDefault(),e.cancelBubble=!0,this.onDragStart(),!1)}_VMoveMouseMove(e){if(!e||!this.enabled)return!0;if(e.preventDefault(),e.cancelBubble=!0,this._mouseStartSnapshot.matchesCausingClick(e)){let t=AB.fromEvent(e),n=t.x-this._startCoord.x,s=t.y-this._startCoord.y;return this.onDragMove(n,s),!1}else return this._VMoveMouseUp(e)}_VMoveMouseUp(e){return e?(this._mouseStartSnapshot.restore(),this._mouseStartSnapshot=null,e.preventDefault(),e.cancelBubble=!0,this.onDragRelease(),!1):!0}};r(ul,"MouseDragOperation");var In=ul;var yl=class yl extends Dt{constructor(){super(...arguments);this._enabled=!0;this.actValue=null}get activate(){return this._enabled&&!!this.actValue}checkState(t){this.activate!=t&&this.emit("activate",this.activate)}get enabled(){return this._enabled}set enabled(t){let n=this.activate;this._enabled=t,this.checkState(n)}get activationTrigger(){return this.actValue}set activationTrigger(t){let n=this.activate,s=this.actValue;this.actValue=t,this.checkState(n),s!=t&&this.emit("triggerchange",t)}get conditionsMet(){return!!this.activationTrigger}};r(yl,"TwoStateActivator");var Ue=yl;var Il=class Il extends ct{constructor(){super("KeymanWeb_OnScreenKeyboard")}loadWithDefaults(e){return b(b({},e),this.load())}load(){let e=super.load((t,n)=>{switch(n){case"version":return t;default:return Number.parseInt(t,10)}});return e.width||delete e.width,e.height||delete e.height,e}save(e){super.save(e)}};r(Il,"FloatingOSKCookieSerializer");var vB=Il;var bl=class bl extends bt{constructor(t){t.activator=t.activator||new Ue;super(t);this.userPositioned=!1;this.specifiedPosition=!1;this.noDrag=!1;this.layoutSerializer=new vB;this.restorePosition=function(t){let n=this._Visible,s=new J;this.emit("dragmove",s.corePromise),this.loadPersistedLayout(),this.userPositioned=!1,t||(delete this.dfltX,delete this.dfltY),this.savePersistedLayout(),n&&this.present(),this.titleBar.showPin(!1),s.resolve(),this.doResizeMove()}.bind(this);this.typedActivationModel.on("triggerchange",()=>this.setDisplayPositioning()),document.body.appendChild(this._Box),this.titleBar=new un(this.titleDragHandler),this.titleBar.on("help",()=>{this.legacyEvents.callEvent("helpclick",{})}),this.titleBar.on("config",()=>{this.legacyEvents.callEvent("configclick",{})}),this.titleBar.on("close",()=>this.startHide(!0)),this.titleBar.on("unpin",()=>this.restorePosition(!0)),this.resizeBar=new xs(this.resizeDragHandler),this.resizeBar.on("showbuild",()=>this.emit("showbuild")),this.headerView=this.titleBar,this._Box.insertBefore(this.headerView.element,this._Box.firstChild);let n=r(c=>{let i=this.headerView;if(i&&i instanceof un)switch(c){case"configclick":i.configEnabled=this.legacyEvents.listenerCount("configclick")>0;break;case"helpclick":i.helpEnabled=this.legacyEvents.listenerCount("helpclick")>0;break;default:return}},"onListenedEvent"),s=new sn(this),B=new sn(this.legacyEvents);for(let c of[s,B])c.on("listeneradded",n),c.on("listenerremoved",n);this.activeKeyboard&&this.postKeyboardAdjustments(),this.loadPersistedLayout()}get typedActivationModel(){return this.activationModel}_Unload(){this.keyboardView=null,this.bannerView=null,this._Box=null}setBoxStyling(){let t=this._Box.style;t.zIndex="9999",t.display="none",t.width="auto",t.position="absolute"}postKeyboardAdjustments(){this.titleBar&&(this.enableMoveResizeHandlers(),this.activeKeyboard&&this.titleBar.setTitleFromKeyboard(this.activeKeyboard.keyboard),this.vkbd?(this.footerView=this.resizeBar,this._Box.appendChild(this.footerView.element)):(this.footerView&&this._Box.removeChild(this.footerView.element),this.footerView=null),this.loadPersistedLayout(),this.setNeedsLayout())}isEnabled(){return this.displayIfActive}isVisible(){return this._Visible}savePersistedLayout(){var t=this.getPos();let n={visible:this.displayIfActive?1:0,userSet:this.userPositioned?1:0,left:t.left,top:t.top,_version:O.CURRENT.toString()};this.vkbd&&(n.width=this.width.val,n.height=this.height.val),this.layoutSerializer.save(n)}loadPersistedLayout(){let t=this.layoutSerializer.loadWithDefaults({visible:1,userSet:0,left:-1,top:-1,_version:void 0,width:.3*screen.width,height:.15*screen.height});this.activationModel.enabled=t.visible==1,this.userPositioned=t.userSet==1,this.x=t.left,this.y=t.top;let n=t._version,s=n===void 0,B=t.width,c=t.height;B<.2*screen.width&&(B=.2*screen.width),c<.1*screen.height&&(c=.1*screen.height),B>.9*screen.width&&(B=.9*screen.width),c>.5*screen.height&&(c=.5*screen.height),(s||!n)&&(this.headerView&&this.headerView.layoutHeight.absolute&&(c+=this.headerView.layoutHeight.val),this.footerView&&this.footerView.layoutHeight.absolute&&(c+=this.footerView.layoutHeight.val)),this.setSize(B,c),(this.x==-1||this.y==-1||!this._Box)&&(this.userPositioned=!1),this.x<window.pageXOffset-.8*B&&(this.x=window.pageXOffset-.8*B),this.y<0&&(this.x=-1,this.y=-1,this.userPositioned=!1),this.userPositioned&&this._Box&&this.setPos({left:this.x,top:this.y})}getDefaultKeyboardHeight(){if(this.configuration.heightOverride)return this.configuration.heightOverride();var t=Math.floor(Math.min(screen.availHeight,screen.availWidth)/2),n=t;if(this.targetDevice.formFactor=="phone"){var s=Math.min(screen.height,screen.width),B=Math.max(screen.height,screen.width);gt()?n=n*(B/s)/1.6:n=Math.floor(Math.max(screen.availHeight,screen.availWidth)/3)}return this.targetDevice.OS==Z.OperatingSystem.iOS&&(n=n/Vt(this.targetDevice.formFactor)),n}getDefaultWidth(){if(this.configuration.widthOverride)return this.configuration.widthOverride();var t;if(this.targetDevice.OS==Z.OperatingSystem.iOS)t=window.innerWidth;else if(this.targetDevice.OS==Z.OperatingSystem.Android)try{t=document.documentElement.clientWidth}catch(n){t=screen.availWidth}else t=screen.width;return t}doResizeMove(t){this.legacyEvents.callEvent("resizemove",t)}setRect(t){if(!(this._Box==null||this.targetDevice.formFactor!="desktop")){var n=this._Box,s=n.style;if("left"in t&&(this.x=t.left-z(n)+n.offsetLeft,s.left=this.x+"px",this.dfltX=s.left),"top"in t&&(this.y=t.top-w(n)+n.offsetTop,s.top=this.y+"px",this.dfltY=s.top),this.vkbd!=null){var B=this.vkbd.kbdDiv,c=B.style;if("width"in t){var i=t.width-(n.offsetWidth-B.offsetWidth);i<.2*screen.width&&(i=.2*screen.width),i>.9*screen.width&&(i=.9*screen.width),c.width=i+"px",this.setSize(i,this.computedHeight,!0)}if("height"in t){var l=t.height-(n.offsetHeight-B.offsetHeight);l<.1*screen.height&&(l=.1*screen.height),l>.5*screen.height&&(l=.5*screen.height),c.height=l+"px",c.fontSize=l/8+"px",this.setSize(this.computedWidth,l,!0)}"nosize"in t&&(this.resizingEnabled=!t.nosize)}"nomove"in t&&(this.noDrag=t.nomove,this.movementEnabled=!this.noDrag),this.savePersistedLayout()}}getPos(){var t=this._Box,n={left:this._Visible?t.offsetLeft:this.x,top:this._Visible?t.offsetTop:this.y};return n}setPos(t){if(typeof this._Box!="undefined"){if(this.userPositioned){var n=t.left,s=t.top;typeof n!="undefined"&&(n<-.8*this._Box.offsetWidth&&(n=-.8*this._Box.offsetWidth),this.userPositioned&&(this._Box.style.left=n+"px",this.x=n)),typeof s!="undefined"&&(s<0&&(s=0),this.userPositioned&&(this._Box.style.top=s+"px",this.y=s))}this.titleBar.showPin(this.userPositioned)}}setDisplayPositioning(){var t=this._Box.style;if(t.position="absolute",this.activationModel.activate&&(t.display="block"),t.left="0px",this.specifiedPosition||this.userPositioned)t.left=this.x+"px",t.top=this.y+"px";else{let n=this.typedActivationModel.activationTrigger||null;this.dfltX?t.left=this.dfltX:typeof n!="undefined"&&n!=null&&(t.left=z(n)+"px"),this.dfltY?t.top=this.dfltY:typeof n!="undefined"&&n!=null&&(t.top=w(n)+n.offsetHeight+"px")}this.specifiedPosition=!1}presentAtPosition(t,n){this.mayShow()&&(this.specifiedPosition=t>=0||n>=0,this.specifiedPosition&&(this.x=t,this.y=n),this.specifiedPosition=this.specifiedPosition||this.userPositioned,this.present())}present(){this.mayShow()&&(this.titleBar.showPin(this.userPositioned),super.present(),this.doShow({x:this._Box.offsetLeft,y:this._Box.offsetTop,userLocated:this.userPositioned}))}startHide(t){super.startHide(t),t&&this.savePersistedLayout()}show(t){t!==void 0?super.show(t):super.show(),this.savePersistedLayout()}userLocated(){return this.userPositioned}get movementEnabled(){return this.titleDragHandler.enabled}set movementEnabled(t){this.titleDragHandler.enabled=t,this.titleBar.showPin(t&&this.userPositioned)}get resizingEnabled(){return this.resizeDragHandler.enabled}set resizingEnabled(t){this.resizeDragHandler.enabled=t,this.resizeBar.allowResizing(t)}get isBeingMoved(){return this.titleDragHandler.isActive}get isBeingResized(){return this.resizeDragHandler.isActive}enableMoveResizeHandlers(){this.titleDragHandler.enabled=!this.noDrag,this.resizeDragHandler.enabled=!0}get titleDragHandler(){let t=this;return this._moveHandler?this._moveHandler:(this._moveHandler=new class extends In{constructor(){super("move")}onDragStart(){this.startX=t._Box.offsetLeft,this.startY=t._Box.offsetTop,t.activeKeyboard.keyboard.isCJK&&t.titleBar.setPinCJKOffset(),this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new J,t.emit("dragmove",this.dragPromise.corePromise)}onDragMove(s,B){t.titleBar.showPin(!0),t.userPositioned=!0,t._Box.style.left=this.startX+s+"px",t._Box.style.top=this.startY+B+"px";var c=t.getRect();t.setSize(c.width,c.height,!0),t.x=c.left,t.y=c.top}onDragRelease(){t.vkbd&&(t.vkbd.currentKey=null),this.dragPromise.resolve(),this.dragPromise.then(()=>{t.userPositioned=!0,t.doResizeMove(),t.savePersistedLayout()}),this.dragPromise=null}},this._moveHandler)}get resizeDragHandler(){let t=this;return this._resizeHandler?this._resizeHandler:(this._resizeHandler=new class extends In{constructor(){super("se-resize")}onDragStart(){this.startWidth=t.computedWidth,this.startHeight=t.computedHeight,this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new J,t.emit("resizemove",this.dragPromise.corePromise)}onDragMove(s,B){let c=this.startWidth+s,i=this.startHeight+B;c<.2*screen.width&&(c=.2*screen.width),i<.1*screen.height&&(i=.1*screen.height),c>.9*screen.width&&(c=.9*screen.width),i>.5*screen.height&&(i=.5*screen.height),t.setSize(c,i,!0)}onDragRelease(){t.vkbd&&(t.vkbd.currentKey=null),t.vkbd&&(this.startWidth=t.computedWidth,this.startHeight=t.computedHeight),t.refreshLayout(),this.dragPromise.resolve(),this.dragPromise.then(()=>{t.doResizeMove(),t.savePersistedLayout()}),this.dragPromise=null}},this._resizeHandler)}};r(bl,"FloatingOSKView");var Kt=bl;var hl=class hl extends bt{constructor(t){t.isEmbedded?t.activator=t.activator||new He:t.activator=t.activator||new Ue;super(t);this.isResizing=!1;this.restorePosition=function(t){}.bind(this);document.body.appendChild(this._Box)}_Unload(){this.keyboardView=null,this.bannerView=null,this._Box=null}setBoxStyling(){let t=this._Box.style;t.zIndex="9999",t.display="none",t.width="100%",t.position="fixed"}refreshLayout(t){if(!this.isResizing){try{this.isResizing=!0,this.doResize()}finally{this.isResizing=!1}super.refreshLayout(t)}}doResize(){if(this.vkbd){let t=this.getDefaultKeyboardHeight();this.setSize(this.getDefaultWidth(),t+this.banner.height)}}postKeyboardAdjustments(){this.doResize()}getDefaultKeyboardHeight(){var i,l;let t=this.targetDevice;if(this.configuration.heightOverride)return this.configuration.heightOverride();let n=(i=document==null?void 0:document.documentElement)==null?void 0:i.clientWidth,s=(l=document==null?void 0:document.documentElement)==null?void 0:l.clientHeight;if(typeof n=="undefined"&&(n=Math.min(screen.height,screen.width),s=Math.max(screen.height,screen.width),gt())){let a=n;n=s,s=a}var B=Math.floor(Math.min(s,n)/2),c=B;return t.formFactor=="phone"&&(gt()?c=Math.floor(s/1.6):c=Math.floor(s/2.4)),this.targetDevice.OS==Z.OperatingSystem.iOS&&(c=c/Vt(this.targetDevice.formFactor)),c}getDefaultWidth(){var s;let t=this.targetDevice;if(this.configuration.widthOverride)return this.configuration.widthOverride();var n;return n=(s=document==null?void 0:document.documentElement)==null?void 0:s.clientWidth,typeof n=="undefined"&&(this.targetDevice.OS==Z.OperatingSystem.iOS?n=window.innerWidth:t.OS==Z.OperatingSystem.Android?n=screen.availWidth:n=screen.width),n}setRect(t){}getPos(){var t=this._Box,n={left:this._Visible?t.offsetLeft:this.x,top:this._Visible?t.offsetTop:this.y};return n}setPos(t){}setDisplayPositioning(){let t=this._Box.style;this.vkbd&&(t.position="fixed",t.left=t.bottom="0px",t.border="none",t.borderTop="1px solid gray")}present(){super.present(),this.legacyEvents.callEvent("show",{})}};r(hl,"AnchoredOSKView");var bn=hl;var ml=class ml extends Dt{constructor(){super(...arguments);this.flag=!0}get enabled(){return this.flag}set enabled(t){this.activate=t}get activate(){return this.flag}set activate(t){this.flag!=t&&(this.flag=t,this.emit("activate",t))}get conditionsMet(){return!0}};r(ml,"SimpleActivator");var hn=ml;var xl=class xl extends bt{constructor(t){t.activator=t.activator||new hn;super(t);this.restorePosition=function(t){}.bind(this)}get element(){return this._Box}_Unload(){this.keyboardView=null,this.bannerView=null,this._Box=null}setBoxStyling(){let t=this._Box.style;t.display="none",t.position="relative"}postKeyboardAdjustments(){}getDefaultKeyboardHeight(){return this.keyboardView instanceof It?this.keyboardView.height:this.computedHeight}getDefaultWidth(){return this.computedWidth}setRect(t){}getPos(){var t=this._Box,n={left:this._Visible?t.offsetLeft:void 0,top:this._Visible?t.offsetTop:void 0};return n}setPos(t){}present(){super.present(),this.legacyEvents.callEvent("show",{})}setDisplayPositioning(){}allowsDeviceChange(t){return!0}};r(xl,"InlinedOSKView");var mn=xl;var pl={};Vn(pl,{AnchoredOSKView:()=>Cs,FloatingOSKView:()=>Gs,InlinedOSKView:()=>Cl});function Gl(Q){return{hostDevice:Q.config.hostDevice,pathConfig:Q.config.paths,predictionContextManager:Q.contextManager.predictionContext,isEmbedded:!1}}r(Gl,"buildBaseOskConfiguration");var Xl=class Xl extends bn{constructor(e,t){let n=b(b({},Gl(e)),t||{});super(n)}};r(Xl,"PublishedAnchoredOSKView");var Cs=Xl,Sl=class Sl extends Kt{constructor(e,t){let n=b(b({},Gl(e)),t||{});super(n)}};r(Sl,"PublishedFloatingOSKView");var Gs=Sl,Vl=class Vl extends mn{constructor(e,t){let n=b(b({},Gl(e)),t||{});super(n)}};r(Vl,"PublishedInlineOSKView");var Cl=Vl;var Zl=class Zl extends se{constructor(){super(...arguments);this.events=new V.default;this.changed=!1}focus(){let t=this.getElement();t.focus&&t.focus()}isForcingScroll(){return!1}dispatchInputEventOn(t){let n;window.InputEvent&&(n=new InputEvent("input",{bubbles:!0,cancelable:!1})),t&&n&&t.dispatchEvent(n)}};r(Zl,"OutputTarget");var K=Zl;var Ll=class Ll extends K{constructor(t){super();this.root=t,this._cachedSelectionStart=-1}get isSynthetic(){return!1}static isSupportedType(t){return t=="email"||t=="search"||t=="text"||t=="url"}getElement(){return this.root}clearSelection(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)}isSelectionEmpty(){return this.root.selectionStart==this.root.selectionEnd}hasSelection(){return!0}invalidateSelection(){this._cachedSelectionStart=-1}getCaret(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart}getDeadkeyCaret(){return this.getCaret()}setCaret(t){this.setSelection(t,t,"none")}setSelection(t,n,s){let B=this.root.value._kmwCodePointToCodeUnit(t),c=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(B,c,s),this.processedSelectionStart=t,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(B,c,s)}forceScroll(){let t=this.getElement(),n=t.selectionStart,s=t.selectionEnd;this._activeForcedScroll=!0;try{t.blur(),t.focus()}finally{t.selectionStart=n,t.selectionEnd=s,this._activeForcedScroll=!1}}isForcingScroll(){return this._activeForcedScroll}getSelectionDirection(){return this.root.selectionDirection}getTextBeforeCaret(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)}getSelectedText(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)}setTextBeforeCaret(t){this.getCaret();let n=this.processedSelectionEnd-this.processedSelectionStart,s=this.getSelectionDirection(),B=t._kmwLength();this.root.value=t+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(B,B+n,s)}setTextAfterCaret(t){let n=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+t,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,n)}getTextAfterCaret(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)}getText(){return this.root.value}deleteCharsBeforeCaret(t){if(t>0){let n=this.getTextBeforeCaret(),s=this.processedSelectionStart;t>s&&(t=s),this.adjustDeadkeys(-t),this.setTextBeforeCaret(n.kmwSubstring(0,s-t)),this.setCaret(s-t)}}insertTextBeforeCaret(t){if(!t)return;let n=this.getCaret(),s=this.getTextBeforeCaret(),B=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(t._kmwLength()),this.root.value=s+t+B,this.setCaret(n+t._kmwLength())}handleNewlineAtCaret(){let t=this.root;t&&(t.type=="search"||t.type=="submit")?(t.disabled=!1,t.form.submit()):this.events.emit("unhandlednewline",t)}doInputEvent(){this.dispatchInputEventOn(this.root)}};r(Ll,"Input");var Pt=Ll;var El=class El extends K{constructor(t){super();this.root=t,this._cachedSelectionStart=-1}get isSynthetic(){return!1}getElement(){return this.root}clearSelection(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)}isSelectionEmpty(){return this.root.selectionStart==this.root.selectionEnd}hasSelection(){return!0}invalidateSelection(){this._cachedSelectionStart=-1}getCaret(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart}getDeadkeyCaret(){return this.getCaret()}setCaret(t){this.setSelection(t,t,"none")}setSelection(t,n,s){let B=this.root.value._kmwCodePointToCodeUnit(t),c=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(B,c,s),this.processedSelectionStart=t,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(B,c,s)}forceScroll(){let t=this.getElement(),n=t.selectionStart,s=t.selectionEnd;this._activeForcedScroll=!0;try{t.blur(),t.focus()}finally{t.selectionStart=n,t.selectionEnd=s,this._activeForcedScroll=!1}}isForcingScroll(){return this._activeForcedScroll}getSelectionDirection(){return this.root.selectionDirection}getTextBeforeCaret(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)}setTextBeforeCaret(t){this.getCaret();let n=this.processedSelectionEnd-this.processedSelectionStart,s=this.getSelectionDirection(),B=t._kmwLength();this.root.value=t+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(B,B+n,s)}setTextAfterCaret(t){let n=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+t,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,n)}getTextAfterCaret(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)}getSelectedText(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)}getText(){return this.root.value}deleteCharsBeforeCaret(t){if(t>0){let n=this.getTextBeforeCaret(),s=this.processedSelectionStart;t>s&&(t=s),this.adjustDeadkeys(-t),this.setTextBeforeCaret(n.kmwSubstring(0,s-t)),this.setCaret(s-t)}}insertTextBeforeCaret(t){if(!t)return;let n=this.getCaret(),s=this.getTextBeforeCaret(),B=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(t._kmwLength()),this.root.value=s+t+B,this.setCaret(n+t._kmwLength())}handleNewlineAtCaret(){this.insertTextBeforeCaret(`
`)}doInputEvent(){this.dispatchInputEventOn(this.root)}};r(El,"TextArea");var xn=El;var Jl=class Jl{constructor(e,t){this.node=e,this.offset=t}};r(Jl,"SelectionCaret");var ps=Jl,Rl=class Rl{constructor(e,t){this.start=e,this.end=t}};r(Rl,"SelectionRange");var Xs=Rl,Hl=class Hl{constructor(e,t){this.cmd=e,this.stateType=t}};r(Hl,"StyleCommand");var Ut=Hl,Wl=class Wl extends K{constructor(t){super();if(this.root=t,t.contentWindow&&t.contentWindow.document&&t.contentWindow.document.designMode=="on")this.doc=t.contentWindow.document,this.docRoot=t.contentWindow.document.documentElement;else throw"Specified IFrame is not in design-mode!"}get isSynthetic(){return!1}getElement(){return this.root}focus(){this.doc.defaultView.focus()}isSelectionEmpty(){return this.hasSelection()?this.doc.getSelection().isCollapsed:!0}hasSelection(){let t=this.doc.getSelection(),n=document.getSelection();return n.anchorNode==t.anchorNode&&n.focusNode==t.focusNode,!0}clearSelection(){if(this.hasSelection()){let t=this.doc.getSelection();t.isCollapsed||t.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")}invalidateSelection(){}getCarets(){let t=this.doc.getSelection(),n=t.anchorNode.compareDocumentPosition(t.focusNode);if(t.isCollapsed){let s=new ps(t.anchorNode,t.anchorOffset);return new Xs(s,s)}else{let s=new ps(t.anchorNode,t.anchorOffset),B=new ps(t.focusNode,t.focusOffset);return s.node==B.node&&(n=B.offset-s.offset>0?2:4),n&2?new Xs(s,B):new Xs(B,s)}}getDeadkeyCaret(){return this.getTextBeforeCaret().kmwLength()}getTextBeforeCaret(){if(!this.hasSelection())return this.getText();let t=this.getCarets().start;return t.node.nodeType!=3?"":t.node.textContent.substr(0,t.offset)}getSelectedText(){return""}getTextAfterCaret(){if(!this.hasSelection())return"";let t=this.getCarets().end;return t.node.nodeType!=3?"":t.node.textContent.substr(t.offset)}getText(){return this.docRoot.innerText}deleteCharsBeforeCaret(t){if(!this.hasSelection()||t<=0)return;let n=this.getCarets().start;if(t>n.offset&&(t=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}let s=this.doc.createRange(),B=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-t).length;s.setStart(n.node,B),s.setEnd(n.node,n.offset),this.adjustDeadkeys(-t),s.deleteContents()}insertTextBeforeCaret(t){if(!this.hasSelection())return;let n=this.getCarets().start,s=t._kmwLength(),B=this.doc.getSelection();if(s==0)return;this.adjustDeadkeys(s);let c=this.root.ownerDocument.createRange();if(n.node.nodeType==3){let l=n.node;l.insertData(n.offset,t),c.setStart(l,n.offset+t.length)}else{var i=this.doc.createTextNode(t);let l=this.doc.createRange();l.setStart(n.node,n.offset),l.collapse(!0),l.insertNode(i),c.setStart(i,t.length)}c.collapse(!0),B.removeAllRanges();try{B.addRange(c)}catch(l){n.node.parentElement.scrollIntoView(),B.addRange(c)}B.collapseToEnd()}handleNewlineAtCaret(){}setTextAfterCaret(t){if(!this.hasSelection())return;let n=this.getCarets().end;if(t._kmwLength()!=0)if(n.node.nodeType==3){let c=n.node;c.replaceData(n.offset,c.length,t)}else{var B=n.node.ownerDocument.createTextNode(t);let c=this.root.ownerDocument.createRange();c.setStart(n.node,n.offset),c.collapse(!0),c.insertNode(B)}}saveProperties(){var t=[new Ut("backcolor",1),new Ut("fontname",1),new Ut("fontsize",1),new Ut("forecolor",1),new Ut("bold",0),new Ut("italic",0),new Ut("strikethrough",0),new Ut("subscript",0),new Ut("superscript",0),new Ut("underline",0)];this.doc.defaultView&&t.push(new Ut("hilitecolor",1));for(var n=0;n<t.length;n++){let s=t[n];s.stateType==1?s.cache=this.doc.queryCommandValue(s.cmd):s.cache=this.doc.queryCommandState(s.cmd)}this.commandCache=t}restoreProperties(t){this.commandCache||console.error("No command cache exists to restore!");for(var n=0;n<this.commandCache.length;n++){let s=this.commandCache[n];s.stateType==1?this.doc.queryCommandValue(s.cmd)!=s.cache&&(t&&t(),this.doc.execCommand(s.cmd,!1,s.cache)):this.doc.queryCommandState(s.cmd)!=s.cache&&(t&&t(),this.doc.execCommand(s.cmd,!1,null))}}doInputEvent(){this.dispatchInputEventOn(this.root)}};r(Wl,"DesignIFrame");var P=Wl;var Al=class Al{constructor(e,t){this.node=e,this.offset=t}};r(Al,"SelectionCaret");var Ss=Al,vl=class vl{constructor(e,t){this.start=e,this.end=t}};r(vl,"SelectionRange");var Vs=vl,Nl=class Nl extends K{constructor(t){var e=(...args)=>{super(...args)};if(t.isContentEditable)e(),this.root=t;else throw"Specified element is not already content-editable!"}get isSynthetic(){return!1}getElement(){return this.root}isSelectionEmpty(){return this.hasSelection()?this.root.ownerDocument.getSelection().isCollapsed:!0}hasSelection(){let t=this.root.ownerDocument.getSelection();return!(this.root!=t.anchorNode&&!this.root.contains(t.anchorNode)||this.root!=t.focusNode&&!this.root.contains(t.focusNode))}clearSelection(){if(this.hasSelection()){let t=this.root.ownerDocument.getSelection();t.isCollapsed||t.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")}invalidateSelection(){}getCarets(){let t=this.root.ownerDocument.getSelection(),n=t.anchorNode.compareDocumentPosition(t.focusNode);if(t.isCollapsed){let s=new Ss(t.anchorNode,t.anchorOffset);return new Vs(s,s)}else{let s=new Ss(t.anchorNode,t.anchorOffset),B=new Ss(t.focusNode,t.focusOffset);return s.node==B.node&&(n=B.offset-s.offset>0?2:4),n&2?new Vs(s,B):new Vs(B,s)}}getDeadkeyCaret(){return this.getTextBeforeCaret().kmwLength()}getTextBeforeCaret(){if(!this.hasSelection())return this.getText();let t=this.getCarets().start;return t.node.nodeType!=3?"":t.node.textContent.substr(0,t.offset)}getSelectedText(){return""}getTextAfterCaret(){if(!this.hasSelection())return"";let t=this.getCarets().end;return t.node.nodeType!=3?"":t.node.textContent.substr(t.offset)}getText(){return this.root.innerText}deleteCharsBeforeCaret(t){if(!this.hasSelection()||t<=0)return;let n=this.getCarets().start;if(t>n.offset&&(t=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}let s=this.root.ownerDocument.createRange(),B=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-t).length;s.setStart(n.node,B),s.setEnd(n.node,n.offset),this.adjustDeadkeys(-t),s.deleteContents()}insertTextBeforeCaret(t){if(!this.hasSelection())return;let n=this.getCarets().start,s=t._kmwLength(),B=this.root.ownerDocument.getSelection();if(s==0)return;this.adjustDeadkeys(s);let c=this.root.ownerDocument.createRange();if(n.node.nodeType==3){let l=n.node;l.insertData(n.offset,t),c.setStart(l,n.offset+t.length)}else{var i=n.node.ownerDocument.createTextNode(t);let l=this.root.ownerDocument.createRange();l.setStart(n.node,n.offset),l.collapse(!0),l.insertNode(i),c.setStart(i,t.length)}c.collapse(!0),B.removeAllRanges();try{B.addRange(c)}catch(l){n.node.parentElement.scrollIntoView(),B.addRange(c)}B.collapseToEnd()}handleNewlineAtCaret(){}setTextAfterCaret(t){if(!this.hasSelection())return;let n=this.getCarets().end;if(t._kmwLength()!=0)if(n.node.nodeType==3){let c=n.node;c.replaceData(n.offset,c.length,t)}else{var B=n.node.ownerDocument.createTextNode(t);let c=this.root.ownerDocument.createRange();c.setStart(n.node,n.offset),c.collapse(!0),c.insertNode(B)}}doInputEvent(){this.dispatchInputEventOn(this.root)}};r(Nl,"ContentEditable");var We=Nl;function j(Q,e){var t;return Q?Q.Window?e=="Window":(Q.defaultView?t=Q.defaultView[e]:Q.ownerDocument&&(t=Q.ownerDocument.defaultView[e]),t?Q instanceof t:!1):!1}r(j,"nestedInstanceOf");function NB(Q){if(j(Q,"HTMLInputElement"))return new Pt(Q);if(j(Q,"HTMLTextAreaElement"))return new xn(Q);if(j(Q,"HTMLIFrameElement")){let e=Q;return e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.designMode=="on"?new P(e):Q.isContentEditable?new We(Q):null}else if(Q.isContentEditable)return new We(Q);return null}r(NB,"wrapElement");var Tl=class Tl{constructor(){this.pending=!1;let e=this.bg=document.createElement("div"),t=document.createElement("div"),n=this.lt=document.createElement("div"),s=this.gr=document.createElement("div"),B=this.bx=document.createElement("div");e.className="kmw-wait-background",t.className="kmw-wait-box",this.dismiss=null,n.className="kmw-wait-text",s.className="kmw-wait-graphic",B.className="kmw-alert-close";let c=t.onmousedown=t.onclick=l=>{B.style.display=="block"&&(e.style.display="none",this.dismiss&&this.dismiss())};t.addEventListener("touchstart",c,!1);let i=e.onmousedown=e.onclick=l=>{l.preventDefault(),l.stopPropagation()};e.addEventListener("touchstart",i,!1),t.appendChild(B),t.appendChild(n),t.appendChild(s),e.appendChild(t),document.body.appendChild(e)}get rootElement(){return this.bg}wait(e){let t=this.bg;typeof t=="undefined"||t==null||(e?(this.pending=!0,window.setTimeout(()=>{this.pending&&(window.scrollTo(0,0),this.bx.style.display="none",this.lt.className="kmw-wait-text",this.lt.innerHTML=e,this.gr.style.display="block",t.style.display="block")},1e3)):this.pending&&(this.lt.innerHTML="",this.pending=!1,t.style.display="none"))}alert(e,t){let n=this.bg;this.bx.style.display="block",this.lt.className="kmw-alert-text",this.lt.innerHTML=e,this.gr.style.display="none",n.style.display="block",this.dismiss=arguments.length>1?t:null}shutdown(){this.bg.parentNode.removeChild(this.bg)}};r(Tl,"AlertHost");var de=Tl;function Zs(){return document.readyState==="complete"?Promise.resolve():new Promise((Q,e)=>{let t=r(()=>{window.removeEventListener("load",t),Q()},"loadHandler");window.addEventListener("load",t)})}r(Zs,"whenDocumentReady");var fl=class fl extends vn{initialize(t){this._options?this._options=b(b({},this._options),t):this._options=b({},t),super.initialize(t),this._options=t,this._ui=t.ui,this._attachType=t.attachType,Zs().then(()=>{var n;t.useAlerts&&!this.alertHost?this._alertHost=new de:!t.useAlerts&&this.alertHost&&((n=this._alertHost)==null||n.shutdown(),this._alertHost=null)})}get options(){return this._options}get attachType(){return this._attachType}get alertHost(){return this._alertHost}set signalUser(t){(!t||t!=this.alertHost)&&this.alertHost.shutdown(),this._alertHost=t}debugReport(){let t=super.debugReport();return t.attachType=this.attachType,t.ui=this._ui,t.keymanEngine="app/browser",t}onRuleFinalization(t,n){let s=t.transcription.transform;Ge(s)||n instanceof K&&(n.changed=!0)}};r(fl,"BrowserConfiguration");var TB=fl,$r=b({ui:"",attachType:"",useAlerts:!0},Xc);var kl=class kl{constructor(e,t,n){this.interface=e,this.keyboard=t}};r(kl,"AttachmentInfo");var Ls=kl;function jt(Q){let e=Q==null?void 0:Q.target;return Zt(e)}r(jt,"eventOutputTarget");function Zt(Q){var e;if(Q==null)return null;if(Q.body&&(Q=Q.body),Q.nodeType==3&&(Q=Q.parentNode),j(Q,"HTMLInputElement")){let t=Q.type.toLowerCase();if(!(t=="text"||t=="search"))return null}return(e=Q._kmwAttachment)==null?void 0:e.interface}r(Zt,"outputTargetForElement");var fB=class fB extends V.default{constructor(t,n){if(!t)throw new Error("Cannot attach to a null/undefined document");super();this.baseFont="";this.appliedFont="";this.embeddedPageContexts=[];this._inputList=[];this._sortedInputs=[];this._InputModeObserverCore=r(t=>{this.disableInputModeObserver();try{for(let n of t){let s=n.target;this.isAttached(s)&&(s._kmwAttachment.inputMode=s.inputMode,this.device.touchable&&(s.inputMode="none"))}}finally{this.enableInputModeObserver()}},"_InputModeObserverCore");this._EnablementMutationObserverCore=r(t=>{for(var n=0;n<t.length;n++){var s=t[n],B=s.oldValue?s.oldValue.indexOf("kmw-disabled")>=0:!1,c=s.target.className.indexOf("kmw-disabled")>=0;if(B&&!c?this._EnableControl(s.target):!B&&c&&this._DisableControl(s.target),!c&&s.attributeName=="readonly"){var i=s.oldValue?s.oldValue!=null:!1,l=s.target;if(l instanceof l.ownerDocument.defaultView.HTMLInputElement||l instanceof l.ownerDocument.defaultView.HTMLTextAreaElement){var a=l.readOnly;i&&!a?this._EnableControl(s.target):!i&&a&&this._DisableControl(s.target)}}}},"_EnablementMutationObserverCore");this._AutoAttachObserverCore=r(t=>{for(var n=[],s=[],B=0;B<t.length;B++){let l=t[B];for(var c=0;c<l.addedNodes.length;c++)n=n.concat(this._GetDocumentEditables(l.addedNodes[c]));for(c=0;c<l.removedNodes.length;c++)s=s.concat(this._GetDocumentEditables(l.removedNodes[c]))}for(var i=0;i<n.length;i++)this.isKMWInput(n[i])&&this._MutationAdditionObserved(n[i]);for(i=0;i<s.length;i++){let l=!1,a=s[i];if(a instanceof a.ownerDocument.defaultView.HTMLIFrameElement){for(let F=0;F<this.embeddedPageContexts.length;F++)if(this.embeddedPageContexts[F].options.owner==a){this.embeddedPageContexts[F].shutdown(),this.embeddedPageContexts.splice(F,1),l=!0;break}if(!l){for(let F=0;F<this._inputList.length;F++)if(this._inputList[F]==a){this.detachFromControl(a),this._inputList[F]==a&&this._inputList.splice(F,1);break}}}else this.isKMWInput(a)&&this._MutationRemovalObserved(a)}(n.length||s.length)&&(this.device.touchable?this.device.touchable&&window.setTimeout(()=>{this.listInputs()},1):this.listInputs())},"_AutoAttachObserverCore");this._MutationAdditionObserved=r(t=>{if(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement){let n=r(()=>{window.setTimeout(()=>{this.attachToControl(t)},1)},"attachFunctor");t.addEventListener("load",n)}else this.attachToControl(t)},"_MutationAdditionObserved");this._MutationRemovalObserved=r(t=>{this.detachFromControl(t)},"_MutationRemovalObserved");this.options=n,this.document=t,this.stylesheetManager=new at(this.document.body)}get device(){return this.options.hostDevice}get window(){return this.document.defaultView}get inputList(){let t=this.embeddedPageContexts.map(n=>n.inputList).reduce((n,s)=>n.concat(s),[]);return[].concat(this._inputList).concat(t)}get sortedInputs(){return this._sortedInputs}install(t){this.manualAttach=t,this.baseFont=this.getBaseFont(),this.manualAttach||(this._SetupDocument(this.document.documentElement),this.listInputs()),this.options.owner||this.initMutationObservers(this.document,t)}setupElementAttachment(t){if(!t._kmwAttachment){let n=NB(t);n||j(t,"HTMLIFrameElement")||console.warn("Could not create processing interface for newly-attached element!"),t._kmwAttachment=new Ls(n,null,this.device.touchable)}}clearElementAttachment(t){t._kmwAttachment=null}isKMWInput(t){if(t instanceof t.ownerDocument.defaultView.HTMLTextAreaElement)return!0;if(t instanceof t.ownerDocument.defaultView.HTMLInputElement){if(Pt.isSupportedType(t.type))return!0}else if(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)try{if(t.contentWindow){let n=t.contentWindow.document;if(n)return!(this.device.touchable&&n.designMode.toLowerCase()=="on")}else return!!t._kmwAttachment}catch(n){console.warn("Error during attachment to / detachment from iframe: "),console.warn(n)}else if(t.isContentEditable)return!0;return!1}isAttached(t){if(t._kmwAttachment)return!0;if(j(t,"HTMLIFrameElement")){if(t.contentDocument==this.document)return!0;for(let s of this.embeddedPageContexts)if(s.isAttached(t))return!0}return!1}isKMWDisabled(t){let n=t.className;return t.readOnly?!0:!!(n&&n.indexOf("kmw-disabled")>=0)}enableInputElement(t){var n;this.isKMWDisabled(t)||(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement?this._AttachToIframe(t):(this.setupElementAttachment(t),t._kmwAttachment.inputMode=(n=t.inputMode)!=null?n:"text",this.disableInputModeObserver(),t.inputMode="none",this.enableInputModeObserver(),t.classList.add("keymanweb-font"),this._inputList.push(t),this.emit("enabled",t)))}disableInputElement(t){var s;if(t)if(t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLIFrameElement||t instanceof HTMLIFrameElement)this._DetachFromIframe(t);else{if(this.isAttached(t)){let c=(s=t._kmwAttachment)==null?void 0:s.inputMode;this.disableInputModeObserver(),t.inputMode=c,this.enableInputModeObserver()}t.className.indexOf("keymanweb-font")>=0&&(t.className=t.className.replace("keymanweb-font","").trim());var n=this.inputList.indexOf(t);n>-1&&this._inputList.splice(n,1),this.emit("disabled",t)}}enableTouchElement(t){return this.isKMWDisabled(t)?(this.emit("disabled",t),!1):(this.isAttached(t)||this.setupElementAttachment(t),this.enableInputElement(t),!0)}disableTouchElement(t){if(this.isAttached(t)){let n=t._kmwAttachment.inputMode;this.disableInputModeObserver(),t.inputMode=n,this.enableInputModeObserver()}}_AttachToIframe(t){try{let n=t.contentWindow.document;if(n){if(n.designMode.toLowerCase()=="on")this.setupElementAttachment(t),n.body._kmwAttachment=t._kmwAttachment,this._inputList.push(t),this.emit("enabled",t);else if(this.embeddedPageContexts.filter(s=>s.document==n).length==0){let s=new fB(n,L(b({},this.options),{owner:t}));this.embeddedPageContexts.push(s),s.on("enabled",B=>this.emit("enabled",B)),s.on("disabled",B=>this.emit("disabled",B)),s.install(this.manualAttach)}}}catch(n){}}_DetachFromIframe(t){let n=r(()=>{this.clearElementAttachment(t);let s=this._inputList.indexOf(t);s!=-1&&this._inputList.splice(s,1),this.emit("disabled",t)},"detachFromDesignIframe");try{let s=t.contentWindow.document;if(s){if(s.designMode.toLowerCase()=="on")s.body._kmwAttachment=null,n();else for(let B=0;B<this.embeddedPageContexts.length;B++)if(this.embeddedPageContexts[B].document==s){let c=this.embeddedPageContexts.splice(B,1)[0];c._ClearDocument(s.body),c.shutdown(),this.embeddedPageContexts.splice(B,1);break}}}catch(s){t._kmwAttachment&&n()}}attachToControl(t){var n=this.device.touchable;this.isAttached(t)&&!(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(t)?this.isKMWDisabled(t)?this.emit("disabled",t):n?this.enableTouchElement(t):this.enableInputElement(t):n&&this.emit("disabled",t))}detachFromControl(t){(this.isAttached(t)||t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)&&(this.isKMWInput(t)&&(this.isKMWDisabled(t)||this._DisableControl(t)),this.clearElementAttachment(t))}_DisableControl(t){(this.isAttached(t)||t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)&&(this.device.touchable&&this.disableTouchElement(t),this.listInputs(),this.disableInputElement(t))}_EnableControl(t){this.isAttached(t)?(this.device.touchable?this.enableTouchElement(t):this.enableInputElement(t),this.listInputs()):j(t,"HTMLIFrameElement")&&this._AttachToIframe(t)}disableControl(t){this.isAttached(t)||console.warn("KeymanWeb is not attached to element "+t);var n=t.className;n.indexOf("kmw-disabled")<0&&(t.className=n?n+" kmw-disabled":"kmw-disabled")}enableControl(t){!this.isAttached(t)&&!j(t,"HTMLIFrameElement")&&console.warn("KeymanWeb is not attached to element "+t);var n=t.className,s=n.indexOf("kmw-disabled");s>=0&&(t.className=n.replace("kmw-disabled","").trim())}listInputs(){let t=[],n=document.getElementsByTagName("input"),s=document.getElementsByTagName("textarea");for(let c=0;c<n.length;c++)Pt.isSupportedType(n[c].type)&&n[c].className.indexOf("kmw-disabled")<0&&t.push({ip:n[c],x:z(n[c]),y:w(n[c])});for(let c=0;c<s.length;c++)s[c].className.indexOf("kmw-disabled")<0&&t.push({ip:s[c],x:z(s[c]),y:w(s[c])});t.sort((c,i)=>c.y!=i.y?c.y-i.y:c.x-i.x);let B=[];for(let c=0;c<t.length;c++)B.push(t[c].ip);this._sortedInputs=B}findNeighboringInput(t,n){var s,B=this.sortedInputs;if(B.length==0)return null;for(s=0;s<B.length&&B[s]!=t;s++);return s==B.length&&!n&&s--,s=n?s-1:s+1,s=s>=B.length?s-B.length:s,s=s<0?s+B.length:s,B[s]}_GetDocumentEditables(t){let n=[];if(t.ownerDocument&&t instanceof t.ownerDocument.defaultView.HTMLElement){let B=t.ownerDocument.defaultView;(t instanceof B.HTMLInputElement||t instanceof B.HTMLTextAreaElement||t instanceof B.HTMLIFrameElement)&&n.push(t)}if(t.getElementsByTagName){var s=r(function(B){return tB(t.getElementsByTagName(B))},"LiTmp");n=n.concat(s("INPUT"),s("TEXTAREA"),s("IFRAME"))}return t.querySelectorAll&&(n=n.concat(tB(t.querySelectorAll("[contenteditable]")))),t.ownerDocument&&t instanceof t.ownerDocument.defaultView.HTMLElement&&t.isContentEditable&&n.push(t),n}_SetupDocument(t){let n=this._GetDocumentEditables(t);for(var s=0;s<n.length;s++)this.attachToControl(n[s])}_ClearDocument(t){let n=this._GetDocumentEditables(t);for(var s=0;s<n.length;s++)this.detachFromControl(n[s])}initMutationObservers(t,n){if(typeof MutationObserver=="function"){var s=t.querySelector("body"),B;n||(B={childList:!0,subtree:!0},this.attachmentObserver=new MutationObserver(this._AutoAttachObserverCore),this.attachmentObserver.observe(s,B)),B={subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["class","readonly"]},this.enablementObserver=new MutationObserver(this._EnablementMutationObserverCore),this.enablementObserver.observe(s,B),this.inputModeObserver=new MutationObserver(this._InputModeObserverCore),this.enableInputModeObserver()}else console.warn("Your browser is outdated and does not support MutationObservers, a web feature needed by KeymanWeb to support dynamically-added elements.")}enableInputModeObserver(){var s;let t=document.querySelector("body"),n={subtree:!0,attributes:!0,attributeFilter:["inputmode"]};(s=this.inputModeObserver)==null||s.observe(t,n)}disableInputModeObserver(){var t;(t=this.inputModeObserver)==null||t.disconnect()}getBaseFont(){var t=document.getElementsByTagName("input"),n=document.getElementsByTagName("textarea"),s=0,B,c="Arial,sans-serif";if(t.length==0&&n.length==0)s=0;else if(t.length>0&&n.length==0)s=1;else if(t.length==0&&n.length>0)s=2;else{var i=t[0],l=n[0];i.offsetTop<l.offsetTop?s=1:i.offsetTop>l.offsetTop?s=2:i.offsetLeft<l.offsetLeft?s=1:i.offsetLeft>l.offsetLeft&&(s=2)}switch(s){case 0:B=c;break;case 1:B=getComputedStyle(t[0]).fontFamily||"";break;case 2:B=getComputedStyle(n[0]).fontFamily||"";break}return(typeof B=="undefined"||B=="monospace")&&(B=c),B}buildAttachmentFontStyle(t){let n=t,s=this.baseFont;n&&typeof n.family!="undefined"&&(s=n.family),s=s.replace(/\u0022/g,"");var B=new RegExp("\\s?"+s+",?"),c=this.appliedFont.replace(/\u0022/g,"");c=c.replace(B,""),c=c.replace(/,$/,""),c==""?c=s:c=s+","+c,c='"'+c.replace(/\,\s?/g,'","')+'"';let i=`.keymanweb-font{
font-family:`+c+` !important;
}
`;return this.appliedFont=c,i}setAttachmentFont(t,n,s){this.stylesheetManager.unlinkAll(),this.stylesheetManager.addStyleSheetForFont(t,n,s),this.stylesheetManager.linkStylesheet(Be(this.buildAttachmentFontStyle(t)))}shutdown(){var t,n,s,B;try{(t=this.enablementObserver)==null||t.disconnect(),(n=this.attachmentObserver)==null||n.disconnect(),(s=this.inputModeObserver)==null||s.disconnect(),(B=this.stylesheetManager)==null||B.unlinkAll(),this.inputModeObserver=null,this.embeddedPageContexts.forEach(c=>{try{c.shutdown()}catch(i){}});for(let c of this.inputList)try{this.detachFromControl(c)}catch(i){this.emit("disabled",c)}this._inputList=[]}catch(c){console.error("Error occurred during shutdown"),console.error(c)}}};r(fB,"PageContextAttachment");var Es=fB;var Ml=class Ml{constructor(e,t){this.activationPending=e,this.activated=t}};r(Ml,"FocusStateAPIObject");var Yl=Ml,Ol=class Ol extends V.default{constructor(t){super();this._maintainingFocus=!1;this.restoringFocus=!1;this._IgnoreNextSelChange=0;this.isTargetForcingScroll=t}get maintainingFocus(){return this._maintainingFocus}set maintainingFocus(t){let n=this._maintainingFocus;this._maintainingFocus=t,n&&!t&&this.emit("maintainingfocusend")}getUIState(){return new Yl(this.maintainingFocus,this.restoringFocus)}setMaintainingFocus(t){this.maintainingFocus=!!t}setFocusTimer(){this.focusing=!0,this.focusTimer=window.setTimeout(()=>{this.focusing=!1},50)}};r(Ol,"FocusAssistant");var kB=Ol;function tQ(Q,e){let t=e!=null&&e.isRTL?"rtl":"ltr";Q&&(Q instanceof Q.ownerDocument.defaultView.HTMLInputElement||Q instanceof Q.ownerDocument.defaultView.HTMLTextAreaElement?Q.value.length==0&&(Q.dir=t):typeof Q.textContent=="string"&&Q.textContent.length==0&&(Q.dir=t))}r(tQ,"_SetTargDir");var YB=class YB extends Tn{constructor(t,n){super(t);this.cookieManager=new ct("KeymanWeb_Keyboard");this.focusAssistant=new kB(()=>{var t;return(t=this.activeTarget)==null?void 0:t.isForcingScroll()});this.domEventTracker=new pt;this._ControlFocus=r(t=>{let n=jt(t);return n&&this.setActiveTarget(n,!0),!0},"_ControlFocus");this._ControlBlur=r(t=>{if(this.focusAssistant._IgnoreNextSelChange)return this.focusAssistant._IgnoreNextSelChange--,t.cancelBubble=!0,t.stopPropagation(),!0;if(this.focusAssistant.isTargetForcingScroll())return t.cancelBubble=!0,t.stopPropagation(),!0;let n=jt(t);if(n==null)return!0;this.lastActiveTarget&&this._BlurKeyboardSettings(this.lastActiveTarget.getElement());let s=this.activeTarget;this.currentTarget=null,(s||this.lastActiveTarget)&&(this.mostRecentTarget=n),this.focusAssistant.restoringFocus=!1;let B=this.activeKeyboard,c=this.focusAssistant.maintainingFocus;return!c&&B&&B.keyboard.notify(0,n,0),s&&!this.activeTarget&&this.emit("targetchange",null),this.apiEvents.callEvent("controlblurred",{target:n.getElement(),event:t,isActivating:c}),this.doChangeEvent(n),this.resetContext(),!0},"_ControlBlur");this._Click=r(t=>(this.resetContext(),!0),"_Click");this.nonKMWTouchHandler=r(t=>{this.focusAssistant.focusing=!1,clearTimeout(this.focusAssistant.focusTimer),this.forgetActiveTarget()},"nonKMWTouchHandler");this._eventsObj=n,this.page=new Es(window.document,{hostDevice:this.engineConfig.hostDevice}),this.focusAssistant.on("maintainingfocusend",()=>{!this.activeTarget&&this.mostRecentTarget&&this.emit("targetchange",this.activeTarget)})}get apiEvents(){return this._eventsObj()}initialize(){this.on("keyboardasyncload",(t,n)=>{var s;(s=this.engineConfig.alertHost)==null||s.wait("Installing keyboard<br/>"+t.name),n.then(()=>{var B;(B=this.engineConfig.alertHost)==null||B.wait()})}),this.engineConfig.deferForInitialization.then(()=>{let t=this.engineConfig.hostDevice,n=r(s=>s.stopPropagation(),"noPropagation");this.page.on("enabled",s=>{if(!(s._kmwAttachment.interface instanceof P))t.touchable&&(this.domEventTracker.detachDOMEvent(s,"touchstart",this.nonKMWTouchHandler),this.domEventTracker.attachDOMEvent(s,"touchmove",n,!1),this.domEventTracker.attachDOMEvent(s,"touchend",n,!1)),this.domEventTracker.attachDOMEvent(s,"focus",this._ControlFocus),this.domEventTracker.attachDOMEvent(s,"blur",this._ControlBlur),this.domEventTracker.attachDOMEvent(s,"click",this._Click);else{var B=s.contentWindow.document;t.browser=="firefox"?(this.domEventTracker.attachDOMEvent(B,"focus",this._ControlFocus),this.domEventTracker.attachDOMEvent(B,"blur",this._ControlBlur)):(this.domEventTracker.attachDOMEvent(B.body,"focus",this._ControlFocus),this.domEventTracker.attachDOMEvent(B.body,"blur",this._ControlBlur))}s.ownerDocument.activeElement==s&&this.setActiveTarget(Zt(s),!0)}),this.page.on("disabled",s=>{var c;if(!j(s,"HTMLIFrameElement"))t.touchable&&this.domEventTracker.attachDOMEvent(s,"touchstart",this.nonKMWTouchHandler,!1),this.domEventTracker.detachDOMEvent(s,"focus",this._ControlFocus),this.domEventTracker.detachDOMEvent(s,"blur",this._ControlBlur),this.domEventTracker.detachDOMEvent(s,"click",this._Click);else{let i=s.contentWindow.document;t.browser=="firefox"?(this.domEventTracker.detachDOMEvent(i,"focus",this._ControlFocus),this.domEventTracker.detachDOMEvent(i,"blur",this._ControlBlur)):(this.domEventTracker.detachDOMEvent(i.body,"focus",this._ControlFocus),this.domEventTracker.detachDOMEvent(i.body,"blur",this._ControlBlur))}var B=(c=this.mostRecentTarget)==null?void 0:c.getElement();B&&B==s&&this.forgetActiveTarget()}),this.page.install(this.engineConfig.attachType=="manual")})}get activeTarget(){let t=this.focusAssistant.maintainingFocus;return this.currentTarget||(t?this.mostRecentTarget:null)}get lastActiveTarget(){return this.mostRecentTarget}deactivateCurrentTarget(){let t=this.activeTarget||this.lastActiveTarget;t&&this.page.isAttached(t.getElement())&&this._BlurKeyboardSettings(t.getElement()),this.activeTarget||this.setActiveTarget(null,!0)}forgetActiveTarget(){this.focusAssistant.maintainingFocus=!1,this.focusAssistant.restoringFocus=!1;let t=this.activeTarget||this.mostRecentTarget;t&&this._BlurKeyboardSettings(t.getElement()),this.setActiveTarget(null,!0),t==this.lastActiveTarget&&(this.mostRecentTarget=null)}setActiveTarget(t,n){var l;let s=this.mostRecentTarget,B=this.activeTarget;if(t==B){B&&(this.currentTarget=B);return}let c=!!s;if(this.currentTarget=this.mostRecentTarget=t,this.predictionContext.setCurrentTarget(t),this.focusAssistant.restoringFocus?this._BlurKeyboardSettings(t.getElement()):t&&this._FocusKeyboardSettings(t.getElement(),!c),this._CommonFocusHelper(t))return;let i=t==null?void 0:t.getElement();if(t instanceof P&&(i=t.docRoot),i&&i.ownerDocument&&i instanceof i.ownerDocument.defaultView.HTMLElement&&tQ(i,(l=this.activeKeyboard)==null?void 0:l.keyboard),t!=B&&this.emit("targetchange",t),n){let a=s==null?void 0:s.getElement();s instanceof P&&(a=s.docRoot),i?this.apiEvents.callEvent("controlfocused",{target:i,activeControl:a}):a&&this.apiEvents.callEvent("controlblurred",{target:a,event:null,isActivating:this.focusAssistant.maintainingFocus})}}get activeKeyboard(){return this._activeKeyboard}restoreLastActiveTarget(){this.mostRecentTarget&&(this.focusAssistant.restoringFocus=!0,this.mostRecentTarget.focus(),this.focusAssistant.restoringFocus=!1)}insertText(t,n,s){this.restoreLastActiveTarget();let B=this.activeTarget;return B==null&&this.mostRecentTarget&&(B=this.activeTarget),B!=null?super.insertText(t,n,s):!1}currentKeyboardSrcTarget(){let t=this.currentTarget||this.mostRecentTarget;return this.isTargetKeyboardIndependent(t)?t:null}isTargetKeyboardIndependent(t){let n=t==null?void 0:t.getElement()._kmwAttachment;return!!(n!=null&&n.keyboard||(n==null?void 0:n.keyboard)==="")}activateKeyboardForTarget(t,n){var B,c;let s=n==null?void 0:n.getElement()._kmwAttachment;if(s?(s.keyboard=(B=t==null?void 0:t.metadata.id)!=null?B:"",s.languageCode=(c=t==null?void 0:t.metadata.langId)!=null?c:""):this.globalKeyboard=t,this.currentKeyboardSrcTarget()==n){this._activeKeyboard=t;let i=t==null?void 0:t.metadata;this.page.setAttachmentFont(i==null?void 0:i.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS)}}setKeyboardForTarget(t,n,s){if(t instanceof P){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}let B=t.getElement()._kmwAttachment,c=this.currentKeyboardSrcTarget()==t;if(B){if(B.keyboard=n||null,B.languageCode=s||null,c||this.currentKeyboardSrcTarget()==t){let i=this.globalKeyboard.metadata;this.activateKeyboard(B.keyboard||i.id,B.languageCode||i.langId,!0)}}else return}getKeyboardStubForTarget(t){if(this.isTargetKeyboardIndependent(t)){let n=t.getElement()._kmwAttachment;return this.keyboardCache.getStub(n.keyboard,n.languageCode)}else return this.globalKeyboard.metadata}getFallbackStubKey(){let t={id:"",langId:""};return this.engineConfig.hostDevice.touchable&&this.keyboardCache.defaultStub||t}activateKeyboard(t,n,s){return E(this,null,function*(){var c,i,l,a,F,o;s||(s=!1);let B=this.currentKeyboardSrcTarget();this.engineConfig.deferForInitialization.isFulfilled||(yield this.engineConfig.deferForInitialization.corePromise),t||(t=this.getFallbackStubKey().id,n=this.getFallbackStubKey().langId);try{let d=yield vs(YB.prototype,this,"activateKeyboard").call(this,t,n,s);return(c=this.engineConfig.alertHost)==null||c.wait(),s&&!B&&this.cookieManager.save({current:`${t}:${n}`}),B==this.currentKeyboardSrcTarget()&&(tQ((i=this.currentTarget)==null?void 0:i.getElement(),this.keyboardCache.getKeyboard(t)),this.page.setAttachmentFont((a=(l=this.activeKeyboard)==null?void 0:l.metadata)==null?void 0:a.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS),this.restoreLastActiveTarget()),d}catch(d){let U=r(()=>E(this,null,function*(){let g=this.getFallbackStubKey();g.id!=t&&(yield this.activateKeyboard(g.id,g.langId,!0).catch(()=>{}))}),"fallback");(F=this.engineConfig.alertHost)==null||F.wait();let u=(d==null?void 0:d.message)||"Sorry, the "+t+" keyboard for "+n+" is not currently available.";throw d instanceof he?console.error(d||u):console.warn(d||u),this.engineConfig.alertHost?(o=this.engineConfig.alertHost)==null||o.alert(u,U):yield U(),d}})}_BlurKeyboardSettings(t,n,s){var i;var B=this.activeKeyboard?this.activeKeyboard.keyboard.id:"",c=(i=this.activeKeyboard)==null?void 0:i.metadata.langId;n!==void 0&&s!==void 0&&(B=n,c=s),t&&t._kmwAttachment.keyboard!=null?(t._kmwAttachment.keyboard=B,t._kmwAttachment.languageCode=c):this.globalKeyboard=this.activeKeyboard}_FocusKeyboardSettings(t,n){var c;let s=t._kmwAttachment,B=this.globalKeyboard;s.keyboard!=null?this.activateKeyboard(s.keyboard,s.languageCode,!0):!n&&(B==null?void 0:B.metadata)!=((c=this._activeKeyboard)==null?void 0:c.metadata)&&this.activateKeyboard(B==null?void 0:B.metadata.id,B==null?void 0:B.metadata.langId,!0)}_CommonFocusHelper(t){var B;let n=this.focusAssistant,s=(B=this.activeKeyboard)==null?void 0:B.keyboard;return n.restoringFocus||(t==null||t.deadkeys().clear(),s==null||s.notify(0,t,1)),!n.restoringFocus&&this.mostRecentTarget!=t&&(n.maintainingFocus=!1),n.restoringFocus=!1,this.resetContext(),!1}doChangeEvent(t){if(t.changed){let n=new Event("change",{bubbles:!0,cancelable:!1});t.getElement().dispatchEvent(n)}t.changed=!1}getSavedKeyboardRaw(){var n=new ct("KeymanWeb_Keyboard").load(decodeURIComponent);return typeof n.current!="string"||n.current=="Keyboard_us:eng"?"Keyboard_us:en":n.current}getSavedKeyboard(){let t=this.getSavedKeyboardRaw(),n=this.keyboardCache.getStubList(),s;for(let B=0;B<n.length;B++)if(s=n[B].KI+":"+n[B].KLC,s==t)return s;for(let B=0;B<n.length;B++)if(s=n[B].KI+":"+n[B].KLC,s=="Keyboard_us:en")return s;return n.length>0?n[0].KI+":"+n[0].KLC:"Keyboard_us:en"}restoreSavedKeyboard(t){let s=t.split(":");s.length<2&&(s[1]=""),(this.keyboardCache.getStub(s[0],s[1])||this.keyboardCache.defaultStub)&&this.activateKeyboard(s[0],s[1])}shutdown(){this.page.shutdown(),this.domEventTracker.shutdown()}};r(YB,"ContextManager");var Js=YB;var zl=class zl extends Lt{constructor(t){super();this.contextManager=t}isCommand(t){switch(this.codeForEvent(t)){case m.keyCodes.K_TAB:case m.keyCodes.K_TABBACK:case m.keyCodes.K_TABFWD:return!0;default:return super.isCommand(t)}}applyCommand(t,n){let s=this.codeForEvent(t),B=r(c=>{var F;let i=this.contextManager,l=(F=i.activeTarget)==null?void 0:F.getElement(),a=i.page.findNeighboringInput(l,c);a==null||a.focus()},"moveToNext");switch(s){case m.keyCodes.K_TAB:B((t.Lmodifiers&I.K_SHIFTFLAG)!=0);break;case m.keyCodes.K_TABBACK:B(!0);break;case m.keyCodes.K_TABFWD:B(!1);break}super.applyCommand(t,n)}};r(zl,"DefaultBrowserRules");var Rs=zl;function wl(Q){return Q.keyCode?Q.keyCode:Q.which?Q.which:null}r(wl,"_GetEventKeyCode");function MB(Q,e,t){if(Q.cancelBubble===!0)return null;let n=wl(Q);if(n==null)return null;var s=e.modStateFlags,B=0,c=!1,i=!1;let l=m.keyCodes;switch(n){case l.K_CTRL:case l.K_LCTRL:case l.K_RCTRL:case l.K_CONTROL:case l.K_LCONTROL:case l.K_RCONTROL:c=!0;break;case l.K_LMENU:case l.K_RMENU:case l.K_ALT:case l.K_LALT:case l.K_RALT:i=!0;break}B|=Q.getModifierState("Shift")?16:0,Q.getModifierState("Control")&&(B|=Q.location!=0&&c?Q.location==1?I.LCTRLFLAG:I.RCTRLFLAG:s&3),Q.getModifierState("Alt")&&(B|=Q.location!=0&&i?Q.location==1?I.LALTFLAG:I.RALTFLAG:s&12);let a=0;a|=Q.getModifierState("CapsLock")?I.CAPITALFLAG:I.NOTCAPITALFLAG,a|=Q.getModifierState("NumLock")?I.NUMLOCKFLAG:I.NOTNUMLOCKFLAG,a|=Q.getModifierState("ScrollLock")?I.SCROLLFLAG:I.NOTSCROLLFLAG,B|=a;let F=e.modStateFlags!=B;e.modStateFlags=B;let o=I.RALTFLAG|I.LCTRLFLAG;(s&o)==o&&(B&o)!=o&&(B&=~o),B&I.RALTFLAG&&(B&=~I.LCTRLFLAG);let d=m.modifierBitmasks,U=e.activeKeyboard,u;U&&U.isChiral?(u=B&d.CHIRAL,U.emulatesAltGr&&(u&d.ALT_GR_SIM)==d.ALT_GR_SIM&&(u^=d.ALT_GR_SIM,u|=I.RALTFLAG)):u=B&16|(B&(I.LCTRLFLAG|I.RCTRLFLAG)?32:0)|(B&(I.LALTFLAG|I.RALTFLAG)?64:0),u|=Q.metaKey?I.K_METAFLAG:0,t.browser==Z.Browser.Firefox&&et.browserMap.FF["k"+n]&&(n=et.browserMap.FF["k"+n]);let g=new tt({device:t,kName:"",Lcode:n,Lmodifiers:u,Lstates:a,LmodifierChange:F,isSynthetic:!1}),y=typeof Q.charCode!="undefined"&&Q.charCode!=null&&(Q.charCode==0||(u&111)!=0);g.LisVirtualKey=y||Q.type!="keypress",g=Vc(g,U,e.baseLayout);let x=new tt(g);return x.source=Q,x}r(MB,"preprocessKeyboardEvent");var Dl=class Dl extends De{constructor(t,n,s){super();this.domEventTracker=new pt;this.swallowKeypress=!1;this._KeyDown=r(t=>{var c;let n=this.contextManager.activeKeyboard,s=jt(t);if(!s||n==null)return!0;let B=s.getElement();return((c=B==null?void 0:B.getAttribute("class"))==null?void 0:c.indexOf("kmw-disabled"))>=0?!0:this.keyDown(t)},"_KeyDown");this._KeyPress=r(t=>{var s;return!jt(t)||((s=this.contextManager.activeKeyboard)==null?void 0:s.keyboard)==null?!0:this.keyPress(t)},"_KeyPress");this._KeyUp=r(t=>{let n=jt(t);var s=MB(t,this.processor,this.hardDevice);if(s==null||n==null)return!0;var B=n.getElement();if(s.Lcode==13){var c=!1;if(j(B,"HTMLTextAreaElement")&&(c=!0),!c)return B instanceof B.ownerDocument.defaultView.HTMLInputElement&&(B.form&&(B.type=="search"||B.type=="submit")?B.form.submit():this.contextManager.page.findNeighboringInput(B,!1).focus()),!0}return this.keyUp(t)},"_KeyUp");this.hardDevice=t,this.contextManager=s,this.processor=n;let B=s.page,c=this.domEventTracker;B.on("enabled",i=>{let l=Zt(i);if(!(l instanceof P))c.attachDOMEvent(i,"keypress",this._KeyPress),c.attachDOMEvent(i,"keydown",this._KeyDown),c.attachDOMEvent(i,"keyup",this._KeyUp);else{let a=l.getElement().contentDocument;c.attachDOMEvent(a.body,"keydown",this._KeyDown),c.attachDOMEvent(a.body,"keypress",this._KeyPress),c.attachDOMEvent(a.body,"keyup",this._KeyUp)}}),B.on("disabled",i=>{let l=Zt(i);if(!(l instanceof P))c.detachDOMEvent(i,"keypress",this._KeyPress),c.detachDOMEvent(i,"keydown",this._KeyDown),c.detachDOMEvent(i,"keyup",this._KeyUp);else{let a=l.getElement().contentDocument;c.detachDOMEvent(a.body,"keydown",this._KeyDown),c.detachDOMEvent(a.body,"keypress",this._KeyPress),c.detachDOMEvent(a.body,"keyup",this._KeyUp)}})}keyDown(t){this.swallowKeypress=!1;var n=MB(t,this.processor,this.hardDevice);if(n==null)return!0;let s={LeventMatched:!1};return this.emit("keyevent",n,(B,c)=>{s.LeventMatched=B&&!B.triggerKeyDefault,s.LeventMatched?(t&&t.preventDefault&&(t.preventDefault(),t.stopPropagation()),this.swallowKeypress=!!n.Lcode,n.Lcode==8&&(this.swallowKeypress=!1)):this.swallowKeypress=!1}),!s.LeventMatched}keyUp(t){var n=MB(t,this.processor,this.hardDevice);if(n==null)return!0;let s=jt(t);return this.processor.doModifierPress(n,s,!1)}keyPress(t){var B;var n=MB(t,this.processor,this.hardDevice);if(n==null||n.LisVirtualKey)return!0;if(!((B=this.contextManager.activeKeyboard)!=null&&B.keyboard.isMnemonic))return!this.swallowKeypress||n.Lcode<32||this.hardDevice.browser==Z.Browser.Safari&&n.Lcode>63232&&n.Lcode<63744;let s={};return this.swallowKeypress||this.emit("keyevent",n,(c,i)=>{s.preventDefaultKeystroke=!!c}),this.swallowKeypress||s.preventDefaultKeystroke?(this.swallowKeypress=!1,t&&t.preventDefault&&(t.preventDefault(),t.stopPropagation()),!1):(this.swallowKeypress=!1,!0)}shutdown(){this.domEventTracker.shutdown()}};r(Dl,"HardwareEventKeyboard");var Hs=Dl;var Kl=class Kl{constructor(){this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}equals(e){return this.innerWidth==e.innerWidth&&this.innerHeight==e.innerHeight}};r(Kl,"RotationState");var OB=Kl,ge=class ge{constructor(e){this.idlePermutationCounter=ge.IDLE_PERMUTATION_CAP;this.keyman=e}resolve(){var n;var e=this.keyman.osk;(n=this.keyman.touchLanguageMenu)==null||n.hide(),this.keyman.touchLanguageMenu=null,e.setNeedsLayout(),this.oskVisible&&e.present(),this.isActive=!1,this.updateTimer&&(window.clearInterval(this.updateTimer),this.rotState=null);let t=this.keyman.contextManager.activeTarget;t&&window.setTimeout(()=>{this.keyman.ensureElementVisibility(t.getElement())},0)}initNewRotation(){this.oskVisible=this.keyman.osk.isVisible(),this.keyman.osk.hideNow(),this.isActive=!0}init(){var e=this.keyman.config.hostDevice.OS,t=this.keyman.util;e=="ios"?(t.attachDOMEvent(window,"orientationchange",()=>(this.iOSEventHandler(),!1)),t.attachDOMEvent(window,"resize",()=>(this.iOSEventHandler(),!1))):e=="android"&&("onmozorientationchange"in screen?t.attachDOMEvent(screen,"mozorientationchange",()=>(this.initNewRotation(),!1)):t.attachDOMEvent(window,"orientationchange",()=>(this.initNewRotation(),!1)),t.attachDOMEvent(window,"resize",()=>(this.resolve(),!1)))}iOSEventHandler(){this.isActive||(this.initNewRotation(),this.rotState=new OB,this.updateTimer=window.setInterval(this.iOSEventUpdate.bind(this),ge.UPDATE_INTERVAL)),this.idlePermutationCounter=0}iOSEventUpdate(){var e=new OB;this.rotState.equals(e)?++this.idlePermutationCounter==ge.IDLE_PERMUTATION_CAP&&this.resolve():(this.rotState=e,this.idlePermutationCounter=0)}};r(ge,"RotationProcessor"),ge.IDLE_PERMUTATION_CAP=15,ge.UPDATE_INTERVAL=20;var zB=ge;var Pl=class Pl{constructor(e,t){this.domEventTracker=new pt;this.suppressFocusCheck=r(e=>(this.focusAssistant.isTargetForcingScroll()&&(e.stopPropagation(),e.cancelBubble=!0),!0),"suppressFocusCheck");this.pageFocusHandler=r(()=>{var e;return!this.focusAssistant.maintainingFocus&&((e=this.engine.osk)!=null&&e.vkbd)&&(this.engine.contextManager.deactivateCurrentTarget(),this.engine.contextManager.resetContext()),!1},"pageFocusHandler");this.touchStartActivationHandler=r(e=>{var s,B;let t=this.engine.osk;if(!t)return!1;let n=this.engine.config.hostDevice;if(this.deactivateOnRelease=!0,this.touchY=e.touches[0].screenY,this.deactivateOnScroll=!1,n.OS=="android"&&n.browser=="chrome"){if(typeof t._Box=="undefined"||typeof t._Box.style=="undefined")return!1;let c=e.target.parentElement;if(typeof c!="undefined"&&c!=null&&(((s=c.getAttribute("class"))==null?void 0:s.indexOf("kmw-key-"))>=0||typeof c.parentElement!="undefined"&&c.parentElement!=null&&(c=c.parentElement,((B=c.getAttribute("class"))==null?void 0:B.indexOf("kmw-key-"))>=0)))return!1;this.deactivateOnScroll=!0}return!1},"touchStartActivationHandler");this.touchMoveActivationHandler=r(e=>{this.deactivateOnScroll&&(this.focusAssistant.focusing=!1,this.engine.contextManager.deactivateCurrentTarget());let t=e.touches[0].screenY,n=this.touchY;return(t-n>5||n-t<5)&&(this.deactivateOnRelease=!1),!1},"touchMoveActivationHandler");this.touchEndActivationHandler=r(e=>(this.deactivateOnRelease&&!this.engine.touchLanguageMenu&&!this.focusAssistant.focusing&&this.engine.contextManager.deactivateCurrentTarget(),this.deactivateOnRelease=!1,!1),"touchEndActivationHandler");this._WindowLoad=r(()=>{document.body.scrollTop=0,typeof document.documentElement!="undefined"&&(document.documentElement.scrollTop=0)},"_WindowLoad");this._WindowUnload=r(()=>{this.engine.shutdown()},"_WindowUnload");this.window=e,this.engine=t,this.attachHandlers(),t.config.hostDevice.touchable&&(this.buildPageTrailer(),this.rotationProcessor=new zB(this.engine),this.rotationProcessor.init())}buildPageTrailer(){let e=this.mobilePageTrailer=document.createElement("div"),t=e.style;t.width="100%",t.height=screen.width/2+"px",document.body.appendChild(e)}get focusAssistant(){return this.engine.contextManager.focusAssistant}attachHandlers(){let e=this.domEventTracker,t=this.engine.config.hostDevice,n=this.window.document.body;e.attachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),e.attachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),e.attachDOMEvent(n,"focus",this.suppressFocusCheck,!0),e.attachDOMEvent(n,"blur",this.suppressFocusCheck,!0),t.touchable&&(e.attachDOMEvent(n,"touchstart",this.touchStartActivationHandler,!1),e.attachDOMEvent(n,"touchmove",this.touchMoveActivationHandler,!1),e.attachDOMEvent(n,"touchend",this.touchEndActivationHandler,!1)),e.attachDOMEvent(window,"load",this._WindowLoad,!1),e.attachDOMEvent(window,"unload",this._WindowUnload,!1),e.attachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)}shutdown(){var s;let e=this.domEventTracker,t=this.engine.config.hostDevice,n=this.window.document.body;e.detachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),e.detachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),e.detachDOMEvent(n,"focus",this.suppressFocusCheck,!0),e.detachDOMEvent(n,"blur",this.suppressFocusCheck,!0),t.touchable&&(e.detachDOMEvent(n,"touchstart",this.touchStartActivationHandler,!1),e.detachDOMEvent(n,"touchmove",this.touchMoveActivationHandler,!1),e.detachDOMEvent(n,"touchend",this.touchEndActivationHandler,!1),(s=this.mobilePageTrailer)==null||s.parentElement.removeChild(this.mobilePageTrailer)),e.detachDOMEvent(window,"load",this._WindowLoad,!1),e.detachDOMEvent(window,"unload",this._WindowUnload,!1),e.detachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)}};r(Pl,"PageIntegrationHandlers");var wB=Pl;function ht(Q){let e=document.createElement(Q);return e.style.userSelect="none",e.style.MozUserSelect="none",e.style.KhtmlUserSelect="none",e.style.UserSelect="none",e.style.WebkitUserSelect="none",e}r(ht,"_CreateElement");function Ae(Q,e){try{if(Q&&typeof window.getComputedStyle!="undefined")return window.getComputedStyle(Q,"").getPropertyValue(e)}catch(t){}return""}r(Ae,"getStyleValue");var jl=class jl{constructor(e){this.keyman=e,this.scrolling=!1,this.shim=this.constructShim()}constructShim(){let e=this,t=ht("div"),n=this.keyman.osk;return t.id="kmw-language-menu-background",t.addEventListener("touchstart",s=>{if(s.preventDefault(),e.hide(),s.touches.length>2){var B=s.touches[1].pageX,c=s.touches[1].pageY;let i=n.vkbd.spaceBar;B>i.offsetLeft&&B<i.offsetLeft+i.offsetWidth&&c>i.offsetTop&&c<i.offsetTop+i.offsetHeight&&this.keyman.osk.emit("showbuild")}},!1),t}show(){let e=this.keyman.config.hostDevice,t=this.keyman.keyboardRequisitioner.cache.getStubList();if(t.length<1)return;var s=this.lgList=ht("div");this.lgList.id="kmw-language-menu";let B=this;document.body.appendChild(this.shim);var c=ht("div"),i=c.style,l=ht("div");c.id="kmw-menu-scroll-container",l.id="kmw-menu-scroller","WebkitOverflowScrolling"in i&&(i.WebkitOverflowScrolling="touch"),c.appendChild(l),s.appendChild(c);let a,F=ht("div");F.id="kmw-menu-index";for(let C=1;C<=26;C++)a=ht("p"),a.innerHTML=String.fromCharCode(C+64),F.appendChild(a);if(F.addEventListener("touchstart",function(C){B.scrollToLanguage(C,c,l)},!1),F.addEventListener("touchend",function(C){C.stopPropagation()},!1),s.appendChild(F),s.addEventListener("scroll",function(C){B.scrolling=!0},!1),c.addEventListener("scroll",function(C){c.scrollTop<1&&(c.scrollTop=1),c.scrollTop>c.scrollHeight-c.offsetHeight-1&&(c.scrollTop=c.scrollHeight-c.offsetHeight-1)},!1),this.activeLgNo=this.addLanguages(l,t),this.lgList.style.visibility="hidden",document.body.appendChild(this.lgList),e.OS=="android"&&"devicePixelRatio"in window&&(this.lgList.style.fontSize=2/window.devicePixelRatio+"em"),e.OS=="android"&&e.formFactor=="tablet"&&"devicePixelRatio"in window){var o=parseInt(Ae(s,"width"),10),d=s.style;isNaN(o)||(d.width=d.maxWidth=2*o/window.devicePixelRatio+"px"),o=parseInt(Ae(c,"width"),10),d=c.style,isNaN(o)||(d.width=d.maxWidth=2*o/window.devicePixelRatio+"px"),o=parseInt(Ae(l,"width"),10),d=l.style,isNaN(o)||(d.width=d.maxWidth=2*o/window.devicePixelRatio+"px")}this.adjust(0);var U=F.childNodes[1].offsetTop-F.childNodes[0].offsetTop,u=Math.floor(s.offsetHeight/26),g=Math.round(100*u/U)/100,y=g>.6?1:2;g>1.25&&(g=1.25);for(let C=0;C<26;C++){var x=F.childNodes[C].style;y==2&&C%2==1?x.display="none":(x.fontSize=g*y+"em",x.lineHeight=u*y+"px")}var G=c.offsetWidth;c.scrollHeight>c.offsetHeight+3?G=G+F.offsetWidth:F.style.display="none",s.style.width=G+"px",this.lgList.style.visibility="",this.scrollToIndex(this.activeLgNo,c,l)}adjust(e){let t=this.keyman.osk,n=this.keyman.config.hostDevice;var s=this.lgList,B=s.firstChild,c=B.firstChild,i=0,l=s.style,a=s.childNodes[1],F=window.innerHeight-t.vkbd.lgKey.offsetHeight-16,o=c.childNodes.length+e-1,d=c.firstChild.firstChild.offsetHeight,U=o*d;n.OS=="ios"&&(n.formFactor=="phone"?(i=gt()?36:0,F=(window.innerHeight-i-16)*Vt(n.formFactor)):n.formFactor=="tablet"&&(i=gt()?16:0,F=F-i)),l.left=z(t.vkbd.lgKey)+"px",U>F&&(U=F),l.height=U+"px",l.bottom="0px",a.style.height=B.style.height=l.height}scrollToLanguage(e,t,n){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();let s=e.touches[0].target;if(s.nodeName=="P"){var B,c,i=s.innerHTML.charCodeAt(0),l=n.childNodes;try{for(B=0;B<l.length-1&&(c=l[B].firstChild.innerHTML.toUpperCase().charCodeAt(0),!(c>=i));B++);}catch(a){}this.scrollToIndex(B,t,n)}}scrollToIndex(e,t,n){let s;try{s=n.firstChild.getBoundingClientRect().height*(e-.5)+1,t.scrollTop=s}catch(c){s=0}try{t.scrollTop<0&&(t.scrollTop=0),t.scrollTop>t.scrollHeight-t.offsetHeight-1&&(t.scrollTop=t.scrollHeight-t.offsetHeight-1)}catch(c){}}addLanguages(e,t){var F;var n=t.length;let s=this.keyman.config.hostDevice,B=[];for(let o=0;o<n;o++){let d=t[o].KL;B.indexOf(d)==-1&&B.push(d)}B.sort();var c=Math.round(100/Vt(s.formFactor))/100;let i=-1;for(let o=0;o<B.length;o++){let d=ht("div");d.className="kbd-list-closed";let U=ht("p");U.kList=[];for(let g=0;g<n;g++)t[g].KL==B[o]&&U.kList.push(t[g]);s.OS=="ios"&&(U.style.fontSize=c+"em"),d.appendChild(U),e.appendChild(d),B[o]==((F=this.keyman.contextManager.activeKeyboard)==null?void 0:F.metadata.langName)&&(i=o);let u=this;if(U.kList.length>1){U.className="kbd-list",U.innerHTML=B[o]+"...",U.scrolled=!1,U.ontouchend=g=>{g.stopPropagation(),U.scrolled?U.scrolled=!1:U.parentElement.className=U.parentElement.className=="kbd-list-closed"?"kbd-list-open":"kbd-list-closed",u.adjust(U.parentElement.className=="kbd-list-closed"?0:U.kList.length)},U.addEventListener("touchstart",function(g){g.stopPropagation()},!1),U.addEventListener("touchmove",function(g){U.scrolled=!0,g.stopPropagation()},!1);for(let g=0;g<U.kList.length;g++){let y=ht("p");y.className="kbd-list-entry",s.OS=="ios"&&(y.style.fontSize=c+"em"),this.addKeyboard(U.kList[g],y,!1),d.appendChild(y)}}else U.innerHTML=B[o],U.className="kbd-single-entry",this.addKeyboard(U.kList[0],U,!0);o==i&&(U.className=U.className+" current")}var l=ht("div");l.id="kmw-menu-footer";var a=r(function(o){o.cancelable&&o.preventDefault(),o.stopPropagation()},"cancelTouch");return l.addEventListener("touchstart",a,!1),l.addEventListener("touchmove",a,!1),l.addEventListener("touchend",a,!1),e.appendChild(l),i}addKeyboard(e,t,n){t.kn=e.KI,t.kc=e.KLC,t.innerHTML=n?e.KL:e.KN.replace(" Keyboard","");let s=this,B=r(()=>{if(this.originalBodyStyle)return console.error("Unexpected state:  `originalBodyStyle` was not cleared by a previous `unlockBodyScroll()` call"),!1;this.originalBodyStyle={};let o=this.originalBodyStyle,d=document.body.style;return o.overflowY=d.overflowY,o.height=d.height,d.overflowY="hidden",d.height="100%",!0},"lockBodyScroll"),c=r(()=>{if(!this.originalBodyStyle){console.error("Unexpected state:  `originalBodyStyle` is unset; cannot restore original body style");return}let o=this.originalBodyStyle,d=document.body.style;d.overflowY=o.overflowY,d.height=o.height,this.originalBodyStyle=null},"unlockBodyScroll"),i=r(function(o){o.stopPropagation(),this.className.indexOf("selected")<=0&&(this.className=this.className+" selected"),s.scrolling=!1,s.y0=o.touches[0].pageY,B()},"touchStart"),l=r(function(o){o.stopImmediatePropagation();var d=s.lgList.childNodes[0],U=d.scrollHeight-d.offsetHeight,u,g;if(typeof o.pageY!="undefined")u=o.pageY;else if(typeof o.touches!="undefined")u=o.touches[0].pageY;else return!1;if(g=u-s.y0,g<0)d.scrollTop>=U-1&&(s.y0=u);else if(g>0)d.scrollTop<2&&(s.y0=u);else return!1;return(g<-5||g>5)&&(s.scrolling=!0,this.className=this.className.replace(/\s*selected/,""),s.y0=u),!0},"touchMove"),a=r(function(o){let d=this;return typeof o.stopImmediatePropagation!="undefined"?o.stopImmediatePropagation():o.stopPropagation(),s.scrolling?this.className=this.className.replace(/\s*selected/,""):(s.keyman.contextManager.focusAssistant.setFocusTimer(),s.lgList.style.display="none",s.keyman.contextManager.activateKeyboard(d.kn,d.kc,!0),s.keyman.contextManager.restoreLastActiveTarget(),s.hide()),c(),!0},"touchEnd"),F=r(function(o){c()},"touchCancel");t.addEventListener("touchstart",i,!1),t.addEventListener("touchmove",l,!1),t.addEventListener("touchend",a,!1),t.addEventListener("touchcancel",F,!1)}hide(){let e=this.keyman.osk;this.lgList&&(e.vkbd.highlightKey(e.vkbd.lgKey,!1),this.lgList.style.visibility="hidden",window.setTimeout(()=>{this.shim.parentElement&&(document.body.removeChild(this.shim),document.body.removeChild(this.lgList))},500)),this.keyman.touchLanguageMenu=null}};r(jl,"LanguageMenu");var DB=jl;function eQ(Q,e,t){let n=t.focusAssistant;e.on("globekey",(s,B)=>{B&&e.hostDevice.touchable&&(Q.touchLanguageMenu=new DB(Q),Q.touchLanguageMenu.show()),e.vkbd&&e.vkbd.highlightKey(s,!1)}),e.on("hiderequested",s=>{e&&(e.startHide(!0),t.forgetActiveTarget())}),e.addEventListener("hide",s=>{var B;s!=null&&s.HiddenByUser&&((B=t.activeTarget)==null||B.focus())}),e.on("showbuild",()=>{var s;(s=Q.config.alertHost)==null||s.alert("KeymanWeb Version "+En.VERSION+'<br /><br /><span style="font-size:0.8em">Copyright &copy; 2007-2023 SIL International</span>')}),e.on("dragmove",s=>E(this,null,function*(){n.restoringFocus=!0,yield s,t.restoreLastActiveTarget(),n.restoringFocus=!1,n.setMaintainingFocus(!1)})),e.on("resizemove",s=>E(this,null,function*(){n.restoringFocus=!0,yield s,t.restoreLastActiveTarget(),n.restoringFocus=!1,n.setMaintainingFocus(!1)})),e.on("pointerinteraction",s=>E(this,null,function*(){n.setMaintainingFocus(!0),yield s,n.setMaintainingFocus(!1)}))}r(eQ,"setupOskListeners");function ga(Q){let e=document.createElement(Q);return e.style.userSelect="none",e}r(ga,"createUnselectableElement");var _l=class _l{constructor(e){this.getAbsoluteX=z;this.getAbsoluteY=w;this._GetAbsoluteX=z;this._GetAbsoluteY=w;this._GetAbsolute=this.getAbsolute;this.toNzString=this.nzString;this.createElement=ga;this.getStyleValue=Ae;this.config=e,this.stylesheetManager=new at(document.body,e.applyCacheBusting),this.domEventTracker=new pt}isTouchDevice(){return this.config.hostDevice.touchable}getAbsolute(e){return{x:z(e),y:w(e)}}getOption(e,t){return e in this.config.paths?this.config.paths[e]:e in this.config.options?this.config.options[e]:arguments.length>1?t:""}setOption(e,t){switch(e){case"attachType":break;case"ui":break;case"useAlerts":this.config.signalUser=t?new de:null;break;case"setActiveOnRegister":this.config.activateFirstKeyboard=!!t;break;case"spacebarText":this.config.spacebarText=t;break;default:throw new Error("Path-related options may not be changed after the engine has initialized.")}}loadCookie(e){return new ct(e).load(decodeURIComponent)}saveCookie(e,t){new ct(e).save(t,encodeURIComponent)}addStyleSheet(e){let t=Be(e);return this.stylesheetManager.linkStylesheet(t),t}removeStyleSheet(e){return this.stylesheetManager.unlink(e)}linkStyleSheet(e){this.stylesheetManager.linkExternalSheet(e)}getLanguageCodes(e){return e.indexOf("-")==-1?[e]:e.split("-")}attachDOMEvent(e,t,n,s){this.domEventTracker.attachDOMEvent(e,t,n,s)}detachDOMEvent(e,t,n,s){this.domEventTracker.detachDOMEvent(e,t,n,s)}get alertHost(){return this.config.alertHost?this.config.alertHost:(this._alertHost||(this._alertHost=new de),this._alertHost)}alert(e,t){this.alertHost.alert(e,t)}nzString(e,t){let n="";return arguments.length>1&&(n=t),typeof e=="undefined"||e==null||e==0||e==""?n:""+e}toNumber(e,t){let n=parseInt(e,10);return isNaN(n)?t:n}toFloat(e,t){let n=parseFloat(e);return isNaN(n)?t:n}rgba(e,t,n,s,B){let c="transparent";try{c="rgba("+t+","+n+","+s+","+B+")"}catch(i){c="rgb("+t+","+n+","+s+")"}return c}shutdown(){var e,t,n;(e=this.stylesheetManager)==null||e.unlinkAll(),(t=this.domEventTracker)==null||t.shutdown(),(n=this._alertHost)==null||n.shutdown()}};r(_l,"UtilApiEndpoint");var KB=_l;var $l=class $l{constructor(e,t,n){this.code=e,this.shift=t,this.handler=n}matches(e,t){return this.code==e&&this.shift==t}};r($l,"Hotkey");var ql=$l,tr=class tr{constructor(){this.hotkeys=[];this._Process=r(e=>{e||(e=window.event);var t=wl(e);if(t==null)return!1;for(var n=(e.shiftKey?16:0)|(e.ctrlKey?32:0)|(e.altKey?64:0),s=0;s<this.hotkeys.length;s++)if(this.hotkeys[s].matches(t,n))return this.hotkeys[s].handler(),e.returnValue=!1,e&&e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1;return!0},"_Process")}addHotKey(e,t,n){for(var s=0;s<this.hotkeys.length;s++)if(this.hotkeys[s].code==e&&this.hotkeys[s].shift==t){this.hotkeys[s].handler=n;return}this.hotkeys.push(new ql(e,t,n))}removeHotkey(e,t){for(var n=0;n<this.hotkeys.length;n++)if(this.hotkeys[n].matches(e,t)){this.hotkeys.splice(n,1);return}}};r(tr,"HotkeyManager");var PB=tr;var nr=class nr{constructor(e){this.e=e,this.c=e.style.backgroundColor}reset(){this.e.style.backgroundColor=this.c}};r(nr,"BeepData");var er=nr,sr=class sr{constructor(e){this._BeepObjects=[];this._BeepTimeout=0;this.reset=r(()=>{this.keyboardInterface.resetContextCache();var e;for(this._BeepTimeout=0,e=0;e<this._BeepObjects.length;e++)this._BeepObjects[e].reset();this._BeepObjects=[]},"reset");this.keyboardInterface=e}beep(e){if(e instanceof K){var t=e.getElement();if(e instanceof P&&(t=e.docRoot),!!t&&!(!t.style||typeof t.style.backgroundColor=="undefined")){for(var n=0;n<this._BeepObjects.length;n++)if(this._BeepObjects[n].e==t)return;this._BeepObjects.push(new er(t)),t.style.backgroundColor="#000000",this._BeepTimeout==0&&(this._BeepTimeout=1,window.setTimeout(this.reset,50))}}}};r(sr,"BeepHandler");var jB=sr;var Br=class Br extends Xe{constructor(t,n){super(t,n);this.GetLastActiveElement=this.getLastActiveElement;this.FocusLastActiveElement=this.focusLastActiveElement;this.HideHelp=this.hideHelp;this.ShowHelp=this.showHelp;this.ShowPinnedHelp=this.showPinnedHelp}saveFocus(){this.engine.contextManager.focusAssistant._IgnoreNextSelChange=1}getLastActiveElement(){return this.engine.contextManager.lastActiveTarget}focusLastActiveElement(){this.engine.contextManager.restoreLastActiveTarget()}hideHelp(){this.engine.osk.startHide(!0)}showHelp(t,n){let s=this.engine.osk;s instanceof Kt?s.presentAtPosition(t,n):s.present()}showPinnedHelp(){let t=this.engine.osk;t instanceof Kt&&(!t.activeKeyboard.keyboard.isCJK||!this.ruleBehavior)&&(t.userPositioned=!0),t.present()}};r(Br,"KeyboardInterface");var Cn=Br;(function(){Cn.__publishShorthandAPI()})();var _B=class _B extends cn{constructor(t,n){let s=new TB(n);super(t,s,new Js(s,()=>this.legacyAPIEvents),B=>({keyboardInterface:new Cn(window,B),defaultOutputRules:new Rs(B.contextManager)}));this._initialized=0;this.hotkeyManager=new PB;this.getOskHeight=null;this.getOskWidth=null;this.helpURL="https://help.keyman.com/go";this.keyEventRefocus=r(()=>{this.contextManager.restoreLastActiveTarget()},"keyEventRefocus");this._GetKeyboardDetail=r(function(t,n){return{Name:t.KN,InternalName:t.KI,LanguageName:t.KL,LanguageCode:t.KLC,RegionName:t.KR,RegionCode:t.KRC,CountryName:t.KC,CountryCode:t.KCC,KeyboardID:t.KD,Font:t.KFont,OskFont:t.KOskFont,HasLoaded:!!n,IsRTL:n?n.isRTL:null}},"_GetKeyboardDetail");this._util=new KB(s),this.beepHandler=new jB(this.core.keyboardInterface),this.core.keyboardProcessor.beepHandler=()=>this.beepHandler.beep(this.contextManager.activeTarget),this.hardKeyboard=new Hs(s.hardDevice,this.core.keyboardProcessor,this.contextManager),this.contextManager.on("targetchange",B=>{let c=B==null?void 0:B.getElement();this.osk&&(this.osk.activationModel.activationTrigger=c),this.config.hostDevice.touchable&&B&&this.ensureElementVisibility(c)})}ensureElementVisibility(t){if(!t||!this.osk)return;let n=w(t),s=window.pageYOffset,B=n-s;n>=s&&(B-=window.innerHeight-this.osk._Box.offsetHeight-t.offsetHeight-2,B<0&&(B=0)),B!=0&&window.scrollTo(0,B+s)}get util(){return this._util}get views(){return pl}get initialized(){return this._initialized}get ui(){return this._ui}set ui(t){this._ui&&this._ui.shutdown(),this._ui=t,this.config.deferForInitialization.isFulfilled&&t.initialize()}init(t){return E(this,null,function*(){let s=new we().detect(),B=b(b({},$r),t);if(this.config.hostDevice=s,this.config.initialize(B),this._initialized=1,yield Zs(),this.config.deferForInitialization.isResolved)return Promise.resolve();yield vs(_B.prototype,this,"init").call(this,B),this.keyboardRequisitioner.cloudQueryEngine.once("unboundregister",()=>{var i;(i=this.contextManager.activeKeyboard)!=null&&i.keyboard||this.setActiveKeyboard("","")}),this.contextManager.initialize();let c=this.contextManager.getSavedKeyboardRaw();s.touchable?this.osk=new Cs(this):this.osk=new Gs(this),eQ(this,this.osk,this.contextManager),this.pageIntegration=new wB(window,this),this.config.finalizeInit(),this.ui&&(this.ui.initialize(),this.legacyAPIEvents.callEvent("loaduserinterface",{})),this._initialized=2,yield Promise.resolve(),this.contextManager.restoreSavedKeyboard(c),yield Promise.resolve()})}get register(){return this.keyboardRequisitioner.cloudQueryEngine.registerFromCloud}getUIState(){return this.contextManager.focusAssistant.getUIState()}activatingUI(t){this.contextManager.focusAssistant.setMaintainingFocus(!!t)}setKeyboardForControl(t,n,s){if(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}if(!this.isAttached(t)){console.error("KeymanWeb is not attached to element "+t);return}let B=null;if(n&&(B=this.keyboardRequisitioner.cache.getStub(n,s),!B))throw new Error(`No keyboard has been registered with id ${n} and language code ${s}.`);this.contextManager.setKeyboardForTarget(t._kmwAttachment.interface,n,s)}getKeyboardForControl(t){let n=Zt(t);return this.contextManager.getKeyboardStubForTarget(n).id}getLanguageForControl(t){let n=Zt(t);return this.contextManager.getKeyboardStubForTarget(n).langId}isAttached(t){return this.contextManager.page.isAttached(t)}addKeyboards(...t){return this.config.deferForInitialization.then(()=>{if(!t||!t[0]||t[0].length==0)return this.keyboardRequisitioner.fetchCloudCatalog().catch(n=>(console.error(n[0].error),n));{let n=[];return Array.isArray(t[0])?n=n.concat(t[0]):Array.isArray(t)&&(n=n.concat(t)),this.keyboardRequisitioner.addKeyboardArray(n)}})}addKeyboardsForLanguage(t){return this.config.deferForInitialization.then(()=>typeof t=="string"?this.keyboardRequisitioner.addLanguageKeyboards(t.split(",").map(n=>n.trim())):this.keyboardRequisitioner.addLanguageKeyboards(t))}isCJK(t){let n;if(t){let s=t;s.KeyboardID?n=this.keyboardRequisitioner.cache.getKeyboard(s.KeyboardID):n=new k(t)}else n=this.core.activeKeyboard;return n&&n.isCJK}getKeyboard(t,n){let s=this.keyboardRequisitioner.cache.getStub(t,n),B=this.keyboardRequisitioner.cache.getKeyboardForStub(s);return s&&this._GetKeyboardDetail(s,B)}getKeyboards(){let t=[],n=this.keyboardRequisitioner.cache,s=n.getStubList();for(let B=0;B<s.length;B++){let c=s[B],i=n.getKeyboardForStub(c),l=this._GetKeyboardDetail(c,i);t.push(l)}return t}removeKeyboards(...t){var n;for(let s=0;s<t.length;s++)this.keyboardRequisitioner.cache.forgetKeyboard(t[s],!0),((n=this.contextManager.activeKeyboard)==null?void 0:n.metadata.id)==Bt(t[s])&&this.contextManager.activateKeyboard("","");return!0}getSavedKeyboard(){return this.contextManager.getSavedKeyboard()}focusLastActiveElement(){var t;(t=this.contextManager.lastActiveTarget)==null||t.focus()}getLastActiveElement(){var t;return(t=this.contextManager.lastActiveTarget)==null?void 0:t.getElement()}setActiveElement(t,n){if(typeof t=="string"){let B=t;if(t=document.getElementById(t),!t)throw new Error(`Could not find the specified element (id: ${B}`)}let s=Zt(t);if(!s)throw new Error(`KMW is not attached to the specified element (id: ${t.id}).`);this.contextManager.setActiveTarget(s,n)}moveToElement(t){typeof t=="string"&&(t=document.getElementById(t)),t.focus()}addHotKey(t,n,s){this.hotkeyManager.addHotKey(t,n,s)}removeHotKey(t,n){this.hotkeyManager.removeHotkey(t,n)}attachToControl(t){this.contextManager.page.attachToControl(t)}detachFromControl(t){this.contextManager.page.detachFromControl(t)}disableControl(t){this.contextManager.page.disableControl(t)}enableControl(t){this.contextManager.page.enableControl(t)}BuildVisualKeyboard(t,n,s,B){let c=null;t!=null&&(c=this.keyboardRequisitioner.cache.getKeyboard(t)),c=c||this.core.activeKeyboard;let i=this.keyboardRequisitioner.cache.getStub(c),l=this.getOskHeight,a=(typeof l=="function"?l():null)||this.osk.computedHeight||200;return It.buildDocumentationKeyboard(c,i,this.config.paths,s,B,a)}shutdown(){var t,n;this.pageIntegration.shutdown(),this.contextManager.shutdown(),(t=this.osk)==null||t.shutdown(),this.core.languageProcessor.shutdown(),this.hardKeyboard.shutdown(),this.util.shutdown(),this.legacyAPIEvents.callEvent("unloaduserinterface",{}),(n=this.ui)==null||n.shutdown()}};r(_B,"KeymanEngine");var Ws=_B;var nQ=document.getElementsByTagName("script"),sQ=nQ[nQ.length-1].src,ua=sQ.substr(0,sQ.lastIndexOf("/")+1);window.keyman=new Ws(nn.constructInstance(),ua);})();
//# sourceMappingURL=keymanweb.js.map
