{"version":3,"file":"kmwuifloat.js","lineCount":11,"mappings":"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","sources":["source/kmwuifloat.ts"],"sourcesContent":["/// <reference path=\"../node_modules/@keymanapp/web-utils/src/kmwstring.ts\" />\r\n\r\n/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\n\r\n// If a UI module has been loaded, we can rely on the publically-published 'name' property\r\n// having been set as a way to short-out a UI reload.  Its parent object always exists by\r\n// this point in the build process.\r\nif(!window['keyman']['ui']['name']) { \r\n  /********************************/\r\n  /*                              */\r\n  /* Floating User Interface      */\r\n  /*                              */\r\n  /********************************/\r\n\r\n  /**\r\n   * Do not enclose in an anonymous function, as the compiler may create\r\n   * global scope variables to replace true, false, null, which can collide\r\n   * with other variables.\r\n   * Instead, use the --output-wrapper command during optimization, which will\r\n   * add the anonymous function to enclose all code, including those optimized\r\n   * variables which would otherwise have global scope.\r\n   **/  \r\n\r\n  try {\r\n\r\n    // Declare KeymanWeb, OnScreen keyboard and Util objects\r\n    var keymanweb=window['keyman'];\r\n    var util=keymanweb['util'];\r\n    var osk=keymanweb['osk'];\r\n    var dbg=keymanweb['debug'];\r\n\r\n    // Disable UI for touch devices\r\n    if(util['isTouchDevice']()) throw '';\r\n    \r\n    // User interface global and local variables\r\n    keymanweb['ui'] = {};\r\n    var ui=keymanweb['ui'];\r\n    ui['name'] = 'float';\r\n    \r\n    ui.KeyboardSelector = null; \r\n    \r\n    ui.outerDiv = null;     // replaces DivKeymanWeb\r\n    ui.innerDiv = null;     // replaces Lkdiv\r\n    ui.oskButton = null;    // toggles OSK on or off  \r\n    ui.kbdIcon = null;      // keyboard icon within OSK button\r\n    ui.selecting = false;   // control focus behaviour during selection\r\n    ui.updateList = true;   // control keyboard list updating\r\n    ui.updateTimer = null;  // prevent unnecessary list refreshing\r\n    ui.floatRight = false;  // align left by default\r\n    ui.initialized = false; // initialization flag \r\n\r\n    /**\r\n     * Display or hide the OSK from the OSK icon link\r\n     */     \r\n    ui.toggleOSK = function()\r\n    {\r\n      keymanweb['focusLastActiveElement']();\r\n      if(osk['show']) \r\n      {\r\n        if(osk['isEnabled']()) osk['hide'](); else osk['show'](true);\r\n      }\r\n      if(window.event) window.event.returnValue=false;\r\n      return false;\r\n    }\r\n    \r\n    /**\r\n     * Function     Initialize\r\n     * Scope        Private   \r\n     * Description  UI Initialization\r\n     **/\r\n    ui.Initialize = function()\r\n    { \r\n      // Must always initialize after keymanWeb itself, otherwise options are undefined\r\n      if(!keymanweb['initialized'])\r\n      {\r\n        window.setTimeout(ui.Initialize,50); return;\r\n      }\r\n      \r\n      if(ui.initialized || util['isTouchDevice']()) return;\r\n          \r\n      var imgPath=util['getOption']('resources')+\"ui/float/\";\r\n      \r\n      ui.outerDiv = util['createElement']('DIV');         // Container for UI (visible when KeymanWeb is active)\r\n      ui.innerDiv = util['createElement']('DIV');         // inner div for UI\r\n      ui.kbdIcon = util['createElement']('IMG');  \r\n      ui.outerDiv.innerHTML = \"<a href='http://keyman.com/web/' target='KeymanWebHelp'>\"\r\n        + \"<img src='\"+imgPath+\"kmicon.gif' border='0' style='padding: 0px 2px 0 1px; margin:0px;' title='KeymanWeb' alt='KeymanWeb' /></a>\"; /* I2081 */\r\n\r\n      var s=ui.outerDiv.style;                                                                              \r\n      s.backgroundColor='white'; s.border='solid 1px black'; s.position='absolute'; s.height='18px';\r\n      s.font='bold 8pt sans-serif'; s.display='none'; s.textAlign='left';s.overflow='hidden'; \r\n      \r\n      util['attachDOMEvent'](ui.outerDiv,'mousedown',ui._SelectorMouseDown);\r\n      util['attachDOMEvent'](ui.outerDiv,'mouseover',ui._SelectorMouseOver);\r\n      util['attachDOMEvent'](ui.outerDiv,'mouseout',ui._SelectorMouseOut);\r\n          \r\n      // Register keymanweb events\r\n      ui.registerEvents();        \r\n\r\n      ui.kbdIcon.src = imgPath+'kbdicon.gif';\r\n      ui.kbdIcon.title = 'Display visual keyboard';\r\n\r\n      // Set initial OSK button style (off by default)\r\n      ui.oskButtonState(false);\r\n      \r\n      var Lhdiv = util['createElement']('DIV'); \r\n      ui.oskButton = Lhdiv;\r\n      Lhdiv.onclick = ui.toggleOSK;    \r\n      Lhdiv.appendChild(ui.kbdIcon);\r\n      ui.innerDiv.appendChild(Lhdiv);\r\n      ui.outerDiv.appendChild(ui.innerDiv);\r\n      document.body.appendChild(ui.outerDiv);\r\n\r\n      ui.KeyboardSelector =  util['createElement']('SELECT'); // ControlSelector - KeymanWeb keyboard selector\r\n      \r\n      s=ui.KeyboardSelector.style;\r\n      s.font='8pt sans-serif'; s.backgroundColor='#f3e5de'; s.border='solid 1px #7B9EBD'; s.height='16px';s.margin='1px 2px 0px 2px';\r\n      s.left='20px'; s.top='0px'; s.position='absolute'; s.maxWidth='150px';\r\n\r\n      util['attachDOMEvent'](ui.KeyboardSelector,'change',ui.SelectKeyboardChange);\r\n      util['attachDOMEvent'](ui.KeyboardSelector,'blur',ui.SelectBlur);\r\n      \r\n      ui.innerDiv.appendChild(ui.KeyboardSelector);  //this may need to be moved up.... \r\n\r\n      // Check required interface alignment and default keyboard\r\n      var opt=util['getOption']('ui'),dfltKeyboard='English';\r\n      if(opt && typeof(opt) == 'object')\r\n      {\r\n        if(typeof(opt['position']) == 'string' && opt['position'] == 'right') \r\n          ui.floatRight = true;\r\n        if(typeof(opt['default']) == 'string') \r\n          dfltKeyboard = opt['default']; \r\n      }\r\n\r\n      var Lopt = util['createElement']('OPTION');\r\n      Lopt.value = '-';\r\n      Lopt.innerHTML = dfltKeyboard;\r\n      ui.KeyboardSelector.appendChild(Lopt);  \r\n      Lopt = null;\r\n\r\n      // This must be set before updating the keyboard list to prevent recursion!\r\n      ui.initialized = true;\r\n\r\n      // Update the keyboard list if required\r\n      ui.updateKeyboardList();\r\n      \r\n      //may also want to initialize style sheet here ??\r\n    }\r\n\r\n    ui._UnloadUserInterface = function() {\r\n      ui.KeyboardSelector = ui.innerDiv = ui.outerDiv = ui.kbdIcon = null; \r\n    };\r\n    /**\r\n     * UI removal - resource cleanup\r\n     */    \r\n    keymanweb['addEventListener']('unloaduserinterface', ui._UnloadUserInterface);\r\n        \r\n\r\n    ui.shutdown = function() {\r\n      var root = ui.outerDiv;\r\n      if(root) {\r\n        root.parentNode.removeChild(root);\r\n      }\r\n\r\n      ui._UnloadUserInterface();\r\n\r\n      if(window.removeEventListener) {\r\n        window.removeEventListener('resize', ui._Resize, false);\r\n      }\r\n    }\r\n  \r\n    /**\r\n     * Update list of keyboards shown by UI\r\n     */     \r\n    ui.updateKeyboardList = function()\r\n    {\r\n      // Do nothing unless list requires updating\r\n      if(ui.updateList) \r\n      { \r\n        if(!ui.initialized) ui.Initialize();\r\n                                                      \r\n        // Remove current list (except for default element)\r\n        var i,opts=ui.KeyboardSelector.getElementsByTagName('OPTION');\r\n        for(i=opts.length; i>1; i--)\r\n        {\r\n          ui.KeyboardSelector.removeChild(opts[i-1]);\r\n        }    \r\n        \r\n        // Loop over installed keyboards and add to selection list     \r\n        var Ln,Lopt,Lkbds=keymanweb['getKeyboards']();  \r\n            \r\n        for(Ln=0; Ln<Lkbds.length; Ln++) \r\n        {\r\n          Lopt = util['createElement']('OPTION');\r\n          Lopt.value = Lkbds[Ln]['InternalName']+':'+Lkbds[Ln]['LanguageCode'];;        \r\n          Lopt.innerHTML = Lkbds[Ln]['Name'].replace(/\\s?keyboard/i,'');      \r\n          if(Lkbds[Ln]['LanguageName'])\r\n          {\r\n            var lg=Lkbds[Ln]['LanguageName'];\r\n            // Only show the main language name if variants indicated (this is tentative)\r\n            // e.g. Chinese rather than Chinese, Mandarin, which is in the keyboard name\r\n            lg = lg.split(',')[0];\r\n            if(Lkbds[Ln]['Name'].search(lg) == -1)        \r\n              Lopt.innerHTML = lg+' ('+Lopt.innerHTML+')';  // I1300 - Language support\r\n          }\r\n          \r\n          ui.KeyboardSelector.appendChild(Lopt);\r\n          Lopt = null;\r\n        }\r\n      }\r\n      ui.updateList = false;    \r\n      \r\n      // Set the menu selector to the currently saved keyboard\r\n      var sk = keymanweb['getSavedKeyboard']().split(':');\r\n      if(sk.length < 2) sk[1] = ''; \r\n      ui.updateMenu(sk[0],sk[1]); \r\n      \r\n      // Redisplay the UI to correct width for any new language entries\r\n      if(keymanweb['getLastActiveElement']())\r\n      {\r\n        ui.HideInterface();\r\n        ui.ShowInterface();\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Function     updateMenu\r\n     * Scope        Private   \r\n     * @param       {string}     kbd\r\n     * @param       {string}     lg \r\n     * Description  Update the UI menu selection\r\n     *              Separate arguments passed to allow better control of selection when a keyboard \r\n     *              is listed more than once for different language codes       \r\n     */   \r\n    ui.updateMenu = function(kbd,lg)\r\n    {\r\n      var i=0,value='English';\r\n      \r\n      // This can be called during startup before fully initialized - ignore if so\r\n      if(!ui.initialized) return;  \r\n      \r\n      var match = kbd;\r\n      if(lg != '') match += ':' + lg;\r\n      \r\n      if(kbd == '')\r\n        ui.KeyboardSelector.selectedIndex=0;\r\n      else\r\n      {  \r\n        var opt=ui.KeyboardSelector.getElementsByTagName('OPTION');\r\n        for(i=0; i<opt.length; i++)\r\n        {\r\n          var t=opt[i].value; \r\n          if(lg == '') t = t.split(':')[0];\r\n          if(t == match) \r\n          {\r\n            ui.KeyboardSelector.selectedIndex=i;\r\n            break; \r\n          }   \r\n        }\r\n      }\r\n    }  \r\n\r\n    /**\r\n     * Function     oskButtonState\r\n     * Scope        Private   \r\n     * @param       {boolean}     oskEnabled\r\n     * Description  Update kbd icon border style to indicate whether OSK is enabled for display or not\r\n     **/   \r\n    ui.oskButtonState = function(oskEnabled)\r\n    {\r\n      var s = ui.kbdIcon.style;\r\n      s.width='24px'; s.height='13px'; s.top='1px'; \r\n      s.verticalAlign='bottom'; s.padding='2px 2px 1px 2px'; s.position='absolute';\r\n      s.border=oskEnabled ? 'inset 1px #808080' : 'none'; \r\n      s.background=oskEnabled ? '#f7e7de' : 'white';\r\n      s.display = 'block';     \r\n      if(ui.initialized) ui.oskButton.style.display = 'block';\r\n    }\r\n    \r\n    /**\r\n     * Register all keymanweb and OSK events only after keymanweb is fully initialized\r\n     *    \r\n     **/      \r\n    ui.registerEvents = function()\r\n    {\r\n      /**\r\n       * Keyboard registration event handler\r\n       *    \r\n       * Set a timer to update the UI keyboard list on timeout after each keyboard is registered, \r\n       * thus updating only once when only if multiple keyboards are registered together\r\n       */   \r\n      keymanweb['addEventListener']('keyboardregistered', \r\n        function(p)\r\n        {  \r\n            ui.updateList = true;\r\n            if(ui.updateTimer) clearTimeout(ui.updateTimer);\r\n            ui.updateTimer = setTimeout(ui.updateKeyboardList,200);\r\n        });       \r\n      \r\n      /**\r\n       * Keyboard load event handler\r\n       * \r\n       * Set the menu selector to the currently saved keyboard when a keyboard is loaded\r\n       *    \r\n       * Note: Cannot simply set it to the loaded keyboard, \r\n       *       as more than one language may be supported by that keyboard.\r\n       */   \r\n      keymanweb['addEventListener']('keyboardloaded',\r\n        function(p) {\r\n          var sk = keymanweb['getSavedKeyboard']().split(':');\r\n          if(sk.length > 1) ui.updateMenu(sk[0],sk[1]);\r\n        });\r\n        \r\n      /**\r\n       * Keyboard change event handler\r\n       *        \r\n       * Update menu selection and control OSK display appropriately\r\n       */\r\n      keymanweb['addEventListener']('keyboardchange',  \r\n        function(p)\r\n        {\r\n          // Update the keyboard selector whenever a keyboard is loaded  \r\n          ui.updateMenu(p['internalName'],p['languageCode']);    \r\n      \r\n          // (Conditionally) display the OSK button, and set the style \r\n          ui.addButtonOSK();        \r\n        });\r\n                      \r\n      /**\r\n       * Show OSK event handler: show or hide the OSK button (never display if a CJK keyboard)\r\n       */                \r\n      osk['addEventListener']('show',\r\n        function(oskPosition)\r\n        {          \r\n          ui.addButtonOSK();    \r\n          return oskPosition; \r\n        }); \r\n\r\n      /**\r\n       * Hide OSK event handler\r\n       */ \r\n      \r\n      osk['addEventListener']('hide',\r\n        function(hiddenByUser)\r\n        {\r\n          if(ui.initialized) ui.oskButtonState(false);\r\n        }); \r\n    }\r\n      \r\n    /**\r\n     * Function     _SelectorMouseDown\r\n     * Scope        Private   \r\n     * @param       {Object}     e      event\r\n     * Description  Set KMW UI activation state on mouse click\r\n     */    \r\n    ui._SelectorMouseDown = function(e)\r\n    { \r\n      if(keymanweb['activatingUI']) keymanweb['activatingUI'](1);\r\n    }\r\n\r\n    /**\r\n     * Function     _SelectorMouseOver\r\n     * Scope        Private\r\n     * @param       {Object}    e       event\r\n     * Description  Set KMW UI activation state on mouse over\r\n     */    \r\n    ui._SelectorMouseOver = function(e)\r\n    {\r\n      if(keymanweb['activatingUI']) keymanweb['activatingUI'](1);\r\n    }\r\n\r\n    /**\r\n     * Function     _SelectorMouseOut\r\n     * Scope        Private\r\n     * @param       {Object}    e       event\r\n     * Description Clear KMW UI activation state on mouse out\r\n     */    \r\n    ui._SelectorMouseOut = function(e)\r\n    {\r\n      if(keymanweb['activatingUI']) keymanweb['activatingUI'](0);\r\n    }\r\n\r\n    /**\r\n     * Function     _SelectKeyboardChange\r\n     * Scope        Private\r\n     * @param       {Object}    e       event\r\n     * Description  Change active keyboard in response to user selection event\r\n     */    \r\n    ui.SelectKeyboardChange = function(e)\r\n    { \r\n      if(ui.KeyboardSelector.value != '-')\r\n      {\r\n        var i=ui.KeyboardSelector.selectedIndex;\r\n        var t=ui.KeyboardSelector.options[i].value.split(':');\r\n        keymanweb['setActiveKeyboard'](t[0],t[1]);\r\n      }\r\n      else\r\n        keymanweb['setActiveKeyboard'](''); \r\n      \r\n      //if(osk['show']) osk['show'](osk['isEnabled']()); handled by keyboard change event???\r\n      keymanweb['focusLastActiveElement']();\r\n      ui.selecting = true;\r\n    }\r\n\r\n    /**\r\n     * Function     _SelectBlur\r\n     * Scope        Private\r\n     * @param       {Object}    e       event\r\n     * Description  Ensure OSK is hidden when moving focus after reselecting a keyboard\r\n     */    \r\n    ui.SelectBlur = function(e)\r\n    {\r\n      if(!ui.selecting) keymanweb['focusLastActiveElement']();\r\n      ui.selecting = false;                                   \r\n    }\r\n    \r\n    /**\r\n     * Function     ShowInterface\r\n     * Scope        Private\r\n     * @param       {number=}    Px    x-position for KMW window\r\n     * @param       {number=}    Py    y-position for KMW window\r\n     * Description  Display KMW window at specified position\r\n     */    \r\n    ui.ShowInterface = function(Px, Py)\r\n    {\r\n      if(!ui.initialized) return;\r\n    \r\n      var Ls = ui.outerDiv.style;   \r\n\r\n      if(Px  &&  Py) {\r\n        Ls.left = Px + 'px';\r\n        Ls.top = Py + 'px';\r\n      }\r\n      Ls.display = 'block';\r\n      \r\n      ui.kbdIcon.style.left = ui.KeyboardSelector.offsetWidth + 24 + 'px';\r\n      \r\n      // (Conditionally) display the OSK button\r\n      ui.addButtonOSK();\r\n          \r\n      // Set the language selection to the currently active keyboard, if listed\r\n      ui.updateMenu(keymanweb['getActiveKeyboard'](),keymanweb['getActiveLanguage']());\r\n    }\r\n      \r\n    /**\r\n     * Function     HideInterface\r\n     * Scope        Private\r\n     * Description  Completely hide KMW window \r\n     */    \r\n    ui.HideInterface = function()\r\n    {\r\n      if(!ui.initialized) return;\r\n      \r\n      ui.outerDiv.style.display = 'none';\r\n    }\r\n\r\n\r\n    /**\r\n     * Function     addButtonOSK\r\n     * Scope        Private\r\n     * Description  Display the OSK button unless a CJK keyboard (or English)\r\n     */            \r\n    ui.addButtonOSK = function()\r\n    {\r\n      if(ui.oskButton != null)\r\n      {\r\n        if(keymanweb['isCJK']() || (ui.KeyboardSelector.selectedIndex==0)) \r\n        {\r\n          ui.oskButton.style.display = 'none';\r\n          ui.outerDiv.style.width = ui.KeyboardSelector.offsetWidth+30+'px';    \r\n        } \r\n        else \r\n        {\r\n          ui.oskButton.style.display = 'block';\r\n          ui.oskButtonState(osk['isEnabled']());\r\n          ui.outerDiv.style.width = ui.KeyboardSelector.offsetWidth+56+'px';\r\n        }      \r\n      }\r\n    }\r\n    //TODO:  had to expose properties of params - what does that do? (focus event doesn't normally include these properties?)  \r\n    keymanweb['addEventListener']('controlfocused',\r\n      function(params)\r\n      {\r\n        if(params['activeControl'] == null || params['activeControl']['_kmwAttachment'])\r\n        {\r\n          /*if(keymanweb._IsIEEditableIframe(Ltarg))\r\n            Ltarg = Ltarg.ownerDocument.parentWindow.frameElement;\r\n          else if(keymanweb.domManager._IsMozillaEditableIframe(Ltarg))\r\n            Ltarg = Ltarg.defaultView.frameElement;*/\r\n          if(ui.floatRight)   // I1296\r\n            ui.ShowInterface(util['getAbsoluteX'](params.target) + params.target.offsetWidth + 1, util['getAbsoluteY'](params.target) + 1);\r\n          else\r\n            ui.ShowInterface(util['getAbsoluteX'](params.target), util['getAbsoluteY'](params.target) \r\n              - parseInt(util['getStyleValue'](ui.outerDiv,'height'),10) - 2);\r\n        }\r\n        return true;\r\n      });               \r\n\r\n    keymanweb['addEventListener']('controlblurred',\r\n      function(params)\r\n      {  \r\n        if(!params['event']) return true;   // I2404 - Manage IE events in IFRAMEs\r\n    \r\n        if(!params['isActivating']) ui.HideInterface();\r\n\r\n        return true;\r\n      });\r\n    \r\n    /**\r\n     * Function     _Resize\r\n     * Scope        Private   \r\n     * @param       {Object}     e      event object\r\n     * @return      {boolean}      \r\n     * Description  Display KMW OSK at specified position (returns nothing) \r\n     */    \r\n    ui._Resize = function(e)\r\n    {\r\n      if(ui.outerDiv.style.display =='block') \r\n      {\r\n        var elem = keymanweb['getLastActiveElement']();\r\n        if(ui.floatRight)   // I1296\r\n          ui.ShowInterface(util['getAbsoluteX'](elem) + elem.offsetWidth + 1, util['getAbsoluteY'](elem) + 1);\r\n        else\r\n          ui.ShowInterface(util['getAbsoluteX'](elem) + 1, util['getAbsoluteY'](elem) + elem.offsetHeight + 1);\r\n      }\r\n      return true;\r\n    }  \r\n    \r\n    if(window.addEventListener)\r\n      window.addEventListener('resize', ui._Resize, false);\r\n\r\n    // Initialize after KMW is fully initialized, if UI already loaded\r\n    keymanweb['addEventListener']('loaduserinterface',ui.Initialize);\r\n    \r\n    // but also call initialization when script loaded, which is after KMW initialization for asynchronous script loading\r\n    ui.Initialize();\r\n    \r\n  } catch(err){}\r\n\r\n  // Do not wrap in an anonymous function - let the closure compiler do that, but\r\n  // use try...catch to avoid script errors and only execute if a desktop browser\r\n}"],"names":["window","keymanweb","util","osk","ui","KeyboardSelector","outerDiv","innerDiv","oskButton","kbdIcon","selecting","updateList","updateTimer","floatRight","initialized","toggleOSK","ui.toggleOSK","event","returnValue","Initialize","ui.Initialize","setTimeout","imgPath","innerHTML","s","style","backgroundColor","border","position","height","font","display","textAlign","overflow","_SelectorMouseDown","_SelectorMouseOver","_SelectorMouseOut","registerEvents","src","title","oskButtonState","Lhdiv","onclick","appendChild","document","body","margin","left","top","maxWidth","SelectKeyboardChange","SelectBlur","opt","dfltKeyboard","Lopt","value","updateKeyboardList","_UnloadUserInterface","ui._UnloadUserInterface","shutdown","ui.shutdown","root","parentNode","removeChild","removeEventListener","_Resize","ui.updateKeyboardList","i","opts","getElementsByTagName","length","Lkbds","Ln","replace","lg","split","search","sk","updateMenu","HideInterface","ShowInterface","ui.updateMenu","kbd","match","selectedIndex","t","ui.oskButtonState","oskEnabled","width","verticalAlign","padding","background","ui.registerEvents","clearTimeout","p","addButtonOSK","oskPosition","ui._SelectorMouseDown","ui._SelectorMouseOver","ui._SelectorMouseOut","ui.SelectKeyboardChange","options","ui.SelectBlur","ui.ShowInterface","Px","Py","Ls","offsetWidth","ui.HideInterface","ui.addButtonOSK","params","target","parseInt","ui._Resize","elem","offsetHeight","addEventListener","err"],"sourceRoot":"/keyman/web/source/"}