(function(){var Ii=Object.create;var Rt=Object.defineProperty;var Qi=Object.getOwnPropertyDescriptor;var Ci=Object.getOwnPropertyNames;var bi=Object.getPrototypeOf,hi=Object.prototype.hasOwnProperty;var En=function(i,t){return function(){return t||i((t={exports:{}}).exports,t),t.exports}},kn=function(i,t){for(var e in t)Rt(i,e,{get:t[e],enumerable:!0})},vt=function(i,t,e,n){if(t&&typeof t=="object"||typeof t=="function")for(var c=Ci(t),l=0,r=c.length,s;l<r;l++)s=c[l],!hi.call(i,s)&&s!==e&&Rt(i,s,{get:function(B){return t[B]}.bind(null,s),enumerable:!(n=Qi(t,s))||n.enumerable});return i},At=function(i,t,e){return vt(i,t,"default"),e&&vt(e,t,"default")},v=function(i,t,e){return e=i!=null?Ii(bi(i)):{},vt(t||!i||!i.__esModule?Rt(e,"default",{value:i,enumerable:!0}):e,i)};var ft=En(function(Fr,lt){var Yn,wn,On,Dn,Mn,it;(function(i){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(n){i(e(t,e(n)))}):typeof lt=="object"&&typeof lt.exports=="object"?i(e(t,e(lt.exports))):i(e(t));function e(n,c){return n!==t&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(l,r){return n[l]=c?c(l,r):r}}})(function(i){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var c in n)Object.prototype.hasOwnProperty.call(n,c)&&(e[c]=n[c])};Yn=function(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");t(e,n);function c(){this.constructor=e}e.prototype=n===null?Object.create(n):(c.prototype=n.prototype,new c)},wn=Object.assign||function(e){for(var n,c=1,l=arguments.length;c<l;c++){n=arguments[c];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},On=function(e,n,c,l){var r=arguments.length,s=r<3?n:l===null?l=Object.getOwnPropertyDescriptor(n,c):l,B;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(e,n,c,l);else for(var o=e.length-1;o>=0;o--)(B=e[o])&&(s=(r<3?B(s):r>3?B(n,c,s):B(n,c))||s);return r>3&&s&&Object.defineProperty(n,c,s),s},Dn=function(e,n,c,l){function r(s){return s instanceof c?s:new c(function(B){B(s)})}return new(c||(c=Promise))(function(s,B){function o(F){try{a(l.next(F))}catch(y){B(y)}}function g(F){try{a(l.throw(F))}catch(y){B(y)}}function a(F){F.done?s(F.value):r(F.value).then(o,g)}a((l=l.apply(e,n||[])).next())})},Mn=function(e,n){var c={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},l,r,s,B;return B={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(B[Symbol.iterator]=function(){return this}),B;function o(a){return function(F){return g([a,F])}}function g(a){if(l)throw new TypeError("Generator is already executing.");for(;B&&(B=0,a[0]&&(c=0)),c;)try{if(l=1,r&&(s=a[0]&2?r.return:a[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,a[1])).done)return s;switch(r=0,s&&(a=[a[0]&2,s.value]),a[0]){case 0:case 1:s=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,r=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(a[0]===6||a[0]===2)){c=0;continue}if(a[0]===3&&(!s||a[1]>s[0]&&a[1]<s[3])){c.label=a[1];break}if(a[0]===6&&c.label<s[1]){c.label=s[1],s=a;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(a);break}s[2]&&c.ops.pop(),c.trys.pop();continue}a=n.call(e,c)}catch(F){a=[6,F],r=0}finally{l=s=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},it=function(e){return this instanceof it?(this.v=e,this):new it(e)},i("__extends",Yn),i("__assign",wn),i("__decorate",On),i("__awaiter",Dn),i("__generator",Mn),i("__await",it)})});var A=En(function(ur,St){"use strict";var xi=Object.prototype.hasOwnProperty,T="~";function Ee(){}Object.create&&(Ee.prototype=Object.create(null),new Ee().__proto__||(T=!1));function Vi(i,t,e){this.fn=i,this.context=t,this.once=e||!1}function zn(i,t,e,n,c){if(typeof e!="function")throw new TypeError("The listener must be a function");var l=new Vi(e,n||i,c),r=T?T+t:t;return i._events[r]?i._events[r].fn?i._events[r]=[i._events[r],l]:i._events[r].push(l):(i._events[r]=l,i._eventsCount++),i}function rt(i,t){--i._eventsCount===0?i._events=new Ee:delete i._events[t]}function W(){this._events=new Ee,this._eventsCount=0}W.prototype.eventNames=function(){var t=[],e,n;if(this._eventsCount===0)return t;for(n in e=this._events)xi.call(e,n)&&t.push(T?n.slice(1):n);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(e)):t};W.prototype.listeners=function(t){var e=T?T+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var c=0,l=n.length,r=new Array(l);c<l;c++)r[c]=n[c].fn;return r};W.prototype.listenerCount=function(t){var e=T?T+t:t,n=this._events[e];return n?n.fn?1:n.length:0};W.prototype.emit=function(t,e,n,c,l,r){var s=T?T+t:t;if(!this._events[s])return!1;var B=this._events[s],o=arguments.length,g,a;if(B.fn){switch(B.once&&this.removeListener(t,B.fn,void 0,!0),o){case 1:return B.fn.call(B.context),!0;case 2:return B.fn.call(B.context,e),!0;case 3:return B.fn.call(B.context,e,n),!0;case 4:return B.fn.call(B.context,e,n,c),!0;case 5:return B.fn.call(B.context,e,n,c,l),!0;case 6:return B.fn.call(B.context,e,n,c,l,r),!0}for(a=1,g=new Array(o-1);a<o;a++)g[a-1]=arguments[a];B.fn.apply(B.context,g)}else{var F=B.length,y;for(a=0;a<F;a++)switch(B[a].once&&this.removeListener(t,B[a].fn,void 0,!0),o){case 1:B[a].fn.call(B[a].context);break;case 2:B[a].fn.call(B[a].context,e);break;case 3:B[a].fn.call(B[a].context,e,n);break;case 4:B[a].fn.call(B[a].context,e,n,c);break;default:if(!g)for(y=1,g=new Array(o-1);y<o;y++)g[y-1]=arguments[y];B[a].fn.apply(B[a].context,g)}}return!0};W.prototype.on=function(t,e,n){return zn(this,t,e,n,!1)};W.prototype.once=function(t,e,n){return zn(this,t,e,n,!0)};W.prototype.removeListener=function(t,e,n,c){var l=T?T+t:t;if(!this._events[l])return this;if(!e)return rt(this,l),this;var r=this._events[l];if(r.fn)r.fn===e&&(!c||r.once)&&(!n||r.context===n)&&rt(this,l);else{for(var s=0,B=[],o=r.length;s<o;s++)(r[s].fn!==e||c&&!r[s].once||n&&r[s].context!==n)&&B.push(r[s]);B.length?this._events[l]=B.length===1?B[0]:B:rt(this,l)}return this};W.prototype.removeAllListeners=function(t){var e;return t?(e=T?T+t:t,this._events[e]&&rt(this,e)):(this._events=new Ee,this._eventsCount=0),this};W.prototype.off=W.prototype.removeListener;W.prototype.addListener=W.prototype.on;W.prefixed=T;W.EventEmitter=W;typeof St!="undefined"&&(St.exports=W)});var d={};kn(d,{tslib:function(){return Ui}});At(d,v(ft(),1));var Ui=v(ft(),1);var ic=v(A(),1);var q={modifierCodes:{LCTRL:1,RCTRL:2,LALT:4,RALT:8,SHIFT:16,CTRL:32,ALT:64,META:128,CAPS:256,NO_CAPS:512,NUM_LOCK:1024,NO_NUM_LOCK:2048,SCROLL_LOCK:4096,NO_SCROLL_LOCK:8192,VIRTUAL_KEY:16384,VIRTUAL_CHAR_KEY:32768},modifierBitmasks:{ALL:127,ALT_GR_SIM:5,CHIRAL:31,IS_CHIRAL:15,NON_CHIRAL:112},stateBitmasks:{ALL:16128,CAPS:768,NUM_LOCK:3072,SCROLL_LOCK:12288},keyCodes:{K_BKSP:8,K_TAB:9,K_ENTER:13,K_SHIFT:16,K_CONTROL:17,K_ALT:18,K_PAUSE:19,K_CAPS:20,K_ESC:27,K_SPACE:32,K_PGUP:33,K_PGDN:34,K_END:35,K_HOME:36,K_LEFT:37,K_UP:38,K_RIGHT:39,K_DOWN:40,K_SEL:41,K_PRINT:42,K_EXEC:43,K_INS:45,K_DEL:46,K_HELP:47,K_0:48,K_1:49,K_2:50,K_3:51,K_4:52,K_5:53,K_6:54,K_7:55,K_8:56,K_9:57,K_A:65,K_B:66,K_C:67,K_D:68,K_E:69,K_F:70,K_G:71,K_H:72,K_I:73,K_J:74,K_K:75,K_L:76,K_M:77,K_N:78,K_O:79,K_P:80,K_Q:81,K_R:82,K_S:83,K_T:84,K_U:85,K_V:86,K_W:87,K_X:88,K_Y:89,K_Z:90,K_NP0:96,K_NP1:97,K_NP2:98,K_NP3:99,K_NP4:100,K_NP5:101,K_NP6:102,K_NP7:103,K_NP8:104,K_NP9:105,K_NPSTAR:106,K_NPPLUS:107,K_SEPARATOR:108,K_NPMINUS:109,K_NPDOT:110,K_NPSLASH:111,K_F1:112,K_F2:113,K_F3:114,K_F4:115,K_F5:116,K_F6:117,K_F7:118,K_F8:119,K_F9:120,K_F10:121,K_F11:122,K_F12:123,K_NUMLOCK:144,K_SCROLL:145,K_LSHIFT:160,K_RSHIFT:161,K_LCONTROL:162,K_RCONTROL:163,K_LALT:164,K_RALT:165,K_COLON:186,K_EQUAL:187,K_COMMA:188,K_HYPHEN:189,K_PERIOD:190,K_SLASH:191,K_BKQUOTE:192,K_LBRKT:219,K_BKSLASH:220,K_RBRKT:221,K_QUOTE:222,K_oE2:226,K_OE2:226,K_LOPT:50001,K_ROPT:50002,K_NUMERALS:50003,K_SYMBOLS:50004,K_CURRENCIES:50005,K_UPPER:50006,K_LOWER:50007,K_ALPHA:50008,K_SHIFTED:50009,K_ALTGR:50010,K_TABBACK:50011,K_TABFWD:50012},codesUS:[["0123456789",";=,-./`","[\\]'"],[")!@#$%^&*(",":+<_>?~",'{|}"']],isKnownOSKModifierKey:function(i){switch(i){case"K_SHIFT":case"K_LOPT":case"K_ROPT":case"K_NUMLOCK":case"K_CAPS":return!0;default:if(q.keyCodes[i]>=5e4)return!0;var t=q[i];if(t>5e4&&t<50011)return!0}return!1},getModifierState:function(i){var t=0;i.indexOf("shift")>=0&&(t|=q.modifierCodes.SHIFT);var e=!1;i.indexOf("leftctrl")>=0&&(t|=q.modifierCodes.LCTRL,e=!0),i.indexOf("rightctrl")>=0&&(t|=q.modifierCodes.RCTRL,e=!0),i.indexOf("ctrl")>=0&&!e&&(t|=q.modifierCodes.CTRL);var n=!1;return i.indexOf("leftalt")>=0&&(t|=q.modifierCodes.LALT,n=!0),i.indexOf("rightalt")>=0&&(t|=q.modifierCodes.RALT,n=!0),i.indexOf("alt")>=0&&!n&&(t|=q.modifierCodes.ALT),t},getStateFromLayer:function(i){var t=0;return i.indexOf("caps")>=0?t|=q.modifierCodes.CAPS:t|=q.modifierCodes.NO_CAPS,t}},I=q;var Ue;(function(i){i.Enter="\n",i.Backspace="\b"})(Ue||(Ue={}));var Gi=function(){function i(){}return i.prototype.codeForEvent=function(t){return I.keyCodes[t.kName]||t.Lcode},i.prototype.forAny=function(t,e,n){var c="";if((c=this.forSpecialEmulation(t))!=null)return c;if(!e&&(c=this.forNumpadKeys(t))!=null)return c;if((c=this.forUnicodeKeynames(t,n))!=null)return c;if((c=this.forBaseKeys(t,n))!=null)return c;var l=this.codeForEvent(t);switch(l){default:return null}},i.prototype.isCommand=function(t){var e=this.codeForEvent(t);switch(e){default:return!1}},i.prototype.applyCommand=function(t,e){},i.prototype.forSpecialEmulation=function(t){var e=this.codeForEvent(t);switch(e){case I.keyCodes.K_BKSP:return Ue.Backspace;case I.keyCodes.K_ENTER:return Ue.Enter;default:return null}},i.prototype.forNumpadKeys=function(t){if(t.Lcode>=I.keyCodes.K_NP0&&t.Lcode<=I.keyCodes.K_NPSLASH){if(t.Lcode<106)var e=t.Lcode-48;else e=t.Lcode-64;var n=String._kmwFromCharCode(e);return n}else return null},i.prototype.forUnicodeKeynames=function(t,e){var n=t.kName;if(!n||n.substr(0,2)!="U_")return null;for(var c="",l=n.substr(2).split("_"),r=0,s=l;r<s.length;r++){var B=s[r],o=parseInt(B,16);if(0<=o&&o<=31||128<=o&&o<=159||isNaN(o)){e&&(e.errorLog="Suppressing Unicode control code in "+n);continue}else c+=String.kmwFromCharCode(o)}return c||null},i.prototype.forBaseKeys=function(t,e){var n=t.Lcode,c=t.Lmodifiers;if(c==I.modifierCodes.SHIFT)c=1;else if(c!=0)return e&&(e.warningLog="KMW only defines default key output for the 'default' and 'shift' layers!"),null;try{if(n==I.keyCodes.K_SPACE)return" ";if(n>=I.keyCodes.K_0&&n<=I.keyCodes.K_9)return I.codesUS[c][0][n-I.keyCodes.K_0];if(n>=I.keyCodes.K_A&&n<=I.keyCodes.K_Z)return String.fromCharCode(n+(c?0:32));if(n>=I.keyCodes.K_COLON&&n<=I.keyCodes.K_BKQUOTE)return I.codesUS[c][1][n-I.keyCodes.K_COLON];if(n>=I.keyCodes.K_LBRKT&&n<=I.keyCodes.K_QUOTE)return I.codesUS[c][2][n-I.keyCodes.K_LBRKT];if(n==I.keyCodes.K_oE2)return c?"|":"\\"}catch(l){e&&(e.errorLog="Error detected with default mapping for key:  code = "+n+", shift state = "+(c==1?"shift":"default"))}return null},i}(),Ve=Gi;var Xi=new Ve,pi=function(){function i(t){this.isSynthetic=!0;for(var e in t)t[e]!==void 0&&(this[e]=t[e])}return i.constructNullKeyEvent=function(t){var e=new i({Lcode:0,kName:"",device:t,Lstates:void 0,Lmodifiers:void 0,vkCode:void 0,LisVirtualKey:void 0});return e},Object.defineProperty(i.prototype,"isModifier",{get:function(){switch(this.Lcode){case 16:case 17:case 18:case 20:case 144:case 145:return!0;default:return!1}},enumerable:!1,configurable:!0}),i.prototype.setMnemonicCode=function(t,e){if(this.Lcode!=I.keyCodes.K_SPACE){var n=new i(this);for(var c in this)n[c]=this[c];n.kName="K_xxxx",n.Lmodifiers=t?16:0;var l=Xi.forAny(n,!0);this.vkCode=this.Lcode,l?this.Lcode=l.charCodeAt(0):this.isModifier||delete this.Lcode}e&&(this.Lcode>=65&&this.Lcode<=90||this.Lcode>=97&&this.Lcode<=122)&&(this.Lmodifiers^=16,this.Lcode^=32)},i}(),$=pi;var Ge=function(){function i(){}return i}(),mi=function(){function i(){this.FF=new Ge,this.Safari=new Ge,this.Opera=new Ge,this.FF.k61=187,this.FF.k59=186,this.FF.k173=189}return i}(),Zi=function(){function i(){this.se=new Ge,this.se.k220=192,this.se.k187=189,this.se.k219=187,this.se.k221=219,this.se.k186=221,this.se.k191=220,this.se.k192=186,this.se.k189=191,this.uk=new Ge,this.uk.k223=192,this.uk.k192=222,this.uk.k222=226,this.uk.k220=220}return i}(),Li=function(){function i(){}return i._usCodeInit=function(){var t=new Ge,e=new Ge;t.k192=96,t.k49=49,t.k50=50,t.k51=51,t.k52=52,t.k53=53,t.k54=54,t.k55=55,t.k56=56,t.k57=57,t.k48=48,t.k189=45,t.k187=61,t.k81=113,t.k87=119,t.k69=101,t.k82=114,t.k84=116,t.k89=121,t.k85=117,t.k73=105,t.k79=111,t.k80=112,t.k219=91,t.k221=93,t.k220=92,t.k65=97,t.k83=115,t.k68=100,t.k70=102,t.k71=103,t.k72=104,t.k74=106,t.k75=107,t.k76=108,t.k186=59,t.k222=39,t.k90=122,t.k88=120,t.k67=99,t.k86=118,t.k66=98,t.k78=110,t.k77=109,t.k188=44,t.k190=46,t.k191=47,e.k192=126,e.k49=33,e.k50=64,e.k51=35,e.k52=36,e.k53=37,e.k54=94,e.k55=38,e.k56=42,e.k57=40,e.k48=41,e.k189=95,e.k187=43,e.k81=81,e.k87=87,e.k69=69,e.k82=82,e.k84=84,e.k89=89,e.k85=85,e.k73=73,e.k79=79,e.k80=80,e.k219=123,e.k221=125,e.k220=124,e.k65=65,e.k83=83,e.k68=68,e.k70=70,e.k71=71,e.k72=72,e.k74=74,e.k75=75,e.k76=76,e.k186=58,e.k222=34,e.k90=90,e.k88=88,e.k67=67,e.k86=86,e.k66=66,e.k78=78,e.k77=77,e.k188=60,e.k190=62,e.k191=63,i._usCharCodes=[t,e]},i._USKeyCodeToCharCode=function(t){return i.usCharCodes[t.Lmodifiers&16?1:0]["k"+t.Lcode]},Object.defineProperty(i,"usCharCodes",{get:function(){return i._usCharCodes||i._usCodeInit(),i._usCharCodes},enumerable:!1,configurable:!0}),i.browserMap=new mi,i.languageMap=new Zi,i}(),de=Li;function ke(i,t,e){e.enumerable=!0}var M=function(){function i(){this.isMnemonic=!1}return Object.defineProperty(i.prototype,"baseKeyID",{get:function(){if(typeof this.id!="undefined")return this.id},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isPadding",{get:function(){return this.sp==10},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"coreID",{get:function(){if(typeof this.id!="undefined"){var t=this.id||"";return this.displayLayer!=this.layer&&(t=t+"+"+this.layer),t}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"elementID",{get:function(){if(typeof this.id!="undefined")return this.displayLayer+"-"+this.coreID},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"baseKeyEvent",{get:function(){return new $(this._baseKeyEvent)},enumerable:!1,configurable:!0}),i.unicodeIDToText=function(t,e){if(!t||t.substring(0,2)!="U_")return null;for(var n="",c=t.substring(2).split("_"),l=0,r=c;l<r.length;l++){var s=r[l],B=parseInt(s,16);if(0<=B&&B<=31||128<=B&&B<=159||isNaN(B)){e&&e(s);continue}else n+=String.kmwFromCharCode(B)}return n||null},i.sanitize=function(t){typeof t.width=="string"&&(t.width=parseInt(t.width,10)),t.width||(t.width=i.DEFAULT_KEY_WIDTH),typeof t.pad=="string"&&(t.pad=parseInt(t.pad,10)),t.pad||(t.pad=i.DEFAULT_PAD),typeof t.sp=="string"&&(t.sp=Number.parseInt(t.sp,10)),t.sp||(t.sp=0)},i.polyfill=function(t,e,n,c){var l=new i,r=Object.getPrototypeOf(l);for(var s in l)if(!t.hasOwnProperty(s)){var B=Object.getOwnPropertyDescriptor(r,s);B?Object.defineProperty(t,s,B):t[s]=l[s]}if(t.sk)for(var o=0,g=t.sk;o<g.length;o++){var a=g[o];i.polyfill(a,e,n,c)}var F=t;F.displayLayer=c,F.layer=F.layer||c,F.constructBaseKeyEvent(e,n,c)},i.prototype.constructBaseKeyEvent=function(t,e,n){var c=this.layer||n||"",l=this.id?this.id.toUpperCase():null,r={Lmodifiers:I.getModifierState(c),Lstates:I.getStateFromLayer(c),Lcode:l?I.keyCodes[l]:0,LisVirtualKey:!0,vkCode:0,kName:l,kLayer:c,kbdLayer:n,kNextLayer:this.nextlayer,device:null,isSynthetic:!0},s=new $(r);if(e.keyboard){var B=e.keyboard;B.isMnemonic&&!(e.isDefault&&e.formFactor!="desktop")?s.Lcode!=I.keyCodes.K_SPACE&&(s.vkCode=s.Lcode,this.isMnemonic=!0):s.vkCode=s.Lcode,B.definesPositionalOrMnemonic||(s.Lcode=de._USKeyCodeToCharCode(B.constructKeyEvent(null,null,{K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1})),s.LisVirtualKey=!1)}this._baseKeyEvent=s},i.prototype.getSubkey=function(t){if(this.sk)for(var e=0,n=this.sk;e<n.length;e++){var c=n[e];if(c.coreID==t)return c}return null},i.DEFAULT_PAD=15,i.DEFAULT_RIGHT_MARGIN=15,i.DEFAULT_KEY_WIDTH=100,i.DEFAULT_KEY={text:"",width:i.DEFAULT_KEY_WIDTH,sp:0,pad:i.DEFAULT_PAD},(0,d.__decorate)([ke],i.prototype,"baseKeyID",null),(0,d.__decorate)([ke],i.prototype,"isPadding",null),(0,d.__decorate)([ke],i.prototype,"coreID",null),(0,d.__decorate)([ke],i.prototype,"elementID",null),(0,d.__decorate)([ke],i.prototype,"baseKeyEvent",null),i}();var Kn=function(){function i(){}return i.sanitize=function(t){for(var e=0,n=t.key;e<n.length;e++){var c=n[e];c==null?t.key.length=t.key.length-1:M.sanitize(c)}typeof t.id=="string"&&(t.id=Number.parseInt(t.id,10))},i.polyfill=function(t,e,n,c,l,r){for(var s=t.key,B=0;B<s.length;B++){var o=s[B];for(var g in M.DEFAULT_KEY)typeof o[g]!="string"&&typeof o[g]!="number"&&(o[g]=M.DEFAULT_KEY[g]);switch(o.sp){case"1":!i.SPECIAL_LABEL.test(o.text)&&o.text!=""&&(o.sp="3");break;case"2":!i.SPECIAL_LABEL.test(o.text)&&o.text!=""&&(o.sp="4");break}M.polyfill(o,e,n,c)}for(var a=function(U,V,X,L){U.proportionalPad=V,U.proportionalWidth=X,U.proportionalX=L+V+X/2},F=0,B=0;B<s.length-1;B++){var o=s[B];a(o,o.pad/l,o.width/l,F),F+=o.proportionalPad,F+=o.proportionalWidth}var y=M.DEFAULT_RIGHT_MARGIN/l;if(s.length>0){var u=s[s.length-1];if(s.length==1&&u.pad<0){var Q=u.width/l,C=1-(F+Q+y);a(u,C,Q,F)}else{var C=u.pad/l,Q=1-(F+C+y);a(u,C,Q,F)}}var h=new i;for(var o in h)t.hasOwnProperty(o)||(t[o]=h[o]);var b=t;b.proportionalY=r},i.prototype.populateKeyMap=function(t){this.key.forEach(function(e){e.coreID&&(t[e.coreID]=e)})},i.SPECIAL_LABEL=/\*\w+\*/,i}();var _n=function(){function i(){}return i.sanitize=function(t){for(var e=0,n=t.row;e<n.length;e++){var c=n[e];Kn.sanitize(c)}},i.polyfill=function(t,e,n){t.aligned=!1;for(var c=t.row,l=0,r=0,s=c;r<s.length;r++){for(var B=s[r],o=0,g=B.key,a=0,F=g;a<F.length;a++){var y=F[a];o+=y.width+y.pad}o>l&&(l=o)}n.formFactor=="desktop"?l+=5:l+=M.DEFAULT_RIGHT_MARGIN;for(var u=t.row.length,Q=0;Q<u;Q++){var C=(Q+.5)/u;Kn.polyfill(t.row[Q],e,n,t.id,l,C)}var h=new i;for(var y in h)t.hasOwnProperty(y)||(t[y]=h[y]);var b=t;b.totalWidth=l,b.defaultKeyProportionalWidth=M.DEFAULT_KEY.width/l,b.rowProportionalHeight=1/u,b.keyMap=b.constructKeyMap()},i.prototype.constructKeyMap=function(){var t={};return this.row.forEach(function(e){e.populateKeyMap(t)}),t},i.prototype.getTouchProbabilities=function(t,e){var n=this.simpleTouchDistribution(t,e),c=[];for(var l in n)c.push({keyId:l,p:n[l]});return c.sort(function(r,s){return s.p-r.p})},i.prototype.simpleTouchDistribution=function(t,e){var n=this.keyTouchDistances(t,e),c={},l=0;for(var r in n)l+=c[r]=1/(Math.pow(n[r],2)+1e-6);for(var r in c)c[r]/=l;return c},i.prototype.keyTouchDistances=function(t,e){var n=this,c={};return this.row.forEach(function(l){l.key.forEach(function(r){if(r.baseKeyID){if(I.isKnownOSKModifierKey(r.baseKeyID))return;if(r.isPadding)return}else return;var s=Math.abs(t.x-r.proportionalX),B=Math.abs(t.y-l.proportionalY),o,g;s>.5*r.proportionalWidth?(o=s-.5*r.proportionalWidth,s=.5):(o=0,s/=r.proportionalWidth),B>.5*n.rowProportionalHeight?(g=B-.5*n.rowProportionalHeight,B=.5):(g=0,B/=n.rowProportionalHeight),o*=e,o+=s*n.rowProportionalHeight,g+=B*n.rowProportionalHeight;var a=o*o+g*g;c[r.coreID]=a})}),c},i.prototype.getKey=function(t){t.indexOf(this.id+"-")==0&&(t=t.replace(this.id+"-",""));var e=t.split("::");if(e.length>1){var n=this.keyMap[e[0]];return n.getSubkey(e[1])}else return this.keyMap[t]},i}();var st=function(){function i(){}return i.prototype.getLayer=function(t){return this.layerMap[t]},i.correctLayerEmptyRowBug=function(t){for(var e=0;e<t.length;e++){var n=t[e],c=n.row,l=void 0;for(l=c.length-1;l>=0;l--)(!Array.isArray(c[l].key)||c[l].key.length==0)&&c.splice(l,1)}},i.sanitize=function(t){i.correctLayerEmptyRowBug(t.layer);for(var e=0,n=t.layer;e<n.length;e++){var c=n[e];_n.sanitize(c)}},i.polyfill=function(t,e,n){if(t==null)throw new Error("Cannot build an ActiveLayout for a null specification.");this.sanitize(t);var c,l={},r=t.layer,s=new i;for(var B in s)t.hasOwnProperty(B)||(t[B]=s[B]);var o=t;for(o.keyboard=e,o.formFactor=n,c=0;c<r.length;c++)_n.polyfill(r[c],e,o),l[r[c].id]=r[c];return o.layerMap=l,o},i}();function Re(i,t){var e=t||{};for(var n in i)typeof i[n]=="object"&&i[n]!=null?(e[n]=i[n].constructor===Array?[]:{},Re(i[n],e[n])):e[n]=i[n];return e}var Ye=function(){function i(t,e,n,c){switch(t.toLowerCase()){case i.Browser.Chrome:case i.Browser.Edge:case i.Browser.Firefox:case i.Browser.Native:case i.Browser.Opera:case i.Browser.Safari:this.browser=t.toLowerCase();break;default:this.browser=i.Browser.Other}switch(e.toLowerCase()){case i.FormFactor.Desktop:case i.FormFactor.Phone:case i.FormFactor.Tablet:this.formFactor=e.toLowerCase();break;default:throw"Invalid form factor specified for device: "+e}switch(n.toLowerCase()){case i.OperatingSystem.Windows.toLowerCase():case i.OperatingSystem.macOS.toLowerCase():case i.OperatingSystem.Linux.toLowerCase():case i.OperatingSystem.Android.toLowerCase():case i.OperatingSystem.iOS.toLowerCase():this.OS=n.toLowerCase();break;default:this.OS=i.OperatingSystem.Other}this.touchable=c}return i}();(function(i){var t;(function(c){c.Chrome="chrome",c.Edge="edge",c.Firefox="firefox",c.Native="native",c.Opera="opera",c.Safari="safari",c.Other="other"})(t=i.Browser||(i.Browser={}));var e;(function(c){c.Windows="windows",c.macOS="macosx",c.Linux="linux",c.Android="android",c.iOS="ios",c.Other="other"})(e=i.OperatingSystem||(i.OperatingSystem={}));var n;(function(c){c.Desktop="desktop",c.Phone="phone",c.Tablet="tablet"})(n=i.FormFactor||(i.FormFactor={}))})(Ye||(Ye={}));function Ht(i){return new Ye(i.browser,Ye.FormFactor.Desktop,i.OS,!1)}var x=Ye;var Wt=function(){function i(){}return i.VERSION="17.0.131",i.VERSION_RELEASE="17.0",i.VERSION_MAJOR="17",i.VERSION_MINOR="0",i.VERSION_PATCH="131",i.TIER="alpha",i.VERSION_TAG="-alpha",i.VERSION_WITH_TAG="17.0.131-alpha",i.VERSION_ENVIRONMENT="alpha",i.VERSION_GIT_TAG="release@17.0.131-alpha",i}();var we=Wt;var Ji=function(){function i(t){if(t==null){this.components=[].concat(i.DEVELOPER_VERSION_FALLBACK.components);return}if(Array.isArray(t)){var e=t;if(e.length<2)throw new Error("Version string must have at least a major and minor component!");this.components=[].concat(e);return}var n=t.split("."),c=[];if(n.length<2)throw new Error("Version string must have at least a major and minor component!");for(var l=0;l<n.length;l++){var r=parseInt(n[l],10);if(isNaN(r))throw new Error("Version string components must be numerical!");c.push(r)}this.components=c}return Object.defineProperty(i.prototype,"major",{get:function(){return this.components[0]},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minor",{get:function(){return this.components[1]},enumerable:!1,configurable:!0}),i.prototype.toString=function(){return this.components.join(".")},i.prototype.toJSON=function(){return this.toString()},i.prototype.equals=function(t){return this.compareTo(t)==0},i.prototype.precedes=function(t){return this.compareTo(t)<0},i.prototype.compareTo=function(t){var e=this.components.length<t.components.length,n=this.components.length<t.components.length?this.components.length:t.components.length,c;for(c=0;c<n;c++){var l=this.components[c]-t.components[c];if(l!=0)return l}var r=e?t.components:this.components;do{if(r[c]>0)return e?-1:1;c++}while(c<r.length);return 0},i.CURRENT=new i(we.VERSION_RELEASE),i.DEVELOPER_VERSION_FALLBACK=new i([9,0,0]),i.NO_DEFAULT_KEYCAPS=new i([12,0]),i.MAC_POSSIBLE_IPAD_ALIAS=new i([10,15]),i}(),z=Ji;function Ae(){return typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof self!="undefined"?self:global}function Oe(){String.kmwFromCharCode=function(i){var t=[],e;for(e=0;e<arguments.length;e++){var n=Number(arguments[e]);if(!isFinite(n)||n<0||n>1114111||Math.floor(n)!==n)throw new RangeError("Invalid code point "+n);n<65536?t.push(n):(n-=65536,t.push((n>>10)+55296),t.push(n%1024+56320))}return String.fromCharCode.apply(void 0,t)},String.prototype.kmwCharCodeAt=function(i){var t=String(this),e=0;if(i<0||i>=t.length)return NaN;for(var n=0;n<i;n++)if(e=t.kmwNextChar(e),e===null)return NaN;var c=t.charCodeAt(e);if(c>=55296&&c<=56319&&t.length>e+1){var l=t.charCodeAt(e+1);if(l>=56320&&l<=57343)return(c-55296<<10)+(l-56320)+65536}return c},String.prototype.kmwIndexOf=function(i,t){var e=String(this),n=e.indexOf(i,t);if(n<0)return n;for(var c=0,l=0;l!==null&&l<n;l=e.kmwNextChar(l))c++;return c},String.prototype.kmwLastIndexOf=function(i,t){var e=String(this),n=e.lastIndexOf(i,t);if(n<0)return n;for(var c=0,l=0;l!==null&&l<n;l=e.kmwNextChar(l))c++;return c},String.prototype.kmwLength=function(){var i=String(this);if(i.length==0)return 0;for(var t=0,e=0;e!==null;t++)e=i.kmwNextChar(e);return t},String.prototype.kmwSlice=function(i,t){var e=String(this),n=e.kmwCodePointToCodeUnit(i),c=e.kmwCodePointToCodeUnit(t);return n===null||c===null?"":e.slice(n,c)},String.prototype.kmwSubstr=function(i,t){var e=String(this);i<0&&(i=e.kmwLength()+i),i<0&&(i=0);var n=e.kmwCodePointToCodeUnit(i),c=n;if(n===null)return"";if(arguments.length<2)c=e.length;else for(var l=0;l<t;l++)c=e.kmwNextChar(c);return c===null?e.substring(n):e.substring(n,c)},String.prototype.kmwSubstring=function(i,t){var e=String(this),n,c;if(typeof t=="undefined")n=e.kmwCodePointToCodeUnit(i),c=e.length;else{if(i>t){var l=i;i=t,t=l}n=e.kmwCodePointToCodeUnit(i),c=e.kmwCodePointToCodeUnit(t)}return(isNaN(n)||n===null)&&(n=0),(isNaN(c)||c===null)&&(c=e.length),e.substring(n,c)},String.prototype.kmwNextChar=function(i){var t=String(this);if(i===null||i<0||i>=t.length-1)return null;var e=t.charCodeAt(i);if(e>=55296&&e<=56319&&t.length>i+1){var n=t.charCodeAt(i+1);if(n>=56320&&n<=57343)return i==t.length-2?null:i+2}return i+1},String.prototype.kmwPrevChar=function(i){var t=String(this);if(i==null||i<=0||i>t.length)return null;var e=t.charCodeAt(i-1);if(e>=56320&&e<=57343&&i>1){var n=t.charCodeAt(i-2);if(n>=55296&&n<=56319)return i-2}return i-1},String.prototype.kmwCodePointToCodeUnit=function(i){if(i===null)return null;var t=String(this),e=0;if(i<0){e=t.length;for(var n=0;n>i;n--)e=t.kmwPrevChar(e);return e}if(i==t.kmwLength())return t.length;for(var n=0;n<i;n++)e=t.kmwNextChar(e);return e},String.prototype.kmwCodeUnitToCodePoint=function(i){var t=String(this);return i===null?null:i==0?0:i<0?t.substr(i).kmwLength():t.substr(0,i).kmwLength()},String.prototype.kmwCharAt=function(i){var t=String(this);return i>=0?t.kmwSubstr(i,1):""},String.prototype.kmwBMPNextChar=function(i){var t=String(this);return i<0||i>=t.length-1?null:i+1},String.prototype.kmwBMPPrevChar=function(i){var t=String(this);return i<=0||i>t.length?null:i-1},String.prototype.kmwBMPCodePointToCodeUnit=function(i){return i},String.prototype.kmwBMPCodeUnitToCodePoint=function(i){return i},String.prototype.kmwBMPLength=function(){var i=String(this);return i.length},String.prototype.kmwBMPSubstr=function(i,t){var e=String(this);return i>-1?e.substr(i,t):e.substr(e.length+i,-i)},String.kmwEnableSupplementaryPlane=function(i){var t=String.prototype;String._kmwFromCharCode=i?String.kmwFromCharCode:String.fromCharCode,t._kmwCharAt=i?t.kmwCharAt:t.charAt,t._kmwCharCodeAt=i?t.kmwCharCodeAt:t.charCodeAt,t._kmwIndexOf=i?t.kmwIndexOf:t.indexOf,t._kmwLastIndexOf=i?t.kmwLastIndexOf:t.lastIndexOf,t._kmwSlice=i?t.kmwSlice:t.slice,t._kmwSubstring=i?t.kmwSubstring:t.substring,t._kmwSubstr=i?t.kmwSubstr:t.kmwBMPSubstr,t._kmwLength=i?t.kmwLength:t.kmwBMPLength,t._kmwNextChar=i?t.kmwNextChar:t.kmwBMPNextChar,t._kmwPrevChar=i?t.kmwPrevChar:t.kmwBMPPrevChar,t._kmwCodePointToCodeUnit=i?t.kmwCodePointToCodeUnit:t.kmwBMPCodePointToCodeUnit,t._kmwCodeUnitToCodePoint=i?t.kmwCodeUnitToCodePoint:t.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}Oe();var vi=function(){function i(t){var e=this;this._hasResolved=!1,this._hasRejected=!1,this._promise=new Promise(function(n,c){e.resolve=function(l){e._hasResolved=!0,n(l)},e.reject=function(l){e._hasRejected=!0,c(l)},t&&t(e.resolve,e.reject)})}return Object.defineProperty(i.prototype,"hasResolved",{get:function(){return this._hasResolved},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasRejected",{get:function(){return this._hasRejected},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasFinalized",{get:function(){return this.hasResolved||this.hasRejected},enumerable:!1,configurable:!0}),i.prototype.then=function(t,e){return this._promise.then(t,e)},i.prototype.catch=function(t){return this._promise.catch(t)},i.prototype.finally=function(t){return this._promise.finally(t)},Object.defineProperty(i.prototype,"corePromise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),i}(),R=vi;var ee=function(){function i(){}return i.buildDefaultLayout=function(t,e,n){var c=n;typeof i.dfltLayout[c]!="object"&&(c="desktop");var l=I.modifierBitmasks.NON_CHIRAL,r=z.CURRENT;e&&(l=e.modifierBitmask,r=e.compilerVersion),t||(t=this.DEFAULT_RAW_SPEC);var s=Re(i.dfltLayout[c]),B,o=s.layer,g=t.KLS,a=t.K102,F,y,u,Q,C,h,b,U,V=(l&I.modifierBitmasks.IS_CHIRAL)!=0;if(t.F){var X=/^(?:(?:italic|bold) )* *[0-9.eE-]+(?:[a-z]+) "(.+)"$/.exec(t.F);X&&(s.font=X[1])}var L=!(typeof g=="undefined"||!g);L||(g=t.KLS=i.processLegacyDefinitions(t.BK));var P=/\*\w+\*/,p=Object.getOwnPropertyNames(g),E=[];if(p.splice(p.indexOf("default"),1),p=["default"].concat(p),e&&e.emulatesAltGr&&(p.indexOf("leftctrl-leftalt")==-1&&p.indexOf("rightalt")!=-1&&(p.push("leftctrl-leftalt"),g["leftctrl-leftalt"]=g.rightalt),p.indexOf("leftctrl-leftalt-shift")==-1&&p.indexOf("rightalt-shift")!=-1&&(p.push("leftctrl-leftalt-shift"),g["leftctrl-leftalt-shift"]=g["rightalt-shift"])),s.displayUnderlying=e?!!e.scriptObject.KDU:!1,n=="desktop")for(E=i.generateLayerIds(V),B=0;B<E.length;B++)p.indexOf(E[B])!=-1&&E.splice(B--,1);var oe=p.concat(E);if(L&&n!="desktop"){var S=null;h=o[0].row;for(var he=0;he<h.length;he++){U=h[he].key;for(var k=0;k<U.length;k++)b=U[k],b.id=="K_SHIFT"&&(S=b)}if(S){S.sk=[];for(var j in g)if(!(j=="default"||j=="shift")){var ae=i.modifierSpecials[j],Lt={id:"K_"+ae,text:ae,sp:"1",nextlayer:j};S.sk.push(Lt)}}else console.warn("Error in default layout - cannot find default Shift key!")}for(B=0;B<oe.length;B++)B>0&&(o[B]=Re(o[0])),o[B].id=oe[B],o[B].nextlayer=oe[B],i.formatDefaultLayer(o[B],V,n,!!a);for(B=0;B<o.length;B++){var Y=o[B],ge,S=null,nt=null,Te="",Hn=null,Wn=null,Nn=null,ct=g[Y.id],Jt=Y.id=="shift"?1:0,Tn=Y.id=="default"||Jt?1:0;for(h=Y.row,F=0;F<h.length;F++)for(U=h[F].key,y=0;y<U.length;y++){switch(b=U[y],ge=i.dfltCodes.indexOf(b.id),(ct||Tn)&&(ct&&ge>=0&&ge<ct.length&&(b.text=ct[ge]),Tn&&r.precedes(z.NO_DEFAULT_KEYCAPS)&&b.id!="K_SPACE"&&ge+65*Jt<i.dfltText.length&&b.text!==null&&(b.text=b.text||i.dfltText[ge+65*Jt])),b.text!==null&&(b.text=b.text||""),b.id){case"K_SHIFT":S=b;break;case"K_TAB":nt=b;break;case"K_CAPS":Hn=b;break;case"K_NUMLOCK":Wn=b;break;case"K_SCROLL":Nn=b;break}if(b.sk!=null){for(u=0;u<b.sk.length;u++)p.indexOf(b.sk[u].nextlayer)==-1&&b.sk.splice(u--,1);b.sk.length==0&&(b.sk=null)}}Y.shiftKey=S,Y.capsKey=Hn,Y.numKey=Wn,Y.scrollKey=Nn,n!="desktop"&&B>0&&S!=null&&(S.sp=i.buttonClasses["SHIFT-ON"],S.sk=null,S.text=i.modifierSpecials[o[B].id]?i.modifierSpecials[o[B].id]:"*Shift*")}return s},i.getLayerId=function(t){var e=I.modifierCodes,n="";return t==0?"default":(t&e.LCTRL&&(n=(n.length>0?n+"-":"")+"leftctrl"),t&e.RCTRL&&(n=(n.length>0?n+"-":"")+"rightctrl"),t&e.LALT&&(n=(n.length>0?n+"-":"")+"leftalt"),t&e.RALT&&(n=(n.length>0?n+"-":"")+"rightalt"),t&e.SHIFT&&(n=(n.length>0?n+"-":"")+"shift"),t&e.CTRL&&(n=(n.length>0?n+"-":"")+"ctrl"),t&e.ALT&&(n=(n.length>0?n+"-":"")+"alt"),n)},i.generateLayerIds=function(t){var e,n;t?(e=32,n=1):(e=8,n=16);for(var c=[],l=0;l<e;l++)c.push(i.getLayerId(l*n));return c},i.formatDefaultLayer=function(t,e,n,c){for(var l=t.id,r=i.buttonClasses,s=0;s<t.row.length;s++)for(var B=t.row[s],o=B.key,g=0;g<o.length;g++){var a=o[g];switch(a.id){case"K_SHIFT":case"K_LSHIFT":case"K_RSHIFT":l.indexOf("shift")!=-1&&(a.sp=r["SHIFT-ON"]),n!="desktop"&&(l!="default"?a.nextlayer="default":a.nextlayer="shift");break;case"K_LCTRL":case"K_LCONTROL":if(e){l.indexOf("leftctrl")!=-1&&(a.sp=r["SHIFT-ON"]);break}case"K_RCTRL":case"K_RCONTROL":if(e){l.indexOf("rightctrl")!=-1&&(a.sp=r["SHIFT-ON"]);break}case"K_CONTROL":l.indexOf("ctrl")!=-1&&(!e||l.indexOf("leftctrl")!=-1&&l.indexOf("rightctrl")!=-1)&&(a.sp=r["SHIFT-ON"]);break;case"K_LALT":if(e){l.indexOf("leftalt")!=-1&&(a.sp=r["SHIFT-ON"]);break}case"K_RALT":if(e){l.indexOf("rightalt")!=-1&&(a.sp=r["SHIFT-ON"]);break}case"K_ALT":l.indexOf("alt")!=-1&&(!e||l.indexOf("leftalt")!=-1&&l.indexOf("rightalt")!=-1)&&(a.sp=r["SHIFT-ON"]);break;case"K_oE2":(typeof c=="undefined"||!c)&&(n=="desktop"?(o.splice(g--,1),o[0].width="200"):o[g].sp=r.HIDDEN);break}}},i.processLegacyDefinitions=function(t){for(var e=i.generateLayerIds(!1),n={},c=0;c<e.length;c++){for(var l=e[c],r=[],s=!1,B=0;B<65;B++){var o=B+65*c;r.push(t[o]),o<t.length&&t[o]!=""&&B!=i.dfltCodes.indexOf("K_SPACE")&&(s=!0)}s&&(n[l]=r)}return(typeof n.default=="undefined"||!n.default)&&(n.default=[""]),(typeof n.shift=="undefined"||!n.shift)&&(n.shift=[""]),n},i.dfltCodes=["K_BKQUOTE","K_1","K_2","K_3","K_4","K_5","K_6","K_7","K_8","K_9","K_0","K_HYPHEN","K_EQUAL","K_*","K_*","K_*","K_Q","K_W","K_E","K_R","K_T","K_Y","K_U","K_I","K_O","K_P","K_LBRKT","K_RBRKT","K_BKSLASH","K_*","K_*","K_*","K_A","K_S","K_D","K_F","K_G","K_H","K_J","K_K","K_L","K_COLON","K_QUOTE","K_*","K_*","K_*","K_*","K_*","K_oE2","K_Z","K_X","K_C","K_V","K_B","K_N","K_M","K_COMMA","K_PERIOD","K_SLASH","K_*","K_*","K_*","K_*","K_*","K_SPACE"],i.dfltText="`1234567890-=\xA7~~qwertyuiop[]\\~~~asdfghjkl;'~~~~~?zxcvbnm,./~~~~~ ~!@#$%^&*()_+\xA7~~QWERTYUIOP{}\\~~~ASDFGHJKL:\"~~~~~?ZXCVBNM<>?~~~~~ ",i.DEFAULT_RAW_SPEC={F:"Tahoma",BK:i.dfltText},i.buttonClasses={DEFAULT:0,SHIFT:1,"SHIFT-ON":2,SPECIAL:3,"SPECIAL-ON":4,DEADKEY:8,BLANK:9,HIDDEN:10},i.modifierSpecials={leftalt:"*LAlt*",rightalt:"*RAlt*",alt:"*Alt*",leftctrl:"*LCtrl*",rightctrl:"*RCtrl*",ctrl:"*Ctrl*","ctrl-alt":"*AltGr*","leftctrl-leftalt":"*LAltCtrl*","rightctrl-rightalt":"*RAltCtrl*","leftctrl-leftalt-shift":"*LAltCtrlShift*","rightctrl-rightalt-shift":"*RAltCtrlShift*",shift:"*Shift*","shift-alt":"*AltShift*","shift-ctrl":"*CtrlShift*","shift-ctrl-alt":"*AltCtrlShift*","leftalt-shift":"*LAltShift*","rightalt-shift":"*RAltShift*","leftctrl-shift":"*LCtrlShift*","rightctrl-shift":"*RCtrlShift*"},i.dfltLayout={desktop:{font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:"1",key:[{id:"K_BKQUOTE"},{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{id:"K_BKSP",text:"*BkSp*",sp:"1",width:"130"}]},{id:"2",key:[{id:"K_TAB",text:"*Tab*",sp:"1",width:"130"},{id:"K_Q"},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{id:"K_BKSLASH"}]},{id:"3",key:[{id:"K_CAPS",text:"*Caps*",sp:"1",width:"165"},{id:"K_A"},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_ENTER",text:"*Enter*",sp:"1",width:"165"}]},{id:"4",key:[{id:"K_SHIFT",text:"*Shift*",sp:"1",width:"130"},{id:"K_oE2"},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_RSHIFT",text:"*Shift*",sp:"1",width:"130"}]},{id:"5",key:[{id:"K_LCONTROL",text:"*Ctrl*",sp:"1",width:"170"},{id:"K_LALT",text:"*Alt*",sp:"1",width:"160"},{id:"K_SPACE",text:"",width:"770"},{id:"K_RALT",text:"*Alt*",sp:"1",width:"160"},{id:"K_RCONTROL",text:"*Ctrl*",sp:"1",width:"170"}]}]}]},tablet:{font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:"0",key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:"10",width:"1"}]},{id:"1",key:[{id:"K_Q",pad:"25"},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:"10",width:"1"}]},{id:"2",key:[{id:"K_A",pad:"50"},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:"90"}]},{id:"3",key:[{id:"K_oE2",width:"90"},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:"10",width:"1"}]},{id:"4",key:[{id:"K_SHIFT",text:"*Shift*",sp:"1",width:"200",sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:"1",width:"50",nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:"1",width:"50",nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:"1",width:"50",nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:"1",width:"50",nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:"1",width:"50",nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:"1",width:"50",nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:"1",width:"50",nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",sp:"1",width:"150"},{id:"K_SPACE",text:"",width:"570"},{id:"K_BKSP",text:"*BkSp*",sp:"1",width:"150"},{id:"K_ENTER",text:"*Enter*",sp:"1",width:"200"}]}]}]},phone:{font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:"0",key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:"10",width:"1"}]},{id:"1",key:[{id:"K_Q",pad:"25"},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:"10",width:"1"}]},{id:"2",key:[{id:"K_A",pad:"50"},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:"90"}]},{id:"3",key:[{id:"K_oE2",width:"90"},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:"10",width:"1"}]},{id:"4",key:[{id:"K_SHIFT",text:"*Shift*",sp:"1",width:"200",sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:"1",width:"50",nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:"1",width:"50",nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:"1",width:"50",nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:"1",width:"50",nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:"1",width:"50",nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:"1",width:"50",nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:"1",width:"50",nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",width:"150",sp:"1"},{id:"K_SPACE",width:"570",text:""},{id:"K_BKSP",text:"*BkSp*",width:"150",sp:"1"},{id:"K_ENTER",text:"*Enter*",width:"200",sp:"1"}]}]}]}},i}();var Ri=function(){function i(){this.stores={}}return i}(),Xe;(function(i){i[i.NOT_LOADED=void 0]="NOT_LOADED",i[i.POLYFILLED=1]="POLYFILLED",i[i.CALIBRATED=2]="CALIBRATED"})(Xe||(Xe={}));var Ai=function(){function i(t){t?this.scriptObject=t:this.scriptObject=i.DEFAULT_SCRIPT_OBJECT,this.layoutStates={}}return i.prototype.process=function(t,e){return this.scriptObject.gs(t,e)},i.prototype.processNewContextEvent=function(t,e){return this.scriptObject.gn?this.scriptObject.gn(t,e):!1},i.prototype.processPostKeystroke=function(t,e){return this.scriptObject.gpk?this.scriptObject.gpk(t,e):!1},Object.defineProperty(i.prototype,"isHollow",{get:function(){return this.scriptObject==i.DEFAULT_SCRIPT_OBJECT},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this.scriptObject.KI},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this.scriptObject.KN},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"variableStores",{get:function(){var t=this.scriptObject.KVS,e={};if(Array.isArray(t))for(var n=0,c=t;n<c.length;n++){var l=c[n];e[l]=this.scriptObject[l]}return e},set:function(t){var e=this.scriptObject.KVS;if(Array.isArray(e))for(var n=0,c=e;n<c.length;n++){var l=c[n];typeof t[l]=="string"&&(this.scriptObject[l]=t[l])}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_legacyLayoutSpec",{get:function(){return this.scriptObject.KV},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_layouts",{get:function(){return this.scriptObject.KVKL},set:function(t){this.scriptObject.KVKL=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"compilerVersion",{get:function(){return new z(this.scriptObject.KVER)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isMnemonic",{get:function(){return!!this.scriptObject.KM},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"definesPositionalOrMnemonic",{get:function(){return typeof this.scriptObject.KM!="undefined"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"helpText",{get:function(){return this.scriptObject.KH},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasScript",{get:function(){return!!this.scriptObject.KHF},enumerable:!1,configurable:!0}),i.prototype.embedScript=function(t){this.scriptObject.KHF(t)},Object.defineProperty(i.prototype,"oskStyling",{get:function(){return this.scriptObject.KCSS},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isCJK",{get:function(){var t;return typeof this.scriptObject.KLC!="undefined"?t=this.scriptObject.KLC:typeof this.scriptObject.LanguageCode!="undefined"&&(t=this.scriptObject.LanguageCode),t=="cmn"||t=="jpn"||t=="kor"},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isRTL",{get:function(){return!!this.scriptObject.KRTL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"modifierBitmask",{get:function(){return this.scriptObject.KMBM||I.modifierBitmasks.NON_CHIRAL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isChiral",{get:function(){return!!(this.modifierBitmask&I.modifierBitmasks.IS_CHIRAL)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"desktopFont",{get:function(){return this.scriptObject.KV?this.scriptObject.KV.F:null},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cacheTag",{get:function(){var t=this.scriptObject._kmw;return t||(t=new Ri,this.scriptObject._kmw=t),t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"explodedStores",{get:function(){return this.cacheTag.stores},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"emulatesAltGr",{get:function(){var t=I.modifierCodes;if(!this.isChiral||this._legacyLayoutSpec==null)return!1;var e=this._legacyLayoutSpec.KLS;if(!e)return!1;var n=t.LCTRL|t.LALT,c=e[ee.getLayerId(n)],l=e[ee.getLayerId(t.SHIFT|n)];if(c!=null&&c!=e[ee.getLayerId(t.RALT)]||l!=null&&l!=e[ee.getLayerId(t.RALT|t.SHIFT)])return!1;var r=this.modifierBitmask;return(r&n)!=n||c==null&&l==null,!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"usesSupplementaryPlaneChars",{get:function(){var t=this.scriptObject;return t&&(t.KS&&t.KS==1||t.KN=="Hieroglyphic")},enumerable:!1,configurable:!0}),i.prototype.usesDesktopLayoutOnDevice=function(t){return this.scriptObject.KVKL?t.formFactor==x.FormFactor.Desktop:!0},i.prototype.notify=function(t,e,n){typeof this.scriptObject.KNS=="function"&&this.scriptObject.KNS(t,e,n)},i.prototype.findOrConstructLayout=function(t){if(this._layouts){if(this._layouts[t]!==void 0)return this._layouts[t];if(t==x.FormFactor.Phone&&this._layouts[x.FormFactor.Tablet])return this._layouts[x.FormFactor.Phone]=this._layouts[x.FormFactor.Tablet];if(t==x.FormFactor.Tablet&&this._layouts[x.FormFactor.Phone])return this._layouts[x.FormFactor.Tablet]=this._layouts[x.FormFactor.Phone]}var e=null;if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.KLS)e=this._legacyLayoutSpec;else if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.BK!=null){for(var n=this._legacyLayoutSpec.BK,c=0;c<n.length;c++)if(n[c].length>0){e=this._legacyLayoutSpec;break}}if(!e&&(this.helpText==""||t!=x.FormFactor.Desktop)&&(e={F:"Tahoma",BK:ee.dfltText}),this._layouts||(this._layouts={}),e){var l=this._layouts[t]=ee.buildDefaultLayout(e,this,t);return l.isDefault=!0,l}else return this._layouts[t]=null,null},i.prototype.layout=function(t){var e=this.findOrConstructLayout(t);return e?(this.layoutStates[t]==Xe.NOT_LOADED&&(e=st.polyfill(e,this,t),this.layoutStates[t]=Xe.POLYFILLED),e):null},i.prototype.refreshLayouts=function(){var t=[x.FormFactor.Desktop,x.FormFactor.Phone,x.FormFactor.Tablet],e=this;t.forEach(function(n){e.layoutStates[n]=Xe.NOT_LOADED})},i.prototype.markLayoutCalibrated=function(t){this.layoutStates[t]!=Xe.NOT_LOADED&&(this.layoutStates[t]=Xe.CALIBRATED)},i.prototype.getLayoutState=function(t){return this.layoutStates[t]},i.prototype.constructNullKeyEvent=function(t,e){e=e||{K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};var n=$.constructNullKeyEvent(t);return this.setSyntheticEventDefaults(n,e),n},i.prototype.constructKeyEvent=function(t,e,n){var c=t.baseKeyEvent;c.device=e,this.isMnemonic&&c.setMnemonicCode(t.layer.indexOf("shift")!=-1,n.K_CAPS),this.setSyntheticEventDefaults(c,n);var l={K_CAPS:I.stateBitmasks.CAPS,K_NUMLOCK:I.stateBitmasks.NUM_LOCK,K_SCROLL:I.stateBitmasks.SCROLL_LOCK},r=l[c.kName];return r&&(c.Lstates^=r,c.LmodifierChange=!0),c},i.prototype.setSyntheticEventDefaults=function(t,e){t.device.touchable||(t.Lstates=0,t.Lstates|=e.K_CAPS?I.modifierCodes.CAPS:I.modifierCodes.NO_CAPS,t.Lstates|=e.K_NUMLOCK?I.modifierCodes.NUM_LOCK:I.modifierCodes.NO_NUM_LOCK,t.Lstates|=e.K_SCROLL?I.modifierCodes.SCROLL_LOCK:I.modifierCodes.NO_SCROLL_LOCK),t.kName&&t.kName.substr(0,2)=="U_"&&(t.LisVirtualKey=!1),typeof t.Lcode=="undefined"&&(t.Lcode=this.getVKDictionaryCode(t.kName),t.Lcode||(t.Lcode=1)),(t.Lmodifiers&I.modifierBitmasks.ALT_GR_SIM)==I.modifierBitmasks.ALT_GR_SIM&&this.emulatesAltGr&&(t.Lmodifiers&=~I.modifierBitmasks.ALT_GR_SIM,t.Lmodifiers|=I.modifierCodes.RALT)},i.prototype.getVKDictionaryCode=function(t){if(!this.scriptObject.VKDictionary){var e=[];if(typeof this.scriptObject.KVKD=="string")for(var n=this.scriptObject.KVKD.split(" "),c=0;c<n.length;c++)e[n[c].toUpperCase()]=c+256;this.scriptObject.VKDictionary=e}var l=this.scriptObject.VKDictionary[t.toUpperCase()];return l||0},i.DEFAULT_SCRIPT_OBJECT={gs:function(t,e){return!1},KI:"",KN:"",KV:ee.DEFAULT_RAW_SPEC,KM:0},i}(),w=Ai;var De={osk:I},Me=function(){function i(t,e){this.loadedKeyboard=null,this._jsGlobal=t,this.keymanGlobal=e,this.install()}return i.prototype.KR=function(t){if(this.loadedKeyboard)throw new Error("Unexpected state:  the most-recently loaded keyboard field was not properly reset.");this.loadedKeyboard=new w(t)},i.prototype.install=function(){this._jsGlobal.KeymanWeb=this,this._jsGlobal.keyman=this.keymanGlobal},i.prototype.uninstall=function(){this._jsGlobal.KeymanWeb==this&&delete this._jsGlobal.KeymanWeb,this._jsGlobal.keyman==this.keymanGlobal&&delete this._jsGlobal.keyman},i}();var ze=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e)||this;return c.cause=n,c}return t}(Error);var Nt=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e)||this;return c.cause=n,c}return t}(Error);var fi=function(){function i(t){this.uri=t}return i.prototype.missingError=function(t){var e="Cannot find the keyboard at ".concat(this.uri,".");return new Nt(e,t)},i.prototype.scriptError=function(t){var e="Error registering the keyboard script at ".concat(this.uri,"; it may contain an error.");return new ze(e,t)},i}(),Si=function(){function i(t){this.stub=t}return i.prototype.missingError=function(t){var e=this.stub,n="Cannot find the ".concat(e.name," keyboard for ").concat(e.langName," at ").concat(e.filename,".");return new Nt(n,t)},i.prototype.scriptError=function(t){var e=this.stub,n="Error registering the ".concat(e.name," keyboard for ").concat(e.langName,"; keyboard script at ").concat(e.filename," may contain an error.");return new ze(n,t)},i}(),Hi=function(){function i(t){this._harness=t}return Object.defineProperty(i.prototype,"harness",{get:function(){return this._harness},enumerable:!1,configurable:!0}),i.prototype.loadKeyboardFromPath=function(t){this.harness.install();var e=this.loadKeyboardInternal(t,new fi(t));return e},i.prototype.loadKeyboardFromStub=function(t){this.harness.install();var e=this.loadKeyboardInternal(t.filename,new Si(t),t.id);return e},i}(),Tt=Hi;var Et;(function(i){i.KEYBOARD="keyboard",i.LANGUAGE="language",i.LANGUAGE_KEYBOARD="languageKeyboard",i.BLANK="blank"})(Et||(Et={}));var ie=Et;function kt(i,t){if(i)return{family:i.family,path:t,files:i.filename||i.source}}var Wi=function(){function i(t,e){if(typeof t!="string")if(t.KI||t.KL||t.KLC||t.KFont||t.KOskFont){var n=t;this.KI=n.KI,this.KN=n.KN,this.KL=n.KL,this.KLC=n.KLC,this.KFont=n.KFont,this.KOskFont=n.KOskFont,this._displayName=n instanceof i?n._displayName:n.displayName}else{var c=t;c.languages||(c.languages=c.language),this.KI=c.id,this.KN=c.name,this.KL=c.languages.name,this.KLC=c.languages.id,this.KFont=kt(c.languages.font,e),this.KOskFont=kt(c.languages.oskFont,e)}else this.KI=t,this.KLC=e}return Object.defineProperty(i,"spacebarTextMode",{get:function(){return typeof this.spacebarTextModeSrc=="string"?this.spacebarTextModeSrc:this.spacebarTextModeSrc()},set:function(t){this.spacebarTextModeSrc=t},enumerable:!1,configurable:!0}),i.fromMultilanguageAPIStub=function(t){var e=[];t.languages||(t.languages=t.language);for(var n=0,c=t.languages;n<c.length;n++){var l=c[n],r={id:t.id,name:t.name,languages:l};e.push(new i(r))}return e},Object.defineProperty(i.prototype,"id",{get:function(){return this.KI},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this.KN},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"langId",{get:function(){return this.KLC},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"langName",{get:function(){return this.KL},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"displayName",{get:function(){if(this._displayName)return this._displayName;var t=this.KN,e=this.KL;switch(i.spacebarTextMode){case ie.KEYBOARD:return t;case ie.LANGUAGE:return e;case ie.LANGUAGE_KEYBOARD:return t==e?e:e+" - "+t;case ie.BLANK:return"";default:return t}},set:function(t){this._displayName=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textFont",{get:function(){return this.KFont},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"oskFont",{get:function(){return this.KOskFont},enumerable:!1,configurable:!0}),i.prototype.validateForOSK=function(){return this.KLC?this.displayName===void 0||i.spacebarTextMode!=ie.BLANK&&!this.displayName?new Error("A display name is missing for this keyboard and cannot be generated under current settings."):null:this.KI||this.KN?new Error("No language code was specified for use with the ".concat(this.KI||this.KN," keyboard")):new Error("No language code was specified for use with the corresponding keyboard")},i.prototype.validateForCustomKeyboard=function(){return!this.KI||!this.KN||!this.KL||!this.KLC?new Error("To use a custom keyboard, you must specify keyboard id, keyboard name, language and language code."):null},i.spacebarTextModeSrc=ie.KEYBOARD,i}(),fe=Wi;var Yt=function(){function i(t,e){this.p=t,this.d=e,this.o=i.ordinalSeed++}return i.prototype.match=function(t,e){var n=this.p==t&&this.d==e;return n},i.prototype.set=function(){this.matched=1},i.prototype.reset=function(){this.matched=0},i.prototype.before=function(t){return this.o<t.o},i.prototype.clone=function(){var t=new i(this.p,this.d);return t.o=this.o,t},i.ordinalSeed=0,i.sortFunc=function(t,e){return t.p!=e.p?e.p-t.p:e.o-t.o},i}();var Pn=function(){function i(){this.dks=[]}return i.prototype.toSortedArray=function(){return this.dks=this.dks.sort(Yt.sortFunc),[].concat(this.dks)},i.prototype.clone=function(){var t=new i,e=this.toSortedArray();return t.dks=[],e.forEach(function(n){t.dks.push(n.clone())}),t},i.prototype.isMatch=function(t,e,n){if(this.dks.length==0)return!1;var c=t;e=c-e;for(var l=0;l<this.dks.length;l++)if(this.dks[l].match(e,n)&&!this.dks[l].matched)return this.dks[l].set(),!0;return this.resetMatched(),!1},i.prototype.add=function(t){this.dks=this.dks.concat(t)},i.prototype.remove=function(t){var e=this.dks.indexOf(t);this.dks.splice(e,1)},i.prototype.clear=function(){this.dks=[]},i.prototype.resetMatched=function(){for(var t=0,e=this.dks;t<e.length;t++){var n=e[t];n.reset()}},i.prototype.deleteMatched=function(){for(var t=0;t<this.dks.length;t++)this.dks[t].matched&&this.dks.splice(t--,1)},i.prototype.adjustPositions=function(t,e){if(e!=0)for(var n=0,c=this.dks;n<c.length;n++){var l=c[n];l.p>t&&(l.p+=e)}},i.prototype.count=function(){return this.dks.length},i}();var jn=function(){function i(t){this.id=t}return i.prototype.set=function(t){throw new Error("System store with ID "+this.id+" may not be directly set.")},i}();var Bt=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e)||this;return c.handler=null,c._value=n,c}return Object.defineProperty(t.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),t.prototype.matches=function(e){return this._value==e},t.prototype.set=function(e){this.handler&&this.handler(this,e)||(this._value=e)},t}(jn);var qn=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this,f.TSS_PLATFORM)||this;return n.kbdInterface=e,n}return t.prototype.matches=function(e){var n,c,l=e.split(" "),r=this.kbdInterface.activeDevice;for(n=0;n<l.length;n++)switch(c=l[n].toLowerCase(),c){case"touch":case"hardware":if(r.touchable!=(c=="touch"))return!1;break;case"macos":case"mac":c="macosx";case"macosx":case"windows":case"android":case"ios":case"linux":if(r.OS!=c)return!1;break;case"tablet":case"phone":case"desktop":if(r.formFactor!=c)return!1;break;case"web":if(r.browser=="native")return!1;break;case"native":case"chrome":case"firefox":case"safari":case"edge":case"opera":if(r.browser!=c)return!1;break;default:return!1}return!0},t}(jn);Oe();function ot(i){var t;return i?i.insert===""&&i.deleteLeft===0&&((t=i.deleteRight)!==null&&t!==void 0?t:0)===0:!1}var Ni=function(){function i(t,e,n){this.insert=t,this.deleteLeft=e,this.deleteRight=n||0}return i.nil=new i("",0,0),i}();var Ti=function(){function i(t,e,n,c){var l=this.token=i.tokenSeed++;this.keystroke=t,this.transform=e,this.alternates=c,this.preInput=n,this.transform.id=this.token,c&&c.forEach(function(r){r.sample.id=l})}return i.tokenSeed=0,i}();var $n=function(){function i(){this._dks=new Pn}return Object.defineProperty(i.prototype,"isSynthetic",{get:function(){return!0},enumerable:!1,configurable:!0}),i.prototype.resetContext=function(){this.deadkeys().clear()},i.prototype.deadkeys=function(){return this._dks},i.prototype.hasDeadkeyMatch=function(t,e){return this.deadkeys().isMatch(this.getDeadkeyCaret(),t,e)},i.prototype.insertDeadkeyBeforeCaret=function(t){var e=new Yt(this.getDeadkeyCaret(),t);this.deadkeys().add(e)},i.prototype.adjustDeadkeys=function(t){this.deadkeys().adjustPositions(this.getDeadkeyCaret(),t)},i.prototype.setDeadkeys=function(t){this._dks=t.clone()},i.prototype.buildTransformFrom=function(t){for(var e=this.getText(),n=t.getText(),c=t.getDeadkeyCaret(),l=this.getDeadkeyCaret(),r=c<l?c:l,s=e._kmwCodePointToCodeUnit(r),B=0,o=s;B<o;){var g=Math.floor((o+B+1)/2),a=n.substr(B,g-B),F=e.substr(B,g-B);a==F?B=g:o=g-1}if(o>0&&o<s){var y=n.charCodeAt(o-1),u=n.charCodeAt(o),Q=e.charCodeAt(o);if(y>=55296&&y<=56319){var C=u>=56320&&u<=57343;C=C||Q>=56320&&Q<=57343,C&&(o=o-1)}}var h=n._kmwCodeUnitToCodePoint(o),b=c-h,U=l-h,V=e._kmwSubstr(h,U),X=e._kmwLength()-l,L=n._kmwLength()-c,P=L-X;return P<0&&(V=V+e._kmwSubstr(l,-P),P=0),new Ni(V,b,P)},i.prototype.buildTranscriptionFrom=function(t,e,n,c){var l=this.buildTransformFrom(t);return new Ti(e,l,H.from(t,n),c)},i.prototype.restoreTo=function(t){this.setTextBeforeCaret(t.getTextBeforeCaret()),this.setTextAfterCaret(t.getTextAfterCaret()),this._dks=t._dks.clone()},i.prototype.apply=function(t){t.deleteRight&&this.setTextAfterCaret(this.getTextAfterCaret()._kmwSubstr(t.deleteRight)),t.deleteLeft&&this.deleteCharsBeforeCaret(t.deleteLeft),t.insert&&this.insertTextBeforeCaret(t.insert),this._dks.clear()},i.prototype.setTextBeforeCaret=function(t){this.deleteCharsBeforeCaret(this.getTextBeforeCaret()._kmwLength()),this.insertTextBeforeCaret(t)},i.prototype.saveProperties=function(){},i.prototype.restoreProperties=function(){},i}(),wt=$n,H=function(i){(0,d.__extends)(t,i);function t(e,n,c){var l=i.call(this)||this;l.selForward=!0,l.text=e||"";var r=l.text._kmwLength();return l.selStart=typeof n=="number"?n:r,l.selEnd=typeof c=="number"?c:l.selStart,l.selForward=l.selEnd>=l.selStart,l}return t.from=function(e,n){var c;if(e instanceof t){var l=e;c=new t(l.text,l.selStart,l.selEnd)}else{var r=e.getText(),s=r._kmwLength(),B=s,o=0;if(e.hasSelection()){var g=e.getTextBeforeCaret(),a=e.getTextAfterCaret();B=g._kmwLength(),o=s-a._kmwLength()}c=new t(r,B,o)}return c.setDeadkeys(e.deadkeys()),c},t.prototype.clearSelection=function(){this.text=this.getTextBeforeCaret()+this.getTextAfterCaret(),this.selEnd=this.selStart,this.selForward=!0},t.prototype.invalidateSelection=function(){},t.prototype.isSelectionEmpty=function(){return this.selStart==this.selEnd},t.prototype.hasSelection=function(){return!0},t.prototype.getDeadkeyCaret=function(){return this.selStart},t.prototype.setSelection=function(e,n){if(this.selStart=e,this.selEnd=typeof n=="number"?n:e,this.selForward=n>=e,!this.selForward){var c=this.selStart;this.selStart=this.selEnd,this.selEnd=c}},t.prototype.getTextBeforeCaret=function(){return this.text.kmwSubstr(0,this.selStart)},t.prototype.getSelectedText=function(){return this.text.kmwSubstr(this.selStart,this.selEnd-this.selStart)},t.prototype.getTextAfterCaret=function(){return this.text.kmwSubstr(this.selEnd)},t.prototype.getText=function(){return this.text},t.prototype.deleteCharsBeforeCaret=function(e){e>=0&&(e>this.selStart&&(e=this.selStart),this.adjustDeadkeys(-e),this.text=this.text.kmwSubstr(0,this.selStart-e)+this.text.kmwSubstr(this.selStart),this.selStart-=e,this.selEnd-=e)},t.prototype.insertTextBeforeCaret=function(e){this.adjustDeadkeys(e._kmwLength()),this.text=this.getTextBeforeCaret()+e+this.text.kmwSubstr(this.selStart),this.selStart+=e.kmwLength(),this.selEnd+=e.kmwLength()},t.prototype.handleNewlineAtCaret=function(){this.insertTextBeforeCaret("\n")},t.prototype.setTextAfterCaret=function(e){this.text=this.getTextBeforeCaret()+e},t.prototype.doInputEvent=function(){},t}($n);var Ei=function(){function i(){this.transcription=null,this.setStore={},this.saveStore={},this.variableStores={},this.triggersDefaultCommand=!1}return i.prototype.finalize=function(t,e,n){if(!this.transcription)throw"Cannot finalize a RuleBehavior with no transcription.";t.beepHandler&&this.beep&&t.beepHandler(e);for(var c in this.setStore){var l=t.keyboardInterface.systemStores[c];if(l)try{l.set(this.setStore[c])}catch(s){t.errorLogger&&t.errorLogger("Rule attempted to perform illegal operation - 'platform' may not be changed.")}else t.warningLogger&&t.warningLogger("Unknown store affected by keyboard rule: "+c)}if(t.keyboardInterface.applyVariableStores(this.variableStores),t.keyboardInterface.variableStoreSerializer)for(var c in this.saveStore)t.keyboardInterface.variableStoreSerializer.saveStore(t.activeKeyboard.id,c,this.saveStore[c]);if(this.triggersDefaultCommand){var r=this.transcription.keystroke;t.defaultRules.applyCommand(r,e)}t.warningLogger&&this.warningLog?t.warningLogger(this.warningLog):t.errorLogger&&this.errorLog&&t.errorLogger(this.errorLog)},i.prototype.mergeInDefaults=function(t){var e=this.transcription.keystroke,n=t.transcription.keystroke;if(e.Lcode!=n.Lcode||e.Lmodifiers!=n.Lmodifiers)throw"RuleBehavior default-merge not supported unless keystrokes are identical!";this.triggersDefaultCommand=this.triggersDefaultCommand||t.triggersDefaultCommand;var c=H.from(this.transcription.preInput,!1);c.apply(this.transcription.transform),c.apply(t.transcription.transform),this.transcription=c.buildTranscriptionFrom(this.transcription.preInput,e,!1,this.transcription.alternates)},i}(),le=Ei;var ki=function(){function i(){}return i}();var Gs=function(){function i(){}return i}(),Xs=function(){function i(){}return i}(),ps=function(){function i(){}return i}(),ms=function(){function i(){}return i}(),Zs=function(){function i(){}return i}(),Ls=function(){function i(){}return i}(),Yi=function(){function i(){}return i.prototype.reset=function(){this._cache=[]},i.prototype.get=function(t,e){return typeof this._cache[t]=="undefined"||typeof this._cache[t][e]=="undefined"?null:this._cache[t][e]},i.prototype.set=function(t,e,n){typeof this._cache[t]=="undefined"&&(this._cache[t]=[]),this._cache[t][e]=n},i}(),wi=function(){function i(){}return i.prototype.reset=function(){this._cache=[]},i.prototype.get=function(t,e){return typeof this._cache[t]=="undefined"||typeof this._cache[t][e]=="undefined"?null:this._cache[t][e]},i.prototype.set=function(t,e,n){typeof this._cache[t]=="undefined"&&(this._cache[t]=[]),this._cache[t][e]=n},i.prototype.clone=function(){var t=new i;return t._cache=this._cache,t},i}(),f;(function(i){i[i.TSS_LAYER=33]="TSS_LAYER",i[i.TSS_PLATFORM=31]="TSS_PLATFORM",i[i.TSS_NEWLAYER=42]="TSS_NEWLAYER",i[i.TSS_OLDLAYER=43]="TSS_OLDLAYER"})(f||(f={}));var ec=function(i){(0,d.__extends)(t,i);function t(e,n,c){c===void 0&&(c=null);var l=i.call(this,e,n)||this;return l.cachedContext=new Yi,l.cachedContextEx=new wi,l._AnyIndices=[],l.systemStores={},l.systemStores[f.TSS_PLATFORM]=new qn(l),l.systemStores[f.TSS_LAYER]=new Bt(f.TSS_LAYER,"default"),l.systemStores[f.TSS_NEWLAYER]=new Bt(f.TSS_NEWLAYER,""),l.systemStores[f.TSS_OLDLAYER]=new Bt(f.TSS_OLDLAYER,""),l.variableStoreSerializer=c,l}return Object.defineProperty(t.prototype,"Codes",{get:function(){return I},enumerable:!1,configurable:!0}),t.prototype.saveFocus=function(){},t.prototype.registerKeyboard=function(e){var n=new w(e);this.loadedKeyboard=n},t.prototype.context=function(e,n,c){var l=this.cachedContext.get(e,n);if(l!==null)return l;var r=this.KC_(e,n,c);return this.cachedContext.set(e,n,r),r},t.prototype.KC_=function(e,n,c){var l="";return l=c.isSelectionEmpty()?c.getTextBeforeCaret():"",l._kmwLength()<e&&(l=Array(e-l._kmwLength()+1).join("\uFFFE")+l),l._kmwSubstr(-e)._kmwSubstr(0,n)},t.prototype.nul=function(e,n){var c=this.context(e+1,1,n);return c==="\uFFFE"},t.prototype.contextMatch=function(e,n,c,l){var r=this.context(e,l,n);return r===c?!0:(n.deadkeys().resetMatched(),!1)},t.prototype._BuildExtendedContext=function(e,n,c){var l=this.cachedContextEx.get(e,n);if(l!==null)return l;if(l=this.cachedContextEx.get(e,e),l===null){var r=c.deadkeys().toSortedArray(),s=0;for(l={valContext:[],deadContext:[]};l.valContext.length<e;){var B=c.getDeadkeyCaret(),o=B-s;if(r.length>0&&r[0].p>o){r.splice(0,1);continue}else if(r.length>0&&r[0].p==o)l.deadContext[e-l.valContext.length-1]=r[0],l.valContext=[r[0].d].concat(l.valContext),r.splice(0,1);else{var g=this.context(++s,1,c);l.valContext=[g].concat(l.valContext)}}this.cachedContextEx.set(e,e,l)}var a=l;a.valContext=a.valContext.slice(0,n);for(var F=0;F<a.valContext.length;F++)a[F]=="\uFFFE"&&(a.valContext.splice(0,1),a.deadContext.splice(0,1));return a.valContext.length==0&&(a.valContext=["\uFFFE"],a.deadContext=[]),this.cachedContextEx.set(e,n,a),a},t.prototype.fullContextMatch=function(e,n,c){var l=this._BuildExtendedContext(e,c.length,n);this.ruleContextEx=this.cachedContextEx.clone();for(var r=l.valContext,s=l.deadContext,B=!1,o="\uFFFE",g=function(h){throw new Error("Unexpected object in fullContextMatch specification: "+h)},a=0;a<c.length;a++)if(typeof c[a]=="string"){var F=c[a];if(F!==r[a]){B=!0;break}}else{var y=c[a];switch(y.t){case"d":y.d!==r[a]?B=!0:s[a].set();break;case"a":var u;typeof r[a]=="string"?u=r[a]:u={t:"d",d:r[a]};var Q=this.any(a,u,y.a);y.n?y.n&&(Q||r[a]===o)&&(B=!0):Q?s[a]!==void 0&&s[a].set():B=!0;break;case"i":var C=this._Index(y.i,y.o);C!==void 0&&(typeof C=="string"?C:C.d)!==r[a]?B=!0:s[a]!==void 0&&s[a].set();break;case"c":r[y.c-1]!==r[a]?B=!0:s[a]!==void 0&&s[a].set();break;case"n":r[a]!=o&&(B=!0);break;default:g(y)}}return B&&(n.deadkeys().resetMatched(),this._AnyIndices=[]),!B},t.prototype.isKeypress=function(e){return this.activeKeyboard.isMnemonic?!e.LisVirtualKey:!!de._USKeyCodeToCharCode(e)},t.matchModifiersToRuleChirality=function(e,n){var c=I.modifierCodes.LALT|I.modifierCodes.RALT,l=I.modifierCodes.LCTRL|I.modifierCodes.RCTRL,r=e;if(!(n&c)){var s=r&c;s&&(r^=s|I.modifierCodes.ALT)}if(!(n&l)){var B=r&l;B&&(r^=B|I.modifierCodes.CTRL)}return r},t.prototype.keyMatch=function(e,n,c){var l=!1,r=e.Lcode==173?189:e.Lcode,s=this.activeKeyboard.modifierBitmask,B=s&I.modifierBitmasks.ALL,o=s&I.stateBitmasks.ALL,g=t.matchModifiersToRuleChirality(e.Lmodifiers,n);return e.vkCode>255&&(r=e.vkCode),e.LisVirtualKey||r>255?((n&16384)==16384||r>255)&&(l=c==r&&(n&B)==g,l=l&&this.stateMatch(e,n&o)):(n&16384)==0&&(l=r==c),l||this.activeTargetOutput.deadkeys().resetMatched(),l},t.prototype.stateMatch=function(e,n){return(n&e.Lstates)==n},t.prototype.keyInformation=function(e){var n=new ki;return n.vk=e.LisVirtualKey,n.code=e.Lcode,n.modifiers=e.Lmodifiers,n},t.prototype.deadkeyMatch=function(e,n,c){return n.hasDeadkeyMatch(e,c)},t.prototype.beep=function(e){this.resetContextCache(),this.ruleBehavior.beep=!0},t.prototype._ExplodeStore=function(e){if(typeof e=="string"){var n=this.activeKeyboard.explodedStores;if(n[e])return n[e];for(var c=[],l=0;l<e._kmwLength();l++)c.push(e._kmwCharAt(l));return n[e]=c,c}else return e},t.prototype.any=function(e,n,c){if(n=="")return!1;c=this._ExplodeStore(c);for(var l=-1,r=0;r<c.length;r++)if(typeof c[r]=="string"){if(c[r]==n){l=r;break}}else if(c[r].d===n.d){l=r;break}return this._AnyIndices[e]=l,l>=0},t.prototype._Index=function(e,n){return e=this._ExplodeStore(e),this._AnyIndices[n-1]<e.length?e[this._AnyIndices[n-1]]:(console.warn("Unmatched contextual index() statement detected in rule with index "+n+"!"),"")},t.prototype.indexOutput=function(e,n,c,l){this.resetContextCache();var r=function(o){throw new Error("Unexpected object in fullContextMatch specification: "+o)},s=this._Index(n,c);if(s!=="")if(typeof s=="string")this.output(e,l,s);else if(s.t){var B=s;switch(B.t){case"b":this.beep(l);break;case"d":this.deadkeyOutput(e,l,s.d);break;default:r(B)}}else this.deadkeyOutput(e,l,s.d)},t.prototype.deleteContext=function(e,n){var c;if(e>0){c=this._BuildExtendedContext(e,e,n);for(var l=0,r=0;r<c.valContext.length;r++){var s=c.deadContext[r];s?(n.deadkeys().remove(s),e--):c.valContext[r]=="\uFFFE"&&l++}var B=c.valContext.length-l;e>B&&(e=B)}n.deadkeys().resetMatched(),this.output(e,n,"")},t.prototype.output=function(e,n,c){this.resetContextCache(),n.saveProperties(),n.clearSelection(),n.deadkeys().deleteMatched(),e>=0&&n.deleteCharsBeforeCaret(e),n.insertTextBeforeCaret(c),n.restoreProperties()},t.prototype.contextExOutput=function(e,n,c,l){this.resetContextCache(),e>=0&&this.output(e,n,"");var r=this.ruleContextEx.get(c,c),s=r.deadContext[l-1],B=r.valContext[l-1];if(s)n.insertDeadkeyBeforeCaret(s.d);else if(typeof B=="string")this.output(-1,n,B);else throw new Error("contextExOutput: should never be a numeric valContext with no corresponding deadContext")},t.prototype.deadkeyOutput=function(e,n,c){this.resetContextCache(),e>=0&&this.output(e,n,""),n.insertDeadkeyBeforeCaret(c)},t.prototype.ifStore=function(e,n,c){var l=!0,r=this.systemStores[e];return r&&(l=r.matches(n)),l},t.prototype.setStore=function(e,n,c){if(this.resetContextCache(),e==f.TSS_LAYER&&this.activeDevice.touchable)this.ruleBehavior.setStore[e]=n;else return!1},t.prototype.loadStore=function(e,n,c){if(this.resetContextCache(),this.variableStoreSerializer){var l=this.variableStoreSerializer.loadStore(e,n);return l[n]||c}else return c},t.prototype.saveStore=function(e,n){this.resetContextCache();var c=this.activeKeyboard;if(!c||typeof c.id=="undefined"||c.id=="")return!1;var l={};return l[e]=n,this.ruleBehavior?this.ruleBehavior.saveStore[e]=l:this.variableStoreSerializer.saveStore(this.activeKeyboard.id,e,l),!0},t.prototype.resetContextCache=function(){this.cachedContext.reset(),this.cachedContextEx.reset()},t.prototype.defaultBackspace=function(e){e.isSelectionEmpty()?this.output(1,e,""):this.output(0,e,"")},t.prototype.processNewContextEvent=function(e,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processNewContextEvent.bind(this.activeKeyboard),e,n,!0)},t.prototype.processPostKeystroke=function(e,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processPostKeystroke.bind(this.activeKeyboard),e,n,!0)},t.prototype.processKeystroke=function(e,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.process.bind(this.activeKeyboard),e,n,!1)},t.prototype.process=function(e,n,c,l){if(n)if(this.activeKeyboard){if(!e)throw"No callee for keystroke processing!"}else throw"No active keyboard for keystroke processing!";else throw"No target specified for keyboard output!";n.invalidateSelection(),n.deadkeys().resetMatched(),this.resetContextCache();var r=H.from(n,!0),s=this.activeKeyboard.variableStores;this.ruleBehavior=new le,this.activeDevice=c.device,this.activeTargetOutput=n;var B=e(n,c);this.activeTargetOutput=null,this.ruleBehavior.transcription=n.buildTranscriptionFrom(r,c,l),this.ruleBehavior.variableStores=this.activeKeyboard.variableStores,this.activeKeyboard.variableStores=s,this.ruleBehavior.triggerKeyDefault=!B;var o=this.ruleBehavior;return this.ruleBehavior=null,o},t.prototype.applyVariableStores=function(e){this.activeKeyboard.variableStores=e},t.__publishShorthandAPI=function(){var e=this.prototype,n=function(c,l){e[l]&&(e[c]=e[l])};n("KSF","saveFocus"),n("KBR","beepReset"),n("KT","insertText"),n("KR","registerKeyboard"),n("KRS","registerStub"),n("KC","context"),n("KN","nul"),n("KCM","contextMatch"),n("KFCM","fullContextMatch"),n("KIK","isKeypress"),n("KKM","keyMatch"),n("KSM","stateMatch"),n("KKI","keyInformation"),n("KDM","deadkeyMatch"),n("KB","beep"),n("KA","any"),n("KDC","deleteContext"),n("KO","output"),n("KDO","deadkeyOutput"),n("KCXO","contextExOutput"),n("KIO","indexOutput"),n("KIFS","ifStore"),n("KSETS","setStore"),n("KLOAD","loadStore"),n("KSAVE","saveStore")},t.GLOBAL_NAME="KeymanWeb",t}(Me),Ke=ec;(function(){ec.__publishShorthandAPI()})();var tc=v(A(),1);var Oi=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this)||this;return c.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1},c.modStateFlags=0,n||(n=t.DEFAULT_OPTIONS),c.contextDevice=e,c.baseLayout=n.baseLayout||t.DEFAULT_OPTIONS.baseLayout,c.keyboardInterface=n.keyboardInterface||new Ke(Ae(),De),c.defaultRules=n.defaultOutputRules||t.DEFAULT_OPTIONS.defaultOutputRules,c}return Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this.keyboardInterface.activeKeyboard},set:function(e){this.keyboardInterface.activeKeyboard=e,this.resetContext()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerStore",{get:function(){return this.keyboardInterface.systemStores[f.TSS_LAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newLayerStore",{get:function(){return this.keyboardInterface.systemStores[f.TSS_NEWLAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldLayerStore",{get:function(){return this.keyboardInterface.systemStores[f.TSS_OLDLAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerId",{get:function(){return this.layerStore.value},set:function(e){this.layerStore.set(e)},enumerable:!1,configurable:!0}),t.prototype.defaultRuleBehavior=function(e,n,c){var l=H.from(n,c),r=new le,s=!1,B="",o;if(e.isSynthetic||n.isSynthetic)if(s=!0,this.defaultRules.isCommand(e))r.triggersDefaultCommand=!0;else if((o=this.defaultRules.forSpecialEmulation(e))!=null)switch(o){case Ue.Backspace:this.keyboardInterface.defaultBackspace(n);break;case Ue.Enter:n.handleNewlineAtCaret();break;default:r.errorLog="Unexpected 'special emulation' character (\\u"+o.kmwCharCodeAt(0).toString(16)+") went unhandled!"}else s=!1;var g=this.activeKeyboard&&this.activeKeyboard.isMnemonic;if(!s)if((B=this.defaultRules.forAny(e,g))!=null)if(o=this.defaultRules.forSpecialEmulation(e),o==Ue.Backspace)this.keyboardInterface.defaultBackspace(n);else{if(o||this.defaultRules.isCommand(e))return null;this.keyboardInterface.output(0,n,B)}else return null;if(r.errorLog)return r;var a=n.buildTranscriptionFrom(l,e,c);return r.transcription=a,r},t.prototype.processNewContextEvent=function(e,n){return this.activeKeyboard?this.keyboardInterface.processNewContextEvent(n,this.activeKeyboard.constructNullKeyEvent(e,this.stateKeys)):null},t.prototype.processPostKeystroke=function(e,n){return this.activeKeyboard?this.keyboardInterface.processPostKeystroke(n,this.activeKeyboard.constructNullKeyEvent(e,this.stateKeys)):null},t.prototype.processKeystroke=function(e,n){var c;if(this.activeKeyboard&&e.Lcode!=0&&(c=this.keyboardInterface.processKeystroke(n,e)),!c||c.triggerKeyDefault){e.Lcode=e.vkCode||e.Lcode,this.keyboardInterface.activeTargetOutput=n;var l=this.defaultRuleBehavior(e,n,!1);l&&(c?c.mergeInDefaults(l):c=l,c.triggerKeyDefault=!1),this.keyboardInterface.activeTargetOutput=null}return c},t.prototype._UpdateVKShift=function(e){var n=0,c=["CAPS","NUM_LOCK","SCROLL_LOCK"],l=["K_CAPS","K_NUMLOCK","K_SCROLL"];if(!this.activeKeyboard)return!0;if(e){n=e.Lmodifiers,this.activeKeyboard.isChiral&&this.activeKeyboard.emulatesAltGr&&(this.modStateFlags&I.modifierBitmasks.ALT_GR_SIM)==I.modifierBitmasks.ALT_GR_SIM&&(n|=I.modifierBitmasks.ALT_GR_SIM,n&=~I.modifierCodes.RALT);for(var r=!1,s=0;s<c.length;s++)e.Lstates&I.stateBitmasks[c[s]]&&(this.stateKeys[l[s]]=!!(e.Lstates&I.modifierCodes[c[s]]),r=!0);r&&this.emit("statekeychange",this.stateKeys)}return this.updateStates(),this.activeKeyboard.isMnemonic&&this.stateKeys.K_CAPS&&(!e||!e.isModifier)&&(n^=I.modifierCodes.SHIFT),this.layerId=this.getLayerId(n),!0},t.prototype.updateStates=function(){for(var e=["CAPS","NUM_LOCK","SCROLL_LOCK"],n=["K_CAPS","K_NUMLOCK","K_SCROLL"],c=0;c<n.length;c++){var l=n[c],r=this.stateKeys[l],s=e[c],B="NO_"+e[c];r?(this.modStateFlags|=I.modifierCodes[s],this.modStateFlags&=~I.modifierCodes[B]):(this.modStateFlags&=~I.modifierCodes[s],this.modStateFlags|=I.modifierCodes[B])}},t.prototype.getLayerId=function(e){return ee.getLayerId(e)},t.prototype.selectLayer=function(e){var n=e.kName,c=e.kNextLayer,l=this.activeKeyboard&&this.activeKeyboard.isChiral;if(typeof c=="number"&&(c=this.getLayerId(c*16)),!c)switch(n){case"K_LSHIFT":case"K_RSHIFT":case"K_SHIFT":c="shift";break;case"K_LCONTROL":case"K_LCTRL":if(l){c="leftctrl";break}case"K_RCONTROL":case"K_RCTRL":if(l){c="rightctrl";break}case"K_CTRL":c="ctrl";break;case"K_LMENU":case"K_LALT":if(l){c="leftalt";break}case"K_RMENU":case"K_RALT":if(l){c="rightalt";break}case"K_ALT":c="alt";break;case"K_ALTGR":l?c="leftctrl-rightalt":c="ctrl-alt";break;case"K_CURRENCIES":case"K_NUMERALS":case"K_SHIFTED":case"K_UPPER":case"K_LOWER":case"K_SYMBOLS":c="default";break}return c?(this.updateLayer(e,c),!0):!1},t.prototype.updateLayer=function(e,n){var c=this.layerId,l=c;if(n==c&&e.device.formFactor!=x.FormFactor.Desktop)return!1;var r=n,s;if(e.device.formFactor==x.FormFactor.Desktop){var B=["leftctrl","rightctrl","ctrl","leftalt","rightalt","alt","shift"];for(s=0;s<B.length;s++)r=r.replace(B[s]+"-",""),r=r.replace(B[s],"");if(c=="default"||c=="numeric"||c=="symbol"||c=="currency"||r!="")l=n;else{var o=I.getModifierState(l);for(s=0;s<B.length;s++)l=l.replace(B[s]+"-",""),l=l.replace(B[s],"");switch(n){case"shift":o^=I.modifierCodes.SHIFT;break;case"leftctrl":o^=I.modifierCodes.LCTRL;break;case"rightctrl":o^=I.modifierCodes.RCTRL;break;case"ctrl":o^=I.modifierCodes.CTRL;break;case"leftalt":o^=I.modifierCodes.LALT;break;case"rightalt":o^=I.modifierCodes.RALT;break;case"alt":o^=I.modifierCodes.ALT;break;default:l=n}l!="default"&&(l==""?l=this.getLayerId(o):l=this.getLayerId(o)+"-"+l)}l==""&&(l="default")}else l=n;var g=this.activeKeyboard.layout(e.device.formFactor);g.getLayer(l)?this.layerId=l:this.layerId="default";var a=I.getModifierState(this.layerId);this.modStateFlags=a|e.Lstates},t.prototype.doModifierPress=function(e,n,c){if(!this.activeKeyboard)return!1;if(e.Lcode==8)n.deadkeys().clear();else if(e.isModifier)return this.activeKeyboard.notify(e.Lcode,n,c?1:0),e.device.touchable?!0:this._UpdateVKShift(e);return e.LmodifierChange&&(this.activeKeyboard.notify(0,n,1),e.device.touchable||this._UpdateVKShift(e)),!1},t.prototype.performNewContextEvent=function(e){var n=this.processNewContextEvent(this.contextDevice,e);return n&&n.finalize(this,e,!0),n},t.prototype.resetContext=function(e){this.layerId="default",this.keyboardInterface.resetContextCache(),e&&this.performNewContextEvent(e),this.contextDevice.touchable||this._UpdateVKShift(null)},t.prototype.setNumericLayer=function(e){if(this.activeKeyboard){var n=this.activeKeyboard.layout(e.formFactor);n.getLayer("numeric")&&(this.layerId="numeric")}},t.DEFAULT_OPTIONS={baseLayout:"us",defaultOutputRules:new Ve},t}(tc.default),Ot=Oi;var nc=function(i){return i.substring(i.length-1)!="/"?i+"/":i},Di=function(){function i(t,e){e=nc(e),this.sourcePath=e,this.protocol=e.replace(/(.{3,5}:)(.*)/,"$1"),this.updateFromOptions(t)}return i.prototype.updateFromOptions=function(t){var e=this.sourcePath.replace(/(https?:\/\/)([^\/]*)(.*)/,"$1$2/");this._root=e,t.root!=""?this._root=this.fixPath(t.root):this._root=this.fixPath(e);var n=t.resources;n==""&&(n=this.sourcePath),this._resources=this.fixPath(n),this._keyboards=this.fixPath(t.keyboards),this._fonts=this.fixPath(t.fonts)},i.prototype.fixPath=function(t){return t.length==0||(t=nc(t),t.replace(/^(http)s?:.*/,"$1")=="http"||t.replace(/^(file):.*/,"$1")=="file")?t:t.substring(0,2)=="//"?this.protocol+t:t.substring(0,1)=="/"?this.root+t.substring(1):this.sourcePath+t},Object.defineProperty(i.prototype,"fonts",{get:function(){return this._fonts},enumerable:!1,configurable:!0}),i.prototype.updateFontPath=function(t){this._fonts=this.fixPath(t)},Object.defineProperty(i.prototype,"root",{get:function(){return this._root},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"resources",{get:function(){return this._resources},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keyboards",{get:function(){return this._keyboards},enumerable:!1,configurable:!0}),i}(),Dt=Di;var Mt={root:"",resources:"",keyboards:"",fonts:""};var Mi=function(){function i(t){t.OS==x.OperatingSystem.Android?this.popupCanvasBackgroundColor="#999":this.popupCanvasBackgroundColor=i.prefersDarkMode()?"#0f1319":"#ffffff"}return i.prefersDarkMode=function(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches},i}(),cc=Mi;var at=function(){function i(){this.detected=!1,this.touchable="ontouchstart"in window,this.OS="",this.formFactor="desktop",this.browser="",this.dyPortrait=0,this.dyLandscape=0,this.version="0",this.orientation=window.orientation}return i.prototype.getDPI=function(){var t=document.createElement("DIV"),e=t.style,n=96;return document.readyState!=="complete"||(t.id="calculateDPI",e.position="absolute",e.display="block",e.visibility="hidden",e.left="10px",e.top="10px",e.width="1in",e.height="10px",document.body.appendChild(t),n=typeof window.devicePixelRatio=="undefined"?t.offsetWidth:t.offsetWidth*window.devicePixelRatio,document.body.removeChild(t)),n},i.prototype.detect=function(){var t=!1;if(navigator&&navigator.userAgent){var e=navigator.userAgent;if(e.indexOf("iPad")>=0)this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;else if(e.indexOf("iPhone")>=0)this.OS="iOS",this.formFactor="phone",this.dyPortrait=this.dyLandscape=25;else if(e.indexOf("Android")>=0){this.OS="Android",this.formFactor="phone",this.dyPortrait=75,this.dyLandscape=25;try{var n=new RegExp("(?:Android\\s+)(\\d+\\.\\d+\\.\\d+)");this.version=e.match(n)[1]}catch(u){}}else if(e.indexOf("Linux")>=0)this.OS="Linux";else if(e.indexOf("Macintosh")>=0){var c=/Intel Mac OS X (\d+(?:[_\.]\d+)+)/i,l=c.exec(e);if(!l)console.warn("KMW could not properly parse the user agent string.A suboptimal keyboard layout may result."),this.OS="MacOSX";else if(l.length>1&&l[1]){var r=l[1].replace("_","."),s=new z(r);t=z.MAC_POSSIBLE_IPAD_ALIAS.compareTo(s)<=0,this.OS="MacOSX"}}else e.indexOf("Windows NT")>=0&&(this.OS="Windows",e.indexOf("Touch")>=0&&(this.formFactor="phone"),typeof navigator.msMaxTouchPoints=="number"&&navigator.msMaxTouchPoints>0&&(this.touchable=!0))}var B=Math.min(screen.width,screen.height),o=Math.max(screen.width,screen.height),g=B/o;this.OS!="iOS"&&this.formFactor=="phone"&&(B>=600&&g>.5625||g>=.625)&&(this.formFactor="tablet");var a=navigator.platform=="Win32"||navigator.platform=="MacIntel";this.OS=="iOS"&&!("ongesturestart"in window)&&!a&&(this.OS="Android"),this.browser="web",(this.OS=="iOS"||this.OS.toLowerCase()=="macosx")&&(this.browser="safari");var F=/Firefox|Chrome|OPR|Safari|Edge/;if(F.test(navigator.userAgent)&&(navigator.userAgent.indexOf("Firefox")>=0&&"onmozorientationchange"in screen?this.browser="firefox":navigator.userAgent.indexOf("OPR")>=0?this.browser="opera":navigator.userAgent.indexOf(" Edge/")>=0?this.browser="edge":navigator.userAgent.indexOf("Chrome")>=0?this.browser="chrome":navigator.userAgent.indexOf("Safari")>=0&&(this.browser="safari")),t&&this.browser=="safari"&&window.TouchEvent){this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;var y=screen.height/screen.width;y<1&&(y=1/y),y>1.6&&(this.formFactor="phone",this.dyPortrait=this.dyLandscape=25)}return this.colorScheme=cc.prefersDarkMode()?"dark":"light",this.detected=!0,this.coreSpec},Object.defineProperty(i.prototype,"coreSpec",{get:function(){return new x(this.browser,this.formFactor,this.OS,this.touchable)},enumerable:!1,configurable:!0}),i}();var zt=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this)||this;if(c.applyCacheBusting=!1,!n){var l=new at;l.detect(),n=l.coreSpec}return c.sourcePath=e,c.hostDevice=n,c.deferForInitialization=new R,c}return t.prototype.initialize=function(e){var n=this;this._paths?this._paths.updateFromOptions(e):this._paths=new Dt(e,this.sourcePath),typeof e.setActiveOnRegister=="boolean"?this.activateFirstKeyboard=e.setActiveOnRegister:this.activateFirstKeyboard=!0,this._spacebarText=e.spacebarText,fe.spacebarTextMode=function(){return n.spacebarText}},t.prototype.finalizeInit=function(){this.deferForInitialization.resolve()},Object.defineProperty(t.prototype,"paths",{get:function(){return this._paths},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spacebarText",{get:function(){return this._spacebarText},set:function(e){this._spacebarText!=e&&(this._spacebarText=e,this.emit("spacebartext",e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"softDevice",{get:function(){return this.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hardDevice",{get:function(){return Ht(this.hostDevice)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stubNamespacer",{get:function(){return this._stubNamespacer},set:function(e){this._stubNamespacer=e},enumerable:!1,configurable:!0}),t.prototype.debugReport=function(){return{hostDevice:this.hostDevice,initialized:this.deferForInitialization.hasFinalized}},t.prototype.onRuleFinalization=function(e,n){},t}(ic.default);var Kt=(0,d.__assign)({setActiveOnRegister:!0,spacebarText:ie.LANGUAGE_KEYBOARD},Mt);var lc=v(A(),1);var _t=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.pendingActivations=[],n.engineConfig=e,n}return Object.defineProperty(t.prototype,"predictionContext",{get:function(){return this._predictionContext},enumerable:!1,configurable:!0}),t.prototype.configure=function(e){this._resetContext=e.resetContext,this._predictionContext=e.predictionContext,this.keyboardCache=e.keyboardCache},t.prototype.insertText=function(e,n,c){var l=this.activeTarget;return l!=null?(n!=null&&e.output(0,l,n),typeof c!="undefined"&&c!==null&&e.deadkeyOutput(0,l,c),l.invalidateSelection(),!0):!1},t.prototype.resetContext=function(){this._resetContext(this.activeTarget),this.predictionContext.resetContext()},t.prototype.findAndPopActivation=function(e){var n;for(n=0;n<this.pendingActivations.length&&this.pendingActivations[n].target!=e;n++);return n==this.pendingActivations.length?null:this.pendingActivations.splice(n,1)[0]},t.prototype.deferredKeyboardActivation=function(e,n,c){return(0,d.__awaiter)(this,void 0,void 0,function(){var l,r;return(0,d.__generator)(this,function(s){switch(s.label){case 0:return l={target:c,keyboard:e,stub:n},this.findAndPopActivation(c),this.pendingActivations.push(l),[4,e];case 1:return s.sent(),r=this.findAndPopActivation(c),r==l?[2,l]:r?(this.pendingActivations.push(r),[2,null]):[2]}})})},t.prototype.activateKeyboard=function(e,n,c){return(0,d.__awaiter)(this,void 0,void 0,function(){var l,r,s,B;return(0,d.__generator)(this,function(o){switch(o.label){case 0:return this.findAndPopActivation(this.currentKeyboardSrcTarget()),l=this.prepareKeyboardForActivation(e,n),r=this.currentKeyboardSrcTarget(),[4,l.keyboard];case 1:return s=o.sent(),s==null&&l.metadata?[2,!1]:(this.currentKeyboardSrcTarget()==r&&this.emit("beforekeyboardchange",l.metadata),B=null,s&&(B={keyboard:s,metadata:l.metadata}),this.activateKeyboardForTarget(B,r),this.currentKeyboardSrcTarget()==r&&(this.resetContext(),this.emit("keyboardchange",this.activeKeyboard)),[2,!0])}})})},t.prototype.prepareKeyboardForActivation=function(e,n){var c=this,l;n||(n="");var r=null;if(e?r=this.keyboardCache.getStub(e,n):n=="",!r){if(e)throw new Error("No matching stub has been registered.");return{keyboard:Promise.resolve(null),metadata:null}}if(((l=this.activeKeyboard)===null||l===void 0?void 0:l.metadata)&&e==this.activeKeyboard.metadata.id){var s=this.activeKeyboard.keyboard;return{keyboard:Promise.resolve(s),metadata:r}}var B;if(B=this.keyboardCache.getKeyboardForStub(r))return{keyboard:Promise.resolve(B),metadata:r};this.emit("beforekeyboardchange",r);var o=this.engineConfig.deferForInitialization.then(function(){var a=new R;c.emit("keyboardasyncload",r,a.corePromise);var F=c.keyboardCache.fetchKeyboardForStub(r),y=new Promise(function(Q,C){var h="Sorry, the ".concat(r.name," keyboard for ").concat(r.langName," is not currently available.");window.setTimeout(function(){return C(new Error(h))},t.TIMEOUT_THRESHOLD)}),u=Promise.race([F,y]);return u.then(function(){a.resolve(null),y.catch(function(){})}),u.catch(function(Q){throw a.resolve(Q),Q}),u}),g=this.deferredKeyboardActivation(o,r,this.currentKeyboardSrcTarget());return{keyboard:g.then(function(a){return(0,d.__awaiter)(c,void 0,void 0,function(){return(0,d.__generator)(this,function(F){return a?[2,o]:[2,Promise.resolve(null)]})})}),metadata:r}},t.TIMEOUT_THRESHOLD=1e4,t}(lc.default);var rc=v(A(),1),zi=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t}(rc.default),Pt=zi;var sc=v(A(),1),gt="Keyboard_";function O(i){return i.startsWith(gt)?i:gt+i}function pe(i){return i.startsWith(gt)?i.substring(gt.length):i}var Ki=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.stubSetTable={},n.keyboardTable={},n.keyboardLoader=e,n}return t.prototype.getKeyboardForStub=function(e){return this.getKeyboard(e.KI)},t.prototype.getKeyboard=function(e){if(!e)return null;var n=this.keyboardTable[O(e)];return n instanceof Promise?null:n},Object.defineProperty(t.prototype,"defaultStub",{get:function(){function e(c){var l=Object.keys(c);if(l.length!=0)return c[l[0]]}var n=e(this.stubSetTable);if(n)return e(n)},enumerable:!1,configurable:!0}),t.prototype.addKeyboard=function(e){var n=O(e.id);this.keyboardTable[n]=e,this.emit("keyboardadded",e)},t.prototype.fetchKeyboardForStub=function(e){return this.fetchKeyboard(e.KI)},t.prototype.isFetchingKeyboard=function(e){if(!e)throw new Error("Keyboard ID must be specified");e=O(e);var n=this.keyboardTable[e];return n instanceof Promise},t.prototype.fetchKeyboard=function(e){var n=this;if(!e)throw new Error("Keyboard ID must be specified");if(!this.keyboardLoader)throw new Error("Cannot load keyboards; this cache was configured without a loader");e=O(e);var c=this.keyboardTable[e];if(c instanceof w)return Promise.resolve(c);if(c instanceof Promise)return c;var l=this.getStub(e,null);if(!l)throw new Error("No stub for ".concat(pe(e)," has been registered"));if(!l.filename)throw new Error("The registered stub for ".concat(pe(e)," lacks a path to the main keyboard file"));var r=this.keyboardLoader.loadKeyboardFromStub(l);return this.keyboardTable[e]=r,r.then(function(s){s.scriptObject.KI=e,n.addKeyboard(s)}).catch(function(s){throw delete n.keyboardTable[e],s}),r},t.prototype.addStub=function(e){var n,c=O(e.KI),l=this.stubSetTable[c]=(n=this.stubSetTable[c])!==null&&n!==void 0?n:{};l[e.KLC]=e,this.emit("stubadded",e)},t.prototype.findMatchingStub=function(e){return this.getStub(e.KI,e.KLC)},t.prototype.getStub=function(e,n){var c,l,r=n||"---";e instanceof w?l=e.id:l=e,l&&(l=O(l));var s=(c=this.stubSetTable[l])!==null&&c!==void 0?c:{};if(r!="---")return s[r];var B=Object.keys(s);return B.length==0?null:s[B[0]]},t.prototype.forgetKeyboard=function(e,n){n===void 0&&(n=!1);var c=e instanceof w?e.id:O(e);this.stubSetTable[c]&&delete this.stubSetTable[c],n&&this.keyboardTable[c]&&delete this.keyboardTable[c]},t.prototype.getStubList=function(){for(var e=[],n=Object.keys(this.stubSetTable),c=0,l=n;c<l.length;c++)for(var r=l[c],s=this.stubSetTable[r],B=Object.keys(s),o=0,g=B;o<g.length;o++){var a=g[o];e.push(s[a])}return e},t}(sc.default),jt=Ki;var qt=["World","Africa","Asia","Europe","South America","North America","Oceania","Central America","Middle East"],$t=["un","af","as","eu","sa","na","oc","ca","me"],_i=RegExp("^(([\\.]/)|([\\.][\\.]/)|(/))|(:)");function Bc(i,t){return t=t||"",i&&!_i.test(i)?t+i:i}var Pi=function(i){(0,d.__extends)(t,i);function t(e,n,c){var l=this;if(typeof e!="string")if(e.id!==void 0){var r=e;r.id=O(r.id),l=i.call(this,r,c)||this,l.KF=Bc(r.filename,n),l.mapRegion(r.languages)}else{var s=e;s.KI=O(s.KI),l=i.call(this,s,c)||this,l.KF=Bc(s.KF,n),l.KP=s.KP,l.KR=s.KR,l.KRC=s.KRC;return}else l=i.call(this,O(e),n)||this;return l}return t.prototype.mapRegion=function(e){var n=e.region,c=0;if(typeof n=="number")n<1||n>9?c=0:c=n-1;else if(typeof n=="string"){for(var l=n.length==2?$t:qt,r=0;r<l.length;r++)if(n.toLowerCase()==l[r].toLowerCase()){c=r;break}}this.KR=qt[c],this.KRC=$t[c]},Object.defineProperty(t.prototype,"region",{get:function(){return this.KR},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"regionCode",{get:function(){return this.KRC},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"filename",{get:function(){return this.KF},enumerable:!1,configurable:!0}),t.toStubs=function(e,n,c){var l="";if(typeof e.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),e.languages||(e.languages=e.language),e?e.id?e.languages||(l="KeyboardStub has undefined languages"):l="KeyboardStub has undefined id":l="Stub undefined",l!="")return[{error:new Error(l)}];var r=[];Array.isArray(e.languages)?r=r.concat(e.languages):r.push(e.languages);var s=[];return r.forEach(function(B){var o=(0,d.__assign)((0,d.__assign)({},e),{languages:B,language:void 0}),g=new t(o,n,c);s.push(g)}),s},t.prototype.merge=function(e){this.KL||(this.KL=e.KL),this.KR||(this.KR=e.KR),this.KRC||(this.KRC=e.KRC),this.KN||(this.KN=e.KN),this.KF||(this.KF=e.KF),this.KFont||(this.KFont=e.KFont),this.KOskFont||(this.KOskFont=e.KOskFont),e._displayName&&(this._displayName||(this._displayName=e._displayName))},t.prototype.validateForCustomKeyboard=function(){return i.prototype.validateForCustomKeyboard.call(this)||!this.KF||!this.KR?new Error("To use a custom keyboard, you must specify file name, keyboard id, keyboard name, language, language code, and region."):null},t}(fe),re=Pi;function _e(i,t){if(t.length==0)return Promise.resolve(i);if(i.length==0)return Promise.reject(t);var e=i;return Promise.resolve(e.concat(t))}var oc="The Cloud API request timed out.",en="Could not find a keyboard with that ID.",ac="The Cloud API failed to find an appropriate keyboard.",ji="Error occurred while registering keyboards: ",qi=function(i){return i+" keyboard not found."},$i=function(){function i(t,e){var n=this;this.cloudResolutionPromises={},this.languageFetchStarted=!1,this.registerFromCloud=function(c){var l=c.timerid,r;try{r=n._registerCore(c)}catch(B){r=new Error(ji+B)}if(l){var s=n.cloudResolutionPromises[l];if(s)try{r instanceof Error?s.reject(r):s.resolve(r)}finally{delete n.cloudResolutionPromises[l]}}},this.requestEngine=t,this.pathConfig=e,this._languageListPromise=new R}return Object.defineProperty(i.prototype,"languageListPromise",{get:function(){var t=this;return this.languageFetchStarted||(this.languageFetchStarted=!0,this.keymanCloudRequest("",!0).catch(function(e){t.languageFetchStarted=!1,t._languageListPromise.reject(e),t._languageListPromise=new R})),this._languageListPromise.corePromise},enumerable:!1,configurable:!0}),i.prototype.keymanCloudRequest=function(t,e){var n=this,c="https://api.keyman.com/cloud/4.0/"+(arguments.length>1&&e?"languages":"keyboards"),l="?jsonp=keyman.register&languageidtype=bcp47&version="+z.CURRENT.toString(),r=c+l+t,s=this.requestEngine.request(r),B=s.promise,o=s.queryId;return this.cloudResolutionPromises[o]=B,B.finally(function(){delete n.cloudResolutionPromises[o]}),B.corePromise},i.prototype._registerCore=function(t){var e=t.options,n=e.fontBaseUri;if(this.pathConfig.fonts!=""?n=this.pathConfig.fonts:this.pathConfig.updateFontPath(n),typeof t.error=="string"){var c="";if(typeof t.options.keyboardid=="string"){var l=t.options.keyboardid;c=l.substring(0,1).toUpperCase()+l.substring(1)}return new Error(qi(c))}if(typeof e=="undefined"||typeof e.context=="undefined")return new Error(en);var r=[];if(e.context=="keyboard"){var s=void 0,B=t.keyboard;if(Array.isArray(B))for(s=0;s<B.length;s++)r=r.concat(i.registerLanguagesForKeyboard(B[s],e,s));else r=r.concat(i.registerLanguagesForKeyboard(B,e,0))}else if(e.context=="language"){var o=t.languages;return this._languageListPromise.resolve(o),o}return r},i.registerLanguagesForKeyboard=function(t,e,n){var c="";if(typeof t=="undefined")return[];if(typeof e.keyboardid=="string"&&(c=e.keyboardid.split(",")[n]),Array.isArray(t))if(t.length==1||c.substr(-1,1)=="$"||c==""){for(var l=[],r=0;r<t.length;r++)l=l.concat(this.registerLanguagesForKeyboard(t[r],e,n));return l}else{for(var s=0,r=0;r<t.length;r++){var B=t[r].id.toLowerCase();if(B=="us"&&(B="english"),Array.isArray(t[r].languages)){for(var o=t[r].languages,g=0;g<o.length;g++)if(B==o[g].name.toLowerCase()){s=r;break}}}return this.registerLanguagesForKeyboard(t[s],e,n)}else{var a=e.fontBaseUri||"",F=re.toStubs(t,e.keyboardBaseUri,a),y=c.split("@")[1];if(F.length==1&&typeof F[0].error!="undefined")throw F[0].error;return typeof y!="string"?F:(y=y.replace(/\$$/,""),[F.find(function(u){return u.KLC==y})])}},i.prototype.fetchCloudStubs=function(t){return(0,d.__awaiter)(this,void 0,void 0,function(){var e,n,c,l,r,s,B;return(0,d.__generator)(this,function(o){switch(o.label){case 0:if(t.length==0)return[2,Promise.resolve([])];for(e="&keyboardid=",n="",c=0;c<t.length;c++)e=e+n+t[c].toString(),n=",";l=[],o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.keymanCloudRequest(e,!1)];case 2:return r=o.sent(),[2,_e(r,l)];case 3:return s=o.sent(),console.error(s),B={error:s},l.push(B),[2,Promise.reject(l)];case 4:return[2]}})})},i}(),tn=$i;var el=function(){function i(t,e){this.id=t,this.language=e}return i.prototype.toString=function(){var t=this.id;return this.language?(t=t+"@"+this.language,this.version&&(t=t+"@"+this.version)):this.version&&(t=t+"@@"+this.version),t},i}();function nn(i,t){return{keyboard:{id:i.id,name:i.name},error:typeof t=="string"?new Error(t):t}}function gc(i,t,e){var n=new el(i,t);return e&&(n.version=e),n}function dc(i,t,e){if(i.getStub(e.id,e.language)==null){for(var n=0;n<t.length;n++)if(t[n].id==e.id&&t[n].language==e.language)return!1;return!0}else return!1}var tl=function(){function i(t,e,n){this.pathConfig=n,this.cache=new jt(t),this.cloudQueryEngine=new tn(e,this.pathConfig)}return i.prototype.addKeyboardArray=function(t){for(var e=this,n=[],c=[],l=[],r=[],s=[],B=0,o=t;B<o.length;B++){var g=o[B];if(typeof g=="string"&&g.length>0)r.push(g);else if(g.KI||g.KL||g.KLC||g.KFont||g.KOskFont)l.push(new re(g));else{var a=g;if(typeof a.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),a.languages||(a.languages=a.language),typeof a.languages=="undefined"){var F="To use keyboard '"+a.id+"', you must specify languages.";s.push(nn(a,F))}else if(Array.isArray(a.languages))for(var y=re.toStubs(a,this.pathConfig.keyboards,this.pathConfig.fonts),u=0,Q=y;u<Q.length;u++){var C=Q[u];C instanceof re?l.push(C):s.push(C)}else{var h=a;l.push(new re(h,this.pathConfig.keyboards,this.pathConfig.fonts))}}}for(var b=0,U=l;b<U.length;b++){var C=U[b];if(C.KF){var V=C.validateForCustomKeyboard();V?s.push(nn(C,V)):n.push(C)}else c.push(C)}for(var X=[],L=0,P=c;L<P.length;L++){var p=P[L];if(!p.KI&&!p.KLC){s.push(nn(p,"Cannot fetch keyboard information without a keyboard ID or language code."));continue}var E=gc(pe(p.id),p.langId);dc(this.cache,X,E)&&X.push(E)}for(var oe=0,S=r;oe<S.length;oe++){var he=S[oe],k=he.split("@"),j=[""];k[0].toLowerCase()=="english"&&(k[0]="us"),k.length>1&&(j=k[1].split(","));for(var ae=0;ae<j.length;ae++)if(!(ae>0&&j[ae]=="")){var E=gc(k[0],j[ae],k[2]);dc(this.cache,X,E)&&X.push(E)}}n.forEach(function(Y){return e.cache.addStub(Y)});var Lt=this.cloudQueryEngine.fetchCloudStubs(X.map(function(Y){return Y.toString()}));return Lt.then(function(Y){for(var ge=0,nt=Y;ge<nt.length;ge++){var Te=nt[ge];Te instanceof re?(e.cache.addStub(Te),n.push(Te)):s.push(Te)}return[].concat(s).concat(n)})},i.prototype.addLanguageKeyboards=function(t){return(0,d.__awaiter)(this,void 0,void 0,function(){var e,n,c,l,r,s,B,o,g,a,F,y=this;return(0,d.__generator)(this,function(u){switch(u.label){case 0:e=[],n=[],u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.cloudQueryEngine.languageListPromise];case 2:return n=u.sent(),[3,4];case 3:return c=u.sent(),console.error(c),e.push({error:c}),[2,e];case 4:for(l=n,r="",s=0;s<t.length;s++){for(B=t[s].toLowerCase(),o=B.substr(-1,1)=="$",o&&(B=B.substr(0,B.length-1)),g=!1,a=0;a<l.length;a++)if(B==l[a].name.toLowerCase()){r!=""&&(r=r+","),r=r+"@"+l[a].id,o&&(r=r+"$"),g=!0;break}g||(F={language:{name:B},error:new Error(this.alertLanguageUnavailable(B))},e.push(F))}return r==""?[2,Promise.reject(e)]:[2,this.cloudQueryEngine.keymanCloudRequest("&keyboardid="+r,!1).then(function(Q){return(0,d.__awaiter)(y,void 0,void 0,function(){var C,h,b,U;return(0,d.__generator)(this,function(V){switch(V.label){case 0:return[4,_e(Q,e)];case 1:for(C=V.sent(),h=0,b=C;h<b.length;h++)U=b[h],typeof U.error=="undefined"&&this.cache.addStub(U);return[2,C]}})})},function(Q){console.error(Q);var C={error:Q};return e.push(C),Promise.reject(e)})]}})})},i.prototype.fetchCloudCatalog=function(){return(0,d.__awaiter)(this,void 0,void 0,function(){var t,e,n=this;return(0,d.__generator)(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,this.cloudQueryEngine.keymanCloudRequest("",!1)];case 1:return t=c.sent(),t.forEach(function(l){return n.cache.addStub(l)}),[2,t];case 2:return e=c.sent(),[2,Promise.reject([{error:e}])];case 3:return[2]}})})},i.prototype.alertLanguageUnavailable=function(t){var e="No keyboards are available for "+t+". Does it have another language name?";return e},i}(),cn=tl;var nl=function(){function i(){this.registeredModels={},this.languageModelMap={}}return i.prototype.modelForLanguage=function(t){return this.languageModelMap[t]},i.prototype.register=function(t){if(t.id=t.id.toLowerCase(),JSON.stringify(t)!=JSON.stringify(this.registeredModels[t.id])){this.registeredModels[t.id]=t;var e=this;t.languages.forEach(function(n){if(!n){console.warn("Null / undefined language codes are not permitted for registration.");return}e.languageModelMap[n]=t})}},i.prototype.unregister=function(t){var e;if(t=t.toLowerCase(),this.registeredModels[t])e=this.registeredModels[t],delete this.registeredModels[t];else return;var n=this;return e.languages.forEach(function(c){n.languageModelMap[c].id==t&&delete n.languageModelMap[c]}),e},i.prototype.isRegistered=function(t){return!!this.registeredModels[t.id.toLowerCase()]},i}(),ln=nl;function dt(i){for(var t=[],e=0;e<i.length;e++)t.push(i[e]);return t}function m(i){var t=document.createElement(i);return t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.MozUserSelect="none",t}var Fe=function(){function i(t,e){if(this.fontStyleDefinitions={},this.linkedSheets=[],!t){var n=document.getElementsByTagName("HEAD");n.length>0?t=n[0]:t=document.body}this.linkNode=t,this.doCacheBusting=e||!1}return i.prototype.linkStylesheet=function(t){this.linkedSheets.push(t),this.linkNode.appendChild(t)},i.prototype.addStyleSheetForFont=function(t,e,n){if(!!t&&typeof t.files!="undefined"){var c=t.family,l,r="",s="",B="",o="",g=[];n||(n=x.OperatingSystem.Other);var a=this.fontStyleDefinitions[n]=this.fontStyleDefinitions[n]||{};if(a[c]){var F=a[c];F.parentNode||this.linkStylesheet(F);return}for(typeof t.files=="string"?g[0]=t.files:g=t.files,l=0;l<g.length;l++)g[l].toLowerCase().indexOf(".otf")>0&&(r=g[l]),g[l].toLowerCase().indexOf(".ttf")>0&&(r=g[l]),g[l].toLowerCase().indexOf(".woff")>0&&(s=g[l]),g[l].toLowerCase().indexOf(".eot")>0&&(B=g[l]),g[l].toLowerCase().indexOf(".svg")>0&&(o=g[l]);r!=""&&r.indexOf("/")<0&&(r=e+r),s!=""&&s.indexOf("/")<0&&(s=e+s),B!=""&&B.indexOf("/")<0&&(B=e+B),o!=""&&o.indexOf("/")<0&&(o=e+o);var y="@font-face {\nfont-family:"+t.family+";\nfont-style:normal;\nfont-weight:normal;\n";if(n==x.OperatingSystem.iOS)if(r!="")this.doCacheBusting&&(r=this.cacheBust(r)),y=y+"src:url('"+r+"') format('truetype');";else return null;else{var u=[];if(n==x.OperatingSystem.Android?(o!=""&&u.push("url('"+o+"') format('svg')"),s!=""&&u.push("url('"+s+"') format('woff')"),r!=""&&u.push("url('"+r+"') format('truetype')")):(s!=""&&u.push("url('"+s+"') format('woff')"),r!=""&&u.push("url('"+r+"') format('truetype')"),o!=""&&u.push("url('"+o+"') format('svg')")),u.length==0)return null;y+="src:"+u.join(",")+";"}y=y+"\n}\n";var Q=xe(y);return a[c]=Q,this.linkStylesheet(Q),Q}},i.prototype.cacheBust=function(t){return t+"?v="+new Date().getTime()},i.prototype.linkExternalSheet=function(t){try{if(document.querySelector("link[href="+JSON.stringify(t)+"]")!=null)return}catch(n){return}var e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href=t,this.linkStylesheet(e)},i.prototype.unlink=function(t){var e=this.linkedSheets.indexOf(t);return e>-1?(this.linkedSheets.splice(e,1),t.parentNode.removeChild(t),!0):!1},i.prototype.unlinkAll=function(){for(var t=0,e=this.linkedSheets;t<e.length;t++){var n=e[t];n.parentNode&&n.parentNode.removeChild(n)}},i}();function xe(i){var t=document.createElement("style");return t.type="text/css",t.appendChild(document.createTextNode(i)),t}function D(){var i;return typeof window.orientation!="undefined"?i=window.orientation:typeof window.screen.orientation!="undefined"&&(i=window.screen.orientation.angle),i!==void 0?Math.abs(i/90)==1:!1}var Fc=function(i){return i},cl=function(){function i(t){this.name=t}return i.prototype.load=function(t){return this.loadCookie(this.name,t||Fc)},i.prototype.save=function(t,e){this.saveCookie(this.name,t,e||Fc)},i.prototype._loadRawCookies=function(){var t={};if(typeof document.cookie!="undefined"&&document.cookie!="")for(var e=document.cookie.split(/;\s*/),n=0;n<e.length;n++){var c=e[n].split("=");c.length==2&&(t[c[0]]=c[1])}return t},i.prototype.loadCookie=function(t,e){var n={},c=this._loadRawCookies(),l=c[t];if(l)for(var r=decodeURIComponent(l).split(";"),s=0;s<r.length&&!(s==r.length-1&&!r[s]);s++){var B=r[s].split("=");if(B.length>1){var o=B[0],g=B[1];n[o]=e(g,o)}else n[B[0]]=""}return n},i.prototype.saveCookie=function(t,e,n){var c="";for(var l in e)c+=l+"="+n(e[l],l)+";";var r=new Date(new Date().valueOf()+1e3*60*60*24*30).toUTCString(),s=" path=/; expires="+r;document.cookie="".concat(t,"=").concat(encodeURIComponent(c),"; ").concat(s)},i}(),se=cl;function J(i){var t;if(!i)return 0;var e=i.offsetLeft?i.offsetLeft:0;if(t=i,t.offsetParent){for(;t.offsetParent;)t=t.offsetParent,e+=t.offsetLeft;var n=t.ownerDocument;t.style.position=="fixed"&&n&&n.scrollingElement&&(e+=n.scrollingElement.scrollLeft)}if(t&&t.ownerDocument&&i.ownerDocument!=window.document){var c=t.ownerDocument;if(c&&c.defaultView&&c.defaultView.frameElement)return e+J(c.defaultView.frameElement)-c.documentElement.scrollLeft}return e}function Z(i){var t;if(!i)return 0;var e=i.offsetTop?i.offsetTop:0;if(t=i,t.ownerDocument&&t instanceof t.ownerDocument.defaultView.HTMLElement){for(;t.offsetParent;)t=t.offsetParent,e+=t.offsetTop;var n=t.ownerDocument;t.style.position=="fixed"&&n&&n.scrollingElement&&(e+=n.scrollingElement.scrollTop)}if(t&&t.ownerDocument&&i.ownerDocument!=window.document){var c=t.ownerDocument;if(c&&c.defaultView&&c.defaultView.frameElement)return e+Z(c.defaultView.frameElement)}return e}var yc=function(i){(0,d.__extends)(t,i);function t(e,n){return i.call(this,"KeymanWeb_".concat(e,"_Option_").concat(n))||this}return t.prototype.load=function(){return i.prototype.load.call(this,decodeURIComponent)},t.prototype.save=function(e){i.prototype.save.call(this,e,encodeURIComponent)},t}(se),rn=function(){function i(){}return i.prototype.loadStore=function(t,e){var n=new yc(t,e);return n.load()},i.prototype.saveStore=function(t,e,n){var c=new yc(t,e);c.save(n)},i}();var uc=function(i){(0,d.__extends)(t,i);function t(e,n,c){var l=i.call(this,e,n,new rn)||this;return l.insertText=function(r,s){l.resetContextCache(),l.engine.contextManager.insertText(l,r,s)},l.KT=l.insertText,l.engine=n,l.stubNamespacer=c,l}return t.prototype.preserveID=function(e){var n;if(document.currentScript)n=document.currentScript.id;else{var c=document.getElementsByTagName("script"),l=c[c.length-1];n=l.id}if(n)n.indexOf(pe(e.KI))!=-1?e.KI=n:console.error("Error when registering keyboard:  current SCRIPT tag's ID does not match!");else return},t.prototype.registerKeyboard=function(e){var n=this;i.prototype.registerKeyboard.call(this,e);var c=this.loadedKeyboard;this.preserveID(e),this.engine.config.deferForInitialization.then(function(){n.engine.keyboardRequisitioner.cache.isFetchingKeyboard(c.id)||(n.engine.keyboardRequisitioner.cache.addKeyboard(c),n.loadedKeyboard=null)})},t.prototype.registerStub=function(e){var n=this,c;this.stubNamespacer&&this.stubNamespacer(e);var l=this.engine.config.paths,r=new re(e,l.keyboards,l.fonts);return!((c=this.engine.keyboardRequisitioner)===null||c===void 0)&&c.cache.findMatchingStub(r)?1:(this.engine.config.deferForInitialization.hasFinalized?this.engine.keyboardRequisitioner.cache.addStub(r):this.engine.config.deferForInitialization.then(function(){return n.engine.keyboardRequisitioner.cache.addStub(r)}),null)},t}(Ke),sn=uc;(function(){uc.__publishShorthandAPI()})();var Ic=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this;return e&&e._jsGlobal!=window&&(e._jsGlobal.String=window.String),e?c=i.call(this,e)||this:c=i.call(this,new Me(window,De))||this,c.performCacheBusting=n||!1,c}return t.prototype.loadKeyboardInternal=function(e,n,c){var l=this,r=new R;this.performCacheBusting&&(e=this.cacheBust(e));try{var s=this.harness._jsGlobal.document,B=s.createElement("script");c&&(B.id=c),s.head.appendChild(B),B.onerror=function(o){r.reject(n.missingError(o))},B.onload=function(){if(l.harness.loadedKeyboard){var o=l.harness.loadedKeyboard;l.harness.loadedKeyboard=null,r.resolve(o)}else r.reject(n.scriptError())},r.then(function(){B.remove()}).catch(function(){B.remove()}),B.src=e}catch(o){return Promise.reject(o)}return r.corePromise},t.prototype.cacheBust=function(e){return e+"?v="+new Date().getTime()},t}(Tt);var il=function(){function i(t,e,n){this.left=t.getTextBeforeCaret(),this.startOfBuffer=this.left._kmwLength()<=e.leftContextCodePoints,this.startOfBuffer||(this.left=this.left._kmwSubstr(-e.leftContextCodePoints)),this.right=t.getTextAfterCaret(),this.endOfBuffer=this.right._kmwLength()<=e.rightContextCodePoints,this.endOfBuffer||(this.right=this.right._kmwSubstr(0,e.rightContextCodePoints)),this.casingForm=n=="shift"?"initial":n=="caps"?"upper":null}return i.prototype.toMock=function(){var t=this.left._kmwLength();return new H(this.left+(this.right||""),t)},i.ENGINE_RULE_WINDOW={leftContextCodePoints:64,rightContextCodePoints:32},i}(),ye=il;var hc=v(A(),1);var ll=function(){function i(){this._promises=new Map}return Object.defineProperty(i.prototype,"length",{get:function(){return this._promises.size},enumerable:!1,configurable:!0}),i.prototype.make=function(t,e,n){if(this._promises.has(t))return n("Existing request with token ".concat(t));this._promises.set(t,{reject:n,resolve:e})},i.prototype.keep=function(t,e){var n=this._promises.get(t);if(!n)throw new Error("No promise associated with token: ".concat(t));var c=n.resolve;return this._promises.delete(t),c(e)},i.prototype.break=function(t,e){var n=this._promises.get(t);if(!n)throw new Error("No promise associated with token: ".concat(t));this._promises.delete(t),n.reject(e)},i}(),Pe=ll;var rl=function(){function i(t,e,n){this._worker=e,this._worker.onmessage=this.onMessage.bind(this),this._declareLMLayerReady=null,this._predictPromises=new Pe,this._wordbreakPromises=new Pe,this._acceptPromises=new Pe,this._revertPromises=new Pe,this._nextToken=Number.MIN_SAFE_INTEGER,this.sendConfig(t,!!n)}return i.prototype.sendConfig=function(t,e){this._worker.postMessage({message:"config",capabilities:t,testMode:e})},i.prototype.loadModel=function(t,e){var n=this;return e===void 0&&(e="file"),new Promise(function(c,l){n._declareLMLayerReady=c;var r={type:e};e=="file"?r.file=t:r.code=t,n._worker.postMessage({message:"load",source:r})})},i.prototype.unloadModel=function(){this._worker.postMessage({message:"unload"})},i.prototype.predict=function(t,e){var n=this,c=this._nextToken++;return new Promise(function(l,r){n._predictPromises.make(c,l,r),n._worker.postMessage({message:"predict",token:c,transform:t,context:e})})},i.prototype.wordbreak=function(t){var e=this,n=this._nextToken++;return new Promise(function(c,l){e._wordbreakPromises.make(n,c,l),e._worker.postMessage({message:"wordbreak",token:n,context:t})})},i.prototype.acceptSuggestion=function(t,e,n){var c=this,l=this._nextToken++;return new Promise(function(r,s){c._acceptPromises.make(l,r,s),c._worker.postMessage({message:"accept",token:l,suggestion:t,context:e,postTransform:n})})},i.prototype.revertSuggestion=function(t,e){var n=this,c=this._nextToken++;return new Promise(function(l,r){n._revertPromises.make(c,l,r),n._worker.postMessage({message:"revert",token:c,reversion:t,context:e})})},i.prototype.resetContext=function(t){this._worker.postMessage({message:"reset-context",context:t})},i.prototype.onMessage=function(t){var e=t.data;if(e.message==="error")console.error(e.log),e.error&&console.error(e.error);else if(e.message==="ready")this._declareLMLayerReady(t.data.configuration);else if(e.message==="suggestions")this._predictPromises.keep(e.token,e.suggestions);else if(e.message==="currentword")this._wordbreakPromises.keep(e.token,e.word);else if(e.message==="postaccept")this._acceptPromises.keep(e.token,e.reversion);else if(e.message==="postrevert")this._revertPromises.keep(e.token,e.suggestions);else throw new Error("Message not implemented: ".concat(e.message))},i.prototype.shutdown=function(){this._worker.terminate()},i}(),Bn=rl;function Ft(i){return i}var Qc='var ae=Object.defineProperty;var v=(r,e)=>ae(r,"name",{value:e,configurable:!0});/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){"use strict";var r=function(){try{var t={},n=Object.defineProperty,i=n(t,t,t)&&n}catch(a){}return i}(),e=v(function(t){if(this==null)throw TypeError();var n=String(this),i=n.length,a=t?Number(t):0;if(a!=a&&(a=0),!(a<0||a>=i)){var u=n.charCodeAt(a),o;return u>=55296&&u<=56319&&i>a+1&&(o=n.charCodeAt(a+1),o>=56320&&o<=57343)?(u-55296)*1024+o-56320+65536:u}},"codePointAt");r?r(String.prototype,"codePointAt",{value:e,configurable:!0,writable:!0}):String.prototype.codePointAt=e}(),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(r){if(this==null)throw new TypeError("this is null or not defined");for(var e=Object(this),t=e.length>>>0,n=arguments[1],i=n>>0,a=i<0?Math.max(t+i,0):Math.min(i,t),u=arguments[2],o=u===void 0?t:u>>0,l=o<0?Math.max(t+o,0):Math.min(o,t);a<l;)e[a]=r,a++;return e}});/**\n* Array.prototype.findIndex() polyfill\n* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex\n* @license MIT\n*/Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(r){if(this==null)throw new TypeError(\'"this" is null or not defined\');var e=Object(this),t=e.length>>>0;if(typeof r!="function")throw new TypeError("predicate must be a function");for(var n=arguments[1],i=0;i<t;){var a=e[i];if(r.call(n,a,i,e))return i;i++}return-1},configurable:!0,writable:!0}),Array.from||(Array.from=function(){var r=Object.prototype.toString,e=v(function(a){return typeof a=="function"||r.call(a)==="[object Function]"},"isCallable"),t=v(function(a){var u=Number(a);return isNaN(u)?0:u===0||!isFinite(u)?u:(u>0?1:-1)*Math.floor(Math.abs(u))},"toInteger"),n=Math.pow(2,53)-1,i=v(function(a){var u=t(a);return Math.min(Math.max(u,0),n)},"toLength");return v(function(u){var o=this,l=Object(u);if(u==null)throw new TypeError("Array.from requires an array-like object - not null or undefined");var s=arguments.length>1?arguments[1]:void 0,f;if(typeof s!="undefined"){if(!e(s))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(f=arguments[2])}for(var c=i(l.length),d=e(o)?Object(new o(c)):new Array(c),p=0,g;p<c;)g=l[p],s?d[p]=typeof f=="undefined"?s(g,p):s.call(f,g,p):d[p]=g,p+=1;return d.length=c,d},"from")}()),Array.prototype.includes||(Array.prototype.includes=function(r){return!!~this.indexOf(r)}),Object.keys||(Object.keys=function(){"use strict";var r=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=t.length;return function(i){if(typeof i!="function"&&(typeof i!="object"||i===null))throw new TypeError("Object.keys called on non-object");var a=[],u,o;for(u in i)r.call(i,u)&&a.push(u);if(e)for(o=0;o<n;o++)r.call(i,t[o])&&a.push(t[o]);return a}}());var reduce=Function.bind.call(Function.call,Array.prototype.reduce),isEnumerable=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),concat=Function.bind.call(Function.call,Array.prototype.concat),keys=Object.keys;Object.values||(Object.values=v(function(e){return reduce(keys(e),function(t,n){return concat(t,typeof n=="string"&&isEnumerable(e,n)?[e[n]]:[])},[])},"values")),Object.entries||(Object.entries=v(function(e){return reduce(keys(e),function(t,n){return concat(t,typeof n=="string"&&isEnumerable(e,n)?[[n,e[n]]]:[])},[])},"entries")),function(r,e){"use strict";typeof module=="object"&&typeof module.exports=="object"?module.exports=e(r):e(r)}(typeof window!="undefined"?window:self||global,function(r){"use strict";var e=Object.defineProperty,t=Object.defineProperties,n=0,i=[],a=Array.prototype.slice,u=typeof r.ES6=="object"?r.ES6:r.ES6={},o=Array.isArray,l=Object.prototype.toString,s=Array.prototype.push,f=v(function(){},"emptyFunction"),c=v(function(h){return h},"simpleFunction"),d=v(function(h){return typeof h=="function"},"isCallable"),p=v(function(){},"Iterator"),g=v(function(h,m){this._array=h,this._flag=m,this._nextIndex=0},"ArrayIterator"),w=v(function(h,m){this._string=h,this._flag=m,this._nextIndex=0},"StringIterator"),b=v(function(h){return h!==null&&(typeof h=="object"||typeof h=="function")},"isObject"),T=v(function(h,m){return t(h,{_description:{value:m},_isSymbol:{value:!0},_id:{value:n++}}),h},"setupSymbolInternals"),S=v(function(h,m){if(typeof h.length=="number"&&h.length>=0&&typeof m.length=="number"&&m.length>=0){var O=Math.floor(h.length),k=Math.floor(m.length),A=0;for(h.length=O+k;A<k;++A)m.hasOwnProperty(A)&&(h[O+A]=m[A])}},"appendArray"),_=v(function(h,m){if(typeof h!="function"||typeof m!="function")throw new TypeError("Child and Parent must be function type");h.prototype=Object.create(m.prototype),h.prototype.constructor=h},"simpleInheritance"),y=v(function h(m){if(m=m===void 0?"":String(m),this instanceof h)throw new TypeError("Symbol is not a constructor");return T(Object.create(h.prototype),m)},"Symbol");t(y,{for:{value:function(h){h=String(h);for(var m,O=i.length,k=0;k<O;++k)if((m=i[k]).key===h)return m.symbol;return m={key:h,symbol:y(h)},i.push(m),m.symbol},writable:!0,configurable:!0},keyFor:{value:function(h){if(!u.isSymbol(h))throw new TypeError(String(h)+" is not a symbol");for(var m,O=i.length,k=0;k<O;++k)if((m=i[k]).symbol===h)return m.key},writable:!0,configurable:!0},hasInstance:{value:y("Symbol.hasInstance")},isConcatSpreadable:{value:y("Symbol.isConcatSpreadable")},iterator:{value:y("Symbol.iterator")},toStringTag:{value:y("Symbol.toStringTag")}}),y.prototype.toString=function(){return"@@_____"+this._id+"_____"},y.prototype.valueOf=function(){return this},e(p.prototype,y.iterator.toString(),{value:function(){return this},writable:!0,configurable:!0}),_(g,p),_(w,p),e(g.prototype,y.toStringTag.toString(),{value:"Array Iterator",configurable:!0}),e(w.prototype,y.toStringTag.toString(),{value:"String Iterator",configurable:!0}),g.prototype.next=function(){if(!(this instanceof g))throw new TypeError("Method Array Iterator.prototype.next called on incompatible receiver "+String(this));var h;return this._nextIndex===-1?{done:!0,value:void 0}:typeof this._array.length=="number"&&this._array.length>=0&&this._nextIndex<Math.floor(this._array.length)?(this._flag===1?h=[this._nextIndex,this._array[this._nextIndex]]:this._flag===2?h=this._array[this._nextIndex]:this._flag===3&&(h=this._nextIndex),this._nextIndex++,{done:!1,value:h}):(this._nextIndex=-1,{done:!0,value:void 0})},w.prototype.next=function(){if(!(this instanceof w))throw new TypeError("Method String Iterator.prototype.next called on incompatible receiver "+String(this));var h,m=new String(this._string);return this._nextIndex===-1?{done:!0,value:void 0}:this._nextIndex<m.length?(h=m[this._nextIndex],this._nextIndex++,{done:!1,value:h}):(this._nextIndex=-1,{done:!0,value:void 0})};var C=v(function(h,m){this._target=h,this._values=[],this._thisArg=m},"SpreadOperatorImpl");return C.prototype.spread=function(){var h=this;return a.call(arguments).forEach(function(m){u.forOf(m,function(O){h._values.push(O)})}),h},C.prototype.add=function(){var h=this;return a.call(arguments).forEach(function(m){h._values.push(m)}),h},C.prototype.call=function(h){if(typeof this._target!="function")throw new TypeError("Target is not a function");return h=arguments.length<=0?this._thisArg:h,this._target.apply(h,this._values)},C.prototype.new=function(){if(typeof this._target!="function")throw new TypeError("Target is not a constructor");var h,m;return h=Object.create(this._target.prototype),m=this._target.apply(h,this._values),b(m)?m:h},C.prototype.array=function(){if(!o(this._target))throw new TypeError("Target is not a array");return s.apply(this._target,this._values),this._target},t(u,{isSymbol:{value:function(h){return h instanceof y&&function(m){return m._isSymbol===!0&&typeof m._id=="number"&&typeof m._description=="string"}(h)},writable:!0,configurable:!0},instanceOf:{value:function(h,m){if(!b(m))throw new TypeError("Right-hand side of \'instanceof\' is not an object");var O=m[y.hasInstance];if(O===void 0)return h instanceof m;if(typeof O!="function")throw new TypeError(typeof O+" is not a function");return O.call(m,h)},writable:!0,configurable:!0},forOf:{value:function(h,m,O){if(m=typeof m!="function"?f:m,typeof h[y.iterator]!="function")throw new TypeError("Iterable[Symbol.iterator] is not a function");var k,A=h[y.iterator]();if(typeof A.next!="function")throw new TypeError(".iterator.next is not a function");for(;;){if(k=A.next(),!b(k))throw new TypeError("Iterator result "+k+" is not an object");if(k.done)break;m.call(O,k.value)}},writable:!0,configurable:!0},spreadOperator:{value:function(h,m){if(typeof h!="function"&&!o(h))throw new TypeError("Spread operator only supports on array and function objects at this moment");return new C(h,m)},writable:!0,configurable:!0}}),e(r,"Symbol",{value:y,writable:!0,configurable:!0}),e(Function.prototype,y.hasInstance.toString(),{value:function(h){return typeof this=="function"&&h instanceof this}}),e(Array.prototype,"concat",{value:function(){if(this===void 0||this===null)throw new TypeError("Array.prototype.concat called on null or undefined");var h=Object(this),m=a.call(arguments),O=[];return m.unshift(h),m.forEach(function(k){b(k)?k[y.isConcatSpreadable]!==void 0?k[y.isConcatSpreadable]?S(O,k):O.push(k):o(k)?S(O,k):O.push(k):O.push(k)}),O},writable:!0,configurable:!0}),e(Object.prototype,"toString",{value:function(){return this===void 0||this===null?l.call(this):typeof this[y.toStringTag]=="string"?"[object "+this[y.toStringTag]+"]":l.call(this)},writable:!0,configurable:!0}),e(Array.prototype,y.iterator.toString(),{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var h=Object(this);return new g(h,2)},writable:!0,configurable:!0}),e(Array,"from",{value:function(h,m,O){var k,A,I,E=0;if(k=d(this)?this:Array,h==null)throw new TypeError("Cannot convert undefined or null to object");if(h=Object(h),m===void 0)m=c;else if(!d(m))throw new TypeError(m+" is not a function");if(h[y.iterator]===void 0){if(!(typeof h.length=="number"&&h.length>=0))return(I=new k(0)).length=0,I;for(A=Math.floor(h.length),(I=new k(A)).length=A;E<A;++E)I[E]=m.call(O,h[E])}else(I=new k).length=0,u.forOf(h,function(D){I.length++,I[I.length-1]=m.call(O,D)});return I},writable:!0,configurable:!0}),e(Array.prototype,"entries",{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var h=Object(this);return new g(h,1)},writable:!0,configurable:!0}),e(Array.prototype,"keys",{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var h=Object(this);return new g(h,3)},writable:!0,configurable:!0}),e(String.prototype,y.iterator.toString(),{value:function(){if(this===void 0||this===null)throw new TypeError("String.prototype[Symbol.iterator] called on null or undefined");return new w(String(this),0)},writable:!0,configurable:!0}),u});var __create=Object.create,__defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__getOwnPropNames=Object.getOwnPropertyNames,__getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty,__commonJS=v(function(r,e){return v(function(){return e||(0,r[__getOwnPropNames(r)[0]])((e={exports:{}}).exports,e),e.exports},"__require")},"__commonJS"),__export=v(function(r,e){for(var t in e)__defProp(r,t,{get:e[t],enumerable:!0})},"__export"),__copyProps=v(function(r,e,t,n){if(e&&typeof e=="object"||typeof e=="function")for(var i=__getOwnPropNames(e),a=0,u=i.length,o;a<u;a++)o=i[a],!__hasOwnProp.call(r,o)&&o!==t&&__defProp(r,o,{get:function(l){return e[l]}.bind(null,o),enumerable:!(n=__getOwnPropDesc(e,o))||n.enumerable});return r},"__copyProps"),__reExport=v(function(r,e,t){return __copyProps(r,e,"default"),t&&__copyProps(t,e,"default")},"__reExport"),__toESM=v(function(r,e,t){return t=r!=null?__create(__getProtoOf(r)):{},__copyProps(e||!r||!r.__esModule?__defProp(t,"default",{value:r,enumerable:!0}):t,r)},"__toESM"),require_tslib=__commonJS({"../../../node_modules/tslib/tslib.js":function(r,e){var t,n,i,a,u;(function(o){var l=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(f){o(s(l,s(f)))}):typeof e=="object"&&typeof e.exports=="object"?o(s(l,s(e.exports))):o(s(l));function s(f,c){return f!==l&&(typeof Object.create=="function"?Object.defineProperty(f,"__esModule",{value:!0}):f.__esModule=!0),function(d,p){return f[d]=c?c(d,p):p}}v(s,"createExporter")})(function(o){var l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,f){s.__proto__=f}||function(s,f){for(var c in f)Object.prototype.hasOwnProperty.call(f,c)&&(s[c]=f[c])};t=v(function(s,f){if(typeof f!="function"&&f!==null)throw new TypeError("Class extends value "+String(f)+" is not a constructor or null");l(s,f);function c(){this.constructor=s}v(c,"__"),s.prototype=f===null?Object.create(f):(c.prototype=f.prototype,new c)},"__extends2"),n=Object.assign||function(s){for(var f,c=1,d=arguments.length;c<d;c++){f=arguments[c];for(var p in f)Object.prototype.hasOwnProperty.call(f,p)&&(s[p]=f[p])}return s},i=v(function(s,f){var c={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},d,p,g,w;return w={next:b(0),throw:b(1),return:b(2)},typeof Symbol=="function"&&(w[Symbol.iterator]=function(){return this}),w;function b(S){return function(_){return T([S,_])}}function T(S){if(d)throw new TypeError("Generator is already executing.");for(;w&&(w=0,S[0]&&(c=0)),c;)try{if(d=1,p&&(g=S[0]&2?p.return:S[0]?p.throw||((g=p.return)&&g.call(p),0):p.next)&&!(g=g.call(p,S[1])).done)return g;switch(p=0,g&&(S=[S[0]&2,g.value]),S[0]){case 0:case 1:g=S;break;case 4:return c.label++,{value:S[1],done:!1};case 5:c.label++,p=S[1],S=[0];continue;case 7:S=c.ops.pop(),c.trys.pop();continue;default:if(g=c.trys,!(g=g.length>0&&g[g.length-1])&&(S[0]===6||S[0]===2)){c=0;continue}if(S[0]===3&&(!g||S[1]>g[0]&&S[1]<g[3])){c.label=S[1];break}if(S[0]===6&&c.label<g[1]){c.label=g[1],g=S;break}if(g&&c.label<g[2]){c.label=g[2],c.ops.push(S);break}g[2]&&c.ops.pop(),c.trys.pop();continue}S=f.call(s,c)}catch(_){S=[6,_],p=0}finally{d=g=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}},"__generator3"),a=v(function(s){var f=typeof Symbol=="function"&&Symbol.iterator,c=f&&s[f],d=0;if(c)return c.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&d>=s.length&&(s=void 0),{value:s&&s[d++],done:!s}}};throw new TypeError(f?"Object is not iterable.":"Symbol.iterator is not defined.")},"__values7"),u=v(function(s,f){var c=typeof Symbol=="function"&&s[Symbol.iterator];if(!c)return s;var d=c.call(s),p,g=[],w;try{for(;(f===void 0||f-- >0)&&!(p=d.next()).done;)g.push(p.value)}catch(b){w={error:b}}finally{try{p&&!p.done&&(c=d.return)&&c.call(d)}finally{if(w)throw w.error}}return g},"__read3"),o("__extends",t),o("__assign",n),o("__generator",i),o("__values",a),o("__read",u)})}}),build_exports={};__export(build_exports,{tslib:function(){return tslib_1}}),__reExport(build_exports,__toESM(require_tslib(),1));var tslib_1=__toESM(require_tslib(),1),DeviceSpec=function(){function r(e,t,n,i){switch(e.toLowerCase()){case r.Browser.Chrome:case r.Browser.Edge:case r.Browser.Firefox:case r.Browser.Native:case r.Browser.Opera:case r.Browser.Safari:this.browser=e.toLowerCase();break;default:this.browser=r.Browser.Other}switch(t.toLowerCase()){case r.FormFactor.Desktop:case r.FormFactor.Phone:case r.FormFactor.Tablet:this.formFactor=t.toLowerCase();break;default:throw"Invalid form factor specified for device: "+t}switch(n.toLowerCase()){case r.OperatingSystem.Windows.toLowerCase():case r.OperatingSystem.macOS.toLowerCase():case r.OperatingSystem.Linux.toLowerCase():case r.OperatingSystem.Android.toLowerCase():case r.OperatingSystem.iOS.toLowerCase():this.OS=n.toLowerCase();break;default:this.OS=r.OperatingSystem.Other}this.touchable=i}return v(r,"DeviceSpec2"),r}();(function(r){var e;(function(i){i.Chrome="chrome",i.Edge="edge",i.Firefox="firefox",i.Native="native",i.Opera="opera",i.Safari="safari",i.Other="other"})(e=r.Browser||(r.Browser={}));var t;(function(i){i.Windows="windows",i.macOS="macosx",i.Linux="linux",i.Android="android",i.iOS="ios",i.Other="other"})(t=r.OperatingSystem||(r.OperatingSystem={}));var n;(function(i){i.Desktop="desktop",i.Phone="phone",i.Tablet="tablet"})(n=r.FormFactor||(r.FormFactor={}))})(DeviceSpec||(DeviceSpec={}));function extendString(){String.kmwFromCharCode=function(r){var e=[],t;for(t=0;t<arguments.length;t++){var n=Number(arguments[t]);if(!isFinite(n)||n<0||n>1114111||Math.floor(n)!==n)throw new RangeError("Invalid code point "+n);n<65536?e.push(n):(n-=65536,e.push((n>>10)+55296),e.push(n%1024+56320))}return String.fromCharCode.apply(void 0,e)},String.prototype.kmwCharCodeAt=function(r){var e=String(this),t=0;if(r<0||r>=e.length)return NaN;for(var n=0;n<r;n++)if(t=e.kmwNextChar(t),t===null)return NaN;var i=e.charCodeAt(t);if(i>=55296&&i<=56319&&e.length>t+1){var a=e.charCodeAt(t+1);if(a>=56320&&a<=57343)return(i-55296<<10)+(a-56320)+65536}return i},String.prototype.kmwIndexOf=function(r,e){var t=String(this),n=t.indexOf(r,e);if(n<0)return n;for(var i=0,a=0;a!==null&&a<n;a=t.kmwNextChar(a))i++;return i},String.prototype.kmwLastIndexOf=function(r,e){var t=String(this),n=t.lastIndexOf(r,e);if(n<0)return n;for(var i=0,a=0;a!==null&&a<n;a=t.kmwNextChar(a))i++;return i},String.prototype.kmwLength=function(){var r=String(this);if(r.length==0)return 0;for(var e=0,t=0;t!==null;e++)t=r.kmwNextChar(t);return e},String.prototype.kmwSlice=function(r,e){var t=String(this),n=t.kmwCodePointToCodeUnit(r),i=t.kmwCodePointToCodeUnit(e);return n===null||i===null?"":t.slice(n,i)},String.prototype.kmwSubstr=function(r,e){var t=String(this);r<0&&(r=t.kmwLength()+r),r<0&&(r=0);var n=t.kmwCodePointToCodeUnit(r),i=n;if(n===null)return"";if(arguments.length<2)i=t.length;else for(var a=0;a<e;a++)i=t.kmwNextChar(i);return i===null?t.substring(n):t.substring(n,i)},String.prototype.kmwSubstring=function(r,e){var t=String(this),n,i;if(typeof e=="undefined")n=t.kmwCodePointToCodeUnit(r),i=t.length;else{if(r>e){var a=r;r=e,e=a}n=t.kmwCodePointToCodeUnit(r),i=t.kmwCodePointToCodeUnit(e)}return(isNaN(n)||n===null)&&(n=0),(isNaN(i)||i===null)&&(i=t.length),t.substring(n,i)},String.prototype.kmwNextChar=function(r){var e=String(this);if(r===null||r<0||r>=e.length-1)return null;var t=e.charCodeAt(r);if(t>=55296&&t<=56319&&e.length>r+1){var n=e.charCodeAt(r+1);if(n>=56320&&n<=57343)return r==e.length-2?null:r+2}return r+1},String.prototype.kmwPrevChar=function(r){var e=String(this);if(r==null||r<=0||r>e.length)return null;var t=e.charCodeAt(r-1);if(t>=56320&&t<=57343&&r>1){var n=e.charCodeAt(r-2);if(n>=55296&&n<=56319)return r-2}return r-1},String.prototype.kmwCodePointToCodeUnit=function(r){if(r===null)return null;var e=String(this),t=0;if(r<0){t=e.length;for(var n=0;n>r;n--)t=e.kmwPrevChar(t);return t}if(r==e.kmwLength())return e.length;for(var n=0;n<r;n++)t=e.kmwNextChar(t);return t},String.prototype.kmwCodeUnitToCodePoint=function(r){var e=String(this);return r===null?null:r==0?0:r<0?e.substr(r).kmwLength():e.substr(0,r).kmwLength()},String.prototype.kmwCharAt=function(r){var e=String(this);return r>=0?e.kmwSubstr(r,1):""},String.prototype.kmwBMPNextChar=function(r){var e=String(this);return r<0||r>=e.length-1?null:r+1},String.prototype.kmwBMPPrevChar=function(r){var e=String(this);return r<=0||r>e.length?null:r-1},String.prototype.kmwBMPCodePointToCodeUnit=function(r){return r},String.prototype.kmwBMPCodeUnitToCodePoint=function(r){return r},String.prototype.kmwBMPLength=function(){var r=String(this);return r.length},String.prototype.kmwBMPSubstr=function(r,e){var t=String(this);return r>-1?t.substr(r,e):t.substr(t.length+r,-r)},String.kmwEnableSupplementaryPlane=function(r){var e=String.prototype;String._kmwFromCharCode=r?String.kmwFromCharCode:String.fromCharCode,e._kmwCharAt=r?e.kmwCharAt:e.charAt,e._kmwCharCodeAt=r?e.kmwCharCodeAt:e.charCodeAt,e._kmwIndexOf=r?e.kmwIndexOf:e.indexOf,e._kmwLastIndexOf=r?e.kmwLastIndexOf:e.lastIndexOf,e._kmwSlice=r?e.kmwSlice:e.slice,e._kmwSubstring=r?e.kmwSubstring:e.substring,e._kmwSubstr=r?e.kmwSubstr:e.kmwBMPSubstr,e._kmwLength=r?e.kmwLength:e.kmwBMPLength,e._kmwNextChar=r?e.kmwNextChar:e.kmwBMPNextChar,e._kmwPrevChar=r?e.kmwPrevChar:e.kmwBMPPrevChar,e._kmwCodePointToCodeUnit=r?e.kmwCodePointToCodeUnit:e.kmwBMPCodePointToCodeUnit,e._kmwCodeUnitToCodePoint=r?e.kmwCodeUnitToCodePoint:e.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}v(extendString,"extendString"),extendString();var models_exports={};__export(models_exports,{DummyModel:function(){return dummy_model_default},PriorityQueue:function(){return priority_queue_default},QuoteBehavior:function(){return quote_behavior_default},SENTINEL_CODE_UNIT:function(){return SENTINEL_CODE_UNIT},TrieModel:function(){return trie_model_default},applyTransform:function(){return applyTransform},buildMergedTransform:function(){return buildMergedTransform},defaultApplyCasing:function(){return defaultApplyCasing},getLastPreCaretToken:function(){return getLastPreCaretToken},isHighSurrogate:function(){return isHighSurrogate},isLowSurrogate:function(){return isLowSurrogate},isSentinel:function(){return isSentinel},tokenize:function(){return tokenize},transformToSuggestion:function(){return transformToSuggestion},wordbreak:function(){return wordbreak}}),extendString();var SENTINEL_CODE_UNIT="\\uFDD0";function applyTransform(r,e){var t,n,i=e.left||"",a=i.kmwLength(),u=a<r.deleteLeft?a:r.deleteLeft,o=i.kmwSubstr(0,a-u)+(r.insert||""),l=e.right||"",s=l.kmwLength(),f=s<((t=r.deleteRight)!==null&&t!==void 0?t:0)?s:(n=r.deleteRight)!==null&&n!==void 0?n:0,c=l.kmwSubstr(f);return{left:o,right:c,startOfBuffer:e.startOfBuffer,endOfBuffer:e.endOfBuffer,casingForm:e.casingForm}}v(applyTransform,"applyTransform");function buildMergedTransform(r,e){var t=r.insert,n=e.deleteLeft;if(e.deleteLeft){var i=r.insert.kmwLength();i<=e.deleteLeft?(t="",n=e.deleteLeft-i):(t=r.insert.kmwSubstr(0,i-e.deleteLeft),n=0)}return{insert:t+e.insert,deleteLeft:r.deleteLeft+n,deleteRight:(r.deleteRight||0)+(e.deleteRight||0)}}v(buildMergedTransform,"buildMergedTransform");function isHighSurrogate(r){return typeof r=="string"&&(r=r.charCodeAt(0)),r>=55296&&r<=56319}v(isHighSurrogate,"isHighSurrogate");function isLowSurrogate(r){return typeof r=="string"&&(r=r.charCodeAt(0)),r>=56320&&r<=57343}v(isLowSurrogate,"isLowSurrogate");function isSentinel(r){return r==SENTINEL_CODE_UNIT}v(isSentinel,"isSentinel");function transformToSuggestion(r,e){var t={transform:r,transformId:r.id,displayAs:r.insert};return(e===0||e)&&(t.p=e),t}v(transformToSuggestion,"transformToSuggestion");function defaultApplyCasing(r,e){switch(r){case"lower":return e.toLowerCase();case"upper":return e.toUpperCase();case"initial":var t=1;return e.length>1&&isHighSurrogate(e.charAt(0))&&isLowSurrogate(e.charCodeAt(1))&&(t=2),e.substring(0,t).toUpperCase().concat(e.substring(t))}}v(defaultApplyCasing,"defaultApplyCasing");var PriorityQueue=function(){function r(e,t){t===void 0&&(t=[]),this.comparator=e,this.heap=Array.from(t),this.heapify()}return v(r,"PriorityQueue2"),r.leftChildIndex=function(e){return e*2+1},r.rightChildIndex=function(e){return e*2+2},r.parentIndex=function(e){return Math.floor((e-1)/2)},r.prototype.heapify=function(e,t){if(e==null||t==null){this.heapify(0,this.count-1);return}for(var n=[],i=-1,a=t;a>=e;a--){var u=r.parentIndex(a);this.siftDown(a)&&u<e&&i!=u&&(n.push(u),i=u)}for(i=-1;n.length>0;){var o=n.shift(),u=r.parentIndex(o);this.siftDown(o)&&u>=0&&i!=u&&(n.push(u),i=u)}},Object.defineProperty(r.prototype,"count",{get:function(){return this.heap.length},enumerable:!1,configurable:!0}),r.prototype.peek=function(){return this.heap[0]},r.prototype.enqueue=function(e){var t=this.heap.length;this.heap.push(e);for(var n=r.parentIndex,i=n(t);t!==0&&this.comparator(this.heap[t],this.heap[i])<0;){var a=this.heap[t];this.heap[t]=this.heap[i],this.heap[i]=a,t=i,i=n(t)}},r.prototype.enqueueAll=function(e){if(e.length!=0){var t=this.count;this.heap=this.heap.concat(e);var n=r.parentIndex(t);this.heapify(n>=0?n:0,r.parentIndex(this.count-1))}},r.prototype.dequeue=function(){if(this.count!=0){var e=this.heap[0],t=this.heap.pop();return this.heap.length>0&&(this.heap[0]=t,this.siftDown(0)),e}},r.prototype.siftDown=function(e){var t=r.leftChildIndex(e),n=r.rightChildIndex(e),i=e;if(t<this.heap.length&&this.comparator(this.heap[t],this.heap[i])<0&&(i=t),n<this.heap.length&&this.comparator(this.heap[n],this.heap[i])<0&&(i=n),i!=e){var a=this.heap[e];return this.heap[e]=this.heap[i],this.heap[i]=a,this.siftDown(i),!0}else return!1},r.prototype.toArray=function(){return Array.from(this.heap)},r}(),priority_queue_default=PriorityQueue,QuoteBehavior;(function(r){r.noQuotes="no-quotes",r.useQuotes="use-quotes",r.default="default-quotes"})(QuoteBehavior||(QuoteBehavior={})),function(r){function e(t,n,i,a){if(a==r.default||!a)throw"Specified quote behavior may be ambiguous - default behavior not specified (may not be .default)";switch(t==r.default&&(t=a),t){case r.noQuotes:return n;case r.useQuotes:var u=i.quotesForKeepSuggestion,o=u.open,l=u.close;return o+n+l;default:throw"Unsupported quote behavior state detected; implementation missing!"}}v(e,"apply"),r.apply=e}(QuoteBehavior||(QuoteBehavior={}));var quote_behavior_default=QuoteBehavior;function tokenize(r,e){e=e||{left:void 0,startOfBuffer:void 0,endOfBuffer:void 0};var t=r(e.left||"")||[],n=r(e.right||"")||[],i;if(t.length>0&&(i=t[t.length-1]),t.length>1){var a=t[t.length-2];if(a.end==i.start&&i.text=="\'"){var u={text:a.text+i.text,start:a.start,end:i.end,length:a.length+i.length};t.pop(),t.pop(),t.push(u),i=u}}var o={left:t.map(function(c){return c.text}),right:n.map(function(c){return c.text}),caretSplitsToken:!1};if(t.length>0&&n.length>0){var l=n[0],s=i.end!=e.left.length,f=l.start!=0;if(s||f)return o;r(i.text+l.text).length==1&&(o.caretSplitsToken=!0)}return o}v(tokenize,"tokenize");function getLastPreCaretToken(r,e){var t=tokenize(r,e);return t.left.length>0?t.left.pop():""}v(getLastPreCaretToken,"getLastPreCaretToken");function wordbreak(r,e){return getLastPreCaretToken(r,e)}v(wordbreak,"wordbreak");var obj_exports={};__export(obj_exports,{ascii:function(){return ascii},default:function(){return default_},defaultWordbreaker:function(){return default_},placeholder:function(){return placeholder}});function placeholder(r){var e=0;return r.split(/\\s+/).map(function(t){var n={start:e,end:e+t.length,text:t,length:t.length};return e=n.end,n})}v(placeholder,"placeholder");function ascii(r){for(var e=/[A-Za-z0-9\']+/g,t=[],n;(n=e.exec(r))!==null;)t.push(new RegExpDerivedSpan(n[0],n.index));return t}v(ascii,"ascii");var RegExpDerivedSpan=function(){function r(e,t){this.text=e,this.start=t}return v(r,"RegExpDerivedSpan2"),Object.defineProperty(r.prototype,"length",{get:function(){return this.text.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"end",{get:function(){return this.start+this.text.length},enumerable:!1,configurable:!0}),r}(),propertyMap=["Other","LF","Newline","CR","WSegSpace","Double_Quote","Single_Quote","MidNum","MidNumLet","Numeric","MidLetter","ALetter","ExtendNumLet","Format","Extend","Hebrew_Letter","ZWJ","Katakana","Regional_Indicator","sot","eot"],WORD_BREAK_PROPERTY=[[0,0],[10,1],[11,2],[13,3],[14,0],[32,4],[33,0],[34,5],[35,0],[39,6],[40,0],[44,7],[45,0],[46,8],[47,0],[48,9],[58,10],[59,7],[60,0],[65,11],[91,0],[95,12],[96,0],[97,11],[123,0],[133,2],[134,0],[170,11],[171,0],[173,13],[174,0],[181,11],[182,0],[183,10],[184,0],[186,11],[187,0],[192,11],[215,0],[216,11],[247,0],[248,11],[728,0],[734,11],[768,14],[880,11],[885,0],[886,11],[888,0],[890,11],[894,7],[895,11],[896,0],[902,11],[903,10],[904,11],[907,0],[908,11],[909,0],[910,11],[930,0],[931,11],[1014,0],[1015,11],[1154,0],[1155,14],[1162,11],[1328,0],[1329,11],[1367,0],[1369,11],[1373,0],[1374,11],[1375,10],[1376,11],[1417,7],[1418,11],[1419,0],[1425,14],[1470,0],[1471,14],[1472,0],[1473,14],[1475,0],[1476,14],[1478,0],[1479,14],[1480,0],[1488,15],[1515,0],[1519,15],[1523,11],[1524,10],[1525,0],[1536,13],[1542,0],[1548,7],[1550,0],[1552,14],[1563,0],[1564,13],[1565,0],[1568,11],[1611,14],[1632,9],[1642,0],[1643,9],[1644,7],[1645,0],[1646,11],[1648,14],[1649,11],[1748,0],[1749,11],[1750,14],[1757,13],[1758,0],[1759,14],[1765,11],[1767,14],[1769,0],[1770,14],[1774,11],[1776,9],[1786,11],[1789,0],[1791,11],[1792,0],[1807,13],[1808,11],[1809,14],[1810,11],[1840,14],[1867,0],[1869,11],[1958,14],[1969,11],[1970,0],[1984,9],[1994,11],[2027,14],[2036,11],[2038,0],[2040,7],[2041,0],[2042,11],[2043,0],[2045,14],[2046,0],[2048,11],[2070,14],[2074,11],[2075,14],[2084,11],[2085,14],[2088,11],[2089,14],[2094,0],[2112,11],[2137,14],[2140,0],[2144,11],[2155,0],[2208,11],[2229,0],[2230,11],[2248,0],[2259,14],[2274,13],[2275,14],[2308,11],[2362,14],[2365,11],[2366,14],[2384,11],[2385,14],[2392,11],[2402,14],[2404,0],[2406,9],[2416,0],[2417,11],[2433,14],[2436,0],[2437,11],[2445,0],[2447,11],[2449,0],[2451,11],[2473,0],[2474,11],[2481,0],[2482,11],[2483,0],[2486,11],[2490,0],[2492,14],[2493,11],[2494,14],[2501,0],[2503,14],[2505,0],[2507,14],[2510,11],[2511,0],[2519,14],[2520,0],[2524,11],[2526,0],[2527,11],[2530,14],[2532,0],[2534,9],[2544,11],[2546,0],[2556,11],[2557,0],[2558,14],[2559,0],[2561,14],[2564,0],[2565,11],[2571,0],[2575,11],[2577,0],[2579,11],[2601,0],[2602,11],[2609,0],[2610,11],[2612,0],[2613,11],[2615,0],[2616,11],[2618,0],[2620,14],[2621,0],[2622,14],[2627,0],[2631,14],[2633,0],[2635,14],[2638,0],[2641,14],[2642,0],[2649,11],[2653,0],[2654,11],[2655,0],[2662,9],[2672,14],[2674,11],[2677,14],[2678,0],[2689,14],[2692,0],[2693,11],[2702,0],[2703,11],[2706,0],[2707,11],[2729,0],[2730,11],[2737,0],[2738,11],[2740,0],[2741,11],[2746,0],[2748,14],[2749,11],[2750,14],[2758,0],[2759,14],[2762,0],[2763,14],[2766,0],[2768,11],[2769,0],[2784,11],[2786,14],[2788,0],[2790,9],[2800,0],[2809,11],[2810,14],[2816,0],[2817,14],[2820,0],[2821,11],[2829,0],[2831,11],[2833,0],[2835,11],[2857,0],[2858,11],[2865,0],[2866,11],[2868,0],[2869,11],[2874,0],[2876,14],[2877,11],[2878,14],[2885,0],[2887,14],[2889,0],[2891,14],[2894,0],[2901,14],[2904,0],[2908,11],[2910,0],[2911,11],[2914,14],[2916,0],[2918,9],[2928,0],[2929,11],[2930,0],[2946,14],[2947,11],[2948,0],[2949,11],[2955,0],[2958,11],[2961,0],[2962,11],[2966,0],[2969,11],[2971,0],[2972,11],[2973,0],[2974,11],[2976,0],[2979,11],[2981,0],[2984,11],[2987,0],[2990,11],[3002,0],[3006,14],[3011,0],[3014,14],[3017,0],[3018,14],[3022,0],[3024,11],[3025,0],[3031,14],[3032,0],[3046,9],[3056,0],[3072,14],[3077,11],[3085,0],[3086,11],[3089,0],[3090,11],[3113,0],[3114,11],[3130,0],[3133,11],[3134,14],[3141,0],[3142,14],[3145,0],[3146,14],[3150,0],[3157,14],[3159,0],[3160,11],[3163,0],[3168,11],[3170,14],[3172,0],[3174,9],[3184,0],[3200,11],[3201,14],[3204,0],[3205,11],[3213,0],[3214,11],[3217,0],[3218,11],[3241,0],[3242,11],[3252,0],[3253,11],[3258,0],[3260,14],[3261,11],[3262,14],[3269,0],[3270,14],[3273,0],[3274,14],[3278,0],[3285,14],[3287,0],[3294,11],[3295,0],[3296,11],[3298,14],[3300,0],[3302,9],[3312,0],[3313,11],[3315,0],[3328,14],[3332,11],[3341,0],[3342,11],[3345,0],[3346,11],[3387,14],[3389,11],[3390,14],[3397,0],[3398,14],[3401,0],[3402,14],[3406,11],[3407,0],[3412,11],[3415,14],[3416,0],[3423,11],[3426,14],[3428,0],[3430,9],[3440,0],[3450,11],[3456,0],[3457,14],[3460,0],[3461,11],[3479,0],[3482,11],[3506,0],[3507,11],[3516,0],[3517,11],[3518,0],[3520,11],[3527,0],[3530,14],[3531,0],[3535,14],[3541,0],[3542,14],[3543,0],[3544,14],[3552,0],[3558,9],[3568,0],[3570,14],[3572,0],[3633,14],[3634,0],[3636,14],[3643,0],[3655,14],[3663,0],[3664,9],[3674,0],[3761,14],[3762,0],[3764,14],[3773,0],[3784,14],[3790,0],[3792,9],[3802,0],[3840,11],[3841,0],[3864,14],[3866,0],[3872,9],[3882,0],[3893,14],[3894,0],[3895,14],[3896,0],[3897,14],[3898,0],[3902,14],[3904,11],[3912,0],[3913,11],[3949,0],[3953,14],[3973,0],[3974,14],[3976,11],[3981,14],[3992,0],[3993,14],[4029,0],[4038,14],[4039,0],[4139,14],[4159,0],[4160,9],[4170,0],[4182,14],[4186,0],[4190,14],[4193,0],[4194,14],[4197,0],[4199,14],[4206,0],[4209,14],[4213,0],[4226,14],[4238,0],[4239,14],[4240,9],[4250,14],[4254,0],[4256,11],[4294,0],[4295,11],[4296,0],[4301,11],[4302,0],[4304,11],[4347,0],[4348,11],[4681,0],[4682,11],[4686,0],[4688,11],[4695,0],[4696,11],[4697,0],[4698,11],[4702,0],[4704,11],[4745,0],[4746,11],[4750,0],[4752,11],[4785,0],[4786,11],[4790,0],[4792,11],[4799,0],[4800,11],[4801,0],[4802,11],[4806,0],[4808,11],[4823,0],[4824,11],[4881,0],[4882,11],[4886,0],[4888,11],[4955,0],[4957,14],[4960,0],[4992,11],[5008,0],[5024,11],[5110,0],[5112,11],[5118,0],[5121,11],[5741,0],[5743,11],[5760,4],[5761,11],[5787,0],[5792,11],[5867,0],[5870,11],[5881,0],[5888,11],[5901,0],[5902,11],[5906,14],[5909,0],[5920,11],[5938,14],[5941,0],[5952,11],[5970,14],[5972,0],[5984,11],[5997,0],[5998,11],[6001,0],[6002,14],[6004,0],[6068,14],[6100,0],[6109,14],[6110,0],[6112,9],[6122,0],[6155,14],[6158,13],[6159,0],[6160,9],[6170,0],[6176,11],[6265,0],[6272,11],[6277,14],[6279,11],[6313,14],[6314,11],[6315,0],[6320,11],[6390,0],[6400,11],[6431,0],[6432,14],[6444,0],[6448,14],[6460,0],[6470,9],[6480,0],[6608,9],[6618,0],[6656,11],[6679,14],[6684,0],[6741,14],[6751,0],[6752,14],[6781,0],[6783,14],[6784,9],[6794,0],[6800,9],[6810,0],[6832,14],[6849,0],[6912,14],[6917,11],[6964,14],[6981,11],[6988,0],[6992,9],[7002,0],[7019,14],[7028,0],[7040,14],[7043,11],[7073,14],[7086,11],[7088,9],[7098,11],[7142,14],[7156,0],[7168,11],[7204,14],[7224,0],[7232,9],[7242,0],[7245,11],[7248,9],[7258,11],[7294,0],[7296,11],[7305,0],[7312,11],[7355,0],[7357,11],[7360,0],[7376,14],[7379,0],[7380,14],[7401,11],[7405,14],[7406,11],[7412,14],[7413,11],[7415,14],[7418,11],[7419,0],[7424,11],[7616,14],[7674,0],[7675,14],[7680,11],[7958,0],[7960,11],[7966,0],[7968,11],[8006,0],[8008,11],[8014,0],[8016,11],[8024,0],[8025,11],[8026,0],[8027,11],[8028,0],[8029,11],[8030,0],[8031,11],[8062,0],[8064,11],[8117,0],[8118,11],[8125,0],[8126,11],[8127,0],[8130,11],[8133,0],[8134,11],[8141,0],[8144,11],[8148,0],[8150,11],[8156,0],[8160,11],[8173,0],[8178,11],[8181,0],[8182,11],[8189,0],[8192,4],[8199,0],[8200,4],[8203,0],[8204,14],[8205,16],[8206,13],[8208,0],[8216,8],[8218,0],[8228,8],[8229,0],[8231,10],[8232,2],[8234,13],[8239,12],[8240,0],[8255,12],[8257,0],[8260,7],[8261,0],[8276,12],[8277,0],[8287,4],[8288,13],[8293,0],[8294,13],[8304,0],[8305,11],[8306,0],[8319,11],[8320,0],[8336,11],[8349,0],[8400,14],[8433,0],[8450,11],[8451,0],[8455,11],[8456,0],[8458,11],[8468,0],[8469,11],[8470,0],[8473,11],[8478,0],[8484,11],[8485,0],[8486,11],[8487,0],[8488,11],[8489,0],[8490,11],[8494,0],[8495,11],[8506,0],[8508,11],[8512,0],[8517,11],[8522,0],[8526,11],[8527,0],[8544,11],[8585,0],[9398,11],[9450,0],[11264,11],[11311,0],[11312,11],[11359,0],[11360,11],[11493,0],[11499,11],[11503,14],[11506,11],[11508,0],[11520,11],[11558,0],[11559,11],[11560,0],[11565,11],[11566,0],[11568,11],[11624,0],[11631,11],[11632,0],[11647,14],[11648,11],[11671,0],[11680,11],[11687,0],[11688,11],[11695,0],[11696,11],[11703,0],[11704,11],[11711,0],[11712,11],[11719,0],[11720,11],[11727,0],[11728,11],[11735,0],[11736,11],[11743,0],[11744,14],[11776,0],[11823,11],[11824,0],[12288,4],[12289,0],[12293,11],[12294,0],[12330,14],[12336,0],[12337,17],[12342,0],[12347,11],[12349,0],[12441,14],[12443,17],[12445,0],[12448,17],[12539,0],[12540,17],[12544,0],[12549,11],[12592,0],[12593,11],[12687,0],[12704,11],[12736,0],[12784,17],[12800,0],[13008,17],[13055,0],[13056,17],[13144,0],[40960,11],[42125,0],[42192,11],[42238,0],[42240,11],[42509,0],[42512,11],[42528,9],[42538,11],[42540,0],[42560,11],[42607,14],[42611,0],[42612,14],[42622,0],[42623,11],[42654,14],[42656,11],[42736,14],[42738,0],[42760,11],[42944,0],[42946,11],[42955,0],[42997,11],[43010,14],[43011,11],[43014,14],[43015,11],[43019,14],[43020,11],[43043,14],[43048,0],[43052,14],[43053,0],[43072,11],[43124,0],[43136,14],[43138,11],[43188,14],[43206,0],[43216,9],[43226,0],[43232,14],[43250,11],[43256,0],[43259,11],[43260,0],[43261,11],[43263,14],[43264,9],[43274,11],[43302,14],[43310,0],[43312,11],[43335,14],[43348,0],[43360,11],[43389,0],[43392,14],[43396,11],[43443,14],[43457,0],[43471,11],[43472,9],[43482,0],[43493,14],[43494,0],[43504,9],[43514,0],[43520,11],[43561,14],[43575,0],[43584,11],[43587,14],[43588,11],[43596,14],[43598,0],[43600,9],[43610,0],[43643,14],[43646,0],[43696,14],[43697,0],[43698,14],[43701,0],[43703,14],[43705,0],[43710,14],[43712,0],[43713,14],[43714,0],[43744,11],[43755,14],[43760,0],[43762,11],[43765,14],[43767,0],[43777,11],[43783,0],[43785,11],[43791,0],[43793,11],[43799,0],[43808,11],[43815,0],[43816,11],[43823,0],[43824,11],[43882,0],[43888,11],[44003,14],[44011,0],[44012,14],[44014,0],[44016,9],[44026,0],[44032,11],[55204,0],[55216,11],[55239,0],[55243,11],[55292,0],[64256,11],[64263,0],[64275,11],[64280,0],[64285,15],[64286,14],[64287,15],[64297,0],[64298,15],[64311,0],[64312,15],[64317,0],[64318,15],[64319,0],[64320,15],[64322,0],[64323,15],[64325,0],[64326,15],[64336,11],[64434,0],[64467,11],[64830,0],[64848,11],[64912,0],[64914,11],[64968,0],[65008,11],[65020,0],[65024,14],[65040,7],[65041,0],[65043,10],[65044,7],[65045,0],[65056,14],[65072,0],[65075,12],[65077,0],[65101,12],[65104,7],[65105,0],[65106,8],[65107,0],[65108,7],[65109,10],[65110,0],[65136,11],[65141,0],[65142,11],[65277,0],[65279,13],[65280,0],[65287,8],[65288,0],[65292,7],[65293,0],[65294,8],[65295,0],[65296,9],[65306,10],[65307,7],[65308,0],[65313,11],[65339,0],[65343,12],[65344,0],[65345,11],[65371,0],[65382,17],[65438,14],[65440,11],[65471,0],[65474,11],[65480,0],[65482,11],[65488,0],[65490,11],[65496,0],[65498,11],[65501,0],[65529,13],[65532,0],[65536,11],[65548,0],[65549,11],[65575,0],[65576,11],[65595,0],[65596,11],[65598,0],[65599,11],[65614,0],[65616,11],[65630,0],[65664,11],[65787,0],[65856,11],[65909,0],[66045,14],[66046,0],[66176,11],[66205,0],[66208,11],[66257,0],[66272,14],[66273,0],[66304,11],[66336,0],[66349,11],[66379,0],[66384,11],[66422,14],[66427,0],[66432,11],[66462,0],[66464,11],[66500,0],[66504,11],[66512,0],[66513,11],[66518,0],[66560,11],[66718,0],[66720,9],[66730,0],[66736,11],[66772,0],[66776,11],[66812,0],[66816,11],[66856,0],[66864,11],[66916,0],[67072,11],[67383,0],[67392,11],[67414,0],[67424,11],[67432,0],[67584,11],[67590,0],[67592,11],[67593,0],[67594,11],[67638,0],[67639,11],[67641,0],[67644,11],[67645,0],[67647,11],[67670,0],[67680,11],[67703,0],[67712,11],[67743,0],[67808,11],[67827,0],[67828,11],[67830,0],[67840,11],[67862,0],[67872,11],[67898,0],[67968,11],[68024,0],[68030,11],[68032,0],[68096,11],[68097,14],[68100,0],[68101,14],[68103,0],[68108,14],[68112,11],[68116,0],[68117,11],[68120,0],[68121,11],[68150,0],[68152,14],[68155,0],[68159,14],[68160,0],[68192,11],[68221,0],[68224,11],[68253,0],[68288,11],[68296,0],[68297,11],[68325,14],[68327,0],[68352,11],[68406,0],[68416,11],[68438,0],[68448,11],[68467,0],[68480,11],[68498,0],[68608,11],[68681,0],[68736,11],[68787,0],[68800,11],[68851,0],[68864,11],[68900,14],[68904,0],[68912,9],[68922,0],[69248,11],[69290,0],[69291,14],[69293,0],[69296,11],[69298,0],[69376,11],[69405,0],[69415,11],[69416,0],[69424,11],[69446,14],[69457,0],[69552,11],[69573,0],[69600,11],[69623,0],[69632,14],[69635,11],[69688,14],[69703,0],[69734,9],[69744,0],[69759,14],[69763,11],[69808,14],[69819,0],[69821,13],[69822,0],[69837,13],[69838,0],[69840,11],[69865,0],[69872,9],[69882,0],[69888,14],[69891,11],[69927,14],[69941,0],[69942,9],[69952,0],[69956,11],[69957,14],[69959,11],[69960,0],[69968,11],[70003,14],[70004,0],[70006,11],[70007,0],[70016,14],[70019,11],[70067,14],[70081,11],[70085,0],[70089,14],[70093,0],[70094,14],[70096,9],[70106,11],[70107,0],[70108,11],[70109,0],[70144,11],[70162,0],[70163,11],[70188,14],[70200,0],[70206,14],[70207,0],[70272,11],[70279,0],[70280,11],[70281,0],[70282,11],[70286,0],[70287,11],[70302,0],[70303,11],[70313,0],[70320,11],[70367,14],[70379,0],[70384,9],[70394,0],[70400,14],[70404,0],[70405,11],[70413,0],[70415,11],[70417,0],[70419,11],[70441,0],[70442,11],[70449,0],[70450,11],[70452,0],[70453,11],[70458,0],[70459,14],[70461,11],[70462,14],[70469,0],[70471,14],[70473,0],[70475,14],[70478,0],[70480,11],[70481,0],[70487,14],[70488,0],[70493,11],[70498,14],[70500,0],[70502,14],[70509,0],[70512,14],[70517,0],[70656,11],[70709,14],[70727,11],[70731,0],[70736,9],[70746,0],[70750,14],[70751,11],[70754,0],[70784,11],[70832,14],[70852,11],[70854,0],[70855,11],[70856,0],[70864,9],[70874,0],[71040,11],[71087,14],[71094,0],[71096,14],[71105,0],[71128,11],[71132,14],[71134,0],[71168,11],[71216,14],[71233,0],[71236,11],[71237,0],[71248,9],[71258,0],[71296,11],[71339,14],[71352,11],[71353,0],[71360,9],[71370,0],[71453,14],[71468,0],[71472,9],[71482,0],[71680,11],[71724,14],[71739,0],[71840,11],[71904,9],[71914,0],[71935,11],[71943,0],[71945,11],[71946,0],[71948,11],[71956,0],[71957,11],[71959,0],[71960,11],[71984,14],[71990,0],[71991,14],[71993,0],[71995,14],[71999,11],[72e3,14],[72001,11],[72002,14],[72004,0],[72016,9],[72026,0],[72096,11],[72104,0],[72106,11],[72145,14],[72152,0],[72154,14],[72161,11],[72162,0],[72163,11],[72164,14],[72165,0],[72192,11],[72193,14],[72203,11],[72243,14],[72250,11],[72251,14],[72255,0],[72263,14],[72264,0],[72272,11],[72273,14],[72284,11],[72330,14],[72346,0],[72349,11],[72350,0],[72384,11],[72441,0],[72704,11],[72713,0],[72714,11],[72751,14],[72759,0],[72760,14],[72768,11],[72769,0],[72784,9],[72794,0],[72818,11],[72848,0],[72850,14],[72872,0],[72873,14],[72887,0],[72960,11],[72967,0],[72968,11],[72970,0],[72971,11],[73009,14],[73015,0],[73018,14],[73019,0],[73020,14],[73022,0],[73023,14],[73030,11],[73031,14],[73032,0],[73040,9],[73050,0],[73056,11],[73062,0],[73063,11],[73065,0],[73066,11],[73098,14],[73103,0],[73104,14],[73106,0],[73107,14],[73112,11],[73113,0],[73120,9],[73130,0],[73440,11],[73459,14],[73463,0],[73648,11],[73649,0],[73728,11],[74650,0],[74752,11],[74863,0],[74880,11],[75076,0],[77824,11],[78895,0],[78896,13],[78905,0],[82944,11],[83527,0],[92160,11],[92729,0],[92736,11],[92767,0],[92768,9],[92778,0],[92880,11],[92910,0],[92912,14],[92917,0],[92928,11],[92976,14],[92983,0],[92992,11],[92996,0],[93008,9],[93018,0],[93027,11],[93048,0],[93053,11],[93072,0],[93760,11],[93824,0],[93952,11],[94027,0],[94031,14],[94032,11],[94033,14],[94088,0],[94095,14],[94099,11],[94112,0],[94176,11],[94178,0],[94179,11],[94180,14],[94181,0],[94192,14],[94194,0],[110592,17],[110593,0],[110948,17],[110952,0],[113664,11],[113771,0],[113776,11],[113789,0],[113792,11],[113801,0],[113808,11],[113818,0],[113821,14],[113823,0],[113824,13],[113828,0],[119141,14],[119146,0],[119149,14],[119155,13],[119163,14],[119171,0],[119173,14],[119180,0],[119210,14],[119214,0],[119362,14],[119365,0],[119808,11],[119893,0],[119894,11],[119965,0],[119966,11],[119968,0],[119970,11],[119971,0],[119973,11],[119975,0],[119977,11],[119981,0],[119982,11],[119994,0],[119995,11],[119996,0],[119997,11],[120004,0],[120005,11],[120070,0],[120071,11],[120075,0],[120077,11],[120085,0],[120086,11],[120093,0],[120094,11],[120122,0],[120123,11],[120127,0],[120128,11],[120133,0],[120134,11],[120135,0],[120138,11],[120145,0],[120146,11],[120486,0],[120488,11],[120513,0],[120514,11],[120539,0],[120540,11],[120571,0],[120572,11],[120597,0],[120598,11],[120629,0],[120630,11],[120655,0],[120656,11],[120687,0],[120688,11],[120713,0],[120714,11],[120745,0],[120746,11],[120771,0],[120772,11],[120780,0],[120782,9],[120832,0],[121344,14],[121399,0],[121403,14],[121453,0],[121461,14],[121462,0],[121476,14],[121477,0],[121499,14],[121504,0],[121505,14],[121520,0],[122880,14],[122887,0],[122888,14],[122905,0],[122907,14],[122914,0],[122915,14],[122917,0],[122918,14],[122923,0],[123136,11],[123181,0],[123184,14],[123191,11],[123198,0],[123200,9],[123210,0],[123214,11],[123215,0],[123584,11],[123628,14],[123632,9],[123642,0],[124928,11],[125125,0],[125136,14],[125143,0],[125184,11],[125252,14],[125259,11],[125260,0],[125264,9],[125274,0],[126464,11],[126468,0],[126469,11],[126496,0],[126497,11],[126499,0],[126500,11],[126501,0],[126503,11],[126504,0],[126505,11],[126515,0],[126516,11],[126520,0],[126521,11],[126522,0],[126523,11],[126524,0],[126530,11],[126531,0],[126535,11],[126536,0],[126537,11],[126538,0],[126539,11],[126540,0],[126541,11],[126544,0],[126545,11],[126547,0],[126548,11],[126549,0],[126551,11],[126552,0],[126553,11],[126554,0],[126555,11],[126556,0],[126557,11],[126558,0],[126559,11],[126560,0],[126561,11],[126563,0],[126564,11],[126565,0],[126567,11],[126571,0],[126572,11],[126579,0],[126580,11],[126584,0],[126585,11],[126589,0],[126590,11],[126591,0],[126592,11],[126602,0],[126603,11],[126620,0],[126625,11],[126628,0],[126629,11],[126634,0],[126635,11],[126652,0],[127280,11],[127306,0],[127312,11],[127338,0],[127344,11],[127370,0],[127462,18],[127488,0],[127995,14],[128e3,0],[130032,9],[130042,0],[917505,13],[917506,0],[917536,14],[917632,0],[917760,14],[918e3,0]];function default_(r,e){var t=findBoundaries(r,e);if(t.length==0)return[];for(var n=[],i=0;i<t.length-1;i++){var a=t[i],u=t[i+1],o=new LazySpan(r,a,u);isNonSpace(o.text,e)?n.push(o):i==t.length-2&&(o=new LazySpan(r,u,u),n.push(o))}return n}v(default_,"default_");var LazySpan=function(){function r(e,t,n){this._source=e,this.start=t,this.end=n}return v(r,"LazySpan2"),Object.defineProperty(r.prototype,"text",{get:function(){return this._source.substring(this.start,this.end)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"length",{get:function(){return this.end-this.start},enumerable:!1,configurable:!0}),r}(),BreakerContext=function(){function r(e,t,n,i,a,u){this.lookbehind=19,this.left=19,this.right=19,this.text=e,this.options=t,arguments.length==3?this.lookahead=this.wordbreakPropertyAt(n):(this.lookbehind=n,this.left=i,this.right=a,this.lookahead=u)}return v(r,"BreakerContext2"),r.prototype.next=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.left,this.right,this.lookahead,t)},r.prototype.ignoringRight=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.lookbehind,this.left,this.lookahead,t)},r.prototype.ignoringLookahead=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.lookbehind,this.left,this.right,t)},r.prototype.wordbreakPropertyAt=function(e){return e<0?19:e>=this.text.length?20:isStartOfSurrogatePair(this.text[e])?property(this.text[e]+this.text[e+1]):property(this.text[e],this.options)},r.prototype.match=function(e,t,n,i){var a,u,o,l,s=(a=e==null?void 0:e.includes(this.lookbehind))!==null&&a!==void 0?a:!0;return s=s&&((u=t==null?void 0:t.includes(this.left))!==null&&u!==void 0?u:!0),s=s&&((o=n==null?void 0:n.includes(this.right))!==null&&o!==void 0?o:!0),s&&((l=i==null?void 0:i.includes(this.lookahead))!==null&&l!==void 0?l:!0)},r.prototype.propertyMatch=function(e,t,n,i){var a=this,u=v(function(o){return propertyVal(o,a.options)},"propMapper");return this.match(e==null?void 0:e.map(u),t==null?void 0:t.map(u),n==null?void 0:n.map(u),i==null?void 0:i.map(u))},r}();function isNonSpace(r,e){return!Array.from(r).map(function(t){return property(t,e)}).every(function(t){return t===3||t===1||t===2||t===4})}v(isNonSpace,"isNonSpace");function findBoundaries(r,e){var t,n,i;if(r.length===0)return[];e&&!e.rules&&(e.rules=[]);var a=[],u,o=0,l=new BreakerContext(r,e,o),s=0;do{if(u=o,o=C(o),l=l.next(o),l.match(null,[19],null,null)){a.push(u);continue}if(l.match(null,null,[20],null)){a.push(u);break}if(!l.match(null,[3],[1],null)){var f=[2,3,1];if(l.match(null,f,null,null)){a.push(u);continue}if(l.match(null,null,f,null)){a.push(u);continue}if(!l.match(null,[4],[4],null)){for(var c=[13,14,16];l.match(null,null,c,null);)t=(0,build_exports.__read)([o,C(o)],2),u=t[0],o=t[1],l=l.ignoringRight(o);if(l.right===20){a.push(u);break}for(;l.match(null,null,null,c);)o=C(o),l=l.ignoringLookahead(o);var d=[11,15],p=[8,6];if(e!=null&&e.rules){var g=!1;try{for(var w=(n=void 0,(0,build_exports.__values)(e.rules)),b=w.next();!b.done;b=w.next()){var T=b.value;if(g=T.match(l),g){T.breakIfMatch&&a.push(u);break}}}catch(h){n={error:h}}finally{try{b&&!b.done&&(i=w.return)&&i.call(w)}finally{if(n)throw n.error}}if(g)continue}if(!l.match(null,d,d,null)){var S=[10].concat(p);if(!l.match(null,d,S,d)&&!l.match(d,S,d,null)&&!l.match(null,[15],[6],null)&&!l.match(null,[15],[5],[15])&&!l.match([15],[5],[15],null)&&!l.match(null,[9],[9],null)&&!l.match(null,d,[9],null)&&!l.match(null,[9],d,null)){var _=[7].concat(p);if(!l.match([9],_,[9],null)&&!l.match(null,[9],_,[9])&&!l.match(null,[17],[17],null)){var y=[17,9].concat(d);if(!l.match(null,y,[12],null)&&!l.match(null,[12],[12],null)&&!l.match(null,[12],y,null)){if(l.right===18){if(s+=1,s%2==1)continue}else s=0;a.push(u)}}}}}}}while(u<r.length);return a;function C(h){return h>=r.length?r.length:isStartOfSurrogatePair(r[h])?h+2:h+1}}v(findBoundaries,"findBoundaries");function isStartOfSurrogatePair(r){var e=r.charCodeAt(0);return e>=55296&&e<=56319}v(isStartOfSurrogatePair,"isStartOfSurrogatePair");function property(r,e){if(e!=null&&e.propertyMapping){var t=e.propertyMapping(r);if(t)return propertyVal(t,e)}var n=r.codePointAt(0);return searchForProperty(n,0,WORD_BREAK_PROPERTY.length-1)}v(property,"property");function propertyVal(r,e){var t,n,i=v(function(u){return u.toLowerCase()==r.toLowerCase()},"matcher"),a=(n=(t=e==null?void 0:e.customProperties)===null||t===void 0?void 0:t.findIndex(i))!==null&&n!==void 0?n:-1;return a!=-1?-a-1:propertyMap.findIndex(i)}v(propertyVal,"propertyVal");function searchForProperty(r,e,t){if(t<e)return 0;var n=e+~~((t-e)/2),i=WORD_BREAK_PROPERTY[n],a=WORD_BREAK_PROPERTY[n+1],u=a?a[0]:1/0;return r<i[0]?searchForProperty(r,e,n-1):r>=u?searchForProperty(r,n+1,t):i[1]}v(searchForProperty,"searchForProperty");var MAX_SUGGESTIONS=12,TrieModel=function(){function r(e,t){t===void 0&&(t={}),this.languageUsesCasing=t.languageUsesCasing,this.applyCasing=t.applyCasing,this._trie=new Trie(e.root,e.totalWeight,t.searchTermToKey||defaultSearchTermToKey),this.breakWords=t.wordBreaker||default_,this.punctuation=t.punctuation}return v(r,"TrieModel2"),r.prototype.configure=function(e){var t;return this.configuration={leftContextCodePoints:e.maxLeftContextCodePoints,rightContextCodePoints:(t=e.maxRightContextCodePoints)!==null&&t!==void 0?t:0}},r.prototype.toKey=function(e){return this._trie.toKey(e)},r.prototype.predict=function(e,t){if(!e.insert&&!t.left&&!t.right&&t.startOfBuffer&&t.endOfBuffer)return u(this._trie.firstN(MAX_SUGGESTIONS).map(function(o){var l=o.text,s=o.p;return{transform:{insert:l,deleteLeft:0},displayAs:l,p:s}}));var n=applyTransform(e,t),i=e.deleteLeft-e.insert.kmwLength(),a=getLastPreCaretToken(this.breakWords,n);return u(this._trie.lookup(a).map(function(o){var l=o.text,s=o.p;return transformToSuggestion({insert:l,deleteLeft:i+a.kmwLength()},s)}));function u(o){var l,s,f=[];try{for(var c=(0,build_exports.__values)(o),d=c.next();!d.done;d=c.next()){var p=d.value;f.push({sample:p,p:p.p})}}catch(g){l={error:g}}finally{try{d&&!d.done&&(s=c.return)&&s.call(c)}finally{if(l)throw l.error}}return f}},Object.defineProperty(r.prototype,"wordbreaker",{get:function(){return this.breakWords},enumerable:!1,configurable:!0}),r.prototype.traverseFromRoot=function(){return new r.Traversal(this._trie.root,"")},r.Traversal=function(){function e(t,n){this.root=t,this.prefix=n}return v(e,"class_1"),e.prototype.children=function(){var t,n,i,a,u,o,l,s,f,c,d,p,g,w,b,T,S,_;return(0,build_exports.__generator)(this,function(y){switch(y.label){case 0:if(t=this.root,t.type!="internal")return[3,9];n=v(function(C){var h,m,O,k,A,I,E,D,F,q,R,U;return(0,build_exports.__generator)(this,function(M){switch(M.label){case 0:if(h=t.children[C],!isHighSurrogate(C))return[3,12];if(h.type!="internal")return[3,9];m=h,O=v(function(N){var j;return(0,build_exports.__generator)(this,function(V){switch(V.label){case 0:return j=i.prefix+C+N,[4,{char:C+N,traversal:function(){return new r.Traversal(m.children[N],j)}}];case 1:return V.sent(),[2]}})},"_loop_3"),M.label=1;case 1:M.trys.push([1,6,7,8]),k=(R=void 0,(0,build_exports.__values)(m.values)),A=k.next(),M.label=2;case 2:return A.done?[3,5]:(I=A.value,[5,O(I)]);case 3:M.sent(),M.label=4;case 4:return A=k.next(),[3,2];case 5:return[3,8];case 6:return E=M.sent(),R={error:E},[3,8];case 7:try{A&&!A.done&&(U=k.return)&&U.call(k)}finally{if(R)throw R.error}return[7];case 8:return[3,11];case 9:return D=h.entries[0].key,C=C+D[i.prefix.length+1],F=i.prefix+C,[4,{char:C,traversal:function(){return new r.Traversal(h,F)}}];case 10:M.sent(),M.label=11;case 11:return[3,16];case 12:return isSentinel(C)?[2,"continue"]:[3,13];case 13:return C?[3,14]:[2,"continue"];case 14:return q=i.prefix+C,[4,{char:C,traversal:function(){return new r.Traversal(h,q)}}];case 15:M.sent(),M.label=16;case 16:return[2]}})},"_loop_1"),i=this,y.label=1;case 1:y.trys.push([1,6,7,8]),a=(0,build_exports.__values)(t.values),u=a.next(),y.label=2;case 2:return u.done?[3,5]:(o=u.value,[5,n(o)]);case 3:y.sent(),y.label=4;case 4:return u=a.next(),[3,2];case 5:return[3,8];case 6:return l=y.sent(),b={error:l},[3,8];case 7:try{u&&!u.done&&(T=a.return)&&T.call(a)}finally{if(b)throw b.error}return[7];case 8:return[2];case 9:s=this.prefix,f=t.entries.filter(function(C){return C.key!=s&&s.length<C.key.length}),c=v(function(C){var h;return(0,build_exports.__generator)(this,function(m){switch(m.label){case 0:return h=C[s.length],isHighSurrogate(h)&&(h=h+C[s.length+1]),[4,{char:h,traversal:function(){return new r.Traversal(t,s+h)}}];case 1:return m.sent(),[2]}})},"_loop_2"),y.label=10;case 10:y.trys.push([10,15,16,17]),d=(0,build_exports.__values)(f),p=d.next(),y.label=11;case 11:return p.done?[3,14]:(g=p.value.key,[5,c(g)]);case 12:y.sent(),y.label=13;case 13:return p=d.next(),[3,11];case 14:return[3,17];case 15:return w=y.sent(),S={error:w},[3,17];case 16:try{p&&!p.done&&(_=d.return)&&_.call(d)}finally{if(S)throw S.error}return[7];case 17:return[2]}})},Object.defineProperty(e.prototype,"entries",{get:function(){if(this.root.type=="leaf"){var t=this.prefix,n=this.root.entries.filter(function(a){return a.key==t});return n.map(function(a){return a.content})}else{var i=this.root.children[SENTINEL_CODE_UNIT];return i&&i.type=="leaf"?i.entries.map(function(a){return a.content}):[]}},enumerable:!1,configurable:!0}),e}(),r}(),trie_model_default=TrieModel,Trie=function(){function r(e,t,n){this.root=e,this.toKey=n,this.totalWeight=t}return v(r,"Trie2"),r.prototype.lookup=function(e){var t=this.toKey(e),n=findPrefix(this.root,t);return n===null?[]:getSortedResults(n,t,this.totalWeight)},r.prototype.firstN=function(e){return getSortedResults(this.root,"",this.totalWeight,e)},r}();function findPrefix(r,e,t){if(t===void 0&&(t=0),r.type==="leaf"||t===e.length)return r;var n=e[t];return r.children[n]?findPrefix(r.children[n],e,t+1):null}v(findPrefix,"findPrefix");function getSortedResults(r,e,t,n){var i,a;n===void 0&&(n=MAX_SUGGESTIONS);var u=new priority_queue_default(function(b,T){return(T?T.weight:0)-(b?b.weight:0)}),o=[];if(r.type==="leaf")try{for(var l=(0,build_exports.__values)(r.entries),s=l.next();!s.done;s=l.next()){var f=s.value;if(f.key.indexOf(e)==0){var c=f.content,d=f.weight;if(o.push({text:c,p:d/t}),o.length>=n)return o}}}catch(b){i={error:b}}finally{try{s&&!s.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}else{u.enqueue(r);for(var p=void 0,g=v(function(){if(isNode(p))if(p.type==="leaf")u.enqueueAll(p.entries);else{var b=p;u.enqueueAll(p.values.map(function(T){return b.children[T]}))}else if(o.push({text:p.content,p:p.weight/t}),o.length>=n)return{value:o}},"_loop_4");p=u.dequeue();){var w=g();if(typeof w=="object")return w.value}}return o}v(getSortedResults,"getSortedResults");function isNode(r){return"type"in r}v(isNode,"isNode");function defaultSearchTermToKey(r){return r.normalize("NFD").replace(/[\\u0300-\\u036f]/g,"").toLowerCase()}v(defaultSearchTermToKey,"defaultSearchTermToKey"),extendString();var DummyModel=function(){function r(e){e=e||{},this._futureSuggestions=e.futureSuggestions?e.futureSuggestions.slice():[],e.punctuation&&(this.punctuation=e.punctuation)}return v(r,"DummyModel2"),r.prototype.configure=function(e){return this.configuration={leftContextCodePoints:e.maxLeftContextCodePoints,rightContextCodePoints:e.maxRightContextCodePoints},this.configuration},r.prototype.predict=function(e,t,n){var i=v(function(u){var o,l,s=[],f=u.length;try{for(var c=(0,build_exports.__values)(u),d=c.next();!d.done;d=c.next()){var p=d.value;s.push({sample:p,p:1})}}catch(g){o={error:g}}finally{try{d&&!d.done&&(l=c.return)&&l.call(c)}finally{if(o)throw o.error}}return s},"makeUniformDistribution");if(n)return i(n);var a=this._futureSuggestions.shift();return a?i(a):[]},r}(),dummy_model_default=DummyModel,correction_exports={};__export(correction_exports,{ClassicalDistanceCalculation:function(){return ClassicalDistanceCalculation},ContextTracker:function(){return ContextTracker},QUEUE_NODE_COMPARATOR:function(){return QUEUE_NODE_COMPARATOR},SearchNode:function(){return SearchNode},SearchResult:function(){return SearchResult},SearchSpace:function(){return SearchSpace},TrackedContextState:function(){return TrackedContextState},TrackedContextSuggestion:function(){return TrackedContextSuggestion},TrackedContextToken:function(){return TrackedContextToken}});var ClassicalDistanceCalculation=function(){function r(e){if(this.diagonalWidth=2,this.inputSequence=[],this.matchSequence=[],e){var t=e.resolvedDistances.length;this.resolvedDistances=Array(t);for(var n=0;n<t;n++)this.resolvedDistances[n]=Array.from(e.resolvedDistances[n]);this.inputSequence=Array.from(e.inputSequence),this.matchSequence=Array.from(e.matchSequence),this.diagonalWidth=e.diagonalWidth}else this.resolvedDistances=[]}return v(r,"ClassicalDistanceCalculation2"),r.prototype.getTrueIndex=function(e,t,n){var i={row:e,col:t-e+n,sparse:!1};return(i.col<0||i.col>2*n)&&(i.sparse=!0),i},r.prototype.getCostAt=function(e,t,n){if(n===void 0&&(n=this.diagonalWidth),e<0||t<0)return e==-1&&t>=-1?t+1:t==-1&&e>=-1?e+1:Number.MAX_VALUE;var i=this.getTrueIndex(e,t,n);return i.sparse?Number.MAX_VALUE:this.resolvedDistances[i.row][i.col]},r.prototype.getFinalCost=function(){for(var e=this,t=e.getHeuristicFinalCost();t>e.diagonalWidth;)e=e.increaseMaxDistance(),t=e.getHeuristicFinalCost();return t},r.prototype.getHeuristicFinalCost=function(){return this.getCostAt(this.inputSequence.length-1,this.matchSequence.length-1)},r.prototype.hasFinalCostWithin=function(e){var t=this,n=t.getHeuristicFinalCost(),i=this.diagonalWidth;do{if(n<=e)return!0;if(i<e)t=t.increaseMaxDistance(),i++,n=t.getHeuristicFinalCost();else break}while(!0);return!1},r.prototype.editPath=function(e,t){e===void 0&&(e=this.inputSequence.length-1),t===void 0&&(t=this.matchSequence.length-1);var n=this.getCostAt(e,t),i=null,a=null,u=this.getCostAt(e,t-1),o=this.getCostAt(e-1,t),l=this.getCostAt(e-1,t-1),s=(0,build_exports.__read)(r.getTransposeParent(this,e,t),2),f=s[0],c=s[1];if(f>=0&&c>=0){var d=1;if(i=["transpose-start"],f!=e-1){var p=e-f-1;i=i.concat(Array(p).fill("transpose-delete")),d+=p}else{var p=t-c-1;i=i.concat(Array(p).fill("transpose-insert")),d+=p}i.push("transpose-end"),this.getCostAt(f-1,c-1)!=n-d&&(i=null),a=[f-1,c-1]}return i||(l==n-1?(i=["substitute"],a=[e-1,t-1]):u==n-1?(i=["insert"],a=[e,t-1]):o==n-1?(i=["delete"],a=[e-1,t]):(i=["match"],a=[e-1,t-1])),a[0]>=0&&a[1]>=0?this.editPath(a[0],a[1]).concat(i):a[0]>-1?Array(a[0]+1).fill("delete").concat(i):a[1]>-1?Array(a[1]+1).fill("insert").concat(i):i},r.getTransposeParent=function(e,t,n){if(t<0||n<0||e.inputSequence[t].key==e.matchSequence[n].key)return[-1,-1];for(var i=-1,a=t-1;a>=0;a--)if(e.inputSequence[a].key==e.matchSequence[n].key){i=a;break}for(var u=-1,a=n-1;a>=0;a--)if(e.matchSequence[a].key==e.inputSequence[t].key){u=a;break}return[i,u]},r.initialCostAt=function(e,t,n,i,a){var u=e.inputSequence[t].key==e.matchSequence[n].key?0:1,o=e.getCostAt(t-1,n-1)+u,l=i||e.getCostAt(t,n-1)+1,s=a||e.getCostAt(t-1,n)+1,f=Number.MAX_VALUE;if(t>0&&n>0){var c=(0,build_exports.__read)(r.getTransposeParent(e,t,n),2),d=c[0],p=c[1];f=e.getCostAt(d-1,p-1)+(t-d-1)+1+(n-p-1)}return Math.min(o,s,l,f)},r.prototype.getSubset=function(e,t){var n=new r(this);if(e>this.inputSequence.length||t>this.matchSequence.length)throw"Invalid dimensions specified for trim operation";n.inputSequence.splice(e),n.matchSequence.splice(t),n.resolvedDistances.splice(e);for(var i=this.getTrueIndex(e-1,t-1,this.diagonalWidth),a=i.col;a<=2*this.diagonalWidth;a++){var u=i.row-(a-i.col);if(u<0)break;if(a<0)n.resolvedDistances[u]=Array(2*n.diagonalWidth+1).fill(Number.MAX_VALUE);else{var o=2*this.diagonalWidth-a,l=n.resolvedDistances[u].splice(0,a+1),s=Array(o).fill(Number.MAX_VALUE);n.resolvedDistances[u]=l.concat(s)}}return n},r.forDiagonalOfAxis=function(e,t,n,i){for(var a=n-t<e?n-t+e:2*e,u=t-e,o=u<0?0:u,l=o-u;l<=a;l++)i(u+l,l)},r.prototype.addInputChar=function(e){var t=new r(this),n=t.inputSequence.length;t.inputSequence.push(e);var i=Array(2*t.diagonalWidth+1).fill(Number.MAX_VALUE);return t.resolvedDistances[n]=i,t.matchSequence.length==0||r.forDiagonalOfAxis(t.diagonalWidth,n,t.matchSequence.length-1,function(a,u){i[u]=r.initialCostAt(t,n,a)}),t},r.prototype.addMatchChar=function(e){var t=new r(this),n=t.matchSequence.length;return t.matchSequence.push(e),t.inputSequence.length==0||r.forDiagonalOfAxis(t.diagonalWidth,n,t.inputSequence.length-1,function(i,a){var u=t.resolvedDistances[i];u[2*t.diagonalWidth-a]=r.initialCostAt(t,i,n)}),t},r.prototype.increaseMaxDistance=function(){var e=new r(this);if(e.diagonalWidth++,e.inputSequence.length<1||e.matchSequence.length<1)return e;function t(o,l,s,f){var c=2*(e.diagonalWidth-1),d=s.length-1;c=c<d-o?c:d-o;for(var p=0;p<=c;p++)l==s[o+p].key&&f(o+p,p)}v(t,"forPossibleTranspositionsInDiagonal");for(var n=v(function(o){var l=Number.MAX_VALUE,s=o-e.diagonalWidth;if(s>=0){var f=s==0?o+2:Number.MAX_VALUE;l=r.initialCostAt(e,o,s,f,void 0);var c=l;if(s<e.matchSequence.length-1){r.propagateUpdateFrom(e,o,s+1,c+1,0);var d=o+2;if(o+2<i.inputSequence.length){var p=e.inputSequence[o+1].key;t(s+3,p,e.matchSequence,function(_,y){r.propagateUpdateFrom(e,d,_,c+y+2,y)})}}}var g=Number.MAX_VALUE;if(s=o+e.diagonalWidth,s<e.matchSequence.length){var w=o==0?s+2:Number.MAX_VALUE;a=e.getCostAt(o,s-1,i.diagonalWidth)+1,g=r.initialCostAt(e,o,s,a,w);var b=g;if(o<e.inputSequence.length-1){r.propagateUpdateFrom(e,o+1,s,b+1,2*i.diagonalWidth);var T=s+2;if(s+2<i.matchSequence.length){var S=e.matchSequence[o+1].key;t(o+3,S,e.inputSequence,function(_,y){var C=2*(e.diagonalWidth-1)-y;r.propagateUpdateFrom(e,_,T,b+y+2,C)})}}}e.resolvedDistances[o]=[l].concat(e.resolvedDistances[o],g)},"_loop_1"),i=this,a,u=0;u<e.inputSequence.length;u++)n(u);return e},r.propagateUpdateFrom=function(e,t,n,i,a){if(i<e.resolvedDistances[t][a])e.resolvedDistances[t][a]=i;else return;var u=t<e.inputSequence.length-1,o=n<e.matchSequence.length-1;if(a<2*(e.diagonalWidth-1)&&o){var l=i+1;this.propagateUpdateFrom(e,t,n+1,l,a+1)}if(a>0&&u){var l=i+1;this.propagateUpdateFrom(e,t+1,n,l,a-1)}if(u&&o){var l=i+(e.inputSequence[t+1].key==e.matchSequence[n+1].key?0:1);this.propagateUpdateFrom(e,t+1,n+1,l,a);for(var s=-1,f=t+2;f<e.inputSequence.length;f++)if(e.inputSequence[f].key==e.matchSequence[n+1].key){s=f;break}for(var c=-1,f=n+2;f<e.matchSequence.length;f++)if(e.matchSequence[f].key==e.inputSequence[t+1].key){c=f;break}if(s>0&&c>0){var d=i+(s-t-2)+1+(c-n-2);this.propagateUpdateFrom(e,s,c,d,e.diagonalWidth-1+c-s)}}},Object.defineProperty(r.prototype,"mapKey",{get:function(){var e=this.inputSequence.map(function(n){return n.key}).join(""),t=this.matchSequence.map(function(n){return n.key}).join("");return e+SENTINEL_CODE_UNIT+t+SENTINEL_CODE_UNIT+this.diagonalWidth},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastInputEntry",{get:function(){return this.inputSequence[this.inputSequence.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastMatchEntry",{get:function(){return this.matchSequence[this.matchSequence.length-1]},enumerable:!1,configurable:!0}),r.computeDistance=function(e,t,n){n===void 0&&(n=1);var i=new r;n=n||1,i.diagonalWidth=n;for(var a=0;a<e.length;a++)i=i.addInputChar(e[a]);for(var u=0;u<t.length;u++)i=i.addMatchChar(t[u]);return i},r}(),QUEUE_NODE_COMPARATOR=v(function(r,e){return r.currentCost-e.currentCost},"QUEUE_NODE_COMPARATOR"),SearchNode=function(){function r(e,t){if(this.toKey=function(i){return i},t=t||function(i){return i},e instanceof r){var n=e;this.calculation=n.calculation,this.currentTraversal=n.currentTraversal,this.priorInput=n.priorInput,this.toKey=n.toKey}else this.calculation=new ClassicalDistanceCalculation,this.currentTraversal=e,this.priorInput=[],this.toKey=t}return v(r,"SearchNode2"),Object.defineProperty(r.prototype,"knownCost",{get:function(){return this.calculation.getHeuristicFinalCost()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputSamplingCost",{get:function(){if(this._inputCost!==void 0)return this._inputCost;var e=SearchSpace.MIN_KEYSTROKE_PROBABILITY;return this._inputCost=this.priorInput.map(function(t){return t.p>e?t.p:e}).reduce(function(t,n){return t-Math.log(n)},0),this._inputCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentCost",{get:function(){return SearchSpace.EDIT_DISTANCE_COST_SCALE*this.knownCost+this.inputSamplingCost},enumerable:!1,configurable:!0}),r.prototype.buildInsertionEdges=function(){var e,t,n=[];try{for(var i=(0,build_exports.__values)(this.currentTraversal.children()),a=i.next();!a.done;a=i.next()){var u=a.value,o=u.traversal(),l={key:u.char,traversal:o},s=this.calculation.addMatchChar(l),f=new r(this);f.calculation=s,f.priorInput=this.priorInput,f.currentTraversal=o,n.push(f)}}catch(c){e={error:c}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.buildDeletionEdges=function(e){var t,n,i=[];try{for(var a=(0,build_exports.__values)(e),u=a.next();!u.done;u=a.next()){var o=u.value;if(o.p<e[0].p*Math.exp(-SearchSpace.EDIT_DISTANCE_COST_SCALE))break;var l=this.calculation,s=o.sample;s.deleteLeft&&(l=l.getSubset(l.inputSequence.length-s.deleteLeft,l.matchSequence.length));var f=Array.from(this.priorInput);f.push(o);for(var c=0;c<s.insert.length;c++){var d=s.insert[c];isHighSurrogate(d)&&(c++,d=d+s.insert[c]);var p=this.toKey(d);p&&(l=l.addInputChar({key:p}))}var g=new r(this);g.calculation=l,g.priorInput=f,i.push(g)}}catch(w){t={error:w}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i},r.prototype.buildSubstitutionEdges=function(e){var t,n,i,a,u=this.buildDeletionEdges(e),o=[];try{for(var l=(0,build_exports.__values)(this.currentTraversal.children()),s=l.next();!s.done;s=l.next()){var f=s.value;try{for(var c=(i=void 0,(0,build_exports.__values)(u)),d=c.next();!d.done;d=c.next()){var p=d.value,g=f.traversal(),w={key:f.char,traversal:g},b=p.calculation.addMatchChar(w),T=new r(this);T.calculation=b,T.priorInput=p.priorInput,T.currentTraversal=g,o.push(T)}}catch(S){i={error:S}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(i)throw i.error}}}}catch(S){t={error:S}}finally{try{s&&!s.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return o},Object.defineProperty(r.prototype,"mapKey",{get:function(){var e=this.priorInput.map(function(n){return"+"+n.sample.insert+"-"+n.sample.deleteLeft}).join(""),t=this.calculation.matchSequence.map(function(n){return n.key}).join("");return e+SENTINEL_CODE_UNIT+t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isFullReplacement",{get:function(){return this.knownCost&&this.knownCost==this.priorInput.length},enumerable:!1,configurable:!0}),r}(),SearchSpaceTier=function(){function r(e,t){this.processed=[],this.index=e,this.correctionQueue=new priority_queue_default(QUEUE_NODE_COMPARATOR,t)}return v(r,"SearchSpaceTier2"),r.prototype.increaseMaxEditDistance=function(){var e=this.correctionQueue.toArray();e.forEach(function(t){t.calculation=t.calculation.increaseMaxDistance()}),this.correctionQueue=new priority_queue_default(QUEUE_NODE_COMPARATOR,e)},r}(),SearchResult=function(){function r(e){this.resultNode=e}return v(r,"SearchResult2"),Object.defineProperty(r.prototype,"inputSequence",{get:function(){return this.resultNode.priorInput},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"matchSequence",{get:function(){return this.resultNode.calculation.matchSequence},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"matchString",{get:function(){return this.matchSequence.map(function(e){return e.key}).join("")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"knownCost",{get:function(){return this.resultNode.knownCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputSamplingCost",{get:function(){return this.resultNode.inputSamplingCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"totalCost",{get:function(){return this.resultNode.currentCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"finalTraversal",{get:function(){return this.resultNode.currentTraversal},enumerable:!1,configurable:!0}),r}(),SearchSpace=function(){function r(e){if(this.tierOrdering=[],this.inputSequence=[],this.minInputCost=[],this.returnedValues={},this.processedEdgeSet={},e){if(!e.traverseFromRoot)throw"The provided model does not implement the `traverseFromRoot` function, which is needed to support robust correction searching."}else throw"The LexicalModel parameter must not be null / undefined.";this.buildQueueSpaceComparator(),this.selectionQueue=new priority_queue_default(this.QUEUE_SPACE_COMPARATOR),this.rootNode=new SearchNode(e.traverseFromRoot(),e.toKey?e.toKey.bind(e):null),this.completedPaths=[this.rootNode];var t=new SearchSpaceTier(0,[this.rootNode]);this.tierOrdering.push(t),this.selectionQueue.enqueue(t)}return v(r,"SearchSpace2"),r.prototype.buildQueueSpaceComparator=function(){var e=this;this.QUEUE_SPACE_COMPARATOR=function(t,n){var i=t.correctionQueue.peek(),a=n.correctionQueue.peek(),u=t.index,o=n.index,l=0,s=1;if(o<u){var f=o;o=u,u=f,s=-1}for(var c=u;c<o;c++)l=l+e.minInputCost[c];return i&&a?i.currentCost-a.currentCost+s*l:a?1:-1}},r.prototype.increaseMaxEditDistance=function(){this.tierOrdering.forEach(function(e){e.increaseMaxEditDistance()})},r.prototype.addInput=function(e){this.inputSequence.push(e),this.minInputCost.push(-Math.log(e[0].p));var t=[],n=this.completedPaths.map(function(a){var u=a.buildDeletionEdges(e),o=a.buildSubstitutionEdges(e);return u.concat(o)});this.completedPaths=[],this.returnedValues={},n.forEach(function(a){t=t.concat(a)});var i=new SearchSpaceTier(this.tierOrdering.length,t);this.tierOrdering.push(i),this.selectionQueue.enqueue(i)},r.prototype.removeLastInput=function(){},r.prototype.hasNextMatchEntry=function(){var e=this.selectionQueue.peek();return e?e.correctionQueue.count>0:!1},r.prototype.handleNextNode=function(){if(!this.hasNextMatchEntry())return{type:"none"};var e=this.selectionQueue.dequeue(),t=e.correctionQueue.dequeue(),n={type:"intermediate",cost:t.currentCost};if(this.processedEdgeSet[t.mapKey])return this.selectionQueue.enqueue(e),n;this.processedEdgeSet[t.mapKey]=!0;var i=!1;if(t.knownCost>2)return n;t.knownCost==2&&(i=!0);for(var a=0,u=0;u<=e.index;u++)a+=this.minInputCost[u];if(t.currentCost>a+2.5*r.EDIT_DISTANCE_COST_SCALE)return n;if(!i){var o=t.buildInsertionEdges();e.correctionQueue.enqueueAll(o)}if(e.index==this.tierOrdering.length-1)return this.completedPaths.push(t),this.selectionQueue.enqueue(e),{type:"complete",cost:t.currentCost,finalNode:t};var l=this.tierOrdering[e.index+1],s=l.index,f=[];i||(f=t.buildDeletionEdges(this.inputSequence[s-1]));var c=t.buildSubstitutionEdges(this.inputSequence[s-1]);return l.correctionQueue.enqueueAll(f.concat(c)),this.selectionQueue=new priority_queue_default(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering),n},r.prototype.getBestMatches=function(e){var t,n,i,a,u,o,l,s,f,c,d,p,g,w,b,T;return(0,build_exports.__generator)(this,function(S){switch(S.label){case 0:if(t=this,n={},e==0?i=1/0:e==null||Number.isNaN(e)?i=r.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL:i=e,a=function(){function _(y,C){this.largestIntervals=[0],this.loopStart=this.start=Date.now(),this.maxExecutionTime=y,this.maxTrueTime=C}return v(_,"ExecutionTimer2"),_.prototype.startLoop=function(){this.loopStart=Date.now()},_.prototype.markIteration=function(){var y=Date.now(),C=y-this.loopStart;this.executionTime+=C,C&&(this.largestIntervals.length>2&&C>this.largestIntervals[0]?this.largestIntervals[0]=C:this.largestIntervals.push(C),this.largestIntervals.sort(),this.updateOutliers())},_.prototype.updateOutliers=function(){this.largestIntervals.length>2&&this.largestIntervals[2]>=2*(this.largestIntervals[0]+this.largestIntervals[1])&&(this.executionTime-=this.largestIntervals[2],this.largestIntervals.pop())},_.prototype.shouldTimeout=function(){var y=Date.now();return y-this.start>this.maxTrueTime?!0:this.executionTime>this.maxExecutionTime},_.prototype.resetOutlierCheck=function(){this.largestIntervals=[]},_}(),u=function(){function _(){this.currentCost=Number.MIN_SAFE_INTEGER,this.entries=[]}return v(_,"BatchingAssistant2"),_.prototype.checkAndAdd=function(y){var C=null;y.currentCost>this.currentCost&&(C=this.tryFinalize(),this.currentCost=y.currentCost);var h=y.calculation.matchSequence.map(function(m){return m.key}).join("");return t.returnedValues[h]||(t.returnedValues[h]=y),n[h]||(this.entries.push(new SearchResult(y)),n[h]=y),C},_.prototype.tryFinalize=function(){var y=null;return this.entries.length>0&&(y=this.entries,this.entries=[]),y},_}(),o=new u,l=new a(i*1.5,i),s=Object.values(this.returnedValues),!(s.length>0))return[3,6];f=new priority_queue_default(QUEUE_NODE_COMPARATOR,s),l.startLoop(),S.label=1;case 1:return f.count>0?(c=f.dequeue(),c.isFullReplacement?[3,1]:(d=o.checkAndAdd(c),l.markIteration(),d?[4,d]:[3,3])):[3,4];case 2:S.sent(),S.label=3;case 3:return[3,1];case 4:return p=o.tryFinalize(),p?[4,p]:[3,6];case 5:S.sent(),S.label=6;case 6:l.resetOutlierCheck(),l.startLoop(),g=!1,S.label=7;case 7:w=void 0;do w=this.handleNextNode(),l.markIteration(),l.shouldTimeout()&&(g=!0);while(!g&&w.type=="intermediate");if(b=void 0,w.type=="none")return[3,10];if(w.type=="complete"){if(w.finalNode.isFullReplacement)return[3,10];b=o.checkAndAdd(w.finalNode)}return b?[4,b]:[3,9];case 8:S.sent(),S.label=9;case 9:if(!g&&this.hasNextMatchEntry())return[3,7];S.label=10;case 10:return T=o.tryFinalize(),T?[4,T]:[3,12];case 11:S.sent(),S.label=12;case 12:return[2,null]}})},r.EDIT_DISTANCE_COST_SCALE=5,r.MIN_KEYSTROKE_PROBABILITY=1e-4,r.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL=33,r}(),TransformUtils=function(){function r(){}return v(r,"TransformUtils2"),r.isWhitespace=function(e){var t=/^[\\u0009\\u000A\\u000D\\u0020\\u00a0\\u1680\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u200b\\u2028\\u2029\\u202f\\u205f\\u3000]+$/i;return e.insert.match(t)!=null},r.isBackspace=function(e){return e.insert==""&&e.deleteLeft>0&&!e.deleteRight},r.isEmpty=function(e){return e.insert==""&&e.deleteLeft==0&&!e.deleteRight},r}(),transformUtils_default=TransformUtils;function textToCharTransforms(r,e){for(var t=[],n=0;n<r.kmwLength();n++){var i=r.kmwCharAt(n),a={insert:i,deleteLeft:0,id:e};t.push(a)}return t}v(textToCharTransforms,"textToCharTransforms");var TrackedContextSuggestion=function(){function r(){}return v(r,"TrackedContextSuggestion2"),r}(),TrackedContextToken=function(){function r(){this.transformDistributions=[],this.activeReplacementId=-1}return v(r,"TrackedContextToken2"),Object.defineProperty(r.prototype,"currentText",{get:function(){return this.replacementText===void 0||this.replacementText===null?this.raw:this.replacementText},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"replacement",{get:function(){var e=this.activeReplacementId;return this.replacements.find(function(t){return t.suggestion.id==e})},enumerable:!1,configurable:!0}),r.prototype.revert=function(){delete this.activeReplacementId},r}(),TrackedContextState=function(){function r(e){if(this.searchSpace=[],e instanceof r){var t=e;this.tokens=t.tokens.map(function(i){var a=new TrackedContextToken;return a.raw=i.raw,a.replacements=i.replacements,a.activeReplacementId=i.activeReplacementId,a.transformDistributions=i.transformDistributions,i.replacementText&&(a.replacementText=i.replacementText),a}),this.searchSpace=e.searchSpace,this.indexOffset=0,this.model=e.model}else{var n=e;this.tokens=[],this.indexOffset=Number.MIN_SAFE_INTEGER,this.model=n,n&&n.traverseFromRoot&&(this.searchSpace=[new SearchSpace(n)])}}return v(r,"TrackedContextState2"),Object.defineProperty(r.prototype,"head",{get:function(){return this.tokens[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tail",{get:function(){return this.tokens[this.tokens.length-1]},enumerable:!1,configurable:!0}),r.prototype.popHead=function(){this.tokens.splice(0,2),this.indexOffset-=1},r.prototype.pushTail=function(e){this.model&&this.model.traverseFromRoot?this.searchSpace=[new SearchSpace(this.model)]:this.searchSpace=[],this.tokens.push(e);var t=this;t.searchSpace.length>0&&e.transformDistributions.forEach(function(n){return t.searchSpace[0].addInput(n)})},r.prototype.pushWhitespaceToTail=function(e){e===void 0&&(e=null);var t=new TrackedContextToken;t.transformDistributions=e?[e]:[],t.raw=null,this.tokens.push(t)},r.prototype.replaceTailForBackspace=function(e,t){this.tokens.pop();var n=textToCharTransforms(e,t).map(function(a){return[{sample:a,p:1}]}),i=new TrackedContextToken;i.raw=e,i.transformDistributions=n,this.pushTail(i)},r.prototype.updateTail=function(e,t){var n=this.tail;t=t||(t===""?"":n.raw),e&&e.length>0&&(n.transformDistributions.push(e),this.searchSpace&&this.searchSpace.forEach(function(i){return i.addInput(e)})),n.raw=t},r.prototype.toRawTokenization=function(){var e,t,n=[];try{for(var i=(0,build_exports.__values)(this.tokens),a=i.next();!a.done;a=i.next()){var u=a.value;u.currentText!==null&&n.push(u.currentText)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r}(),CircularArray=function(){function r(e){e===void 0&&(e=r.DEFAULT_ARRAY_SIZE),this.currentHead=0,this.currentTail=0,this.circle=Array(e)}return v(r,"CircularArray2"),Object.defineProperty(r.prototype,"count",{get:function(){var e=this.currentHead-this.currentTail;return e<0&&(e=e+this.circle.length),e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxCount",{get:function(){return this.circle.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"oldest",{get:function(){if(this.count!=0)return this.item(0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"newest",{get:function(){if(this.count!=0)return this.item(this.count-1)},enumerable:!1,configurable:!0}),r.prototype.enqueue=function(e){var t=null,n=(this.currentHead+1)%this.maxCount;return n==this.currentTail&&(t=this.circle[this.currentTail],this.currentTail=(this.currentTail+1)%this.maxCount),this.circle[this.currentHead]=e,this.currentHead=n,t},r.prototype.dequeue=function(){if(this.currentTail==this.currentHead)return null;var e=this.circle[this.currentTail];return this.currentTail=(this.currentTail+1)%this.maxCount,e},r.prototype.popNewest=function(){if(this.currentTail==this.currentHead)return null;var e=this.circle[this.currentHead];return this.currentHead=(this.currentHead-1+this.maxCount)%this.maxCount,e},r.prototype.item=function(e){if(e>=this.count)throw"Invalid array index";var t=(this.currentTail+e)%this.maxCount;return this.circle[t]},r.DEFAULT_ARRAY_SIZE=5,r}(),ContextTracker=function(r){(0,build_exports.__extends)(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return v(e,"ContextTracker2"),e.attemptMatchContext=function(t,n,i){var a=n.toRawTokenization(),u=ClassicalDistanceCalculation.computeDistance(a.map(function(h){return{key:h}}),t.map(function(h){return{key:h}}),1),o=u.editPath(),l=!1,s=!1;if(o.length>1){if(o[0]=="insert"&&!(o[1]=="substitute"&&o.length==2)||o[0].indexOf("transpose")>=0)return null;o[0]=="delete"&&(l=!0)}var f=o.length-1,c=!1;if(o[f]=="delete"||o[0].indexOf("transpose")>=0||(o[f]=="insert"?s=!0:f>0&&o[f-1]=="insert"&&o[f]=="substitute"&&(s=!0,c=!0),f>0&&o[f-1]=="delete"&&o[f]=="substitute"))return null;for(var d=1;d<o.length-(c?2:1);d++)if(o[d]!="match")return null;var p;s?(c&&(n.tail.replacementText=t[t.length-2]),p=new TrackedContextState(n)):p=n;var g=i&&Array.isArray(i),w=g?i[0].sample:null;w&&w.insert==""&&w.deleteLeft==0&&!w.deleteRight&&(w=null);var b=w&&transformUtils_default.isWhitespace(w),T=w&&transformUtils_default.isBackspace(w),S=t[t.length-1];if(o.length>1)if(l&&p.popHead(),s){var _=t[t.length-1],y=new TrackedContextToken;y.raw=_,b||!w?(p.pushWhitespaceToTail(i!=null?i:[]),y.transformDistributions=[]):(p.pushWhitespaceToTail(),y.transformDistributions=i?[i]:[]),p.pushTail(y)}else T?p.replaceTailForBackspace(S,w.id):p.updateTail(w?i:null,S);else if(o[f]=="insert"){var C=new TrackedContextToken;C.raw=t[0],C.transformDistributions=[i],p.pushTail(C)}else T?p.replaceTailForBackspace(S,w.id):p.updateTail(w?i:null,S);return p},e.modelContextState=function(t,n,i){var a=t.map(function(l){var s=new TrackedContextToken;return s.raw=l,s.raw?s.transformDistributions=textToCharTransforms(s.raw).map(function(f){return[{sample:f,p:1}]}):s.transformDistributions=[],s}),u=new TrackedContextState(i);for(a.length>0&&u.pushTail(a.splice(0,1)[0]);a.length>0;)u.pushWhitespaceToTail(),u.pushTail(a.splice(0,1)[0]);if(u.tokens.length==0){var o=new TrackedContextToken;o.raw="",u.pushTail(o)}return u},e.prototype.analyzeState=function(t,n,i){if(!t.traverseFromRoot)throw"This lexical model does not provide adequate data for correction algorithms and context reuse";var a=tokenize(t.wordbreaker||default_,n);if(a.left.length>0)for(var u=this.count-1;u>=0;u--){var o=e.attemptMatchContext(a.left,this.item(u),i);if(o)return o.taggedContext=n,o!=this.item(u)&&this.enqueue(o),o}var l=e.modelContextState(a.left,i,t);return l.taggedContext=n,this.enqueue(l),l},e}(CircularArray),ModelCompositor=function(){function r(e,t){this.SUGGESTION_ID_SEED=0,this.testMode=!1,this.lexicalModel=e,e.traverseFromRoot&&(this.contextTracker=new ContextTracker),this.punctuation=r.determinePunctuationFromModel(e),this.testMode=!!t}return v(r,"ModelCompositor2"),r.prototype.predictFromCorrections=function(e,t){var n,i,a=[],u=v(function(c){var d=o.lexicalModel.predict(c.sample,t),p=d.map(function(g){var w=c.sample,b=c.p;w.id!==void 0&&(g.sample.transformId=w.id);var T={sample:g.sample,p:g.p*b};return T},o);a=a.concat(p)},"_loop_1"),o=this;try{for(var l=(0,build_exports.__values)(e),s=l.next();!s.done;s=l.next()){var f=s.value;u(f)}}catch(c){n={error:c}}finally{try{s&&!s.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}return a},r.prototype.predict=function(e,t){var n,i,a,u,o=[],l=this.lexicalModel,s=this.punctuation;e instanceof Array?e.length==0&&e.push({sample:{insert:"",deleteLeft:0},p:1}):e=[{sample:e,p:1}];var f=e.sort(function(x,P){return P.p-x.p})[0].sample,c=transformUtils_default.isWhitespace(f),d=transformUtils_default.isBackspace(f),p=applyTransform(f,t),g=this.wordbreak(p),w=null,b=[],T,S=null;if(this.contextTracker){var y=this.contextTracker.analyzeState(this.lexicalModel,t,null);S=this.contextTracker.analyzeState(this.lexicalModel,p,transformUtils_default.isEmpty(f)?null:e);var C=S.searchSpace[0],h=0,m=S.tokens,O=m.length,k=m.length-y.tokens.length;O==0||k>0?(h=0,transformUtils_default.isWhitespace(f)&&(T=f,t=p,y=S)):k<0?h=this.wordbreak(p).kmwLength()+f.deleteLeft:h=this.wordbreak(t).kmwLength();var A=m[m.length-1],I=A.transformDistributions.length<=1,E=void 0,D=this.testMode?0:SearchSpace.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL;try{for(var F=(0,build_exports.__values)(C.getBestMatches(D)),q=F.next();!q.done;q=F.next()){var R=q.value,_=R.map(function(P){var W=P.matchString,H;P.inputSequence.length>0?H=P.inputSequence[P.inputSequence.length-1].sample:H=f;var ie={insert:W,deleteLeft:h,id:f.id},ee=P.totalCost;return I&&(ee*=r.SINGLE_CHAR_KEY_PROB_EXPONENT),{sample:ie,p:Math.exp(-ee)}},this),U=this.predictFromCorrections(_,t);U.length>0&&E===void 0&&(E=-Math.log(_[0].p)),b=b.concat(U);var M=R[0].totalCost;if(M>=E+8)break;if(b.length>=r.MAX_SUGGESTIONS){if(M>=E+4)break;if(b.sort(function(P,W){return W.p-P.p}),b[r.MAX_SUGGESTIONS-1].p>Math.exp(-M))break}}}catch(x){n={error:x}}finally{try{q&&!q.done&&(i=F.return)&&i.call(F)}finally{if(n)throw n.error}}}else{var _=void 0;c?(_=[{sample:f,p:1}],T=f):_=e.map(function(x){var P=x.sample;return transformUtils_default.isWhitespace(P)&&!c||transformUtils_default.isBackspace(P)&&!d?null:x}),_=_.filter(function(x){return!!x}),b=this.predictFromCorrections(_,t)}var N={},j=null;l.languageUsesCasing&&(j=this.detectCurrentCasing(p));var V=this.wordbreak(t);try{for(var G=(0,build_exports.__values)(b),B=G.next();!B.done;B=G.next()){var L=B.value,Q=L.sample.displayAs,X=Q==g;if(this.lexicalModel.languageUsesCasing&&(X=X||Q==this.lexicalModel.applyCasing("lower",g)),X)if(w)w.p&&L.p&&(w.p+=L.p);else{var z=L.sample.transform,Y={insert:g,deleteLeft:z.deleteLeft,deleteRight:z.deleteRight,id:z.id},te=transformToSuggestion(Y,L.p);w=this.toAnnotatedSuggestion(te,"keep",quote_behavior_default.noQuotes),w.matchesModel=!0,w.transformId=L.sample.transformId}else{j&&j!="lower"&&(this.applySuggestionCasing(L.sample,V,j),Q=L.sample.displayAs);var J=N[Q];J?J.p+=L.p:N[Q]=L}}}catch(x){a={error:x}}finally{try{B&&!B.done&&(u=G.return)&&u.call(G)}finally{if(a)throw a.error}}if(!w&&g!=""){var Y=(0,build_exports.__assign)({},f),$=transformToSuggestion(Y,1);$.displayAs=g,w=this.toAnnotatedSuggestion($,"keep"),w.matchesModel=!1}for(var re in N){var ne=N[re];o.push(ne)}o=o.sort(function(x,P){return P.p-x.p});var K=o.splice(0,r.MAX_SUGGESTIONS).map(function(x){return x.sample.p&&(x.sample["lexical-p"]=x.sample.p,x.sample["correction-p"]=x.p/x.sample.p,x.sample.p=x.p),x.sample});w&&(K=[w].concat(K));var Z=this;return K.forEach(function(x){if(!t.right)x.transform.insert+=s.insertAfterWord;else{var P=Z.tokenize(t);P&&P.caretSplitsToken&&(x.transform.insert+=s.insertAfterWord)}if(T){var W=buildMergedTransform(T,x.transform);W.id=x.transformId;var H=x;H.transform=W}x.id=Z.SUGGESTION_ID_SEED,Z.SUGGESTION_ID_SEED++}),S&&(S.tail.replacements=K.map(function(x){return{suggestion:x,tokenWidth:1}})),K},r.prototype.applySuggestionCasing=function(e,t,n){var i=t.kmwLength()-e.transform.deleteLeft;i>0&&(e.transform.deleteLeft+=i,e.transform.insert=t.kmwSubstr(0,i)+e.transform.insert),e.transform.insert=this.lexicalModel.applyCasing(n,e.transform.insert),e.displayAs=this.lexicalModel.applyCasing(n,e.displayAs)},r.prototype.toAnnotatedSuggestion=function(e,t,n){n===void 0&&(n=quote_behavior_default.default);var i=quote_behavior_default,a=i.noQuotes;return(t=="keep"||t=="revert")&&(a=i.useQuotes),{transform:e.transform,transformId:e.transformId,displayAs:i.apply(n,e.displayAs,this.punctuation,a),tag:t,p:e.p}},r.determinePunctuationFromModel=function(e){var t=DEFAULT_PUNCTUATION;if(!e.punctuation)return t;var n=e.punctuation,i=n.insertAfterWord;i!==""&&!i&&(i=t.insertAfterWord);var a=n.quotesForKeepSuggestion;a||(a=t.quotesForKeepSuggestion);var u=n.isRTL;return{insertAfterWord:i,quotesForKeepSuggestion:a,isRTL:u}},r.prototype.acceptSuggestion=function(e,t,n){var i=e.transform,a=t.left.kmwSubstr(-i.deleteLeft,i.deleteLeft),u=i.insert.kmwLength(),o={insert:a,deleteLeft:u},l=t;n&&(o=buildMergedTransform(o,n),l=applyTransform(n,l));var s,f=this.tokenize(l);f?(f.left.length>0?s=f.left[f.left.length-1]:s="",s+=f.caretSplitsToken?f.right[0]:""):s=this.wordbreak(l);var c=transformToSuggestion(o);c.displayAs=s;var d=this.toAnnotatedSuggestion(c,"revert");if(e.transformId!=null&&(d.transformId=-e.transformId),e.id!=null?d.id=-e.id:(d.id=-this.SUGGESTION_ID_SEED,this.SUGGESTION_ID_SEED++),this.contextTracker){var p=this.contextTracker.newest;p||(p=this.contextTracker.analyzeState(this.lexicalModel,t)),p.tail.activeReplacementId=e.id;var g=applyTransform(e.transform,t);this.contextTracker.analyzeState(this.lexicalModel,g)}return d},r.prototype.applyReversion=function(e,t){var n=this,i=v(function(){var s=applyTransform(e.transform,t),f=n.predict({insert:"",deleteLeft:0},s);return f.forEach(function(c){c.transformId=-e.transformId}),f},"fallbackSuggestions");if(!this.contextTracker)return i();for(var a=!1,u=this.contextTracker.count-1;u>=0;u--){var o=this.contextTracker.item(u);if(o.tail.activeReplacementId==-e.id){a=!0;break}}if(!a)return i();for(;this.contextTracker.newest.tail.activeReplacementId!=-e.id;)this.contextTracker.popNewest();this.contextTracker.newest.tail.revert();var l=this.contextTracker.newest.tail.replacements.map(function(s){return s.suggestion});return l.forEach(function(s){s.transformId=-e.transformId}),l},r.prototype.wordbreak=function(e){var t=this.lexicalModel;if(t.wordbreaker||!t.wordbreak){var n=t.wordbreaker||default_;return wordbreak(n,e)}else return t.wordbreak(e)},r.prototype.tokenize=function(e){var t=this.lexicalModel;return t.wordbreaker?tokenize(t.wordbreaker,e):null},r.prototype.resetContext=function(e){if(this.contextTracker){var t=tokenize(this.lexicalModel.wordbreaker||default_,e),n=ContextTracker.modelContextState(t.left,null,this.lexicalModel);this.contextTracker.enqueue(n)}},r.prototype.detectCurrentCasing=function(e){var t,n=this.lexicalModel,i=this.wordbreak(e);if(!n.languageUsesCasing)throw"Invalid attempt to detect casing: languageUsesCasing is set to false";if(!n.applyCasing)throw"Invalid LMLayer state:  languageUsesCasing is set to true, but no applyCasing function exists";return e.casingForm=="upper"||e.casingForm=="initial"?e.casingForm:n.applyCasing("lower",i)==i?"lower":n.applyCasing("upper",i)==i?i.kmwLength()>1?"upper":"initial":n.applyCasing("initial",i)==i?"initial":(t=e.casingForm)!==null&&t!==void 0?t:null},r.MAX_SUGGESTIONS=12,r.SINGLE_CHAR_KEY_PROB_EXPONENT=16,r}(),model_compositor_default=ModelCompositor,DEFAULT_PUNCTUATION={quotesForKeepSuggestion:{open:"\\u201C",close:"\\u201D"},insertAfterWord:" "};extendString();var LMLayerWorker=function(){function r(e){e===void 0&&(e={importScripts:null,postMessage:null}),this._testMode=!1,this._postMessage=e.postMessage||postMessage,this._importScripts=e.importScripts||importScripts,this.setupConfigState()}return v(r,"LMLayerWorker2"),r.prototype.error=function(e,t){this.cast("error",{log:e,error:t&&t.stack?t.stack:void 0})},r.prototype.onMessage=function(e){var t=e.data.message;if(!t)throw new Error("Missing required \'message\' property: ".concat(e.data));var n=e.data;if(n.message=="load"){var i=n,a=!1;if(this._currentModelSource&&i.source.type==this._currentModelSource.type&&(i.source.type=="file"&&i.source.file==this._currentModelSource.file||i.source.type=="raw"&&i.source.code==this._currentModelSource.code)&&(a=!0),a){typeof console!="undefined"&&console.warn("Duplicate model load message detected - squashing!");return}else this._currentModelSource=i.source}else n.message=="unload"&&(this._currentModelSource=null);this.state.handleMessage(n)},r.prototype.cast=function(e,t){var n=this._postMessage;n((0,build_exports.__assign)({message:e},t))},r.prototype.loadModel=function(e){try{var t=e.configure(this._platformCapabilities);t.leftContextCodePoints||(t.leftContextCodePoints=t.leftContextCodeUnits),t.rightContextCodePoints||(t.rightContextCodePoints=t.rightContextCodeUnits),t.leftContextCodePoints||(t.leftContextCodePoints=this._platformCapabilities.maxLeftContextCodePoints),t.rightContextCodePoints||(t.rightContextCodePoints=this._platformCapabilities.maxRightContextCodePoints||0),e.languageUsesCasing&&!e.applyCasing&&(e.applyCasing=defaultApplyCasing);var n=this.transitionToReadyState(e);t.wordbreaksAfterSuggestions===void 0&&(t.wordbreaksAfterSuggestions=n.punctuation.insertAfterWord!=""),this.cast("ready",{configuration:t})}catch(i){this.error("loadModel failed!",i)}},r.prototype.loadModelFile=function(e){try{this._importScripts(e)}catch(t){this.error("Error occurred when attempting to load dictionary",t)}},r.prototype.unloadModel=function(){this.transitionToLoadingState()},r.prototype.setupConfigState=function(){var e=this;this.state={name:"unconfigured",handleMessage:function(t){if(t.message!=="config")throw new Error("invalid message; expected \'config\' but got ".concat(t.message));e._platformCapabilities=t.capabilities,e._testMode=!!t.testMode,e.transitionToLoadingState()}}},r.prototype.transitionToLoadingState=function(){var e=this;this.state={name:"modelless",handleMessage:function(t){if(t.message!=="load")throw new Error("invalid message; expected \'load\' but got ".concat(t.message));if(t.source.type=="file")e.loadModelFile(t.source.file);else{var n=t.source.code,i=new Function("LMLayerWorker","models","correction","wordBreakers",n);i(e,models_exports,correction_exports,obj_exports)}}}},r.prototype.transitionToReadyState=function(e){var t=this,n=new model_compositor_default(e,this._testMode);return this.state={name:"ready",handleMessage:function(i){switch(i.message){case"predict":var a=i.transform,c=i.context,f=n.predict(a,c);t.cast("suggestions",{token:i.token,suggestions:f});break;case"wordbreak":var u=wordbreak(e.wordbreaker||default_,i.context);t.cast("currentword",{token:i.token,word:u});break;case"unload":t.unloadModel();break;case"accept":var o=i.suggestion,c=i.context,l=i.postTransform,s=n.acceptSuggestion(o,c,l);t.cast("postaccept",{token:i.token,reversion:s});break;case"revert":var s=i.reversion,c=i.context,f=n.applyReversion(s,c);t.cast("postrevert",{token:i.token,suggestions:f});break;case"reset-context":var c=i.context;n.resetContext(c);break;default:throw new Error("invalid message; expected one of {\'predict\', \'wordbreak\', \'accept\', \'revert\', \'reset-context\', \'unload\'} but got ".concat(i.message))}},compositor:n},n},r.install=function(e){var t=new r({postMessage:e.postMessage,importScripts:e.importScripts.bind(e)});return e.onmessage=t.onMessage.bind(t),t.self=e,e.LMLayerWorker=t,e.models=models_exports,e.correction=correction_exports,e.wordBreakers=obj_exports,t},r}(),obj_default=LMLayerWorker;typeof self!="undefined"&&"postMessage"in self&&"importScripts"in self?obj_default.install(self):window.LMLayerWorker=obj_default;\n',Cc="";var sl=function(){function i(){}return i.constructInstance=function(){return new Worker(this.asBlobURI(Qc))},i.asBlobURI=function(t){var e=Ft(t);e+="\n"+Cc;var n=new Blob([e],{type:"text/javascript"});return URL.createObjectURL(n)},i}(),on=sl;var bc=function(){function i(t,e){this.suggestions=t,this.transcriptionID=e}return i}();var Bl=function(i){(0,d.__extends)(t,i);function t(e,n){n===void 0&&(n=!1);var c=i.call(this)||this;c.recentTranscriptions=[],c._mayPredict=!0,c._mayCorrect=!0,c._state="inactive";var l={maxLeftContextCodePoints:64,maxRightContextCodePoints:n?0:64};return e&&(c.lmEngine=new Bn(l,e)),c}return Object.defineProperty(t.prototype,"activeModel",{get:function(){return this.currentModel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isConfigured",{get:function(){return!!this.configuration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype.unloadModel=function(){this.lmEngine.unloadModel(),delete this.currentModel,delete this.configuration,this._state="inactive",this.emit("statechange","inactive")},t.prototype.loadModel=function(e){var n=this;if(!e)throw new Error("Null reference not allowed.");var c=e.path?"file":"raw",l=c=="file"?e.path:e.code;return this.currentModel=e,this.mayPredict&&(this._state="active",this.emit("statechange","active")),this.lmEngine.loadModel(l,c).then(function(r){n.configuration=r,n._state="configured",n.emit("statechange","configured")}).catch(function(r){var s;r instanceof Error?s=r.message:s=String(r),console.error("Could not load model '"+e.id+"': "+s),n.currentModel=null,n._state="inactive",n.emit("statechange","inactive")})},t.prototype.invalidateContext=function(e,n){if(this.emit("invalidatesuggestions","context"),!this.currentModel||!this.configuration)return Promise.resolve([]);if(this.isActive){if(e){var c=e.buildTranscriptionFrom(e,null,!1);return this.predict_internal(c,!0,n)}}else return Promise.resolve([])},t.prototype.wordbreak=function(e,n){if(!this.isActive)return null;var c=new ye(H.from(e,!1),this.configuration,n);return this.lmEngine.wordbreak(c)},t.prototype.predict=function(e,n){return!this.isActive||!this.currentModel||!this.configuration?null:(this.emit("invalidatesuggestions","new"),this.predict_internal(e,!1,n))},t.prototype.applySuggestion=function(e,n,c){var l=this;if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";var r=this.getPredictionState(e.transformId);if(r){var s=H.from(r.preInput,!1);s.apply(e.transform);var B=s.buildTransformFrom(n);n.apply(B),this.emit("suggestionapplied",n);var o=H.from(r.preInput,!1);o.apply(r.transform);var g=new ye(r.preInput,this.configuration,c()),a=this.lmEngine.acceptSuggestion(e,g,r.transform);return a=a.then(function(F){var y={transform:r.transform,transformId:-r.token,displayAs:F.displayAs,id:F.id,tag:F.tag};return l.predictFromTarget(n,c()),y}),a}else return console.warn("Could not apply the Suggestion!"),null},t.prototype.applyReversion=function(e,n){var c=this;if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";var l=this.getPredictionState(-e.transformId);if(!l){console.warn("Could not apply the Suggestion!");return}var r=H.from(l.preInput,!1);r.apply(e.transform);var s=r.buildTransformFrom(n);n.apply(s);var B=this.lmEngine.revertSuggestion(e,new ye(l.preInput,this.configuration,null));return B.then(function(o){var g=new bc(o,s.id);return c.emit("suggestionsready",g),c.currentPromise=null,o})},t.prototype.predictFromTarget=function(e,n){if(!e)return null;var c=e.buildTranscriptionFrom(e,null,!1);return this.predict(c,n)},t.prototype.predict_internal=function(e,n,c){var l=this;if(!e)return null;var r=new ye(e.preInput,this.configuration,c);this.recordTranscription(e),n&&this.lmEngine.resetContext(r);var s=e.alternates;(!s||s.length==0)&&(s=[{sample:e.transform,p:1}]);var B=e.transform,o=this.currentPromise=this.lmEngine.predict(s,r);return o.then(function(g){if(o==l.currentPromise){var a=new bc(g,B.id);l.emit("suggestionsready",a),l.currentPromise=null}return g})},t.prototype.recordTranscription=function(e){this.recentTranscriptions.push(e),this.recentTranscriptions.length>t.TRANSCRIPTION_BUFFER&&this.recentTranscriptions.splice(0,1)},t.prototype.getPredictionState=function(e){var n=this.recentTranscriptions.filter(function(c){return c.token==e});return n.length==0?null:n[0]},t.prototype.shutdown=function(){this.lmEngine.shutdown()},Object.defineProperty(t.prototype,"isActive",{get:function(){return this.canEnable()?(this.activeModel||!1)&&this._mayPredict:(this._mayPredict=!1,!1)},enumerable:!1,configurable:!0}),t.prototype.canEnable=function(){return!!this.lmEngine},Object.defineProperty(t.prototype,"mayPredict",{get:function(){return this._mayPredict},set:function(e){if(!!this.canEnable()){var n=this._mayPredict;if(this._mayPredict=e,n!=e&&this.activeModel){var c=e?"active":"inactive";this._state=c,this.emit("statechange",c),this.isConfigured&&(this._state="configured",this.emit("statechange","configured"))}}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mayCorrect",{get:function(){return this._mayCorrect},set:function(e){this._mayCorrect=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordbreaksAfterSuggestions",{get:function(){return this.configuration.wordbreaksAfterSuggestions},enumerable:!1,configurable:!0}),t.prototype.tryAcceptSuggestion=function(e){return this.emit("tryaccept",e),!1},t.prototype.tryRevertSuggestion=function(){return this.emit("tryrevert"),!1},t.TRANSCRIPTION_BUFFER=10,t}(hc.default),an=Bl;var ol=function(){function i(t,e,n){if(!t)throw new Error("device must be defined");n||(n=i.DEFAULT_OPTIONS),this.contextDevice=t,this.kbdProcessor=new Ot(t,n),this.lngProcessor=new an(e)}return Object.defineProperty(i.prototype,"languageProcessor",{get:function(){return this.lngProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keyboardProcessor",{get:function(){return this.kbdProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"keyboardInterface",{get:function(){return this.keyboardProcessor.keyboardInterface},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeKeyboard",{get:function(){return this.keyboardInterface.activeKeyboard},set:function(t){this.keyboardInterface.activeKeyboard=t,this.resetContext()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeModel",{get:function(){return this.languageProcessor.activeModel},enumerable:!1,configurable:!0}),i.prototype.processKeyEvent=function(t,e){var n=t.srcKeyboard&&this.activeKeyboard!=t.srcKeyboard,c=this.activeKeyboard;try{return n&&(this.keyboardInterface.activeKeyboard=t.srcKeyboard),this._processKeyEvent(t,e)}finally{n&&(this.keyboardInterface.activeKeyboard=c)}},i.prototype._processKeyEvent=function(t,e){var n,c=t.device.formFactor,l=t.isSynthetic;if((c==x.FormFactor.Desktop||!this.activeKeyboard||this.activeKeyboard.usesDesktopLayoutOnDevice(t.device))&&l&&this.keyboardProcessor.selectLayer(t))return new le;if(this.keyboardProcessor.doModifierPress(t,e,!l)&&!l)return new le;if(this.languageProcessor.isActive){if((t.kName=="K_BKSP"||t.Lcode==I.keyCodes.K_BKSP)&&this.languageProcessor.tryRevertSuggestion())return new le;if((t.kName=="K_SPACE"||t.Lcode==I.keyCodes.K_SPACE)&&this.languageProcessor.tryAcceptSuggestion("space"))return new le}var r=H.from(e,!0),s=this.keyboardProcessor.layerId,B=this.keyboardProcessor.processKeystroke(t,e);t.kNextLayer&&this.keyboardProcessor.selectLayer(t);var o=I.isKnownOSKModifierKey(t.kName);ot((n=B==null?void 0:B.transcription)===null||n===void 0?void 0:n.transform)&&t.kNextLayer&&(o=!0);var g=B!=null;if(g){var a=o?null:this.buildAlternates(B,t,r);B.finalize(this.keyboardProcessor,e,!1),a&&a.length>0&&(B.transcription.alternates=a)}else B=new le,B.transcription=e.buildTranscriptionFrom(e,null,!1),B.triggersDefaultCommand=!0;var F=B.setStore[f.TSS_LAYER]||t.kNextLayer;this.keyboardProcessor.newLayerStore.set(F?this.keyboardProcessor.layerId:""),this.keyboardProcessor.oldLayerStore.set(F?s:"");var y=this.keyboardProcessor.processPostKeystroke(this.contextDevice,e);return y&&y.finalize(this.keyboardProcessor,e,!0),B.predictionPromise=this.languageProcessor.predict(B.transcription,this.keyboardProcessor.layerId),B.triggersDefaultCommand||e.doInputEvent(),g?B:null},i.prototype.buildAlternates=function(t,e,n){var c;if(this.languageProcessor.isActive&&!t.triggersDefaultCommand){var l=e.keyDistribution,r=new ye(n,ye.ENGINE_RULE_WINDOW,this.keyboardProcessor.layerId),s=r.toMock();if(this.languageProcessor.isActive&&l&&e.kbdLayer){var B=Number.MAX_VALUE,o=Ae(),g=void 0;o.performance&&o.performance.now&&(g=function(){return o.performance.now()},B=g()+16);var a=Math.exp(-5);l.sort(function(L,P){return P.p-L.p});var F=this.activeKeyboard.layout(e.device.formFactor);c=[];for(var y=0,u=0,Q=l;u<Q.length;u++){var C=Q[u];if(C.p<a){y+=C.p;break}else if(g&&g()>=B)break;var h=H.from(s,!1),b=F.getLayer(e.kbdLayer).getKey(C.keyId);if(!b){console.warn("Potential fat-finger key could not be found in layer!");continue}var U=this.keyboardProcessor.activeKeyboard.constructKeyEvent(b,e.device,this.keyboardProcessor.stateKeys),V=this.keyboardProcessor.processKeystroke(U,h);if(V&&!V.beep&&C.p>0){var X=V.transcription.transform;X.id=t.transcription.token,c.push({sample:X,p:C.p}),y+=C.p}}c.forEach(function(L){L.p/=y})}}return c},i.prototype.resetContext=function(t){this.keyboardProcessor.resetContext(t),this.languageProcessor.invalidateContext(t,this.keyboardProcessor.layerId)},i.DEFAULT_OPTIONS={baseLayout:"us"},i}(),gn=ol;var Uc=v(A(),1),al=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this)||this;c.initNewContext=!0,c._currentSuggestions=[],c.recentAccept=!1,c.swallowPrediction=!1,c.doRevert=!1,c.recentRevert=!1,c.doTryAccept=function(r){!c.recentAccept&&c.selected?c.accept(c.selected):c.recentAccept&&r=="space"&&(c.recentAccept=!1)},c.doTryRevert=function(){c.doRevert?(c.doRevert=!1,c.recentAccept=!1):c.recentAccept&&(c.showRevert(),c.swallowPrediction=!0)},c.invalidateSuggestions=function(r){c.initNewContext=!1,(!c.swallowPrediction||r=="context")&&(c.recentAccept=!1,c.doRevert=!1,c.recentRevert=!1,r=="context"&&(c.swallowPrediction=!1,c.initNewContext=!0)),r!="new"&&c.clearSuggestions()},c.updateSuggestions=function(r){var s=r.suggestions;c._currentSuggestions=s,c.keepSuggestion=null;for(var B=0,o=s;B<o.length;B++){var g=o[B];g.tag=="keep"&&(c.keepSuggestion=g)}c.keepSuggestion&&c._currentSuggestions.splice(c._currentSuggestions.indexOf(c.keepSuggestion),1),c.swallowPrediction?c.swallowPrediction=!1:(c.recentAccept=!1,c.doRevert=!1,c.recentRevert=!1),c.sendUpdateEvent()},c.onModelStateChange=function(r){(r=="configured"||r=="inactive")&&c.resetContext()},c.langProcessor=e,c.kbdProcessor=n;var l=function(){return c.currentTarget&&e.state=="configured"};return c.suggestionApplier=function(r){if(l())return e.applySuggestion(r,c.currentTarget,function(){return n.layerId})},c.suggestionReverter=function(r){l()&&e.applyReversion(r,c.currentTarget)},c.postApplicationHandler=function(){var r;n.newLayerStore.set(""),n.oldLayerStore.set(""),(r=n.processPostKeystroke(n.contextDevice,c.currentTarget))===null||r===void 0||r.finalize(n,c.currentTarget,!0)},c.connect(),c}return Object.defineProperty(t.prototype,"currentTarget",{get:function(){return this._currentTarget},enumerable:!1,configurable:!0}),t.prototype.setCurrentTarget=function(e){var n=this._currentTarget;return this._currentTarget=e,n!=e?this.resetContext():Promise.resolve([])},t.prototype.connect=function(){this.langProcessor.addListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.addListener("suggestionsready",this.updateSuggestions),this.langProcessor.addListener("tryaccept",this.doTryAccept),this.langProcessor.addListener("tryrevert",this.doTryRevert),this.langProcessor.addListener("statechange",this.onModelStateChange),this.langProcessor.addListener("suggestionapplied",this.postApplicationHandler)},t.prototype.disconnect=function(){this.langProcessor.removeListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.removeListener("suggestionsready",this.updateSuggestions),this.langProcessor.removeListener("tryaccept",this.doTryAccept),this.langProcessor.removeListener("tryrevert",this.doTryRevert),this.langProcessor.removeListener("statechange",this.onModelStateChange),this.langProcessor.removeListener("suggestionapplied",this.postApplicationHandler),this.clearSuggestions()},Object.defineProperty(t.prototype,"currentSuggestions",{get:function(){var e=[];return this.activateKeep()&&this.keepSuggestion&&this.keepSuggestion.matchesModel?e.push(this.keepSuggestion):this.doRevert&&e.push(this.revertSuggestion),e.concat(this._currentSuggestions)},enumerable:!1,configurable:!0}),t.prototype.acceptInternal=function(e){return e?e.tag=="revert"?(this.suggestionReverter(e),null):this.suggestionApplier(e):null},t.prototype.accept=function(e){var n=this;return this.selected=null,this.doRevert=!1,this.revertAcceptancePromise=this.acceptInternal(e),this.revertAcceptancePromise?(this.revertAcceptancePromise.then(function(c){c&&(n.revertSuggestion=c)}),this.recentAccept=!0,this.recentRevert=!1,this.swallowPrediction=!0,this.revertAcceptancePromise):(e&&e.tag=="revert"&&(this.recentAccept=!1,this.recentRevert=!0),null)},t.prototype.showRevert=function(){this.doRevert=!0,this.sendUpdateEvent()},t.prototype.clearSuggestions=function(){this.updateSuggestions({suggestions:[],transcriptionID:0})},t.prototype.activateKeep=function(){return!this.recentAccept&&!this.recentRevert&&!this.initNewContext},t.prototype.sendUpdateEvent=function(){this.emit("update",this.currentSuggestions)},t.prototype.resetContext=function(){var e=this.currentTarget;return e?this.langProcessor.invalidateContext(e,this.kbdProcessor.layerId):Promise.resolve([])},t}(Uc.default),dn=al;var xc=function(){function i(t,e,n,c){this.Pelem=t,this.Peventname=e.toLowerCase(),this.Phandler=n,this.PuseCapture=c}return i.prototype.equals=function(t){return this.Pelem==t.Pelem&&this.Peventname==t.Peventname&&this.Phandler==t.Phandler&&this.PuseCapture==t.PuseCapture},i}(),ue=function(){function i(){this.domEvents=[]}return i.prototype.attachDOMEvent=function(t,e,n,c){this.detachDOMEvent(t,e,n,c),t.addEventListener(e,n,!!c);var l=new xc(t,e,n,c);this.domEvents.push(l)},i.prototype.detachDOMEvent=function(t,e,n,c){t.removeEventListener(e,n,c);for(var l=new xc(t,e,n,c),r=0;r<this.domEvents.length;r++)if(this.domEvents[r].equals(l)){this.domEvents.splice(r,1);break}},i.prototype.shutdown=function(){for(var t=0,e=this.domEvents;t<e.length;t++){var n=e[t];this.detachDOMEvent(n.Pelem,n.Peventname,n.Phandler,n.PuseCapture)}},i}();var Fn=v(A(),1),yt=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return e instanceof Fn.default?(e.on=n.listenerRegistrationSpy("listeneradded",e,e.on),e.addListener=n.listenerRegistrationSpy("listeneradded",e,e.addListener),e.off=n.listenerRegistrationSpy("listenerremoved",e,e.off),e.removeListener=n.listenerRegistrationSpy("listenerremoved",e,e.off)):(e.addEventListener=n.listenerRegistrationSpy("listeneradded",e,e.addEventListener),e.removeEventListener=n.listenerRegistrationSpy("listenerremoved",e,e.removeEventListener)),n}return t.prototype.listenerRegistrationSpy=function(e,n,c){var l=this;return function(r,s){var B=c.apply(n,[r,s]);return l.emit(e,r),B}},t}(Fn.default);var ut=function(){function i(){this.events={},this.currentEvents=[]}return i.prototype.addEventListener=function(t,e){return this._removeEventListener(t,e),this.events[t].push(e),!0},i.prototype.removeEventListener=function(t,e){return this._removeEventListener(t,e)},i.prototype._removeEventListener=function(t,e){typeof this.events[t]=="undefined"&&(this.events[t]=[]);for(var n=0;n<this.events[t].length;n++)if(this.events[t][n]==e)return this.events[t].splice(n,1),!0;return!1},i.prototype.callEvent=function(t,e){if(typeof this.events[t]=="undefined")return!0;if(this.currentEvents.indexOf(t)!=-1)return!1;this.currentEvents.push(t);for(var n=0;n<this.events[t].length;n++){var c=this.events[t][n],l=!1;try{l=c(e)}catch(r){console.error(r),l=!1}if(l===!1)return this.currentEvents.pop(),!1}return this.currentEvents.pop(),!0},i.prototype.listenerCount=function(t){var e=this.events[t];return e?e.length:0},i.prototype.shutdown=function(){this.events={}},i}();var gl=function(){function i(t){t===void 0&&(t=!1),this.fileLocal=t}return i.prototype.request=function(t){var e=new R,n=window.setTimeout(function(){e.reject(new Error(oc))},1e4),c="&timerid="+n,l=t+c,r=document.createElement("script");r.onload=function(s){window.clearTimeout(n),e.hasFinalized||e.reject(new Error(ac))},r.onerror=function(s,B,o,g,a){window.clearTimeout(n);var F=en;a&&(F=F+": "+a.message),e.reject(new Error(F))},this.fileLocal?r.src=t:r.src=l;try{document.body.appendChild(r)}catch(s){document.getElementsByTagName("head")[0].appendChild(r)}return e.finally(function(){clearTimeout(n)}),{promise:e,queryId:n}},i}(),Vc=gl;function dl(){return typeof window.KeymanWeb_BaseLayout!="undefined"?window.KeymanWeb_BaseLayout:"us"}var Fl=function(){function i(t,e,n,c){var l=this;this.legacyAPIEvents=new ut,this.keyEventListener=function(s,B){var o,g,a,F=l.contextManager.activeTarget;(!l.contextManager.activeKeyboard||!F)&&B&&B(null,null),s.isSynthetic?l.keyEventRefocus&&l.keyEventRefocus():!((g=(o=l.osk)===null||o===void 0?void 0:o.vkbd)===null||g===void 0)&&g.keyPending&&(l.osk.vkbd.keyPending=null),F.invalidateSelection(),F.deadkeys().deleteMatched();var y=l.core.processKeyEvent(s,F);y&&((a=y.transcription)===null||a===void 0?void 0:a.transform)&&l.config.onRuleFinalization(y,l.contextManager.activeTarget),B&&B(y,null)},this.config=e,this.contextManager=n;var r=c(this);r.baseLayout=dl(),this.interface=r.keyboardInterface,this.core=new gn(e.hostDevice,t,r),this.core.languageProcessor.on("statechange",function(s){var B,o;(B=l.osk)===null||B===void 0||B.bannerController.selectBanner(s),(o=l.osk)===null||o===void 0||o.refreshLayout()}),this.core.keyboardProcessor.on("statekeychange",function(s){var B,o;(o=(B=l.osk)===null||B===void 0?void 0:B.vkbd)===null||o===void 0||o.updateStateKeys(s)}),this.contextManager.on("beforekeyboardchange",function(s){l.legacyAPIEvents.callEvent("beforekeyboardchange",{internalName:s==null?void 0:s.id,languageCode:s==null?void 0:s.langId})}),this.contextManager.on("keyboardchange",function(s){var B,o;l.refreshModel(),l.core.activeKeyboard=s==null?void 0:s.keyboard,l.legacyAPIEvents.callEvent("keyboardchange",{internalName:(B=s==null?void 0:s.metadata.id)!==null&&B!==void 0?B:"",languageCode:(o=s==null?void 0:s.metadata.langId)!==null&&o!==void 0?o:""}),s||l.osk.startHide(!1),l.osk&&(l.osk.setNeedsLayout(),l.osk.activeKeyboard=s,l.osk.present())}),this.contextManager.on("keyboardasyncload",function(s){var B,o;l.config.hostDevice.touchable&&((B=l.osk)===null||B===void 0?void 0:B.activationModel)&&(l.osk.activationModel.enabled=!0),(o=l.osk)===null||o===void 0||o.startHide(!1)})}return i.prototype.init=function(t){return(0,d.__awaiter)(this,void 0,void 0,function(){var e,n,c,l=this;return(0,d.__generator)(this,function(r){return e=this.config,e.deferForInitialization.hasFinalized?[2,Promise.resolve()]:(e.initialize(t),n=new Ic(this.interface,e.applyCacheBusting),this.keyboardRequisitioner=new cn(n,new Vc,this.config.paths),this.modelCache=new ln,c=this.keyboardRequisitioner.cache,this.contextManager.configure({resetContext:function(s){l.core.resetContext(s)},predictionContext:new dn(this.core.languageProcessor,this.core.keyboardProcessor),keyboardCache:this.keyboardRequisitioner.cache}),this.config.on("spacebartext",function(){var s;(s=l.osk)===null||s===void 0||s.refreshLayout()}),c.on("stubadded",function(s){var B=function(){l.legacyAPIEvents.callEvent("keyboardregistered",{internalName:s.KI,language:s.KL,keyboardName:s.KN,languageCode:s.KLC,package:s.KP}),l.config.activateFirstKeyboard&&l.keyboardRequisitioner.cache.defaultStub==s&&l.contextManager.activateKeyboard(s.id,s.langId,!0)};l.config.deferForInitialization.hasFinalized?B():l.config.deferForInitialization.then(B)}),c.on("keyboardadded",function(s){var B=function(){l.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:s.id})};l.config.deferForInitialization.hasFinalized?B():l.config.deferForInitialization.then(B)}),this.keyboardRequisitioner.cache.on("keyboardadded",function(s){l.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:s.id})}),[2])})})},Object.defineProperty(i.prototype,"build",{get:function(){return Number.parseInt(we.VERSION_PATCH,10)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"version",{get:function(){return we.VERSION_RELEASE},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hardKeyboard",{get:function(){return this._hardKeyboard},set:function(t){this._hardKeyboard&&this._hardKeyboard.off("keyevent",this.keyEventListener),this._hardKeyboard=t,t.on("keyevent",this.keyEventListener)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"osk",{get:function(){return this._osk},set:function(t){this._osk&&(this._osk.off("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=this.osk.layerChangeHandler),this._osk=t,t&&(t.activeKeyboard=this.contextManager.activeKeyboard,t.on("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=t.layerChangeHandler)},enumerable:!1,configurable:!0}),i.prototype.getDebugInfo=function(){var t={configReport:this.config.debugReport()};return t},i.prototype.refreshModel=function(){var t=this.contextManager.activeKeyboard,e=this.modelCache.modelForLanguage(t==null?void 0:t.metadata.langId);return this.core.activeModel!=e&&(this.core.activeModel&&this.core.languageProcessor.unloadModel(),e)?this.core.languageProcessor.loadModel(e).then(function(){return e}):Promise.resolve(e)},i.prototype.addEventListener=function(t,e){this.legacyAPIEvents.addEventListener(t,e)},i.prototype.removeEventListener=function(t,e){this.legacyAPIEvents.removeEventListener(t,e)},i.prototype.shutdown=function(){var t;this.legacyAPIEvents.shutdown(),(t=this.osk)===null||t===void 0||t.shutdown()},i.prototype.addModel=function(t){var e;this.modelCache.register(t);var n=(e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata;return n&&t.languages.indexOf(n.langId)!=-1?this.refreshModel().then(function(){}):Promise.resolve()},i.prototype.removeModel=function(t){this.modelCache.unregister(t),this.core.activeModel&&this.core.activeModel.id==t&&this.core.languageProcessor.unloadModel()},i.prototype.setActiveKeyboard=function(t,e){return(0,d.__awaiter)(this,void 0,void 0,function(){return(0,d.__generator)(this,function(n){return[2,this.contextManager.activateKeyboard(t,e,!0)]})})},i.prototype.getActiveKeyboard=function(){var t,e;return(e=(t=this.contextManager.activeKeyboard)===null||t===void 0?void 0:t.metadata.id)!==null&&e!==void 0?e:""},i.prototype.getActiveLanguage=function(t){var e,n,c,l=(e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata;return t?(c=l==null?void 0:l.langName)!==null&&c!==void 0?c:"":(n=l==null?void 0:l.langId)!==null&&n!==void 0?n:""},i.prototype.isChiral=function(t){var e;if(t){if(typeof t=="string"){var n=this.keyboardRequisitioner.cache.getKeyboard(t);if(n)t=n;else throw new Error("Keyboard '".concat(t,"' has not been loaded."))}e=t}else e=this.core.activeKeyboard;return e.isChiral},i.prototype.resetContext=function(){this.contextManager.resetContext()},i.prototype.setNumericLayer=function(){this.core.keyboardProcessor.setNumericLayer(this.config.softDevice)},i}(),yn=Fl;var Yc=v(A(),1);var mc=v(A(),1);var Xc=v(A(),1);var yl=function(){function i(t){this.config=t}return i.prototype.onInputStart=function(t){this.config.inputStartHandler&&this.config.inputStartHandler(t)},i.prototype.onInputMove=function(t){this.config.inputMoveHandler&&this.config.inputMoveHandler(t)},i.prototype.onInputMoveCancel=function(t){this.config.inputMoveCancelHandler&&this.config.inputMoveCancelHandler(t)},i.prototype.onInputEnd=function(t){this.config.inputEndHandler&&this.config.inputEndHandler(t)},i}(),It=yl;var ul=function(){function i(t,e,n){this.x=t,this.y=e,n&&(this.source=n)}return i.fromEvent=function(t){var e;if(window.TouchEvent&&t instanceof TouchEvent||t.changedTouches?e=t.changedTouches[0]:e=t,e.pageX)return new i(e.pageX,e.pageY,t);if(e.clientX){var n=e.clientX+document.body.scrollLeft,c=e.clientY+document.body.scrollTop;return new i(n,c,t)}else return new i(null,null,t)},Object.defineProperty(i.prototype,"activeInputCount",{get:function(){if(window.TouchEvent&&this.source.touches!==void 0&&this.source.touches!==null)return this.source.touches.length;var t=this.source;return t.buttons>0?1:0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"target",{get:function(){var t;return(t=this.source)===null||t===void 0?void 0:t.target},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isFromTouch",{get:function(){return!this.isFromMouse},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isFromMouse",{get:function(){return this.source instanceof MouseEvent},enumerable:!1,configurable:!0}),i}(),K=ul;var Il=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this,e)||this;return n.hasActiveClick=!1,n.ignoreSequence=!1,n._mouseStart=n.onMouseStart.bind(n),n._mouseMove=n.onMouseMove.bind(n),n._mouseEnd=n.onMouseEnd.bind(n),n}return t.prototype.registerEventHandlers=function(){this.config.eventRoot.addEventListener("mousedown",this._mouseStart,!0),this.config.eventRoot.addEventListener("mousemove",this._mouseMove,!1),this.config.eventRoot.addEventListener("mouseup",this._mouseEnd,!0)},t.prototype.unregisterEventHandlers=function(){this.config.eventRoot.removeEventListener("mousedown",this._mouseStart,!0),this.config.eventRoot.removeEventListener("mousemove",this._mouseMove,!1),this.config.eventRoot.removeEventListener("mouseup",this._mouseEnd,!0)},t.prototype.preventPropagation=function(e){e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,typeof e.stopImmediatePropagation=="function"?e.stopImmediatePropagation():typeof e.stopPropagation=="function"&&e.stopPropagation()},t.prototype.onMouseStart=function(e){if(!this.config.targetRoot.contains(e.target)){this.ignoreSequence=!0;return}this.preventPropagation(e),this.onInputStart(K.fromEvent(e)),this.hasActiveClick=!0},t.prototype.onMouseMove=function(e){if(!this.ignoreSequence){var n=K.fromEvent(e);if(e.buttons){if(!this.hasActiveClick)return}else{this.hasActiveClick&&(this.hasActiveClick=!1,this.onInputMoveCancel(n));return}this.preventPropagation(e),this.config.coordConstrainedWithinInteractiveBounds(n)?this.onInputMove(n):this.onInputMoveCancel(n)}},t.prototype.onMouseEnd=function(e){if(this.ignoreSequence){this.ignoreSequence=!1;return}e.buttons||(this.hasActiveClick=!1),this.onInputEnd(K.fromEvent(e))},t}(It),Qt=Il;var Ql=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this,e)||this;return n._touchStart=n.onTouchStart.bind(n),n._touchMove=n.onTouchMove.bind(n),n._touchEnd=n.onTouchEnd.bind(n),n}return t.prototype.registerEventHandlers=function(){this.config.eventRoot.addEventListener("touchstart",this._touchStart,!0),this.config.eventRoot.addEventListener("touchmove",this._touchMove,!1),this.config.eventRoot.addEventListener("touchend",this._touchEnd,!0)},t.prototype.unregisterEventHandlers=function(){this.config.eventRoot.removeEventListener("touchstart",this._touchStart,!0),this.config.eventRoot.removeEventListener("touchmove",this._touchMove,!1),this.config.eventRoot.removeEventListener("touchend",this._touchEnd,!0)},t.prototype.preventPropagation=function(e){e.preventDefault(),e.cancelBubble=!0,typeof e.stopImmediatePropagation=="function"?e.stopImmediatePropagation():typeof e.stopPropagation=="function"&&e.stopPropagation()},t.prototype.onTouchStart=function(e){this.onInputStart(K.fromEvent(e))},t.prototype.onTouchMove=function(e){this.preventPropagation(e);var n=K.fromEvent(e);this.config.coordConstrainedWithinInteractiveBounds(n)?this.onInputMove(n):this.onInputMoveCancel(n)},t.prototype.onTouchEnd=function(e){this.onInputEnd(K.fromEvent(e))},t}(It),Ct=Ql;var Cl=function(){function i(t){this.totalLength=0,this.x=t.x,this.totalLength=0}return i.prototype.updateTo=function(t){var e=this.x;this.x=t.x;var n={deltaX:this.x-e};return this.totalLength+=Math.abs(n.deltaX),n},Object.defineProperty(i.prototype,"hasScrolled",{get:function(){return this.totalLength>i.HAS_SCROLLED_FUDGE_FACTOR},enumerable:!1,configurable:!0}),i.HAS_SCROLLED_FUDGE_FACTOR=10,i}(),bl=function(){function i(t,e,n){this.baseElement=t,this.rowClassMatch=e,this.selectedTargetMatch=n}return i.prototype.findTargetFromTouch=function(t,e,n){for(var c=t.x;e&&e.className!==void 0&&e.className.indexOf(this.rowClassMatch)<0;)e=e.parentNode;if(!e)return null;var l,r=0,s=24,B=1e5,o,g;for(l=0;l<e.childNodes.length;l++){var a=e.childNodes[l];if(!this.isInvalidTarget(this.findTargetFrom(a))){o=a.offsetLeft,g=o+a.offsetWidth;var F=o-c;F>=0&&F<B&&(r=l,B=F);var y=c-g;if(y>=0&&y<B&&(r=l,B=y),y<0&&F<0)return this.findTargetFrom(a)}}return B<1e5&&(e=e.childNodes[r],o=e.offsetLeft,g=o+e.offsetWidth,e.offsetWidth>40&&(s=.6*e.offsetWidth),o-c>=0&&o-c<s||c-g>=0&&c-g<s)?this.findTargetFrom(e):null},i.prototype.findBestTarget=function(t,e){var n;if(e){var c=t.x+document.body.scrollLeft,l=t.y+document.body.scrollTop;n=document.elementFromPoint(c,l)}else n=t.target;var r=this.findTargetFrom(n);return r||(r=this.findTargetFromTouch(t,n,e)),r},i.prototype.isInvalidTarget=function(t){return!1},i.prototype.touchStart=function(t){if(this.currentTarget=this.findBestTarget(t),this.touchX=t.x,this.touchY=t.y,this.touchCount=t.activeInputCount,!!this.currentTarget){var e=this.currentTarget.clientWidth<this.currentTarget.scrollWidth;this.scrollTouchState=e?new Cl(t):null,this.highlight(this.currentTarget,!0),this.pendingTarget?(this.highlight(this.pendingTarget,!1),this.select(this.pendingTarget),this.clearHolds(),this.touchCount--):this.hold(this.currentTarget),this.pendingTarget=this.currentTarget}},i.prototype.touchEnd=function(t){var e=this.currentTarget;if(this.isSubmenuActive()||this.hasModalPopup()){if(t.activeInputCount>0)return;(e==null||e.id.indexOf("popup")<0)&&(this.pendingTarget&&this.highlight(this.pendingTarget,!1),this.clearHolds(),this.pendingTarget=null)}var n=t.x,c=n<2&&this.touchX>5||n>window.innerWidth-2&&this.touchX<window.innerWidth-5;this.scrollTouchState&&(c=c||this.scrollTouchState.hasScrolled);var l=this.touchCount;this.touchCount>0&&this.touchCount--,this.pendingTarget?(this.highlight(this.pendingTarget,!1),this.pendingTarget.className.indexOf("hidden")<0&&l>0&&!c&&this.select(this.pendingTarget),this.clearHolds(),this.pendingTarget=null):(e=this.findBestTarget(t),e&&this.highlight(e,!1))},i.prototype.touchMove=function(t){if(!(t.activeInputCount>1||this.touchCount==0)){if(this.currentTarget&&this.scrollTouchState!=null){var e=this.scrollTouchState.updateTo(t).deltaX;this.currentTarget.scrollLeft-=window.devicePixelRatio*e;return}var n=t.y,c=this.pendingTarget,l=this.findBestTarget(t,!0);if(this.hasModalPopup()){c&&this.highlight(c,!1),this.pendingTarget=null;return}if(l=this.dealiasSubTarget(l),this.currentTarget=l,c&&l&&l!==c&&this.highlight(c,!1),l&&this.hasSubmenu(l)){if(l&&l.id.indexOf("popup")<0)return;l&&l.className.indexOf(this.selectedTargetMatch)<0&&this.highlight(l,!0)}else{var r=this.baseElement,s=Z(r),B=r.offsetHeight,o=Math.max(5,s-.25*B),g=s+B+.25*B;c&&(t.y<o||t.y>g)&&(this.highlight(c,!1),this.clearHolds(),this.pendingTarget=null)}l&&this.pendingTarget&&(this.pendingTarget=l),this.pendingTarget&&l&&(c!=l||l.className.indexOf(this.selectedTargetMatch)<0)&&this.highlight(l,!0),c&&l&&l!=c&&l.id!=""&&this.hold(l)}},i}(),Gc=bl;var Ze=function(){function i(t){var e=m("div");e.id=i.BANNER_ID,e.className=i.BANNER_CLASS,this.div=e,this.height=t,this.update()}return Object.defineProperty(i.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t>0?t:0,this.update()},enumerable:!1,configurable:!0}),i.prototype.update=function(){var t=this.div.style,e=t.height,n=t.display;return this._height>0?(t.height=this._height+"px",t.display="block"):(t.height="0px",t.display="none"),e!==t.height||n!==t.display},i.prototype.appendStyleSheet=function(){},i.prototype.getDiv=function(){return this.div},i.prototype.configureForKeyboard=function(t,e){},i.DEFAULT_HEIGHT=37,i.BANNER_CLASS="kmw-banner-bar",i.BANNER_ID="kmw-banner-bar",i}();var bt=function(i){(0,d.__extends)(t,i);function t(){return i.call(this,0)||this}return t}(Ze);var pc=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this;e.length>0?(c=i.call(this)||this,n&&(c.height=n)):c=i.call(this,0)||this,e.indexOf("base64")>=0?console.log("Loading img from base64 data"):console.log("Loading img with src '"+e+"'"),c.img=document.createElement("img"),c.img.setAttribute("src",e);var l=c.img.style;return l.width="100%",l.height="100%",c.getDiv().appendChild(c.img),console.log("Image loaded."),c}return t.prototype.setImagePath=function(e){this.img&&this.img.setAttribute("src",e)},t}(Ze);var hl=function(){function i(t,e){this.rtl=!1,this.index=t,this.rtl=e,this.constructRoot();var n=this.display=m("span");this.div.appendChild(n)}return i.prototype.constructRoot=function(){var t=this.div=m("div"),e=t.style;t.className="kmw-suggest-option",t.id=i.BASE_ID+this.index;var n=100-me.MARGIN*(me.SUGGESTION_LIMIT-1),c=n/me.SUGGESTION_LIMIT;e.width=c+"%",this.div.suggestion=this},i.prototype.matchKeyboardProperties=function(t){var e=this.div;if(t){t.KLC&&(e.lang=t.KLC);var n=t.KFont;n&&n.family&&n.family!=""&&(e.style.fontFamily=this.fontFamily=n.family)}},Object.defineProperty(i.prototype,"suggestion",{get:function(){return this._suggestion},enumerable:!1,configurable:!0}),i.prototype.update=function(t){this._suggestion=t,this.updateText()},i.prototype.updateText=function(){var t=this.generateSuggestionText(this.rtl);this.div.replaceChild(t,this.display),this.display=t},i.prototype.isEmpty=function(){return!this._suggestion},i.prototype.generateSuggestionText=function(t){var e=this._suggestion,n,c=m("span");if(c.className="kmw-suggestion-text",e==null)return c;if(e.displayAs==null||e.displayAs=="")n="\xA0";else{var l=t?8238:8237;n=String.fromCharCode(l)+e.displayAs}return c.innerHTML=n,c},i.BASE_ID="kmw-suggestion-",i}();var me=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,n||Ze.DEFAULT_HEIGHT)||this;return c.currentSuggestions=[],c.options=[],c.onSuggestionUpdate=function(l){c.currentSuggestions=l,c.options.forEach(function(r,s){s<l.length?r.update(l[s]):r.update(null)})},c.hostDevice=e,c.getDiv().className=c.getDiv().className+" "+t.BANNER_CLASS,c.buildInternals(!1),c.manager=new Ul(c.getDiv()),c.events=c.manager.events,c.setupInputHandling(),c}return t.prototype.buildInternals=function(e){this.options.length>0&&this.options.splice(0,this.options.length);for(var n=0;n<t.SUGGESTION_LIMIT;n++){var c=new hl(n,e);this.options[n]=c}for(var n=0;n<t.SUGGESTION_LIMIT;n++){var l=e?t.SUGGESTION_LIMIT-n-1:n;if(this.getDiv().appendChild(this.options[l].div),n!=t.SUGGESTION_LIMIT){var r=m("div");r.className="kmw-banner-separator";var s=r.style;s.marginLeft=t.MARGIN/2+"%",s.marginRight=t.MARGIN/2+"%",this.getDiv().appendChild(r)}}},t.prototype.setupInputHandling=function(){var e=this,n;this.hostDevice.touchable?n=this.touchEventConfig:n=this.mouseEventConfig,n.registerEventHandlers(),this.manager.events.on("highlight",function(c,l){var r=c.div,s=r.className,B=" "+t.TOUCHED_CLASS;l&&s.indexOf(B)<0?r.className=s+B:r.className=s.replace(B,"")}),this.manager.events.on("apply",function(c){e.predictionContext&&e.predictionContext.accept(c.suggestion)})},t.prototype.configureForKeyboard=function(e,n){var c=e.isRTL;this.getDiv().textContent="",this.buildInternals(c),this.options.forEach(function(l){return l.matchKeyboardProperties(n)}),this.onSuggestionUpdate(this.currentSuggestions)},Object.defineProperty(t.prototype,"mouseEventConfig",{get:function(){var e={targetRoot:this.getDiv(),eventRoot:document.body,inputStartHandler:this.manager.touchStart.bind(this.manager),inputMoveHandler:this.manager.touchMove.bind(this.manager),inputEndHandler:this.manager.touchEnd.bind(this.manager),coordConstrainedWithinInteractiveBounds:function(){return!0}};return new Qt(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"touchEventConfig",{get:function(){var e={targetRoot:this.getDiv(),eventRoot:this.getDiv(),inputStartHandler:this.manager.touchStart.bind(this.manager),inputMoveHandler:this.manager.touchMove.bind(this.manager),inputEndHandler:this.manager.touchEnd.bind(this.manager),coordConstrainedWithinInteractiveBounds:function(){return!0}};return new Ct(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"predictionContext",{get:function(){return this._predictionContext},set:function(e){this._predictionContext&&this._predictionContext.off("update",this.onSuggestionUpdate),this._predictionContext=e,e&&(e.on("update",this.onSuggestionUpdate),this.onSuggestionUpdate(e.currentSuggestions))},enumerable:!1,configurable:!0}),t.SUGGESTION_LIMIT=3,t.MARGIN=1,t.TOUCHED_CLASS="kmw-suggest-touched",t.BANNER_CLASS="kmw-suggest-banner",t}(Ze);var Ul=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this,e,Ze.BANNER_CLASS,me.TOUCHED_CLASS)||this;return n.events=new Xc.default,n}return t.prototype.findTargetFrom=function(e){try{if(e){if(e.classList.contains("kmw-suggest-option"))return e;if(e.parentElement&&e.parentElement.classList.contains("kmw-suggest-option"))return e.parentElement}}catch(n){}return null},t.prototype.highlight=function(e,n){var c=e.suggestion;c.isEmpty()&&(n=!1),this.events.emit("highlight",c,n)},t.prototype.select=function(e){this.events.emit("apply",e.suggestion)},t.prototype.hold=function(e){this.events.emit("hold",e.suggestion)},t.prototype.clearHolds=function(){},t.prototype.hasModalPopup=function(){return this.eventsBlocked},t.prototype.dealiasSubTarget=function(e){return e},t.prototype.hasSubmenu=function(e){return!1},t.prototype.isSubmenuActive=function(){return!1},t.prototype.displaySubmenuFor=function(e){throw new Error("Method not implemented.")},Object.defineProperty(t.prototype,"eventsBlocked",{get:function(){return!!this.eventDisablePromise},enumerable:!1,configurable:!0}),t.prototype.temporarilyBlockEvents=function(e){var n=this;this.eventDisablePromise=e,e.finally(function(){n.eventDisablePromise=null})},t}(Gc);var G=function(){function i(t){var e=typeof t=="string"?i.parseLengthStyle(t):t;this.val=e.val,this.absolute=e.absolute,e.special&&(this.special=e.special)}return Object.defineProperty(i.prototype,"styleString",{get:function(){return this.absolute?this.val+"px":this.special?this.val+this.special:this.val*100+"%"},enumerable:!1,configurable:!0}),i.prototype.scaledBy=function(t){return new i({val:t*this.val,absolute:this.absolute})},i.inPixels=function(t){return new i({val:t,absolute:!0})},i.inPercent=function(t){return new i({val:t/100,absolute:!1})},i.forScalar=function(t){return new i({val:t,absolute:!1})},i.special=function(t,e){return new i({val:t,absolute:!1,special:e})},i.parseLengthStyle=function(t){var e=parseFloat(t);return isNaN(e)?(console.error("Could not properly parse specified length style info: '"+t+"'."),null):t.indexOf("px")!=-1?{val:e,absolute:!0}:t.indexOf("pt")!=-1?{val:4*e/3,absolute:!0}:t.indexOf("%")!=-1?{val:e/100,absolute:!1}:t.indexOf("rem")!=-1?{val:e,absolute:!1,special:"rem"}:t.indexOf("em")!=-1?{val:e,absolute:!1,special:"em"}:{val:4*e/3,absolute:!0}},i}();var xl=function(){function i(){this._activeBannerHeight=Ze.DEFAULT_HEIGHT,this.events=new mc.default,this.constructContainer()}return i.prototype.constructContainer=function(){var t=m("div");return t.id="keymanweb_banner_container",t.className="kmw-banner-container",this.bannerContainer=t},Object.defineProperty(i.prototype,"element",{get:function(){return this.bannerContainer},enumerable:!1,configurable:!0}),i.prototype.appendStyles=function(){this.activeBanner&&this.activeBanner.appendStyleSheet()},Object.defineProperty(i.prototype,"banner",{get:function(){return this.activeBanner},set:function(t){if(this.activeBanner){if(t==this.activeBanner)return;var e=this.activeBanner;this.activeBanner=t,this.bannerContainer.replaceChild(t.getDiv(),e.getDiv())}else this.activeBanner=t,t&&this.bannerContainer.appendChild(t.getDiv());t instanceof bt||(t.height=this.activeBannerHeight),this.events.emit("bannerchange")},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.activeBanner?this.activeBanner.height:0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"activeBannerHeight",{get:function(){return this._activeBannerHeight},set:function(t){this._activeBannerHeight=t,this.activeBanner&&!(this.activeBanner instanceof bt)&&(this.activeBanner.height=t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"layoutHeight",{get:function(){return G.inPixels(this.height)},enumerable:!1,configurable:!0}),i.prototype.refreshLayout=function(){},i}(),Zc=xl,un=function(){function i(t,e,n){this._options={},this.imagePath="",this.hostDevice=e,this.container=t,this.predictionContext=n,this.setOptions(i.DEFAULT_OPTIONS)}return i.prototype.getOptions=function(){var t={};for(var e in this._options)t[e]=this._options[e];return t},i.prototype.setOptions=function(t){for(var e in t){switch(e){case"alwaysShow":this.alwaysShow=t[e];break;case"imagePath":this.imagePath=t[e];break;default:}this._options[e]=t[e],this.container.banner||this.selectBanner("inactive")}},i.prototype.setBanner=function(t){var e=this,n,c=this.container.banner;switch(c instanceof me&&this.predictionContext.off("update",c.onSuggestionUpdate),t){case"blank":n=new bt;break;case"image":n=new pc(this.imagePath,this.container.activeBannerHeight);break;case"suggestion":var l=n=new me(this.hostDevice,this.container.activeBannerHeight);l.predictionContext=this.predictionContext,l.events.on("apply",function(r){return e.predictionContext.accept(r.suggestion)}),this.predictionContext.on("update",l.onSuggestionUpdate);break;default:throw new Error("Invalid type specified for the banner!")}this._activeType=t,n&&(this.container.banner=n)},i.prototype.selectBanner=function(t){t=="active"||t=="configured"?this.setBanner("suggestion"):t=="inactive"&&(this.alwaysShow?this.setBanner("image"):this.setBanner("blank"))},Object.defineProperty(i.prototype,"activeType",{get:function(){return this._activeType},enumerable:!1,configurable:!0}),i.DEFAULT_OPTIONS={alwaysShow:!1,imagePath:""},i}();var Vl=function(){function i(){var t=this.element=document.createElement("div");t.style.userSelect="none",t.className="kmw-osk-none"}return i.prototype.postInsert=function(){},i.prototype.updateState=function(){},i.prototype.refreshLayout=function(){},Object.defineProperty(i.prototype,"layoutHeight",{get:function(){return G.inPixels(0)},enumerable:!1,configurable:!0}),i}(),ht=Vl;var Gl=function(){function i(t){this.kbd=t;var e=this.element=document.createElement("div");e.style.userSelect="none",e.className="kmw-osk-static",e.id=i.ID,e.innerHTML=t.helpText}return i.prototype.postInsert=function(){if(!this.element.parentElement||!document.getElementById(i.ID))throw new Error("The HelpPage root element has not yet been inserted into the DOM.");this.kbd.hasScript&&this.kbd.embedScript(this.element.parentElement)},i.prototype.updateState=function(){},i.prototype.refreshLayout=function(){},Object.defineProperty(i.prototype,"layoutHeight",{get:function(){return G.inPercent(100)},enumerable:!1,configurable:!0}),i.ID="kmw-osk-help-page",i}(),Lc=Gl;var Nc=v(A(),1);function Se(i){var t;return typeof i=="string"?t=i:(t=i.style.fontSize,t||(t=getComputedStyle(i).fontSize)),new G(t)}function Jc(i,t,e){if(i.touchable){var n=i.formFactor=="phone"?1.6*(e?.65:.6)*1.2:2;return G.special(n,"em")}else return t?G.inPixels(t/8):void 0}var Xl={"*Shift*":8,"*Enter*":5,"*Tab*":6,"*BkSp*":4,"*Menu*":11,"*Hide*":10,"*Alt*":25,"*Ctrl*":1,"*Caps*":3,"*ABC*":16,"*abc*":17,"*123*":19,"*Symbol*":21,"*Currency*":20,"*Shifted*":9,"*AltGr*":2,"*TabLeft*":7,"*LAlt*":86,"*RAlt*":87,"*LCtrl*":88,"*RCtrl*":89,"*LAltCtrl*":96,"*RAltCtrl*":97,"*LAltCtrlShift*":98,"*RAltCtrlShift*":99,"*AltShift*":100,"*CtrlShift*":101,"*AltCtrlShift*":102,"*LAltShift*":103,"*RAltShift*":104,"*LCtrlShift*":105,"*RCtrlShift*":112,"*LTREnter*":5,"*LTRBkSp*":4,"*RTLEnter*":113,"*RTLBkSp*":114,"*ShiftLock*":115,"*ShiftedLock*":116,"*ZWNJ*":117,"*ZWNJiOS*":117,"*ZWNJAndroid*":118},Ut=Xl;var pl=["default","shift","shift-on","special","special-on","","","","deadkey","blank","hidden"],Le=pl;var vc=function(){function i(t,e,n,c,l,r){this.id=t,this.text=e,this.width=n||50,this.sp=c,this.nextlayer=l,this.pad=r}return i}();var ml=function(){function i(t,e){this.spec=t,this.layer=e}return i.prototype.setButtonClass=function(){var t,e=this.spec,n=this.btn,c=0;typeof e.dk=="string"&&e.dk=="1"&&(c=8),c=(t=e.sp)!==null&&t!==void 0?t:c,(c<0||c>10)&&(c=0),n.className="kmw-key kmw-key-"+Le[c]},i.prototype.setToggleState=function(t){var e;switch(e=this.spec.sp,Le[e]){case"shift":case"shift-on":t===void 0&&(t=Le[e]=="shift"),this.spec.sp=1+(t?1:0);break;case"special":case"special-on":t===void 0&&(t=Le[e]=="special"),this.spec.sp=3+(t?1:0);break;default:return}this.setButtonClass()},i.prototype.isFrameKey=function(){var t=this.spec.sp||0;switch(Le[t]){case"default":case"deadkey":return!1;default:return!0}},i.prototype.allowsKeyTip=function(){return this.isFrameKey()?!1:!this.btn.classList.contains("kmw-spacebar")},i.prototype.highlight=function(t){var e=this.btn.classList;t?e.contains(i.HIGHLIGHT_CLASS)||e.add(i.HIGHLIGHT_CLASS):e.remove(i.HIGHLIGHT_CLASS)},i.getTextMetrics=function(t,e,n){n={fontFamily:n.fontFamily,fontSize:n.fontSize},n.fontFamily||(n.fontFamily=getComputedStyle(document.body).fontFamily),(!n.fontSize||n.fontSize=="")&&(n.fontSize="1em");var c=n.fontFamily,l=Se(n.fontSize),r;l.absolute?r=l.val+"px":r=l.val*e+"px";var s=i.getTextMetrics.canvas||(i.getTextMetrics.canvas=document.createElement("canvas")),B=s.getContext("2d");B.font=r+" "+c;var o=B.measureText(t);return o},i.prototype.getIdealFontSize=function(t,e,n,c){var l=getComputedStyle(this.btn),r=parseFloat(l.width),s=1,B=Se(n.fontSize||"1em");l.fontSize?c||(n=l):(s=t.getKeyEmFontSize(),r=this.getKeyWidth(t));var o=Se(n.fontSize||"1em"),g=i.getTextMetrics(e,s,n),a=.9,F=.9,y=2,u=2,Q,C;g.fontBoundingBoxAscent&&(Q=g.fontBoundingBoxAscent+g.fontBoundingBoxDescent);var h=Q?Q+u:0;n.height&&n.height.indexOf("px")!=-1&&(C=Number.parseFloat(n.height.substring(0,n.height.indexOf("px"))));var b=r*a/(g.width+y),U=h&&C?C*F/h:void 0,V=b;return U&&U<b&&(V=U),V<1?B.absolute?V*o.val+"px":V*B.val+"em":B.absolute?o.val+"px":B.val+"em"},i.prototype.getKeyWidth=function(t){var e=this.spec;return e.proportionalWidth*t.width},i.prototype.renameSpecialKey=function(t,e){switch(t){case"*ZWNJ*":t=e.device.OS==x.OperatingSystem.Android?"*ZWNJAndroid*":"*ZWNJiOS*";break;case"*Enter*":t=e.isRTL?"*RTLEnter*":"*LTREnter*";break;case"*BkSp*":t=e.isRTL?"*RTLBkSp*":"*LTRBkSp*";break;default:}var n=57344+Ut[t];return Ut[t]?String.fromCharCode(n):t},Object.defineProperty(i.prototype,"keyText",{get:function(){var t=this.spec,e="\xA0",n=null;return t.text==null||t.text==""?(typeof t.id=="string"&&(n=M.unicodeIDToText(t.id)),n=n||e):(n=t.text,n=="*Tab*"&&this.layer=="shift"&&(n="*TabLeft*")),n},enumerable:!1,configurable:!0}),i.prototype.generateKeyText=function(t){var e=this.spec,n=document.createElement("span"),c=n.style;n.className="kmw-key-text";var l=this.keyText,r=this.renameSpecialKey(l,t);r!=l&&(l=r,e.font="SpecialOSK"),typeof e.font=="string"&&e.font!=""&&(c.fontFamily=e.font),typeof e.fontsize=="string"&&e.fontsize!=""&&(c.fontSize=e.fontsize);var s={fontSize:c.fontSize};c.fontFamily?s.fontFamily=c.fontFamily:s.fontFamily=t.fontFamily;var B=t.getKeyEmFontSize(),o=i.getTextMetrics(l,B,s).width;return o==0&&l!=""&&l!="\xA0"&&t.isRTL&&(l="\u200F"+l),c.fontSize=this.getIdealFontSize(t,l,s),n.innerText=l,n},i.prototype.isUnderTouch=function(t){var e=t.x,n=t.y,c=this.btn,l=J(c),r=Z(c),s=l+c.offsetWidth,B=r+c.offsetHeight;return e>l&&e<s&&n>r&&n<B},i.prototype.refreshLayout=function(t){if(this.label)if(!this.label.classList.contains("kmw-spacebar-caption"))this.label.style.fontSize=this.getIdealFontSize(t,this.keyText,this.btn.style);else{this.label.style.fontSize="";var e=this.getIdealFontSize(t,this.label.textContent,getComputedStyle(this.label),!0);this.label.style.setProperty("font-size",e,"important")}},i.specialCharacters=Ut,i.BUTTON_CLASSES=Le,i.HIGHLIGHT_CLASS="kmw-key-touched",i}(),Ie=ml;var xt=function(){function i(t,e){this.key=t,this.keyId=e}return i}();function Vt(i,t){var e=i;for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e}function Zl(i){return i&&"key"in i&&i.key instanceof Ie}function Gt(i){return Zl(i)?i:null}var Ll=function(i){(0,d.__extends)(t,i);function t(e,n,c){var l=i.call(this,e,n)||this;return l.row=c,l}return t.prototype.getId=function(){return this.spec.elementID},t.prototype.getCoreId=function(){return this.spec.coreID},t.prototype.getBaseId=function(){return this.spec.baseKeyID},t.prototype.generateKeyCapLabel=function(){var e=I.keyCodes[this.spec.baseKeyID];switch(e){case 186:e=59;break;case 187:e=61;break;case 188:e=44;break;case 189:e=45;break;case 190:e=46;break;case 191:e=47;break;case 192:e=96;break;case 219:e=91;break;case 220:e=92;break;case 221:e=93;break;case 222:e=39;break;default:(e<48||e>90)&&(e=0)}var n=document.createElement("div");return n.className="kmw-key-label",e>0&&(n.innerText=String.fromCharCode(e)),n},t.prototype.processSubkeys=function(e,n){var c,l=e.subKeys=this.spec.sk;for(c=0;c<l.length;c++){if(l[c].sp==1||l[c].sp==2){var r=l[c].text;l[c].text=this.renameSpecialKey(r,n)}l[c].layer||(l[c].layer=e.key.layer)}var s=document.createElement("div");s.className="kmw-key-popup-icon",e.appendChild(s)},t.prototype.construct=function(e){var n=this.spec,c=document.createElement("div");c.className="kmw-key-square";var l=document.createElement("div"),r=this.btn=Vt(l,new xt(this,n.id));this.setButtonClass();var s=this.capLabel=this.generateKeyCapLabel();return r.appendChild(s),r.id=this.getId(),r.appendChild(this.label=this.generateKeyText(e)),typeof n.sk!="undefined"&&n.sk!=null?this.processSubkeys(r,e):r.subKeys=null,c.appendChild(r),this.square=c},t.prototype.refreshLayout=function(e){var n=this.spec;this.square.style.width=e.layoutWidth.scaledBy(n.proportionalWidth).styleString,this.square.style.marginLeft=e.layoutWidth.scaledBy(n.proportionalPad).styleString,this.btn.style.width=e.usesFixedWidthScaling?this.square.style.width:"100%",e.usesFixedHeightScaling?this.square.style.height=e.internalHeight.scaledBy(this.row.heightFraction).styleString:this.square.style.height="100%",i.prototype.refreshLayout.call(this,e);var c=e.device,l=c.OS==x.OperatingSystem.iOS&&c.formFactor==x.FormFactor.Phone&&D();l&&this.capLabel&&(this.capLabel.style.fontSize="6px")},Object.defineProperty(t.prototype,"displaysKeyCap",{get:function(){return this.capLabel&&this.capLabel.style.display=="block"},set:function(e){if(!this.capLabel)throw new Error("Key element not yet constructed; cannot display key cap");this.capLabel.style.display=e?"block":"none"},enumerable:!1,configurable:!0}),t}(Ie),Rc=Ll;var Jl=function(){function i(t,e,n){var c=this.element=document.createElement("div");c.className="kmw-key-row",this.heightFraction=1/e.row.length;var l=n.key;this.keys=[];for(var r=0;r<l.length;r++){var s=l[r],B=new Rc(s,e.id,this),o=B.construct(t);this.keys.push(B),c.appendChild(o)}}return Object.defineProperty(i.prototype,"displaysKeyCaps",{get:function(){if(this.keys.length>0)return this.keys[0].displaysKeyCap},set:function(t){for(var e=0,n=this.keys;e<n.length;e++){var c=n[e];c.displaysKeyCap=t}},enumerable:!1,configurable:!0}),i.prototype.refreshLayout=function(t){var e=this.element.style,n=t.internalHeight.scaledBy(this.heightFraction);e.maxHeight=e.lineHeight=e.height=n.styleString;for(var c=.15,l=t.usesFixedHeightScaling?n:G.forScalar(1),r=l.scaledBy(c/2),s=l.scaledBy(1-c),B=0,o=this.keys;B<o.length;B++){var g=o[B],a=g.btn.parentElement,F=g.btn,y=a.style;y.height=y.minHeight=l.styleString;var u=F.style;u.top=r.styleString,u.height=u.lineHeight=u.minHeight=s.styleString,F.key&&F.key.refreshLayout(t)}},i}(),Ac=Jl;var vl=function(){function i(t,e,n){this.spec=n;var c=this.element=document.createElement("div"),l=c.style;c.className="kmw-key-layer";var r=n.row.length;r>4&&t.device.formFactor=="phone"&&(c.className=c.className+" kmw-5rows"),l.fontFamily="font"in e?e.font:"",this.nextlayer=c.layer=n.id,typeof n.nextlayer=="string"&&(c.nextLayer=this.nextlayer=n.nextlayer);var s=n.row;this.rows=[];for(var B=0;B<s.length;B++){var o=new Ac(t,n,s[B]);o.displaysKeyCaps=e.displayUnderlying,c.appendChild(o.element),this.rows.push(o)}t.device.touchable&&(this.globeKey=this.findKey("K_LOPT"),this.hideKey=this.findKey("K_ROPT")),this.spaceBarKey=this.findKey("K_SPACE"),this.capsKey=this.findKey("K_CAPS"),this.numKey=this.findKey("K_NUMLOCK"),this.scrollKey=this.findKey("K_SCROLL")}return Object.defineProperty(i.prototype,"rowHeight",{get:function(){return this._rowHeight},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this.spec.id},enumerable:!1,configurable:!0}),i.prototype.findKey=function(t){for(var e=0,n=this.rows;e<n.length;e++)for(var c=n[e],l=0,r=c.keys;l<r.length;l++){var s=r[l];if(s.getBaseId()==t)return s}return null},i.prototype.refreshLayout=function(t,e){var n=this.rows.length,c=this._rowHeight=Math.floor(e/(n==0?1:n));t.usesFixedHeightScaling&&(this.element.style.height=e+"px");for(var l=0;l<n;l++){var r=this.rows[l],s=(n-l-1)*c+1;t.usesFixedHeightScaling&&(this.spec.row[l].proportionalY=(e-s-c/2)/e,l==n-1&&(r.element.style.bottom="1px")),r.refreshLayout(t)}},i}(),fc=vl;var Rl=function(){function i(t,e,n){this.layers={};var c=e.layout(n),l=this.element=document.createElement("div"),r=l.style;if(l.className="kmw-key-layer-group",c!=null){var s=c.fontsize;typeof s=="undefined"||s==null||s==""?r.fontSize="1em":r.fontSize=c.fontsize,r.width="100%",r.height="100%";var B,o,g,a;a=c.layer;var F=t.getDefaultKeyObject();for(F.fontsize=r.fontSize,B=0;B<a.length;B++){var y=a[B],u=new fc(t,c,y);this.layers[y.id]=u,u.element.style.display=B==0?"block":"none",l.appendChild(u.element)}}}return i}(),Sc=Rl;var te;(function(i){i[i.Waiting=0]="Waiting",i[i.Realized=1]="Realized",i[i.Cancelled=2]="Cancelled"})(te||(te={}));var Al=function(){function i(t,e,n){var c,l,r;this._touches=1,this._state=te.Waiting,this.cancelDelayFactor=125,this.vkbd=t,this.count=n,this.baseKey=e,this._destinationLayerId="caps";var s=(l=(c=e==null?void 0:e.key)===null||c===void 0?void 0:c.spec)===null||l===void 0?void 0:l.multitap;(s==null?void 0:s.length)&&((r=s[0])===null||r===void 0?void 0:r.nextlayer)&&(this._destinationLayerId=s[0].nextlayer);var B=this;this._timeout=new Promise(function(o){B.timerId=window.setTimeout(function(){B.cancel(),o()},B.cancelDelayFactor*B.count)})}return Object.defineProperty(i.prototype,"timeout",{get:function(){return this._timeout},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"realized",{get:function(){return this._state==te.Realized},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cancelled",{get:function(){return this._state==te.Cancelled},enumerable:!1,configurable:!0}),i.isValidTarget=function(t,e){return e.keyId.indexOf("K_SHIFT")>=0&&t.layerGroup.layers.caps&&!e.subKeys&&t.touchCount==1},i.prototype.cleanup=function(){this.timerId&&window.clearTimeout(this.timerId),this.timerId=null},i.prototype.cancel=function(){this._state=te.Cancelled,this.cleanup()},i.prototype.incrementTouch=function(t){var e;return this._state==te.Waiting&&(!((e=t==null?void 0:t.keyId)===null||e===void 0)&&e.includes("K_SHIFT")?++this._touches==this.count&&this.realize():this.cancel()),this._state},i.prototype.realize=function(){if(this._state==te.Waiting){this._state=te.Realized,this.cleanup();var t=$.constructNullKeyEvent(this.vkbd.device);t.kNextLayer=this._destinationLayerId,t.Lstates=I.stateBitmasks.CAPS,t.LmodifierChange=!0,this.vkbd.raiseKeyEvent(t,null)}},i}(),In=Al;var fl=function(i){(0,d.__extends)(t,i);function t(e,n){if(typeof n!="string"||n=="")throw"The 'layer' parameter for subkey construction must be properly defined.";return i.call(this,e,n)||this}return t.prototype.getId=function(){return"popup-"+this.layer+"-"+this.spec.id},t.prototype.construct=function(e,n,c){var l=this.spec,r=document.createElement("div"),s=e.getDefaultKeyObject(),B=r.style;for(var o in s)typeof l[o]!="string"&&(l[o]=s[o]);r.className="kmw-key-square-ex",c&&(B.marginTop="5px"),typeof l.width!="undefined"?B.width=l.width*n.offsetWidth/100+"px":B.width=n.offsetWidth+"px",B.height=n.offsetHeight+"px";var g=document.createElement("div"),a=this.btn=Vt(g,new xt(this,l.id));this.setButtonClass(),a.id=this.getId();var F=a.style;return F.height=B.height,F.lineHeight=n.style.lineHeight,F.width=B.width,F.position="absolute",a.appendChild(this.label=this.generateKeyText(e)),r.appendChild(a),this.square=r},t.prototype.allowsKeyTip=function(){return!1},t}(Ie),Hc=fl;var Sl=function(){function i(t,e){var n=this;this.promise=new Promise(function(h){n.resolver=h}),this.vkbd=t,this.baseKey=e,this.currentSelection=e,e.key.highlight(!0);var c=e.subKeys,l=this.element=document.createElement("div"),r;l.id="kmw-popup-keys";var s=l.style;s.fontFamily=t.fontFamily;var B=getComputedStyle(e);s.fontSize=B.fontSize,s.visibility="hidden";var o=c.length,g,a;for(g=Math.min(Math.ceil(o/9),2),a=Math.ceil(o/g),s.width=a*e.offsetWidth+a*5+"px",r=0;r<o;r++){var F=!1,y=Math.floor(r/a);g>1&&y>0&&(F=!0);var u=e.key.layer;(typeof u!="string"||u=="")&&(u=t.layerId);var Q=new Hc(c[r],u),C=Q.construct(t,e,F);l.appendChild(C)}this.shim=document.createElement("div"),this.shim.id="kmw-popup-shim",t.device.formFactor==x.FormFactor.Phone&&this.selectDefaultSubkey(t,e,l)}return i.prototype.finalize=function(t){if(this.resolver){var e=null;this.currentSelection&&(e=this.vkbd.initKeyEvent(this.currentSelection,t),this.currentSelection.key.highlight(!1)),this.resolver(e)}this.resolver=null},i.prototype.reposition=function(t){var e=this.element,n=this.baseKey,c=t.topContainer,l=n.key.row.element,r=e.style,s=n.offsetLeft+n.offsetParent.offsetLeft+.5*(n.offsetWidth-e.offsetWidth),B=t.width-e.offsetWidth;s>B&&(s=B),s<0&&(s=0),r.left=s+"px";var o=c.getBoundingClientRect(),g=l.getBoundingClientRect();r.top=g.top-o.top-e.offsetHeight-3+"px",r.visibility="visible";var a=t.isEmbedded,F=getComputedStyle(e),y=parseFloat(F.top),u=0,Q=0;y<u&&a&&(Q=u-y,r.top=u+"px"),t.device.formFactor==x.FormFactor.Phone&&t.device.OS==x.OperatingSystem.iOS&&(this.callout=this.addCallout(n,Q))},i.prototype.addCallout=function(t,e){var n=this.vkbd.topContainer;e=e||0;var c=t.offsetHeight-e+6;if(c>0){var l=document.createElement("div"),r=l.style;l.id="kmw-popup-callout",n.appendChild(l);var s=t.getBoundingClientRect(),B=n.getBoundingClientRect(),o=Math.floor(s.top-B.top-9+e);return r.top=o+"px",r.left=s.left-B.left+"px",r.width=s.width+"px",r.height=s.bottom-B.top-o-1+"px",l}else return null},i.prototype.selectDefaultSubkey=function(t,e,n){for(var c,l=e.subKeys,r=0;r<l.length;r++){var s=l[r],B=n.childNodes[r].firstChild;if(!(!e.key||!e.key.spec)&&s.elementID==e.key.spec.elementID){c=B;break}}c&&(t.keyPending=c,c.key.highlight(!0))},i.prototype.isVisible=function(){return this.element.style.visibility=="visible"},i.prototype.clear=function(){this.resolver=null,this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.shim.parentNode&&this.shim.parentNode.removeChild(this.shim),this.callout&&this.callout.parentNode&&this.callout.parentNode.removeChild(this.callout)},i.prototype.updateTouch=function(t){this.currentSelection=null,this.baseKey.key.highlight(!1);for(var e=0;e<this.baseKey.subKeys.length;e++)try{var n=this.element.childNodes[e].firstChild,c=n.key.isUnderTouch(t);c&&(this.currentSelection=n),n.key.highlight(c)}catch(l){l.message?console.error("Unexpected error when attempting to update selected subkey:"+l.message):console.error("Unexpected error (and error type) when attempting to update selected subkey.")}!this.currentSelection&&this.baseKey.key.isUnderTouch(t)&&(this.baseKey.key.highlight(!0),this.currentSelection=this.baseKey)},i}(),je=Sl;var Hl=function(){function i(t,e){this.popupDelay=500,this.vkbd=t,this.baseKey=e;var n=this;this.promise=new Promise(function(c,l){n.resolver=c,n.timerId=window.setTimeout(n.resolve.bind(n),n.popupDelay)})}return i.prototype.cancel=function(){this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.resolver&&(this.resolver(null),this.resolver=null)},i.prototype.resolve=function(){this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.resolver&&this.resolver(new je(this.vkbd,this.baseKey))},i}(),Qn=Hl;var Wl=function(){function i(t){this.state=!1;var e=this.element=document.createElement("div");e.className="kmw-keytip",e.id="kmw-keytip",e.style.pointerEvents="none",e.style.display="none",e.appendChild(this.tip=document.createElement("div")),e.appendChild(this.cap=document.createElement("div")),this.tip.appendChild(this.label=document.createElement("span")),this.tip.className="kmw-keytip-tip",this.cap.className="kmw-keytip-cap",this.label.className="kmw-keytip-label",this.constrain=t}return i.prototype.show=function(t,e,n){if(e&&t.offsetParent){var c=t.key.row.element,l=t.getClientRects()[0],r=c.getClientRects()[0],s=l.left-r.left,B=l.width,o=l.height,g=t.key.label,a=1.8,F=this.element.style,y=n.topContainer,u=y.getBoundingClientRect(),Q=t.getBoundingClientRect(),C=Q.bottom-u.top+1,h=C-Math.floor(C),b=B+Math.ceil(B*.3)*2,U=Math.ceil(2.3*o)+h;F.top="auto",F.bottom=Math.floor(u.height-C)+"px",F.textAlign="center",F.overflow="visible",F.width=b+"px",F.height=U+"px";var V=getComputedStyle(n.element);F.fontFamily=V.fontFamily;var X=parseInt(V.fontSize,10);if(X==Number.NaN&&(X=0),X!=0){var L=a*X,P={fontFamily:F.fontFamily,fontSize:L+"px",height:1.6*o+"px"};F.fontSize=t.key.getIdealFontSize(n,t.key.keyText,P,!0)}this.label.textContent=g.textContent;var p=(b-B)/2;s<p?(this.cap.style.left="1px",s+=p-1):s>window.innerWidth-B-p?(this.cap.style.left=b-B-1+"px",s-=p-1):this.cap.style.left=p+"px",F.left=s-p+"px";var E=getComputedStyle(this.element),oe=u.height,S=parseFloat(E.bottom),he=parseFloat(E.height),k=Math.ceil(U/2);if(this.cap.style.width=B+"px",this.tip.style.height=k+"px",this.cap.style.top=k-3+"px",this.cap.style.height=Q.bottom-u.top-Math.floor(C-U)-k+"px",this.constrain&&he+S>oe){var j=he+S-oe;F.height=U-j+"px";var ae=Math.max(0,U-j-U/2+2);this.cap.style.height=ae+"px"}F.display="block"}else this.element.style.display="none";this.key=t,this.state=e},i}(),Wc=Wl;function He(){try{if(this.device.formFactor=="desktop")return 1;var i=document.documentElement.clientWidth;if(screen.width>i)return 1;var t=screen.width;return D()?screen.width<screen.height&&(t=screen.height):screen.width>screen.height&&(t=screen.height),Math.round(100*t/i)/100}catch(e){return 1}}var Nl=function(i){(0,d.__extends)(t,i);function t(e){var n=this,c,l;n=i.call(this)||this,n._layerId="default",n.layerIndex=0,n.isStatic=!1,n._fixedWidthScaling=!1,n._fixedHeightScaling=!0,n.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1},n.repeatDelete=function(){this.deleting&&(this.modelKeyClick(this.deleteKey),this.deleting=window.setTimeout(this.repeatDelete,100))}.bind(n),n.config=e,n.config.device=e.device||e.hostDevice,n.config.isEmbedded=e.isEmbedded||!1,e.isStatic&&(n.isStatic=e.isStatic),n._fixedWidthScaling=n.device.touchable&&!n.isStatic,n._fixedHeightScaling=n.device.touchable&&!n.isStatic;var r=document.createElement("div");n.config.styleSheetManager=e.styleSheetManager||new Fe(r);var s;if(e.keyboard)s=n.kbdLayout=e.keyboard.layout(e.device.formFactor),n.layoutKeyboardProperties=e.keyboardMetadata,n.isRTL=e.keyboard.isRTL;else{var B=ee.buildDefaultLayout(null,null,e.device.formFactor);s=n.kbdLayout=st.polyfill(B,null,e.device.formFactor),n.layoutKeyboardProperties=null,n.isRTL=!1}"font"in s?n.fontFamily=s.font:n.fontFamily="";var o=e.device.formFactor;n.layoutKeyboard=e.keyboard,n.layoutKeyboard||(n.layoutKeyboard=new w(null)),n.layerGroup=new Sc(n,n.layoutKeyboard,o),n.layoutKeyboard.markLayoutCalibrated(o),r.appendChild(n.layerGroup.element),n.kbdDiv=r,n.isStatic||(n.hostDevice.touchable?n.inputEngine=n.touchInputConfiguration:n.inputEngine=n.mouseInputConfiguration,n.inputEngine.registerEventHandlers()),r.classList.add(e.device.formFactor,"kmw-osk-inner-frame");var g=(l=(c=n.layoutKeyboard)===null||c===void 0?void 0:c.id.replace("Keyboard_",""))!==null&&l!==void 0?l:"",a=g.indexOf("::");a!=-1&&(g=g.substring(a+2));var F="kmw-keyboard-"+g;return n.element.classList.add(F),n}return Object.defineProperty(t.prototype,"layerId",{get:function(){return this._layerId},set:function(e){var n=e!=this._layerId;if(this.layerGroup.layers[e])this._layerId=e;else throw new Error("Keyboard ".concat(this.layoutKeyboard.id," does not have a layer with id ").concat(e));n&&(this.updateState(),this.refreshLayout())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentLayer",{get:function(){var e;return this.layerId?(e=this.layerGroup)===null||e===void 0?void 0:e.layers[this.layerId]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lgKey",{get:function(){var e,n;return(n=(e=this.currentLayer)===null||e===void 0?void 0:e.globeKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hkKey",{get:function(){var e,n;return(n=(e=this.currentLayer)===null||e===void 0?void 0:e.hideKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"spaceBar",{get:function(){var e,n;return(n=(e=this.currentLayer)===null||e===void 0?void 0:e.spaceBarKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mouseInputConfiguration",{get:function(){var e={targetRoot:this.element,eventRoot:document.body,inputStartHandler:this.touch.bind(this),inputMoveHandler:this.moveOver.bind(this),inputMoveCancelHandler:this.moveCancel.bind(this),inputEndHandler:this.release.bind(this),coordConstrainedWithinInteractiveBounds:this.detectWithinInteractiveBounds.bind(this)};return new Qt(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"touchInputConfiguration",{get:function(){var e={targetRoot:this.element,eventRoot:this.element,inputStartHandler:this.touch.bind(this),inputMoveHandler:this.moveOver.bind(this),inputMoveCancelHandler:this.moveCancel.bind(this),inputEndHandler:this.release.bind(this),coordConstrainedWithinInteractiveBounds:this.detectWithinInteractiveBounds.bind(this)};return new Ct(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this.kbdDiv},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"device",{get:function(){return this.config.device},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hostDevice",{get:function(){return this.config.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontRootPath",{get:function(){return this.config.pathConfig.fonts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"styleSheetManager",{get:function(){return this.config.styleSheetManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"topContainer",{get:function(){return this.config.topContainer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmbedded",{get:function(){return this.config.isEmbedded},enumerable:!1,configurable:!0}),t.prototype.postInsert=function(){},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutWidth",{get:function(){if(this.usesFixedWidthScaling){var e=this.width,n=getComputedStyle(this.element);if(n.border){var c=new G(n.borderWidth).val;e-=c*2}return G.inPixels(e)}else return G.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutHeight",{get:function(){if(this.usesFixedHeightScaling){var e=this.height,n=getComputedStyle(this.element);if(n.border){var c=new G(n.borderWidth).val;e-=c*2}return G.inPixels(e)}else return G.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"internalHeight",{get:function(){return this.usesFixedHeightScaling?G.inPixels(this.layoutHeight.val-this.getVerticalLayerGroupPadding()):G.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize||(this._fontSize=new G("1em")),this._fontSize},set:function(e){this._fontSize=e,this.kbdDiv.style.fontSize=e.styleString},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usesFixedWidthScaling",{get:function(){return this._fixedWidthScaling},set:function(e){this._fixedWidthScaling=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usesFixedHeightScaling",{get:function(){return this._fixedHeightScaling},set:function(e){this._fixedHeightScaling=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"usesFixedPositioning",{get:function(){for(var e=this.element;e;){if(getComputedStyle(e).position=="fixed")return!0;e=e.offsetParent}return!1},enumerable:!1,configurable:!0}),t.prototype.setSize=function(e,n,c){this._width=e,this._height=n,this.kbdDiv&&(this.kbdDiv.style.width=e?this._width+"px":"",this.kbdDiv.style.height=n?this._height+"px":"",!this.device.touchable&&n&&(this.fontSize=new G(this._height/8+"px")),c||this.refreshLayout())},t.prototype.getDefaultKeyObject=function(){return new vc(void 0,"",M.DEFAULT_KEY.width,M.DEFAULT_KEY.sp,null,M.DEFAULT_KEY.pad)},t.prototype.getTouchCoordinatesOnKeyboard=function(e){var n={x:J(this.kbdDiv),y:Z(this.kbdDiv)},c={x:e.x-n.x,y:e.y-n.y};return c.x/=this.layerGroup.element.offsetWidth,c.y/=this.kbdDiv.offsetHeight,c},t.prototype.getTouchProbabilities=function(e,n){var c=this.getTouchCoordinatesOnKeyboard(e),l=this.layerGroup.element,r=l.offsetWidth,s=this.kbdDiv.offsetHeight;if(!r||!s)return null;var B=l.offsetWidth/this.kbdDiv.offsetHeight,o=this.kbdLayout.getLayer(this.layerId).getTouchProbabilities(c,B);if(!n||!this.subkeyGesture||!this.subkeyGesture.baseKey.key)return o;var g=1,a=1,F=this.subkeyGesture.baseKey.key.spec.coreID,y=0,u=null;y=3,u=n.coreID,u==F?(a+=y,y=0):u="".concat(F,"::").concat(u);for(var Q=g+a+y,C=1/Q,h=0;h<o.length;h++){var b=o[h];b.keyId==F?(a+=b.p*C,o.splice(h,1),h--):b.keyId==u?(y=+b.p*C,o.splice(h,1),h--):b.p*=C}var U=[];return y>0&&U.push({keyId:u,p:y*C}),U.push({keyId:F,p:a*C}),U=U.concat(o),U},t.prototype.getInteractiveBoundingRect=function(){var e=J(this.element),n=Z(this.element),c=this.currentLayer.rows.length,l=.333*this.height/c,r={left:e-l,right:e+this.width+l,top:n-l,bottom:n+this.height+l};return r},t.prototype.applyScreenMarginBoundsThresholding=function(e,n){var c=window.screenLeft-window.pageXOffset,l=window.screenTop-window.pageYOffset,r=(0,d.__assign)({},e),s=new K(n.x+c,n.y+l);return s.x>=5&&e.left+c<=2&&(r.left=2-c),s.x<=screen.width-5&&e.right+c>=screen.width-2&&(r.right=screen.width-2-c),s.y>=5&&e.top+l<=2&&(r.top=2-l),s.y<=screen.height-5&&e.bottom+l>=screen.height-2&&(r.bottom=screen.height-2-l),r},t.prototype.detectWithinInteractiveBounds=function(e){if(e.x===null&&e.y===null)return!0;var n=this.getInteractiveBoundingRect(),c=n;return this.initTouchCoord&&this.applyScreenMarginBoundsThresholding(n,this.initTouchCoord),e.x<c.left||e.x>c.right?!1:!(e.y<c.top||e.y>c.bottom)},t.prototype.touch=function(e){var n=e.target,c=this.keyTarget(n);if(this.initTouchCoord=e,this.currentTarget=c,this.cancelDelete(),!(this.subkeyGesture&&this.subkeyGesture.isVisible())&&(this.touchCount=e.activeInputCount,(c&&(c.className.indexOf("key-hidden")>=0||c.className.indexOf("key-blank")>=0)||n.className.indexOf("kmw-key-row")>=0)&&(e.isFromMouse||(c=this.findNearestKey(e,n))),c!=null)){var l=c.keyId;if(this.highlightKey(c,!0),l=="K_LOPT"||l=="K_ROPT")window.setTimeout(function(){this.modelKeyClick(c),this.highlightKey(c,!0)}.bind(this),0),this.keyPending=null,this.touchPending=null;else if(l=="K_BKSP")this.modelKeyClick(c,e),this.deleteKey=c,this.deleting=window.setTimeout(this.repeatDelete,500),this.keyPending=null,this.touchPending=null;else{if(this.keyPending){if(this.highlightKey(this.keyPending,!1),this.subkeyGesture&&this.subkeyGesture instanceof je){var r=this.subkeyGesture;r.updateTouch(e),r.finalize(e)}else this.modelKeyClick(this.keyPending,this.touchPending);this.touchCount--}else this.initGestures(c,e);this.keyPending=c,this.touchPending=e}}},t.prototype.release=function(e){var n=this.currentTarget;if(this.cancelDelete(),this.pendingMultiTap&&this.pendingMultiTap.realized){this.pendingMultiTap=null,this.highlightKey(this.keyPending,!1),this.keyPending=null,this.touchPending=null;return}if(this.pendingMultiTap&&this.pendingMultiTap.cancelled&&(this.pendingMultiTap=null),this.subkeyGesture&&this.subkeyGesture.isVisible()){if(e.activeInputCount>0)return;if(this.subkeyGesture instanceof je){var c=this.subkeyGesture;c.finalize(e)}this.highlightKey(this.keyPending,!1),this.keyPending=null,this.touchPending=null;return}if(n&&n.id&&this.optionKey(n,n.id,!1),!this.detectWithinInteractiveBounds(e)){this.moveCancel(e),this.touchCount--;return}var l=this.touchCount;if(this.touchCount>0&&this.touchCount--,this.keyPending)this.highlightKey(this.keyPending,!1),this.keyPending.className.indexOf("hidden")<0&&l>0&&this.modelKeyClick(this.keyPending,e),this.clearPopup(),this.keyPending=null,this.touchPending=null;else{var r=e;if(n=this.keyTarget(r.target),!n){var s=document.elementFromPoint(e.x-window.pageXOffset,e.y-window.pageYOffset);n=this.findNearestKey(e,s)}this.highlightKey(n,!1)}},t.prototype.moveCancel=function(e){e.activeInputCount>1||this.updateGestures(null,this.keyPending,e)||(this.cancelDelete(),this.highlightKey(this.keyPending,!1),this.showKeyTip(null,!1),this.clearPopup(),this.keyPending=null,this.touchPending=null)},t.prototype.moveOver=function(e){if(this.touchCount==0){this.cancelDelete();return}var n=e.x-window.pageXOffset,c=e.y-window.pageYOffset;this.touchPending=e;var l=document.elementFromPoint(n,c),r=this.keyPending,s=this.keyTarget(l);(s&&s.className.indexOf("key-hidden")>=0||l&&!s&&l.className.indexOf("key-row")>=0)&&(s=this.findNearestKey(e,l)),s&&typeof s.id=="string"&&s.id.indexOf("-K_BKSP")<0&&this.cancelDelete(),!(e.activeInputCount>1)&&(this.updateGestures(s,r,e)||(this.currentTarget=s,s&&this.keyPending&&(this.highlightKey(r,!1),this.keyPending=s,this.touchPending=e),r&&s&&s!=r&&s.id!=""&&(this.clearPopup(),this.initGestures(s,e)),this.keyPending&&(r!=s||s.className.indexOf(Ie.HIGHLIGHT_CLASS)<0)&&this.highlightKey(s,!0)))},t.prototype.keyTarget=function(e){var n=e;try{if(n){if(n.classList.contains("kmw-key"))return Gt(n);if(n.parentNode&&n.parentNode.classList.contains("kmw-key"))return Gt(n.parentNode);if(n.firstChild&&n.firstChild.classList.contains("kmw-key"))return Gt(n.firstChild)}}catch(c){}return null},t.prototype.findNearestKey=function(e,n){if(!e)return null;for(var c=e.x;n&&n.className!==void 0&&n.className.indexOf("key-row")<0;)n=n.parentNode;if(!n)return null;var l,r=0,s,B=24,o=1e5,g,a;for(l=0;l<n.childNodes.length;l++){var F=n.childNodes[l],y=F.firstChild?F.firstChild:F;if(!(y.className!==void 0&&(y.className.indexOf("key-hidden")>=0||y.className.indexOf("key-blank")>=0))){if(g=F.offsetLeft,a=g+F.offsetWidth,c>=g&&c<=a)return y;s=g-c,s>=0&&s<o&&(r=l,o=s),s=c-a,s>=0&&s<o&&(r=l,o=s)}}return o<1e5&&(n=n.childNodes[r],g=n.offsetLeft,a=g+n.offsetWidth,n.offsetWidth>40&&(B=.6*n.offsetWidth),g-c>=0&&g-c<B||c-a>=0&&c-a<B)?n.firstChild:null},t.prototype.cancelDelete=function(){this.deleting&&window.clearTimeout(this.deleting),this.deleting=0},t.prototype.modelKeyClick=function(e,n){var c=this.initKeyEvent(e,n);this.raiseKeyEvent(c,e)},t.prototype.initKeyEvent=function(e,n){this.highlightKey(e,!1);var c=e.key?e.key.spec:null;return c?this.keyEventFromSpec(c,n):(console.error("OSK key with ID '"+e.id+"', keyID '"+e.keyId+"' missing needed specification"),null)},t.prototype.keyEventFromSpec=function(e,n){var c=this.layoutKeyboard.constructKeyEvent(e,this.device,this.stateKeys);return c.srcKeyboard=this.layoutKeyboard,n&&(c.source=n,c.keyDistribution=this.getTouchProbabilities(n,e)),c},t.prototype._UpdateVKShiftStyle=function(e){var n,c;e||(e=this.layerId);var l=this.layerGroup.layers[e];if(!!l&&!!(!((n=this.layoutKeyboard)===null||n===void 0)&&n.usesDesktopLayoutOnDevice(this.device))){var r=["K_CAPS","K_NUMLOCK","K_SCROLL"],s=[l.capsKey,l.numKey,l.scrollKey];for(c=0;c<s.length;c++)s[c]!=null&&s[c].setToggleState(this.stateKeys[r[c]])}},t.prototype.updateStateKeys=function(e){for(var n in this.stateKeys)this.stateKeys[n]=e[n];this._UpdateVKShiftStyle()},t.prototype.clearPopup=function(){this.subkeyGesture&&(this.subkeyGesture.clear(),this.subkeyGesture=null),this.pendingSubkey&&(this.pendingSubkey.cancel(),this.pendingSubkey=null)},t.prototype.showLanguage=function(){var e,n=this.layoutKeyboardProperties,c=(e=n==null?void 0:n.displayName)!==null&&e!==void 0?e:"(System keyboard)";try{var l=this.spaceBar.key.label,r=l.parentNode;typeof r.className=="undefined"||r.className==""?r.className="kmw-spacebar":r.className.indexOf("kmw-spacebar")==-1&&(r.className+=" kmw-spacebar"),l.className!="kmw-spacebar-caption"&&(l.className="kmw-spacebar-caption"),(l.innerText!=c||c=="")&&(l.innerText=c),this.spaceBar.key.refreshLayout(this)}catch(s){}},t.prototype.highlightKey=function(e,n){if(!(!e||!e.key||e.className==""||e.className.indexOf("kmw-key-row")>=0)){var c=this.keytip!=null&&e.key.allowsKeyTip();c?this.showKeyTip(e,n):(this.showKeyTip(null,!1),e.key.highlight(n))}},t.prototype.getKeyEmFontSize=function(){if(!this.fontSize)return 0;if(this.device.formFactor=="desktop"){var e=.8;return this.fontSize.scaledBy(e).val}else{var n=getComputedStyle(document.body).fontSize,c=Se(n).val,l=1;if(!this.isStatic){if(this.fontSize.absolute)return this.fontSize.val;l=this.fontSize.val}return c*l}},t.prototype.updateState=function(){if(!!this.currentLayer){var e,n=this.kbdDiv.childNodes[0].childNodes;for(this.nextLayer=this.layerId,this.currentLayer.nextlayer&&(this.nextLayer=this.currentLayer.nextlayer),e=0;e<n.length;e++){var c=n[e];c.layer==this.layerId?(c.style.display="block",this._UpdateVKShiftStyle()):c.style.display="none"}}},t.prototype.refreshLayout=function(){var e=this.device,n=1;e.OS==x.OperatingSystem.iOS&&!this.isEmbedded&&(n=n/He());var c;this.height&&(c=this.computedAdjustedOskHeight(this.height));var l=this.layerGroup.element,r=this.kbdDiv.style,s=l.style;this.usesFixedHeightScaling&&this.height&&(r.height=r.maxHeight=this.height+"px"),r.fontSize=this.fontSize.styleString,s.fontSize=G.forScalar(n).styleString;var B=this.width&&this.height,o=getComputedStyle(this.kbdDiv),g=o.height!=""&&o.height!="auto";if(this.showLanguage(),B)this._computedWidth=this.width,this._computedHeight=this.height;else if(g){if(this._computedWidth=parseInt(o.width,10),!this._computedWidth){var a=getComputedStyle(this.kbdDiv.firstElementChild);this._computedWidth=parseInt(a.width,10)}this._computedHeight=parseInt(o.height,10)}else return;this.currentLayer&&this.currentLayer.refreshLayout(this,this._computedHeight-this.getVerticalLayerGroupPadding())},t.prototype.getVerticalLayerGroupPadding=function(){var e=getComputedStyle(this.layerGroup.element),n=parseInt(e.paddingTop,10)||0,c=parseInt(e.paddingBottom,10)||0;return n+c},t.prototype.computedAdjustedOskHeight=function(e){if(!this.layerGroup)return e;var n=this.layerGroup.layers,c=0;for(var l in n){var r=n[l],s=r.rows.length,B=Math.floor(e/(s==0?1:s)),o=s*B;o>c&&(c=o)}var g=0,a=c+g;return a},t.prototype.appendStyleSheet=function(){var e=this,n=this.layoutKeyboard,c=this.layoutKeyboardProperties;if(c!=null){this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet);var l=c.textFont,r=c.oskFont;this.styleSheetManager.addStyleSheetForFont(l,this.fontRootPath,this.device.OS),this.styleSheetManager.addStyleSheetForFont(r,this.fontRootPath,this.device.OS);var s=this.addFontStyle(l,r);n!=null&&typeof n.oskStyling=="string"&&(s=s+n.oskStyling),this.styleSheet=xe(s),this.styleSheet.addEventListener("load",function(){e.refreshLayout()}),this.styleSheetManager.linkStylesheet(this.styleSheet)}},t.prototype.addFontStyle=function(e,n){var c="",l=function(r){return r.family.replace(/\u0022/g,"").replace(/,/g,'","')};return(e||n)&&(c='\n.kmw-key-text {\n  font-family: "'.concat(l(n||e),'";\n}\n\n.kmw-suggestion-text {\n  font-family: "').concat(l(e||n),'";\n}\n')),c},t.buildDocumentationKeyboard=function(e,n,c,l,r,s){if(!e)return null;var B=typeof l=="undefined"?"desktop":l,o=typeof r=="undefined"?"default":r,g={};g.formFactor=B,B!="desktop"?(g.OS=x.OperatingSystem.iOS,g.touchable=!0):(g.OS=x.OperatingSystem.Windows,g.touchable=!1);var a=e.layout(B),F=new x("other",g.formFactor,g.OS,g.touchable),y=new t({keyboard:e,keyboardMetadata:n,hostDevice:F,isStatic:!0,topContainer:null,pathConfig:{fonts:c,resources:""},styleSheetManager:null});y.layerGroup.element.className=y.kbdDiv.className,y.layerGroup.element.classList.add(g.formFactor+"-static");var u=y.kbdDiv.childNodes[0],Q=document.createElement("div");Q.classList.add(g.OS.toLowerCase(),g.formFactor),a!=null?(y.layerId=o,y.setSize(800,s),y.fontSize=Jc(F,s,!1),y.refreshLayout(),u.style.fontSize=y.kbdDiv.style.fontSize,u.style.height=y.kbdDiv.style.height,u.style.maxHeight=y.kbdDiv.style.maxHeight):u.innerHTML="<p style='color:#c40; font-size:0.5em;margin:10px;'>No "+B+" layout is defined for "+e.name+".</p>",u.style.border="1px solid #ccc";var C=function(){if(document.contains(u))try{getComputedStyle(u)&&u.style.fontSize&&(y.fontSize=new G(u.style.fontSize)),y.appendStyleSheet();var b=y.styleSheet,U=b.parentElement;y.refreshLayout(),u.style.fontSize=y.kbdDiv.style.fontSize,y.shutdown(),u.appendChild(b)}finally{h.disconnect()}},h=new MutationObserver(C);return h.observe(document.body,{childList:!0,subtree:!0}),Q.append(u),Q},t.prototype.onHide=function(){this.hkKey&&this.highlightKey(this.hkKey,!1)},t.prototype.startLongpress=function(e){var n=this;if(this.config.embeddedGestureConfig.startLongpress)return this.config.embeddedGestureConfig.startLongpress(this,e);var c=new Qn(this,e);return c.promise.then(function(l){l&&(n.topContainer.appendChild(l.element),n.topContainer.appendChild(l.shim),l.reposition(n))}),c},t.prototype.initGestures=function(e,n){var c=this;if(this.pendingMultiTap)switch(this.pendingMultiTap.incrementTouch(e)){case te.Cancelled:this.pendingMultiTap=null;break;case te.Realized:return}if(!this.pendingMultiTap&&In.isValidTarget(this,e)&&(this.pendingMultiTap=new In(this,e,2),this.pendingMultiTap.timeout.then(function(){c.pendingMultiTap=null})),e.subKeys){var l=this,r=this.startLongpress(e);if(r==null)return;this.pendingSubkey=r,r.promise.then(function(s){l.pendingSubkey==r&&(l.pendingSubkey=null),s&&(l.showKeyTip(null,!1),l.subkeyGesture=s,s.promise.then(function(B){B&&l.raiseKeyEvent(B,null),l.clearPopup()}))})}},t.prototype.updateGestures=function(e,n,c){var l=n,r=e;return!e&&this.pendingMultiTap&&(this.pendingMultiTap.cancel(),this.pendingMultiTap=null),this.subkeyGesture?(l&&l.key.highlight(!1),this.subkeyGesture.updateTouch(c),this.keyPending=null,this.touchPending=null,!0):(this.currentTarget=null,r&&r.subKeys!=null&&this.initTouchCoord&&this.pendingSubkey&&this.pendingSubkey instanceof Qn&&this.initTouchCoord.y-c.y>this.getLongpressFlickThreshold()&&this.pendingSubkey.resolve(),!!(this.subkeyGesture||this.pendingSubkey))},t.prototype.getLongpressFlickThreshold=function(){var e=this.currentLayer.rowHeight,n=e/4;return Math.max(n,5)},t.prototype.optionKey=function(e,n,c){n.indexOf("K_LOPT")>=0?this.emit("globekey",e,c):n.indexOf("K_ROPT")>=0&&c&&this.emit("hiderequested",e)},t.prototype.showKeyTip=function(e,n){var c=this.keytip;if(c!=null){var l=this.subkeyGesture,r=l&&l.isVisible();n=r?!1:n,c.show(e,n,this)}},t.prototype.createKeyTip=function(){if(this.config.embeddedGestureConfig.createKeyTip)this.keytip=this.config.embeddedGestureConfig.createKeyTip(this);else if(this.device.formFactor=="phone"&&this.keytip==null){var e=this.isEmbedded;this.keytip=new Wc(e)}this.keytip&&this.keytip.element&&this.topContainer.appendChild(this.keytip.element)},t.prototype.createGlobeHint=function(){return this.config.embeddedGestureConfig.createGlobeHint?this.config.embeddedGestureConfig.createGlobeHint(this):null},t.prototype.shutdown=function(){var e,n,c,l;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet),this.inputEngine&&this.inputEngine.unregisterEventHandlers(),this.deleting&&window.clearTimeout(this.deleting),this.keyPending=null,this.touchPending=null,(e=this.keytip)===null||e===void 0||e.show(null,!1,this),(n=this.subkeyGesture)===null||n===void 0||n.clear(),(c=this.pendingMultiTap)===null||c===void 0||c.cancel(),(l=this.pendingSubkey)===null||l===void 0||l.cancel()},t.prototype.raiseKeyEvent=function(e,n){if(e.kName=="K_LOPT"||e.kName=="K_ROPT")return this.optionKey(n,e.kName,!0),!0;this.emit("keyevent",e)},t.specialCharacters=Ie.specialCharacters,t}(Nc.default),Qe=Nl;var Tc=v(A(),1),Ec=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t}(Tc.default),qe=Ec,$e=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"enabled",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activate",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"conditionsMet",{get:function(){return!0},enumerable:!1,configurable:!0}),t}(Ec);var Tl=function(){function i(){this.map={}}return i.prototype.promiseForTouchpoint=function(t){return this.map[t]||(this.map[t]=new R),this.map[t]},i.prototype.maintainTouches=function(t){for(var e=Object.keys(this.map),n=0;n<t.length;n++){var c=e.indexOf(""+t.item(n).identifier);c!=-1&&e.splice(c,1)}for(var l=0,r=e;l<r.length;l++){var s=r[l];this.map[s].resolve(),delete this.map[s]}},i}(),kc=Tl;var El=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.legacyEvents=new ut,n.needsLayout=!0,n.touchEventPromiseManager=new kc,n.activationListener=function(c){if(!n.mayDisable&&!n.activationModel.enabled){n.activationModel.off("activate",n.activationListener);try{n.activationModel.enabled=!0}finally{n.activationModel.on("activate",n.activationListener)}}n.commonCheckAndDisplay()},n.layerChangeHandler=function(c,l){var r;return n.vkbd&&n.vkbd._UpdateVKShiftStyle(l),(n.vkbd&&n.vkbd.layerId!=l||c.value!=l)&&(!((r=n.vkbd)===null||r===void 0)&&r.layerGroup.layers[l]&&(n.vkbd.layerId=l,n.vkbd.showLanguage()),n.keyboardView.updateState(),n.refreshLayout()),!1},n._Visible=!1,n.config=e=(0,d.__assign)({},e),n.config.allowHideAnimations===void 0&&(n.config.allowHideAnimations=!0),n.config.device=e.device||e.hostDevice,n.config.isEmbedded=e.isEmbedded||!1,n.config.embeddedGestureConfig=e.embeddedGestureConfig||{},n.config.activator.on("activate",n.activationListener),n._Box=m("div"),n.kbdStyleSheetManager=new Fe(n._Box,n.config.doCacheBusting||!1),n.uiStyleSheetManager=new Fe(n._Box),n.bannerView=new Zc,n.bannerView.events.on("bannerchange",function(){return n.refreshLayout()}),n._bannerController=new un(n.bannerView,n.hostDevice,n.config.predictionContextManager),n.keyboardView=null,n.setBaseMouseEventListeners(),n.hostDevice.touchable&&n.setBaseTouchEventListeners(),n}return Object.defineProperty(t.prototype,"keyCodes",{get:function(){return I.keyCodes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"modifierCodes",{get:function(){return I.modifierCodes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"modifierBitmasks",{get:function(){return I.modifierBitmasks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateBitmasks",{get:function(){return I.stateBitmasks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"configuration",{get:function(){return this.config},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bannerController",{get:function(){return this._bannerController},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hostDevice",{get:function(){return this.config.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontRootPath",{get:function(){return this.config.pathConfig.fonts},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmbedded",{get:function(){return this.config.isEmbedded},enumerable:!1,configurable:!0}),t.prototype.setBaseMouseEventListeners=function(){var e=this;this._Box.onmouseenter=this._VKbdMouseEnter=function(n){e.mouseEnterPromise&&e.mouseEnterPromise.resolve(),e.mouseEnterPromise=new R,e.emit("pointerinteraction",e.mouseEnterPromise.corePromise)},this._Box.onmouseleave=this._VKbdMouseLeave=function(n){e.mouseEnterPromise.resolve(),e.mouseEnterPromise=null}},t.prototype.removeBaseMouseEventListeners=function(){this._Box.onmouseenter=null,this._Box.onmouseleave=null},t.prototype.setBaseTouchEventListeners=function(){var e=this,n=function(c){return c.cancelable&&c.preventDefault(),c.stopPropagation(),!1};this._boxBaseTouchEventCancel=function(c){return e.touchEventPromiseManager.maintainTouches(c.touches),n(c)},this._boxBaseTouchStart=function(c){for(var l=0;l<c.changedTouches.length;l++){var r=e.touchEventPromiseManager.promiseForTouchpoint(c.changedTouches[l].identifier);e.emit("pointerinteraction",r.corePromise)}return e.touchEventPromiseManager.maintainTouches(c.touches),n(c)},this._Box.addEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.addEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchcancel",this._boxBaseTouchEventCancel,!1)},t.prototype.removeBaseTouchEventListeners=function(){!this._boxBaseTouchEventCancel||(this._Box.removeEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.removeEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchcancel",this._boxBaseTouchEventCancel,!1),this._boxBaseTouchEventCancel=null,this._boxBaseTouchStart=null)},Object.defineProperty(t.prototype,"targetDevice",{get:function(){return this.config.device},set:function(e){this.allowsDeviceChange(e)?(this.config.device=e,this.loadActiveKeyboard()):console.error("May not change target device for this OSKView type.")},enumerable:!1,configurable:!0}),t.prototype.allowsDeviceChange=function(e){return!1},Object.defineProperty(t.prototype,"activationModel",{get:function(){return this.config.activator},set:function(e){if(!e)throw new Error("The activation model may not be set to null or undefined!");this.config.activator.off("activate",this.activationListener),e.on("activate",this.activationListener),this.config.activator=e,this.commonCheckAndDisplay()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mayDisable",{get:function(){var e;return!(this.hostDevice.touchable||!((e=this.activeKeyboard)===null||e===void 0)&&e.keyboard.isCJK)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayIfActive",{get:function(){return this.activationModel.enabled},enumerable:!1,configurable:!0}),t.prototype.commonCheckAndDisplay=function(){this.activationModel.activate&&this.activeKeyboard?this.present():this.startHide(!1)},Object.defineProperty(t.prototype,"vkbd",{get:function(){return this.keyboardView instanceof Qe?this.keyboardView:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"banner",{get:function(){return this.bannerView},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computedWidth",{get:function(){return this.needsLayout&&this.refreshLayout(),this._computedWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computedHeight",{get:function(){return this.needsLayout&&this.refreshLayout(),this._computedHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"baseFontSize",{get:function(){var e;return((e=this.parsedBaseFontSize)===null||e===void 0?void 0:e.styleString)||""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parsedBaseFontSize",{get:function(){return this._baseFontSize||(this._baseFontSize=t.defaultFontSize(this.targetDevice,this.computedHeight,this.isEmbedded)),this._baseFontSize},enumerable:!1,configurable:!0}),t.defaultFontSize=function(e,n,c){if(e.touchable){var l=e.formFactor=="phone"?1.6*(c?.65:.6)*1.2:2;return G.special(l,"em")}else return n?G.inPixels(n/8):void 0},Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this.keyboardData},set:function(e){var n;this.keyboardData=e,this.loadActiveKeyboard(),!((n=this.keyboardData)===null||n===void 0)&&n.keyboard.isCJK&&(this.activationModel.enabled=!0)},enumerable:!1,configurable:!0}),t.prototype.computeFrameHeight=function(){var e,n;return(((e=this.headerView)===null||e===void 0?void 0:e.layoutHeight.val)||0)+(((n=this.footerView)===null||n===void 0?void 0:n.layoutHeight.val)||0)},t.prototype.setSize=function(e,n,c){var l=!1,r,s;!e&&e!==0||!n&&n!==0||(Number.isFinite(e)?r=G.inPixels(e):r=new G(e),Number.isFinite(n)?s=G.inPixels(n):s=new G(n),e&&n&&(l=!this._width||!this._height,l=l||r.styleString!=this._width.styleString,l=l||s.styleString!=this._height.styleString,this._width=r,this._height=s),this.needsLayout=this.needsLayout||l,this.refreshLayoutIfNeeded(c))},t.prototype.setNeedsLayout=function(){this.needsLayout=!0},t.prototype.refreshLayout=function(e){var n,c;if(!!this.keyboardView){var l=this.width&&this.height,r=l&&this.width.absolute&&this.height.absolute,s=getComputedStyle(this._Box),B=s.height!=""&&s.height!="auto";if(r)this._computedWidth=this.width.val,this._computedHeight=this.height.val;else if(B&&l){var o=this._Box.parentElement;this._computedWidth=this.width.val*(this.width.absolute?1:o.offsetWidth),this._computedHeight=this.height.val*(this.height.absolute?1:o.offsetHeight)}else if(l){console.warn("Unable to properly perform layout - specification uses a relative spec, thus relies upon insertion into the DOM for layout.");return}else{console.warn("Unable to properly perform layout - size specifications have not yet been set.");return}if(this.needsLayout=!1,this.banner.element.style.fontSize=this.baseFontSize,this.vkbd&&(this.vkbd.fontSize=this.parsedBaseFontSize),e||((n=this.headerView)===null||n===void 0||n.refreshLayout(),this.bannerView.refreshLayout(),(c=this.footerView)===null||c===void 0||c.refreshLayout()),this.vkbd){var g=this.computedHeight-this.computeFrameHeight();this.bannerView.height>0&&(g-=this.bannerView.height+5),this.vkbd.setSize(this.computedWidth,g,e);var a=this._Box.style;a.width=a.maxWidth=this.computedWidth+"px",a.height=a.maxHeight=this.computedHeight+"px",this.vkbd.showLanguage()}else{var a=this._Box.style;a.width="auto",a.height="auto",a.maxWidth=a.maxHeight=""}}},t.prototype.refreshLayoutIfNeeded=function(e){this.needsLayout&&this.refreshLayout(e)},t.prototype.postKeyboardLoad=function(){this._Visible=!1,this.postKeyboardAdjustments(),this.displayIfActive&&this.present()},t.prototype.loadActiveKeyboard=function(){var e,n,c,l;this.setBoxStyling(),this.vkbd&&this.vkbd.shutdown(),this.keyboardView=null,this.needsLayout=!0,this._Box.innerHTML="";var r="osk/";this.config.isEmbedded&&(r="");for(var s=0,B=t.STYLESHEET_FILES;s<B.length;s++){var o=B[s],g="".concat(this.config.pathConfig.resources,"/").concat(r).concat(o);this.uiStyleSheetManager.linkExternalSheet(g)}this.headerView&&this._Box.appendChild(this.headerView.element),this._Box.appendChild(this.banner.element),this.bannerView.banner&&this.banner.banner.configureForKeyboard((e=this.keyboardData)===null||e===void 0?void 0:e.keyboard,(n=this.keyboardData)===null||n===void 0?void 0:n.metadata);var a=this.keyboardView=this._GenerateKeyboardView((c=this.keyboardData)===null||c===void 0?void 0:c.keyboard,(l=this.keyboardData)===null||l===void 0?void 0:l.metadata);if(this._Box.appendChild(a.element),a.postInsert(),this.footerView&&this._Box.appendChild(this.footerView.element),this.banner.appendStyles(),this.vkbd){this.vkbd.createKeyTip();var F=this.vkbd.createGlobeHint();F&&this._Box.appendChild(F.element),this.vkbd.appendStyleSheet()}this.postKeyboardLoad()},t.prototype._GenerateKeyboardView=function(e,n){var c=this.targetDevice;return this.vkbd&&this.vkbd.shutdown(),this._Box.className="",e==null&&!c.touchable?new ht:e&&e.layout(c.formFactor)?this._GenerateVisualKeyboard(e,n):!e||!n?this._GenerateVisualKeyboard(null,null):new Lc(e)},t.prototype._GenerateVisualKeyboard=function(e,n){var c=this,l=this.targetDevice,r=new Qe({keyboard:e,keyboardMetadata:n,device:l,hostDevice:this.hostDevice,topContainer:this._Box,styleSheetManager:this.kbdStyleSheetManager,pathConfig:this.config.pathConfig,embeddedGestureConfig:this.config.embeddedGestureConfig,isEmbedded:this.config.isEmbedded});return r.on("keyevent",function(s){return c.emit("keyevent",s)}),r.on("globekey",function(s,B){return c.emit("globekey",s,B)}),r.on("hiderequested",function(s){c.doHide(!0),c.emit("hiderequested",s)}),this._Box.className=l.formFactor+" "+l.OS.toLowerCase()+" kmw-osk-frame",r},t.prototype.present=function(){if(!!this.mayShow()){if(this.keyboardView.updateState(),this._Box.style.display="block",this.refreshLayoutIfNeeded(),this.keyboardView instanceof Qe&&this.keyboardView.showLanguage(),this._Visible=!0,this._Box.style.opacity="1",this._Box.style.visibility=="hidden"){var e=this;window.setTimeout(function(){e._Box.style.visibility="visible"},0)}this.setDisplayPositioning()}},t.prototype.startHide=function(e){if(!!this.mayHide(e)){e&&(this.activationModel.enabled=!!(this.keyboardData.keyboard.isCJK||this.hostDevice.touchable));var n=null;this._Box&&this.hostDevice.touchable&&!(this.keyboardView instanceof ht)&&this.config.allowHideAnimations?n=this.useHideAnimation():n=Promise.resolve(!0);var c=this;n.then(function(l){l&&c.finalizeHide()}),this.doHide(e)}},t.prototype.finalizeHide=function(){if(!(document.body.className.indexOf("osk-always-visible")>=0)){if(this._Box){var e=this._Box.style;e.display="none",e.transition="",e.opacity="1",this._Visible=!1}this.vkbd&&this.vkbd.onHide()}},t.prototype.mayShow=function(){return!(!this.activationModel.conditionsMet||!this.keyboardView||this.keyboardView instanceof ht||!this.activationModel.enabled||!this._Box)},t.prototype.mayHide=function(e){return!(this.activationModel.conditionsMet&&!this.mayDisable||this.activationModel instanceof $e||!e&&this.hostDevice.formFactor=="desktop"&&document.body.className.indexOf("osk-always-visible")>=0)},t.prototype.useHideAnimation=function(){var e=this._Box.style,n=this;return new Promise(function(c){var l=function(){return n._Box.removeEventListener("transitionend",l,!1),n._Box.removeEventListener("webkitTransitionEnd",l,!1),n._Box.removeEventListener("transitioncancel",l,!1),n._Box.removeEventListener("webkitTransitionCancel",l,!1),n._animatedHideTimeout!=0&&window.clearTimeout(n._animatedHideTimeout),n._animatedHideTimeout=0,n._Visible&&n.activationModel.conditionsMet?(e.transition="",e.opacity="1",c(!1),!1):(c(!0),!0)},r=function(){n._Box.removeEventListener("transitionrun",r,!1),n._Box.removeEventListener("webkitTransitionRun",r,!1),n._Box.addEventListener("transitionend",l,!1),n._Box.addEventListener("webkitTransitionEnd",l,!1),n._Box.addEventListener("transitioncancel",l,!1),n._Box.addEventListener("webkitTransitionCancel",l,!1)};n._Box.addEventListener("transitionrun",r,!1),n._Box.addEventListener("webkitTransitionRun",r,!1),e.transition="opacity 0.5s linear 0",e.opacity="0",n._animatedHideTimeout=window.setTimeout(l,200)})},t.prototype.hideNow=function(){if(!(!this.mayHide(!1)||!this._Box)){this._animatedHideTimeout&&(window.clearTimeout(this._animatedHideTimeout),this._animatedHideTimeout=0);var e=this._Box.style;e.transition="",e.opacity="0",this.finalizeHide()}},t.prototype.shutdown=function(){this.removeBaseMouseEventListeners(),this.removeBaseTouchEventListeners();var e=this._Box;e.parentElement&&e.parentElement.removeChild(e),this.kbdStyleSheetManager.unlinkAll(),this.uiStyleSheetManager.unlinkAll()},t.prototype.getRect=function(){var e={};return e.left=e.left=J(this._Box),e.top=e.top=Z(this._Box),e.width=this.computedWidth,e.height=this.computedHeight,e},t.prototype.isEnabled=function(){return this.displayIfActive},t.prototype.isVisible=function(){return this._Visible},t.prototype.hide=function(){this.activationModel.enabled=!1,this.startHide(!0)},t.prototype.show=function(e){arguments.length>0?this.activationModel.enabled=e:this.activationModel.conditionsMet&&(this.activationModel.enabled=!this.activationModel.enabled)},t.prototype.doShow=function(e){this.legacyEvents.callEvent("show",e)},t.prototype.doHide=function(e){var n={HiddenByUser:e};this.legacyEvents.callEvent("hide",n)},t.prototype.addEventListener=function(e,n){this.legacyEvents.addEventListener(e,n)},t.prototype.removeEventListener=function(e,n){this.legacyEvents.removeEventListener(e,n)},t.STYLESHEET_FILES=["kmwosk.css","globe-hint.css"],t}(Yc.default),Je=El;var wc=v(A(),1);var kl=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.mouseCancellingHandler=function(c){return c.preventDefault(),c.cancelBubble=!0,!1},n._element=n.buildTitleBar(),n.helpEnabled=!1,n.configEnabled=!1,e&&(n.element.onmousedown=e.mouseDownHandler),n}return Object.defineProperty(t.prototype,"helpEnabled",{get:function(){return this._helpEnabled},set:function(e){this._helpEnabled=e,this._helpButton.style.display=e?"inline":"none"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"configEnabled",{get:function(){return this._configEnabled},set:function(e){this._configEnabled=e,this._configButton.style.display=e?"inline":"none"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layoutHeight",{get:function(){return t.DISPLAY_HEIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),t.prototype.setPinCJKOffset=function(){this._unpinButton.style.left="15px"},t.prototype.showPin=function(e){this._unpinButton.style.display=e?"block":"none"},t.prototype.setTitle=function(e){this._caption.innerHTML=e},t.prototype.setTitleFromKeyboard=function(e){var n="<span style='font-weight:bold'>"+(e==null?void 0:e.name)+"</span>";this._caption.innerHTML=n},t.prototype.buildTitleBar=function(){var e=this,n=m("div");n.id="keymanweb_title_bar",n.className="kmw-title-bar";var c=this._caption=m("span");c.className="kmw-title-bar-caption",c.style.color="#fff",n.appendChild(c);var l=this._closeButton=this.buildCloseButton();return this._closeButton.onclick=function(){return e.emit("close"),!1},n.appendChild(l),l=this._helpButton=this.buildHelpButton(),this._helpButton.onclick=function(){return e.emit("help"),!1},n.appendChild(l),l=this._configButton=this.buildConfigButton(),this._configButton.onclick=function(){return e.emit("config"),!1},n.appendChild(l),l=this._unpinButton=this.buildUnpinButton(),this._unpinButton.onclick=function(){return e.emit("unpin"),!1},n.appendChild(l),n},t.prototype.buildCloseButton=function(){var e=m("div");return e.id="kmw-close-button",e.className="kmw-title-bar-image",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.buildHelpButton=function(){var e=m("div");return e.id="kmw-help-image",e.className="kmw-title-bar-image",e.title="KeymanWeb Help",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.buildConfigButton=function(){var e=m("div");return e.id="kmw-config-image",e.className="kmw-title-bar-image",e.title="KeymanWeb Configuration Options",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.buildUnpinButton=function(){var e=m("div");return e.id="kmw-pin-image",e.className="kmw-title-bar-image",e.title="Pin the On Screen Keyboard to its default location on the active text box",e.onmousedown=this.mouseCancellingHandler,e},t.prototype.refreshLayout=function(){},t.DISPLAY_HEIGHT=G.inPixels(20),t}(wc.default),Cn=kl;var Oc=v(A(),1);var Yl=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.mouseCancellingHandler=function(c){return c.preventDefault(),c.cancelBubble=!0,!1},n._element=n.buildResizeBar(),e&&(n._resizeHandle.onmousedown=e.mouseDownHandler),n}return Object.defineProperty(t.prototype,"layoutHeight",{get:function(){return t.DISPLAY_HEIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"handle",{get:function(){return this._resizeHandle},enumerable:!1,configurable:!0}),t.prototype.allowResizing=function(e){this._resizeHandle.style.display=e?"block":"none"},t.prototype.buildResizeBar=function(){var e=this,n=m("div");n.className="kmw-footer",n.onmousedown=this.mouseCancellingHandler;var c=m("div");c.className="kmw-footer-caption",c.innerHTML='<a href="https://keyman.com/developer/keymanweb/">KeymanWeb</a>',c.id="keymanweb-osk-footer-caption",c.addEventListener("dblclick",function(r){return e.emit("showbuild"),!1},!1),n.appendChild(c);var l=m("div");return l.className="kmw-footer-resize",n.appendChild(l),this._resizeHandle=l,n},t.prototype.refreshLayout=function(){},t.DISPLAY_HEIGHT=G.inPixels(16),t}(Oc.default),Dc=Yl;var wl=function(){function i(t){this._VPreviousMouseMove=document.onmousemove,this._VPreviousMouseUp=document.onmouseup,this._VPreviousCursor=document.body.style.cursor,this._VPreviousMouseButton=typeof t.which=="undefined"?t.button:t.which}return i.prototype.restore=function(){document.onmousemove=this._VPreviousMouseMove,document.onmouseup=this._VPreviousMouseUp,document.body.style.cursor&&(document.body.style.cursor=this._VPreviousCursor)},i.prototype.matchesCausingClick=function(t){return this._VPreviousMouseButton==(typeof t.which=="undefined"?t.button:t.which)},i}(),Ol=function(){function i(t){this.startHandler=this._VMoveMouseDown.bind(this),this.cursorType=t}return Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isActive",{get:function(){return!!this._mouseStartSnapshot},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"mouseDownHandler",{get:function(){return this.startHandler},enumerable:!1,configurable:!0}),i.prototype._VMoveMouseDown=function(t){return!t||!this._enabled?!0:(this._mouseStartSnapshot||(this._mouseStartSnapshot=new wl(t)),this._startCoord=K.fromEvent(t),document.onmousemove=this._VMoveMouseMove.bind(this),document.onmouseup=this._VMoveMouseUp.bind(this),document.body.style.cursor&&(document.body.style.cursor=this.cursorType),t.preventDefault(),t.cancelBubble=!0,this.onDragStart(),!1)},i.prototype._VMoveMouseMove=function(t){if(!t||!this.enabled)return!0;if(t.preventDefault(),t.cancelBubble=!0,this._mouseStartSnapshot.matchesCausingClick(t)){var e=K.fromEvent(t),n=e.x-this._startCoord.x,c=e.y-this._startCoord.y;return this.onDragMove(n,c),!1}else return this._VMoveMouseUp(t)},i.prototype._VMoveMouseUp=function(t){return t?(this._mouseStartSnapshot.restore(),this._mouseStartSnapshot=null,t.preventDefault(),t.cancelBubble=!0,this.onDragRelease(),!1):!0},i}(),bn=Ol;var Dl=function(i){(0,d.__extends)(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e._enabled=!0,e.actValue=null,e}return Object.defineProperty(t.prototype,"activate",{get:function(){return this._enabled&&!!this.actValue},enumerable:!1,configurable:!0}),t.prototype.checkState=function(e){this.activate!=e&&this.emit("activate",this.activate)},Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(e){var n=this.activate;this._enabled=e,this.checkState(n)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activationTrigger",{get:function(){return this.actValue},set:function(e){var n=this.activate,c=this.actValue;this.actValue=e,this.checkState(n),c!=e&&this.emit("triggerchange",e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"conditionsMet",{get:function(){return!!this.activationTrigger},enumerable:!1,configurable:!0}),t}(qe),et=Dl;var Mc=function(i){(0,d.__extends)(t,i);function t(){return i.call(this,"KeymanWeb_OnScreenKeyboard")||this}return t.prototype.loadWithDefaults=function(e){return(0,d.__assign)((0,d.__assign)({},e),this.load())},t.prototype.load=function(){var e=i.prototype.load.call(this,function(n,c){switch(c){case"version":return n;default:return Number.parseInt(n,10)}});return e.width||delete e.width,e.height||delete e.height,e},t.prototype.save=function(e){i.prototype.save.call(this,e)},t}(se);var Ml=function(i){(0,d.__extends)(t,i);function t(e){var n=this;e.activator=e.activator||new et,n=i.call(this,e)||this,n.userPositioned=!1,n.specifiedPosition=!1,n.noDrag=!1,n.layoutSerializer=new Mc,n.restorePosition=function(g){var a=this._Visible,F=new R;this.emit("dragmove",F.corePromise),this.loadPersistedLayout(),this.userPositioned=!1,g||(delete this.dfltX,delete this.dfltY),this.savePersistedLayout(),a&&this.present(),this.titleBar.showPin(!1),F.resolve(),this.doResizeMove()}.bind(n),n.typedActivationModel.on("triggerchange",function(){return n.setDisplayPositioning()}),document.body.appendChild(n._Box),n.titleBar=new Cn(n.titleDragHandler),n.titleBar.on("help",function(){n.legacyEvents.callEvent("helpclick",{})}),n.titleBar.on("config",function(){n.legacyEvents.callEvent("configclick",{})}),n.titleBar.on("close",function(){return n.startHide(!0)}),n.titleBar.on("unpin",function(){return n.restorePosition(!0)}),n.resizeBar=new Dc(n.resizeDragHandler),n.resizeBar.on("showbuild",function(){return n.emit("showbuild")}),n.headerView=n.titleBar;for(var c=function(g){var a=n.headerView;if(a&&a instanceof Cn)switch(g){case"configclick":a.configEnabled=n.legacyEvents.listenerCount("configclick")>0;break;case"helpclick":a.helpEnabled=n.legacyEvents.listenerCount("helpclick")>0;break;default:return}},l=new yt(n),r=new yt(n.legacyEvents),s=0,B=[l,r];s<B.length;s++){var o=B[s];o.on("listeneradded",c),o.on("listenerremoved",c)}return n.loadPersistedLayout(),n}return Object.defineProperty(t.prototype,"typedActivationModel",{get:function(){return this.activationModel},enumerable:!1,configurable:!0}),t.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},t.prototype.setBoxStyling=function(){var e=this._Box.style;e.zIndex="9999",e.display="none",e.width="auto",e.position="absolute"},t.prototype.postKeyboardAdjustments=function(){this.enableMoveResizeHandlers(),this.activeKeyboard&&this.titleBar.setTitleFromKeyboard(this.activeKeyboard.keyboard),this.vkbd?(this.footerView=this.resizeBar,this._Box.appendChild(this.footerView.element)):(this.footerView&&this._Box.removeChild(this.footerView.element),this.footerView=null),this.loadPersistedLayout(),this.setNeedsLayout()},t.prototype.isEnabled=function(){return this.displayIfActive},t.prototype.isVisible=function(){return this._Visible},t.prototype.savePersistedLayout=function(){var e=this.getPos(),n={visible:this.displayIfActive?1:0,userSet:this.userPositioned?1:0,left:e.left,top:e.top,_version:z.CURRENT.toString()};this.vkbd&&(n.width=this.width.val,n.height=this.height.val),this.layoutSerializer.save(n)},t.prototype.loadPersistedLayout=function(){var e=this.layoutSerializer.loadWithDefaults({visible:1,userSet:0,left:-1,top:-1,_version:void 0,width:.3*screen.width,height:.15*screen.height});this.activationModel.enabled=e.visible==1,this.userPositioned=e.userSet==1,this.x=e.left,this.y=e.top;var n=e._version,c=n===void 0,l=e.width,r=e.height;l<.2*screen.width&&(l=.2*screen.width),r<.1*screen.height&&(r=.1*screen.height),l>.9*screen.width&&(l=.9*screen.width),r>.5*screen.height&&(r=.5*screen.height),(c||!n)&&(this.headerView&&this.headerView.layoutHeight.absolute&&(r+=this.headerView.layoutHeight.val),this.footerView&&this.footerView.layoutHeight.absolute&&(r+=this.footerView.layoutHeight.val)),this.setSize(l,r),(this.x==-1||this.y==-1||!this._Box)&&(this.userPositioned=!1),this.x<window.pageXOffset-.8*l&&(this.x=window.pageXOffset-.8*l),this.y<0&&(this.x=-1,this.y=-1,this.userPositioned=!1),this.userPositioned&&this._Box&&this.setPos({left:this.x,top:this.y})},t.prototype.getDefaultKeyboardHeight=function(){if(this.configuration.heightOverride)return this.configuration.heightOverride();var e=Math.floor(Math.min(screen.availHeight,screen.availWidth)/2),n=e;if(this.targetDevice.formFactor=="phone"){var c=Math.min(screen.height,screen.width),l=Math.max(screen.height,screen.width);D()?n=n*(l/c)/1.6:n=Math.floor(Math.max(screen.availHeight,screen.availWidth)/3)}return this.targetDevice.OS==x.OperatingSystem.iOS&&(n=n/He()),n},t.prototype.getDefaultWidth=function(){if(this.configuration.widthOverride)return this.configuration.widthOverride();var e;if(this.targetDevice.OS==x.OperatingSystem.iOS)e=window.innerWidth;else if(this.targetDevice.OS==x.OperatingSystem.Android)try{e=document.documentElement.clientWidth}catch(n){e=screen.availWidth}else e=screen.width;return e},t.prototype.doResizeMove=function(e){this.legacyEvents.callEvent("resizemove",e)},t.prototype.setRect=function(e){if(!(this._Box==null||this.targetDevice.formFactor!="desktop")){var n=this._Box,c=n.style;if("left"in e&&(this.x=e.left-J(n)+n.offsetLeft,c.left=this.x+"px",this.dfltX=c.left),"top"in e&&(this.y=e.top-Z(n)+n.offsetTop,c.top=this.y+"px",this.dfltY=c.top),this.vkbd!=null){var l=this.vkbd.kbdDiv,r=l.style;if("width"in e){var s=e.width-(n.offsetWidth-l.offsetWidth);s<.2*screen.width&&(s=.2*screen.width),s>.9*screen.width&&(s=.9*screen.width),r.width=s+"px",this.setSize(s,this.computedHeight,!0)}if("height"in e){var B=e.height-(n.offsetHeight-l.offsetHeight);B<.1*screen.height&&(B=.1*screen.height),B>.5*screen.height&&(B=.5*screen.height),r.height=B+"px",r.fontSize=B/8+"px",this.setSize(this.computedWidth,B,!0)}"nosize"in e&&(this.resizingEnabled=!e.nosize)}"nomove"in e&&(this.noDrag=e.nomove,this.movementEnabled=!this.noDrag),this.savePersistedLayout()}},t.prototype.getPos=function(){var e=this._Box,n={left:this._Visible?e.offsetLeft:this.x,top:this._Visible?e.offsetTop:this.y};return n},t.prototype.setPos=function(e){if(typeof this._Box!="undefined"){if(this.userPositioned){var n=e.left,c=e.top;typeof n!="undefined"&&(n<-.8*this._Box.offsetWidth&&(n=-.8*this._Box.offsetWidth),this.userPositioned&&(this._Box.style.left=n+"px",this.x=n)),typeof c!="undefined"&&(c<0&&(c=0),this.userPositioned&&(this._Box.style.top=c+"px",this.y=c))}this.titleBar.showPin(this.userPositioned)}},t.prototype.setDisplayPositioning=function(){var e=this._Box.style;if(e.position="absolute",this.activationModel.activate&&(e.display="block"),e.left="0px",this.specifiedPosition||this.userPositioned)e.left=this.x+"px",e.top=this.y+"px";else{var n=this.typedActivationModel.activationTrigger||null;this.dfltX?e.left=this.dfltX:typeof n!="undefined"&&n!=null&&(e.left=J(n)+"px"),this.dfltY?e.top=this.dfltY:typeof n!="undefined"&&n!=null&&(e.top=Z(n)+n.offsetHeight+"px")}this.specifiedPosition=!1},t.prototype.presentAtPosition=function(e,n){!this.mayShow()||(this.specifiedPosition=e>=0||n>=0,this.specifiedPosition&&(this.x=e,this.y=n),this.specifiedPosition=this.specifiedPosition||this.userPositioned,this.present())},t.prototype.present=function(){if(!!this.mayShow()){this.titleBar.showPin(this.userPositioned),i.prototype.present.call(this);var e={};e.x=this._Box.offsetLeft,e.y=this._Box.offsetTop,e.userLocated=this.userPositioned,this.doShow(e)}},t.prototype.startHide=function(e){i.prototype.startHide.call(this,e),e&&this.savePersistedLayout()},t.prototype.show=function(e){e!==void 0?i.prototype.show.call(this,e):i.prototype.show.call(this),this.savePersistedLayout()},t.prototype.userLocated=function(){return this.userPositioned},Object.defineProperty(t.prototype,"movementEnabled",{get:function(){return this.titleDragHandler.enabled},set:function(e){this.titleDragHandler.enabled=e,this.titleBar.showPin(e&&this.userPositioned)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resizingEnabled",{get:function(){return this.resizeDragHandler.enabled},set:function(e){this.resizeDragHandler.enabled=e,this.resizeBar.allowResizing(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBeingMoved",{get:function(){return this.titleDragHandler.isActive},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBeingResized",{get:function(){return this.resizeDragHandler.isActive},enumerable:!1,configurable:!0}),t.prototype.enableMoveResizeHandlers=function(){this.titleDragHandler.enabled=!this.noDrag,this.resizeDragHandler.enabled=!0},Object.defineProperty(t.prototype,"titleDragHandler",{get:function(){var e=this;return this._moveHandler?this._moveHandler:(this._moveHandler=new(function(n){(0,d.__extends)(c,n);function c(){return n.call(this,"move")||this}return c.prototype.onDragStart=function(){this.startX=e._Box.offsetLeft,this.startY=e._Box.offsetTop,e.activeKeyboard.keyboard.isCJK&&e.titleBar.setPinCJKOffset(),this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new R,e.emit("dragmove",this.dragPromise.corePromise)},c.prototype.onDragMove=function(l,r){e.titleBar.showPin(!0),e.userPositioned=!0,e._Box.style.left=this.startX+l+"px",e._Box.style.top=this.startY+r+"px";var s=e.getRect();e.setSize(s.width,s.height,!0),e.x=s.left,e.y=s.top},c.prototype.onDragRelease=function(){e.vkbd&&(e.vkbd.currentKey=null),this.dragPromise.resolve(),this.dragPromise.then(function(){e.userPositioned=!0,e.doResizeMove(),e.savePersistedLayout()}),this.dragPromise=null},c}(bn)),this._moveHandler)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resizeDragHandler",{get:function(){var e=this;return this._resizeHandler?this._resizeHandler:(this._resizeHandler=new(function(n){(0,d.__extends)(c,n);function c(){return n.call(this,"se-resize")||this}return c.prototype.onDragStart=function(){this.startWidth=e.computedWidth,this.startHeight=e.computedHeight,this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new R,e.emit("resizemove",this.dragPromise.corePromise)},c.prototype.onDragMove=function(l,r){var s=this.startWidth+l,B=this.startHeight+r;s<.2*screen.width&&(s=.2*screen.width),B<.1*screen.height&&(B=.1*screen.height),s>.9*screen.width&&(s=.9*screen.width),B>.5*screen.height&&(B=.5*screen.height),e.setSize(s,B,!0)},c.prototype.onDragRelease=function(){e.vkbd&&(e.vkbd.currentKey=null),e.vkbd&&(this.startWidth=e.computedWidth,this.startHeight=e.computedHeight),e.refreshLayout(),this.dragPromise.resolve(),this.dragPromise.then(function(){e.doResizeMove(),e.savePersistedLayout()}),this.dragPromise=null},c}(bn)),this._resizeHandler)},enumerable:!1,configurable:!0}),t}(Je),We=Ml;var zl=function(i){(0,d.__extends)(t,i);function t(e){var n=this;return e.isEmbedded?e.activator=e.activator||new $e:e.activator=e.activator||new et,n=i.call(this,e)||this,n.isResizing=!1,n.restorePosition=function(c){}.bind(n),document.body.appendChild(n._Box),n}return t.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},t.prototype.setBoxStyling=function(){var e=this._Box.style;e.zIndex="9999",e.display="none",e.width="100%",e.position="fixed"},t.prototype.refreshLayout=function(e){if(!this.isResizing){try{this.isResizing=!0,this.doResize()}finally{this.isResizing=!1}i.prototype.refreshLayout.call(this,e)}},t.prototype.doResize=function(){if(this.vkbd){var e=this.getDefaultKeyboardHeight();this.setSize(this.getDefaultWidth(),e+this.banner.height)}},t.prototype.postKeyboardAdjustments=function(){this.doResize()},t.prototype.getDefaultKeyboardHeight=function(){var e,n,c=this.targetDevice;if(this.configuration.heightOverride)return this.configuration.heightOverride();var l=(e=document==null?void 0:document.documentElement)===null||e===void 0?void 0:e.clientWidth,r=(n=document==null?void 0:document.documentElement)===null||n===void 0?void 0:n.clientHeight;if(typeof l=="undefined"&&(l=Math.min(screen.height,screen.width),r=Math.max(screen.height,screen.width),D())){var s=l;l=r,r=s}var B=Math.floor(Math.min(r,l)/2),o=B;return c.formFactor=="phone"&&(D()?o=Math.floor(r/1.6):o=Math.floor(r/2.4)),this.targetDevice.OS==x.OperatingSystem.iOS&&(o=o/He()),o},t.prototype.getDefaultWidth=function(){var e,n=this.targetDevice;if(this.configuration.widthOverride)return this.configuration.widthOverride();var c;return c=(e=document==null?void 0:document.documentElement)===null||e===void 0?void 0:e.clientWidth,typeof c=="undefined"&&(this.targetDevice.OS==x.OperatingSystem.iOS?c=window.innerWidth:n.OS==x.OperatingSystem.Android?c=screen.availWidth:c=screen.width),c},t.prototype.setRect=function(e){},t.prototype.getPos=function(){var e=this._Box,n={left:this._Visible?e.offsetLeft:this.x,top:this._Visible?e.offsetTop:this.y};return n},t.prototype.setPos=function(e){},t.prototype.setDisplayPositioning=function(){var e=this._Box.style;this.vkbd&&(e.position="fixed",e.left=e.bottom="0px",e.border="none",e.borderTop="1px solid gray")},t.prototype.present=function(){i.prototype.present.call(this),this.legacyEvents.callEvent("show",{})},t}(Je),hn=zl;var Kl=function(i){(0,d.__extends)(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.flag=!0,e}return Object.defineProperty(t.prototype,"enabled",{get:function(){return this.flag},set:function(e){this.activate=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activate",{get:function(){return this.flag},set:function(e){this.flag!=e&&(this.flag=e,this.emit("activate",e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"conditionsMet",{get:function(){return!0},enumerable:!1,configurable:!0}),t}(qe),Un=Kl;var _l=function(i){(0,d.__extends)(t,i);function t(e){var n=this;return e.activator=e.activator||new Un,n=i.call(this,e)||this,n.restorePosition=function(c){}.bind(n),n}return Object.defineProperty(t.prototype,"element",{get:function(){return this._Box},enumerable:!1,configurable:!0}),t.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},t.prototype.setBoxStyling=function(){var e=this._Box.style;e.display="none",e.position="relative"},t.prototype.postKeyboardAdjustments=function(){},t.prototype.getDefaultKeyboardHeight=function(){return this.keyboardView instanceof Qe?this.keyboardView.height:this.computedHeight},t.prototype.getDefaultWidth=function(){return this.computedWidth},t.prototype.setRect=function(e){},t.prototype.getPos=function(){var e=this._Box,n={left:this._Visible?e.offsetLeft:void 0,top:this._Visible?e.offsetTop:void 0};return n},t.prototype.setPos=function(e){},t.prototype.present=function(){i.prototype.present.call(this),this.legacyEvents.callEvent("show",{})},t.prototype.setDisplayPositioning=function(){},t.prototype.allowsDeviceChange=function(e){return!0},t}(Je),xn=_l;var pn={};kn(pn,{AnchoredOSKView:function(){return Gn},FloatingOSKView:function(){return Xn},InlinedOSKView:function(){return Pl}});function Vn(i){return{hostDevice:i.config.hostDevice,pathConfig:i.config.paths,predictionContextManager:i.contextManager.predictionContext,isEmbedded:!1}}var Gn=function(i){(0,d.__extends)(t,i);function t(e,n){var c=(0,d.__assign)((0,d.__assign)({},Vn(e)),n||{});return i.call(this,c)||this}return t}(hn),Xn=function(i){(0,d.__extends)(t,i);function t(e,n){var c=(0,d.__assign)((0,d.__assign)({},Vn(e)),n||{});return i.call(this,c)||this}return t}(We),Pl=function(i){(0,d.__extends)(t,i);function t(e,n){var c=(0,d.__assign)((0,d.__assign)({},Vn(e)),n||{});return i.call(this,c)||this}return t}(xn);var zc=v(A(),1),jl=function(i){(0,d.__extends)(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.events=new zc.default,e.changed=!1,e}return t.prototype.focus=function(){var e=this.getElement();e.focus&&e.focus()},t.prototype.isForcingScroll=function(){return!1},t.prototype.dispatchInputEventOn=function(e){var n;window.InputEvent&&(n=new InputEvent("input",{bubbles:!0,cancelable:!1})),e&&n&&e.dispatchEvent(n)},t}(wt),_=jl;var ql=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.root=e,n._cachedSelectionStart=-1,n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getElement=function(){return this.root},t.prototype.clearSelection=function(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)},t.prototype.isSelectionEmpty=function(){return this.root.selectionStart==this.root.selectionEnd},t.prototype.hasSelection=function(){return!0},t.prototype.invalidateSelection=function(){this._cachedSelectionStart=-1},t.prototype.getCaret=function(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart},t.prototype.getDeadkeyCaret=function(){return this.getCaret()},t.prototype.setCaret=function(e){this.setSelection(e,e,"none")},t.prototype.setSelection=function(e,n,c){var l=this.root.value._kmwCodePointToCodeUnit(e),r=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(l,r,c),this.processedSelectionStart=e,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(l,r,c)},t.prototype.forceScroll=function(){var e=this.getElement(),n=e.selectionStart,c=e.selectionEnd;this._activeForcedScroll=!0;try{e.blur(),e.focus()}finally{e.selectionStart=n,e.selectionEnd=c,this._activeForcedScroll=!1}},t.prototype.isForcingScroll=function(){return this._activeForcedScroll},t.prototype.getSelectionDirection=function(){return this.root.selectionDirection},t.prototype.getTextBeforeCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)},t.prototype.getSelectedText=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)},t.prototype.setTextBeforeCaret=function(e){this.getCaret();var n=this.processedSelectionEnd-this.processedSelectionStart,c=this.getSelectionDirection(),l=e._kmwLength();this.root.value=e+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(l,l+n,c)},t.prototype.setTextAfterCaret=function(e){var n=this.getCaret(),c=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+e,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,c)},t.prototype.getTextAfterCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)},t.prototype.getText=function(){return this.root.value},t.prototype.deleteCharsBeforeCaret=function(e){if(e>0){var n=this.getTextBeforeCaret(),c=this.processedSelectionStart;e>c&&(e=c),this.adjustDeadkeys(-e),this.setTextBeforeCaret(n.kmwSubstring(0,c-e)),this.setCaret(c-e)}},t.prototype.insertTextBeforeCaret=function(e){if(!!e){var n=this.getCaret(),c=this.getTextBeforeCaret(),l=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(e._kmwLength()),this.root.value=c+e+l,this.setCaret(n+e._kmwLength())}},t.prototype.handleNewlineAtCaret=function(){var e=this.root;e&&(e.type=="search"||e.type=="submit")?(e.disabled=!1,e.form.submit()):this.events.emit("unhandlednewline",e)},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(_),mn=ql;var $l=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.root=e,n._cachedSelectionStart=-1,n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getElement=function(){return this.root},t.prototype.clearSelection=function(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)},t.prototype.isSelectionEmpty=function(){return this.root.selectionStart==this.root.selectionEnd},t.prototype.hasSelection=function(){return!0},t.prototype.invalidateSelection=function(){this._cachedSelectionStart=-1},t.prototype.getCaret=function(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart},t.prototype.getDeadkeyCaret=function(){return this.getCaret()},t.prototype.setCaret=function(e){this.setSelection(e,e,"none")},t.prototype.setSelection=function(e,n,c){var l=this.root.value._kmwCodePointToCodeUnit(e),r=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(l,r,c),this.processedSelectionStart=e,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(l,r,c)},t.prototype.forceScroll=function(){var e=this.getElement(),n=e.selectionStart,c=e.selectionEnd;this._activeForcedScroll=!0;try{e.blur(),e.focus()}finally{e.selectionStart=n,e.selectionEnd=c,this._activeForcedScroll=!1}},t.prototype.isForcingScroll=function(){return this._activeForcedScroll},t.prototype.getSelectionDirection=function(){return this.root.selectionDirection},t.prototype.getTextBeforeCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)},t.prototype.setTextBeforeCaret=function(e){this.getCaret();var n=this.processedSelectionEnd-this.processedSelectionStart,c=this.getSelectionDirection(),l=e._kmwLength();this.root.value=e+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(l,l+n,c)},t.prototype.setTextAfterCaret=function(e){var n=this.getCaret(),c=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+e,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,c)},t.prototype.getTextAfterCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)},t.prototype.getSelectedText=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)},t.prototype.getText=function(){return this.root.value},t.prototype.deleteCharsBeforeCaret=function(e){if(e>0){var n=this.getTextBeforeCaret(),c=this.processedSelectionStart;e>c&&(e=c),this.adjustDeadkeys(-e),this.setTextBeforeCaret(n.kmwSubstring(0,c-e)),this.setCaret(c-e)}},t.prototype.insertTextBeforeCaret=function(e){if(!!e){var n=this.getCaret(),c=this.getTextBeforeCaret(),l=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(e._kmwLength()),this.root.value=c+e+l,this.setCaret(n+e._kmwLength())}},t.prototype.handleNewlineAtCaret=function(){this.insertTextBeforeCaret("\n")},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(_),Zn=$l;var Ln=function(){function i(t,e){this.node=t,this.offset=e}return i}(),Jn=function(){function i(t,e){this.start=t,this.end=e}return i}(),Be=function(){function i(t,e){this.cmd=t,this.stateType=e}return i}(),er=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;if(n.root=e,e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.designMode=="on")n.doc=e.contentWindow.document,n.docRoot=e.contentWindow.document.documentElement;else throw"Specified IFrame is not in design-mode!";return n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getElement=function(){return this.root},t.prototype.focus=function(){this.doc.defaultView.focus()},t.prototype.isSelectionEmpty=function(){return this.hasSelection()?this.doc.getSelection().isCollapsed:!0},t.prototype.hasSelection=function(){var e=this.doc.getSelection(),n=document.getSelection();return n.anchorNode==e.anchorNode&&n.focusNode==e.focusNode,!0},t.prototype.clearSelection=function(){if(this.hasSelection()){var e=this.doc.getSelection();e.isCollapsed||e.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")},t.prototype.invalidateSelection=function(){},t.prototype.getCarets=function(){var e=this.doc.getSelection(),n=e.anchorNode.compareDocumentPosition(e.focusNode);if(e.isCollapsed){var c=new Ln(e.anchorNode,e.anchorOffset);return new Jn(c,c)}else{var l=new Ln(e.anchorNode,e.anchorOffset),r=new Ln(e.focusNode,e.focusOffset);return l.node==r.node&&(n=r.offset-l.offset>0?2:4),n&2?new Jn(l,r):new Jn(r,l)}},t.prototype.getDeadkeyCaret=function(){return this.getTextBeforeCaret().kmwLength()},t.prototype.getTextBeforeCaret=function(){if(!this.hasSelection())return this.getText();var e=this.getCarets().start;return e.node.nodeType!=3?"":e.node.textContent.substr(0,e.offset)},t.prototype.getSelectedText=function(){return""},t.prototype.getTextAfterCaret=function(){if(!this.hasSelection())return"";var e=this.getCarets().end;return e.node.nodeType!=3?"":e.node.textContent.substr(e.offset)},t.prototype.getText=function(){return this.docRoot.innerText},t.prototype.deleteCharsBeforeCaret=function(e){if(!(!this.hasSelection()||e<=0)){var n=this.getCarets().start;if(e>n.offset&&(e=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}var c=this.doc.createRange(),l=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-e).length;c.setStart(n.node,l),c.setEnd(n.node,n.offset),this.adjustDeadkeys(-e),c.deleteContents()}},t.prototype.insertTextBeforeCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().start,c=e._kmwLength(),l=this.doc.getSelection();if(c!=0){this.adjustDeadkeys(c);var r=this.root.ownerDocument.createRange();if(n.node.nodeType==3){var s=n.node;s.insertData(n.offset,e),r.setStart(s,n.offset+e.length)}else{var B=this.doc.createTextNode(e),o=this.doc.createRange();o.setStart(n.node,n.offset),o.collapse(!0),o.insertNode(B),r.setStart(B,e.length)}r.collapse(!0),l.removeAllRanges();try{l.addRange(r)}catch(g){n.node.parentElement.scrollIntoView(),l.addRange(r)}l.collapseToEnd()}}},t.prototype.handleNewlineAtCaret=function(){},t.prototype.setTextAfterCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().end,c=e._kmwLength(),l=this.doc.getSelection();if(c!=0)if(n.node.nodeType==3){var r=n.node;r.replaceData(n.offset,r.length,e)}else{var s=n.node.ownerDocument.createTextNode(e),B=this.root.ownerDocument.createRange();B.setStart(n.node,n.offset),B.collapse(!0),B.insertNode(s)}}},t.prototype.saveProperties=function(){var e=[new Be("backcolor",1),new Be("fontname",1),new Be("fontsize",1),new Be("forecolor",1),new Be("bold",0),new Be("italic",0),new Be("strikethrough",0),new Be("subscript",0),new Be("superscript",0),new Be("underline",0)];this.doc.defaultView&&e.push(new Be("hilitecolor",1));for(var n=0;n<e.length;n++){var c=e[n];c.stateType==1?c.cache=this.doc.queryCommandValue(c.cmd):c.cache=this.doc.queryCommandState(c.cmd)}this.commandCache=e},t.prototype.restoreProperties=function(e){this.commandCache||console.error("No command cache exists to restore!");for(var n=0;n<this.commandCache.length;n++){var c=this.commandCache[n];c.stateType==1?this.doc.queryCommandValue(c.cmd)!=c.cache&&(e&&e(),this.doc.execCommand(c.cmd,!1,c.cache)):this.doc.queryCommandState(c.cmd)!=c.cache&&(e&&e(),this.doc.execCommand(c.cmd,!1,null))}},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(_),ne=er;var vn=function(){function i(t,e){this.node=t,this.offset=e}return i}(),Rn=function(){function i(t,e){this.start=t,this.end=e}return i}(),tr=function(i){(0,d.__extends)(t,i);function t(e){var n=this;if(e.isContentEditable)n=i.call(this)||this,n.root=e;else throw"Specified element is not already content-editable!";return n}return Object.defineProperty(t.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getElement=function(){return this.root},t.prototype.isSelectionEmpty=function(){return this.hasSelection()?this.root.ownerDocument.getSelection().isCollapsed:!0},t.prototype.hasSelection=function(){var e=this.root.ownerDocument.getSelection();return!(this.root!=e.anchorNode&&!this.root.contains(e.anchorNode)||this.root!=e.focusNode&&!this.root.contains(e.focusNode))},t.prototype.clearSelection=function(){if(this.hasSelection()){var e=this.root.ownerDocument.getSelection();e.isCollapsed||e.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")},t.prototype.invalidateSelection=function(){},t.prototype.getCarets=function(){var e=this.root.ownerDocument.getSelection(),n=e.anchorNode.compareDocumentPosition(e.focusNode);if(e.isCollapsed){var c=new vn(e.anchorNode,e.anchorOffset);return new Rn(c,c)}else{var l=new vn(e.anchorNode,e.anchorOffset),r=new vn(e.focusNode,e.focusOffset);return l.node==r.node&&(n=r.offset-l.offset>0?2:4),n&2?new Rn(l,r):new Rn(r,l)}},t.prototype.getDeadkeyCaret=function(){return this.getTextBeforeCaret().kmwLength()},t.prototype.getTextBeforeCaret=function(){if(!this.hasSelection())return this.getText();var e=this.getCarets().start;return e.node.nodeType!=3?"":e.node.textContent.substr(0,e.offset)},t.prototype.getSelectedText=function(){return""},t.prototype.getTextAfterCaret=function(){if(!this.hasSelection())return"";var e=this.getCarets().end;return e.node.nodeType!=3?"":e.node.textContent.substr(e.offset)},t.prototype.getText=function(){return this.root.innerText},t.prototype.deleteCharsBeforeCaret=function(e){if(!(!this.hasSelection()||e<=0)){var n=this.getCarets().start;if(e>n.offset&&(e=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}var c=this.root.ownerDocument.createRange(),l=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-e).length;c.setStart(n.node,l),c.setEnd(n.node,n.offset),this.adjustDeadkeys(-e),c.deleteContents()}},t.prototype.insertTextBeforeCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().start,c=e._kmwLength(),l=this.root.ownerDocument.getSelection();if(c!=0){this.adjustDeadkeys(c);var r=this.root.ownerDocument.createRange();if(n.node.nodeType==3){var s=n.node;s.insertData(n.offset,e),r.setStart(s,n.offset+e.length)}else{var B=n.node.ownerDocument.createTextNode(e),o=this.root.ownerDocument.createRange();o.setStart(n.node,n.offset),o.collapse(!0),o.insertNode(B),r.setStart(B,e.length)}r.collapse(!0),l.removeAllRanges();try{l.addRange(r)}catch(g){n.node.parentElement.scrollIntoView(),l.addRange(r)}l.collapseToEnd()}}},t.prototype.handleNewlineAtCaret=function(){},t.prototype.setTextAfterCaret=function(e){if(!!this.hasSelection()){var n=this.getCarets().end,c=e._kmwLength(),l=this.root.ownerDocument.getSelection();if(c!=0)if(n.node.nodeType==3){var r=n.node;r.replaceData(n.offset,r.length,e)}else{var s=n.node.ownerDocument.createTextNode(e),B=this.root.ownerDocument.createRange();B.setStart(n.node,n.offset),B.collapse(!0),B.insertNode(s)}}},t.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},t}(_),Xt=tr;function N(i,t){var e;if(!i)return!1;if(i.Window)return t=="Window";if(i.defaultView)e=i.defaultView[t];else if(i.ownerDocument)e=i.ownerDocument.defaultView[t];else if(i.target){var n=i;this.instanceof(n.target,"Window")?e=n.target[t]:this.instanceof(n.target,"Document")?e=n.target.defaultView[t]:this.instanceof(n.target,"HTMLElement")&&(e=n.target.ownerDocument.defaultView[t])}return e?i instanceof e:!1}function pt(i){if(N(i,"HTMLInputElement"))return new mn(i);if(N(i,"HTMLTextAreaElement"))return new Zn(i);if(N(i,"HTMLIFrameElement")){var t=i;return t.contentWindow&&t.contentWindow.document&&t.contentWindow.document.designMode=="on"?new ne(t):i.isContentEditable?new Xt(i):null}else if(i.isContentEditable)return new Xt(i);return null}var Ne=function(){function i(){var t=this;this.pending=!1;var e=this.bg=document.createElement("div"),n=this.lb=document.createElement("div"),c=this.lt=document.createElement("div"),l=this.gr=document.createElement("div"),r=this.bx=document.createElement("div");e.className="kmw-wait-background",n.className="kmw-wait-box",this.dismiss=null,c.className="kmw-wait-text",l.className="kmw-wait-graphic",r.className="kmw-alert-close",n.onmousedown=n.onclick=function(s){r.style.display=="block"&&(e.style.display="none",t.dismiss&&t.dismiss())},n.addEventListener("touchstart",n.onclick,!1),e.onmousedown=e.onclick=function(s){s.preventDefault(),s.stopPropagation()},e.addEventListener("touchstart",e.onclick,!1),n.appendChild(r),n.appendChild(c),n.appendChild(l),e.appendChild(n),document.body.appendChild(e)}return Object.defineProperty(i.prototype,"rootElement",{get:function(){return this.bg},enumerable:!1,configurable:!0}),i.prototype.wait=function(t){var e=this,n=this.bg;typeof n=="undefined"||n==null||(t?(this.pending=!0,window.setTimeout(function(){e.pending&&(window.scrollTo(0,0),e.bx.style.display="none",e.lt.className="kmw-wait-text",e.lt.innerHTML=t,e.gr.style.display="block",n.style.display="block")},1e3)):this.pending&&(this.lt.innerHTML="",this.pending=!1,n.style.display="none"))},i.prototype.alert=function(t,e){var n=this.bg;this.bx.style.display="block",this.lt.className="kmw-alert-text",this.lt.innerHTML=t,this.gr.style.display="none",n.style.display="block",this.dismiss=arguments.length>1?e:null},i.prototype.shutdown=function(){this.bg.parentNode.removeChild(this.bg)},i}();function tt(){return document.readyState==="complete"?Promise.resolve():new Promise(function(i,t){var e=function(){window.removeEventListener("load",e),i()};window.addEventListener("load",e)})}var Kc=function(i){(0,d.__extends)(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.initialize=function(e){var n=this;this._options?this._options=(0,d.__assign)((0,d.__assign)({},this._options),e):this._options=(0,d.__assign)({},e),i.prototype.initialize.call(this,e),this._options=e,this._ui=e.ui,this._attachType=e.attachType,tt().then(function(){var c;e.useAlerts&&!n.alertHost?n._alertHost=new Ne:!e.useAlerts&&n.alertHost&&((c=n._alertHost)===null||c===void 0||c.shutdown(),n._alertHost=null)})},Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attachType",{get:function(){return this._attachType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alertHost",{get:function(){return this._alertHost},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"signalUser",{set:function(e){(!e||e!=this.alertHost)&&this.alertHost.shutdown(),this._alertHost=e},enumerable:!1,configurable:!0}),t.prototype.debugReport=function(){var e=i.prototype.debugReport.call(this);return e.attachType=this.attachType,e.ui=this._ui,e.keymanEngine="app/browser",e},t.prototype.onRuleFinalization=function(e,n){var c=e.transcription.transform;ot(c)||n instanceof _&&(n.changed=!0)},t}(zt);var _c=(0,d.__assign)({ui:"",attachType:"",useAlerts:!0},Kt);var An=function(){function i(t,e,n){this.interface=t,this.keyboard=e}return i}();function Ce(i){var t=i==null?void 0:i.target;return be(t)}function be(i){if(i==null)return null;if(i.body&&(i=i.body),i.nodeType==3&&(i=i.parentNode),N(i,"HTMLInputElement")){var t=i.type.toLowerCase();if(!(t=="text"||t=="search"))return null}return i._kmwAttachment.interface}var Pc=v(A(),1);var fn=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this;if(!e)throw new Error("Cannot attach to a null/undefined document");return c=i.call(this)||this,c.baseFont="",c.appliedFont="",c.embeddedPageContexts=[],c._inputList=[],c._sortedInputs=[],c._InputModeObserverCore=function(l){c.disableInputModeObserver();try{for(var r=0,s=l;r<s.length;r++){var B=s[r],o=B.target;!c.isAttached(o)||(o._kmwAttachment.inputMode=o.inputMode,c.device.touchable&&(o.inputMode="none"))}}finally{c.enableInputModeObserver()}},c._EnablementMutationObserverCore=function(l){for(var r=0;r<l.length;r++){var s=l[r],B=s.oldValue?s.oldValue.indexOf("kmw-disabled")>=0:!1,o=s.target.className.indexOf("kmw-disabled")>=0;if(B&&!o?c._EnableControl(s.target):!B&&o&&c._DisableControl(s.target),!o&&s.attributeName=="readonly"){var g=s.oldValue?s.oldValue!=null:!1,a=s.target;if(a instanceof a.ownerDocument.defaultView.HTMLInputElement||a instanceof a.ownerDocument.defaultView.HTMLTextAreaElement){var F=a.readOnly;g&&!F?c._EnableControl(s.target):!g&&F&&c._DisableControl(s.target)}}}},c._AutoAttachObserverCore=function(l){for(var r=[],s=[],B=0;B<l.length;B++){for(var o=l[B],g=0;g<o.addedNodes.length;g++)r=r.concat(c._GetDocumentEditables(o.addedNodes[g]));for(g=0;g<o.removedNodes.length;g++)s=s.concat(c._GetDocumentEditables(o.removedNodes[g]))}for(var a=0;a<r.length;a++)c.isKMWInput(r[a])&&c._MutationAdditionObserved(r[a]);for(a=0;a<s.length;a++){var F=!1,y=s[a];if(y instanceof y.ownerDocument.defaultView.HTMLIFrameElement){for(var u=0;u<c.embeddedPageContexts.length;u++)if(c.embeddedPageContexts[u].options.owner==y){c.embeddedPageContexts[u].shutdown(),c.embeddedPageContexts.splice(u,1),F=!0;break}if(!F){for(var Q=0;Q<c._inputList.length;Q++)if(c._inputList[Q]==y){c.detachFromControl(y),c._inputList[Q]==y&&c._inputList.splice(Q,1);break}}}else c.isKMWInput(y)&&c._MutationRemovalObserved(y)}(r.length||s.length)&&(c.device.touchable?c.device.touchable&&window.setTimeout(function(){c.listInputs()},1):c.listInputs())},c._MutationAdditionObserved=function(l){if(l instanceof l.ownerDocument.defaultView.HTMLIFrameElement){var r=function(){window.setTimeout(function(){c.attachToControl(l)},1)};l.addEventListener("load",r)}else c.attachToControl(l)},c._MutationRemovalObserved=function(l){c.detachFromControl(l)},c.options=n,c.document=e,c.stylesheetManager=new Fe(c.document.body),c}return Object.defineProperty(t.prototype,"device",{get:function(){return this.options.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return this.document.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"inputList",{get:function(){var e=this.embeddedPageContexts.map(function(n){return n.inputList}).reduce(function(n,c){return n.concat(c)},[]);return[].concat(this._inputList).concat(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sortedInputs",{get:function(){return this._sortedInputs},enumerable:!1,configurable:!0}),t.prototype.install=function(e){this.manualAttach=e,this.baseFont=this.getBaseFont(),this.manualAttach||(this._SetupDocument(this.document.documentElement),this.listInputs()),this.options.owner||this.initMutationObservers(this.document,e)},t.prototype.setupElementAttachment=function(e){if(!e._kmwAttachment){var n=pt(e);n||N(e,"HTMLIFrameElement")||console.warn("Could not create processing interface for newly-attached element!"),e._kmwAttachment=new An(n,null,this.device.touchable)}},t.prototype.clearElementAttachment=function(e){e._kmwAttachment=null},t.prototype.isKMWInput=function(e){if(e instanceof e.ownerDocument.defaultView.HTMLTextAreaElement)return!0;if(e instanceof e.ownerDocument.defaultView.HTMLInputElement){if(e.type=="text"||e.type=="search")return!0}else if(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)try{if(e.contentWindow){var n=e.contentWindow.document;if(n)return!(this.device.touchable&&n.designMode.toLowerCase()=="on")}else return!!e._kmwAttachment}catch(c){console.warn("Error during attachment to / detachment from iframe: "),console.warn(c)}else if(e.isContentEditable)return!0;return!1},t.prototype.isAttached=function(e){if(e._kmwAttachment)return!0;if(N(e,"HTMLIFrameElement")){var n=e;if(n.contentDocument==this.document)return!0;for(var c=0,l=this.embeddedPageContexts;c<l.length;c++){var r=l[c];if(r.isAttached(e))return!0}}return!1},t.prototype.isKMWDisabled=function(e){var n=e.className;return e.readOnly?!0:!!(n&&n.indexOf("kmw-disabled")>=0)},t.prototype.enableInputElement=function(e){var n;this.isKMWDisabled(e)||(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement?this._AttachToIframe(e):(this.setupElementAttachment(e),e._kmwAttachment.inputMode=(n=e.inputMode)!==null&&n!==void 0?n:"text",this.disableInputModeObserver(),e.inputMode="none",this.enableInputModeObserver(),e.classList.add("keymanweb-font"),this._inputList.push(e),this.emit("enabled",e)))},t.prototype.disableInputElement=function(e){var n;if(!!e)if(e.ownerDocument.defaultView&&e instanceof e.ownerDocument.defaultView.HTMLIFrameElement||e instanceof HTMLIFrameElement)this._DetachFromIframe(e);else{if(this.isAttached(e)){var c=(n=e._kmwAttachment)===null||n===void 0?void 0:n.inputMode;this.disableInputModeObserver(),e.inputMode=c,this.enableInputModeObserver()}var l=e.className.indexOf("keymanweb-font");l>=0&&(e.className=e.className.replace("keymanweb-font","").trim());var r=this.inputList.indexOf(e);r>-1&&this._inputList.splice(r,1),this.emit("disabled",e)}},t.prototype.enableTouchElement=function(e){return this.isKMWDisabled(e)?(this.emit("disabled",e),!1):(this.isAttached(e)||this.setupElementAttachment(e),this.enableInputElement(e),!0)},t.prototype.disableTouchElement=function(e){if(this.isAttached(e)){var n=e._kmwAttachment.inputMode;this.disableInputModeObserver(),e.inputMode=n,this.enableInputModeObserver()}},t.prototype._AttachToIframe=function(e){var n=this;try{var c=e.contentWindow.document;if(c){if(c.designMode.toLowerCase()=="on")this.setupElementAttachment(e),c.body._kmwAttachment=e._kmwAttachment,this._inputList.push(e),this.emit("enabled",e);else if(this.embeddedPageContexts.filter(function(r){return r.document==c}).length==0){var l=new t(c,(0,d.__assign)((0,d.__assign)({},this.options),{owner:e}));this.embeddedPageContexts.push(l),l.on("enabled",function(r){return n.emit("enabled",r)}),l.on("disabled",function(r){return n.emit("disabled",r)}),l.install(this.manualAttach)}}}catch(r){}},t.prototype._DetachFromIframe=function(e){var n=this,c=function(){n.clearElementAttachment(e);var B=n._inputList.indexOf(e);B!=-1&&n._inputList.splice(B,1),n.emit("disabled",e)};try{var l=e.contentWindow.document;if(l){if(l.designMode.toLowerCase()=="on")l.body._kmwAttachment=null,c();else for(var r=0;r<this.embeddedPageContexts.length;r++)if(this.embeddedPageContexts[r].document==l){var s=this.embeddedPageContexts.splice(r,1)[0];s._ClearDocument(l.body),s.shutdown(),this.embeddedPageContexts.splice(r,1);break}}}catch(B){e._kmwAttachment&&c()}},t.prototype.attachToControl=function(e){var n=this.device.touchable;this.isAttached(e)&&!(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(e)?this.isKMWDisabled(e)?this.emit("disabled",e):n?this.enableTouchElement(e):this.enableInputElement(e):n&&this.emit("disabled",e))},t.prototype.detachFromControl=function(e){!(this.isAttached(e)||e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(e)&&(this.isKMWDisabled(e)||this._DisableControl(e)),this.clearElementAttachment(e))},t.prototype._DisableControl=function(e){(this.isAttached(e)||e instanceof e.ownerDocument.defaultView.HTMLIFrameElement)&&(this.device.touchable&&this.disableTouchElement(e),this.listInputs(),this.disableInputElement(e))},t.prototype._EnableControl=function(e){this.isAttached(e)?(this.device.touchable?this.enableTouchElement(e):this.enableInputElement(e),this.listInputs()):N(e,"HTMLIFrameElement")&&this._AttachToIframe(e)},t.prototype.disableControl=function(e){this.isAttached(e)||console.warn("KeymanWeb is not attached to element "+e);var n=e.className;n.indexOf("kmw-disabled")<0&&(e.className=n?n+" kmw-disabled":"kmw-disabled")},t.prototype.enableControl=function(e){!this.isAttached(e)&&!N(e,"HTMLIFrameElement")&&console.warn("KeymanWeb is not attached to element "+e);var n=e.className,c=n.indexOf("kmw-disabled");c>=0&&(e.className=n.replace("kmw-disabled","").trim())},t.prototype.listInputs=function(){for(var e=[],n=document.getElementsByTagName("input"),c=document.getElementsByTagName("textarea"),l=0;l<n.length;l++)switch(n[l].type){case"text":case"search":case"email":case"url":n[l].className.indexOf("kmw-disabled")<0&&e.push({ip:n[l],x:J(n[l]),y:Z(n[l])});break}for(var l=0;l<c.length;l++)c[l].className.indexOf("kmw-disabled")<0&&e.push({ip:c[l],x:J(c[l]),y:Z(c[l])});e.sort(function(s,B){return s.y!=B.y?s.y-B.y:s.x-B.x});for(var r=[],l=0;l<e.length;l++)r.push(e[l].ip);this._sortedInputs=r},t.prototype.findNeighboringInput=function(e,n){var c,l=this.sortedInputs;if(l.length==0)return null;for(c=0;c<l.length&&l[c]!=e;c++);return c==l.length&&!n&&c--,c=n?c-1:c+1,c=c>=l.length?c-l.length:c,c=c<0?c+l.length:c,l[c]},t.prototype._GetDocumentEditables=function(e){var n=[];if(e.ownerDocument&&e instanceof e.ownerDocument.defaultView.HTMLElement){var c=e.ownerDocument.defaultView;(e instanceof c.HTMLInputElement||e instanceof c.HTMLTextAreaElement||e instanceof c.HTMLIFrameElement)&&n.push(e)}if(e.getElementsByTagName){var l=function(r){return dt(e.getElementsByTagName(r))};n=n.concat(l("INPUT"),l("TEXTAREA"),l("IFRAME"))}return e.querySelectorAll&&(n=n.concat(dt(e.querySelectorAll("[contenteditable]")))),e.ownerDocument&&e instanceof e.ownerDocument.defaultView.HTMLElement&&e.isContentEditable&&n.push(e),n},t.prototype._SetupDocument=function(e){for(var n=this._GetDocumentEditables(e),c=0;c<n.length;c++)this.attachToControl(n[c])},t.prototype._ClearDocument=function(e){for(var n=this._GetDocumentEditables(e),c=0;c<n.length;c++)this.detachFromControl(n[c])},t.prototype.initMutationObservers=function(e,n){if(typeof MutationObserver=="function"){var c=e.querySelector("body"),l;n||(l={childList:!0,subtree:!0},this.attachmentObserver=new MutationObserver(this._AutoAttachObserverCore),this.attachmentObserver.observe(c,l)),l={subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["class","readonly"]},this.enablementObserver=new MutationObserver(this._EnablementMutationObserverCore),this.enablementObserver.observe(c,l),this.inputModeObserver=new MutationObserver(this._InputModeObserverCore),this.enableInputModeObserver()}else console.warn("Your browser is outdated and does not support MutationObservers, a web feature needed by KeymanWeb to support dynamically-added elements.")},t.prototype.enableInputModeObserver=function(){var e,n=document.querySelector("body"),c={subtree:!0,attributes:!0,attributeFilter:["inputmode"]};(e=this.inputModeObserver)===null||e===void 0||e.observe(n,c)},t.prototype.disableInputModeObserver=function(){var e;(e=this.inputModeObserver)===null||e===void 0||e.disconnect()},t.prototype.getBaseFont=function(){var e=document.getElementsByTagName("input"),n=document.getElementsByTagName("textarea"),c=0,l,r="Arial,sans-serif";if(e.length==0&&n.length==0)c=0;else if(e.length>0&&n.length==0)c=1;else if(e.length==0&&n.length>0)c=2;else{var s=e[0],B=n[0];s.offsetTop<B.offsetTop?c=1:s.offsetTop>B.offsetTop?c=2:s.offsetLeft<B.offsetLeft?c=1:s.offsetLeft>B.offsetLeft&&(c=2)}switch(c){case 0:l=r;break;case 1:l=getComputedStyle(e[0]).fontFamily||"";break;case 2:l=getComputedStyle(n[0]).fontFamily||"";break}return(typeof l=="undefined"||l=="monospace")&&(l=r),l},t.prototype.buildAttachmentFontStyle=function(e){var n=e,c=this.baseFont;n&&typeof n.family!="undefined"&&(c=n.family),c=c.replace(/\u0022/g,"");var l=new RegExp("\\s?"+c+",?"),r=this.appliedFont.replace(/\u0022/g,"");r=r.replace(l,""),r=r.replace(/,$/,""),r==""?r=c:r=c+","+r,r='"'+r.replace(/\,\s?/g,'","')+'"';var s=".keymanweb-font{\nfont-family:"+r+" !important;\n}\n";return this.appliedFont=r,s},t.prototype.setAttachmentFont=function(e,n,c){this.stylesheetManager.unlinkAll(),this.stylesheetManager.addStyleSheetForFont(e,n,c),this.stylesheetManager.linkStylesheet(xe(this.buildAttachmentFontStyle(e)))},t.prototype.shutdown=function(){var e,n,c,l;try{(e=this.enablementObserver)===null||e===void 0||e.disconnect(),(n=this.attachmentObserver)===null||n===void 0||n.disconnect(),(c=this.inputModeObserver)===null||c===void 0||c.disconnect(),(l=this.stylesheetManager)===null||l===void 0||l.unlinkAll(),this.inputModeObserver=null,this.embeddedPageContexts.forEach(function(o){try{o.shutdown()}catch(g){}});for(var r=0,s=this.inputList;r<s.length;r++){var B=s[r];try{this.detachFromControl(B)}catch(o){this.emit("disabled",B)}}this._inputList=[]}catch(o){console.error("Error occurred during shutdown"),console.error(o)}},t}(Pc.default);var jc=v(A(),1),nr=function(){function i(t,e){this.activationPending=t,this.activated=e}return i}();var qc=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n._maintainingFocus=!1,n.restoringFocus=!1,n._IgnoreNextSelChange=0,n.isTargetForcingScroll=e,n}return Object.defineProperty(t.prototype,"maintainingFocus",{get:function(){return this._maintainingFocus},set:function(e){var n=this._maintainingFocus;this._maintainingFocus=e,n&&!e&&this.emit("maintainingfocusend")},enumerable:!1,configurable:!0}),t.prototype.getUIState=function(){return new nr(this.maintainingFocus,this.restoringFocus)},t.prototype.setMaintainingFocus=function(e){this.maintainingFocus=!!e},t.prototype.setFocusTimer=function(){this.focusing=!0,this.focusTimer=window.setTimeout(function(){this.focusing=!1}.bind(this),50)},t}(jc.default);function $c(i,t){var e=t!=null&&t.isRTL?"rtl":"ltr";i&&(i instanceof i.ownerDocument.defaultView.HTMLInputElement||i instanceof i.ownerDocument.defaultView.HTMLTextAreaElement?i.value.length==0&&(i.dir=e):typeof i.textContent=="string"&&i.textContent.length==0&&(i.dir=e))}var cr=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e)||this;return c.cookieManager=new se("KeymanWeb_Keyboard"),c.focusAssistant=new qc(function(){var l;return(l=c.activeTarget)===null||l===void 0?void 0:l.isForcingScroll()}),c.domEventTracker=new ue,c._ControlFocus=function(l){var r=Ce(l);return r&&c.setActiveTarget(r,!0),!0},c._ControlBlur=function(l){if(c.focusAssistant._IgnoreNextSelChange)return c.focusAssistant._IgnoreNextSelChange--,l.cancelBubble=!0,l.stopPropagation(),!0;if(c.focusAssistant.isTargetForcingScroll())return l.cancelBubble=!0,l.stopPropagation(),!0;var r=Ce(l);if(r==null)return!0;c.lastActiveTarget&&c._BlurKeyboardSettings(c.lastActiveTarget.getElement());var s=c.activeTarget;c.currentTarget=null,(s||c.lastActiveTarget)&&(c.mostRecentTarget=r),c.focusAssistant.restoringFocus=!1;var B=c.activeKeyboard,o=c.focusAssistant.maintainingFocus;return!o&&B&&B.keyboard.notify(0,r,0),s&&!c.activeTarget&&c.emit("targetchange",null),c.apiEvents.callEvent("controlblurred",{target:r.getElement(),event:l,isActivating:o}),c.doChangeEvent(r),c.resetContext(),!0},c._Click=function(l){return c.resetContext(),!0},c.nonKMWTouchHandler=function(l){c.focusAssistant.focusing=!1,clearTimeout(c.focusAssistant.focusTimer),c.forgetActiveTarget()},c._eventsObj=n,c.page=new fn(window.document,{hostDevice:c.engineConfig.hostDevice}),c.focusAssistant.on("maintainingfocusend",function(){!c.activeTarget&&c.mostRecentTarget&&c.emit("targetchange",c.activeTarget)}),c}return Object.defineProperty(t.prototype,"apiEvents",{get:function(){return this._eventsObj()},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){var e=this;this.on("keyboardasyncload",function(n,c){var l;(l=e.engineConfig.alertHost)===null||l===void 0||l.wait("Installing keyboard<br/>"+n.name),c.then(function(){var r;(r=e.engineConfig.alertHost)===null||r===void 0||r.wait()})}),this.engineConfig.deferForInitialization.then(function(){var n=e.engineConfig.hostDevice,c=function(l){return l.stopPropagation()};e.page.on("enabled",function(l){if(!(l._kmwAttachment.interface instanceof ne))n.touchable&&(e.domEventTracker.detachDOMEvent(l,"touchstart",e.nonKMWTouchHandler),e.domEventTracker.attachDOMEvent(l,"touchmove",c,!1),e.domEventTracker.attachDOMEvent(l,"touchend",c,!1)),e.domEventTracker.attachDOMEvent(l,"focus",e._ControlFocus),e.domEventTracker.attachDOMEvent(l,"blur",e._ControlBlur),e.domEventTracker.attachDOMEvent(l,"click",e._Click);else{var r=l.contentWindow.document;n.browser=="firefox"?(e.domEventTracker.attachDOMEvent(r,"focus",e._ControlFocus),e.domEventTracker.attachDOMEvent(r,"blur",e._ControlBlur)):(e.domEventTracker.attachDOMEvent(r.body,"focus",e._ControlFocus),e.domEventTracker.attachDOMEvent(r.body,"blur",e._ControlBlur))}}),e.page.on("disabled",function(l){var r;if(!N(l,"HTMLIFrameElement"))n.touchable&&e.domEventTracker.attachDOMEvent(l,"touchstart",e.nonKMWTouchHandler,!1),e.domEventTracker.detachDOMEvent(l,"focus",e._ControlFocus),e.domEventTracker.detachDOMEvent(l,"blur",e._ControlBlur),e.domEventTracker.detachDOMEvent(l,"click",e._Click);else{var s=l.contentWindow.document;n.browser=="firefox"?(e.domEventTracker.detachDOMEvent(s,"focus",e._ControlFocus),e.domEventTracker.detachDOMEvent(s,"blur",e._ControlBlur)):(e.domEventTracker.detachDOMEvent(s.body,"focus",e._ControlFocus),e.domEventTracker.detachDOMEvent(s.body,"blur",e._ControlBlur))}var B=(r=e.mostRecentTarget)===null||r===void 0?void 0:r.getElement();B&&B==l&&e.forgetActiveTarget()}),e.page.install(e.engineConfig.attachType=="manual")})},Object.defineProperty(t.prototype,"activeTarget",{get:function(){var e=this.focusAssistant.maintainingFocus;return this.currentTarget||(e?this.mostRecentTarget:null)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastActiveTarget",{get:function(){return this.mostRecentTarget},enumerable:!1,configurable:!0}),t.prototype.deactivateCurrentTarget=function(){var e=this.activeTarget||this.lastActiveTarget;e&&this._BlurKeyboardSettings(e.getElement()),this.activeTarget||this.setActiveTarget(null,!0)},t.prototype.forgetActiveTarget=function(){this.focusAssistant.maintainingFocus=!1,this.focusAssistant.restoringFocus=!1;var e=this.activeTarget||this.lastActiveTarget;e&&this._BlurKeyboardSettings(e.getElement()),this.setActiveTarget(null,!0)},t.prototype.setActiveTarget=function(e,n){var c,l=this.mostRecentTarget,r=this.activeTarget;if(e!=r){var s=!!l;if(this.currentTarget=this.mostRecentTarget=e,this.predictionContext.setCurrentTarget(e),this.focusAssistant.restoringFocus?this._BlurKeyboardSettings(e.getElement()):e&&this._FocusKeyboardSettings(e.getElement(),!s),this._CommonFocusHelper(e))return!0;var B=e==null?void 0:e.getElement();e instanceof ne&&(B=e.docRoot),B&&B.ownerDocument&&B instanceof B.ownerDocument.defaultView.HTMLElement&&$c(B,(c=this.activeKeyboard)===null||c===void 0?void 0:c.keyboard),e!=r&&this.emit("targetchange",e),n&&this.apiEvents.callEvent("controlfocused",{target:(e==null?void 0:e.getElement())||null,activeControl:l==null?void 0:l.getElement()})}},Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this._activeKeyboard},enumerable:!1,configurable:!0}),t.prototype.restoreLastActiveTarget=function(){!this.mostRecentTarget||(this.focusAssistant.restoringFocus=!0,this.mostRecentTarget.focus(),this.focusAssistant.restoringFocus=!1)},t.prototype.insertText=function(e,n,c){this.restoreLastActiveTarget();var l=this.activeTarget;return l==null&&this.mostRecentTarget&&(l=this.activeTarget),l!=null?i.prototype.insertText.call(this,e,n,c):!1},t.prototype.currentKeyboardSrcTarget=function(){var e=this.currentTarget||this.mostRecentTarget;return this.isTargetKeyboardIndependent(e)?e:null},t.prototype.isTargetKeyboardIndependent=function(e){var n=e==null?void 0:e.getElement()._kmwAttachment;return!!((n==null?void 0:n.keyboard)||(n==null?void 0:n.keyboard)==="")},t.prototype.activateKeyboardForTarget=function(e,n){var c,l,r=n==null?void 0:n.getElement()._kmwAttachment;if(r?(r.keyboard=(c=e==null?void 0:e.metadata.id)!==null&&c!==void 0?c:"",r.languageCode=(l=e==null?void 0:e.metadata.langId)!==null&&l!==void 0?l:""):this.globalKeyboard=e,this.currentKeyboardSrcTarget()==n){this._activeKeyboard=e;var s=e==null?void 0:e.metadata;this.page.setAttachmentFont(s==null?void 0:s.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS)}},t.prototype.setKeyboardForTarget=function(e,n,c){if(e instanceof ne){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}var l=e.getElement()._kmwAttachment,r=this.currentKeyboardSrcTarget()==e;if(l){if(l.keyboard=n||null,l.languageCode=c||null,r||this.currentKeyboardSrcTarget()==e){var s=this.globalKeyboard.metadata;this.activateKeyboard(l.keyboard||s.id,l.languageCode||s.langId,!0)}}else return},t.prototype.getKeyboardStubForTarget=function(e){if(this.isTargetKeyboardIndependent(e)){var n=e.getElement()._kmwAttachment;return this.keyboardCache.getStub(n.keyboard,n.languageCode)}else return this.globalKeyboard.metadata},t.prototype.getFallbackStubKey=function(){var e={id:"",langId:""};return this.engineConfig.hostDevice.touchable&&this.keyboardCache.defaultStub||e},t.prototype.activateKeyboard=function(e,n,c){var l,r,s,B,o,g;return(0,d.__awaiter)(this,void 0,void 0,function(){var a,F,y,u,Q,C=this;return(0,d.__generator)(this,function(h){switch(h.label){case 0:c||(c=!1),a=this.currentKeyboardSrcTarget(),e||(e=this.getFallbackStubKey().id,n=this.getFallbackStubKey().langId),h.label=1;case 1:return h.trys.push([1,3,,7]),[4,i.prototype.activateKeyboard.call(this,e,n,c)];case 2:return F=h.sent(),(l=this.engineConfig.alertHost)===null||l===void 0||l.wait(),c&&!a&&this.cookieManager.save({current:"".concat(e,":").concat(n)}),a==this.currentKeyboardSrcTarget()&&($c((r=this.currentTarget)===null||r===void 0?void 0:r.getElement(),this.keyboardCache.getKeyboard(e)),this.page.setAttachmentFont((B=(s=this.activeKeyboard)===null||s===void 0?void 0:s.metadata)===null||B===void 0?void 0:B.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS),this.restoreLastActiveTarget()),[2,F];case 3:return y=h.sent(),u=function(){return(0,d.__awaiter)(C,void 0,void 0,function(){var b;return(0,d.__generator)(this,function(U){switch(U.label){case 0:return b=this.getFallbackStubKey(),b.id==e?[3,2]:[4,this.activateKeyboard(b.id,b.langId,!0).catch(function(){})];case 1:U.sent(),U.label=2;case 2:return[2]}})})},(o=this.engineConfig.alertHost)===null||o===void 0||o.wait(),Q=(y==null?void 0:y.message)||"Sorry, the "+e+" keyboard for "+n+" is not currently available.",y instanceof ze?console.error(y||Q):console.warn(y||Q),this.engineConfig.alertHost?((g=this.engineConfig.alertHost)===null||g===void 0||g.alert(Q,u),[3,6]):[3,4];case 4:return[4,u()];case 5:h.sent(),h.label=6;case 6:throw y;case 7:return[2]}})})},t.prototype._BlurKeyboardSettings=function(e,n,c){var l,r=this.activeKeyboard?this.activeKeyboard.keyboard.id:"",s=(l=this.activeKeyboard)===null||l===void 0?void 0:l.metadata.langId;n!==void 0&&c!==void 0&&(r=n,s=c),e&&e._kmwAttachment.keyboard!=null?(e._kmwAttachment.keyboard=r,e._kmwAttachment.languageCode=s):this.globalKeyboard=this.activeKeyboard},t.prototype._FocusKeyboardSettings=function(e,n){var c,l=e._kmwAttachment,r=this.globalKeyboard;l.keyboard!=null?this.activateKeyboard(l.keyboard,l.languageCode,!0):!n&&(r==null?void 0:r.metadata)!=((c=this._activeKeyboard)===null||c===void 0?void 0:c.metadata)&&this.activateKeyboard(r==null?void 0:r.metadata.id,r==null?void 0:r.metadata.langId,!0)},t.prototype._CommonFocusHelper=function(e){var n,c=this.focusAssistant,l=(n=this.activeKeyboard)===null||n===void 0?void 0:n.keyboard;return c.restoringFocus||(e==null||e.deadkeys().clear(),l==null||l.notify(0,e,1)),!c.restoringFocus&&this.mostRecentTarget!=e&&(c.maintainingFocus=!1),c.restoringFocus=!1,this.resetContext(),!1},t.prototype.doChangeEvent=function(e){if(e.changed){var n=new Event("change",{bubbles:!0,cancelable:!1});e.getElement().dispatchEvent(n)}e.changed=!1},t.prototype.getSavedKeyboardRaw=function(){var e=new se("KeymanWeb_Keyboard"),n=e.load(decodeURIComponent);return typeof n.current!="string"||n.current=="Keyboard_us:eng"?"Keyboard_us:en":n.current},t.prototype.getSavedKeyboard=function(){for(var e=this.getSavedKeyboardRaw(),n=this.keyboardCache.getStubList(),c,l=0;l<n.length;l++)if(c=n[l].KI+":"+n[l].KLC,c==e)return c;for(var l=0;l<n.length;l++)if(c=n[l].KI+":"+n[l].KLC,c=="Keyboard_us:en")return c;return n.length>0?n[0].KI+":"+n[0].KLC:"Keyboard_us:en"},t.prototype.restoreSavedKeyboard=function(e){var n=e,c=n.split(":");c.length<2&&(c[1]="");var l=this.keyboardCache.getStub(c[0],c[1])||this.keyboardCache.defaultStub;l&&this.activateKeyboard(c[0],c[1])},t.prototype.shutdown=function(){this.page.shutdown(),this.domEventTracker.shutdown()},t}(_t),ei=cr;var ir=function(i){(0,d.__extends)(t,i);function t(e){var n=i.call(this)||this;return n.contextManager=e,n}return t.prototype.isCommand=function(e){var n=this.codeForEvent(e);switch(n){case I.keyCodes.K_TAB:case I.keyCodes.K_TABBACK:case I.keyCodes.K_TABFWD:return!0;default:return i.prototype.isCommand.call(this,e)}},t.prototype.applyCommand=function(e,n){var c=this,l=this.codeForEvent(e),r=function(s){var B,o=c.contextManager,g=(B=o.activeTarget)===null||B===void 0?void 0:B.getElement(),a=o.page.findNeighboringInput(g,s);a.focus()};switch(l){case I.keyCodes.K_TAB:r((e.Lmodifiers&I.modifierCodes.SHIFT)!=0);break;case I.keyCodes.K_TABBACK:r(!0);break;case I.keyCodes.K_TABFWD:r(!1);break}i.prototype.applyCommand.call(this,e,n)},t}(Ve),ti=ir;function Sn(i){return i.keyCode?i.keyCode:i.which?i.which:null}function mt(i,t,e){if(i.cancelBubble===!0)return null;var n=Sn(i);if(n==null)return null;var c=t.modStateFlags,l=0,r=!1,s=!1,B=I.keyCodes;switch(n){case B.K_CTRL:case B.K_LCTRL:case B.K_RCTRL:case B.K_CONTROL:case B.K_LCONTROL:case B.K_RCONTROL:r=!0;break;case B.K_LMENU:case B.K_RMENU:case B.K_ALT:case B.K_LALT:case B.K_RALT:s=!0;break}l|=i.getModifierState("Shift")?16:0;var o=I.modifierCodes;i.getModifierState("Control")&&(l|=i.location!=0&&r?i.location==1?o.LCTRL:o.RCTRL:c&3),i.getModifierState("Alt")&&(l|=i.location!=0&&s?i.location==1?o.LALT:o.RALT:c&12);var g=0;g|=i.getModifierState("CapsLock")?o.CAPS:o.NO_CAPS,g|=i.getModifierState("NumLock")?o.NUM_LOCK:o.NO_NUM_LOCK,g|=i.getModifierState("ScrollLock")?o.SCROLL_LOCK:o.NO_SCROLL_LOCK,l|=g;var a=t.modStateFlags!=l;t.modStateFlags=l;var F=o.RALT|o.LCTRL;(c&F)==F&&(l&F)!=F&&(l&=~F),l&o.RALT&&(l&=~o.LCTRL);var y=I.modifierBitmasks,u=t.activeKeyboard,Q;u&&u.isChiral?(Q=l&y.CHIRAL,u.emulatesAltGr&&(Q&y.ALT_GR_SIM)==y.ALT_GR_SIM&&(Q^=y.ALT_GR_SIM,Q|=o.RALT)):Q=l&16|(l&(o.LCTRL|o.RCTRL)?32:0)|(l&(o.LALT|o.RALT)?64:0),Q|=i.metaKey?o.META:0,e.browser==x.Browser.Firefox&&de.browserMap.FF["k"+n]&&(n=de.browserMap.FF["k"+n]);var C=new $({device:e,kName:"",Lcode:n,Lmodifiers:Q,Lstates:g,LmodifierChange:a,isSynthetic:!1});u&&u.isMnemonic&&C.setMnemonicCode(i.getModifierState("Shift"),i.getModifierState("CapsLock"));var h=typeof i.charCode!="undefined"&&i.charCode!=null&&(i.charCode==0||(Q&111)!=0);if(C.LisVirtualKey=h||i.type!="keypress",u&&!u.isMnemonic){var b=de.languageMap[t.baseLayout];b&&b["k"+C.Lcode]&&(C.Lcode=b["k"+C.Lcode]),!u.definesPositionalOrMnemonic&&!(C.Lmodifiers&96)&&(C=new $({Lcode:de._USKeyCodeToCharCode(C),Lmodifiers:0,LisVirtualKey:!1,vkCode:C.Lcode,Lstates:C.Lstates,kName:"",device:e,isSynthetic:!1}))}var U=new $(C);return U.source=i,U}var lr=function(i){(0,d.__extends)(t,i);function t(e,n,c){var l=i.call(this)||this;l.domEventTracker=new ue,l.swallowKeypress=!1,l._KeyDown=function(B){var o,g=l.contextManager.activeKeyboard,a=Ce(B);if(!a||g==null)return!0;var F=a.getElement();return((o=F==null?void 0:F.className)===null||o===void 0?void 0:o.indexOf("kmw-disabled"))>=0?!0:l.keyDown(B)},l._KeyPress=function(B){var o=Ce(B);return!o||l.activeKeyboard==null?!0:l.keyPress(B)},l._KeyUp=function(B){var o=Ce(B),g=mt(B,l.processor,l.hardDevice);if(g==null)return!0;var a=o.getElement();if(g.Lcode==13){var F=!1;if(N(a,"HTMLTextAreaElement")&&(F=!0),!F){if(a instanceof a.ownerDocument.defaultView.HTMLInputElement)if(a.form&&(a.type=="search"||a.type=="submit"))a.form.submit();else{var y=l.contextManager.page.findNeighboringInput(a,!1);y.focus()}return!0}}return l.keyUp(B)},l.hardDevice=e,l.contextManager=c,l.processor=n;var r=c.page,s=l.domEventTracker;return r.on("enabled",function(B){var o=be(B);if(!(o instanceof ne))s.attachDOMEvent(B,"keypress",l._KeyPress),s.attachDOMEvent(B,"keydown",l._KeyDown),s.attachDOMEvent(B,"keyup",l._KeyUp);else{var g=o.getElement().contentDocument;s.attachDOMEvent(g.body,"keydown",l._KeyDown),s.attachDOMEvent(g.body,"keypress",l._KeyPress),s.attachDOMEvent(g.body,"keyup",l._KeyUp)}}),r.off("disabled",function(B){var o=be(B);if(!(o instanceof ne))s.detachDOMEvent(B,"keypress",l._KeyPress),s.detachDOMEvent(B,"keydown",l._KeyDown),s.detachDOMEvent(B,"keyup",l._KeyUp);else{var g=o.getElement().contentDocument;s.detachDOMEvent(g.body,"keydown",l._KeyDown),s.detachDOMEvent(g.body,"keypress",l._KeyPress),s.detachDOMEvent(g.body,"keyup",l._KeyUp)}}),l}return Object.defineProperty(t.prototype,"activeKeyboard",{get:function(){return this.contextManager.activeKeyboard.keyboard},enumerable:!1,configurable:!0}),t.prototype.keyDown=function(e){var n=this;this.swallowKeypress=!1;var c=mt(e,this.processor,this.hardDevice);if(c==null)return!0;var l={LeventMatched:!1};return this.emit("keyevent",c,function(r,s){l.LeventMatched=r&&!r.triggerKeyDefault,l.LeventMatched?(e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),n.swallowKeypress=!!c.Lcode,c.Lcode==8&&(n.swallowKeypress=!1)):n.swallowKeypress=!1}),!l.LeventMatched},t.prototype.keyUp=function(e){var n=mt(e,this.processor,this.hardDevice);if(n==null)return!0;var c=Ce(e);return this.processor.doModifierPress(n,c,!1)},t.prototype.keyPress=function(e){var n=mt(e,this.processor,this.hardDevice);if(n==null||n.LisVirtualKey)return!0;if(!this.activeKeyboard.isMnemonic)return!this.swallowKeypress||n.Lcode<32||this.hardDevice.browser==x.Browser.Safari&&n.Lcode>63232&&n.Lcode<63744;var c={};return this.swallowKeypress||this.emit("keyevent",n,function(l,r){c.preventDefaultKeystroke=!!l}),this.swallowKeypress||c.preventDefaultKeystroke?(this.swallowKeypress=!1,e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),!1):(this.swallowKeypress=!1,!0)},t.prototype.shutdown=function(){this.domEventTracker.shutdown()},t}(Pt),ni=lr;var ci=function(){function i(){this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}return i.prototype.equals=function(t){return this.innerWidth==t.innerWidth&&this.innerHeight==t.innerHeight},i}(),ii=function(){function i(t){this.idlePermutationCounter=i.IDLE_PERMUTATION_CAP,this.keyman=t}return i.prototype.resolve=function(){var t,e=this.keyman.osk;(t=this.keyman.touchLanguageMenu)===null||t===void 0||t.hide(),this.keyman.touchLanguageMenu=null,e.setNeedsLayout(),this.oskVisible&&e.present(),this.isActive=!1,this.updateTimer&&(window.clearInterval(this.updateTimer),this.rotState=null)},i.prototype.initNewRotation=function(){this.oskVisible=this.keyman.osk.isVisible(),this.keyman.osk.hideNow(),this.isActive=!0},i.prototype.init=function(){var t=this,e=this.keyman.config.hostDevice.OS,n=this.keyman.util;e=="ios"?(n.attachDOMEvent(window,"orientationchange",function(){return t.iOSEventHandler(),!1}),n.attachDOMEvent(window,"resize",function(){return t.iOSEventHandler(),!1})):e=="android"&&("onmozorientationchange"in screen?n.attachDOMEvent(screen,"mozorientationchange",function(){return t.initNewRotation(),!1}):n.attachDOMEvent(window,"orientationchange",function(){return t.initNewRotation(),!1}),n.attachDOMEvent(window,"resize",function(){return t.resolve(),!1}))},i.prototype.iOSEventHandler=function(){this.isActive||(this.initNewRotation(),this.rotState=new ci,this.updateTimer=window.setInterval(this.iOSEventUpdate.bind(this),i.UPDATE_INTERVAL)),this.idlePermutationCounter=0},i.prototype.iOSEventUpdate=function(){var t=new ci;this.rotState.equals(t)?++this.idlePermutationCounter==i.IDLE_PERMUTATION_CAP&&this.resolve():(this.rotState=t,this.idlePermutationCounter=0)},i.IDLE_PERMUTATION_CAP=15,i.UPDATE_INTERVAL=20,i}();var li=function(){function i(t,e){var n=this;this.domEventTracker=new ue,this.suppressFocusCheck=function(c){return n.focusAssistant.isTargetForcingScroll()&&(c.stopPropagation(),c.cancelBubble=!0),!0},this.pageFocusHandler=function(){var c;return!n.focusAssistant.maintainingFocus&&((c=n.engine.osk)===null||c===void 0?void 0:c.vkbd)&&(n.engine.contextManager.deactivateCurrentTarget(),n.engine.contextManager.resetContext()),!1},this.touchStartActivationHandler=function(c){var l=n.engine.osk;if(!l)return!1;var r=n.engine.config.hostDevice;if(n.deactivateOnRelease=!0,n.touchY=c.touches[0].screenY,n.deactivateOnScroll=!1,r.OS=="android"&&r.browser=="chrome"){if(typeof l._Box=="undefined"||typeof l._Box.style=="undefined")return!1;var s=c.target.parentElement;if(typeof s!="undefined"&&s!=null&&(s.className.indexOf("kmw-key-")>=0||typeof s.parentElement!="undefined"&&s.parentElement!=null&&(s=s.parentElement,s.className.indexOf("kmw-key-")>=0)))return!1;n.deactivateOnScroll=!0}return!1},this.touchMoveActivationHandler=function(c){n.deactivateOnScroll&&(n.focusAssistant.focusing=!1,n.engine.contextManager.deactivateCurrentTarget());var l=c.touches[0].screenY,r=n.touchY;return(l-r>5||r-l<5)&&(n.deactivateOnRelease=!1),!1},this.touchEndActivationHandler=function(c){return n.deactivateOnRelease&&!n.engine.touchLanguageMenu&&!n.focusAssistant.focusing&&n.engine.contextManager.deactivateCurrentTarget(),n.deactivateOnRelease=!1,!1},this._WindowLoad=function(){document.body.scrollTop=0,typeof document.documentElement!="undefined"&&(document.documentElement.scrollTop=0)},this._WindowUnload=function(){n.engine.shutdown()},this.window=t,this.engine=e,this.attachHandlers(),e.config.hostDevice.touchable&&(this.buildPageTrailer(),this.rotationProcessor=new ii(this.engine),this.rotationProcessor.init())}return i.prototype.buildPageTrailer=function(){var t=this.mobilePageTrailer=document.createElement("div"),e=t.style;e.width="100%",e.height=screen.width/2+"px",document.body.appendChild(t)},Object.defineProperty(i.prototype,"focusAssistant",{get:function(){return this.engine.contextManager.focusAssistant},enumerable:!1,configurable:!0}),i.prototype.attachHandlers=function(){var t=this.domEventTracker,e=this.engine.config.hostDevice,n=this.window.document.body;t.attachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),t.attachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),t.attachDOMEvent(n,"focus",this.suppressFocusCheck,!0),t.attachDOMEvent(n,"blur",this.suppressFocusCheck,!0),e.touchable&&(t.attachDOMEvent(n,"touchstart",this.touchStartActivationHandler,!1),t.attachDOMEvent(n,"touchmove",this.touchMoveActivationHandler,!1),t.attachDOMEvent(n,"touchend",this.touchEndActivationHandler,!1)),t.attachDOMEvent(window,"load",this._WindowLoad,!1),t.attachDOMEvent(window,"unload",this._WindowUnload,!1),t.attachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)},i.prototype.shutdown=function(){var t,e=this.domEventTracker,n=this.engine.config.hostDevice,c=this.window.document.body;e.detachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),e.detachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),e.detachDOMEvent(c,"focus",this.suppressFocusCheck,!0),e.detachDOMEvent(c,"blur",this.suppressFocusCheck,!0),n.touchable&&(e.detachDOMEvent(c,"touchstart",this.touchStartActivationHandler,!1),e.detachDOMEvent(c,"touchmove",this.touchMoveActivationHandler,!1),e.detachDOMEvent(c,"touchend",this.touchEndActivationHandler,!1),(t=this.mobilePageTrailer)===null||t===void 0||t.parentElement.removeChild(this.mobilePageTrailer)),e.detachDOMEvent(window,"load",this._WindowLoad,!1),e.detachDOMEvent(window,"unload",this._WindowUnload,!1),e.detachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)},i}();function ce(i){var t=document.createElement(i);return t.style.userSelect="none",t.style.MozUserSelect="none",t.style.KhtmlUserSelect="none",t.style.UserSelect="none",t.style.WebkitUserSelect="none",t}function ve(i,t){try{if(i&&typeof window.getComputedStyle!="undefined")return window.getComputedStyle(i,"").getPropertyValue(t)}catch(e){}return""}function Zt(){try{if(this.device.formFactor=="desktop")return 1;var i=document.documentElement.clientWidth;if(screen.width>i)return 1;var t=screen.width;return this.landscapeView()?screen.width<screen.height&&(t=screen.height):screen.width>screen.height&&(t=screen.height),Math.round(100*t/i)/100}catch(e){return 1}}var ri=function(){function i(t){this.keyman=t,this.scrolling=!1,this.shim=this.constructShim()}return i.prototype.constructShim=function(){var t=this,e=this,n=ce("div"),c=this.keyman.osk;return n.id="kmw-language-menu-background",n.addEventListener("touchstart",function(l){if(l.preventDefault(),e.hide(),l.touches.length>2){var r=l.touches[1].pageX,s=l.touches[1].pageY,B=c.vkbd.spaceBar;r>B.offsetLeft&&r<B.offsetLeft+B.offsetWidth&&s>B.offsetTop&&s<B.offsetTop+B.offsetHeight&&t.keyman.osk.emit("showbuild")}},!1),n},i.prototype.show=function(){var t=this.keyman.config.hostDevice,e=this.keyman.keyboardRequisitioner.cache.getStubList(),n=e.length;if(!(n<1)){var c=this.lgList=ce("div");this.lgList.id="kmw-language-menu";var l=this;document.body.appendChild(this.shim);var r=ce("div"),s=r.style,B=ce("div"),o=B.style;r.id="kmw-menu-scroll-container",B.id="kmw-menu-scroller","WebkitOverflowScrolling"in s&&(s.WebkitOverflowScrolling="touch"),r.appendChild(B),c.appendChild(r);var g,a,F=ce("div");for(F.id="kmw-menu-index",g=1;g<=26;g++)a=ce("p"),a.innerHTML=String.fromCharCode(g+64),F.appendChild(a);F.addEventListener("touchstart",function(L){l.scrollToLanguage(L,r,B)},!1),F.addEventListener("touchend",function(L){L.stopPropagation()},!1),c.appendChild(F),c.addEventListener("scroll",function(L){l.scrolling=!0},!1),r.addEventListener("scroll",function(L){r.scrollTop<1&&(r.scrollTop=1),r.scrollTop>r.scrollHeight-r.offsetHeight-1&&(r.scrollTop=r.scrollHeight-r.offsetHeight-1)},!1),this.activeLgNo=this.addLanguages(B,e);var y=B.childNodes.length-1;if(this.lgList.style.visibility="hidden",document.body.appendChild(this.lgList),t.OS=="android"&&"devicePixelRatio"in window&&(this.lgList.style.fontSize=2/window.devicePixelRatio+"em"),t.OS=="android"&&t.formFactor=="tablet"&&"devicePixelRatio"in window){var u=parseInt(ve(c,"width"),10),Q=c.style;isNaN(u)||(Q.width=Q.maxWidth=2*u/window.devicePixelRatio+"px"),u=parseInt(ve(r,"width"),10),Q=r.style,isNaN(u)||(Q.width=Q.maxWidth=2*u/window.devicePixelRatio+"px"),u=parseInt(ve(B,"width"),10),Q=B.style,isNaN(u)||(Q.width=Q.maxWidth=2*u/window.devicePixelRatio+"px")}this.adjust(0);var C=F.childNodes[1].offsetTop-F.childNodes[0].offsetTop,h=Math.floor(c.offsetHeight/26),b=Math.round(100*h/C)/100,U=b>.6?1:2;for(b>1.25&&(b=1.25),g=0;g<26;g++){var V=F.childNodes[g].style;U==2&&g%2==1?V.display="none":(V.fontSize=b*U+"em",V.lineHeight=h*U+"px")}var X=r.offsetWidth;r.scrollHeight>r.offsetHeight+3?X=X+F.offsetWidth:F.style.display="none",c.style.width=X+"px",this.lgList.style.visibility="",this.scrollToIndex(this.activeLgNo,r,B)}},i.prototype.adjust=function(t){var e=this.keyman.osk,n=this.keyman.config.hostDevice,c=this.lgList,l=c.firstChild,r=l.firstChild,s=0,B=c.style,o=c.childNodes[1],g=window.innerHeight-e.vkbd.lgKey.offsetHeight-16,a=r.childNodes.length+t-1,F=r.firstChild.firstChild.offsetHeight,y=a*F;n.OS=="ios"&&(n.formFactor=="phone"?(s=D()?36:0,g=(window.innerHeight-s-16)*Zt()):n.formFactor=="tablet"&&(s=D()?16:0,g=g-s)),B.left=J(e.vkbd.lgKey)+"px",y>g&&(y=g),B.height=y+"px",B.bottom="0px",o.style.height=l.style.height=B.height},i.prototype.scrollToLanguage=function(t,e,n){t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault();var c=t.touches[0].target;if(c.nodeName=="P"){var l,r,s=c.innerHTML.charCodeAt(0),B=n.childNodes;try{for(l=0;l<B.length-1&&(r=B[l].firstChild.innerHTML.toUpperCase().charCodeAt(0),!(r>=s));l++);}catch(o){}this.scrollToIndex(l,e,n)}},i.prototype.scrollToIndex=function(t,e,n){var c,l=.5;try{c=n.firstChild.getBoundingClientRect().height*(t-l)+1,e.scrollTop=c}catch(r){c=0}try{e.scrollTop<0&&(e.scrollTop=0),e.scrollTop>e.scrollHeight-e.offsetHeight-1&&(e.scrollTop=e.scrollHeight-e.offsetHeight-1)}catch(r){}},i.prototype.addLanguages=function(t,e){var n,c=e.length,l=this.keyman.config.hostDevice,r,s,B,o=[];for(s=0;s<c;s++)B=e[s].KL,o.indexOf(B)==-1&&o.push(B);o.sort();var g=Math.round(100/Zt())/100,a,F,y,u,Q=-1,C=function(){for(a=ce("div"),a.className="kbd-list-closed",F=ce("p"),F.kList=[],s=0;s<c;s++)e[s].KL==o[r]&&F.kList.push(e[s]);l.OS=="ios"&&(F.style.fontSize=g+"em"),a.appendChild(F),t.appendChild(a),o[r]==((n=h.keyman.contextManager.activeKeyboard)===null||n===void 0?void 0:n.metadata.langName)&&(Q=r);var V=h;if(F.kList.length>1)for(F.className="kbd-list",F.innerHTML=o[r]+"...",F.scrolled=!1,F.ontouchend=function(X){X.stopPropagation(),X.target.scrolled?X.target.scrolled=!1:this.parentNode.className=this.parentNode.className=="kbd-list-closed"?"kbd-list-open":"kbd-list-closed",V.adjust(this.parentNode.className=="kbd-list-closed"?0:this.kList.length)},F.addEventListener("touchstart",function(X){X.stopPropagation()},!1),F.addEventListener("touchmove",function(X){X.target.scrolled=!0,X.stopPropagation()},!1),y=0;y<F.kList.length;y++)u=ce("p"),u.className="kbd-list-entry",l.OS=="ios"&&(u.style.fontSize=g+"em"),h.addKeyboard(F.kList[y],u,!1),a.appendChild(u);else F.innerHTML=o[r],F.className="kbd-single-entry",h.addKeyboard(F.kList[0],F,!0);r==Q&&(F.className=F.className+" current")},h=this;for(r=0;r<o.length;r++)C();var b=ce("div");b.id="kmw-menu-footer";var U=function(V){V.cancelable&&V.preventDefault(),V.stopPropagation()};return b.addEventListener("touchstart",U,!1),b.addEventListener("touchmove",U,!1),b.addEventListener("touchend",U,!1),t.appendChild(b),Q},i.prototype.addKeyboard=function(t,e,n){var c=this;e.kn=t.KI,e.kc=t.KLC,e.innerHTML=n?t.KL:t.KN.replace(" Keyboard","");var l=this,r=function(){if(c.originalBodyStyle){console.error("Unexpected state:  `originalBodyStyle` was not cleared by a previous `unlockBodyScroll()` call");return}c.originalBodyStyle={};var F=c.originalBodyStyle,y=document.body.style;return F.overflowY=y.overflowY,F.height=y.height,y.overflowY="hidden",y.height="100%",!0},s=function(){if(!c.originalBodyStyle){console.error("Unexpected state:  `originalBodyStyle` is unset; cannot restore original body style");return}var F=c.originalBodyStyle,y=document.body.style;y.overflowY=F.overflowY,y.height=F.height,c.originalBodyStyle=null},B=function(F){F.stopPropagation(),this.className.indexOf("selected")<=0&&(this.className=this.className+" selected"),l.scrolling=!1,l.y0=F.touches[0].pageY,r()},o=function(F){F.stopImmediatePropagation();var y=l.lgList.childNodes[0],u=y.scrollHeight-y.offsetHeight,Q,C;if(typeof F.pageY!="undefined")Q=F.pageY;else if(typeof F.touches!="undefined")Q=F.touches[0].pageY;else return;if(C=Q-l.y0,C<0)y.scrollTop>=u-1&&(l.y0=Q);else if(C>0)y.scrollTop<2&&(l.y0=Q);else return;return(C<-5||C>5)&&(l.scrolling=!0,this.className=this.className.replace(/\s*selected/,""),l.y0=Q),!0},g=function(F){return typeof F.stopImmediatePropagation!="undefined"?F.stopImmediatePropagation():F.stopPropagation(),l.scrolling?this.className=this.className.replace(/\s*selected/,""):(l.keyman.contextManager.focusAssistant.setFocusTimer(),l.lgList.style.display="none",l.keyman.contextManager.activateKeyboard(this.kn,this.kc,!0),l.keyman.contextManager.restoreLastActiveTarget(),l.hide()),s(),!0},a=function(F){s()};e.onmspointerdown=B,e.addEventListener("touchstart",B,!1),e.onmspointermove=o,e.addEventListener("touchmove",o,!1),e.onmspointerout=g,e.addEventListener("touchend",g,!1),e.addEventListener("touchcancel",a,!1)},i.prototype.hide=function(){var t=this,e=this.keyman.osk;this.lgList&&(e.vkbd.highlightKey(e.vkbd.lgKey,!1),this.lgList.style.visibility="hidden",window.setTimeout(function(){t.shim.parentElement&&(document.body.removeChild(t.shim),document.body.removeChild(t.lgList))},500)),this.keyman.touchLanguageMenu=null},i}();function si(i,t,e){var n=this,c=e.focusAssistant;t.on("globekey",function(l,r){r&&t.hostDevice.touchable&&(i.touchLanguageMenu=new ri(i),i.touchLanguageMenu.show()),t.vkbd&&t.vkbd.highlightKey(l,!1)}),t.on("hiderequested",function(l){t&&(t.startHide(!0),e.forgetActiveTarget())}),t.addEventListener("hide",function(l){var r;l!=null&&l.HiddenByUser&&((r=e.activeTarget)===null||r===void 0||r.focus())}),t.on("showbuild",function(){var l;(l=i.config.alertHost)===null||l===void 0||l.alert("KeymanWeb Version "+Wt.VERSION+'<br /><br /><span style="font-size:0.8em">Copyright &copy; 2007-2023 SIL International</span>')}),t.on("dragmove",function(l){return(0,d.__awaiter)(n,void 0,void 0,function(){return(0,d.__generator)(this,function(r){switch(r.label){case 0:return c.restoringFocus=!0,[4,l];case 1:return r.sent(),e.restoreLastActiveTarget(),c.restoringFocus=!1,c.setMaintainingFocus(!1),[2]}})})}),t.on("resizemove",function(l){return(0,d.__awaiter)(n,void 0,void 0,function(){return(0,d.__generator)(this,function(r){switch(r.label){case 0:return c.restoringFocus=!0,[4,l];case 1:return r.sent(),e.restoreLastActiveTarget(),c.restoringFocus=!1,c.setMaintainingFocus(!1),[2]}})})}),t.on("pointerinteraction",function(l){return(0,d.__awaiter)(n,void 0,void 0,function(){return(0,d.__generator)(this,function(r){switch(r.label){case 0:return c.setMaintainingFocus(!0),[4,l];case 1:return r.sent(),c.setMaintainingFocus(!1),[2]}})})})}function sr(i){var t=document.createElement(i);return t.style.userSelect="none",t}var Bi=function(){function i(t){this.getAbsoluteX=J,this.getAbsoluteY=Z,this._GetAbsoluteX=J,this._GetAbsoluteY=Z,this._GetAbsolute=this.getAbsolute,this.toNzString=this.nzString,this.createElement=sr,this.getStyleValue=ve,this.config=t,this.stylesheetManager=new Fe(document.body,t.applyCacheBusting),this.domEventTracker=new ue}return i.prototype.isTouchDevice=function(){return this.config.hostDevice.touchable},i.prototype.getAbsolute=function(t){return{x:J(t),y:Z(t)}},i.prototype.getOption=function(t,e){return t in this.config.paths?this.config.paths[t]:t in this.config.options?this.config.options[t]:arguments.length>1?e:""},i.prototype.setOption=function(t,e){switch(t){case"attachType":break;case"ui":break;case"useAlerts":this.config.signalUser=e?new Ne:null;break;case"setActiveOnRegister":this.config.activateFirstKeyboard=!!e;break;case"spacebarText":this.config.spacebarText=e;break;default:throw new Error("Path-related options may not be changed after the engine has initialized.")}},i.prototype.loadCookie=function(t){var e=new se(t);return e.load(decodeURIComponent)},i.prototype.saveCookie=function(t,e){var n=new se(t);n.save(e,encodeURIComponent)},i.prototype.addStyleSheet=function(t){var e=xe(t);return this.stylesheetManager.linkStylesheet(e),e},i.prototype.removeStyleSheet=function(t){return this.stylesheetManager.unlink(t)},i.prototype.linkStyleSheet=function(t){this.stylesheetManager.linkExternalSheet(t)},i.prototype.getLanguageCodes=function(t){return t.indexOf("-")==-1?[t]:t.split("-")},i.prototype.attachDOMEvent=function(t,e,n,c){this.domEventTracker.attachDOMEvent(t,e,n,c)},i.prototype.detachDOMEvent=function(t,e,n,c){this.domEventTracker.detachDOMEvent(t,e,n,c)},Object.defineProperty(i.prototype,"alertHost",{get:function(){return this.config.alertHost?this.config.alertHost:(this._alertHost||(this._alertHost=new Ne),this._alertHost)},enumerable:!1,configurable:!0}),i.prototype.alert=function(t,e){this.alertHost.alert(t,e)},i.prototype.nzString=function(t,e){var n="";return arguments.length>1&&(n=e),typeof t=="undefined"||t==null||t==0||t==""?n:""+t},i.prototype.toNumber=function(t,e){var n=parseInt(t,10);return isNaN(n)?e:n},i.prototype.toFloat=function(t,e){var n=parseFloat(t);return isNaN(n)?e:n},i.prototype.rgba=function(t,e,n,c,l){var r="transparent";try{r="rgba("+e+","+n+","+c+","+l+")"}catch(s){r="rgb("+e+","+n+","+c+")"}return r},i.prototype.shutdown=function(){var t,e,n;(t=this.stylesheetManager)===null||t===void 0||t.unlinkAll(),(e=this.domEventTracker)===null||e===void 0||e.shutdown(),(n=this._alertHost)===null||n===void 0||n.shutdown()},i}();var Br=function(){function i(t,e,n){this.code=t,this.shift=e,this.handler=n}return i.prototype.matches=function(t,e){return this.code==t&&this.shift==e},i}(),oi=function(){function i(){var t=this;this.hotkeys=[],this._Process=function(e){e||(e=window.event);var n=Sn(e);if(n==null)return!1;for(var c=(e.shiftKey?16:0)|(e.ctrlKey?32:0)|(e.altKey?64:0),l=0;l<t.hotkeys.length;l++)if(t.hotkeys[l].matches(n,c))return t.hotkeys[l].handler(),e.returnValue=!1,e&&e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1;return!0}}return i.prototype.addHotKey=function(t,e,n){for(var c=0;c<this.hotkeys.length;c++)if(this.hotkeys[c].code==t&&this.hotkeys[c].shift==e){this.hotkeys[c].handler=n;return}this.hotkeys.push(new Br(t,e,n))},i.prototype.removeHotkey=function(t,e){for(var n=0;n<this.hotkeys.length;n++)if(this.hotkeys[n].matches(t,e)){this.hotkeys.splice(n,1);return}},i}();var or=function(){function i(t){this.e=t,this.c=t.style.backgroundColor}return i.prototype.reset=function(){this.e.style.backgroundColor=this.c},i}(),ai=function(){function i(t){var e=this;this._BeepObjects=[],this._BeepTimeout=0,this.reset=function(){e.keyboardInterface.resetContextCache();var n;for(e._BeepTimeout=0,n=0;n<e._BeepObjects.length;n++)e._BeepObjects[n].reset();e._BeepObjects=[]},this.keyboardInterface=t}return i.prototype.beep=function(t){if(t instanceof _){var e=t.getElement();if(t instanceof ne&&(e=t.docRoot),!!e&&!(!e.style||typeof e.style.backgroundColor=="undefined")){for(var n=0;n<this._BeepObjects.length;n++)if(this._BeepObjects[n].e==e)return;this._BeepObjects.push(new or(e)),e.style.backgroundColor="#000000",this._BeepTimeout==0&&(this._BeepTimeout=1,window.setTimeout(this.reset,50))}}},i}();var gi=function(i){(0,d.__extends)(t,i);function t(e,n){var c=i.call(this,e,n)||this;return c.GetLastActiveElement=c.getLastActiveElement,c.FocusLastActiveElement=c.focusLastActiveElement,c.HideHelp=c.hideHelp,c.ShowHelp=c.showHelp,c.ShowPinnedHelp=c.showPinnedHelp,c}return t.prototype.saveFocus=function(){this.engine.contextManager.focusAssistant._IgnoreNextSelChange=1},t.prototype.getLastActiveElement=function(){return this.engine.contextManager.lastActiveTarget},t.prototype.focusLastActiveElement=function(){this.engine.contextManager.restoreLastActiveTarget()},t.prototype.hideHelp=function(){var e=this.engine.osk;e.startHide(!0)},t.prototype.showHelp=function(e,n){var c=this.engine.osk;c instanceof We?c.presentAtPosition(e,n):c.present()},t.prototype.showPinnedHelp=function(){var e=this.engine.osk;e instanceof We&&(!e.activeKeyboard.keyboard.isCJK||!this.ruleBehavior)&&(e.userPositioned=!0),e.present()},t}(sn),di=gi;(function(){gi.__publishShorthandAPI()})();var ar=function(i){(0,d.__extends)(t,i);function t(e,n){var c=this,l=new Kc(n);return c=i.call(this,e,l,new ei(l,function(){return c.legacyAPIEvents}),function(r){return{keyboardInterface:new di(window,r),defaultOutputRules:new ti(r.contextManager)}})||this,c._initialized=0,c.hotkeyManager=new oi,c.helpURL="https://help.keyman.com/go",c.keyEventRefocus=function(){c.contextManager.restoreLastActiveTarget()},c._GetKeyboardDetail=function(r,s){var B={Name:r.KN,InternalName:r.KI,LanguageName:r.KL,LanguageCode:r.KLC,RegionName:r.KR,RegionCode:r.KRC,CountryName:r.KC,CountryCode:r.KCC,KeyboardID:r.KD,Font:r.KFont,OskFont:r.KOskFont,HasLoaded:!!s,IsRTL:s?s.isRTL:null};return B},c._util=new Bi(l),c.beepHandler=new ai(c.core.keyboardInterface),c.core.keyboardProcessor.beepHandler=function(){return c.beepHandler.beep(c.contextManager.activeTarget)},c.hardKeyboard=new ni(l.hardDevice,c.core.keyboardProcessor,c.contextManager),c.contextManager.on("targetchange",function(r){var s=r==null?void 0:r.getElement();if(c.osk.activationModel.activationTrigger=s,c.config.hostDevice.touchable){if(!s||!r||!c.osk)return;var B=Z(s),o=window.pageYOffset,g=B-o;B>=o&&(g-=window.innerHeight-c.osk._Box.offsetHeight-s.offsetHeight-2,g<0&&(g=0)),g!=0&&window.scrollTo(0,g+o)}}),c}return Object.defineProperty(t.prototype,"util",{get:function(){return this._util},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"views",{get:function(){return pn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"initialized",{get:function(){return this._initialized},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ui",{get:function(){return this._ui},set:function(e){this._ui&&this._ui.shutdown(),this._ui=e,this.config.deferForInitialization.hasResolved&&e.initialize()},enumerable:!1,configurable:!0}),t.prototype.init=function(e){return(0,d.__awaiter)(this,void 0,void 0,function(){var n,c,l,r;return(0,d.__generator)(this,function(s){switch(s.label){case 0:return n=new at,c=n.detect(),l=(0,d.__assign)((0,d.__assign)({},_c),e),this.config.hostDevice=c,this.config.initialize(l),this._initialized=1,[4,tt()];case 1:return s.sent(),this.config.deferForInitialization.hasFinalized?[2,Promise.resolve()]:[4,i.prototype.init.call(this,l)];case 2:return s.sent(),this.contextManager.initialize(),r=this.contextManager.getSavedKeyboardRaw(),c.touchable?this.osk=new Gn(this):this.osk=new Xn(this),si(this,this.osk,this.contextManager),this.pageIntegration=new li(window,this),String.kmwEnableSupplementaryPlane(!0),this.config.finalizeInit(),this.ui&&(this.ui.initialize(),this.legacyAPIEvents.callEvent("loaduserinterface",{})),this._initialized=2,[4,Promise.resolve()];case 3:return s.sent(),this.contextManager.restoreSavedKeyboard(r),[2]}})})},Object.defineProperty(t.prototype,"register",{get:function(){return this.keyboardRequisitioner.cloudQueryEngine.registerFromCloud},enumerable:!1,configurable:!0}),t.prototype.getUIState=function(){return this.contextManager.focusAssistant.getUIState()},t.prototype.activatingUI=function(e){this.contextManager.focusAssistant.setMaintainingFocus(!!e)},t.prototype.setKeyboardForControl=function(e,n,c){if(e instanceof e.ownerDocument.defaultView.HTMLIFrameElement){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}if(!this.isAttached(e)){console.error("KeymanWeb is not attached to element "+e);return}var l=null;if(n&&(l=this.keyboardRequisitioner.cache.getStub(n,c),!l))throw new Error("No keyboard has been registered with id ".concat(n," and language code ").concat(c,"."));this.contextManager.setKeyboardForTarget(e._kmwAttachment.interface,n,c)},t.prototype.getKeyboardForControl=function(e){var n=be(e);return this.contextManager.getKeyboardStubForTarget(n).id},t.prototype.getLanguageForControl=function(e){var n=be(e);return this.contextManager.getKeyboardStubForTarget(n).langId},t.prototype.isAttached=function(e){return this.contextManager.page.isAttached(e)},t.prototype.addKeyboards=function(){for(var e=this,n=[],c=0;c<arguments.length;c++)n[c]=arguments[c];return this.config.deferForInitialization.then(function(){if(!n||!n[0]||n[0].length==0)return e.keyboardRequisitioner.fetchCloudCatalog().catch(function(r){return console.error(r[0].error),r});var l=[];return Array.isArray(n[0])?l=l.concat(n[0]):Array.isArray(n)&&(l=l.concat(n)),e.keyboardRequisitioner.addKeyboardArray(l)})},t.prototype.addKeyboardsForLanguage=function(e){var n=this;return this.config.deferForInitialization.then(function(){return typeof e=="string"?n.keyboardRequisitioner.addLanguageKeyboards(e.split(",").map(function(c){return c.trim()})):n.keyboardRequisitioner.addLanguageKeyboards(e)})},t.prototype.isCJK=function(e){var n;if(e){var c=e;c.KeyboardID?n=this.keyboardRequisitioner.cache.getKeyboard(e.KeyboardID):n=new w(e)}else n=this.core.activeKeyboard;return n&&n.isCJK},t.prototype.getKeyboard=function(e,n){var c=this.keyboardRequisitioner.cache.getStub(e,n),l=this.keyboardRequisitioner.cache.getKeyboardForStub(c);return this._GetKeyboardDetail(c,l)},t.prototype.getKeyboards=function(){for(var e=[],n=this.keyboardRequisitioner.cache,c=n.getStubList(),l=0;l<c.length;l++){var r=c[l],s=n.getKeyboardForStub(r),B=this._GetKeyboardDetail(r,s);e.push(B)}return e},t.prototype.removeKeyboards=function(){for(var e,n=[],c=0;c<arguments.length;c++)n[c]=arguments[c];for(var l=0;l<n.length;l++)this.keyboardRequisitioner.cache.forgetKeyboard(n[l],!0),((e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata.id)==O(n[l])&&this.contextManager.activateKeyboard("","");return!0},t.prototype.getSavedKeyboard=function(){return this.contextManager.getSavedKeyboard()},t.prototype.focusLastActiveElement=function(){var e;(e=this.contextManager.lastActiveTarget)===null||e===void 0||e.focus()},t.prototype.getLastActiveElement=function(){var e;return(e=this.contextManager.lastActiveTarget)===null||e===void 0?void 0:e.getElement()},t.prototype.setActiveElement=function(e,n){if(typeof e=="string"){var c=e;if(e=document.getElementById(e),!e)throw new Error("Could not find the specified element (id: ".concat(c))}var l=be(e);if(!l)throw new Error("KMW is not attached to the specified element (id: ".concat(e.id,")."));this.contextManager.setActiveTarget(l,n)},t.prototype.moveToElement=function(e){typeof e=="string"&&(e=document.getElementById(e)),e.focus()},t.prototype.addHotKey=function(e,n,c){this.hotkeyManager.addHotKey(e,n,c)},t.prototype.removeHotKey=function(e,n){this.hotkeyManager.removeHotkey(e,n)},t.prototype.attachToControl=function(e){this.contextManager.page.attachToControl(e)},t.prototype.detachFromControl=function(e){this.contextManager.page.detachFromControl(e)},t.prototype.disableControl=function(e){this.contextManager.page.disableControl(e)},t.prototype.enableControl=function(e){this.contextManager.page.enableControl(e)},t.prototype.BuildVisualKeyboard=function(e,n,c,l){var r=null;e!=null&&(r=this.keyboardRequisitioner.cache.getKeyboard(e)),r=r||this.core.activeKeyboard;var s=this.keyboardRequisitioner.cache.getStub(r),B=this.getOskHeight,o=(typeof B=="function"?B():null)||this.osk.computedHeight||200;return Qe.buildDocumentationKeyboard(r,s,this.config.paths.fonts,c,l,o)},t.prototype.shutdown=function(){var e,n;this.pageIntegration.shutdown(),this.contextManager.shutdown(),(e=this.osk)===null||e===void 0||e.shutdown(),this.core.languageProcessor.shutdown(),this.hardKeyboard.shutdown(),this.util.shutdown(),this.legacyAPIEvents.callEvent("unloaduserinterface",{}),(n=this.ui)===null||n===void 0||n.shutdown()},t}(yn),Fi=ar;var yi=document.getElementsByTagName("script"),ui=yi[yi.length-1].src,gr=ui.substr(0,ui.lastIndexOf("/")+1);window.keyman=new Fi(on.constructInstance(),gr);})();
//# sourceMappingURL=keymanweb.js.map
