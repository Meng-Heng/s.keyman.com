(function(){var Sr=Object.create;var sn=Object.defineProperty;var Hr=Object.getOwnPropertyDescriptor;var Wr=Object.getOwnPropertyNames;var Nr=Object.getPrototypeOf,Er=Object.prototype.hasOwnProperty;var xi=function(c,e){return function(){return e||c((e={exports:{}}).exports,e),e.exports}},Gi=function(c,e){for(var t in e)sn(c,t,{get:e[t],enumerable:!0})},rn=function(c,e,t,n){if(e&&typeof e=="object"||typeof e=="function")for(var i=Wr(e),r=0,s=i.length,l;r<s;r++)l=i[r],!Er.call(c,l)&&l!==t&&sn(c,l,{get:function(o){return e[o]}.bind(null,l),enumerable:!(n=Hr(e,l))||n.enumerable});return c},ln=function(c,e,t){return rn(c,e,"default"),t&&rn(t,e,"default")},on=function(c,e,t){return t=c!=null?Sr(Nr(c)):{},rn(e||!c||!c.__esModule?sn(t,"default",{value:c,enumerable:!0}):t,c)};var gn=xi(function(yo,Ze){var pi,mi,Zi,Ji,Vi,vi,an,fi,Ri,me;(function(c){var e=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(n){c(t(e,t(n)))}):typeof Ze=="object"&&typeof Ze.exports=="object"?c(t(e,t(Ze.exports))):c(t(e));function t(n,i){return n!==e&&(typeof Object.create=="function"?Object.defineProperty(n,"__esModule",{value:!0}):n.__esModule=!0),function(r,s){return n[r]=i?i(r,s):s}}})(function(c){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])};pi=function(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)},mi=Object.assign||function(t){for(var n,i=1,r=arguments.length;i<r;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Zi=function(t,n,i,r){var s=arguments.length,l=s<3?n:r===null?r=Object.getOwnPropertyDescriptor(n,i):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,n,i,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(l=(s<3?o(l):s>3?o(n,i,l):o(n,i))||l);return s>3&&l&&Object.defineProperty(n,i,l),l},Ji=function(t,n,i,r){function s(l){return l instanceof i?l:new i(function(o){o(l)})}return new(i||(i=Promise))(function(l,o){function a(B){try{d(r.next(B))}catch(u){o(u)}}function g(B){try{d(r.throw(B))}catch(u){o(u)}}function d(B){B.done?l(B.value):s(B.value).then(a,g)}d((r=r.apply(t,n||[])).next())})},Vi=function(t,n){var i={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},r,s,l,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(d){return function(B){return g([d,B])}}function g(d){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,d[0]&&(i=0)),i;)try{if(r=1,s&&(l=d[0]&2?s.return:d[0]?s.throw||((l=s.return)&&l.call(s),0):s.next)&&!(l=l.call(s,d[1])).done)return l;switch(s=0,l&&(d=[d[0]&2,l.value]),d[0]){case 0:case 1:l=d;break;case 4:return i.label++,{value:d[1],done:!1};case 5:i.label++,s=d[1],d=[0];continue;case 7:d=i.ops.pop(),i.trys.pop();continue;default:if(l=i.trys,!(l=l.length>0&&l[l.length-1])&&(d[0]===6||d[0]===2)){i=0;continue}if(d[0]===3&&(!l||d[1]>l[0]&&d[1]<l[3])){i.label=d[1];break}if(d[0]===6&&i.label<l[1]){i.label=l[1],l=d;break}if(l&&i.label<l[2]){i.label=l[2],i.ops.push(d);break}l[2]&&i.ops.pop(),i.trys.pop();continue}d=n.call(t,i)}catch(B){d=[6,B],s=0}finally{r=l=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},vi=function(t){var n=typeof Symbol=="function"&&Symbol.iterator,i=n&&t[n],r=0;if(i)return i.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},an=function(t,n){var i=typeof Symbol=="function"&&t[Symbol.iterator];if(!i)return t;var r=i.call(t),s,l=[],o;try{for(;(n===void 0||n-- >0)&&!(s=r.next()).done;)l.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return l},fi=function(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(an(arguments[n]));return t},Ri=function(t,n,i){if(i||arguments.length===2)for(var r=0,s=n.length,l;r<s;r++)(l||!(r in n))&&(l||(l=Array.prototype.slice.call(n,0,r)),l[r]=n[r]);return t.concat(l||Array.prototype.slice.call(n))},me=function(t){return this instanceof me?(this.v=t,this):new me(t)},c("__extends",pi),c("__assign",mi),c("__decorate",Zi),c("__awaiter",Ji),c("__generator",Vi),c("__values",vi),c("__read",an),c("__spread",fi),c("__spreadArray",Ri),c("__await",me)})});var Si=xi(function(Uo,dn){"use strict";var kr=Object.prototype.hasOwnProperty,_="~";function ce(){}Object.create&&(ce.prototype=Object.create(null),new ce().__proto__||(_=!1));function Tr(c,e,t){this.fn=c,this.context=e,this.once=t||!1}function Ai(c,e,t,n,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var r=new Tr(t,n||c,i),s=_?_+e:e;return c._events[s]?c._events[s].fn?c._events[s]=[c._events[s],r]:c._events[s].push(r):(c._events[s]=r,c._eventsCount++),c}function Je(c,e){--c._eventsCount===0?c._events=new ce:delete c._events[e]}function M(){this._events=new ce,this._eventsCount=0}M.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)kr.call(t,n)&&e.push(_?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};M.prototype.listeners=function(e){var t=_?_+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,r=n.length,s=new Array(r);i<r;i++)s[i]=n[i].fn;return s};M.prototype.listenerCount=function(e){var t=_?_+e:e,n=this._events[t];return n?n.fn?1:n.length:0};M.prototype.emit=function(e,t,n,i,r,s){var l=_?_+e:e;if(!this._events[l])return!1;var o=this._events[l],a=arguments.length,g,d;if(o.fn){switch(o.once&&this.removeListener(e,o.fn,void 0,!0),a){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,t),!0;case 3:return o.fn.call(o.context,t,n),!0;case 4:return o.fn.call(o.context,t,n,i),!0;case 5:return o.fn.call(o.context,t,n,i,r),!0;case 6:return o.fn.call(o.context,t,n,i,r,s),!0}for(d=1,g=new Array(a-1);d<a;d++)g[d-1]=arguments[d];o.fn.apply(o.context,g)}else{var B=o.length,u;for(d=0;d<B;d++)switch(o[d].once&&this.removeListener(e,o[d].fn,void 0,!0),a){case 1:o[d].fn.call(o[d].context);break;case 2:o[d].fn.call(o[d].context,t);break;case 3:o[d].fn.call(o[d].context,t,n);break;case 4:o[d].fn.call(o[d].context,t,n,i);break;default:if(!g)for(u=1,g=new Array(a-1);u<a;u++)g[u-1]=arguments[u];o[d].fn.apply(o[d].context,g)}}return!0};M.prototype.on=function(e,t,n){return Ai(this,e,t,n,!1)};M.prototype.once=function(e,t,n){return Ai(this,e,t,n,!0)};M.prototype.removeListener=function(e,t,n,i){var r=_?_+e:e;if(!this._events[r])return this;if(!t)return Je(this,r),this;var s=this._events[r];if(s.fn)s.fn===t&&(!i||s.once)&&(!n||s.context===n)&&Je(this,r);else{for(var l=0,o=[],a=s.length;l<a;l++)(s[l].fn!==t||i&&!s[l].once||n&&s[l].context!==n)&&o.push(s[l]);o.length?this._events[r]=o.length===1?o[0]:o:Je(this,r)}return this};M.prototype.removeAllListeners=function(e){var t;return e?(t=_?_+e:e,this._events[t]&&Je(this,t)):(this._events=new ce,this._eventsCount=0),this};M.prototype.off=M.prototype.removeListener;M.prototype.addListener=M.prototype.on;M.prefixed=_;M.EventEmitter=M;typeof dn!="undefined"&&(dn.exports=M)});var Q={};Gi(Q,{tslib:function(){return Li}});ln(Q,on(gn(),1));var Li=on(gn(),1);var V=on(Si(),1);var at={modifierCodes:{LCTRL:1,RCTRL:2,LALT:4,RALT:8,SHIFT:16,CTRL:32,ALT:64,META:128,CAPS:256,NO_CAPS:512,NUM_LOCK:1024,NO_NUM_LOCK:2048,SCROLL_LOCK:4096,NO_SCROLL_LOCK:8192,VIRTUAL_KEY:16384,VIRTUAL_CHAR_KEY:32768},modifierBitmasks:{ALL:127,ALT_GR_SIM:5,CHIRAL:31,IS_CHIRAL:15,NON_CHIRAL:112,NON_LEGACY:111},stateBitmasks:{ALL:16128,CAPS:768,NUM_LOCK:3072,SCROLL_LOCK:12288},keyCodes:{K_BKSP:8,K_TAB:9,K_ENTER:13,K_SHIFT:16,K_CONTROL:17,K_ALT:18,K_PAUSE:19,K_CAPS:20,K_ESC:27,K_SPACE:32,K_PGUP:33,K_PGDN:34,K_END:35,K_HOME:36,K_LEFT:37,K_UP:38,K_RIGHT:39,K_DOWN:40,K_SEL:41,K_PRINT:42,K_EXEC:43,K_INS:45,K_DEL:46,K_HELP:47,K_0:48,K_1:49,K_2:50,K_3:51,K_4:52,K_5:53,K_6:54,K_7:55,K_8:56,K_9:57,K_A:65,K_B:66,K_C:67,K_D:68,K_E:69,K_F:70,K_G:71,K_H:72,K_I:73,K_J:74,K_K:75,K_L:76,K_M:77,K_N:78,K_O:79,K_P:80,K_Q:81,K_R:82,K_S:83,K_T:84,K_U:85,K_V:86,K_W:87,K_X:88,K_Y:89,K_Z:90,K_NP0:96,K_NP1:97,K_NP2:98,K_NP3:99,K_NP4:100,K_NP5:101,K_NP6:102,K_NP7:103,K_NP8:104,K_NP9:105,K_NPSTAR:106,K_NPPLUS:107,K_SEPARATOR:108,K_NPMINUS:109,K_NPDOT:110,K_NPSLASH:111,K_F1:112,K_F2:113,K_F3:114,K_F4:115,K_F5:116,K_F6:117,K_F7:118,K_F8:119,K_F9:120,K_F10:121,K_F11:122,K_F12:123,K_NUMLOCK:144,K_SCROLL:145,K_LSHIFT:160,K_RSHIFT:161,K_LCONTROL:162,K_RCONTROL:163,K_LALT:164,K_RALT:165,K_COLON:186,K_EQUAL:187,K_COMMA:188,K_HYPHEN:189,K_PERIOD:190,K_SLASH:191,K_BKQUOTE:192,K_LBRKT:219,K_BKSLASH:220,K_RBRKT:221,K_QUOTE:222,K_oE2:226,K_OE2:226,K_LOPT:50001,K_ROPT:50002,K_NUMERALS:50003,K_SYMBOLS:50004,K_CURRENCIES:50005,K_UPPER:50006,K_LOWER:50007,K_ALPHA:50008,K_SHIFTED:50009,K_ALTGR:50010,K_TABBACK:50011,K_TABFWD:50012},codesUS:[["0123456789",";=,-./`","[\\]'"],[")!@#$%^&*(",":+<_>?~",'{|}"']],isFrameKey:function(c){switch(c){case"K_SHIFT":case"K_LOPT":case"K_ROPT":case"K_NUMLOCK":case"K_CAPS":return!0;default:if(at.keyCodes[c]>=5e4)return!0}return!1},getModifierState:function(c){var e=0;c.indexOf("shift")>=0&&(e|=at.modifierCodes.SHIFT);var t=!1;c.indexOf("leftctrl")>=0&&(e|=at.modifierCodes.LCTRL,t=!0),c.indexOf("rightctrl")>=0&&(e|=at.modifierCodes.RCTRL,t=!0),c.indexOf("ctrl")>=0&&!t&&(e|=at.modifierCodes.CTRL);var n=!1;return c.indexOf("leftalt")>=0&&(e|=at.modifierCodes.LALT,n=!0),c.indexOf("rightalt")>=0&&(e|=at.modifierCodes.RALT,n=!0),c.indexOf("alt")>=0&&!n&&(e|=at.modifierCodes.ALT),e},getStateFromLayer:function(c){var e=0;return c.indexOf("caps")>=0?e|=at.modifierCodes.CAPS:e|=at.modifierCodes.NO_CAPS,e}},h=at;var Rt;(function(c){c.Enter="\n",c.Backspace="\b"})(Rt||(Rt={}));var Yr=function(){function c(){}return c.prototype.codeForEvent=function(e){return h.keyCodes[e.kName]||e.Lcode},c.prototype.forAny=function(e,t,n){var i="";if((i=this.forSpecialEmulation(e))!=null)return i;if(!t&&(i=this.forNumpadKeys(e))!=null)return i;if((i=this.forUnicodeKeynames(e,n))!=null)return i;if((i=this.forBaseKeys(e,n))!=null)return i;var r=this.codeForEvent(e);switch(r){default:return null}},c.prototype.isCommand=function(e){var t=this.codeForEvent(e);switch(t){default:return!1}},c.prototype.applyCommand=function(e,t){},c.prototype.forSpecialEmulation=function(e){var t=this.codeForEvent(e);switch(t){case h.keyCodes.K_BKSP:return Rt.Backspace;case h.keyCodes.K_ENTER:return Rt.Enter;default:return null}},c.prototype.forNumpadKeys=function(e){if(e.Lcode>=h.keyCodes.K_NP0&&e.Lcode<=h.keyCodes.K_NPSLASH){if(e.Lcode<106)var t=e.Lcode-48;else t=e.Lcode-64;var n=String._kmwFromCharCode(t);return n}else return null},c.prototype.forUnicodeKeynames=function(e,t){var n=e.kName;if(!n||n.substr(0,2)!="U_")return null;for(var i="",r=n.substr(2).split("_"),s=0,l=r;s<l.length;s++){var o=l[s],a=parseInt(o,16);if(0<=a&&a<=31||128<=a&&a<=159||isNaN(a)){t&&(t.errorLog="Suppressing Unicode control code in "+n);continue}else i+=String.kmwFromCharCode(a)}return i||null},c.prototype.forBaseKeys=function(e,t){var n=e.Lcode,i=e.Lmodifiers;if(i==h.modifierCodes.SHIFT)i=1;else if(i!=0)return t&&(t.warningLog="KMW only defines default key output for the 'default' and 'shift' layers!"),null;try{if(n==h.keyCodes.K_SPACE)return" ";if(n>=h.keyCodes.K_0&&n<=h.keyCodes.K_9)return h.codesUS[i][0][n-h.keyCodes.K_0];if(n>=h.keyCodes.K_A&&n<=h.keyCodes.K_Z)return String.fromCharCode(n+(i?0:32));if(n>=h.keyCodes.K_COLON&&n<=h.keyCodes.K_BKQUOTE)return h.codesUS[i][1][n-h.keyCodes.K_COLON];if(n>=h.keyCodes.K_LBRKT&&n<=h.keyCodes.K_QUOTE)return h.codesUS[i][2][n-h.keyCodes.K_LBRKT];if(n==h.keyCodes.K_oE2)return i?"|":"\\"}catch(r){t&&(t.errorLog="Error detected with default mapping for key:  code = "+n+", shift state = "+(i==1?"shift":"default"))}return null},c}(),kt=Yr;var wr=new kt,Dr=function(){function c(e){this.isSynthetic=!0;for(var t in e)e[t]!==void 0&&(this[t]=e[t])}return c.constructNullKeyEvent=function(e){var t=new c({Lcode:0,kName:"",device:e,Lstates:void 0,Lmodifiers:void 0,vkCode:void 0,LisVirtualKey:void 0});return t},Object.defineProperty(c.prototype,"isModifier",{get:function(){switch(this.Lcode){case 16:case 17:case 18:case 20:case 144:case 145:return!0;default:return!1}},enumerable:!1,configurable:!0}),c.prototype.setMnemonicCode=function(e,t){if(this.Lcode!=h.keyCodes.K_SPACE){var n=new c(this);for(var i in this)n[i]=this[i];n.kName="K_xxxx",n.Lmodifiers=e?16:0;var r=wr.forAny(n,!0);this.vkCode=this.Lcode,r?this.Lcode=r.charCodeAt(0):this.isModifier||delete this.Lcode}t&&(this.Lcode>=65&&this.Lcode<=90||this.Lcode>=97&&this.Lcode<=122)&&(this.Lmodifiers^=16,this.Lcode^=32)},c}(),gt=Dr;var Tt=function(){function c(){}return c}(),Mr=function(){function c(){this.FF=new Tt,this.Safari=new Tt,this.Opera=new Tt,this.FF.k61=187,this.FF.k59=186,this.FF.k173=189}return c}(),zr=function(){function c(){this.se=new Tt,this.se.k220=192,this.se.k187=189,this.se.k219=187,this.se.k221=219,this.se.k186=221,this.se.k191=220,this.se.k192=186,this.se.k189=191,this.uk=new Tt,this.uk.k223=192,this.uk.k192=222,this.uk.k222=226,this.uk.k220=220}return c}(),Kr=function(){function c(){}return c._usCodeInit=function(){var e=new Tt,t=new Tt;e.k192=96,e.k49=49,e.k50=50,e.k51=51,e.k52=52,e.k53=53,e.k54=54,e.k55=55,e.k56=56,e.k57=57,e.k48=48,e.k189=45,e.k187=61,e.k81=113,e.k87=119,e.k69=101,e.k82=114,e.k84=116,e.k89=121,e.k85=117,e.k73=105,e.k79=111,e.k80=112,e.k219=91,e.k221=93,e.k220=92,e.k65=97,e.k83=115,e.k68=100,e.k70=102,e.k71=103,e.k72=104,e.k74=106,e.k75=107,e.k76=108,e.k186=59,e.k222=39,e.k90=122,e.k88=120,e.k67=99,e.k86=118,e.k66=98,e.k78=110,e.k77=109,e.k188=44,e.k190=46,e.k191=47,t.k192=126,t.k49=33,t.k50=64,t.k51=35,t.k52=36,t.k53=37,t.k54=94,t.k55=38,t.k56=42,t.k57=40,t.k48=41,t.k189=95,t.k187=43,t.k81=81,t.k87=87,t.k69=69,t.k82=82,t.k84=84,t.k89=89,t.k85=85,t.k73=73,t.k79=79,t.k80=80,t.k219=123,t.k221=125,t.k220=124,t.k65=65,t.k83=83,t.k68=68,t.k70=70,t.k71=71,t.k72=72,t.k74=74,t.k75=75,t.k76=76,t.k186=58,t.k222=34,t.k90=90,t.k88=88,t.k67=67,t.k86=86,t.k66=66,t.k78=78,t.k77=77,t.k188=60,t.k190=62,t.k191=63,c._usCharCodes=[e,t]},c._USKeyCodeToCharCode=function(e){return c.usCharCodes[e.Lmodifiers&16?1:0]["k"+e.Lcode]},Object.defineProperty(c,"usCharCodes",{get:function(){return c._usCharCodes||c._usCodeInit(),c._usCharCodes},enumerable:!1,configurable:!0}),c.browserMap=new Mr,c.languageMap=new zr,c}(),dt=Kr;function $(c){if(typeof c!="object"||!c)return c;for(var e=Array.isArray(c)?[]:{},t=Object.keys(c),n=0,i=t;n<i.length;n++){var r=i[n];c[r]!==void 0&&(e[r]=$(c[r]))}return e}var re=function(){function c(e,t,n,i){switch(e.toLowerCase()){case c.Browser.Chrome:case c.Browser.Edge:case c.Browser.Firefox:case c.Browser.Native:case c.Browser.Opera:case c.Browser.Safari:this.browser=e.toLowerCase();break;default:this.browser=c.Browser.Other}switch(t.toLowerCase()){case c.FormFactor.Desktop:case c.FormFactor.Phone:case c.FormFactor.Tablet:this.formFactor=t.toLowerCase();break;default:throw"Invalid form factor specified for device: "+t}switch(n.toLowerCase()){case c.OperatingSystem.Windows.toLowerCase():case c.OperatingSystem.macOS.toLowerCase():case c.OperatingSystem.Linux.toLowerCase():case c.OperatingSystem.Android.toLowerCase():case c.OperatingSystem.iOS.toLowerCase():this.OS=n.toLowerCase();break;default:this.OS=c.OperatingSystem.Other}this.touchable=i}return c}();(function(c){var e;(function(i){i.Chrome="chrome",i.Edge="edge",i.Firefox="firefox",i.Native="native",i.Opera="opera",i.Safari="safari",i.Other="other"})(e=c.Browser||(c.Browser={}));var t;(function(i){i.Windows="windows",i.macOS="macosx",i.Linux="linux",i.Android="android",i.iOS="ios",i.Other="other"})(t=c.OperatingSystem||(c.OperatingSystem={}));var n;(function(i){i.Desktop="desktop",i.Phone="phone",i.Tablet="tablet"})(n=c.FormFactor||(c.FormFactor={}))})(re||(re={}));function Qn(c){return new re(c.browser,re.FormFactor.Desktop,c.OS,!1)}var v=re;var Bn=function(){function c(){}return c.VERSION="18.0.48",c.VERSION_RELEASE="18.0",c.VERSION_MAJOR="18",c.VERSION_MINOR="0",c.VERSION_PATCH="48",c.TIER="alpha",c.VERSION_TAG="-alpha",c.VERSION_WITH_TAG="18.0.48-alpha",c.VERSION_ENVIRONMENT="alpha",c.VERSION_GIT_TAG="release@18.0.48-alpha",c}();var Lt=Bn;var Or=function(){function c(e){if(e==null){this.components=[].concat(c.DEVELOPER_VERSION_FALLBACK.components);return}if(Array.isArray(e)){var t=e;if(t.length<2)throw new Error("Version string must have at least a major and minor component!");this.components=[].concat(t);return}var n=e.split("."),i=[];if(n.length<2)throw new Error("Version string must have at least a major and minor component!");for(var r=0;r<n.length;r++){var s=parseInt(n[r],10);if(isNaN(s))throw new Error("Version string components must be numerical!");i.push(s)}this.components=i}return Object.defineProperty(c.prototype,"major",{get:function(){return this.components[0]},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"minor",{get:function(){return this.components[1]},enumerable:!1,configurable:!0}),c.prototype.toString=function(){return this.components.join(".")},c.prototype.toJSON=function(){return this.toString()},c.prototype.equals=function(e){return this.compareTo(e)==0},c.prototype.precedes=function(e){return this.compareTo(e)<0},c.prototype.compareTo=function(e){var t=this.components.length<e.components.length,n=this.components.length<e.components.length?this.components.length:e.components.length,i;for(i=0;i<n;i++){var r=this.components[i]-e.components[i];if(r!=0)return r}var s=t?e.components:this.components;do{if(s[i]>0)return t?-1:1;i++}while(i<s.length);return 0},c.CURRENT=new c(Lt.VERSION_RELEASE),c.DEVELOPER_VERSION_FALLBACK=new c([9,0,0]),c.NO_DEFAULT_KEYCAPS=new c([12,0]),c.MAC_POSSIBLE_IPAD_ALIAS=new c([10,15]),c}(),tt=Or;function Ot(){return typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof self!="undefined"?self:global}function se(){String.kmwFromCharCode=function(c){var e=[],t;for(t=0;t<arguments.length;t++){var n=Number(arguments[t]);if(!isFinite(n)||n<0||n>1114111||Math.floor(n)!==n)throw new RangeError("Invalid code point "+n);n<65536?e.push(n):(n-=65536,e.push((n>>10)+55296),e.push(n%1024+56320))}return String.fromCharCode.apply(void 0,e)},String.prototype.kmwCharCodeAt=function(c){var e=String(this),t=0;if(c<0||c>=e.length)return NaN;for(var n=0;n<c;n++)if(t=e.kmwNextChar(t),t===null)return NaN;var i=e.charCodeAt(t);if(i>=55296&&i<=56319&&e.length>t+1){var r=e.charCodeAt(t+1);if(r>=56320&&r<=57343)return(i-55296<<10)+(r-56320)+65536}return i},String.prototype.kmwIndexOf=function(c,e){var t=String(this),n=t.indexOf(c,e);if(n<0)return n;for(var i=0,r=0;r!==null&&r<n;r=t.kmwNextChar(r))i++;return i},String.prototype.kmwLastIndexOf=function(c,e){var t=String(this),n=t.lastIndexOf(c,e);if(n<0)return n;for(var i=0,r=0;r!==null&&r<n;r=t.kmwNextChar(r))i++;return i},String.prototype.kmwLength=function(){var c=String(this);if(c.length==0)return 0;for(var e=0,t=0;t!==null;e++)t=c.kmwNextChar(t);return e},String.prototype.kmwSlice=function(c,e){var t=String(this),n=t.kmwCodePointToCodeUnit(c),i=t.kmwCodePointToCodeUnit(e);return n===null||i===null?"":t.slice(n,i)},String.prototype.kmwSubstr=function(c,e){var t=String(this);c<0&&(c=t.kmwLength()+c),c<0&&(c=0);var n=t.kmwCodePointToCodeUnit(c),i=n;if(n===null)return"";if(arguments.length<2)i=t.length;else for(var r=0;r<e;r++)i=t.kmwNextChar(i);return i===null?t.substring(n):t.substring(n,i)},String.prototype.kmwSubstring=function(c,e){var t=String(this),n,i;if(typeof e=="undefined")n=t.kmwCodePointToCodeUnit(c),i=t.length;else{if(c>e){var r=c;c=e,e=r}n=t.kmwCodePointToCodeUnit(c),i=t.kmwCodePointToCodeUnit(e)}return(isNaN(n)||n===null)&&(n=0),(isNaN(i)||i===null)&&(i=t.length),t.substring(n,i)},String.prototype.kmwNextChar=function(c){var e=String(this);if(c===null||c<0||c>=e.length-1)return null;var t=e.charCodeAt(c);if(t>=55296&&t<=56319&&e.length>c+1){var n=e.charCodeAt(c+1);if(n>=56320&&n<=57343)return c==e.length-2?null:c+2}return c+1},String.prototype.kmwPrevChar=function(c){var e=String(this);if(c==null||c<=0||c>e.length)return null;var t=e.charCodeAt(c-1);if(t>=56320&&t<=57343&&c>1){var n=e.charCodeAt(c-2);if(n>=55296&&n<=56319)return c-2}return c-1},String.prototype.kmwCodePointToCodeUnit=function(c){if(c===null)return null;var e=String(this),t=0;if(c<0){t=e.length;for(var n=0;n>c;n--)t=e.kmwPrevChar(t);return t}if(c==e.kmwLength())return e.length;for(var n=0;n<c;n++)t=e.kmwNextChar(t);return t},String.prototype.kmwCodeUnitToCodePoint=function(c){var e=String(this);return c===null?null:c==0?0:c<0?e.substr(c).kmwLength():e.substr(0,c).kmwLength()},String.prototype.kmwCharAt=function(c){var e=String(this);return c>=0?e.kmwSubstr(c,1):""},String.prototype.kmwBMPNextChar=function(c){var e=String(this);return c<0||c>=e.length-1?null:c+1},String.prototype.kmwBMPPrevChar=function(c){var e=String(this);return c<=0||c>e.length?null:c-1},String.prototype.kmwBMPCodePointToCodeUnit=function(c){return c},String.prototype.kmwBMPCodeUnitToCodePoint=function(c){return c},String.prototype.kmwBMPLength=function(){var c=String(this);return c.length},String.prototype.kmwBMPSubstr=function(c,e){var t=String(this);return c>-1?t.substr(c,e):t.substr(t.length+c,-c)},String.kmwEnableSupplementaryPlane=function(c){var e=String.prototype;String._kmwFromCharCode=c?String.kmwFromCharCode:String.fromCharCode,e._kmwCharAt=c?e.kmwCharAt:e.charAt,e._kmwCharCodeAt=c?e.kmwCharCodeAt:e.charCodeAt,e._kmwIndexOf=c?e.kmwIndexOf:e.indexOf,e._kmwLastIndexOf=c?e.kmwLastIndexOf:e.lastIndexOf,e._kmwSlice=c?e.kmwSlice:e.slice,e._kmwSubstring=c?e.kmwSubstring:e.substring,e._kmwSubstr=c?e.kmwSubstr:e.kmwBMPSubstr,e._kmwLength=c?e.kmwLength:e.kmwBMPLength,e._kmwNextChar=c?e.kmwNextChar:e.kmwBMPNextChar,e._kmwPrevChar=c?e.kmwPrevChar:e.kmwBMPPrevChar,e._kmwCodePointToCodeUnit=c?e.kmwCodePointToCodeUnit:e.kmwBMPCodePointToCodeUnit,e._kmwCodeUnitToCodePoint=c?e.kmwCodeUnitToCodePoint:e.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}se();var _r=function(){function c(e){var t=this;this._isFulfilled=!1,this._isRejected=!1,this._promise=new Promise(function(n,i){t._resolve=function(r){t._isFulfilled=!0,n(r)},t._reject=function(r){t._isRejected=!0,i(r)},e&&e(t._resolve,t._reject)})}return Object.defineProperty(c.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isFulfilled",{get:function(){return this._isFulfilled},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isRejected",{get:function(){return this._isRejected},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isResolved",{get:function(){return this.isFulfilled||this.isRejected},enumerable:!1,configurable:!0}),c.prototype.then=function(e,t){return this._promise.then(e,t)},c.prototype.catch=function(e){return this._promise.catch(e)},c.prototype.finally=function(e){return this._promise.finally(e)},Object.defineProperty(c.prototype,"corePromise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),c}(),A=_r;var Hi=function(c){(0,Q.__extends)(e,c);function e(t){var n=this,i=null;n=c.call(this,function(l){var o=setTimeout(function(){n.isResolved||l(!0)},t);i=o})||this,n.timerHandle=i;var r=n._resolve;n._resolve=function(l){clearTimeout(n.timerHandle),r(l)};var s=n._reject;return n._reject=function(l){clearTimeout(n.timerHandle),s(l)},n}return e}(A),le=Hi,Qt=function(c){var e=new Hi(c);return e.corePromise};var Pr=55296,jr=56319,qr=56320,$r=57343;function Ve(c){return c>=Pr&&c<=jr}function ve(c){return c>=qr&&c<=$r}var ts=200,D=function(){function c(){}return c.buildDefaultLayout=function(e,t,n){var i,r=n;typeof c.dfltLayout[r]!="object"&&(r="desktop");var s=h.modifierBitmasks.NON_CHIRAL,l=tt.CURRENT;t&&(s=t.modifierBitmask,l=t.compilerVersion),e||(e=this.DEFAULT_RAW_SPEC);var o=$(c.dfltLayout[r]),a,g=o.layer,d=e.KLS,B=e.K102,u,y,I,F,U,b,C=(s&h.modifierBitmasks.IS_CHIRAL)!=0;if(e.F){var X=/^(?:(?:italic|bold) )* *[0-9.eE-]+(?:[a-z]+) "(.+)"$/.exec(e.F);X&&(o.font=X[1])}var Z=!(typeof d=="undefined"||!d);Z||(d=e.KLS=c.processLegacyDefinitions(e.BK));var G=Object.getOwnPropertyNames(d),p=[];if(G.splice(G.indexOf("default"),1),G=["default"].concat(G),t&&t.emulatesAltGr&&(G.indexOf("leftctrl-leftalt")==-1&&G.indexOf("rightalt")!=-1&&(G.push("leftctrl-leftalt"),d["leftctrl-leftalt"]=d.rightalt),G.indexOf("leftctrl-leftalt-shift")==-1&&G.indexOf("rightalt-shift")!=-1&&(G.push("leftctrl-leftalt-shift"),d["leftctrl-leftalt-shift"]=d["rightalt-shift"])),o.displayUnderlying=t?!!t.scriptObject.KDU:!1,n=="desktop")for(p=c.generateLayerIds(C),a=0;a<p.length;a++)G.indexOf(p[a])!=-1&&p.splice(a--,1);var f=G.concat(p);if(Z&&n!="desktop"){var m=null;F=g[0].row;for(var x=0;x<F.length;x++){b=F[x].key;for(var R=0;R<b.length;R++)U=b[R],U.id=="K_SHIFT"&&(m=U)}if(m){m.sk=[];for(var k in d)if(!(k=="default"||k=="shift")){var W=c.modifierSpecials[k],T={id:"K_".concat(W),text:W,sp:1,nextlayer:k};m.sk.push(T)}}else console.warn("Error in default layout - cannot find default Shift key!")}for(a=0;a<f.length;a++)a>0&&(g[a]=$(g[0])),g[a].id=f[a],g[a].nextlayer=f[a],c.formatDefaultLayer(g[a],C,n,!!B);for(a=0;a<g.length;a++){var L=g[a],S,m=null,H=null,N=null,ot=null,it=d[L.id],Kt=L.id=="shift"?1:0,ie=L.id=="default"||Kt?1:0;for(F=L.row,u=0;u<F.length;u++)for(b=F[u].key,y=0;y<b.length;y++){switch(U=b[y],S=c.dfltCodes.indexOf(U.id),(it||ie)&&(it&&S>=0&&S<it.length&&(U.text=it[S]),ie&&l.precedes(tt.NO_DEFAULT_KEYCAPS)&&U.id!="K_SPACE"&&S+65*Kt<c.dfltText.length&&U.text!==null&&(U.text=U.text||c.dfltText[S+65*Kt])),U.text!==null&&(U.text=U.text||""),U.id){case"K_SHIFT":m=U;break;case"K_CAPS":H=U;break;case"K_NUMLOCK":N=U;break;case"K_SCROLL":ot=U;break}if(U.sk!=null){for(I=0;I<U.sk.length;I++)G.indexOf(U.sk[I].nextlayer)==-1&&U.sk.splice(I--,1);U.sk.length==0&&(U.sk=null)}}L.shiftKey=m,L.capsKey=H,L.numKey=N,L.scrollKey=ot;var cn=g[a].id;n!="desktop"&&a>0&&m!=null&&(m.sp=2,m.sk=null,m.text=(i=c.modifierSpecials[cn])!==null&&i!==void 0?i:"*Shift*")}return o},c.getLayerId=function(e){var t=h.modifierCodes,n="";return e==0?"default":(e&t.LCTRL&&(n=(n.length>0?n+"-":"")+"leftctrl"),e&t.RCTRL&&(n=(n.length>0?n+"-":"")+"rightctrl"),e&t.LALT&&(n=(n.length>0?n+"-":"")+"leftalt"),e&t.RALT&&(n=(n.length>0?n+"-":"")+"rightalt"),e&t.SHIFT&&(n=(n.length>0?n+"-":"")+"shift"),e&t.CTRL&&(n=(n.length>0?n+"-":"")+"ctrl"),e&t.ALT&&(n=(n.length>0?n+"-":"")+"alt"),n)},c.generateLayerIds=function(e){var t,n;e?(t=32,n=1):(t=8,n=16);for(var i=[],r=0;r<t;r++)i.push(c.getLayerId(r*n));return i},c.formatDefaultLayer=function(e,t,n,i){for(var r=e.id,s=0;s<e.row.length;s++)for(var l=e.row[s],o=l.key,a=0;a<o.length;a++){var g=o[a];switch(g.id){case"K_SHIFT":case"K_LSHIFT":case"K_RSHIFT":r.indexOf("shift")!=-1&&(g.sp=2),n!="desktop"&&(r!="default"?g.nextlayer="default":g.nextlayer="shift");break;case"K_LCTRL":case"K_LCONTROL":if(t){r.indexOf("leftctrl")!=-1&&(g.sp=2);break}case"K_RCTRL":case"K_RCONTROL":if(t){r.indexOf("rightctrl")!=-1&&(g.sp=2);break}case"K_CONTROL":r.indexOf("ctrl")!=-1&&(!t||r.indexOf("leftctrl")!=-1&&r.indexOf("rightctrl")!=-1)&&(g.sp=2);break;case"K_LALT":if(t){r.indexOf("leftalt")!=-1&&(g.sp=2);break}case"K_RALT":if(t){r.indexOf("rightalt")!=-1&&(g.sp=2);break}case"K_ALT":r.indexOf("alt")!=-1&&(!t||r.indexOf("leftalt")!=-1&&r.indexOf("rightalt")!=-1)&&(g.sp=2);break;case"K_oE2":(typeof i=="undefined"||!i)&&(n=="desktop"?(o.splice(a--,1),o[0].width=ts):o[a].sp=10);break}}},c.processLegacyDefinitions=function(e){for(var t=c.generateLayerIds(!1),n={},i=0;i<t.length;i++){for(var r=t[i],s=[],l=!1,o=0;o<65;o++){var a=o+65*i;s.push(e[a]),a<e.length&&e[a]!=""&&o!=c.dfltCodes.indexOf("K_SPACE")&&(l=!0)}l&&(n[r]=s)}return(typeof n.default=="undefined"||!n.default)&&(n.default=[""]),(typeof n.shift=="undefined"||!n.shift)&&(n.shift=[""]),n},c.dfltCodes=["K_BKQUOTE","K_1","K_2","K_3","K_4","K_5","K_6","K_7","K_8","K_9","K_0","K_HYPHEN","K_EQUAL","K_*","K_*","K_*","K_Q","K_W","K_E","K_R","K_T","K_Y","K_U","K_I","K_O","K_P","K_LBRKT","K_RBRKT","K_BKSLASH","K_*","K_*","K_*","K_A","K_S","K_D","K_F","K_G","K_H","K_J","K_K","K_L","K_COLON","K_QUOTE","K_*","K_*","K_*","K_*","K_*","K_oE2","K_Z","K_X","K_C","K_V","K_B","K_N","K_M","K_COMMA","K_PERIOD","K_SLASH","K_*","K_*","K_*","K_*","K_*","K_SPACE"],c.dfltText="`1234567890-=\xA7~~qwertyuiop[]\\~~~asdfghjkl;'~~~~~?zxcvbnm,./~~~~~ ~!@#$%^&*()_+\xA7~~QWERTYUIOP{}\\~~~ASDFGHJKL:\"~~~~~?ZXCVBNM<>?~~~~~ ",c.DEFAULT_RAW_SPEC={F:"Tahoma",BK:c.dfltText.split("")},c.modifierSpecials={leftalt:"*LAlt*",rightalt:"*RAlt*",alt:"*Alt*",leftctrl:"*LCtrl*",rightctrl:"*RCtrl*",ctrl:"*Ctrl*","ctrl-alt":"*AltGr*","leftctrl-leftalt":"*LAltCtrl*","rightctrl-rightalt":"*RAltCtrl*","leftctrl-leftalt-shift":"*LAltCtrlShift*","rightctrl-rightalt-shift":"*RAltCtrlShift*",shift:"*Shift*","shift-alt":"*AltShift*","shift-ctrl":"*CtrlShift*","shift-ctrl-alt":"*AltCtrlShift*","leftalt-shift":"*LAltShift*","rightalt-shift":"*RAltShift*","leftctrl-shift":"*LCtrlShift*","rightctrl-shift":"*RCtrlShift*"},c.dfltShiftToCaps={id:"T_*_MT_SHIFT_TO_CAPS",text:"*ShiftLock*",sp:1,nextlayer:"caps"},c.dfltShiftToDefault={id:"T_*_MT_SHIFT_TO_DEFAULT",text:"*Shift*",sp:1,nextlayer:"default"},c.dfltShiftToShift={id:"T_*_MT_SHIFT_TO_SHIFT",text:"*Shift*",sp:1,nextlayer:"shift"},c.dfltLayout={desktop:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:1,key:[{id:"K_BKQUOTE"},{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{id:"K_BKSP",text:"*BkSp*",sp:1,width:130}]},{id:2,key:[{id:"K_TAB",text:"*Tab*",sp:1,width:130},{id:"K_Q"},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{id:"K_BKSLASH"}]},{id:3,key:[{id:"K_CAPS",text:"*Caps*",sp:1,width:165},{id:"K_A"},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_ENTER",text:"*Enter*",sp:1,width:165}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:130},{id:"K_oE2"},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_RSHIFT",text:"*Shift*",sp:1,width:130}]},{id:5,key:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:170},{id:"K_LALT",text:"*Alt*",sp:1,width:160},{id:"K_SPACE",text:"",width:770},{id:"K_RALT",text:"*Alt*",sp:1,width:160},{id:"K_RCONTROL",text:"*Ctrl*",sp:1,width:170}]}]}]},tablet:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",sp:1,width:150},{id:"K_SPACE",text:"",width:570},{id:"K_BKSP",text:"*BkSp*",sp:1,width:150},{id:"K_ENTER",text:"*Enter*",sp:1,width:200}]}]}]},phone:{defaultHint:"dot",font:"Tahoma,Helvetica",layer:[{id:"default",row:[{id:0,key:[{id:"K_1"},{id:"K_2"},{id:"K_3"},{id:"K_4"},{id:"K_5"},{id:"K_6"},{id:"K_7"},{id:"K_8"},{id:"K_9"},{id:"K_0"},{id:"K_HYPHEN"},{id:"K_EQUAL"},{sp:10,width:1}]},{id:1,key:[{id:"K_Q",pad:25},{id:"K_W"},{id:"K_E"},{id:"K_R"},{id:"K_T"},{id:"K_Y"},{id:"K_U"},{id:"K_I"},{id:"K_O"},{id:"K_P"},{id:"K_LBRKT"},{id:"K_RBRKT"},{sp:10,width:1}]},{id:2,key:[{id:"K_A",pad:50},{id:"K_S"},{id:"K_D"},{id:"K_F"},{id:"K_G"},{id:"K_H"},{id:"K_J"},{id:"K_K"},{id:"K_L"},{id:"K_COLON"},{id:"K_QUOTE"},{id:"K_BKSLASH",width:90}]},{id:3,key:[{id:"K_oE2",width:90},{id:"K_Z"},{id:"K_X"},{id:"K_C"},{id:"K_V"},{id:"K_B"},{id:"K_N"},{id:"K_M"},{id:"K_COMMA"},{id:"K_PERIOD"},{id:"K_SLASH"},{id:"K_BKQUOTE"},{sp:10,width:1}]},{id:4,key:[{id:"K_SHIFT",text:"*Shift*",sp:1,width:200,sk:[{id:"K_LCONTROL",text:"*Ctrl*",sp:1,width:50,nextlayer:"ctrl"},{id:"K_LCONTROL",text:"*LCtrl*",sp:1,width:50,nextlayer:"leftctrl"},{id:"K_RCONTROL",text:"*RCtrl*",sp:1,width:50,nextlayer:"rightctrl"},{id:"K_LALT",text:"*Alt*",sp:1,width:50,nextlayer:"alt"},{id:"K_LALT",text:"*LAlt*",sp:1,width:50,nextlayer:"leftalt"},{id:"K_RALT",text:"*RAlt*",sp:1,width:50,nextlayer:"rightalt"},{id:"K_ALTGR",text:"*AltGr*",sp:1,width:50,nextlayer:"ctrl-alt"}]},{id:"K_LOPT",text:"*Menu*",width:150,sp:1},{id:"K_SPACE",width:570,text:""},{id:"K_BKSP",text:"*BkSp*",width:150,sp:1},{id:"K_ENTER",text:"*Enter*",width:200,sp:1}]}]}]}},c}();function Xt(c,e,t){t.enumerable=!0}var Wi={id:"string",text:"string",layer:"string",nextlayer:"string",font:"string",fontsize:"string",sp:"number",pad:"number",width:"number",sk:"subkeys",flick:"flicks",multitap:"subkeys",hint:"string",default:"boolean"},Ni=["n","ne","e","se","s","sw","w","nw"];function fe(c,e){var t=Object.getPrototypeOf(e);for(var n in e)if(!c.hasOwnProperty(n)){var i=Object.getOwnPropertyDescriptor(t,n);i?Object.defineProperty(c,n,i):c[n]=e[n]}return c}var un=function(){function c(){this.isMnemonic=!1}return Object.defineProperty(c.prototype,"baseKeyID",{get:function(){if(typeof this.id!="undefined")return this.id},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isPadding",{get:function(){return this.sp==10},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"coreID",{get:function(){if(typeof this.id!="undefined"){var e=this.id||"";return this.displayLayer!=this.layer&&(e=e+"+"+this.layer),e}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"elementID",{get:function(){if(typeof this.id!="undefined")return this.displayLayer+"-"+this.coreID},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"baseKeyEvent",{get:function(){return new gt(this._baseKeyEvent)},enumerable:!1,configurable:!0}),c.unicodeIDToText=function(e,t){if(!e||e.substring(0,2)!="U_")return null;for(var n="",i=e.substring(2).split("_"),r=0,s=i;r<s.length;r++){var l=s[r],o=parseInt(l,16);if(0<=o&&o<=31||128<=o&&o<=159||isNaN(o)){t&&t(l);continue}else n+=String.kmwFromCharCode(o)}return n||null},c.sanitize=function(e){typeof e.width=="string"&&(e.width=parseInt(e.width,10)),e.width||(e.width=P.DEFAULT_KEY_WIDTH),typeof e.pad=="string"&&(e.pad=parseInt(e.pad,10)),e.pad||(e.pad=P.DEFAULT_PAD),typeof e.sp=="string"&&(e.sp=Number.parseInt(e.sp,10)),e.sp||(e.sp=P.DEFAULT_KEY.sp);for(var t=0,n=Object.keys(Wi);t<n.length;t++){var i=n[t],r=Wi[i];switch(r){case"subkeys":var s=e[i];if(!Array.isArray(s))delete e[i];else for(var l=0;l<s.length;l++){var o=s[l];typeof o!="object"?s.splice(l--,1):P.sanitize(o)}break;case"flicks":var a=e[i];if(typeof a!="object")delete e[i];else for(var g=0,d=Ni;g<d.length;g++){var B=d[g],o=a[B];typeof o!="object"?delete a[B]:P.sanitize(o)}break;default:var u=e[i];typeof u!=r&&delete e[i]}}e.text||(e.text=P.DEFAULT_KEY.text)},c.polyfill=function(e,t,n,i,r){if(r||(r={hasFlicks:!1,hasLongpresses:!1,hasMultitaps:!1}),fe(e,new c),!e.text&&typeof e.id=="string"&&(e.text=P.unicodeIDToText(e.id)),e.sk){r.hasLongpresses=!0;for(var s=0,l=e.sk;s<l.length;s++){var o=l[s];oe.polyfill(o,t,n,i,r)}}if(e.multitap){r.hasMultitaps=!0;for(var a=0,g=e.multitap;a<g.length;a++){var d=g[a];oe.polyfill(d,t,n,i,r)}}if(e.flick){r.hasFlicks=!0;for(var B in e.flick)oe.polyfill(e.flick[B],t,n,i,r)}var u=e;u.displayLayer=i,u.layer=u.layer||i,c.determineHint(u,n.defaultHint),u.constructBaseKeyEvent(t,n,i)},c.determineHint=function(e,t){var n;if(e.hint){e.hintSrc=e;return}if(t!=null&&t.includes("flick-")){if(e.flick){var i=t.substring(6);!((n=e.flick[i])===null||n===void 0)&&n.text&&(e.hintSrc=e.flick[i])}return}switch(t){case"none":return;case"multitap":e.multitap&&(e.hintSrc=e.multitap[0]);return;case"flick":if(e.flick)for(var r=0,s=Ni;r<s.length;r++){var l=s[r];if(e.flick[l]){e.hintSrc=e.flick[l];return}}return;case"longpress":e.sk&&(e.hintSrc=e.sk[0]);return;case"dot":default:e.sk&&(e.hint="\u2022",e.hintSrc=e);return}},c.prototype.constructBaseKeyEvent=function(e,t,n){var i=this.layer||n||"",r=this.id?this.id.toUpperCase():null,s={Lmodifiers:h.getModifierState(i),Lstates:h.getStateFromLayer(i),Lcode:r?h.keyCodes[r]:0,LisVirtualKey:!0,vkCode:0,kName:r,kLayer:i,kbdLayer:n,kNextLayer:this.nextlayer,device:null,isSynthetic:!0},l=new gt(s);if(t.keyboard){var o=t.keyboard;o.isMnemonic&&!(t.isDefault&&t.formFactor!="desktop")?l.Lcode!=h.keyCodes.K_SPACE&&(l.vkCode=l.Lcode,this.isMnemonic=!0):l.vkCode=l.Lcode,o.definesPositionalOrMnemonic||(l.Lcode=dt._USKeyCodeToCharCode(l),l.LisVirtualKey=!1)}this._baseKeyEvent=l},c.DEFAULT_PAD=15,c.DEFAULT_RIGHT_MARGIN=15,c.DEFAULT_KEY_WIDTH=100,c.DEFAULT_KEY={text:"",width:c.DEFAULT_KEY_WIDTH,sp:0,pad:c.DEFAULT_PAD},(0,Q.__decorate)([Xt],c.prototype,"baseKeyID",null),(0,Q.__decorate)([Xt],c.prototype,"isPadding",null),(0,Q.__decorate)([Xt],c.prototype,"coreID",null),(0,Q.__decorate)([Xt],c.prototype,"elementID",null),(0,Q.__decorate)([Xt],c.prototype,"baseKeyEvent",null),(0,Q.__decorate)([Xt],c.prototype,"constructBaseKeyEvent",null),c}();var P=function(c){(0,Q.__extends)(e,c);function e(){return c!==null&&c.apply(this,arguments)||this}return e.prototype.getSubkey=function(t){if(this.sk)for(var n=0,i=this.sk;n<i.length;n++){var r=i[n];if(r.coreID==t)return r}return null},e}(un);var oe=function(c){(0,Q.__extends)(e,c);function e(){return c!==null&&c.apply(this,arguments)||this}return e}(un);var Ei=function(){function c(){}return c.sanitize=function(e){for(var t=0,n=e.key;t<n.length;t++){var i=n[t];i==null?e.key.length=e.key.length-1:P.sanitize(i)}typeof e.id=="string"&&(e.id=Number.parseInt(e.id,10))},c.polyfill=function(e,t,n,i,r,s,l){for(var o=e.key,a=un.DEFAULT_KEY,g=0;g<o.length;g++){for(var d=o[g],B=Object.keys(a),u=0,y=B;u<y.length;u++){var I=y[u],F=I;typeof d[F]!="string"&&typeof d[F]!="number"&&(d[F]=a[F])}switch(d.sp){case 1:!c.SPECIAL_LABEL.test(d.text)&&d.text!=""&&(d.sp=3);break;case 2:!c.SPECIAL_LABEL.test(d.text)&&d.text!=""&&(d.sp=4);break}P.polyfill(d,t,n,i,l)}for(var U=function(f,m,x,R){f.proportionalPad=m,f.proportionalWidth=x,f.proportionalX=R+m+x/2},b=0,g=0;g<o.length-1;g++){var d=o[g];U(d,d.pad/r,d.width/r,b),b+=d.proportionalPad,b+=d.proportionalWidth}var C=P.DEFAULT_RIGHT_MARGIN/r;if(o.length>0){var X=o[o.length-1];if(o.length==1&&X.pad<0){var Z=X.width/r,G=1-(b+Z+C);U(X,G,Z,b)}else{var G=X.pad/r,Z=1-(b+G+C);U(X,G,Z,b)}}fe(e,new c);var p=e;p.proportionalY=s},c.prototype.populateKeyMap=function(e){this.key.forEach(function(t){t.coreID&&(e[t.coreID]=t)})},c.SPECIAL_LABEL=/\*\w+\*/,(0,Q.__decorate)([Xt],c.prototype,"populateKeyMap",null),c}();var ki=function(){function c(){}return c.sanitize=function(e){for(var t=0,n=e.row;t<n.length;t++){var i=n[t];Ei.sanitize(i)}},c.polyfill=function(e,t,n,i){e.aligned=!1;for(var r=e.row,s=0,l=0,o=r;l<o.length;l++){for(var a=o[l],g=0,d=a.key,B=0,u=d;B<u.length;B++){var y=u[B];g+=y.width+y.pad}g>s&&(s=g)}n.formFactor=="desktop"?s+=5:s+=P.DEFAULT_RIGHT_MARGIN;for(var I=e.row.length,F=0;F<I;F++){var U=(F+.5)/I;Ei.polyfill(e.row[F],t,n,e.id,s,U,i)}fe(e,new c);var b=e;b.totalWidth=s,b.defaultKeyProportionalWidth=P.DEFAULT_KEY.width/s,b.rowProportionalHeight=1/I,b.keyMap=b.constructKeyMap()},c.prototype.constructKeyMap=function(){var e={};return this.row.forEach(function(t){t.populateKeyMap(e)}),e},c.prototype.getKey=function(e){e.indexOf(this.id+"-")==0&&(e=e.replace(this.id+"-",""));var t=e.split("::");if(t.length>1){var n=this.keyMap[t[0]];return n.getSubkey(t[1])}else return this.keyMap[e]},(0,Q.__decorate)([Xt],c.prototype,"constructKeyMap",null),(0,Q.__decorate)([Xt],c.prototype,"getKey",null),c}();var Re=function(){function c(){this.hasFlicks=!1,this.hasLongpresses=!1,this.hasMultitaps=!1}return c.prototype.getLayer=function(e){return this.layerMap[e]},c.correctLayerEmptyRowBug=function(e){for(var t=0;t<e.length;t++){var n=e[t],i=n.row,r=void 0;for(r=i.length-1;r>=0;r--)(!Array.isArray(i[r].key)||i[r].key.length==0)&&i.splice(r,1)}},c.sanitize=function(e){c.correctLayerEmptyRowBug(e.layer);for(var t=0,n=e.layer;t<n.length;t++){var i=n[t];ki.sanitize(i)}},c.polyfill=function(e,t,n){if(e==null)throw new Error("Cannot build an ActiveLayout for a null specification.");var i={hasFlicks:!1,hasLongpresses:!1,hasMultitaps:!1};this.sanitize(e);var r,s={},l=e.layer;fe(e,new c);var o=e;for(o.keyboard=t,o.formFactor=n,r=0;r<l.length;r++)ki.polyfill(l[r],t,o,i),s[l[r].id]=l[r];if(n!="desktop"&&!!e.layer.find(function(u){return u.id=="caps"})){var a=e.layer.find(function(u){return u.id=="default"}),g=e.layer.find(function(u){return u.id=="shift"}),d=a.getKey("K_SHIFT"),B=g==null?void 0:g.getKey("K_SHIFT");d&&B&&!d.multitap&&!B.multitap&&!d.sk&&!B.sk&&(i.hasMultitaps=!0,d.multitap=[(0,Q.__assign)({},D.dfltShiftToCaps),(0,Q.__assign)({},D.dfltShiftToDefault)],B.multitap=[(0,Q.__assign)({},D.dfltShiftToCaps),(0,Q.__assign)({},D.dfltShiftToShift)],d.multitap.forEach(function(u){return oe.polyfill(u,t,o,"default")}),B.multitap.forEach(function(u){return oe.polyfill(u,t,o,"shift")}))}return o.hasFlicks=i.hasFlicks,o.hasLongpresses=i.hasLongpresses,o.hasMultitaps=i.hasMultitaps,o.layerMap=s,o},(0,Q.__decorate)([Xt],c.prototype,"getLayer",null),c}();var es=function(){function c(){this.stores={}}return c}(),Yt;(function(c){c[c.NOT_LOADED=void 0]="NOT_LOADED",c[c.POLYFILLED=1]="POLYFILLED",c[c.CALIBRATED=2]="CALIBRATED"})(Yt||(Yt={}));var ns=function(){function c(e){e?this.scriptObject=e:this.scriptObject=c.DEFAULT_SCRIPT_OBJECT,this.layoutStates={}}return c.prototype.process=function(e,t){return this.scriptObject.gs(e,t)},c.prototype.processNewContextEvent=function(e,t){return this.scriptObject.gn?this.scriptObject.gn(e,t):!1},c.prototype.processPostKeystroke=function(e,t){return this.scriptObject.gpk?this.scriptObject.gpk(e,t):!1},Object.defineProperty(c.prototype,"isHollow",{get:function(){return this.scriptObject==c.DEFAULT_SCRIPT_OBJECT},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"id",{get:function(){return this.scriptObject.KI},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"name",{get:function(){return this.scriptObject.KN},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"variableStores",{get:function(){var e=this.scriptObject.KVS,t={};if(Array.isArray(e))for(var n=0,i=e;n<i.length;n++){var r=i[n];t[r]=this.scriptObject[r]}return t},set:function(e){var t=this.scriptObject.KVS;if(Array.isArray(t))for(var n=0,i=t;n<i.length;n++){var r=i[n];typeof e[r]=="string"&&(this.scriptObject[r]=e[r])}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"_legacyLayoutSpec",{get:function(){return this.scriptObject.KV},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"_layouts",{get:function(){return this.scriptObject.KVKL},set:function(e){this.scriptObject.KVKL=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"compilerVersion",{get:function(){return new tt(this.scriptObject.KVER)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isMnemonic",{get:function(){return!!this.scriptObject.KM},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"definesPositionalOrMnemonic",{get:function(){return typeof this.scriptObject.KM!="undefined"},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"helpText",{get:function(){return this.scriptObject.KH},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"hasScript",{get:function(){return!!this.scriptObject.KHF},enumerable:!1,configurable:!0}),c.prototype.embedScript=function(e){this.scriptObject.KHF(e)},Object.defineProperty(c.prototype,"oskStyling",{get:function(){return this.scriptObject.KCSS},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isCJK",{get:function(){var e;return typeof this.scriptObject.KLC!="undefined"?e=this.scriptObject.KLC:typeof this.scriptObject.LanguageCode!="undefined"&&(e=this.scriptObject.LanguageCode),e=="cmn"||e=="jpn"||e=="kor"},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isRTL",{get:function(){return!!this.scriptObject.KRTL},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"modifierBitmask",{get:function(){return this.scriptObject.KMBM||h.modifierBitmasks.NON_CHIRAL},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isChiral",{get:function(){return!!(this.modifierBitmask&h.modifierBitmasks.IS_CHIRAL)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"desktopFont",{get:function(){return this.scriptObject.KV?this.scriptObject.KV.F:null},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"cacheTag",{get:function(){var e=this.scriptObject._kmw;return e||(e=new es,this.scriptObject._kmw=e),e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"explodedStores",{get:function(){return this.cacheTag.stores},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"emulatesAltGr",{get:function(){var e=h.modifierCodes;if(!this.isChiral||this._legacyLayoutSpec==null)return!1;var t=this._legacyLayoutSpec.KLS;if(!t)return!1;var n=e.LCTRL|e.LALT,i=t[D.getLayerId(n)],r=t[D.getLayerId(e.SHIFT|n)];if(i!=null&&i!=t[D.getLayerId(e.RALT)]||r!=null&&r!=t[D.getLayerId(e.RALT|e.SHIFT)])return!1;var s=this.modifierBitmask;return(s&n)!=n||i==null&&r==null,!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"usesSupplementaryPlaneChars",{get:function(){var e=this.scriptObject;return e&&(e.KS&&e.KS==1||e.KN=="Hieroglyphic")},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"version",{get:function(){return this.scriptObject.KBVER||""},enumerable:!1,configurable:!0}),c.prototype.usesDesktopLayoutOnDevice=function(e){return this.scriptObject.KVKL?e.formFactor==v.FormFactor.Desktop:!0},c.prototype.notify=function(e,t,n){typeof this.scriptObject.KNS=="function"&&this.scriptObject.KNS(e,t,n)},c.prototype.findOrConstructLayout=function(e){if(this._layouts){if(this._layouts[e]!==void 0)return this._layouts[e];if(e==v.FormFactor.Phone&&this._layouts[v.FormFactor.Tablet])return this._layouts[v.FormFactor.Phone]=this._layouts[v.FormFactor.Tablet];if(e==v.FormFactor.Tablet&&this._layouts[v.FormFactor.Phone])return this._layouts[v.FormFactor.Tablet]=this._layouts[v.FormFactor.Phone]}var t=null;if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.KLS)t=this._legacyLayoutSpec;else if(this._legacyLayoutSpec!=null&&this._legacyLayoutSpec.BK!=null){for(var n=this._legacyLayoutSpec.BK,i=0;i<n.length;i++)if(n[i].length>0){t=this._legacyLayoutSpec;break}}if(!t&&(this.helpText==""||e!=v.FormFactor.Desktop)&&(t={F:"Tahoma",BK:D.dfltText}),this._layouts||(this._layouts={}),t){var r=this._layouts[e]=D.buildDefaultLayout(t,this,e);return r.isDefault=!0,r}else return this._layouts[e]=null,null},c.prototype.layout=function(e){var t=this.findOrConstructLayout(e);return t?(this.layoutStates[e]==Yt.NOT_LOADED&&(t=Re.polyfill(t,this,e),this.layoutStates[e]=Yt.POLYFILLED),t):null},c.prototype.refreshLayouts=function(){var e=[v.FormFactor.Desktop,v.FormFactor.Phone,v.FormFactor.Tablet],t=this;e.forEach(function(n){t.layoutStates[n]=Yt.NOT_LOADED})},c.prototype.markLayoutCalibrated=function(e){this.layoutStates[e]!=Yt.NOT_LOADED&&(this.layoutStates[e]=Yt.CALIBRATED)},c.prototype.getLayoutState=function(e){return this.layoutStates[e]},c.prototype.constructNullKeyEvent=function(e,t){t=t||{K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1};var n=gt.constructNullKeyEvent(e);return this.setSyntheticEventDefaults(n,t),n},c.prototype.constructKeyEvent=function(e,t,n){var i=e.baseKeyEvent;i.device=t,this.isMnemonic&&i.setMnemonicCode(e.layer.indexOf("shift")!=-1,n.K_CAPS),this.setSyntheticEventDefaults(i,n);var r={K_CAPS:h.stateBitmasks.CAPS,K_NUMLOCK:h.stateBitmasks.NUM_LOCK,K_SCROLL:h.stateBitmasks.SCROLL_LOCK},s=r[i.kName];return s&&(i.Lstates^=s,i.LmodifierChange=!0),i},c.prototype.setSyntheticEventDefaults=function(e,t){e.device.touchable||(e.Lstates=0,e.Lstates|=t.K_CAPS?h.modifierCodes.CAPS:h.modifierCodes.NO_CAPS,e.Lstates|=t.K_NUMLOCK?h.modifierCodes.NUM_LOCK:h.modifierCodes.NO_NUM_LOCK,e.Lstates|=t.K_SCROLL?h.modifierCodes.SCROLL_LOCK:h.modifierCodes.NO_SCROLL_LOCK),e.kName&&e.kName.substr(0,2)=="U_"&&(e.LisVirtualKey=!1),typeof e.Lcode=="undefined"&&(e.Lcode=this.getVKDictionaryCode(e.kName),e.Lcode||(e.Lcode=1)),(e.Lmodifiers&h.modifierBitmasks.ALT_GR_SIM)==h.modifierBitmasks.ALT_GR_SIM&&this.emulatesAltGr&&(e.Lmodifiers&=~h.modifierBitmasks.ALT_GR_SIM,e.Lmodifiers|=h.modifierCodes.RALT)},c.prototype.getVKDictionaryCode=function(e){var t=this.scriptObject.VKDictionary||{};if(!this.scriptObject.VKDictionary){if(typeof this.scriptObject.KVKD=="string")for(var n=this.scriptObject.KVKD.split(" "),i=0;i<n.length;i++)t[n[i].toUpperCase()]=i+256;this.scriptObject.VKDictionary=t}var r=t[e.toUpperCase()];return r||0},c.DEFAULT_SCRIPT_OBJECT={gs:function(e,t){return!1},KI:"",KN:"",KV:D.DEFAULT_RAW_SPEC,KM:0},c}(),j=ns;var ae={osk:h},ge=function(){function c(e,t){this.loadedKeyboard=null,this._jsGlobal=e,this.keymanGlobal=t,this.install()}return c.prototype.KR=function(e){if(this.loadedKeyboard)throw new Error("Unexpected state:  the most-recently loaded keyboard field was not properly reset.");this.loadedKeyboard=new j(e)},c.prototype.KLOAD=function(e,t,n){return n},c.prototype.install=function(){this._jsGlobal.KeymanWeb=this,this._jsGlobal.keyman=this.keymanGlobal},c.prototype.uninstall=function(){this._jsGlobal.KeymanWeb==this&&delete this._jsGlobal.KeymanWeb,this._jsGlobal.keyman==this.keymanGlobal&&delete this._jsGlobal.keyman},c}();var de=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=c.call(this,t)||this;return i.cause=n,i}return e}(Error);var Fn=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=c.call(this,t)||this;return i.cause=n,i}return e}(Error);var is=function(){function c(e){this.uri=e}return c.prototype.missingError=function(e){var t="Cannot find the keyboard at ".concat(this.uri,".");return new Fn(t,e)},c.prototype.scriptError=function(e){var t="Error registering the keyboard script at ".concat(this.uri,"; it may contain an error.");return new de(t,e)},c}(),cs=function(){function c(e){this.stub=e}return c.prototype.missingError=function(e){var t=this.stub,n="Cannot find the ".concat(t.name," keyboard for ").concat(t.langName," at ").concat(t.filename,".");return new Fn(n,e)},c.prototype.scriptError=function(e){var t=this.stub,n="Error registering the ".concat(t.name," keyboard for ").concat(t.langName,"; keyboard script at ").concat(t.filename," may contain an error.");return new de(n,e)},c}(),rs=function(){function c(e){this._harness=e}return Object.defineProperty(c.prototype,"harness",{get:function(){return this._harness},enumerable:!1,configurable:!0}),c.prototype.loadKeyboardFromPath=function(e){this.harness.install();var t=this.loadKeyboardInternal(e,new is(e));return t},c.prototype.loadKeyboardFromStub=function(e){this.harness.install();var t=this.loadKeyboardInternal(e.filename,new cs(e),e.id);return t},c}(),yn=rs;var In;(function(c){c.KEYBOARD="keyboard",c.LANGUAGE="language",c.LANGUAGE_KEYBOARD="languageKeyboard",c.BLANK="blank"})(In||(In={}));var Bt=In;function Un(c,e){if(c)return{family:c.family,path:e,files:c.filename||c.source}}var ss=function(){function c(e,t){if(typeof e!="string")if(e.KI||e.KL||e.KLC||e.KFont||e.KOskFont){var n=e;this.KI=n.KI,this.KN=n.KN,this.KL=n.KL,this.KLC=n.KLC,this.KFont=n.KFont,this.KOskFont=n.KOskFont,this._displayName=n instanceof c?n._displayName:n.displayName}else{var i=e;i.languages||(i.languages=i.language),this.KI=i.id,this.KN=i.name,this.KL=i.languages.name,this.KLC=i.languages.id,this.KFont=Un(i.languages.font,t),this.KOskFont=Un(i.languages.oskFont,t)}else this.KI=e,this.KLC=t}return Object.defineProperty(c,"spacebarTextMode",{get:function(){return typeof this.spacebarTextModeSrc=="string"?this.spacebarTextModeSrc:this.spacebarTextModeSrc()},set:function(e){this.spacebarTextModeSrc=e},enumerable:!1,configurable:!0}),c.fromMultilanguageAPIStub=function(e){var t=[];e.languages||(e.languages=e.language);for(var n=0,i=e.languages;n<i.length;n++){var r=i[n],s={id:e.id,name:e.name,languages:r};t.push(new c(s))}return t},Object.defineProperty(c.prototype,"id",{get:function(){return this.KI},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"name",{get:function(){return this.KN},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"langId",{get:function(){return this.KLC},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"langName",{get:function(){return this.KL},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"displayName",{get:function(){if(this._displayName)return this._displayName;var e=this.KN,t=this.KL;switch(c.spacebarTextMode){case Bt.KEYBOARD:return e;case Bt.LANGUAGE:return t;case Bt.LANGUAGE_KEYBOARD:return e==t?t:t+" - "+e;case Bt.BLANK:return"";default:return e}},set:function(e){this._displayName=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"textFont",{get:function(){return this.KFont},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"oskFont",{get:function(){return this.KOskFont},enumerable:!1,configurable:!0}),c.prototype.validateForOSK=function(){return this.KLC?this.displayName===void 0||c.spacebarTextMode!=Bt.BLANK&&!this.displayName?new Error("A display name is missing for this keyboard and cannot be generated under current settings."):null:this.KI||this.KN?new Error("No language code was specified for use with the ".concat(this.KI||this.KN," keyboard")):new Error("No language code was specified for use with the corresponding keyboard")},c.prototype.validateForCustomKeyboard=function(){return!this.KI||!this.KN||!this.KL||!this.KLC?new Error("To use a custom keyboard, you must specify keyboard id, keyboard name, language and language code."):null},c.spacebarTextModeSrc=Bt.KEYBOARD,c}(),_t=ss;var bn=function(){function c(e,t){this.p=e,this.d=t,this.o=c.ordinalSeed++}return c.prototype.match=function(e,t){var n=this.p==e&&this.d==t;return n},c.prototype.set=function(){this.matched=1},c.prototype.reset=function(){this.matched=0},c.prototype.before=function(e){return this.o<e.o},c.prototype.clone=function(){var e=new c(this.p,this.d);return e.o=this.o,e},c.prototype.equal=function(e){return this.d==e.d&&this.p==e.d&&this.o==e.o},c.ordinalSeed=0,c.sortFunc=function(e,t){return e.p!=t.p?t.p-e.p:t.o-e.o},c}();var Ti=function(){function c(){this.dks=[]}return c.prototype.toSortedArray=function(){return this.dks=this.dks.sort(bn.sortFunc),[].concat(this.dks)},c.prototype.clone=function(){var e=new c,t=this.toSortedArray();return e.dks=[],t.forEach(function(n){e.dks.push(n.clone())}),e},c.prototype.isMatch=function(e,t,n){if(this.dks.length==0)return!1;var i=e;t=i-t;for(var r=0;r<this.dks.length;r++)if(this.dks[r].match(t,n)&&!this.dks[r].matched)return this.dks[r].set(),!0;return this.resetMatched(),!1},c.prototype.add=function(e){this.dks=this.dks.concat(e)},c.prototype.remove=function(e){var t=this.dks.indexOf(e);this.dks.splice(t,1)},c.prototype.clear=function(){this.dks=[]},c.prototype.resetMatched=function(){for(var e=0,t=this.dks;e<t.length;e++){var n=t[e];n.reset()}},c.prototype.deleteMatched=function(){for(var e=0;e<this.dks.length;e++)this.dks[e].matched&&this.dks.splice(e--,1)},c.prototype.adjustPositions=function(e,t){if(t!=0)for(var n=0,i=this.dks;n<i.length;n++){var r=i[n];r.p>e&&(r.p+=t)}},c.prototype.equal=function(e){if(this.dks.length!=e.dks.length)return!1;for(var t=e.dks,n=[],i=function(a){var g=t.find(function(d){return a.equal(d)});if(!g)return{value:!1}},r=0,s=this.dks;r<s.length;r++){var l=s[r],o=i(l);if(typeof o=="object")return o.value}return n.length==t.length},c.prototype.count=function(){return this.dks.length},c}();var Yi=function(){function c(e){this.id=e}return c.prototype.set=function(e){throw new Error("System store with ID "+this.id+" may not be directly set.")},c}();var Le=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=c.call(this,t)||this;return i.handler=null,i._value=n,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),e.prototype.matches=function(t){return this._value==t},e.prototype.set=function(t){this.handler&&this.handler(this,t)||(this._value=t)},e}(Yi);var wi=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this,Y.TSS_PLATFORM)||this;return n.kbdInterface=t,n}return e.prototype.matches=function(t){var n,i,r=t.split(" "),s=this.kbdInterface.activeDevice;for(n=0;n<r.length;n++)switch(i=r[n].toLowerCase(),i){case"touch":case"hardware":if(s.touchable!=(i=="touch"))return!1;break;case"macos":case"mac":i="macosx";case"macosx":case"windows":case"android":case"ios":case"linux":if(s.OS!=i)return!1;break;case"tablet":case"phone":case"desktop":if(s.formFactor!=i)return!1;break;case"web":if(s.browser=="native")return!1;break;case"native":case"chrome":case"firefox":case"safari":case"edge":case"opera":if(s.browser!=i)return!1;break;default:return!1}return!0},e}(Yi);function hn(c,e,t){var n=Math.min(c.length,e.length),i,r,s,l,o;for(t?(i=r=c.length-1,s=r-n,l=-1,o=e.length-c.length):(i=r=0,s=n,l=1,o=0);r!=s&&c.charAt(r)==e.charAt(r+o);r+=l);if(r!=i&&r!=s){var a=c.charCodeAt(r-l),g=c.charCodeAt(r),d=e.charCodeAt(r+o),B=t?ve:Ve,u=t?Ve:ve;if(B(a)&&(u(g)||u(d)))return r-l}return r}se();function wt(c){var e;return c?c.insert===""&&c.deleteLeft===0&&((e=c.deleteRight)!==null&&e!==void 0?e:0)===0:!0}var ls=function(){function c(e,t,n,i){this.insert=e,this.deleteLeft=t,this.deleteRight=n,this.erasedSelection=i}return c.nil=new c("",0,0,!1),c}();var os=function(){function c(e,t,n,i){var r=this.token=c.tokenSeed++;this.keystroke=e,this.transform=t,this.alternates=i,this.preInput=n,this.transform.id=this.token,i&&i.forEach(function(s){s.sample.id=r})}return c.tokenSeed=0,c}();var Di=function(){function c(){this._dks=new Ti}return Object.defineProperty(c.prototype,"isSynthetic",{get:function(){return!0},enumerable:!1,configurable:!0}),c.prototype.resetContext=function(){this.deadkeys().clear()},c.prototype.deadkeys=function(){return this._dks},c.prototype.hasDeadkeyMatch=function(e,t){return this.deadkeys().isMatch(this.getDeadkeyCaret(),e,t)},c.prototype.insertDeadkeyBeforeCaret=function(e){var t=new bn(this.getDeadkeyCaret(),e);this.deadkeys().add(t)},c.prototype.adjustDeadkeys=function(e){this.deadkeys().adjustPositions(this.getDeadkeyCaret(),e)},c.prototype.setDeadkeys=function(e){this._dks=e.clone()},c.prototype.buildTransformFrom=function(e){var t=this.getTextBeforeCaret(),n=e.getTextBeforeCaret(),i=hn(n,t,!1),r=n.substring(i)._kmwLength(),s=t.substring(i),l=this.getTextAfterCaret(),o=e.getTextAfterCaret(),a=hn(o,l,!0),g=o.substring(0,a+1)._kmwLength();return new ls(s,r,g,e.getSelectedText()&&!this.getSelectedText())},c.prototype.buildTranscriptionFrom=function(e,t,n,i){var r=this.buildTransformFrom(e);return new os(t,r,w.from(e,n),i)},c.prototype.restoreTo=function(e){this.clearSelection(),this.setTextBeforeCaret(e.getTextBeforeCaret()),this.setTextAfterCaret(e.getTextAfterCaret()),this._dks=e._dks.clone()},c.prototype.apply=function(e){this.clearSelection(),e.deleteRight&&this.setTextAfterCaret(this.getTextAfterCaret()._kmwSubstr(e.deleteRight)),e.deleteLeft&&this.deleteCharsBeforeCaret(e.deleteLeft),e.insert&&this.insertTextBeforeCaret(e.insert),this._dks.clear()},c.prototype.setTextBeforeCaret=function(e){this.deleteCharsBeforeCaret(this.getTextBeforeCaret()._kmwLength()),this.insertTextBeforeCaret(e)},c.prototype.saveProperties=function(){},c.prototype.restoreProperties=function(){},c}(),Cn=Di,w=function(c){(0,Q.__extends)(e,c);function e(t,n,i){var r=c.call(this)||this;r.selForward=!0,r.text=t||"";var s=r.text._kmwLength();return r.selStart=typeof n=="number"?n:s,r.selEnd=typeof i=="number"?i:r.selStart,r.selForward=r.selEnd>=r.selStart,r}return e.from=function(t,n){var i;if(t instanceof e){var r=t;i=new e(r.text,r.selStart,r.selEnd)}else{var s=t.getText(),l=s._kmwLength(),o=l,a=0;if(t.hasSelection()){var g=t.getTextBeforeCaret(),d=t.getTextAfterCaret();o=g._kmwLength(),a=l-d._kmwLength()}i=new e(s,o,a)}return i.setDeadkeys(t.deadkeys()),i},e.prototype.clearSelection=function(){this.text=this.getTextBeforeCaret()+this.getTextAfterCaret(),this.selEnd=this.selStart,this.selForward=!0},e.prototype.invalidateSelection=function(){},e.prototype.isSelectionEmpty=function(){return this.selStart==this.selEnd},e.prototype.hasSelection=function(){return!0},e.prototype.getDeadkeyCaret=function(){return this.selStart},e.prototype.setSelection=function(t,n){if(this.selStart=t,this.selEnd=typeof n=="number"?n:t,this.selForward=n>=t,!this.selForward){var i=this.selStart;this.selStart=this.selEnd,this.selEnd=i}},e.prototype.getTextBeforeCaret=function(){return this.text.kmwSubstr(0,this.selStart)},e.prototype.getSelectedText=function(){return this.text.kmwSubstr(this.selStart,this.selEnd-this.selStart)},e.prototype.getTextAfterCaret=function(){return this.text.kmwSubstr(this.selEnd)},e.prototype.getText=function(){return this.text},e.prototype.deleteCharsBeforeCaret=function(t){t>=0&&(t>this.selStart&&(t=this.selStart),this.adjustDeadkeys(-t),this.text=this.text.kmwSubstr(0,this.selStart-t)+this.text.kmwSubstr(this.selStart),this.selStart-=t,this.selEnd-=t)},e.prototype.insertTextBeforeCaret=function(t){this.adjustDeadkeys(t._kmwLength()),this.text=this.getTextBeforeCaret()+t+this.text.kmwSubstr(this.selStart),this.selStart+=t.kmwLength(),this.selEnd+=t.kmwLength()},e.prototype.handleNewlineAtCaret=function(){this.insertTextBeforeCaret("\n")},e.prototype.setTextAfterCaret=function(t){this.text=this.getTextBeforeCaret()+t},e.prototype.isEqual=function(t){return this.text==t.text&&this.selStart==t.selStart&&this.selEnd==t.selEnd&&this.deadkeys().equal(t.deadkeys())},e.prototype.doInputEvent=function(){},e}(Di);var as=function(){function c(){this.transcription=null,this.setStore={},this.saveStore={},this.variableStores={},this.triggersDefaultCommand=!1}return c.prototype.finalize=function(e,t,n){if(!this.transcription)throw"Cannot finalize a RuleBehavior with no transcription.";e.beepHandler&&this.beep&&e.beepHandler(t);for(var i in this.setStore){var r=e.keyboardInterface.systemStores[i];if(r)try{r.set(this.setStore[i])}catch(l){e.errorLogger&&e.errorLogger("Rule attempted to perform illegal operation - 'platform' may not be changed.")}else e.warningLogger&&e.warningLogger("Unknown store affected by keyboard rule: "+i)}if(e.keyboardInterface.applyVariableStores(this.variableStores),e.keyboardInterface.variableStoreSerializer)for(var i in this.saveStore)e.keyboardInterface.variableStoreSerializer.saveStore(e.activeKeyboard.id,i,this.saveStore[i]);if(this.triggersDefaultCommand){var s=this.transcription.keystroke;e.defaultRules.applyCommand(s,t)}e.warningLogger&&this.warningLog?e.warningLogger(this.warningLog):e.errorLogger&&this.errorLog&&e.errorLogger(this.errorLog)},c.prototype.mergeInDefaults=function(e){var t=this.transcription.keystroke,n=e.transcription.keystroke;if(t.Lcode!=n.Lcode||t.Lmodifiers!=n.Lmodifiers)throw"RuleBehavior default-merge not supported unless keystrokes are identical!";this.triggersDefaultCommand=this.triggersDefaultCommand||e.triggersDefaultCommand;var i=w.from(this.transcription.preInput,!1);i.apply(this.transcription.transform),i.apply(e.transcription.transform),this.transcription=i.buildTranscriptionFrom(this.transcription.preInput,t,!1,this.transcription.alternates)},c}(),ut=as;var gs=function(){function c(){}return c}();var ds=function(){function c(){}return c.prototype.reset=function(){this._cache=[]},c.prototype.get=function(e,t){return typeof this._cache[e]=="undefined"||typeof this._cache[e][t]=="undefined"?null:this._cache[e][t]},c.prototype.set=function(e,t,n){typeof this._cache[e]=="undefined"&&(this._cache[e]=[]),this._cache[e][t]=n},c}(),Qs=function(){function c(){}return c.prototype.reset=function(){this._cache=[]},c.prototype.get=function(e,t){return typeof this._cache[e]=="undefined"||typeof this._cache[e][t]=="undefined"?null:this._cache[e][t]},c.prototype.set=function(e,t,n){typeof this._cache[e]=="undefined"&&(this._cache[e]=[]),this._cache[e][t]=n},c.prototype.clone=function(){var e=new c;return e._cache=this._cache,e},c}(),Y;(function(c){c[c.TSS_LAYER=33]="TSS_LAYER",c[c.TSS_PLATFORM=31]="TSS_PLATFORM",c[c.TSS_NEWLAYER=42]="TSS_NEWLAYER",c[c.TSS_OLDLAYER=43]="TSS_OLDLAYER"})(Y||(Y={}));var Mi=function(c){(0,Q.__extends)(e,c);function e(t,n,i){i===void 0&&(i=null);var r=c.call(this,t,n)||this;return r.cachedContext=new ds,r.cachedContextEx=new Qs,r._AnyIndices=[],r.systemStores={},r.systemStores[Y.TSS_PLATFORM]=new wi(r),r.systemStores[Y.TSS_LAYER]=new Le(Y.TSS_LAYER,"default"),r.systemStores[Y.TSS_NEWLAYER]=new Le(Y.TSS_NEWLAYER,""),r.systemStores[Y.TSS_OLDLAYER]=new Le(Y.TSS_OLDLAYER,""),r.variableStoreSerializer=i,r}return Object.defineProperty(e.prototype,"Codes",{get:function(){return h},enumerable:!1,configurable:!0}),e.prototype.saveFocus=function(){},e.prototype.registerKeyboard=function(t){var n=new j(t);this.loadedKeyboard=n},e.prototype.context=function(t,n,i){var r=this.cachedContext.get(t,n);if(r!==null)return r;var s=this.KC_(t,n,i);return this.cachedContext.set(t,n,s),s},e.prototype.KC_=function(t,n,i){var r="";return r=i.isSelectionEmpty()?i.getTextBeforeCaret():"",r._kmwLength()<t&&(r=Array(t-r._kmwLength()+1).join("\uFFFE")+r),r._kmwSubstr(-t)._kmwSubstr(0,n)},e.prototype.nul=function(t,n){var i=this.context(t+1,1,n);return i==="\uFFFE"},e.prototype.contextMatch=function(t,n,i,r){var s=this.context(t,r,n);return s===i?!0:(n.deadkeys().resetMatched(),!1)},e.prototype._BuildExtendedContext=function(t,n,i){var r=this.cachedContextEx.get(t,n);if(r!==null)return r;if(r=this.cachedContextEx.get(t,t),r===null){var s=i.deadkeys().toSortedArray(),l=0;for(r={valContext:[],deadContext:[]};r.valContext.length<t;){var o=i.getDeadkeyCaret(),a=o-l;if(s.length>0&&s[0].p>a){s.splice(0,1);continue}else if(s.length>0&&s[0].p==a)r.deadContext[t-r.valContext.length-1]=s[0],r.valContext=[s[0].d].concat(r.valContext),s.splice(0,1);else{var g=this.context(++l,1,i);r.valContext=[g].concat(r.valContext)}}this.cachedContextEx.set(t,t,r)}var d=r;d.valContext=d.valContext.slice(0,n);for(var B=0;B<d.valContext.length;B++)d.valContext[B]=="\uFFFE"&&(d.valContext.splice(0,1),d.deadContext.splice(0,1));return d.valContext.length==0&&(d.valContext=["\uFFFE"],d.deadContext=[]),this.cachedContextEx.set(t,n,d),d},e.prototype.fullContextMatch=function(t,n,i){var r=this._BuildExtendedContext(t,i.length,n);this.ruleContextEx=this.cachedContextEx.clone();for(var s=r.valContext,l=r.deadContext,o=!1,a="\uFFFE",g=function(U){throw new Error("Unexpected object in fullContextMatch specification: "+U)},d=0;d<i.length;d++)if(typeof i[d]=="string"){var B=i[d];if(B!==s[d]){o=!0;break}}else{var u=i[d];switch(u.t){case"d":u.d!==s[d]?o=!0:l[d].set();break;case"a":var y;typeof s[d]=="string"?y=s[d]:y={t:"d",d:s[d]};var I=this.any(d,y,u.a);u.n?u.n&&(I||s[d]===a)&&(o=!0):I?l[d]!==void 0&&l[d].set():o=!0;break;case"i":var F=this._Index(u.i,u.o);F!==void 0&&(typeof F=="string"?F:F.d)!==s[d]?o=!0:l[d]!==void 0&&l[d].set();break;case"c":s[u.c-1]!==s[d]?o=!0:l[d]!==void 0&&l[d].set();break;case"n":s[d]!=a&&(o=!0);break;default:g(u)}}return o&&(n.deadkeys().resetMatched(),this._AnyIndices=[]),!o},e.prototype.isKeypress=function(t){return this.activeKeyboard.isMnemonic?!t.LisVirtualKey:!!dt._USKeyCodeToCharCode(t)},e.matchModifiersToRuleChirality=function(t,n){var i=h.modifierCodes.LALT|h.modifierCodes.RALT,r=h.modifierCodes.LCTRL|h.modifierCodes.RCTRL,s=t;if(!(n&i)){var l=s&i;l&&(s^=l|h.modifierCodes.ALT)}if(!(n&r)){var o=s&r;o&&(s^=o|h.modifierCodes.CTRL)}return s},e.prototype.keyMatch=function(t,n,i){var r=!1,s=t.Lcode==173?189:t.Lcode,l=this.activeKeyboard.modifierBitmask,o=l&h.modifierBitmasks.ALL,a=l&h.stateBitmasks.ALL,g=e.matchModifiersToRuleChirality(t.Lmodifiers,n);return t.vkCode>255&&(s=t.vkCode),t.LisVirtualKey||s>255?((n&16384)==16384||s>255)&&(r=i==s&&(n&o)==g,r=r&&this.stateMatch(t,n&a)):(n&16384)==0&&(r=s==i),r||this.activeTargetOutput.deadkeys().resetMatched(),r},e.prototype.stateMatch=function(t,n){return(n&t.Lstates)==n},e.prototype.keyInformation=function(t){var n=new gs;return n.vk=t.LisVirtualKey,n.code=t.Lcode,n.modifiers=t.Lmodifiers,n},e.prototype.deadkeyMatch=function(t,n,i){return n.hasDeadkeyMatch(t,i)},e.prototype.beep=function(t){this.resetContextCache(),this.ruleBehavior.beep=!0},e.prototype._ExplodeStore=function(t){if(typeof t=="string"){var n=this.activeKeyboard.explodedStores;if(n[t])return n[t];for(var i=[],r=0;r<t._kmwLength();r++)i.push(t._kmwCharAt(r));return n[t]=i,i}else return t},e.prototype.any=function(t,n,i){if(n=="")return!1;i=this._ExplodeStore(i);for(var r=-1,s=0;s<i.length;s++){var l=i[s];if(typeof l=="string"){if(i[s]==n){r=s;break}}else if(l.d===n.d){r=s;break}}return this._AnyIndices[t]=r,r>=0},e.prototype._Index=function(t,n){return t=this._ExplodeStore(t),this._AnyIndices[n-1]<t.length?t[this._AnyIndices[n-1]]:(console.warn("Unmatched contextual index() statement detected in rule with index "+n+"!"),"")},e.prototype.indexOutput=function(t,n,i,r){this.resetContextCache();var s=function(o){throw new Error("Unexpected object in fullContextMatch specification: "+o)},l=this._Index(n,i);if(l!=="")if(typeof l=="string")this.output(t,r,l);else if(l.t)switch(l.t){case"b":this.beep(r);break;case"d":this.deadkeyOutput(t,r,l.d);break;default:s(l)}else this.deadkeyOutput(t,r,l.d)},e.prototype.deleteContext=function(t,n){var i;if(t>0){i=this._BuildExtendedContext(t,t,n);for(var r=0,s=0;s<i.valContext.length;s++){var l=i.deadContext[s];l?(n.deadkeys().remove(l),t--):i.valContext[s]=="\uFFFE"&&r++}var o=i.valContext.length-r;t>o&&(t=o)}n.deadkeys().resetMatched(),this.output(t,n,"")},e.prototype.output=function(t,n,i){this.resetContextCache(),n.saveProperties(),n.clearSelection(),n.deadkeys().deleteMatched(),t>=0&&n.deleteCharsBeforeCaret(t),n.insertTextBeforeCaret(i),n.restoreProperties()},e.prototype.contextExOutput=function(t,n,i,r){this.resetContextCache(),t>=0&&this.output(t,n,"");var s=this.ruleContextEx.get(i,i),l=s.deadContext[r-1],o=s.valContext[r-1];if(l)n.insertDeadkeyBeforeCaret(l.d);else if(typeof o=="string")this.output(-1,n,o);else throw new Error("contextExOutput: should never be a numeric valContext with no corresponding deadContext")},e.prototype.deadkeyOutput=function(t,n,i){this.resetContextCache(),t>=0&&this.output(t,n,""),n.insertDeadkeyBeforeCaret(i)},e.prototype.ifStore=function(t,n,i){var r=!0,s=this.systemStores[t];return s&&(r=s.matches(n)),r},e.prototype.setStore=function(t,n,i){return this.resetContextCache(),t==Y.TSS_LAYER&&this.activeDevice.touchable?(this.ruleBehavior.setStore[t]=n,!0):!1},e.prototype.loadStore=function(t,n,i){if(this.resetContextCache(),this.variableStoreSerializer){var r=this.variableStoreSerializer.loadStore(t,n);return r[n]||i}else return i},e.prototype.saveStore=function(t,n){this.resetContextCache();var i=this.activeKeyboard;if(!i||typeof i.id=="undefined"||i.id=="")return!1;var r={};return r[t]=n,this.ruleBehavior?this.ruleBehavior.saveStore[t]=r:this.variableStoreSerializer.saveStore(this.activeKeyboard.id,t,r),!0},e.prototype.resetContextCache=function(){this.cachedContext.reset(),this.cachedContextEx.reset()},e.prototype.defaultBackspace=function(t){t.isSelectionEmpty()?this.output(1,t,""):this.output(0,t,"")},e.prototype.processNewContextEvent=function(t,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processNewContextEvent.bind(this.activeKeyboard),t,n,!0)},e.prototype.processPostKeystroke=function(t,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.processPostKeystroke.bind(this.activeKeyboard),t,n,!0)},e.prototype.processKeystroke=function(t,n){if(!this.activeKeyboard)throw"No active keyboard for keystroke processing!";return this.process(this.activeKeyboard.process.bind(this.activeKeyboard),t,n,!1)},e.prototype.process=function(t,n,i,r){if(n)if(this.activeKeyboard){if(!t)throw"No callee for keystroke processing!"}else throw"No active keyboard for keystroke processing!";else throw"No target specified for keyboard output!";n.invalidateSelection(),n.deadkeys().resetMatched(),this.resetContextCache();var s=w.from(n,!0),l=this.activeKeyboard.variableStores;this.ruleBehavior=new ut,this.activeDevice=i.device,this.activeTargetOutput=n;var o=t(n,i);this.activeTargetOutput=null,this.ruleBehavior.transcription=n.buildTranscriptionFrom(s,i,r),this.ruleBehavior.variableStores=this.activeKeyboard.variableStores,this.activeKeyboard.variableStores=l,this.ruleBehavior.triggerKeyDefault=!o;var a=this.ruleBehavior;return this.ruleBehavior=null,a},e.prototype.applyVariableStores=function(t){this.activeKeyboard.variableStores=t},e.__publishShorthandAPI=function(){var t=this.prototype,n=function(i,r){t[r]&&(t[i]=t[r])};n("KSF","saveFocus"),n("KBR","beepReset"),n("KT","insertText"),n("KR","registerKeyboard"),n("KRS","registerStub"),n("KC","context"),n("KN","nul"),n("KCM","contextMatch"),n("KFCM","fullContextMatch"),n("KIK","isKeypress"),n("KKM","keyMatch"),n("KSM","stateMatch"),n("KKI","keyInformation"),n("KDM","deadkeyMatch"),n("KB","beep"),n("KA","any"),n("KDC","deleteContext"),n("KO","output"),n("KDO","deadkeyOutput"),n("KCXO","contextExOutput"),n("KIO","indexOutput"),n("KIFS","ifStore"),n("KSETS","setStore"),n("KLOAD","loadStore"),n("KSAVE","saveStore")},e.GLOBAL_NAME="KeymanWeb",e}(ge),Qe=Mi;(function(){Mi.__publishShorthandAPI()})();var Bs=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=c.call(this)||this;return i.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1},i.modStateFlags=0,n||(n=e.DEFAULT_OPTIONS),i.contextDevice=t,i.baseLayout=n.baseLayout||e.DEFAULT_OPTIONS.baseLayout,i.keyboardInterface=n.keyboardInterface||new Qe(Ot(),ae),i.defaultRules=n.defaultOutputRules||e.DEFAULT_OPTIONS.defaultOutputRules,i}return Object.defineProperty(e.prototype,"activeKeyboard",{get:function(){return this.keyboardInterface.activeKeyboard},set:function(t){this.keyboardInterface.activeKeyboard=t,this.resetContext()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerStore",{get:function(){return this.keyboardInterface.systemStores[Y.TSS_LAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newLayerStore",{get:function(){return this.keyboardInterface.systemStores[Y.TSS_NEWLAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldLayerStore",{get:function(){return this.keyboardInterface.systemStores[Y.TSS_OLDLAYER]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layerId",{get:function(){return this.layerStore.value},set:function(t){this.layerStore.set(t)},enumerable:!1,configurable:!0}),e.prototype.defaultRuleBehavior=function(t,n,i){var r=w.from(n,i),s=new ut,l=!1,o="",a;if(t.isSynthetic||n.isSynthetic)if(l=!0,this.defaultRules.isCommand(t))s.triggersDefaultCommand=!0;else if((a=this.defaultRules.forSpecialEmulation(t))!=null)switch(a){case Rt.Backspace:this.keyboardInterface.defaultBackspace(n);break;case Rt.Enter:n.handleNewlineAtCaret();break;default:s.errorLog="Unexpected 'special emulation' character (\\u"+a.kmwCharCodeAt(0).toString(16)+") went unhandled!"}else l=!1;var g=this.activeKeyboard&&this.activeKeyboard.isMnemonic;if(!l)if((o=this.defaultRules.forAny(t,g))!=null)if(a=this.defaultRules.forSpecialEmulation(t),a==Rt.Backspace)this.keyboardInterface.defaultBackspace(n);else{if(a||this.defaultRules.isCommand(t))return null;this.keyboardInterface.output(0,n,o)}else return null;if(s.errorLog)return s;var d=n.buildTranscriptionFrom(r,t,i);return s.transcription=d,s},e.prototype.processNewContextEvent=function(t,n){return this.activeKeyboard?this.keyboardInterface.processNewContextEvent(n,this.activeKeyboard.constructNullKeyEvent(t,this.stateKeys)):null},e.prototype.processPostKeystroke=function(t,n){return this.activeKeyboard?this.keyboardInterface.processPostKeystroke(n,this.activeKeyboard.constructNullKeyEvent(t,this.stateKeys)):null},e.prototype.processKeystroke=function(t,n){var i,r=n.getTextBeforeCaret().kmwLength()==0&&n.isSelectionEmpty();if(this.activeKeyboard&&t.Lcode!=0&&(i=this.keyboardInterface.processKeystroke(n,t)),r&&t.Lcode==h.keyCodes.K_BKSP&&i.triggerKeyDefault)i=this.defaultRuleBehavior(t,n,!1),i.triggerKeyDefault=!0,i.transcription.transform.deleteLeft=1;else if(!i||i.triggerKeyDefault){t.Lcode=t.vkCode||t.Lcode,this.keyboardInterface.activeTargetOutput=n;var s=this.defaultRuleBehavior(t,n,!1);s&&(i?i.mergeInDefaults(s):i=s,i.triggerKeyDefault=!1),this.keyboardInterface.activeTargetOutput=null}return i},e.prototype._UpdateVKShift=function(t){var n=0,i=["CAPS","NUM_LOCK","SCROLL_LOCK"],r=["K_CAPS","K_NUMLOCK","K_SCROLL"];if(!this.activeKeyboard)return!0;if(t){n=t.Lmodifiers,this.activeKeyboard.isChiral&&this.activeKeyboard.emulatesAltGr&&(this.modStateFlags&h.modifierBitmasks.ALT_GR_SIM)==h.modifierBitmasks.ALT_GR_SIM&&(n|=h.modifierBitmasks.ALT_GR_SIM,n&=~h.modifierCodes.RALT);for(var s=!1,l=0;l<i.length;l++)t.Lstates&h.stateBitmasks[i[l]]&&(this.stateKeys[r[l]]=!!(t.Lstates&h.modifierCodes[i[l]]),s=!0);s&&this.emit("statekeychange",this.stateKeys)}return this.updateStates(),this.activeKeyboard.isMnemonic&&this.stateKeys.K_CAPS&&(!t||!t.isModifier)&&(n^=h.modifierCodes.SHIFT),this.layerId=this.getLayerId(n),!0},e.prototype.updateStates=function(){for(var t=["CAPS","NUM_LOCK","SCROLL_LOCK"],n=["K_CAPS","K_NUMLOCK","K_SCROLL"],i=0;i<n.length;i++){var r=n[i],s=this.stateKeys[r],l=t[i],o="NO_"+t[i];s?(this.modStateFlags|=h.modifierCodes[l],this.modStateFlags&=~h.modifierCodes[o]):(this.modStateFlags&=~h.modifierCodes[l],this.modStateFlags|=h.modifierCodes[o])}},e.prototype.getLayerId=function(t){return D.getLayerId(t)},e.prototype.selectLayer=function(t){var n=t.kName,i=t.kNextLayer,r=this.activeKeyboard&&this.activeKeyboard.isChiral;if(typeof i=="number"&&(i=this.getLayerId(i*16)),!i)switch(n){case"K_LSHIFT":case"K_RSHIFT":case"K_SHIFT":i="shift";break;case"K_LCONTROL":case"K_LCTRL":if(r){i="leftctrl";break}case"K_RCONTROL":case"K_RCTRL":if(r){i="rightctrl";break}case"K_CTRL":i="ctrl";break;case"K_LMENU":case"K_LALT":if(r){i="leftalt";break}case"K_RMENU":case"K_RALT":if(r){i="rightalt";break}case"K_ALT":i="alt";break;case"K_ALTGR":r?i="leftctrl-rightalt":i="ctrl-alt";break;case"K_CURRENCIES":case"K_NUMERALS":case"K_SHIFTED":case"K_UPPER":case"K_LOWER":case"K_SYMBOLS":i="default";break}return i?(this.updateLayer(t,i),!0):!1},e.prototype.updateLayer=function(t,n){var i=this.layerId,r=i;if(!(n==i&&t.device.formFactor!=v.FormFactor.Desktop)){var s=n,l;if(t.device.formFactor==v.FormFactor.Desktop){var o=["leftctrl","rightctrl","ctrl","leftalt","rightalt","alt","shift"];for(l=0;l<o.length;l++)s=s.replace(o[l]+"-",""),s=s.replace(o[l],"");if(i=="default"||i=="numeric"||i=="symbol"||i=="currency"||s!="")r=n;else{var a=h.getModifierState(r);for(l=0;l<o.length;l++)r=r.replace(o[l]+"-",""),r=r.replace(o[l],"");switch(n){case"shift":a^=h.modifierCodes.SHIFT;break;case"leftctrl":a^=h.modifierCodes.LCTRL;break;case"rightctrl":a^=h.modifierCodes.RCTRL;break;case"ctrl":a^=h.modifierCodes.CTRL;break;case"leftalt":a^=h.modifierCodes.LALT;break;case"rightalt":a^=h.modifierCodes.RALT;break;case"alt":a^=h.modifierCodes.ALT;break;default:r=n}r!="default"&&(r==""?r=this.getLayerId(a):r=this.getLayerId(a)+"-"+r)}r==""&&(r="default")}else r=n;var g=this.activeKeyboard.layout(t.device.formFactor);g.getLayer(r)?this.layerId=r:this.layerId="default";var d=h.getModifierState(this.layerId);this.modStateFlags=d|t.Lstates}},e.prototype.doModifierPress=function(t,n,i){return this.activeKeyboard?t.isModifier?(this.activeKeyboard.notify(t.Lcode,n,i?1:0),t.device.touchable?!0:this._UpdateVKShift(t)):(t.LmodifierChange&&(this.activeKeyboard.notify(0,n,1),t.device.touchable||this._UpdateVKShift(t)),!1):!1},e.prototype.performNewContextEvent=function(t){var n=this.processNewContextEvent(this.contextDevice,t);return n&&n.finalize(this,t,!0),n},e.prototype.resetContext=function(t){this.layerId="default",t==null||t.resetContext(),this.keyboardInterface.resetContextCache(),t&&this.performNewContextEvent(t),this.contextDevice.touchable||this._UpdateVKShift(null)},e.prototype.setNumericLayer=function(t){if(this.activeKeyboard){var n=this.activeKeyboard.layout(t.formFactor);n.getLayer("numeric")&&(this.layerId="numeric")}},e.DEFAULT_OPTIONS={baseLayout:"us",defaultOutputRules:new kt},e}(V.default),Xn=Bs;var zi=function(c){return c.substring(c.length-1)!="/"?c+"/":c},us=function(){function c(e,t){t=zi(t),this.sourcePath=t,this.protocol=t.replace(/(.{3,5}:)(.*)/,"$1"),this.updateFromOptions(e)}return c.prototype.updateFromOptions=function(e){var t=this.sourcePath.replace(/(https?:\/\/)([^\/]*)(.*)/,"$1$2/");this._root=t,e.root!=""?this._root=this.fixPath(e.root):this._root=this.fixPath(t);var n=e.resources;n==""&&(n=this.sourcePath),this._resources=this.fixPath(n),this._keyboards=this.fixPath(e.keyboards),this._fonts=this.fixPath(e.fonts)},c.prototype.fixPath=function(e){return e.length==0||(e=zi(e),e.replace(/^(http)s?:.*/,"$1")=="http"||e.replace(/^(file):.*/,"$1")=="file")?e:e.substring(0,2)=="//"?this.protocol+e:e.substring(0,1)=="/"?this.root+e.substring(1):this.sourcePath+e},Object.defineProperty(c.prototype,"fonts",{get:function(){return this._fonts},enumerable:!1,configurable:!0}),c.prototype.updateFontPath=function(e){this._fonts=this.fixPath(e)},Object.defineProperty(c.prototype,"root",{get:function(){return this._root},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"resources",{get:function(){return this._resources},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"keyboards",{get:function(){return this._keyboards},enumerable:!1,configurable:!0}),c}(),xn=us;var Gn={root:"",resources:"",keyboards:"",fonts:""};var Fs=function(){function c(e){e.OS==v.OperatingSystem.Android?this.popupCanvasBackgroundColor="#999":this.popupCanvasBackgroundColor=c.prefersDarkMode()?"#0f1319":"#ffffff"}return c.prefersDarkMode=function(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches},c}(),Ki=Fs;var Ae=function(){function c(){this.touchable="ontouchstart"in window,this.OS="",this.formFactor="desktop",this.browser="",this.dyPortrait=0,this.dyLandscape=0,this.version="0",this.orientation=window.orientation}return c.prototype.getDPI=function(){var e=document.createElement("DIV"),t=e.style,n=96;return document.readyState!=="complete"||(e.id="calculateDPI",t.position="absolute",t.display="block",t.visibility="hidden",t.left="10px",t.top="10px",t.width="1in",t.height="10px",document.body.appendChild(e),n=typeof window.devicePixelRatio=="undefined"?e.offsetWidth:e.offsetWidth*window.devicePixelRatio,document.body.removeChild(e)),n},c.prototype.detect=function(){var e=!1;if(navigator&&navigator.userAgent){var t=navigator.userAgent;if(t.indexOf("iPad")>=0)this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;else if(t.indexOf("iPhone")>=0)this.OS="iOS",this.formFactor="phone",this.dyPortrait=this.dyLandscape=25;else if(t.indexOf("Android")>=0){this.OS="Android",this.formFactor="phone",this.dyPortrait=75,this.dyLandscape=25;try{var n=new RegExp("(?:Android\\s+)(\\d+\\.\\d+\\.\\d+)");this.version=t.match(n)[1]}catch(y){}}else if(t.indexOf("Linux")>=0)this.OS="Linux";else if(t.indexOf("Macintosh")>=0){var i=/Intel Mac OS X (\d+(?:[_\.]\d+)+)/i,r=i.exec(t);if(!r)console.warn("KMW could not properly parse the user agent string.A suboptimal keyboard layout may result."),this.OS="MacOSX";else if(r.length>1&&r[1]){var s=r[1].replace("_","."),l=new tt(s);e=tt.MAC_POSSIBLE_IPAD_ALIAS.compareTo(l)<=0,this.OS="MacOSX"}}else t.indexOf("Windows NT")>=0&&(this.OS="Windows",t.indexOf("Touch")>=0&&(this.formFactor="phone"),typeof navigator.msMaxTouchPoints=="number"&&navigator.msMaxTouchPoints>0&&(this.touchable=!0))}var o=Math.min(screen.width,screen.height),a=Math.max(screen.width,screen.height),g=o/a;this.OS!="iOS"&&this.formFactor=="phone"&&(o>=600&&g>.5625||g>=.625)&&(this.formFactor="tablet");var d=navigator.platform=="Win32"||navigator.platform=="MacIntel";this.OS=="iOS"&&!("ongesturestart"in window)&&!d&&(this.OS="Android"),this.browser="web",(this.OS=="iOS"||this.OS.toLowerCase()=="macosx")&&(this.browser="safari");var B=/Firefox|Chrome|OPR|Safari|Edge/;if(B.test(navigator.userAgent)&&(navigator.userAgent.indexOf("Firefox")>=0&&"onmozorientationchange"in screen?this.browser="firefox":navigator.userAgent.indexOf("OPR")>=0?this.browser="opera":navigator.userAgent.indexOf(" Edge/")>=0?this.browser="edge":navigator.userAgent.indexOf("Chrome")>=0?this.browser="chrome":navigator.userAgent.indexOf("Safari")>=0&&(this.browser="safari")),e&&this.browser=="safari"&&window.TouchEvent){this.OS="iOS",this.formFactor="tablet",this.dyPortrait=this.dyLandscape=0;var u=screen.height/screen.width;u<1&&(u=1/u),u>1.6&&(this.formFactor="phone",this.dyPortrait=this.dyLandscape=25)}return this.colorScheme=Ki.prefersDarkMode()?"dark":"light",this.coreSpec},Object.defineProperty(c.prototype,"coreSpec",{get:function(){return new v(this.browser,this.formFactor,this.OS,this.touchable)},enumerable:!1,configurable:!0}),c}();var pn=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=c.call(this)||this;if(i.applyCacheBusting=!1,!n){var r=new Ae;r.detect(),n=r.coreSpec}return i.sourcePath=t,i.hostDevice=n,i.deferForInitialization=new A,i}return e.prototype.initialize=function(t){var n=this;this._paths?this._paths.updateFromOptions(t):this._paths=new xn(t,this.sourcePath),typeof t.setActiveOnRegister=="boolean"?this.activateFirstKeyboard=t.setActiveOnRegister:this.activateFirstKeyboard=!0,this._spacebarText=t.spacebarText,_t.spacebarTextMode=function(){return n.spacebarText}},e.prototype.finalizeInit=function(){this.deferForInitialization.resolve()},Object.defineProperty(e.prototype,"paths",{get:function(){return this._paths},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"spacebarText",{get:function(){return this._spacebarText},set:function(t){this._spacebarText!=t&&(this._spacebarText=t,this.emit("spacebartext",t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"softDevice",{get:function(){return this.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hardDevice",{get:function(){return Qn(this.hostDevice)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stubNamespacer",{get:function(){return this._stubNamespacer},set:function(t){this._stubNamespacer=t},enumerable:!1,configurable:!0}),e.prototype.debugReport=function(){return{hostDevice:this.hostDevice,initialized:this.deferForInitialization.isResolved}},e.prototype.onRuleFinalization=function(t,n){},e}(V.default);var mn=(0,Q.__assign)({setActiveOnRegister:!0,spacebarText:Bt.LANGUAGE_KEYBOARD},Gn);var Zn=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.pendingActivations=[],n.engineConfig=t,n}return Object.defineProperty(e.prototype,"predictionContext",{get:function(){return this._predictionContext},enumerable:!1,configurable:!0}),e.prototype.configure=function(t){this._resetContext=t.resetContext,this._predictionContext=t.predictionContext,this.keyboardCache=t.keyboardCache},e.prototype.insertText=function(t,n,i){var r=this.activeTarget;return r!=null?(n!=null&&t.output(0,r,n),typeof i!="undefined"&&i!==null&&t.deadkeyOutput(0,r,i),r.invalidateSelection(),!0):!1},e.prototype.resetContext=function(){this._resetContext(this.activeTarget),this.predictionContext.resetContext()},e.prototype.findAndPopActivation=function(t){var n;for(n=0;n<this.pendingActivations.length&&this.pendingActivations[n].target!=t;n++);return n==this.pendingActivations.length?null:this.pendingActivations.splice(n,1)[0]},e.prototype.deferredKeyboardActivation=function(t,n,i){return(0,Q.__awaiter)(this,void 0,void 0,function(){var r,s;return(0,Q.__generator)(this,function(l){switch(l.label){case 0:return r={target:i,keyboard:t,stub:n},this.findAndPopActivation(i),this.pendingActivations.push(r),[4,t];case 1:return l.sent(),s=this.findAndPopActivation(i),s==r?[2,r]:s?(this.pendingActivations.push(s),[2,null]):[2,null]}})})},e.prototype.activateKeyboard=function(t,n,i){return(0,Q.__awaiter)(this,void 0,void 0,function(){var r,s,l,o,a;return(0,Q.__generator)(this,function(g){switch(g.label){case 0:return r=!this.activeKeyboard,this.findAndPopActivation(this.currentKeyboardSrcTarget()),s=this.prepareKeyboardForActivation(t,n),l=this.currentKeyboardSrcTarget(),[4,s.keyboard];case 1:return o=g.sent(),o==null&&s.metadata?[2,!1]:(this.currentKeyboardSrcTarget()==l&&this.emit("beforekeyboardchange",s.metadata),a=null,o&&(a={keyboard:o,metadata:s.metadata}),this.activateKeyboardForTarget(a,l),this.currentKeyboardSrcTarget()==l&&(!r||!!o)&&this.emit("keyboardchange",this.activeKeyboard),[2,!0])}})})},e.prototype.prepareKeyboardForActivation=function(t,n){var i=this,r;n||(n="");var s=null;if(t?s=this.keyboardCache.getStub(t,n):n=="",!s){if(t)throw new Error("No matching stub has been registered.");return{keyboard:Promise.resolve(null),metadata:null}}if(((r=this.activeKeyboard)===null||r===void 0?void 0:r.metadata)&&t==this.activeKeyboard.metadata.id){var l=this.activeKeyboard.keyboard;return{keyboard:Promise.resolve(l),metadata:s}}var o;if(o=this.keyboardCache.getKeyboardForStub(s))return{keyboard:Promise.resolve(o),metadata:s};this.emit("beforekeyboardchange",s);var a=this.engineConfig.deferForInitialization.then(function(){var d=new A;i.emit("keyboardasyncload",s,d.corePromise);var B=i.keyboardCache.fetchKeyboardForStub(s),u=new Promise(function(I,F){var U="Sorry, the ".concat(s.name," keyboard for ").concat(s.langName," is not currently available.");window.setTimeout(function(){return F(new Error(U))},e.TIMEOUT_THRESHOLD)}),y=Promise.race([B,u]);return y.then(function(){d.resolve(null),u.catch(function(){})}),y.catch(function(I){throw d.resolve(I),I}),y}),g=this.deferredKeyboardActivation(a,s,this.currentKeyboardSrcTarget());return{keyboard:g.then(function(d){return(0,Q.__awaiter)(i,void 0,void 0,function(){return(0,Q.__generator)(this,function(B){return d?[2,a]:[2,Promise.resolve(null)]})})}),metadata:s}},e.TIMEOUT_THRESHOLD=1e4,e}(V.default);var ys=function(c){(0,Q.__extends)(e,c);function e(){return c!==null&&c.apply(this,arguments)||this}return e}(V.default),Jn=ys;function Vn(c,e,t){var n=h.modifierCodes;if(e&&e.isMnemonic&&c.setMnemonicCode(!!(c.Lmodifiers&n.SHIFT),!!(c.Lmodifiers&n.CAPS)),e&&!e.isMnemonic){var i=dt.languageMap[t];i&&i["k"+c.Lcode]&&(c.Lcode=i["k"+c.Lcode]),!e.definesPositionalOrMnemonic&&!(c.Lmodifiers&h.modifierBitmasks.NON_LEGACY)&&!c.isModifier&&(c=new gt({Lcode:dt._USKeyCodeToCharCode(c),Lmodifiers:0,LisVirtualKey:!1,vkCode:c.Lcode,Lstates:c.Lstates,kName:"",device:c.device,isSynthetic:!1}))}return c}var Se="Keyboard_";function q(c){return c.startsWith(Se)?c:Se+c}function pt(c){return c.startsWith(Se)?c.substring(Se.length):c}var Is=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.stubSetTable={},n.keyboardTable={},n.keyboardLoader=t,n}return e.prototype.getKeyboardForStub=function(t){return t?this.getKeyboard(t.KI):null},e.prototype.getKeyboard=function(t){if(!t)return null;var n=this.keyboardTable[q(t)];return n instanceof Promise?null:n},Object.defineProperty(e.prototype,"defaultStub",{get:function(){function t(i){var r=Object.keys(i);if(r.length!=0)return i[r[0]]}var n=t(this.stubSetTable);if(n)return t(n)},enumerable:!1,configurable:!0}),e.prototype.addKeyboard=function(t){var n=q(t.id);this.keyboardTable[n]=t,this.emit("keyboardadded",t)},e.prototype.fetchKeyboardForStub=function(t){return this.fetchKeyboard(t.KI)},e.prototype.isFetchingKeyboard=function(t){if(!t)throw new Error("Keyboard ID must be specified");t=q(t);var n=this.keyboardTable[t];return n instanceof Promise},e.prototype.fetchKeyboard=function(t){var n=this;if(!t)throw new Error("Keyboard ID must be specified");if(!this.keyboardLoader)throw new Error("Cannot load keyboards; this cache was configured without a loader");t=q(t);var i=this.keyboardTable[t];if(i instanceof j)return Promise.resolve(i);if(i instanceof Promise)return i;var r=this.getStub(t,null);if(!r)throw new Error("No stub for ".concat(pt(t)," has been registered"));if(!r.filename)throw new Error("The registered stub for ".concat(pt(t)," lacks a path to the main keyboard file"));var s=this.keyboardLoader.loadKeyboardFromStub(r);return this.keyboardTable[t]=s,s.then(function(l){l.scriptObject.KI=t,n.addKeyboard(l)}).catch(function(l){throw delete n.keyboardTable[t],l}),s},e.prototype.addStub=function(t){var n,i=q(t.KI),r=this.stubSetTable[i]=(n=this.stubSetTable[i])!==null&&n!==void 0?n:{};r[t.KLC]=t,this.emit("stubadded",t)},e.prototype.findMatchingStub=function(t){return this.getStub(t.KI,t.KLC)},e.prototype.getStub=function(t,n){var i,r,s=n||"---";t instanceof j?r=t.id:r=t,r&&(r=q(r));var l=(i=this.stubSetTable[r])!==null&&i!==void 0?i:{};if(s!="---")return l[s];var o=Object.keys(l);return o.length==0?null:l[o[0]]},e.prototype.forgetKeyboard=function(t,n){n===void 0&&(n=!1);var i=t instanceof j?t.id:q(t);this.stubSetTable[i]&&delete this.stubSetTable[i],n&&this.keyboardTable[i]&&delete this.keyboardTable[i]},e.prototype.getStubList=function(){for(var t=[],n=Object.keys(this.stubSetTable),i=0,r=n;i<r.length;i++)for(var s=r[i],l=this.stubSetTable[s],o=Object.keys(l),a=0,g=o;a<g.length;a++){var d=g[a];t.push(l[d])}return t},e}(V.default),vn=Is;var fn=["World","Africa","Asia","Europe","South America","North America","Oceania","Central America","Middle East"],Rn=["un","af","as","eu","sa","na","oc","ca","me"],Us=RegExp("^(([\\.]/)|([\\.][\\.]/)|(/))|(:)");function Oi(c,e){return e=e||"",c&&!Us.test(c)?e+c:c}var bs=function(c){(0,Q.__extends)(e,c);function e(t,n,i){var r=this;if(typeof t!="string")if(t.id!==void 0){var s=t;s.id=q(s.id),r=c.call(this,s,i)||this,r.KF=Oi(s.filename,n),r.mapRegion(s.languages)}else{var l=t;return l.KI=q(l.KI),r=c.call(this,l,i)||this,r.KF=Oi(l.KF,n),r.KP=l.KP,r.KR=l.KR,r.KRC=l.KRC,r}else r=c.call(this,q(t),n)||this;return r}return e.prototype.mapRegion=function(t){var n=t.region,i=0;if(typeof n=="number")n<1||n>9?i=0:i=n-1;else if(typeof n=="string"){for(var r=n.length==2?Rn:fn,s=0;s<r.length;s++)if(n.toLowerCase()==r[s].toLowerCase()){i=s;break}}this.KR=fn[i],this.KRC=Rn[i]},Object.defineProperty(e.prototype,"region",{get:function(){return this.KR},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"regionCode",{get:function(){return this.KRC},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"filename",{get:function(){return this.KF},enumerable:!1,configurable:!0}),e.toStubs=function(t,n,i){var r="";if(typeof t.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),t.languages||(t.languages=t.language),t?t.id?t.languages||(r="KeyboardStub has undefined languages"):r="KeyboardStub has undefined id":r="Stub undefined",r!="")return[{error:new Error(r)}];var s=[];Array.isArray(t.languages)?s=s.concat(t.languages):s.push(t.languages);var l=[];return s.forEach(function(o){var a=(0,Q.__assign)((0,Q.__assign)({},t),{languages:o,language:void 0}),g=new e(a,n,i);l.push(g)}),l},e.prototype.merge=function(t){this.KL||(this.KL=t.KL),this.KR||(this.KR=t.KR),this.KRC||(this.KRC=t.KRC),this.KN||(this.KN=t.KN),this.KF||(this.KF=t.KF),this.KFont||(this.KFont=t.KFont),this.KOskFont||(this.KOskFont=t.KOskFont),t._displayName&&(this._displayName||(this._displayName=t._displayName))},e.prototype.validateForCustomKeyboard=function(){return c.prototype.validateForCustomKeyboard.call(this)||!this.KF||!this.KR?new Error("To use a custom keyboard, you must specify file name, keyboard id, keyboard name, language, language code, and region."):null},e}(_t),ct=bs;function Be(c,e){if(e.length==0)return Promise.resolve(c);if(c.length==0)return Promise.reject(e);var t=c;return Promise.resolve(t.concat(e))}var _i="The Cloud API request timed out.",Ln="Could not find a keyboard with that ID.",Pi="The Cloud API failed to find an appropriate keyboard.",hs="Error occurred while registering keyboards: ",Cs=function(c){return c+" keyboard not found."},Xs=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=c.call(this)||this;return i.cloudResolutionPromises=new Map,i.languageFetchStarted=!1,i.registerFromCloud=function(r){var s=Number.parseInt(r.timerid),l;try{l=i._registerCore(r)}catch(a){l=new Error(hs+a)}if(s){var o=i.cloudResolutionPromises.get(s);if(o)try{l instanceof Error?o.reject(l):o.resolve(l)}finally{i.cloudResolutionPromises.delete(s)}else{i.emit("unboundregister",l);return}}else{i.emit("unboundregister",l);return}},i.requestEngine=t,i.pathConfig=n,i._languageListPromise=new A,i}return Object.defineProperty(e.prototype,"languageListPromise",{get:function(){var t=this;return this.languageFetchStarted||(this.languageFetchStarted=!0,this.keymanCloudRequest("",!0).catch(function(n){t.languageFetchStarted=!1,t._languageListPromise.reject(n),t._languageListPromise=new A})),this._languageListPromise.corePromise},enumerable:!1,configurable:!0}),e.prototype.keymanCloudRequest=function(t,n){var i=this,r="https://api.keyman.com/cloud/4.0/"+(arguments.length>1&&n?"languages":"keyboards"),s="?jsonp=keyman.register&languageidtype=bcp47&version="+tt.CURRENT.toString(),l=r+s+t,o=this.requestEngine.request(l),a=o.promise,g=o.queryId;return this.cloudResolutionPromises.set(g,a),a.finally(function(){i.cloudResolutionPromises.delete(g)}),a.corePromise},e.prototype._registerCore=function(t){var n=t.options,i=n.fontBaseUri;if(this.pathConfig.fonts!=""?i=this.pathConfig.fonts:this.pathConfig.updateFontPath(i),typeof t.error=="string"){var r="";if(typeof t.options.keyboardid=="string"){var s=t.options.keyboardid;r=s.substring(0,1).toUpperCase()+s.substring(1)}return new Error(Cs(r))}if(typeof n=="undefined"||typeof n.context=="undefined")return new Error(Ln);var l=[];if(n.context=="keyboard"){var o=void 0,a=t.keyboard;if(Array.isArray(a))for(o=0;o<a.length;o++)l=l.concat(e.registerLanguagesForKeyboard(a[o],n,o));else l=l.concat(e.registerLanguagesForKeyboard(a,n,0))}else if(n.context=="language"){var g=t.languages;return this._languageListPromise.resolve(g),g}return l},e.registerLanguagesForKeyboard=function(t,n,i){var r="";if(typeof t=="undefined")return[];if(typeof n.keyboardid=="string"&&(r=n.keyboardid.split(",")[i]),Array.isArray(t))if(t.length==1||r.substr(-1,1)=="$"||r==""){for(var s=[],l=0;l<t.length;l++)s=s.concat(this.registerLanguagesForKeyboard(t[l],n,i));return s}else{for(var o=0,l=0;l<t.length;l++){var a=t[l].id.toLowerCase();if(a=="us"&&(a="english"),Array.isArray(t[l].languages)){for(var g=t[l].languages,d=0;d<g.length;d++)if(a==g[d].name.toLowerCase()){o=l;break}}}return this.registerLanguagesForKeyboard(t[o],n,i)}else{var B=n.fontBaseUri||"",u=ct.toStubs(t,n.keyboardBaseUri,B),y=r.split("@")[1];if(u.length==1&&typeof u[0].error!="undefined")throw u[0].error;return typeof y!="string"?u:(y=y.replace(/\$$/,""),[u.find(function(I){return I.KLC==y})])}},e.prototype.fetchCloudStubs=function(t){return(0,Q.__awaiter)(this,void 0,void 0,function(){var n,i,r,s,l,o,a;return(0,Q.__generator)(this,function(g){switch(g.label){case 0:if(t.length==0)return[2,Promise.resolve([])];for(n="&keyboardid=",i="",r=0;r<t.length;r++)n=n+i+t[r].toString(),i=",";s=[],g.label=1;case 1:return g.trys.push([1,3,,4]),[4,this.keymanCloudRequest(n,!1)];case 2:return l=g.sent(),[2,Be(l,s)];case 3:return o=g.sent(),console.error(o),a={error:o},s.push(a),[2,Promise.reject(s)];case 4:return[2]}})})},e}(V.default),An=Xs;var xs=function(){function c(e,t){this.id=e,this.language=t}return c.prototype.toString=function(){var e=this.id;return this.language?(e=e+"@"+this.language,this.version&&(e=e+"@"+this.version)):this.version&&(e=e+"@@"+this.version),e},c}();function Sn(c,e){return{keyboard:{id:c.id,name:c.name},error:typeof e=="string"?new Error(e):e}}function ji(c,e,t){var n=new xs(c,e);return t&&(n.version=t),n}function qi(c,e,t){if(c.getStub(t.id,t.language)==null){for(var n=0;n<e.length;n++)if(e[n].id==t.id&&e[n].language==t.language)return!1;return!0}else return!1}var Gs=function(){function c(e,t,n){var i=this;this.pathConfig=n,this.cache=new vn(e),this.cloudQueryEngine=new An(t,this.pathConfig),this.cloudQueryEngine.on("unboundregister",function(r){Array.isArray(r)&&r.forEach(function(s){s instanceof ct&&i.cache.addStub(s)})})}return c.prototype.addKeyboardArray=function(e){for(var t=this,n=[],i=[],r=[],s=[],l=[],o=0,a=e;o<a.length;o++){var g=a[o];if(typeof g=="string")g.length>0&&s.push(g);else if(g.KI||g.KL||g.KLC||g.KFont||g.KOskFont)r.push(new ct(g));else{var d=g;if(typeof d.language!="undefined"&&console.warn("The 'language' property for keyboard stubs has been deprecated.  Please use the 'languages' property instead."),d.languages||(d.languages=d.language),typeof d.languages=="undefined"){var B="To use keyboard '"+d.id+"', you must specify languages.";l.push(Sn(d,B))}else if(Array.isArray(d.languages))for(var u=ct.toStubs(d,this.pathConfig.keyboards,this.pathConfig.fonts),y=0,I=u;y<I.length;y++){var F=I[y];F instanceof ct?r.push(F):l.push(F)}else{var U=d;r.push(new ct(U,this.pathConfig.keyboards,this.pathConfig.fonts))}}}for(var b=0,C=r;b<C.length;b++){var F=C[b];if(F.KF){var X=F.validateForCustomKeyboard();X?l.push(Sn(F,X)):n.push(F)}else i.push(F)}for(var Z=[],G=0,p=i;G<p.length;G++){var f=p[G];if(!f.KI&&!f.KLC){l.push(Sn(f,"Cannot fetch keyboard information without a keyboard ID or language code."));continue}var m=ji(pt(f.id),f.langId);qi(this.cache,Z,m)&&Z.push(m)}for(var x=0,R=s;x<R.length;x++){var k=R[x],W=k.split("@"),T=[""];W[0].toLowerCase()=="english"&&(W[0]="us"),W.length>1&&(T=W[1].split(","));for(var L=0;L<T.length;L++)if(!(L>0&&T[L]=="")){var m=ji(W[0],T[L],W[2]);qi(this.cache,Z,m)&&Z.push(m)}}n.forEach(function(H){return t.cache.addStub(H)});var S=this.cloudQueryEngine.fetchCloudStubs(Z.map(function(H){return H.toString()}));return S.then(function(H){for(var N=0,ot=H;N<ot.length;N++){var it=ot[N];it instanceof ct?(t.cache.addStub(it),n.push(it)):l.push(it)}return[].concat(l).concat(n)})},c.prototype.addLanguageKeyboards=function(e){return(0,Q.__awaiter)(this,void 0,void 0,function(){var t,n,i,r,s,l,o,a,g,d,B,u=this;return(0,Q.__generator)(this,function(y){switch(y.label){case 0:t=[],n=[],y.label=1;case 1:return y.trys.push([1,3,,4]),[4,this.cloudQueryEngine.languageListPromise];case 2:return n=y.sent(),[3,4];case 3:return i=y.sent(),console.error(i),t.push({error:i}),[2,t];case 4:for(r=n,s="",l=0;l<e.length;l++){for(o=e[l].toLowerCase(),a=o.substr(-1,1)=="$",a&&(o=o.substr(0,o.length-1)),g=!1,d=0;d<r.length;d++)if(o==r[d].name.toLowerCase()){s!=""&&(s=s+","),s=s+"@"+r[d].id,a&&(s=s+"$"),g=!0;break}g||(B={language:{name:o},error:new Error(this.alertLanguageUnavailable(o))},t.push(B))}return s==""?[2,Promise.reject(t)]:[2,this.cloudQueryEngine.keymanCloudRequest("&keyboardid="+s,!1).then(function(I){return(0,Q.__awaiter)(u,void 0,void 0,function(){var F,U,b,C;return(0,Q.__generator)(this,function(X){switch(X.label){case 0:return[4,Be(I,t)];case 1:for(F=X.sent(),U=0,b=F;U<b.length;U++)C=b[U],typeof C.error=="undefined"&&this.cache.addStub(C);return[2,F]}})})},function(I){console.error(I);var F={error:I};return t.push(F),Promise.reject(t)})]}})})},c.prototype.fetchCloudCatalog=function(){return(0,Q.__awaiter)(this,void 0,void 0,function(){var e,t,n=this;return(0,Q.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.cloudQueryEngine.keymanCloudRequest("",!1)];case 1:return e=i.sent(),e.forEach(function(r){return n.cache.addStub(r)}),[2,e];case 2:return t=i.sent(),[2,Promise.reject([{error:t}])];case 3:return[2]}})})},c.prototype.alertLanguageUnavailable=function(e){var t="No keyboards are available for "+e+". Does it have another language name?";return t},c}(),Hn=Gs;var ps=function(){function c(){this.registeredModels={},this.languageModelMap={}}return c.prototype.modelForLanguage=function(e){return this.languageModelMap[e]},c.prototype.register=function(e){if(e.id=e.id.toLowerCase(),JSON.stringify(e)!=JSON.stringify(this.registeredModels[e.id])){this.registeredModels[e.id]=e;var t=this;e.languages.forEach(function(n){if(!n){console.warn("Null / undefined language codes are not permitted for registration.");return}t.languageModelMap[n]=e})}},c.prototype.unregister=function(e){var t;if(e=e.toLowerCase(),this.registeredModels[e])t=this.registeredModels[e],delete this.registeredModels[e];else return null;var n=this;return t.languages.forEach(function(i){n.languageModelMap[i].id==e&&delete n.languageModelMap[i]}),t},c.prototype.isRegistered=function(e){return!!this.registeredModels[e.id.toLowerCase()]},c}(),Wn=ps;function He(c){for(var e=[],t=0;t<c.length;t++)e.push(c[t]);return e}function E(c){var e=document.createElement(c);return e.style.userSelect="none",e.style.webkitUserSelect="none",e}var Ft=function(){function c(e,t){if(this.fontStyleDefinitions={},this.linkedSheets=[],this.fontPromises=[],!e){var n=document.getElementsByTagName("HEAD");n.length>0?e=n[0]:e=document.body}this.linkNode=e,this.doCacheBusting=t||!1}return Object.defineProperty(c.prototype,"sheets",{get:function(){return this.linkedSheets.map(function(e){return e.sheet})},enumerable:!1,configurable:!0}),c.prototype.linkStylesheet=function(e){if(!(!(e instanceof HTMLLinkElement)&&!e.innerHTML)){var t=new A;e instanceof HTMLLinkElement?e.onload=function(){return t.resolve()}:t.resolve(),this.linkedSheets.push({sheet:e,load:t}),this.linkNode.appendChild(e)}},c.prototype.allLoadedPromise=function(){return(0,Q.__awaiter)(this,void 0,void 0,function(){var e;return(0,Q.__generator)(this,function(t){switch(t.label){case 0:return e=this.linkedSheets.map(function(n){return n.load.corePromise}),Promise.allSettled?[4,Promise.allSettled(e)]:[3,2];case 1:return t.sent(),[3,4];case 2:return[4,Promise.all(e)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},c.prototype.addStyleSheetForFont=function(e,t,n){var i=this;if(!e||typeof e.files=="undefined")return null;var r=e.family,s,l,o="",a="",g=[];n||(n=v.OperatingSystem.Other);var d=this.fontStyleDefinitions[n]=this.fontStyleDefinitions[n]||{};if(d[r]){var B=d[r];return B.parentNode||this.linkStylesheet(B),null}for(typeof e.files=="string"?g[0]=e.files:g=e.files,l=0;l<g.length;l++)g[l].toLowerCase().indexOf(".otf")>0&&(o=g[l]),g[l].toLowerCase().indexOf(".ttf")>0&&(o=g[l]),g[l].toLowerCase().indexOf(".woff")>0&&(a=g[l]);o!=""&&o.indexOf("/")<0&&(o=t+o),a!=""&&a.indexOf("/")<0&&(a=t+a);var u="@font-face {\nfont-family:"+e.family+";\nfont-style:normal;\nfont-weight:normal;\n";if(n==v.OperatingSystem.iOS?o!=""&&(this.doCacheBusting&&(o=this.cacheBust(o)),s="url('"+encodeURI(o)+"') format('truetype')"):(a!=""&&(s="url('"+encodeURI(a)+"') format('woff')"),o!=""&&(s="url('"+encodeURI(o)+"') format('truetype')")),!s)return null;u+="src:"+s+";",u=u+"\n}\n";var y=At(u);d[r]=y;var I=new FontFace(e.family,s),F=I.load(),U=function(){i.fontPromises=i.fontPromises.filter(function(b){return b!=F})};return this.fontPromises.push(F.then(U).catch(U)),this.linkStylesheet(y),y},c.prototype.cacheBust=function(e){return e+"?v="+new Date().getTime()},c.prototype.linkExternalSheet=function(e,t){try{if(!t&&document.querySelector("link[href="+JSON.stringify(e)+"]")!=null)return null}catch(i){return null}var n=document.createElement("link");return n.type="text/css",n.rel="stylesheet",n.href=e,this.linkStylesheet(n),n},c.prototype.unlink=function(e){var t=this.linkedSheets.findIndex(function(i){return i.sheet==e});if(t>-1){var n=this.linkedSheets.splice(t,1);return n[0].load.resolve(),e.parentNode.removeChild(e),!0}return!1},c.prototype.unlinkAll=function(){for(var e=0,t=this.linkedSheets;e<t.length;e++){var n=t[e],i=n.sheet;i.parentNode&&i.parentNode.removeChild(i),n.load.resolve()}this.linkedSheets.splice(0,this.linkedSheets.length)},c}();function At(c){var e=document.createElement("style");return e.type="text/css",e.appendChild(document.createTextNode(c)),e}function rt(){var c;return typeof window.orientation!="undefined"?c=window.orientation:typeof window.screen.orientation!="undefined"&&(c=window.screen.orientation.angle),c!==void 0?Math.abs(c/90)==1:!1}var ms=function(){function c(e){this.name=e}return c.prototype.load=function(e){return this.loadCookie(this.name,e||function(t){return t})},c.prototype.save=function(e,t){this.saveCookie(this.name,e,t||function(n){return n})},c.prototype._loadRawCookies=function(){var e={};if(typeof document.cookie!="undefined"&&document.cookie!="")for(var t=document.cookie.split(/;\s*/),n=0;n<t.length;n++){var i=t[n].split("=");i.length==2&&(e[i[0]]=i[1])}return e},c.prototype.loadCookie=function(e,t){var n={},i=this._loadRawCookies(),r=i[e];if(r)for(var s=decodeURIComponent(r).split(";"),l=0;l<s.length&&!(l==s.length-1&&!s[l]);l++){var o=s[l].split("=");if(o.length>1){var a=o[0],g=o[1];n[a]=t(g,a)}else n[o[0]]=""}return n},c.prototype.saveCookie=function(e,t,n){var i="";for(var r in t)i+=r+"="+n(t[r],r)+";";var s=new Date(new Date().valueOf()+1e3*60*60*24*30).toUTCString(),l=" path=/; expires="+s;document.cookie="".concat(e,"=").concat(encodeURIComponent(i),"; ").concat(l)},c}(),yt=ms;function z(c){var e;if(!c)return 0;var t=c.offsetLeft?c.offsetLeft:0;if(e=c,e.offsetParent){for(;e.offsetParent;)e=e.offsetParent,t+=e.offsetLeft;var n=e.ownerDocument;e.style.position=="fixed"&&n&&n.scrollingElement&&(t+=n.scrollingElement.scrollLeft)}if(e&&e.ownerDocument&&c.ownerDocument!=window.document){var i=e.ownerDocument;if(i&&i.defaultView&&i.defaultView.frameElement)return t+z(i.defaultView.frameElement)-i.documentElement.scrollLeft}return t}function K(c){var e;if(!c)return 0;var t=c.offsetTop?c.offsetTop:0;if(e=c,e.ownerDocument&&e instanceof e.ownerDocument.defaultView.HTMLElement){for(;e.offsetParent;)e=e.offsetParent,t+=e.offsetTop;var n=e.ownerDocument;e.style.position=="fixed"&&n&&n.scrollingElement&&(t+=n.scrollingElement.scrollTop)}if(e&&e.ownerDocument&&c.ownerDocument!=window.document){var i=e.ownerDocument;if(i&&i.defaultView&&i.defaultView.frameElement)return t+K(i.defaultView.frameElement)}return t}var $i=function(c){(0,Q.__extends)(e,c);function e(t,n){return c.call(this,"KeymanWeb_".concat(t,"_Option_").concat(n))||this}return e.prototype.load=function(){return c.prototype.load.call(this,decodeURIComponent)},e.prototype.save=function(t){c.prototype.save.call(this,t,encodeURIComponent)},e}(yt),Nn=function(){function c(){}return c.prototype.loadStore=function(e,t){var n=new $i(e,t);return n.load()},c.prototype.saveStore=function(e,t,n){var i=new $i(e,t);i.save(n)},c}();var tc=function(c){(0,Q.__extends)(e,c);function e(t,n,i){var r=c.call(this,t,n,new Nn)||this;return r.insertText=function(s,l){r.resetContextCache(),r.engine.contextManager.insertText(r,s,l)},r.KT=r.insertText,r.engine=n,r.stubNamespacer=i,r}return e.prototype.preserveID=function(t){var n;if(document.currentScript)n=document.currentScript.id;else{var i=document.getElementsByTagName("script"),r=i[i.length-1];n=r.id}if(n)n.indexOf(pt(t.KI))!=-1?t.KI=n:console.error("Error when registering keyboard:  current SCRIPT tag's ID does not match!");else return},e.prototype.registerKeyboard=function(t){var n=this;c.prototype.registerKeyboard.call(this,t);var i=this.loadedKeyboard;this.preserveID(t),this.engine.config.deferForInitialization.then(function(){n.engine.keyboardRequisitioner.cache.isFetchingKeyboard(i.id)||(n.engine.keyboardRequisitioner.cache.addKeyboard(i),n.loadedKeyboard=null)})},e.prototype.registerStub=function(t){var n=this,i;this.stubNamespacer&&this.stubNamespacer(t);var r=function(){var l=n.engine.config.paths;return new ct(t,l.keyboards,l.fonts)};if(!this.engine.config.deferForInitialization.isResolved)this.engine.config.deferForInitialization.then(function(){return n.engine.keyboardRequisitioner.cache.addStub(r())});else{var s=r();if(!((i=this.engine.keyboardRequisitioner)===null||i===void 0)&&i.cache.findMatchingStub(s))return 1;this.engine.keyboardRequisitioner.cache.addStub(s)}return null},e}(Qe),En=tc;(function(){tc.__publishShorthandAPI()})();var ec=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=this;return t&&t._jsGlobal!=window&&(t._jsGlobal.String=window.String),t?i=c.call(this,t)||this:i=c.call(this,new ge(window,ae))||this,i.performCacheBusting=n||!1,i}return e.prototype.loadKeyboardInternal=function(t,n,i){var r=this,s=new A;this.performCacheBusting&&(t=this.cacheBust(t));try{var l=this.harness._jsGlobal.document,o=l.createElement("script");i&&(o.id=i),l.head.appendChild(o),o.onerror=function(a){s.reject(n.missingError(a))},o.onload=function(){if(r.harness.loadedKeyboard){var a=r.harness.loadedKeyboard;r.harness.loadedKeyboard=null,s.resolve(a)}else s.reject(n.scriptError())},s.then(function(){o.remove()}).catch(function(){o.remove()}),o.src=t}catch(a){return Promise.reject(a)}return s.corePromise},e.prototype.cacheBust=function(t){return t+"?v="+new Date().getTime()},e}(yn);function We(c,e){var t=new Map;return e.keys.forEach(function(n){var i=Math.abs(c.x-n.centerX),r=Math.abs(c.y-n.centerY),s,l;i>.5*n.width?(s=i-.5*n.width,i=.5):(s=0,i/=n.width),r>.5*n.height?(l=r-.5*n.height,r=.5):(l=0,r/=n.height),s*=e.kbdScaleRatio,s+=i*n.height,l+=r*n.height;var o=s*s+l*l;t.set(n.keySpec,o)}),t}function St(c){var e,t,n,i,r,s,l,o=new Map,a=0;Array.isArray(c)||(c=[c]);try{for(var g=(0,Q.__values)(c),d=g.next();!d.done;d=g.next()){var B=d.value;try{for(var u=(n=void 0,(0,Q.__values)(B.keys())),y=u.next();!y.done;y=u.next()){var I=y.value,F=1/(Math.pow(B.get(I),2)+1e-6);a+=F,o.set(I,(l=o.get(I))!==null&&l!==void 0?l:0+F)}}catch(X){n={error:X}}finally{try{y&&!y.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}}catch(X){e={error:X}}finally{try{d&&!d.done&&(t=g.return)&&t.call(g)}finally{if(e)throw e.error}}var U=[];try{for(var b=(0,Q.__values)(o.keys()),C=b.next();!C.done;C=b.next()){var I=C.value;U.push({keySpec:I,p:o.get(I)/a})}}catch(X){r={error:X}}finally{try{C&&!C.done&&(s=b.return)&&s.call(b)}finally{if(r)throw r.error}}return U.sort(function(X,Z){return Z.p-X.p})}var Zs=function(){function c(e,t,n){this.keySpec=n,this.centerX=n.proportionalX,this.centerY=t.proportionalY,this.width=n.proportionalWidth,this.height=e.rowProportionalHeight}return c}();function Js(c){return c.baseKeyID?h.isFrameKey(c.baseKeyID)?!1:!c.isPadding:!1}function nc(c,e){return{keys:c.row.map(function(t){return t.key.map(function(n){return new Zs(c,t,n)})}).reduce(function(t,n){return t.concat(n)},[]).filter(function(t){return Js(t.keySpec)}),kbdScaleRatio:e}}var Vs=function(){function c(e,t,n){this.left=e.getTextBeforeCaret(),this.startOfBuffer=this.left._kmwLength()<=t.leftContextCodePoints,this.startOfBuffer||(this.left=this.left._kmwSubstr(-t.leftContextCodePoints)),this.right=e.getTextAfterCaret(),this.endOfBuffer=this.right._kmwLength()<=t.rightContextCodePoints,this.endOfBuffer||(this.right=this.right._kmwSubstr(0,t.rightContextCodePoints)),this.casingForm=n=="shift"?"initial":n=="caps"?"upper":null}return c.prototype.toMock=function(){var e=this.left._kmwLength();return new w(this.left+(this.right||""),e)},c.ENGINE_RULE_WINDOW={leftContextCodePoints:64,rightContextCodePoints:32},c}(),mt=Vs;var vs=function(){function c(){this._promises=new Map}return Object.defineProperty(c.prototype,"length",{get:function(){return this._promises.size},enumerable:!1,configurable:!0}),c.prototype.make=function(e,t,n){if(this._promises.has(e))return n("Existing request with token ".concat(e));this._promises.set(e,{reject:n,resolve:t})},c.prototype.keep=function(e,t){var n=this._promises.get(e);if(!n)throw new Error("No promise associated with token: ".concat(e));var i=n.resolve;return this._promises.delete(e),i(t)},c.prototype.break=function(e,t){var n=this._promises.get(e);if(!n)throw new Error("No promise associated with token: ".concat(e));this._promises.delete(e),n.reject(t)},c}(),ue=vs;var fs=function(){function c(e,t,n){this._worker=t,this._worker.onmessage=this.onMessage.bind(this),this._declareLMLayerReady=null,this._predictPromises=new ue,this._wordbreakPromises=new ue,this._acceptPromises=new ue,this._revertPromises=new ue,this._nextToken=Number.MIN_SAFE_INTEGER,this.sendConfig(e,!!n)}return c.prototype.sendConfig=function(e,t){this._worker.postMessage({message:"config",capabilities:e,testMode:t})},c.prototype.loadModel=function(e,t){var n=this;return t===void 0&&(t="file"),new Promise(function(i,r){n._declareLMLayerReady=i;var s={type:t};t=="file"?s.file=e:s.code=e,n._worker.postMessage({message:"load",source:s})})},c.prototype.unloadModel=function(){this._worker.postMessage({message:"unload"})},c.prototype.predict=function(e,t){var n=this,i=this._nextToken++;return new Promise(function(r,s){n._predictPromises.make(i,r,s),n._worker.postMessage({message:"predict",token:i,transform:e,context:t})})},c.prototype.wordbreak=function(e){var t=this,n=this._nextToken++;return new Promise(function(i,r){t._wordbreakPromises.make(n,i,r),t._worker.postMessage({message:"wordbreak",token:n,context:e})})},c.prototype.acceptSuggestion=function(e,t,n){var i=this,r=this._nextToken++;return new Promise(function(s,l){i._acceptPromises.make(r,s,l),i._worker.postMessage({message:"accept",token:r,suggestion:e,context:t,postTransform:n})})},c.prototype.revertSuggestion=function(e,t){var n=this,i=this._nextToken++;return new Promise(function(r,s){n._revertPromises.make(i,r,s),n._worker.postMessage({message:"revert",token:i,reversion:e,context:t})})},c.prototype.resetContext=function(e){this._worker.postMessage({message:"reset-context",context:e})},c.prototype.onMessage=function(e){var t=e.data;if(t.message==="error")console.error(t.log),t.error&&console.error(t.error);else if(t.message==="ready")this._declareLMLayerReady(e.data.configuration);else if(t.message==="suggestions")this._predictPromises.keep(t.token,t.suggestions);else if(t.message==="currentword")this._wordbreakPromises.keep(t.token,t.word);else if(t.message==="postaccept")this._acceptPromises.keep(t.token,t.reversion);else if(t.message==="postrevert")this._revertPromises.keep(t.token,t.suggestions);else throw new Error("Message not implemented: ".concat(t.message))},c.prototype.shutdown=function(){this._worker.terminate()},c}(),kn=fs;function Ne(c){return c}var ic='"use strict";/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){"use strict";var R=function(){try{var A={},I=Object.defineProperty,O=I(A,A,A)&&I}catch(q){}return O}(),k=function(A){if(this==null)throw TypeError();var I=String(this),O=I.length,q=A?Number(A):0;if(q!=q&&(q=0),!(q<0||q>=O)){var D=I.charCodeAt(q),F;return D>=55296&&D<=56319&&O>q+1&&(F=I.charCodeAt(q+1),F>=56320&&F<=57343)?(D-55296)*1024+F-56320+65536:D}};R?R(String.prototype,"codePointAt",{value:k,configurable:!0,writable:!0}):String.prototype.codePointAt=k}(),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(R){if(this==null)throw new TypeError("this is null or not defined");for(var k=Object(this),A=k.length>>>0,I=arguments[1],O=I>>0,q=O<0?Math.max(A+O,0):Math.min(O,A),D=arguments[2],F=D===void 0?A:D>>0,J=F<0?Math.max(A+F,0):Math.min(F,A);q<J;)k[q]=R,q++;return k}});/**\n* Array.prototype.findIndex() polyfill\n* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex\n* @license MIT\n*/Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(R){if(this==null)throw new TypeError(\'"this" is null or not defined\');var k=Object(this),A=k.length>>>0;if(typeof R!="function")throw new TypeError("predicate must be a function");for(var I=arguments[1],O=0;O<A;){var q=k[O];if(R.call(I,q,O,k))return O;O++}return-1},configurable:!0,writable:!0}),Array.prototype.includes||(Array.prototype.includes=function(R){return!!~this.indexOf(R)}),Object.keys||(Object.keys=function(){"use strict";var R=Object.prototype.hasOwnProperty,k=!{toString:null}.propertyIsEnumerable("toString"),A=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],I=A.length;return function(O){if(typeof O!="function"&&(typeof O!="object"||O===null))throw new TypeError("Object.keys called on non-object");var q=[],D,F;for(D in O)R.call(O,D)&&q.push(D);if(k)for(F=0;F<I;F++)R.call(O,A[F])&&q.push(A[F]);return q}}());var reduce=Function.bind.call(Function.call,Array.prototype.reduce),isEnumerable=Function.bind.call(Function.call,Object.prototype.propertyIsEnumerable),concat=Function.bind.call(Function.call,Array.prototype.concat),keys=Object.keys;Object.values||(Object.values=function(k){return reduce(keys(k),function(A,I){return concat(A,typeof I=="string"&&isEnumerable(k,I)?[k[I]]:[])},[])}),Object.entries||(Object.entries=function(k){return reduce(keys(k),function(A,I){return concat(A,typeof I=="string"&&isEnumerable(k,I)?[[I,k[I]]]:[])},[])}),self.Symbol||function(R,k){"use strict";typeof module=="object"&&typeof module.exports=="object"?module.exports=k(R):k(R)}(typeof window!="undefined"?window:self||global,function(R){"use strict";var k=Object.defineProperty,A=Object.defineProperties,I=0,O=[],q=Array.prototype.slice,D=typeof R.ES6=="object"?R.ES6:R.ES6={},F=Array.isArray,J=Object.prototype.toString,Oe=Array.prototype.push,we=function(){},Se=function(h){return h},x=function(h){return typeof h=="function"},he=function(){},B=function(h,g){this._array=h,this._flag=g,this._nextIndex=0},H=function(h,g){this._string=h,this._flag=g,this._nextIndex=0},K=function(h){return h!==null&&(typeof h=="object"||typeof h=="function")},X=function(h,g){return A(h,{_description:{value:g},_isSymbol:{value:!0},_id:{value:I++}}),h},le=function(h,g){if(typeof h.length=="number"&&h.length>=0&&typeof g.length=="number"&&g.length>=0){var M=Math.floor(h.length),b=Math.floor(g.length),j=0;for(h.length=M+b;j<b;++j)g.hasOwnProperty(j)&&(h[M+j]=g[j])}},$=function(h,g){if(typeof h!="function"||typeof g!="function")throw new TypeError("Child and Parent must be function type");h.prototype=Object.create(g.prototype),h.prototype.constructor=h},P=function h(g){if(g=g===void 0?"":String(g),this instanceof h)throw new TypeError("Symbol is not a constructor");return X(Object.create(h.prototype),g)};A(P,{for:{value:function(h){h=String(h);for(var g,M=O.length,b=0;b<M;++b)if((g=O[b]).key===h)return g.symbol;return g={key:h,symbol:P(h)},O.push(g),g.symbol},writable:!0,configurable:!0},keyFor:{value:function(h){if(!D.isSymbol(h))throw new TypeError(String(h)+" is not a symbol");for(var g,M=O.length,b=0;b<M;++b)if((g=O[b]).symbol===h)return g.key},writable:!0,configurable:!0},hasInstance:{value:P("Symbol.hasInstance")},isConcatSpreadable:{value:P("Symbol.isConcatSpreadable")},iterator:{value:P("Symbol.iterator")},toStringTag:{value:P("Symbol.toStringTag")}}),P.prototype.toString=function(){return"@@_____"+this._id+"_____"},P.prototype.valueOf=function(){return this},k(he.prototype,P.iterator.toString(),{value:function(){return this},writable:!0,configurable:!0}),$(B,he),$(H,he),k(B.prototype,P.toStringTag.toString(),{value:"Array Iterator",configurable:!0}),k(H.prototype,P.toStringTag.toString(),{value:"String Iterator",configurable:!0}),B.prototype.next=function(){if(!(this instanceof B))throw new TypeError("Method Array Iterator.prototype.next called on incompatible receiver "+String(this));var h;return this._nextIndex===-1?{done:!0,value:void 0}:typeof this._array.length=="number"&&this._array.length>=0&&this._nextIndex<Math.floor(this._array.length)?(this._flag===1?h=[this._nextIndex,this._array[this._nextIndex]]:this._flag===2?h=this._array[this._nextIndex]:this._flag===3&&(h=this._nextIndex),this._nextIndex++,{done:!1,value:h}):(this._nextIndex=-1,{done:!0,value:void 0})},H.prototype.next=function(){if(!(this instanceof H))throw new TypeError("Method String Iterator.prototype.next called on incompatible receiver "+String(this));var h,g=new String(this._string);return this._nextIndex===-1?{done:!0,value:void 0}:this._nextIndex<g.length?(h=g[this._nextIndex],this._nextIndex++,{done:!1,value:h}):(this._nextIndex=-1,{done:!0,value:void 0})};var z=function(h,g){this._target=h,this._values=[],this._thisArg=g};return z.prototype.spread=function(){var h=this;return q.call(arguments).forEach(function(g){D.forOf(g,function(M){h._values.push(M)})}),h},z.prototype.add=function(){var h=this;return q.call(arguments).forEach(function(g){h._values.push(g)}),h},z.prototype.call=function(h){if(typeof this._target!="function")throw new TypeError("Target is not a function");return h=arguments.length<=0?this._thisArg:h,this._target.apply(h,this._values)},z.prototype.new=function(){if(typeof this._target!="function")throw new TypeError("Target is not a constructor");var h,g;return h=Object.create(this._target.prototype),g=this._target.apply(h,this._values),K(g)?g:h},z.prototype.array=function(){if(!F(this._target))throw new TypeError("Target is not a array");return Oe.apply(this._target,this._values),this._target},A(D,{isSymbol:{value:function(h){return h instanceof P&&function(g){return g._isSymbol===!0&&typeof g._id=="number"&&typeof g._description=="string"}(h)},writable:!0,configurable:!0},instanceOf:{value:function(h,g){if(!K(g))throw new TypeError("Right-hand side of \'instanceof\' is not an object");var M=g[P.hasInstance];if(M===void 0)return h instanceof g;if(typeof M!="function")throw new TypeError(typeof M+" is not a function");return M.call(g,h)},writable:!0,configurable:!0},forOf:{value:function(h,g,M){if(g=typeof g!="function"?we:g,typeof h[P.iterator]!="function")throw new TypeError("Iterable[Symbol.iterator] is not a function");var b,j=h[P.iterator]();if(typeof j.next!="function")throw new TypeError(".iterator.next is not a function");for(;;){if(b=j.next(),!K(b))throw new TypeError("Iterator result "+b+" is not an object");if(b.done)break;g.call(M,b.value)}},writable:!0,configurable:!0},spreadOperator:{value:function(h,g){if(typeof h!="function"&&!F(h))throw new TypeError("Spread operator only supports on array and function objects at this moment");return new z(h,g)},writable:!0,configurable:!0}}),k(R,"Symbol",{value:P,writable:!0,configurable:!0}),k(Function.prototype,P.hasInstance.toString(),{value:function(h){return typeof this=="function"&&h instanceof this}}),k(Array.prototype,"concat",{value:function(){if(this===void 0||this===null)throw new TypeError("Array.prototype.concat called on null or undefined");var h=Object(this),g=q.call(arguments),M=[];return g.unshift(h),g.forEach(function(b){K(b)?b[P.isConcatSpreadable]!==void 0?b[P.isConcatSpreadable]?le(M,b):M.push(b):F(b)?le(M,b):M.push(b):M.push(b)}),M},writable:!0,configurable:!0}),k(Object.prototype,"toString",{value:function(){return this===void 0||this===null?J.call(this):typeof this[P.toStringTag]=="string"?"[object "+this[P.toStringTag]+"]":J.call(this)},writable:!0,configurable:!0}),k(Array.prototype,P.iterator.toString(),{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var h=Object(this);return new B(h,2)},writable:!0,configurable:!0}),k(Array,"from",{value:function(h,g,M){var b,j,U,Y=0;if(b=x(this)?this:Array,h==null)throw new TypeError("Cannot convert undefined or null to object");if(h=Object(h),g===void 0)g=Se;else if(!x(g))throw new TypeError(g+" is not a function");if(h[P.iterator]===void 0){if(!(typeof h.length=="number"&&h.length>=0))return(U=new b(0)).length=0,U;for(j=Math.floor(h.length),(U=new b(j)).length=j;Y<j;++Y)U[Y]=g.call(M,h[Y])}else(U=new b).length=0,D.forOf(h,function(pe){U.length++,U[U.length-1]=g.call(M,pe)});return U},writable:!0,configurable:!0}),k(Array.prototype,"entries",{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var h=Object(this);return new B(h,1)},writable:!0,configurable:!0}),k(Array.prototype,"keys",{value:function(){if(this===void 0||this===null)throw new TypeError("Cannot convert undefined or null to object");var h=Object(this);return new B(h,3)},writable:!0,configurable:!0}),k(String.prototype,P.iterator.toString(),{value:function(){if(this===void 0||this===null)throw new TypeError("String.prototype[Symbol.iterator] called on null or undefined");return new H(String(this),0)},writable:!0,configurable:!0}),D}),function(){var R=Object.create,k=Object.defineProperty,A=Object.getOwnPropertyDescriptor,I=Object.getOwnPropertyNames,O=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty,D=function(r,e){return function(){return e||(0,r[I(r)[0]])((e={exports:{}}).exports,e),e.exports}},F=function(r,e){for(var t in e)k(r,t,{get:e[t],enumerable:!0})},J=function(r,e,t,n){if(e&&typeof e=="object"||typeof e=="function")for(var i=I(e),a=0,l=i.length,o;a<l;a++)o=i[a],!q.call(r,o)&&o!==t&&k(r,o,{get:function(s){return e[s]}.bind(null,o),enumerable:!(n=A(e,o))||n.enumerable});return r},Oe=function(r,e,t){return J(r,e,"default"),t&&J(t,e,"default")},we=function(r,e,t){return t=r!=null?R(O(r)):{},J(e||!r||!r.__esModule?k(t,"default",{value:r,enumerable:!0}):t,r)},Se=D({"../../../node_modules/tslib/tslib.js":function(r,e){var t,n,i,a,l;(function(o){var s=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(c){o(u(s,u(c)))}):typeof e=="object"&&typeof e.exports=="object"?o(u(s,u(e.exports))):o(u(s));function u(c,f){return c!==s&&(typeof Object.create=="function"?Object.defineProperty(c,"__esModule",{value:!0}):c.__esModule=!0),function(v,p){return c[v]=f?f(v,p):p}}})(function(o){var s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,c){u.__proto__=c}||function(u,c){for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(u[f]=c[f])};t=function(u,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");s(u,c);function f(){this.constructor=u}u.prototype=c===null?Object.create(c):(f.prototype=c.prototype,new f)},n=Object.assign||function(u){for(var c,f=1,v=arguments.length;f<v;f++){c=arguments[f];for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(u[p]=c[p])}return u},i=function(u,c){var f={label:0,sent:function(){if(d[0]&1)throw d[1];return d[1]},trys:[],ops:[]},v,p,d,m;return m={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function C(y){return function(S){return T([y,S])}}function T(y){if(v)throw new TypeError("Generator is already executing.");for(;m&&(m=0,y[0]&&(f=0)),f;)try{if(v=1,p&&(d=y[0]&2?p.return:y[0]?p.throw||((d=p.return)&&d.call(p),0):p.next)&&!(d=d.call(p,y[1])).done)return d;switch(p=0,d&&(y=[y[0]&2,d.value]),y[0]){case 0:case 1:d=y;break;case 4:return f.label++,{value:y[1],done:!1};case 5:f.label++,p=y[1],y=[0];continue;case 7:y=f.ops.pop(),f.trys.pop();continue;default:if(d=f.trys,!(d=d.length>0&&d[d.length-1])&&(y[0]===6||y[0]===2)){f=0;continue}if(y[0]===3&&(!d||y[1]>d[0]&&y[1]<d[3])){f.label=y[1];break}if(y[0]===6&&f.label<d[1]){f.label=d[1],d=y;break}if(d&&f.label<d[2]){f.label=d[2],f.ops.push(y);break}d[2]&&f.ops.pop(),f.trys.pop();continue}y=c.call(u,f)}catch(S){y=[6,S],p=0}finally{v=d=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}},a=function(u){var c=typeof Symbol=="function"&&Symbol.iterator,f=c&&u[c],v=0;if(f)return f.call(u);if(u&&typeof u.length=="number")return{next:function(){return u&&v>=u.length&&(u=void 0),{value:u&&u[v++],done:!u}}};throw new TypeError(c?"Object is not iterable.":"Symbol.iterator is not defined.")},l=function(u,c){var f=typeof Symbol=="function"&&u[Symbol.iterator];if(!f)return u;var v=f.call(u),p,d=[],m;try{for(;(c===void 0||c-- >0)&&!(p=v.next()).done;)d.push(p.value)}catch(C){m={error:C}}finally{try{p&&!p.done&&(f=v.return)&&f.call(v)}finally{if(m)throw m.error}}return d},o("__extends",t),o("__assign",n),o("__generator",i),o("__values",a),o("__read",l)})}}),x={};F(x,{tslib:function(){return he}}),Oe(x,we(Se(),1));var he=we(Se(),1);function B(){String.kmwFromCharCode=function(r){var e=[],t;for(t=0;t<arguments.length;t++){var n=Number(arguments[t]);if(!isFinite(n)||n<0||n>1114111||Math.floor(n)!==n)throw new RangeError("Invalid code point "+n);n<65536?e.push(n):(n-=65536,e.push((n>>10)+55296),e.push(n%1024+56320))}return String.fromCharCode.apply(void 0,e)},String.prototype.kmwCharCodeAt=function(r){var e=String(this),t=0;if(r<0||r>=e.length)return NaN;for(var n=0;n<r;n++)if(t=e.kmwNextChar(t),t===null)return NaN;var i=e.charCodeAt(t);if(i>=55296&&i<=56319&&e.length>t+1){var a=e.charCodeAt(t+1);if(a>=56320&&a<=57343)return(i-55296<<10)+(a-56320)+65536}return i},String.prototype.kmwIndexOf=function(r,e){var t=String(this),n=t.indexOf(r,e);if(n<0)return n;for(var i=0,a=0;a!==null&&a<n;a=t.kmwNextChar(a))i++;return i},String.prototype.kmwLastIndexOf=function(r,e){var t=String(this),n=t.lastIndexOf(r,e);if(n<0)return n;for(var i=0,a=0;a!==null&&a<n;a=t.kmwNextChar(a))i++;return i},String.prototype.kmwLength=function(){var r=String(this);if(r.length==0)return 0;for(var e=0,t=0;t!==null;e++)t=r.kmwNextChar(t);return e},String.prototype.kmwSlice=function(r,e){var t=String(this),n=t.kmwCodePointToCodeUnit(r),i=t.kmwCodePointToCodeUnit(e);return n===null||i===null?"":t.slice(n,i)},String.prototype.kmwSubstr=function(r,e){var t=String(this);r<0&&(r=t.kmwLength()+r),r<0&&(r=0);var n=t.kmwCodePointToCodeUnit(r),i=n;if(n===null)return"";if(arguments.length<2)i=t.length;else for(var a=0;a<e;a++)i=t.kmwNextChar(i);return i===null?t.substring(n):t.substring(n,i)},String.prototype.kmwSubstring=function(r,e){var t=String(this),n,i;if(typeof e=="undefined")n=t.kmwCodePointToCodeUnit(r),i=t.length;else{if(r>e){var a=r;r=e,e=a}n=t.kmwCodePointToCodeUnit(r),i=t.kmwCodePointToCodeUnit(e)}return(isNaN(n)||n===null)&&(n=0),(isNaN(i)||i===null)&&(i=t.length),t.substring(n,i)},String.prototype.kmwNextChar=function(r){var e=String(this);if(r===null||r<0||r>=e.length-1)return null;var t=e.charCodeAt(r);if(t>=55296&&t<=56319&&e.length>r+1){var n=e.charCodeAt(r+1);if(n>=56320&&n<=57343)return r==e.length-2?null:r+2}return r+1},String.prototype.kmwPrevChar=function(r){var e=String(this);if(r==null||r<=0||r>e.length)return null;var t=e.charCodeAt(r-1);if(t>=56320&&t<=57343&&r>1){var n=e.charCodeAt(r-2);if(n>=55296&&n<=56319)return r-2}return r-1},String.prototype.kmwCodePointToCodeUnit=function(r){if(r===null)return null;var e=String(this),t=0;if(r<0){t=e.length;for(var n=0;n>r;n--)t=e.kmwPrevChar(t);return t}if(r==e.kmwLength())return e.length;for(var n=0;n<r;n++)t=e.kmwNextChar(t);return t},String.prototype.kmwCodeUnitToCodePoint=function(r){var e=String(this);return r===null?null:r==0?0:r<0?e.substr(r).kmwLength():e.substr(0,r).kmwLength()},String.prototype.kmwCharAt=function(r){var e=String(this);return r>=0?e.kmwSubstr(r,1):""},String.prototype.kmwBMPNextChar=function(r){var e=String(this);return r<0||r>=e.length-1?null:r+1},String.prototype.kmwBMPPrevChar=function(r){var e=String(this);return r<=0||r>e.length?null:r-1},String.prototype.kmwBMPCodePointToCodeUnit=function(r){return r},String.prototype.kmwBMPCodeUnitToCodePoint=function(r){return r},String.prototype.kmwBMPLength=function(){var r=String(this);return r.length},String.prototype.kmwBMPSubstr=function(r,e){var t=String(this);return r>-1?t.substr(r,e):t.substr(t.length+r,-r)},String.kmwEnableSupplementaryPlane=function(r){var e=String.prototype;String._kmwFromCharCode=r?String.kmwFromCharCode:String.fromCharCode,e._kmwCharAt=r?e.kmwCharAt:e.charAt,e._kmwCharCodeAt=r?e.kmwCharCodeAt:e.charCodeAt,e._kmwIndexOf=r?e.kmwIndexOf:e.indexOf,e._kmwLastIndexOf=r?e.kmwLastIndexOf:e.lastIndexOf,e._kmwSlice=r?e.kmwSlice:e.slice,e._kmwSubstring=r?e.kmwSubstring:e.substring,e._kmwSubstr=r?e.kmwSubstr:e.kmwBMPSubstr,e._kmwLength=r?e.kmwLength:e.kmwBMPLength,e._kmwNextChar=r?e.kmwNextChar:e.kmwBMPNextChar,e._kmwPrevChar=r?e.kmwPrevChar:e.kmwBMPPrevChar,e._kmwCodePointToCodeUnit=r?e.kmwCodePointToCodeUnit:e.kmwBMPCodePointToCodeUnit,e._kmwCodeUnitToCodePoint=r?e.kmwCodeUnitToCodePoint:e.kmwBMPCodeUnitToCodePoint},String._kmwFromCharCode||String.kmwEnableSupplementaryPlane(!1)}B();var H={};F(H,{DummyModel:function(){return vt},PriorityQueue:function(){return b},QuoteBehavior:function(){return U},SENTINEL_CODE_UNIT:function(){return K},TrieModel:function(){return lt},applyTransform:function(){return X},buildMergedTransform:function(){return le},defaultApplyCasing:function(){return g},getLastPreCaretToken:function(){return pe},isHighSurrogate:function(){return $},isLowSurrogate:function(){return P},isSentinel:function(){return z},tokenize:function(){return Y},transformToSuggestion:function(){return h},wordbreak:function(){return Ae}}),B();var K="\\uFDD0";function X(r,e){var t,n,i=e.left||"",a=i.kmwLength(),l=a<r.deleteLeft?a:r.deleteLeft,o=i.kmwSubstr(0,a-l)+(r.insert||""),s=e.right||"",u=s.kmwLength(),c=u<((t=r.deleteRight)!==null&&t!==void 0?t:0)?u:(n=r.deleteRight)!==null&&n!==void 0?n:0,f=s.kmwSubstr(c);return{left:o,right:f,startOfBuffer:e.startOfBuffer,endOfBuffer:e.endOfBuffer,casingForm:e.casingForm}}function le(r,e){var t=r.insert,n=e.deleteLeft;if(e.deleteLeft){var i=r.insert.kmwLength();i<=e.deleteLeft?(t="",n=e.deleteLeft-i):(t=r.insert.kmwSubstr(0,i-e.deleteLeft),n=0)}return{insert:t+e.insert,deleteLeft:r.deleteLeft+n,deleteRight:(r.deleteRight||0)+(e.deleteRight||0)}}function $(r){return typeof r=="string"&&(r=r.charCodeAt(0)),r>=55296&&r<=56319}function P(r){return typeof r=="string"&&(r=r.charCodeAt(0)),r>=56320&&r<=57343}function z(r){return r==K}function h(r,e){var t={transform:r,transformId:r.id,displayAs:r.insert};return(e===0||e)&&(t.p=e),t}function g(r,e){switch(r){case"lower":return e.toLowerCase();case"upper":return e.toUpperCase();case"initial":var t=1;return e.length>1&&$(e.charAt(0))&&P(e.charCodeAt(1))&&(t=2),e.substring(0,t).toUpperCase().concat(e.substring(t))}}var M=function(){function r(e,t){if(typeof e!="function"){this.comparator=e.comparator,this.heap=[].concat(e.heap);return}var n=e;this.comparator=n,this.heap=(t!=null?t:[]).slice(0),this.heapify()}return r.leftChildIndex=function(e){return e*2+1},r.rightChildIndex=function(e){return e*2+2},r.parentIndex=function(e){return Math.floor((e-1)/2)},r.prototype.heapify=function(e,t){if(e==null||t==null){this.heapify(0,this.count-1);return}for(var n=[],i=-1,a=t;a>=e;a--){var l=r.parentIndex(a);this.siftDown(a)&&l<e&&i!=l&&(n.push(l),i=l)}for(i=-1;n.length>0;){var o=n.shift(),l=r.parentIndex(o);this.siftDown(o)&&l>=0&&i!=l&&(n.push(l),i=l)}},Object.defineProperty(r.prototype,"count",{get:function(){return this.heap.length},enumerable:!1,configurable:!0}),r.prototype.peek=function(){return this.heap[0]},r.prototype.enqueue=function(e){var t=this.heap.length;this.heap.push(e);for(var n=r.parentIndex,i=n(t);t!==0&&this.comparator(this.heap[t],this.heap[i])<0;){var a=this.heap[t];this.heap[t]=this.heap[i],this.heap[i]=a,t=i,i=n(t)}},r.prototype.enqueueAll=function(e){if(e.length!=0){var t=this.count;this.heap=this.heap.concat(e);var n=r.parentIndex(t);this.heapify(n>=0?n:0,r.parentIndex(this.count-1))}},r.prototype.dequeue=function(){if(this.count!=0){var e=this.heap[0],t=this.heap.pop();return this.heap.length>0&&(this.heap[0]=t,this.siftDown(0)),e}},r.prototype.siftDown=function(e){var t=r.leftChildIndex(e),n=r.rightChildIndex(e),i=e;if(t<this.heap.length&&this.comparator(this.heap[t],this.heap[i])<0&&(i=t),n<this.heap.length&&this.comparator(this.heap[n],this.heap[i])<0&&(i=n),i!=e){var a=this.heap[e];return this.heap[e]=this.heap[i],this.heap[i]=a,this.siftDown(i),!0}else return!1},r.prototype.toArray=function(){return this.heap.slice(0)},r}(),b=M,j;(function(r){r.noQuotes="no-quotes",r.useQuotes="use-quotes",r.default="default-quotes"})(j||(j={})),function(r){function e(t,n,i,a){if(a==r.default||!a)throw"Specified quote behavior may be ambiguous - default behavior not specified (may not be .default)";switch(t==r.default&&(t=a),t){case r.noQuotes:return n;case r.useQuotes:var l=i.quotesForKeepSuggestion,o=l.open,s=l.close;return o+n+s;default:throw"Unsupported quote behavior state detected; implementation missing!"}}r.apply=e}(j||(j={}));var U=j;function Y(r,e){e=e||{left:void 0,startOfBuffer:void 0,endOfBuffer:void 0};var t=r(e.left||"")||[],n=r(e.right||"")||[],i;if(t.length>0&&(i=t[t.length-1]),t.length>1){var a=t[t.length-2];if(a.end==i.start&&i.text=="\'"){var l={text:a.text+i.text,start:a.start,end:i.end,length:a.length+i.length};t.pop(),t.pop(),t.push(l),i=l}}var o={left:t.map(function(f){return f.text}),right:n.map(function(f){return f.text}),caretSplitsToken:!1};if(t.length>0&&n.length>0){var s=n[0],u=i.end!=e.left.length,c=s.start!=0;if(u||c)return o;r(i.text+s.text).length==1&&(o.caretSplitsToken=!0)}return o}function pe(r,e){var t=Y(r,e);return t.left.length>0?t.left.pop():""}function Ae(r,e){return pe(r,e)}var Pe={};F(Pe,{ascii:function(){return tt},default:function(){return ce},defaultWordbreaker:function(){return ce},placeholder:function(){return et}});function et(r){var e=0;return r.split(/\\s+/).map(function(t){var n={start:e,end:e+t.length,text:t,length:t.length};return e=n.end,n})}function tt(r){for(var e=/[A-Za-z0-9\']+/g,t=[],n;(n=e.exec(r))!==null;)t.push(new rt(n[0],n.index));return t}var rt=function(){function r(e,t){this.text=e,this.start=t}return Object.defineProperty(r.prototype,"length",{get:function(){return this.text.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"end",{get:function(){return this.start+this.text.length},enumerable:!1,configurable:!0}),r}(),nt=["Other","LF","Newline","CR","WSegSpace","Double_Quote","Single_Quote","MidNum","MidNumLet","Numeric","MidLetter","ALetter","ExtendNumLet","Format","Extend","Hebrew_Letter","ZWJ","Katakana","Regional_Indicator","sot","eot"],Me=[[0,0],[10,1],[11,2],[13,3],[14,0],[32,4],[33,0],[34,5],[35,0],[39,6],[40,0],[44,7],[45,0],[46,8],[47,0],[48,9],[58,10],[59,7],[60,0],[65,11],[91,0],[95,12],[96,0],[97,11],[123,0],[133,2],[134,0],[170,11],[171,0],[173,13],[174,0],[181,11],[182,0],[183,10],[184,0],[186,11],[187,0],[192,11],[215,0],[216,11],[247,0],[248,11],[728,0],[734,11],[768,14],[880,11],[885,0],[886,11],[888,0],[890,11],[894,7],[895,11],[896,0],[902,11],[903,10],[904,11],[907,0],[908,11],[909,0],[910,11],[930,0],[931,11],[1014,0],[1015,11],[1154,0],[1155,14],[1162,11],[1328,0],[1329,11],[1367,0],[1369,11],[1373,0],[1374,11],[1375,10],[1376,11],[1417,7],[1418,11],[1419,0],[1425,14],[1470,0],[1471,14],[1472,0],[1473,14],[1475,0],[1476,14],[1478,0],[1479,14],[1480,0],[1488,15],[1515,0],[1519,15],[1523,11],[1524,10],[1525,0],[1536,13],[1542,0],[1548,7],[1550,0],[1552,14],[1563,0],[1564,13],[1565,0],[1568,11],[1611,14],[1632,9],[1642,0],[1643,9],[1644,7],[1645,0],[1646,11],[1648,14],[1649,11],[1748,0],[1749,11],[1750,14],[1757,13],[1758,0],[1759,14],[1765,11],[1767,14],[1769,0],[1770,14],[1774,11],[1776,9],[1786,11],[1789,0],[1791,11],[1792,0],[1807,13],[1808,11],[1809,14],[1810,11],[1840,14],[1867,0],[1869,11],[1958,14],[1969,11],[1970,0],[1984,9],[1994,11],[2027,14],[2036,11],[2038,0],[2040,7],[2041,0],[2042,11],[2043,0],[2045,14],[2046,0],[2048,11],[2070,14],[2074,11],[2075,14],[2084,11],[2085,14],[2088,11],[2089,14],[2094,0],[2112,11],[2137,14],[2140,0],[2144,11],[2155,0],[2208,11],[2229,0],[2230,11],[2248,0],[2259,14],[2274,13],[2275,14],[2308,11],[2362,14],[2365,11],[2366,14],[2384,11],[2385,14],[2392,11],[2402,14],[2404,0],[2406,9],[2416,0],[2417,11],[2433,14],[2436,0],[2437,11],[2445,0],[2447,11],[2449,0],[2451,11],[2473,0],[2474,11],[2481,0],[2482,11],[2483,0],[2486,11],[2490,0],[2492,14],[2493,11],[2494,14],[2501,0],[2503,14],[2505,0],[2507,14],[2510,11],[2511,0],[2519,14],[2520,0],[2524,11],[2526,0],[2527,11],[2530,14],[2532,0],[2534,9],[2544,11],[2546,0],[2556,11],[2557,0],[2558,14],[2559,0],[2561,14],[2564,0],[2565,11],[2571,0],[2575,11],[2577,0],[2579,11],[2601,0],[2602,11],[2609,0],[2610,11],[2612,0],[2613,11],[2615,0],[2616,11],[2618,0],[2620,14],[2621,0],[2622,14],[2627,0],[2631,14],[2633,0],[2635,14],[2638,0],[2641,14],[2642,0],[2649,11],[2653,0],[2654,11],[2655,0],[2662,9],[2672,14],[2674,11],[2677,14],[2678,0],[2689,14],[2692,0],[2693,11],[2702,0],[2703,11],[2706,0],[2707,11],[2729,0],[2730,11],[2737,0],[2738,11],[2740,0],[2741,11],[2746,0],[2748,14],[2749,11],[2750,14],[2758,0],[2759,14],[2762,0],[2763,14],[2766,0],[2768,11],[2769,0],[2784,11],[2786,14],[2788,0],[2790,9],[2800,0],[2809,11],[2810,14],[2816,0],[2817,14],[2820,0],[2821,11],[2829,0],[2831,11],[2833,0],[2835,11],[2857,0],[2858,11],[2865,0],[2866,11],[2868,0],[2869,11],[2874,0],[2876,14],[2877,11],[2878,14],[2885,0],[2887,14],[2889,0],[2891,14],[2894,0],[2901,14],[2904,0],[2908,11],[2910,0],[2911,11],[2914,14],[2916,0],[2918,9],[2928,0],[2929,11],[2930,0],[2946,14],[2947,11],[2948,0],[2949,11],[2955,0],[2958,11],[2961,0],[2962,11],[2966,0],[2969,11],[2971,0],[2972,11],[2973,0],[2974,11],[2976,0],[2979,11],[2981,0],[2984,11],[2987,0],[2990,11],[3002,0],[3006,14],[3011,0],[3014,14],[3017,0],[3018,14],[3022,0],[3024,11],[3025,0],[3031,14],[3032,0],[3046,9],[3056,0],[3072,14],[3077,11],[3085,0],[3086,11],[3089,0],[3090,11],[3113,0],[3114,11],[3130,0],[3133,11],[3134,14],[3141,0],[3142,14],[3145,0],[3146,14],[3150,0],[3157,14],[3159,0],[3160,11],[3163,0],[3168,11],[3170,14],[3172,0],[3174,9],[3184,0],[3200,11],[3201,14],[3204,0],[3205,11],[3213,0],[3214,11],[3217,0],[3218,11],[3241,0],[3242,11],[3252,0],[3253,11],[3258,0],[3260,14],[3261,11],[3262,14],[3269,0],[3270,14],[3273,0],[3274,14],[3278,0],[3285,14],[3287,0],[3294,11],[3295,0],[3296,11],[3298,14],[3300,0],[3302,9],[3312,0],[3313,11],[3315,0],[3328,14],[3332,11],[3341,0],[3342,11],[3345,0],[3346,11],[3387,14],[3389,11],[3390,14],[3397,0],[3398,14],[3401,0],[3402,14],[3406,11],[3407,0],[3412,11],[3415,14],[3416,0],[3423,11],[3426,14],[3428,0],[3430,9],[3440,0],[3450,11],[3456,0],[3457,14],[3460,0],[3461,11],[3479,0],[3482,11],[3506,0],[3507,11],[3516,0],[3517,11],[3518,0],[3520,11],[3527,0],[3530,14],[3531,0],[3535,14],[3541,0],[3542,14],[3543,0],[3544,14],[3552,0],[3558,9],[3568,0],[3570,14],[3572,0],[3633,14],[3634,0],[3636,14],[3643,0],[3655,14],[3663,0],[3664,9],[3674,0],[3761,14],[3762,0],[3764,14],[3773,0],[3784,14],[3790,0],[3792,9],[3802,0],[3840,11],[3841,0],[3864,14],[3866,0],[3872,9],[3882,0],[3893,14],[3894,0],[3895,14],[3896,0],[3897,14],[3898,0],[3902,14],[3904,11],[3912,0],[3913,11],[3949,0],[3953,14],[3973,0],[3974,14],[3976,11],[3981,14],[3992,0],[3993,14],[4029,0],[4038,14],[4039,0],[4139,14],[4159,0],[4160,9],[4170,0],[4182,14],[4186,0],[4190,14],[4193,0],[4194,14],[4197,0],[4199,14],[4206,0],[4209,14],[4213,0],[4226,14],[4238,0],[4239,14],[4240,9],[4250,14],[4254,0],[4256,11],[4294,0],[4295,11],[4296,0],[4301,11],[4302,0],[4304,11],[4347,0],[4348,11],[4681,0],[4682,11],[4686,0],[4688,11],[4695,0],[4696,11],[4697,0],[4698,11],[4702,0],[4704,11],[4745,0],[4746,11],[4750,0],[4752,11],[4785,0],[4786,11],[4790,0],[4792,11],[4799,0],[4800,11],[4801,0],[4802,11],[4806,0],[4808,11],[4823,0],[4824,11],[4881,0],[4882,11],[4886,0],[4888,11],[4955,0],[4957,14],[4960,0],[4992,11],[5008,0],[5024,11],[5110,0],[5112,11],[5118,0],[5121,11],[5741,0],[5743,11],[5760,4],[5761,11],[5787,0],[5792,11],[5867,0],[5870,11],[5881,0],[5888,11],[5901,0],[5902,11],[5906,14],[5909,0],[5920,11],[5938,14],[5941,0],[5952,11],[5970,14],[5972,0],[5984,11],[5997,0],[5998,11],[6001,0],[6002,14],[6004,0],[6068,14],[6100,0],[6109,14],[6110,0],[6112,9],[6122,0],[6155,14],[6158,13],[6159,0],[6160,9],[6170,0],[6176,11],[6265,0],[6272,11],[6277,14],[6279,11],[6313,14],[6314,11],[6315,0],[6320,11],[6390,0],[6400,11],[6431,0],[6432,14],[6444,0],[6448,14],[6460,0],[6470,9],[6480,0],[6608,9],[6618,0],[6656,11],[6679,14],[6684,0],[6741,14],[6751,0],[6752,14],[6781,0],[6783,14],[6784,9],[6794,0],[6800,9],[6810,0],[6832,14],[6849,0],[6912,14],[6917,11],[6964,14],[6981,11],[6988,0],[6992,9],[7002,0],[7019,14],[7028,0],[7040,14],[7043,11],[7073,14],[7086,11],[7088,9],[7098,11],[7142,14],[7156,0],[7168,11],[7204,14],[7224,0],[7232,9],[7242,0],[7245,11],[7248,9],[7258,11],[7294,0],[7296,11],[7305,0],[7312,11],[7355,0],[7357,11],[7360,0],[7376,14],[7379,0],[7380,14],[7401,11],[7405,14],[7406,11],[7412,14],[7413,11],[7415,14],[7418,11],[7419,0],[7424,11],[7616,14],[7674,0],[7675,14],[7680,11],[7958,0],[7960,11],[7966,0],[7968,11],[8006,0],[8008,11],[8014,0],[8016,11],[8024,0],[8025,11],[8026,0],[8027,11],[8028,0],[8029,11],[8030,0],[8031,11],[8062,0],[8064,11],[8117,0],[8118,11],[8125,0],[8126,11],[8127,0],[8130,11],[8133,0],[8134,11],[8141,0],[8144,11],[8148,0],[8150,11],[8156,0],[8160,11],[8173,0],[8178,11],[8181,0],[8182,11],[8189,0],[8192,4],[8199,0],[8200,4],[8203,0],[8204,14],[8205,16],[8206,13],[8208,0],[8216,8],[8218,0],[8228,8],[8229,0],[8231,10],[8232,2],[8234,13],[8239,12],[8240,0],[8255,12],[8257,0],[8260,7],[8261,0],[8276,12],[8277,0],[8287,4],[8288,13],[8293,0],[8294,13],[8304,0],[8305,11],[8306,0],[8319,11],[8320,0],[8336,11],[8349,0],[8400,14],[8433,0],[8450,11],[8451,0],[8455,11],[8456,0],[8458,11],[8468,0],[8469,11],[8470,0],[8473,11],[8478,0],[8484,11],[8485,0],[8486,11],[8487,0],[8488,11],[8489,0],[8490,11],[8494,0],[8495,11],[8506,0],[8508,11],[8512,0],[8517,11],[8522,0],[8526,11],[8527,0],[8544,11],[8585,0],[9398,11],[9450,0],[11264,11],[11311,0],[11312,11],[11359,0],[11360,11],[11493,0],[11499,11],[11503,14],[11506,11],[11508,0],[11520,11],[11558,0],[11559,11],[11560,0],[11565,11],[11566,0],[11568,11],[11624,0],[11631,11],[11632,0],[11647,14],[11648,11],[11671,0],[11680,11],[11687,0],[11688,11],[11695,0],[11696,11],[11703,0],[11704,11],[11711,0],[11712,11],[11719,0],[11720,11],[11727,0],[11728,11],[11735,0],[11736,11],[11743,0],[11744,14],[11776,0],[11823,11],[11824,0],[12288,4],[12289,0],[12293,11],[12294,0],[12330,14],[12336,0],[12337,17],[12342,0],[12347,11],[12349,0],[12441,14],[12443,17],[12445,0],[12448,17],[12539,0],[12540,17],[12544,0],[12549,11],[12592,0],[12593,11],[12687,0],[12704,11],[12736,0],[12784,17],[12800,0],[13008,17],[13055,0],[13056,17],[13144,0],[40960,11],[42125,0],[42192,11],[42238,0],[42240,11],[42509,0],[42512,11],[42528,9],[42538,11],[42540,0],[42560,11],[42607,14],[42611,0],[42612,14],[42622,0],[42623,11],[42654,14],[42656,11],[42736,14],[42738,0],[42760,11],[42944,0],[42946,11],[42955,0],[42997,11],[43010,14],[43011,11],[43014,14],[43015,11],[43019,14],[43020,11],[43043,14],[43048,0],[43052,14],[43053,0],[43072,11],[43124,0],[43136,14],[43138,11],[43188,14],[43206,0],[43216,9],[43226,0],[43232,14],[43250,11],[43256,0],[43259,11],[43260,0],[43261,11],[43263,14],[43264,9],[43274,11],[43302,14],[43310,0],[43312,11],[43335,14],[43348,0],[43360,11],[43389,0],[43392,14],[43396,11],[43443,14],[43457,0],[43471,11],[43472,9],[43482,0],[43493,14],[43494,0],[43504,9],[43514,0],[43520,11],[43561,14],[43575,0],[43584,11],[43587,14],[43588,11],[43596,14],[43598,0],[43600,9],[43610,0],[43643,14],[43646,0],[43696,14],[43697,0],[43698,14],[43701,0],[43703,14],[43705,0],[43710,14],[43712,0],[43713,14],[43714,0],[43744,11],[43755,14],[43760,0],[43762,11],[43765,14],[43767,0],[43777,11],[43783,0],[43785,11],[43791,0],[43793,11],[43799,0],[43808,11],[43815,0],[43816,11],[43823,0],[43824,11],[43882,0],[43888,11],[44003,14],[44011,0],[44012,14],[44014,0],[44016,9],[44026,0],[44032,11],[55204,0],[55216,11],[55239,0],[55243,11],[55292,0],[64256,11],[64263,0],[64275,11],[64280,0],[64285,15],[64286,14],[64287,15],[64297,0],[64298,15],[64311,0],[64312,15],[64317,0],[64318,15],[64319,0],[64320,15],[64322,0],[64323,15],[64325,0],[64326,15],[64336,11],[64434,0],[64467,11],[64830,0],[64848,11],[64912,0],[64914,11],[64968,0],[65008,11],[65020,0],[65024,14],[65040,7],[65041,0],[65043,10],[65044,7],[65045,0],[65056,14],[65072,0],[65075,12],[65077,0],[65101,12],[65104,7],[65105,0],[65106,8],[65107,0],[65108,7],[65109,10],[65110,0],[65136,11],[65141,0],[65142,11],[65277,0],[65279,13],[65280,0],[65287,8],[65288,0],[65292,7],[65293,0],[65294,8],[65295,0],[65296,9],[65306,10],[65307,7],[65308,0],[65313,11],[65339,0],[65343,12],[65344,0],[65345,11],[65371,0],[65382,17],[65438,14],[65440,11],[65471,0],[65474,11],[65480,0],[65482,11],[65488,0],[65490,11],[65496,0],[65498,11],[65501,0],[65529,13],[65532,0],[65536,11],[65548,0],[65549,11],[65575,0],[65576,11],[65595,0],[65596,11],[65598,0],[65599,11],[65614,0],[65616,11],[65630,0],[65664,11],[65787,0],[65856,11],[65909,0],[66045,14],[66046,0],[66176,11],[66205,0],[66208,11],[66257,0],[66272,14],[66273,0],[66304,11],[66336,0],[66349,11],[66379,0],[66384,11],[66422,14],[66427,0],[66432,11],[66462,0],[66464,11],[66500,0],[66504,11],[66512,0],[66513,11],[66518,0],[66560,11],[66718,0],[66720,9],[66730,0],[66736,11],[66772,0],[66776,11],[66812,0],[66816,11],[66856,0],[66864,11],[66916,0],[67072,11],[67383,0],[67392,11],[67414,0],[67424,11],[67432,0],[67584,11],[67590,0],[67592,11],[67593,0],[67594,11],[67638,0],[67639,11],[67641,0],[67644,11],[67645,0],[67647,11],[67670,0],[67680,11],[67703,0],[67712,11],[67743,0],[67808,11],[67827,0],[67828,11],[67830,0],[67840,11],[67862,0],[67872,11],[67898,0],[67968,11],[68024,0],[68030,11],[68032,0],[68096,11],[68097,14],[68100,0],[68101,14],[68103,0],[68108,14],[68112,11],[68116,0],[68117,11],[68120,0],[68121,11],[68150,0],[68152,14],[68155,0],[68159,14],[68160,0],[68192,11],[68221,0],[68224,11],[68253,0],[68288,11],[68296,0],[68297,11],[68325,14],[68327,0],[68352,11],[68406,0],[68416,11],[68438,0],[68448,11],[68467,0],[68480,11],[68498,0],[68608,11],[68681,0],[68736,11],[68787,0],[68800,11],[68851,0],[68864,11],[68900,14],[68904,0],[68912,9],[68922,0],[69248,11],[69290,0],[69291,14],[69293,0],[69296,11],[69298,0],[69376,11],[69405,0],[69415,11],[69416,0],[69424,11],[69446,14],[69457,0],[69552,11],[69573,0],[69600,11],[69623,0],[69632,14],[69635,11],[69688,14],[69703,0],[69734,9],[69744,0],[69759,14],[69763,11],[69808,14],[69819,0],[69821,13],[69822,0],[69837,13],[69838,0],[69840,11],[69865,0],[69872,9],[69882,0],[69888,14],[69891,11],[69927,14],[69941,0],[69942,9],[69952,0],[69956,11],[69957,14],[69959,11],[69960,0],[69968,11],[70003,14],[70004,0],[70006,11],[70007,0],[70016,14],[70019,11],[70067,14],[70081,11],[70085,0],[70089,14],[70093,0],[70094,14],[70096,9],[70106,11],[70107,0],[70108,11],[70109,0],[70144,11],[70162,0],[70163,11],[70188,14],[70200,0],[70206,14],[70207,0],[70272,11],[70279,0],[70280,11],[70281,0],[70282,11],[70286,0],[70287,11],[70302,0],[70303,11],[70313,0],[70320,11],[70367,14],[70379,0],[70384,9],[70394,0],[70400,14],[70404,0],[70405,11],[70413,0],[70415,11],[70417,0],[70419,11],[70441,0],[70442,11],[70449,0],[70450,11],[70452,0],[70453,11],[70458,0],[70459,14],[70461,11],[70462,14],[70469,0],[70471,14],[70473,0],[70475,14],[70478,0],[70480,11],[70481,0],[70487,14],[70488,0],[70493,11],[70498,14],[70500,0],[70502,14],[70509,0],[70512,14],[70517,0],[70656,11],[70709,14],[70727,11],[70731,0],[70736,9],[70746,0],[70750,14],[70751,11],[70754,0],[70784,11],[70832,14],[70852,11],[70854,0],[70855,11],[70856,0],[70864,9],[70874,0],[71040,11],[71087,14],[71094,0],[71096,14],[71105,0],[71128,11],[71132,14],[71134,0],[71168,11],[71216,14],[71233,0],[71236,11],[71237,0],[71248,9],[71258,0],[71296,11],[71339,14],[71352,11],[71353,0],[71360,9],[71370,0],[71453,14],[71468,0],[71472,9],[71482,0],[71680,11],[71724,14],[71739,0],[71840,11],[71904,9],[71914,0],[71935,11],[71943,0],[71945,11],[71946,0],[71948,11],[71956,0],[71957,11],[71959,0],[71960,11],[71984,14],[71990,0],[71991,14],[71993,0],[71995,14],[71999,11],[72e3,14],[72001,11],[72002,14],[72004,0],[72016,9],[72026,0],[72096,11],[72104,0],[72106,11],[72145,14],[72152,0],[72154,14],[72161,11],[72162,0],[72163,11],[72164,14],[72165,0],[72192,11],[72193,14],[72203,11],[72243,14],[72250,11],[72251,14],[72255,0],[72263,14],[72264,0],[72272,11],[72273,14],[72284,11],[72330,14],[72346,0],[72349,11],[72350,0],[72384,11],[72441,0],[72704,11],[72713,0],[72714,11],[72751,14],[72759,0],[72760,14],[72768,11],[72769,0],[72784,9],[72794,0],[72818,11],[72848,0],[72850,14],[72872,0],[72873,14],[72887,0],[72960,11],[72967,0],[72968,11],[72970,0],[72971,11],[73009,14],[73015,0],[73018,14],[73019,0],[73020,14],[73022,0],[73023,14],[73030,11],[73031,14],[73032,0],[73040,9],[73050,0],[73056,11],[73062,0],[73063,11],[73065,0],[73066,11],[73098,14],[73103,0],[73104,14],[73106,0],[73107,14],[73112,11],[73113,0],[73120,9],[73130,0],[73440,11],[73459,14],[73463,0],[73648,11],[73649,0],[73728,11],[74650,0],[74752,11],[74863,0],[74880,11],[75076,0],[77824,11],[78895,0],[78896,13],[78905,0],[82944,11],[83527,0],[92160,11],[92729,0],[92736,11],[92767,0],[92768,9],[92778,0],[92880,11],[92910,0],[92912,14],[92917,0],[92928,11],[92976,14],[92983,0],[92992,11],[92996,0],[93008,9],[93018,0],[93027,11],[93048,0],[93053,11],[93072,0],[93760,11],[93824,0],[93952,11],[94027,0],[94031,14],[94032,11],[94033,14],[94088,0],[94095,14],[94099,11],[94112,0],[94176,11],[94178,0],[94179,11],[94180,14],[94181,0],[94192,14],[94194,0],[110592,17],[110593,0],[110948,17],[110952,0],[113664,11],[113771,0],[113776,11],[113789,0],[113792,11],[113801,0],[113808,11],[113818,0],[113821,14],[113823,0],[113824,13],[113828,0],[119141,14],[119146,0],[119149,14],[119155,13],[119163,14],[119171,0],[119173,14],[119180,0],[119210,14],[119214,0],[119362,14],[119365,0],[119808,11],[119893,0],[119894,11],[119965,0],[119966,11],[119968,0],[119970,11],[119971,0],[119973,11],[119975,0],[119977,11],[119981,0],[119982,11],[119994,0],[119995,11],[119996,0],[119997,11],[120004,0],[120005,11],[120070,0],[120071,11],[120075,0],[120077,11],[120085,0],[120086,11],[120093,0],[120094,11],[120122,0],[120123,11],[120127,0],[120128,11],[120133,0],[120134,11],[120135,0],[120138,11],[120145,0],[120146,11],[120486,0],[120488,11],[120513,0],[120514,11],[120539,0],[120540,11],[120571,0],[120572,11],[120597,0],[120598,11],[120629,0],[120630,11],[120655,0],[120656,11],[120687,0],[120688,11],[120713,0],[120714,11],[120745,0],[120746,11],[120771,0],[120772,11],[120780,0],[120782,9],[120832,0],[121344,14],[121399,0],[121403,14],[121453,0],[121461,14],[121462,0],[121476,14],[121477,0],[121499,14],[121504,0],[121505,14],[121520,0],[122880,14],[122887,0],[122888,14],[122905,0],[122907,14],[122914,0],[122915,14],[122917,0],[122918,14],[122923,0],[123136,11],[123181,0],[123184,14],[123191,11],[123198,0],[123200,9],[123210,0],[123214,11],[123215,0],[123584,11],[123628,14],[123632,9],[123642,0],[124928,11],[125125,0],[125136,14],[125143,0],[125184,11],[125252,14],[125259,11],[125260,0],[125264,9],[125274,0],[126464,11],[126468,0],[126469,11],[126496,0],[126497,11],[126499,0],[126500,11],[126501,0],[126503,11],[126504,0],[126505,11],[126515,0],[126516,11],[126520,0],[126521,11],[126522,0],[126523,11],[126524,0],[126530,11],[126531,0],[126535,11],[126536,0],[126537,11],[126538,0],[126539,11],[126540,0],[126541,11],[126544,0],[126545,11],[126547,0],[126548,11],[126549,0],[126551,11],[126552,0],[126553,11],[126554,0],[126555,11],[126556,0],[126557,11],[126558,0],[126559,11],[126560,0],[126561,11],[126563,0],[126564,11],[126565,0],[126567,11],[126571,0],[126572,11],[126579,0],[126580,11],[126584,0],[126585,11],[126589,0],[126590,11],[126591,0],[126592,11],[126602,0],[126603,11],[126620,0],[126625,11],[126628,0],[126629,11],[126634,0],[126635,11],[126652,0],[127280,11],[127306,0],[127312,11],[127338,0],[127344,11],[127370,0],[127462,18],[127488,0],[127995,14],[128e3,0],[130032,9],[130042,0],[917505,13],[917506,0],[917536,14],[917632,0],[917760,14],[918e3,0]];function ce(r,e){var t=ot(r,e);if(t.length==0)return[];for(var n=[],i=0;i<t.length-1;i++){var a=t[i],l=t[i+1],o=new Ue(r,a,l);at(o.text,e)?n.push(o):i==t.length-2&&(o=new Ue(r,l,l),n.push(o))}return n}var Ue=function(){function r(e,t,n){this._source=e,this.start=t,this.end=n}return Object.defineProperty(r.prototype,"text",{get:function(){return this._source.substring(this.start,this.end)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"length",{get:function(){return this.end-this.start},enumerable:!1,configurable:!0}),r}(),it=function(){function r(e,t,n,i,a,l){this.lookbehind=19,this.left=19,this.right=19,this.text=e,this.options=t,arguments.length==3?this.lookahead=this.wordbreakPropertyAt(n):(this.lookbehind=n,this.left=i,this.right=a,this.lookahead=l)}return r.prototype.next=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.left,this.right,this.lookahead,t)},r.prototype.ignoringRight=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.lookbehind,this.left,this.lookahead,t)},r.prototype.ignoringLookahead=function(e){var t=this.wordbreakPropertyAt(e);return new r(this.text,this.options,this.lookbehind,this.left,this.right,t)},r.prototype.wordbreakPropertyAt=function(e){return e<0?19:e>=this.text.length?20:We(this.text[e])?Ee(this.text[e]+this.text[e+1]):Ee(this.text[e],this.options)},r.prototype.match=function(e,t,n,i){var a,l,o,s,u=(a=e==null?void 0:e.includes(this.lookbehind))!==null&&a!==void 0?a:!0;return u=u&&((l=t==null?void 0:t.includes(this.left))!==null&&l!==void 0?l:!0),u=u&&((o=n==null?void 0:n.includes(this.right))!==null&&o!==void 0?o:!0),u&&((s=i==null?void 0:i.includes(this.lookahead))!==null&&s!==void 0?s:!0)},r.prototype.propertyMatch=function(e,t,n,i){var a=this,l=function(o){return Qe(o,a.options)};return this.match(e==null?void 0:e.map(l),t==null?void 0:t.map(l),n==null?void 0:n.map(l),i==null?void 0:i.map(l))},r}();function at(r,e){return!Array.from(r).map(function(t){return Ee(t,e)}).every(function(t){return t===3||t===1||t===2||t===4})}function ot(r,e){var t,n,i;if(r.length===0)return[];e&&!e.rules&&(e.rules=[]);var a=[],l,o=0,s=new it(r,e,o),u=0;do{if(l=o,o=_(o),s=s.next(o),s.match(null,[19],null,null)){a.push(l);continue}if(s.match(null,null,[20],null)){a.push(l);break}if(!s.match(null,[3],[1],null)){var c=[2,3,1];if(s.match(null,c,null,null)){a.push(l);continue}if(s.match(null,null,c,null)){a.push(l);continue}if(!s.match(null,[4],[4],null)){for(var f=[13,14,16];s.match(null,null,f,null);)t=(0,x.__read)([o,_(o)],2),l=t[0],o=t[1],s=s.ignoringRight(o);if(s.right===20){a.push(l);break}for(;s.match(null,null,null,f);)o=_(o),s=s.ignoringLookahead(o);var v=[11,15],p=[8,6];if(e!=null&&e.rules){var d=!1;try{for(var m=(n=void 0,(0,x.__values)(e.rules)),C=m.next();!C.done;C=m.next()){var T=C.value;if(d=T.match(s),d){T.breakIfMatch&&a.push(l);break}}}catch(E){n={error:E}}finally{try{C&&!C.done&&(i=m.return)&&i.call(m)}finally{if(n)throw n.error}}if(d)continue}if(!s.match(null,v,v,null)){var y=[10].concat(p);if(!s.match(null,v,y,v)&&!s.match(v,y,v,null)&&!s.match(null,[15],[6],null)&&!s.match(null,[15],[5],[15])&&!s.match([15],[5],[15],null)&&!s.match(null,[9],[9],null)&&!s.match(null,v,[9],null)&&!s.match(null,[9],v,null)){var S=[7].concat(p);if(!s.match([9],S,[9],null)&&!s.match(null,[9],S,[9])&&!s.match(null,[17],[17],null)){var w=[17,9].concat(v);if(!s.match(null,w,[12],null)&&!s.match(null,[12],[12],null)&&!s.match(null,[12],w,null)){if(s.right===18){if(u+=1,u%2==1)continue}else u=0;a.push(l)}}}}}}}while(l<r.length);return a;function _(E){return E>=r.length?r.length:We(r[E])?E+2:E+1}}function We(r){var e=r.charCodeAt(0);return e>=55296&&e<=56319}function Ee(r,e){if(e!=null&&e.propertyMapping){var t=e.propertyMapping(r);if(t)return Qe(t,e)}var n=r.codePointAt(0);return Ie(n,0,Me.length-1)}function Qe(r,e){var t,n,i=function(l){return l.toLowerCase()==r.toLowerCase()},a=(n=(t=e==null?void 0:e.customProperties)===null||t===void 0?void 0:t.findIndex(i))!==null&&n!==void 0?n:-1;return a!=-1?-a-1:nt.findIndex(i)}function Ie(r,e,t){if(t<e)return 0;var n=e+~~((t-e)/2),i=Me[n],a=Me[n+1],l=a?a[0]:1/0;return r<i[0]?Ie(r,e,n-1):r>=l?Ie(r,n+1,t):i[1]}B();var Be=12,ut=function(){function r(e,t){this.root=e,this.prefix=t}return r.prototype.children=function(){var e,t,n,i,a,l,o,s,u,c,f,v,p,d,m,C,T,y;return(0,x.__generator)(this,function(S){switch(S.label){case 0:if(e=this.root,e.type!="internal")return[3,9];t=function(w){var _,E,Q,ne,Z,ke,_e,ie,xe,ae,V,ve;return(0,x.__generator)(this,function(W){switch(W.label){case 0:if(_=e.children[w],!$(w))return[3,12];if(_.type!="internal")return[3,9];E=_,Q=function(oe){var ue;return(0,x.__generator)(this,function(se){switch(se.label){case 0:return ue=n.prefix+w+oe,[4,{char:w+oe,traversal:function(){return new r(E.children[oe],ue)}}];case 1:return se.sent(),[2]}})},W.label=1;case 1:W.trys.push([1,6,7,8]),ne=(V=void 0,(0,x.__values)(E.values)),Z=ne.next(),W.label=2;case 2:return Z.done?[3,5]:(ke=Z.value,[5,Q(ke)]);case 3:W.sent(),W.label=4;case 4:return Z=ne.next(),[3,2];case 5:return[3,8];case 6:return _e=W.sent(),V={error:_e},[3,8];case 7:try{Z&&!Z.done&&(ve=ne.return)&&ve.call(ne)}finally{if(V)throw V.error}return[7];case 8:return[3,11];case 9:return ie=_.entries[0].key,w=w+ie[n.prefix.length+1],xe=n.prefix+w,[4,{char:w,traversal:function(){return new r(_,xe)}}];case 10:W.sent(),W.label=11;case 11:return[3,16];case 12:return z(w)?[2,"continue"]:[3,13];case 13:return w?[3,14]:[2,"continue"];case 14:return ae=n.prefix+w,[4,{char:w,traversal:function(){return new r(_,ae)}}];case 15:W.sent(),W.label=16;case 16:return[2]}})},n=this,S.label=1;case 1:S.trys.push([1,6,7,8]),i=(0,x.__values)(e.values),a=i.next(),S.label=2;case 2:return a.done?[3,5]:(l=a.value,[5,t(l)]);case 3:S.sent(),S.label=4;case 4:return a=i.next(),[3,2];case 5:return[3,8];case 6:return o=S.sent(),m={error:o},[3,8];case 7:try{a&&!a.done&&(C=i.return)&&C.call(i)}finally{if(m)throw m.error}return[7];case 8:return[2];case 9:s=this.prefix,u=e.entries.filter(function(w){return w.key!=s&&s.length<w.key.length}),c=function(w){var _;return(0,x.__generator)(this,function(E){switch(E.label){case 0:return _=w[s.length],$(_)&&(_=_+w[s.length+1]),[4,{char:_,traversal:function(){return new r(e,s+_)}}];case 1:return E.sent(),[2]}})},S.label=10;case 10:S.trys.push([10,15,16,17]),f=(0,x.__values)(u),v=f.next(),S.label=11;case 11:return v.done?[3,14]:(p=v.value.key,[5,c(p)]);case 12:S.sent(),S.label=13;case 13:return v=f.next(),[3,11];case 14:return[3,17];case 15:return d=S.sent(),T={error:d},[3,17];case 16:try{v&&!v.done&&(y=f.return)&&y.call(f)}finally{if(T)throw T.error}return[7];case 17:return[2]}})},Object.defineProperty(r.prototype,"entries",{get:function(){if(this.root.type=="leaf"){var e=this.prefix,t=this.root.entries.filter(function(i){return i.key==e});return t.map(function(i){return i.content})}else{var n=this.root.children[K];return n&&n.type=="leaf"?n.entries.map(function(i){return i.content}):[]}},enumerable:!1,configurable:!0}),r}(),st=function(){function r(e,t){t===void 0&&(t={}),this.languageUsesCasing=t.languageUsesCasing,this.applyCasing=t.applyCasing,this._trie=new ct(e.root,e.totalWeight,t.searchTermToKey||ht),this.breakWords=t.wordBreaker||ce,this.punctuation=t.punctuation}return r.prototype.configure=function(e){var t;return this.configuration={leftContextCodePoints:e.maxLeftContextCodePoints,rightContextCodePoints:(t=e.maxRightContextCodePoints)!==null&&t!==void 0?t:0}},r.prototype.toKey=function(e){return this._trie.toKey(e)},r.prototype.predict=function(e,t){if(!e.insert&&!t.left&&!t.right&&t.startOfBuffer&&t.endOfBuffer)return l(this._trie.firstN(Be).map(function(o){var s=o.text,u=o.p;return{transform:{insert:s,deleteLeft:0},displayAs:s,p:u}}));var n=X(e,t),i=e.deleteLeft-e.insert.kmwLength(),a=pe(this.breakWords,n);return l(this._trie.lookup(a).map(function(o){var s=o.text,u=o.p;return h({insert:s,deleteLeft:i+a.kmwLength()},u)}));function l(o){var s,u,c=[];try{for(var f=(0,x.__values)(o),v=f.next();!v.done;v=f.next()){var p=v.value;c.push({sample:p,p:p.p})}}catch(d){s={error:d}}finally{try{v&&!v.done&&(u=f.return)&&u.call(f)}finally{if(s)throw s.error}}return c}},Object.defineProperty(r.prototype,"wordbreaker",{get:function(){return this.breakWords},enumerable:!1,configurable:!0}),r.prototype.traverseFromRoot=function(){return new ut(this._trie.root,"")},r}(),lt=st,ct=function(){function r(e,t,n){this.root=e,this.toKey=n,this.totalWeight=t}return r.prototype.lookup=function(e){var t=this.toKey(e),n=Ke(this.root,t);return n===null?[]:Ve(n,t,this.totalWeight)},r.prototype.firstN=function(e){return Ve(this.root,"",this.totalWeight,e)},r}();function Ke(r,e,t){if(t===void 0&&(t=0),r.type==="leaf"||t===e.length)return r;var n=e[t];return r.children[n]?Ke(r.children[n],e,t+1):null}function Ve(r,e,t,n){var i,a;n===void 0&&(n=Be);var l=new b(function(C,T){return(T?T.weight:0)-(C?C.weight:0)}),o=[];if(r.type==="leaf")try{for(var s=(0,x.__values)(r.entries),u=s.next();!u.done;u=s.next()){var c=u.value;if(c.key.indexOf(e)==0){var f=c.content,v=c.weight;if(o.push({text:f,p:v/t}),o.length>=n)return o}}}catch(C){i={error:C}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(i)throw i.error}}else{l.enqueue(r);for(var p=void 0,d=function(){if(ft(p))if(p.type==="leaf")l.enqueueAll(p.entries);else{var C=p;l.enqueueAll(p.values.map(function(T){return C.children[T]}))}else if(o.push({text:p.content,p:p.weight/t}),o.length>=n)return{value:o}};p=l.dequeue();){var m=d();if(typeof m=="object")return m.value}}return o}function ft(r){return"type"in r}function ht(r){return r.normalize("NFD").replace(/[\\u0300-\\u036f]/g,"").toLowerCase()}var pt=function(){function r(e){e=e||{},this._futureSuggestions=e.futureSuggestions?e.futureSuggestions.slice():[],e.punctuation&&(this.punctuation=e.punctuation)}return r.prototype.configure=function(e){return this.configuration={leftContextCodePoints:e.maxLeftContextCodePoints,rightContextCodePoints:e.maxRightContextCodePoints},this.configuration},r.prototype.predict=function(e,t,n){var i=function(l){var o,s,u=[];try{for(var c=(0,x.__values)(l),f=c.next();!f.done;f=c.next()){var v=f.value;u.push({sample:v,p:1})}}catch(p){o={error:p}}finally{try{f&&!f.done&&(s=c.return)&&s.call(c)}finally{if(o)throw o.error}}return u};if(n)return i(n);var a=this._futureSuggestions.shift();return a?i(a):[]},r}(),vt=pt,qe={};F(qe,{ClassicalDistanceCalculation:function(){return Ne},ContextTracker:function(){return ze},QUEUE_NODE_COMPARATOR:function(){return Ce},SearchNode:function(){return Ge},SearchResult:function(){return He},SearchSpace:function(){return ee},TrackedContextState:function(){return be},TrackedContextSuggestion:function(){return gt},TrackedContextToken:function(){return re}});var Ne=function(){function r(e){if(this.diagonalWidth=2,this.inputSequence=[],this.matchSequence=[],e){var t=e.resolvedDistances.length;this.resolvedDistances=Array(t);for(var n=0;n<t;n++)this.resolvedDistances[n]=e.resolvedDistances[n].slice(0);this.inputSequence=e.inputSequence.slice(0),this.matchSequence=e.matchSequence.slice(0),this.diagonalWidth=e.diagonalWidth}else this.resolvedDistances=[]}return r.prototype.getTrueIndex=function(e,t,n){var i={row:e,col:t-e+n,sparse:!1};return(i.col<0||i.col>2*n)&&(i.sparse=!0),i},r.prototype.getCostAt=function(e,t,n){if(n===void 0&&(n=this.diagonalWidth),e<0||t<0)return e==-1&&t>=-1?t+1:t==-1&&e>=-1?e+1:Number.MAX_VALUE;var i=this.getTrueIndex(e,t,n);return i.sparse?Number.MAX_VALUE:this.resolvedDistances[i.row][i.col]},r.prototype.getFinalCost=function(){for(var e=this,t=e.getHeuristicFinalCost();t>e.diagonalWidth;)e=e.increaseMaxDistance(),t=e.getHeuristicFinalCost();return t},r.prototype.getHeuristicFinalCost=function(){return this.getCostAt(this.inputSequence.length-1,this.matchSequence.length-1)},r.prototype.hasFinalCostWithin=function(e){var t=this,n=t.getHeuristicFinalCost(),i=this.diagonalWidth;do{if(n<=e)return!0;if(i<e)t=t.increaseMaxDistance(),i++,n=t.getHeuristicFinalCost();else break}while(!0);return!1},r.prototype.editPath=function(e,t){e===void 0&&(e=this.inputSequence.length-1),t===void 0&&(t=this.matchSequence.length-1);var n=this.getCostAt(e,t),i=null,a=null,l=this.getCostAt(e,t-1),o=this.getCostAt(e-1,t),s=this.getCostAt(e-1,t-1),u=(0,x.__read)(r.getTransposeParent(this,e,t),2),c=u[0],f=u[1];if(c>=0&&f>=0){var v=1;if(i=["transpose-start"],c!=e-1){var p=e-c-1;i=i.concat(Array(p).fill("transpose-delete")),v+=p}else{var p=t-f-1;i=i.concat(Array(p).fill("transpose-insert")),v+=p}i.push("transpose-end"),this.getCostAt(c-1,f-1)!=n-v&&(i=null),a=[c-1,f-1]}return i||(s==n-1?(i=["substitute"],a=[e-1,t-1]):l==n-1?(i=["insert"],a=[e,t-1]):o==n-1?(i=["delete"],a=[e-1,t]):(i=["match"],a=[e-1,t-1])),a[0]>=0&&a[1]>=0?this.editPath(a[0],a[1]).concat(i):a[0]>-1?Array(a[0]+1).fill("delete").concat(i):a[1]>-1?Array(a[1]+1).fill("insert").concat(i):i},r.getTransposeParent=function(e,t,n){if(t<0||n<0||e.inputSequence[t].key==e.matchSequence[n].key)return[-1,-1];for(var i=-1,a=t-1;a>=0;a--)if(e.inputSequence[a].key==e.matchSequence[n].key){i=a;break}for(var l=-1,a=n-1;a>=0;a--)if(e.matchSequence[a].key==e.inputSequence[t].key){l=a;break}return[i,l]},r.initialCostAt=function(e,t,n,i,a){var l=e.inputSequence[t].key==e.matchSequence[n].key?0:1,o=e.getCostAt(t-1,n-1)+l,s=i||e.getCostAt(t,n-1)+1,u=a||e.getCostAt(t-1,n)+1,c=Number.MAX_VALUE;if(t>0&&n>0){var f=(0,x.__read)(r.getTransposeParent(e,t,n),2),v=f[0],p=f[1];c=e.getCostAt(v-1,p-1)+(t-v-1)+1+(n-p-1)}return Math.min(o,u,s,c)},r.prototype.getSubset=function(e,t){var n=new r(this);if(e>this.inputSequence.length||t>this.matchSequence.length)throw"Invalid dimensions specified for trim operation";n.inputSequence.splice(e),n.matchSequence.splice(t),n.resolvedDistances.splice(e);for(var i=this.getTrueIndex(e-1,t-1,this.diagonalWidth),a=i.col;a<=2*this.diagonalWidth;a++){var l=i.row-(a-i.col);if(l<0)break;if(a<0)n.resolvedDistances[l]=Array(2*n.diagonalWidth+1).fill(Number.MAX_VALUE);else{var o=2*this.diagonalWidth-a,s=n.resolvedDistances[l].splice(0,a+1),u=Array(o).fill(Number.MAX_VALUE);n.resolvedDistances[l]=s.concat(u)}}return n},r.forDiagonalOfAxis=function(e,t,n,i){for(var a=n-t<e?n-t+e:2*e,l=t-e,o=l<0?0:l,s=o-l;s<=a;s++)i(l+s,s)},r.prototype.addInputChar=function(e){var t=new r(this),n=t.inputSequence.length;t.inputSequence.push(e);var i=Array(2*t.diagonalWidth+1).fill(Number.MAX_VALUE);return t.resolvedDistances[n]=i,t.matchSequence.length==0||r.forDiagonalOfAxis(t.diagonalWidth,n,t.matchSequence.length-1,function(a,l){i[l]=r.initialCostAt(t,n,a)}),t},r.prototype.addMatchChar=function(e){var t=new r(this),n=t.matchSequence.length;return t.matchSequence.push(e),t.inputSequence.length==0||r.forDiagonalOfAxis(t.diagonalWidth,n,t.inputSequence.length-1,function(i,a){var l=t.resolvedDistances[i];l[2*t.diagonalWidth-a]=r.initialCostAt(t,i,n)}),t},r.prototype.increaseMaxDistance=function(){var e=new r(this);if(e.diagonalWidth++,e.inputSequence.length<1||e.matchSequence.length<1)return e;function t(o,s,u,c){var f=2*(e.diagonalWidth-1),v=u.length-1;f=f<v-o?f:v-o;for(var p=0;p<=f;p++)s==u[o+p].key&&c(o+p,p)}for(var n=function(o){var s=Number.MAX_VALUE,u=o-e.diagonalWidth;if(u>=0){var c=u==0?o+2:Number.MAX_VALUE;s=r.initialCostAt(e,o,u,c,void 0);var f=s;if(u<e.matchSequence.length-1){r.propagateUpdateFrom(e,o,u+1,f+1,0);var v=o+2;if(o+2<i.inputSequence.length){var p=e.inputSequence[o+1].key;t(u+3,p,e.matchSequence,function(S,w){r.propagateUpdateFrom(e,v,S,f+w+2,w)})}}}var d=Number.MAX_VALUE;if(u=o+e.diagonalWidth,u<e.matchSequence.length){var m=o==0?u+2:Number.MAX_VALUE;a=e.getCostAt(o,u-1,i.diagonalWidth)+1,d=r.initialCostAt(e,o,u,a,m);var C=d;if(o<e.inputSequence.length-1){r.propagateUpdateFrom(e,o+1,u,C+1,2*i.diagonalWidth);var T=u+2;if(u+2<i.matchSequence.length){var y=e.matchSequence[o+1].key;t(o+3,y,e.inputSequence,function(S,w){var _=2*(e.diagonalWidth-1)-w;r.propagateUpdateFrom(e,S,T,C+w+2,_)})}}}e.resolvedDistances[o]=[s].concat(e.resolvedDistances[o],d)},i=this,a,l=0;l<e.inputSequence.length;l++)n(l);return e},r.propagateUpdateFrom=function(e,t,n,i,a){if(i<e.resolvedDistances[t][a])e.resolvedDistances[t][a]=i;else return;var l=t<e.inputSequence.length-1,o=n<e.matchSequence.length-1;if(a<2*(e.diagonalWidth-1)&&o){var s=i+1;this.propagateUpdateFrom(e,t,n+1,s,a+1)}if(a>0&&l){var s=i+1;this.propagateUpdateFrom(e,t+1,n,s,a-1)}if(l&&o){var s=i+(e.inputSequence[t+1].key==e.matchSequence[n+1].key?0:1);this.propagateUpdateFrom(e,t+1,n+1,s,a);for(var u=-1,c=t+2;c<e.inputSequence.length;c++)if(e.inputSequence[c].key==e.matchSequence[n+1].key){u=c;break}for(var f=-1,c=n+2;c<e.matchSequence.length;c++)if(e.matchSequence[c].key==e.inputSequence[t+1].key){f=c;break}if(u>0&&f>0){var v=i+(u-t-2)+1+(f-n-2);this.propagateUpdateFrom(e,u,f,v,e.diagonalWidth-1+f-u)}}},Object.defineProperty(r.prototype,"mapKey",{get:function(){var e=this.inputSequence.map(function(n){return n.key}).join(""),t=this.matchSequence.map(function(n){return n.key}).join("");return e+K+t+K+this.diagonalWidth},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastInputEntry",{get:function(){return this.inputSequence[this.inputSequence.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lastMatchEntry",{get:function(){return this.matchSequence[this.matchSequence.length-1]},enumerable:!1,configurable:!0}),r.computeDistance=function(e,t,n){n===void 0&&(n=1);var i=new r;n=n||1,i.diagonalWidth=n;for(var a=0;a<e.length;a++)i=i.addInputChar(e[a]);for(var l=0;l<t.length;l++)i=i.addMatchChar(t[l]);return i},r}(),Ce=function(r,e){return r.currentCost-e.currentCost},Ge=function(){function r(e,t){if(this.toKey=function(i){return i},t=t||function(i){return i},e instanceof r){var n=e;this.calculation=n.calculation,this.currentTraversal=n.currentTraversal,this.priorInput=n.priorInput,this.toKey=n.toKey}else this.calculation=new Ne,this.currentTraversal=e,this.priorInput=[],this.toKey=t}return Object.defineProperty(r.prototype,"knownCost",{get:function(){return this.calculation.getHeuristicFinalCost()},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputSamplingCost",{get:function(){if(this._inputCost!==void 0)return this._inputCost;var e=ee.MIN_KEYSTROKE_PROBABILITY;return this._inputCost=this.priorInput.map(function(t){return t.p>e?t.p:e}).reduce(function(t,n){return t-Math.log(n)},0),this._inputCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentCost",{get:function(){return ee.EDIT_DISTANCE_COST_SCALE*this.knownCost+this.inputSamplingCost},enumerable:!1,configurable:!0}),r.prototype.buildInsertionEdges=function(){var e,t,n=[];try{for(var i=(0,x.__values)(this.currentTraversal.children()),a=i.next();!a.done;a=i.next()){var l=a.value,o=l.traversal(),s={key:l.char,traversal:o},u=this.calculation.addMatchChar(s),c=new r(this);c.calculation=u,c.priorInput=this.priorInput,c.currentTraversal=o,n.push(c)}}catch(f){e={error:f}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.buildDeletionEdges=function(e){var t,n,i=[];try{for(var a=(0,x.__values)(e),l=a.next();!l.done;l=a.next()){var o=l.value;if(o.p<e[0].p*Math.exp(-ee.EDIT_DISTANCE_COST_SCALE))break;var s=this.calculation,u=o.sample;u.deleteLeft&&(s=s.getSubset(s.inputSequence.length-u.deleteLeft,s.matchSequence.length));var c=this.priorInput.slice(0);c.push(o);for(var f=0;f<u.insert.length;f++){var v=u.insert[f];$(v)&&(f++,v=v+u.insert[f]);var p=this.toKey(v);p&&(s=s.addInputChar({key:p}))}var d=new r(this);d.calculation=s,d.priorInput=c,i.push(d)}}catch(m){t={error:m}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return i},r.prototype.buildSubstitutionEdges=function(e){var t,n,i,a,l=this.buildDeletionEdges(e),o=[];try{for(var s=(0,x.__values)(this.currentTraversal.children()),u=s.next();!u.done;u=s.next()){var c=u.value;try{for(var f=(i=void 0,(0,x.__values)(l)),v=f.next();!v.done;v=f.next()){var p=v.value,d=c.traversal(),m={key:c.char,traversal:d},C=p.calculation.addMatchChar(m),T=new r(this);T.calculation=C,T.priorInput=p.priorInput,T.currentTraversal=d,o.push(T)}}catch(y){i={error:y}}finally{try{v&&!v.done&&(a=f.return)&&a.call(f)}finally{if(i)throw i.error}}}}catch(y){t={error:y}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return o},Object.defineProperty(r.prototype,"mapKey",{get:function(){var e=this.priorInput.map(function(n){return"+"+n.sample.insert+"-"+n.sample.deleteLeft}).join(""),t=this.calculation.matchSequence.map(function(n){return n.key}).join("");return e+K+t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isFullReplacement",{get:function(){return this.knownCost&&this.knownCost==this.priorInput.length},enumerable:!1,configurable:!0}),r}(),Le=function(){function r(e,t){if(this.processed=[],typeof e=="number"){this.index=e,this.correctionQueue=new b(Ce,t);return}else this.index=e.index,this.processed=[].concat(e.processed),this.correctionQueue=new b(e.correctionQueue)}return r.prototype.increaseMaxEditDistance=function(){var e=this.correctionQueue.toArray();e.forEach(function(t){t.calculation=t.calculation.increaseMaxDistance()}),this.correctionQueue=new b(Ce,e)},r}(),He=function(){function r(e){this.resultNode=e}return Object.defineProperty(r.prototype,"inputSequence",{get:function(){return this.resultNode.priorInput},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"matchSequence",{get:function(){return this.resultNode.calculation.matchSequence},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"matchString",{get:function(){return this.matchSequence.map(function(e){return e.key}).join("")},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"knownCost",{get:function(){return this.resultNode.knownCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputSamplingCost",{get:function(){return this.resultNode.inputSamplingCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"totalCost",{get:function(){return this.resultNode.currentCost},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"finalTraversal",{get:function(){return this.resultNode.currentTraversal},enumerable:!1,configurable:!0}),r}(),ee=function(){function r(e){if(this.tierOrdering=[],this.inputSequence=[],this.minInputCost=[],this.returnedValues={},this.processedEdgeSet={},this.buildQueueSpaceComparator(),e instanceof r){this.inputSequence=[].concat(e.inputSequence),this.minInputCost=[].concat(e.minInputCost),this.rootNode=e.rootNode,this.completedPaths=[].concat(e.completedPaths),this.returnedValues=(0,x.__assign)({},e.returnedValues),this.processedEdgeSet=(0,x.__assign)({},e.processedEdgeSet),this.tierOrdering=e.tierOrdering.map(function(i){return new Le(i)}),this.selectionQueue=new b(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering);return}var t=e;if(t){if(!t.traverseFromRoot)throw"The provided model does not implement the `traverseFromRoot` function, which is needed to support robust correction searching."}else throw"The LexicalModel parameter must not be null / undefined.";this.selectionQueue=new b(this.QUEUE_SPACE_COMPARATOR),this.rootNode=new Ge(t.traverseFromRoot(),t.toKey?t.toKey.bind(t):null),this.completedPaths=[this.rootNode];var n=new Le(0,[this.rootNode]);this.tierOrdering.push(n),this.selectionQueue.enqueue(n)}return r.prototype.buildQueueSpaceComparator=function(){var e=this;this.QUEUE_SPACE_COMPARATOR=function(t,n){var i=t.correctionQueue.peek(),a=n.correctionQueue.peek(),l=t.index,o=n.index,s=0,u=1;if(o<l){var c=o;o=l,l=c,u=-1}for(var f=l;f<o;f++)s=s+e.minInputCost[f];return i&&a?i.currentCost-a.currentCost+u*s:a?1:-1}},r.prototype.increaseMaxEditDistance=function(){this.tierOrdering.forEach(function(e){e.increaseMaxEditDistance()})},r.prototype.addInput=function(e){this.inputSequence.push(e),this.minInputCost.push(-Math.log(e[0].p));var t=[],n=this.completedPaths.map(function(a){var l=a.buildDeletionEdges(e),o=a.buildSubstitutionEdges(e);return l.concat(o)});this.completedPaths=[],this.returnedValues={},n.forEach(function(a){t=t.concat(a)});var i=new Le(this.tierOrdering.length,t);this.tierOrdering.push(i),this.selectionQueue.enqueue(i)},r.prototype.removeLastInput=function(){},r.prototype.hasNextMatchEntry=function(){var e=this.selectionQueue.peek();return e?e.correctionQueue.count>0:!1},r.prototype.handleNextNode=function(){if(!this.hasNextMatchEntry())return{type:"none"};var e=this.selectionQueue.dequeue(),t=e.correctionQueue.dequeue(),n={type:"intermediate",cost:t.currentCost};if(this.processedEdgeSet[t.mapKey])return this.selectionQueue.enqueue(e),n;this.processedEdgeSet[t.mapKey]=!0;var i=!1;if(t.knownCost>2)return n;t.knownCost==2&&(i=!0);for(var a=0,l=0;l<=e.index;l++)a+=this.minInputCost[l];if(t.currentCost>a+2.5*r.EDIT_DISTANCE_COST_SCALE)return n;if(!i){var o=t.buildInsertionEdges();e.correctionQueue.enqueueAll(o)}if(e.index==this.tierOrdering.length-1)return this.completedPaths.push(t),this.selectionQueue.enqueue(e),{type:"complete",cost:t.currentCost,finalNode:t};var s=this.tierOrdering[e.index+1],u=s.index,c=[];i||(c=t.buildDeletionEdges(this.inputSequence[u-1]));var f=t.buildSubstitutionEdges(this.inputSequence[u-1]);return s.correctionQueue.enqueueAll(c.concat(f)),this.selectionQueue=new b(this.QUEUE_SPACE_COMPARATOR,this.tierOrdering),n},r.prototype.getBestMatches=function(e){var t,n,i,a,l,o,s,u,c,f,v,p,d,m,C,T;return(0,x.__generator)(this,function(y){switch(y.label){case 0:if(t=this,n={},e==0?i=1/0:e==null||Number.isNaN(e)?i=r.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL:i=e,a=function(){function S(w,_){this.largestIntervals=[0],this.loopStart=this.start=Date.now(),this.maxExecutionTime=w,this.maxTrueTime=_}return S.prototype.startLoop=function(){this.loopStart=Date.now()},S.prototype.markIteration=function(){var w=Date.now(),_=w-this.loopStart;this.executionTime+=_,_&&_>this.largestIntervals[0]&&(this.largestIntervals.length>2?this.largestIntervals[0]=_:this.largestIntervals.push(_),this.largestIntervals.sort(),this.updateOutliers())},S.prototype.updateOutliers=function(){this.largestIntervals.length>2&&this.largestIntervals[2]>=2*(this.largestIntervals[0]+this.largestIntervals[1])&&(this.executionTime-=this.largestIntervals[2],this.largestIntervals.pop())},S.prototype.shouldTimeout=function(){var w=Date.now();return w-this.start>this.maxTrueTime?!0:this.executionTime>this.maxExecutionTime},S.prototype.resetOutlierCheck=function(){this.largestIntervals=[]},S}(),l=function(){function S(){this.currentCost=Number.MIN_SAFE_INTEGER,this.entries=[]}return S.prototype.checkAndAdd=function(w){var _=null;w.currentCost>this.currentCost&&(_=this.tryFinalize(),this.currentCost=w.currentCost);var E=w.calculation.matchSequence.map(function(Q){return Q.key}).join("");return t.returnedValues[E]||(t.returnedValues[E]=w),n[E]||(this.entries.push(new He(w)),n[E]=w),_},S.prototype.tryFinalize=function(){var w=null;return this.entries.length>0&&(w=this.entries,this.entries=[]),w},S}(),o=new l,s=new a(i*1.5,i),u=Object.values(this.returnedValues),!(u.length>0))return[3,6];c=new b(Ce,u),s.startLoop(),y.label=1;case 1:return c.count>0?(f=c.dequeue(),f.isFullReplacement?[3,1]:(v=o.checkAndAdd(f),s.markIteration(),v?[4,v]:[3,3])):[3,4];case 2:y.sent(),y.label=3;case 3:return[3,1];case 4:return p=o.tryFinalize(),p?[4,p]:[3,6];case 5:y.sent(),y.label=6;case 6:s.resetOutlierCheck(),s.startLoop(),d=!1,y.label=7;case 7:m=void 0;do m=this.handleNextNode(),s.markIteration(),s.shouldTimeout()&&(d=!0);while(!d&&m.type=="intermediate");if(C=void 0,m.type=="none")return[3,10];if(m.type=="complete"){if(m.finalNode.isFullReplacement)return[3,10];C=o.checkAndAdd(m.finalNode)}return C?[4,C]:[3,9];case 8:y.sent(),y.label=9;case 9:if(!d&&this.hasNextMatchEntry())return[3,7];y.label=10;case 10:return T=o.tryFinalize(),T?[4,T]:[3,12];case 11:y.sent(),y.label=12;case 12:return[2,null]}})},r.EDIT_DISTANCE_COST_SCALE=5,r.MIN_KEYSTROKE_PROBABILITY=1e-4,r.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL=33,r}(),dt=function(){function r(){}return r.isWhitespace=function(e){var t=/^[\\u0009\\u000A\\u000D\\u0020\\u00a0\\u1680\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u200b\\u2028\\u2029\\u202f\\u205f\\u3000]+$/i;return e.insert.match(t)!=null},r.isBackspace=function(e){return e.insert==""&&e.deleteLeft>0&&!e.deleteRight},r.isEmpty=function(e){return e.insert==""&&e.deleteLeft==0&&!e.deleteRight},r}(),te=dt;function Xe(r,e){for(var t=[],n=0;n<r.kmwLength();n++){var i=r.kmwCharAt(n),a={insert:i,deleteLeft:0,id:e};t.push(a)}return t}var gt=function(){function r(){}return r}(),re=function(){function r(){this.transformDistributions=[],this.activeReplacementId=-1}return Object.defineProperty(r.prototype,"currentText",{get:function(){return this.replacementText===void 0||this.replacementText===null?this.raw:this.replacementText},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"replacement",{get:function(){var e=this.activeReplacementId;return this.replacements.find(function(t){return t.suggestion.id==e})},enumerable:!1,configurable:!0}),r.prototype.revert=function(){delete this.activeReplacementId},r}(),be=function(){function r(e){if(this.searchSpace=[],e instanceof r){var t=e;this.tokens=t.tokens.map(function(i){var a=new re;return a.raw=i.raw,a.replacements=[].concat(i.replacements),a.activeReplacementId=i.activeReplacementId,a.transformDistributions=[].concat(i.transformDistributions),i.replacementText&&(a.replacementText=i.replacementText),a}),this.indexOffset=0;var n=this.model=e.model;this.taggedContext=e.taggedContext,n!=null&&n.traverseFromRoot&&(this.searchSpace=e.searchSpace.map(function(i){return new ee(i)}))}else{var n=e;this.tokens=[],this.indexOffset=Number.MIN_SAFE_INTEGER,this.model=n,n&&n.traverseFromRoot&&(this.searchSpace=[new ee(n)])}}return Object.defineProperty(r.prototype,"head",{get:function(){return this.tokens[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tail",{get:function(){return this.tokens[this.tokens.length-1]},enumerable:!1,configurable:!0}),r.prototype.popHead=function(){this.tokens.splice(0,2),this.indexOffset-=1},r.prototype.pushTail=function(e){this.model&&this.model.traverseFromRoot?this.searchSpace=[new ee(this.model)]:this.searchSpace=[],this.tokens.push(e);var t=this;t.searchSpace.length>0&&e.transformDistributions.forEach(function(n){return t.searchSpace[0].addInput(n)})},r.prototype.pushWhitespaceToTail=function(e){e===void 0&&(e=null);var t=new re;t.transformDistributions=e?[e]:[],t.raw=null,this.tokens.push(t)},r.prototype.replaceTailForBackspace=function(e,t){this.tokens.pop();var n=Xe(e,t).map(function(a){return[{sample:a,p:1}]}),i=new re;i.raw=e,i.transformDistributions=n,this.pushTail(i)},r.prototype.updateTail=function(e,t){var n=this.tail;t=t||(t===""?"":n.raw),e&&e.length>0&&(n.transformDistributions.push(e),this.searchSpace&&this.searchSpace.forEach(function(i){return i.addInput(e)})),n.raw=t},r.prototype.toRawTokenization=function(){var e,t,n=[];try{for(var i=(0,x.__values)(this.tokens),a=i.next();!a.done;a=i.next()){var l=a.value;l.currentText!==null&&n.push(l.currentText)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r}(),yt=function(){function r(e){e===void 0&&(e=r.DEFAULT_ARRAY_SIZE),this.currentHead=0,this.currentTail=0,this.circle=Array(e)}return Object.defineProperty(r.prototype,"count",{get:function(){var e=this.currentHead-this.currentTail;return e<0&&(e=e+this.circle.length),e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxCount",{get:function(){return this.circle.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"oldest",{get:function(){if(this.count!=0)return this.item(0)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"newest",{get:function(){if(this.count!=0)return this.item(this.count-1)},enumerable:!1,configurable:!0}),r.prototype.enqueue=function(e){var t=null,n=(this.currentHead+1)%this.maxCount;return n==this.currentTail&&(t=this.circle[this.currentTail],this.currentTail=(this.currentTail+1)%this.maxCount),this.circle[this.currentHead]=e,this.currentHead=n,t},r.prototype.dequeue=function(){if(this.currentTail==this.currentHead)return null;var e=this.circle[this.currentTail];return this.currentTail=(this.currentTail+1)%this.maxCount,e},r.prototype.popNewest=function(){if(this.currentTail==this.currentHead)return null;var e=this.circle[this.currentHead];return this.currentHead=(this.currentHead-1+this.maxCount)%this.maxCount,e},r.prototype.item=function(e){if(e>=this.count)throw"Invalid array index";var t=(this.currentTail+e)%this.maxCount;return this.circle[t]},r.DEFAULT_ARRAY_SIZE=5,r}(),ze=function(r){(0,x.__extends)(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.attemptMatchContext=function(t,n,i){var a=n.toRawTokenization(),l=Ne.computeDistance(a.map(function(Q){return{key:Q}}),t.map(function(Q){return{key:Q}}),1),o=l.editPath(),s=!1,u=!1;if(o.length>1){if(o[0]=="insert"&&!(o[1]=="substitute"&&o.length==2)||o[0].indexOf("transpose")>=0)return null;o[0]=="delete"&&(s=!0)}var c=o.length-1,f=!1;if(o[c]=="delete"||o[0].indexOf("transpose")>=0||(o[c]=="insert"?u=!0:c>0&&o[c-1]=="insert"&&o[c]=="substitute"&&(u=!0,f=!0),c>0&&o[c-1]=="delete"&&o[c]=="substitute"))return null;for(var v=1;v<o.length-(f?2:1);v++)if(o[v]!="match")return null;var p;u?(f&&(n.tail.replacementText=t[t.length-2]),p=new be(n)):p=i?new be(n):n;var d=i&&Array.isArray(i),m=d?i[0].sample:null;m&&m.insert==""&&m.deleteLeft==0&&!m.deleteRight&&(m=null);var C=m&&te.isWhitespace(m),T=m&&te.isBackspace(m),y=t[t.length-1];function S(){C&&o[c]=="match"||(T?p.replaceTailForBackspace(y,m.id):p.updateTail(m?i:null,y))}if(o.length>1)if(s&&p.popHead(),u){var w=t[t.length-1],_=new re;_.raw=w,C||!m?(p.pushWhitespaceToTail(i!=null?i:[]),_.transformDistributions=[]):(p.pushWhitespaceToTail(),_.transformDistributions=i?[i]:[]),p.pushTail(_)}else S();else if(o[c]=="insert"){var E=new re;E.raw=t[0],E.transformDistributions=[i],p.pushTail(E)}else S();return p},e.modelContextState=function(t,n,i){var a=t.map(function(s){var u=new re;return u.raw=s,u.raw?u.transformDistributions=Xe(u.raw).map(function(c){return[{sample:c,p:1}]}):u.transformDistributions=[],u}),l=new be(i);for(a.length>0&&l.pushTail(a.splice(0,1)[0]);a.length>0;)l.pushWhitespaceToTail(),l.pushTail(a.splice(0,1)[0]);if(l.tokens.length==0){var o=new re;o.raw="",l.pushTail(o)}return l},e.prototype.analyzeState=function(t,n,i){if(!t.traverseFromRoot)throw"This lexical model does not provide adequate data for correction algorithms and context reuse";var a=Y(t.wordbreaker||ce,n);if(a.left.length>0)for(var l=this.count-1;l>=0;l--){var o=this.item(l),s=o.taggedContext;if(s&&i&&i.length>0){var u=X(i[0].sample,s);if(u.left!=n.left)continue}else if((s==null?void 0:s.left)!=n.left)continue;var c=e.attemptMatchContext(a.left,this.item(l),i);if(c)return this.newest!=c&&this.newest!=o&&this.enqueue(o),c.taggedContext=n,c!=this.item(l)&&this.enqueue(c),c}var f=e.modelContextState(a.left,i,t);return f.taggedContext=n,this.enqueue(f),f},e.prototype.clearCache=function(){for(;this.count>0;)this.dequeue()},e}(yt),mt=function(){function r(e,t){this.SUGGESTION_ID_SEED=0,this.testMode=!1,this.lexicalModel=e,e.traverseFromRoot&&(this.contextTracker=new ze),this.punctuation=r.determinePunctuationFromModel(e),this.testMode=!!t}return r.prototype.predictFromCorrections=function(e,t){var n,i,a=[],l=function(f){var v=o.lexicalModel.predict(f.sample,t),p=v.map(function(d){var m=f.sample,C=f.p;m.id!==void 0&&(d.sample.transformId=m.id);var T={sample:d.sample,p:d.p*C};return T},o);a=a.concat(p)},o=this;try{for(var s=(0,x.__values)(e),u=s.next();!u.done;u=s.next()){var c=u.value;l(c)}}catch(f){n={error:f}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return a},r.prototype.predict=function(e,t){var n,i,a,l,o=[],s=this.lexicalModel,u=this.punctuation;e instanceof Array?e.length==0&&e.push({sample:{insert:"",deleteLeft:0},p:1}):e=[{sample:e,p:1}];var c=e.sort(function(N,L){return L.p-N.p})[0].sample,f=te.isWhitespace(c),v=te.isBackspace(c),p=X(c,t),d=this.wordbreak(p),m=null,C=[],T,y=null;if(this.contextTracker){var w=this.contextTracker.analyzeState(this.lexicalModel,t,null);y=this.contextTracker.analyzeState(this.lexicalModel,p,te.isEmpty(c)?null:e);var _=y.searchSpace[0],E=0,Q=y.tokens,ne=Q.length,Z=Q.length-w.tokens.length;ne==0||Z>0?(E=0,te.isWhitespace(c)&&(T=c,t=p,w=y)):Z<0?E=this.wordbreak(p).kmwLength()+c.deleteLeft:E=this.wordbreak(t).kmwLength();var ke=Q[Q.length-1],_e=ke.transformDistributions.length<=1,ie=void 0,xe=this.testMode?0:ee.DEFAULT_ALLOTTED_CORRECTION_TIME_INTERVAL;try{for(var ae=(0,x.__values)(_.getBestMatches(xe)),V=ae.next();!V.done;V=ae.next()){var ve=V.value,S=ve.map(function(L){var fe=L.matchString,me;L.inputSequence.length>0?me=L.inputSequence[L.inputSequence.length-1].sample:me=c;var Tt={insert:fe,deleteLeft:E,id:me.id},$e=L.totalCost;return _e&&($e*=r.SINGLE_CHAR_KEY_PROB_EXPONENT),{sample:Tt,p:Math.exp(-$e)}},this),W=this.predictFromCorrections(S,t);W.length>0&&ie===void 0&&(ie=-Math.log(S[0].p)),C=C.concat(W);var oe=ve[0].totalCost;if(oe>=ie+8)break;if(C.length>=r.MAX_SUGGESTIONS){if(oe>=ie+4)break;if(C.sort(function(L,fe){return fe.p-L.p}),C[r.MAX_SUGGESTIONS-1].p>Math.exp(-oe))break}}}catch(N){n={error:N}}finally{try{V&&!V.done&&(i=ae.return)&&i.call(ae)}finally{if(n)throw n.error}}}else{var S=void 0;f?(S=[{sample:c,p:1}],T=c):S=e.map(function(N){var L=N.sample;return te.isWhitespace(L)&&!f||te.isBackspace(L)&&!v?null:N}),S=S.filter(function(N){return!!N}),C=this.predictFromCorrections(S,t)}var ue={},se=null;s.languageUsesCasing&&(se=this.detectCurrentCasing(p));var bt=this.wordbreak(t);try{for(var Te=(0,x.__values)(C),de=Te.next();!de.done;de=Te.next()){var G=de.value,ge=G.sample.displayAs,Re=ge==d;if(this.lexicalModel.languageUsesCasing&&(Re=Re||ge==this.lexicalModel.applyCasing("lower",d)),Re)if(m)m.p&&G.p&&(m.p+=G.p);else{var Fe=G.sample.transform,De={insert:d,deleteLeft:Fe.deleteLeft,deleteRight:Fe.deleteRight,id:Fe.id},kt=h(De,G.p);m=this.toAnnotatedSuggestion(kt,"keep",U.noQuotes),m.matchesModel=!0,m.transformId=G.sample.transformId}else{se&&se!="lower"&&(this.applySuggestionCasing(G.sample,bt,se),ge=G.sample.displayAs);var Ze=ue[ge];Ze?Ze.p+=G.p:ue[ge]=G}}}catch(N){a={error:N}}finally{try{de&&!de.done&&(l=Te.return)&&l.call(Te)}finally{if(a)throw a.error}}if(!m&&d!=""){var De=(0,x.__assign)({},c),Je=h(De,1);Je.displayAs=d,m=this.toAnnotatedSuggestion(Je,"keep"),m.matchesModel=!1}for(var _t in ue){var xt=ue[_t];o.push(xt)}o=o.sort(function(N,L){return L.p-N.p});var ye=o.splice(0,r.MAX_SUGGESTIONS).map(function(N){var L=N.sample;return L.p&&(L["lexical-p"]=L.p,L["correction-p"]=N.p/L.p,L.p=N.p),L});m&&(ye=[m].concat(ye));var je=this;return ye.forEach(function(N){if(!t.right)N.transform.insert+=u.insertAfterWord;else{var L=je.tokenize(t);L&&L.caretSplitsToken&&(N.transform.insert+=u.insertAfterWord)}if(T){var fe=le(T,N.transform);fe.id=N.transformId;var me=N;me.transform=fe}N.id=je.SUGGESTION_ID_SEED,je.SUGGESTION_ID_SEED++}),y&&(y.tail.replacements=ye.map(function(N){return{suggestion:N,tokenWidth:1}})),ye},r.prototype.applySuggestionCasing=function(e,t,n){var i=t.kmwLength()-e.transform.deleteLeft;i>0&&(e.transform.deleteLeft+=i,e.transform.insert=t.kmwSubstr(0,i)+e.transform.insert),e.transform.insert=this.lexicalModel.applyCasing(n,e.transform.insert),e.displayAs=this.lexicalModel.applyCasing(n,e.displayAs)},r.prototype.toAnnotatedSuggestion=function(e,t,n){n===void 0&&(n=U.default);var i=U,a=i.noQuotes;return(t=="keep"||t=="revert")&&(a=i.useQuotes),{transform:e.transform,transformId:e.transformId,displayAs:i.apply(n,e.displayAs,this.punctuation,a),tag:t,p:e.p}},r.determinePunctuationFromModel=function(e){var t=St;if(!e.punctuation)return t;var n=e.punctuation,i=n.insertAfterWord;i!==""&&!i&&(i=t.insertAfterWord);var a=n.quotesForKeepSuggestion;a||(a=t.quotesForKeepSuggestion);var l=n.isRTL;return{insertAfterWord:i,quotesForKeepSuggestion:a,isRTL:l}},r.prototype.acceptSuggestion=function(e,t,n){var i=e.transform,a=t.left.kmwSubstr(-i.deleteLeft,i.deleteLeft),l=i.insert.kmwLength(),o={insert:a,deleteLeft:l},s=t;n&&(o=le(o,n),s=X(n,s));var u,c=this.tokenize(s);c?(c.left.length>0?u=c.left[c.left.length-1]:u="",u+=c.caretSplitsToken?c.right[0]:""):u=this.wordbreak(s);var f=h(o);f.displayAs=u;var v=this.toAnnotatedSuggestion(f,"revert");if(e.transformId!=null&&(v.transformId=-e.transformId),e.id!=null?v.id=-e.id:(v.id=-this.SUGGESTION_ID_SEED,this.SUGGESTION_ID_SEED++),this.contextTracker){var p=this.contextTracker.newest;p||(p=this.contextTracker.analyzeState(this.lexicalModel,t)),p.tail.activeReplacementId=e.id;var d=X(e.transform,t);this.contextTracker.analyzeState(this.lexicalModel,d)}return v},r.prototype.applyReversion=function(e,t){var n=this,i=function(){var u=X(e.transform,t),c=n.predict({insert:"",deleteLeft:0},u);return c.forEach(function(f){f.transformId=-e.transformId}),c};if(!this.contextTracker)return i();for(var a=!1,l=this.contextTracker.count-1;l>=0;l--){var o=this.contextTracker.item(l);if(o.tail.activeReplacementId==-e.id){a=!0;break}}if(!a)return i();for(;this.contextTracker.newest.tail.activeReplacementId!=-e.id;)this.contextTracker.popNewest();this.contextTracker.newest.tail.revert();var s=this.contextTracker.newest.tail.replacements.map(function(u){return u.suggestion});return s.forEach(function(u){u.transformId=-e.transformId}),s},r.prototype.wordbreak=function(e){var t=this.lexicalModel;if(t.wordbreaker||!t.wordbreak){var n=t.wordbreaker||ce;return Ae(n,e)}else return t.wordbreak(e)},r.prototype.tokenize=function(e){var t=this.lexicalModel;return t.wordbreaker?Y(t.wordbreaker,e):null},r.prototype.resetContext=function(e){this.contextTracker&&(this.contextTracker.clearCache(),this.contextTracker.analyzeState(this.lexicalModel,e,null))},r.prototype.detectCurrentCasing=function(e){var t,n=this.lexicalModel,i=this.wordbreak(e);if(!n.languageUsesCasing)throw"Invalid attempt to detect casing: languageUsesCasing is set to false";if(!n.applyCasing)throw"Invalid LMLayer state:  languageUsesCasing is set to true, but no applyCasing function exists";return e.casingForm=="upper"||e.casingForm=="initial"?e.casingForm:n.applyCasing("lower",i)==i?"lower":n.applyCasing("upper",i)==i?i.kmwLength()>1?"upper":"initial":n.applyCasing("initial",i)==i?"initial":(t=e.casingForm)!==null&&t!==void 0?t:null},r.MAX_SUGGESTIONS=12,r.SINGLE_CHAR_KEY_PROB_EXPONENT=16,r}(),wt=mt,St={quotesForKeepSuggestion:{open:"\\u201C",close:"\\u201D"},insertAfterWord:" "};B();var Ct=function(){function r(e){e===void 0&&(e={importScripts:null,postMessage:null}),this._testMode=!1,this._postMessage=e.postMessage||postMessage,this._importScripts=e.importScripts||importScripts,this.setupConfigState()}return r.prototype.error=function(e,t){this.cast("error",{log:e,error:t&&t.stack?t.stack:void 0})},r.prototype.onMessage=function(e){var t=e.data.message;if(!t)throw new Error("Missing required \'message\' property: ".concat(e.data));var n=e.data;if(n.message=="load"){var i=n,a=!1;if(this._currentModelSource&&i.source.type==this._currentModelSource.type&&(i.source.type=="file"&&i.source.file==this._currentModelSource.file||i.source.type=="raw"&&i.source.code==this._currentModelSource.code)&&(a=!0),a){typeof console!="undefined"&&console.warn("Duplicate model load message detected - squashing!");return}else this._currentModelSource=i.source}else n.message=="unload"&&(this._currentModelSource=null);this.state.handleMessage(n)},r.prototype.cast=function(e,t){var n=this._postMessage;n((0,x.__assign)({message:e},t))},r.prototype.loadModel=function(e){try{var t=e.configure(this._platformCapabilities);t.leftContextCodePoints||(t.leftContextCodePoints=t.leftContextCodeUnits),t.rightContextCodePoints||(t.rightContextCodePoints=t.rightContextCodeUnits),t.leftContextCodePoints||(t.leftContextCodePoints=this._platformCapabilities.maxLeftContextCodePoints),t.rightContextCodePoints||(t.rightContextCodePoints=this._platformCapabilities.maxRightContextCodePoints||0),e.languageUsesCasing&&!e.applyCasing&&(e.applyCasing=g);var n=this.transitionToReadyState(e);t.wordbreaksAfterSuggestions===void 0&&(t.wordbreaksAfterSuggestions=n.punctuation.insertAfterWord!=""),this.cast("ready",{configuration:t})}catch(i){this.error("loadModel failed!",i)}},r.prototype.loadModelFile=function(e){try{this._importScripts(e)}catch(t){this.error("Error occurred when attempting to load dictionary",t)}},r.prototype.unloadModel=function(){this.transitionToLoadingState()},r.prototype.setupConfigState=function(){var e=this;this.state={name:"unconfigured",handleMessage:function(t){if(t.message!=="config")throw new Error("invalid message; expected \'config\' but got ".concat(t.message));e._platformCapabilities=t.capabilities,e._testMode=!!t.testMode,e.transitionToLoadingState()}}},r.prototype.transitionToLoadingState=function(){var e=this;this.state={name:"modelless",handleMessage:function(t){if(t.message!=="load")throw new Error("invalid message; expected \'load\' but got ".concat(t.message));if(t.source.type=="file")e.loadModelFile(t.source.file);else{var n=t.source.code,i=new Function("LMLayerWorker","models","correction","wordBreakers",n);i(e,H,qe,Pe)}}}},r.prototype.transitionToReadyState=function(e){var t=this,n=new wt(e,this._testMode);return this.state={name:"ready",handleMessage:function(i){switch(i.message){case"predict":var a=i.transform,f=i.context,c=n.predict(a,f);t.cast("suggestions",{token:i.token,suggestions:c});break;case"wordbreak":var l=Ae(e.wordbreaker||ce,i.context);t.cast("currentword",{token:i.token,word:l});break;case"unload":t.unloadModel();break;case"accept":var o=i.suggestion,f=i.context,s=i.postTransform,u=n.acceptSuggestion(o,f,s);t.cast("postaccept",{token:i.token,reversion:u});break;case"revert":var u=i.reversion,f=i.context,c=n.applyReversion(u,f);t.cast("postrevert",{token:i.token,suggestions:c});break;case"reset-context":var f=i.context;n.resetContext(f);break;default:throw new Error("invalid message; expected one of {\'predict\', \'wordbreak\', \'accept\', \'revert\', \'reset-context\', \'unload\'} but got ".concat(i.message))}},compositor:n},n},r.install=function(e){var t=new r({postMessage:e.postMessage,importScripts:e.importScripts.bind(e)});return e.onmessage=t.onMessage.bind(t),t.self=e,e.LMLayerWorker=t,e.models=H,e.correction=qe,e.wordBreakers=Pe,t},r}(),Ye=Ct;typeof self!="undefined"&&"postMessage"in self&&"importScripts"in self?Ye.install(self):window.LMLayerWorker=Ye}();\n',cc="";var Rs=function(){function c(){}return c.constructInstance=function(){return new Worker(this.asBlobURI(ic))},c.asBlobURI=function(e){var t=Ne(e);t+="\n"+cc;var n=new Blob([t],{type:"text/javascript"});return URL.createObjectURL(n)},c}(),Tn=Rs;var rc=function(){function c(e,t){this.suggestions=e,this.transcriptionID=t}return c}();var Ls=function(c){(0,Q.__extends)(e,c);function e(t,n,i){i===void 0&&(i=!1);var r=c.call(this)||this;r._mayPredict=!0,r._mayCorrect=!0,r._state="inactive",r.recentTranscriptions=n;var s={maxLeftContextCodePoints:64,maxRightContextCodePoints:i?0:64};return t&&(r.lmEngine=new kn(s,t)),r}return Object.defineProperty(e.prototype,"activeModel",{get:function(){return this.currentModel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConfigured",{get:function(){return!!this.configuration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),e.prototype.unloadModel=function(){this.lmEngine.unloadModel(),delete this.currentModel,delete this.configuration,this._state="inactive",this.emit("statechange","inactive")},e.prototype.loadModel=function(t){var n=this;if(!t)throw new Error("Null reference not allowed.");var i=t.path?"file":"raw",r=i=="file"?t.path:t.code;return this.currentModel=t,this.mayPredict&&(this._state="active",this.emit("statechange","active")),this.lmEngine.loadModel(r,i).then(function(s){n.configuration=s,n.mayPredict&&(n._state="configured",n.emit("statechange","configured"))}).catch(function(s){var l;s instanceof Error?l=s.message:l=String(s),console.error("Could not load model '"+t.id+"': "+l),n.currentModel=null,n._state="inactive",n.emit("statechange","inactive")})},e.prototype.invalidateContext=function(t,n){if(this.emit("invalidatesuggestions","context"),!this.currentModel||!this.configuration)return Promise.resolve([]);if(this.isActive)if(t){var i=t.buildTranscriptionFrom(t,null,!1);return this.predict_internal(i,!0,n)}else return Promise.resolve([]);else return Promise.resolve([])},e.prototype.wordbreak=function(t,n){if(!this.isActive)return null;var i=new mt(w.from(t,!1),this.configuration,n);return this.lmEngine.wordbreak(i)},e.prototype.predict=function(t,n){return!this.isActive||!this.currentModel||!this.configuration?null:(this.emit("invalidatesuggestions","new"),this.predict_internal(t,!1,n))},e.prototype.applySuggestion=function(t,n,i){var r=this;if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";if(!this.isConfigured)return console.warn("Could not apply suggestion; the corresponding model has been unloaded"),null;var s=this.getPredictionState(t.transformId);if(s){var l=w.from(s.preInput,!1);l.apply(t.transform);var o=l.buildTransformFrom(n);n.apply(o),this.emit("suggestionapplied",n);var a=w.from(s.preInput,!1);a.apply(s.transform);var g=new mt(s.preInput,this.configuration,i()),d=this.lmEngine.acceptSuggestion(t,g,s.transform);return d=d.then(function(B){var u={transform:s.transform,transformId:-s.token,displayAs:B.displayAs,id:B.id,tag:B.tag};return r.predictFromTarget(n,i()),u}),d}else return console.warn("Could not apply the Suggestion!"),null},e.prototype.applyReversion=function(t,n){var i=this;if(!n)throw"Accepting suggestions requires a destination OutputTarget instance.";var r=this.getPredictionState(-t.transformId);if(!r)return console.warn("Could not apply the Suggestion!"),Promise.resolve([]);var s=w.from(r.preInput,!1);s.apply(t.transform);var l=s.buildTransformFrom(n);n.apply(l);var o=this.lmEngine.revertSuggestion(t,new mt(r.preInput,this.configuration,null));return o.then(function(a){var g=new rc(a,l.id);return i.emit("suggestionsready",g),i.currentPromise=null,a})},e.prototype.predictFromTarget=function(t,n){if(!t)return null;var i=t.buildTranscriptionFrom(t,null,!1);return this.predict(i,n)},e.prototype.predict_internal=function(t,n,i){var r=this;if(!t)return null;var s=new mt(t.preInput,this.configuration,i);this.recordTranscription(t),n&&this.lmEngine.resetContext(s);var l=t.alternates;(!l||l.length==0)&&(l=[{sample:t.transform,p:1}]);var o=t.transform,a=this.currentPromise=this.lmEngine.predict(l,s);return a.then(function(g){if(a==r.currentPromise){var d=new rc(g,o.id);r.emit("suggestionsready",d),r.currentPromise=null}return g})},e.prototype.recordTranscription=function(t){this.recentTranscriptions.save(t)},e.prototype.getPredictionState=function(t){return this.recentTranscriptions.get(t)},e.prototype.shutdown=function(){this.lmEngine.shutdown()},Object.defineProperty(e.prototype,"isActive",{get:function(){return this.canEnable()?(this.activeModel||!1)&&this._mayPredict:(this._mayPredict=!1,!1)},enumerable:!1,configurable:!0}),e.prototype.canEnable=function(){return!!this.lmEngine},Object.defineProperty(e.prototype,"mayPredict",{get:function(){return this._mayPredict},set:function(t){if(!!this.canEnable()){var n=this._mayPredict;if(this._mayPredict=t,n!=t&&this.activeModel){var i=t?"active":"inactive";this._state=i,this.emit("statechange",i),t&&this.isConfigured&&(this._state="configured",this.emit("statechange","configured"))}}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mayCorrect",{get:function(){return this._mayCorrect},set:function(t){this._mayCorrect=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wordbreaksAfterSuggestions",{get:function(){return this.configuration.wordbreaksAfterSuggestions},enumerable:!1,configurable:!0}),e.prototype.tryAcceptSuggestion=function(t){return this.emit("tryaccept",t),!1},e.prototype.tryRevertSuggestion=function(){return this.emit("tryrevert"),!1},e}(V.default),Yn=Ls;var As=10,wn=function(){function c(){this.map=new Map}return c.prototype.get=function(e){var t=this.map.get(e);return t&&this.save(t),t},c.prototype.save=function(e){var t=e.token>=0?e.token:-e.token;this.map.delete(t),this.map.set(t,e),this.map.size>As&&this.map.delete(this.map.keys().next().value)},c}();var Ss=function(){function c(e,t,n){if(this.contextCache=new wn,!e)throw new Error("device must be defined");n||(n=c.DEFAULT_OPTIONS),this.contextDevice=e,this.kbdProcessor=new Xn(e,n),this.lngProcessor=new Yn(t,this.contextCache)}return Object.defineProperty(c.prototype,"languageProcessor",{get:function(){return this.lngProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"keyboardProcessor",{get:function(){return this.kbdProcessor},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"keyboardInterface",{get:function(){return this.keyboardProcessor.keyboardInterface},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"activeKeyboard",{get:function(){return this.keyboardInterface.activeKeyboard},set:function(e){this.keyboardInterface.activeKeyboard=e,this.resetContext()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"activeModel",{get:function(){return this.languageProcessor.activeModel},enumerable:!1,configurable:!0}),c.prototype.processKeyEvent=function(e,t){var n=e.srcKeyboard&&this.activeKeyboard!=e.srcKeyboard,i=this.activeKeyboard;try{if(n&&(this.keyboardInterface.activeKeyboard=e.srcKeyboard),e.baseTranscriptionToken){var r=this.contextCache.get(e.baseTranscriptionToken);r?(!wt(r.transform)||!r.preInput.isEqual(w.from(t)))&&t.restoreTo(r.preInput):console.warn("The base context for the multitap could not be found")}return this._processKeyEvent(e,t)}finally{n&&(this.keyboardInterface.activeKeyboard=i)}},c.prototype._processKeyEvent=function(e,t){var n,i=e.device.formFactor,r=e.isSynthetic;if((i==v.FormFactor.Desktop||!this.activeKeyboard||this.activeKeyboard.usesDesktopLayoutOnDevice(e.device))&&r&&this.keyboardProcessor.selectLayer(e))return new ut;if(this.keyboardProcessor.doModifierPress(e,t,!r)&&!r)return new ut;if(this.languageProcessor.isActive){if((e.kName=="K_BKSP"||e.Lcode==h.keyCodes.K_BKSP)&&this.languageProcessor.tryRevertSuggestion())return new ut;if((e.kName=="K_SPACE"||e.Lcode==h.keyCodes.K_SPACE)&&this.languageProcessor.tryAcceptSuggestion("space"))return new ut}var s=w.from(t,!0),l=this.keyboardProcessor.layerId,o=this.keyboardProcessor.processKeystroke(e,t);e.kNextLayer&&this.keyboardProcessor.selectLayer(e);var a=h.isFrameKey(e.kName);wt((n=o==null?void 0:o.transcription)===null||n===void 0?void 0:n.transform)&&e.kNextLayer&&(a=!0);var g=o!=null;if(g){var d=a?null:this.buildAlternates(o,e,s);o.finalize(this.keyboardProcessor,t,!1),d&&d.length>0&&(o.transcription.alternates=d)}else o=new ut,o.transcription=t.buildTranscriptionFrom(t,null,!1),o.triggersDefaultCommand=!0;this.contextCache.save(o.transcription);var B=o.setStore[Y.TSS_LAYER]||e.kNextLayer;this.keyboardProcessor.newLayerStore.set(B?this.keyboardProcessor.layerId:""),this.keyboardProcessor.oldLayerStore.set(B?l:"");var u=this.keyboardProcessor.processPostKeystroke(this.contextDevice,t);return u&&u.finalize(this.keyboardProcessor,t,!0),o.predictionPromise=this.languageProcessor.predict(o.transcription,this.keyboardProcessor.layerId),o.triggersDefaultCommand||t.doInputEvent(),g?o:null},c.prototype.buildAlternates=function(e,t,n){var i,r,s;if(this.languageProcessor.isActive&&!e.triggersDefaultCommand){var l=t.keyDistribution,o=new mt(n,mt.ENGINE_RULE_WINDOW,this.keyboardProcessor.layerId),a=o.toMock();if(this.languageProcessor.isActive&&l&&t.kbdLayer){var g=Number.MAX_VALUE,d=Ot(),B=void 0;d.performance&&d.performance.now&&(B=function(){return d.performance.now()},g=B()+16);var u=Math.exp(-5);l.sort(function(p,f){return f.p-p.p}),s=[];var y=0;try{for(var I=(0,Q.__values)(l),F=I.next();!F.done;F=I.next()){var U=F.value;if(U.p<u){y+=U.p;break}else if(B&&B()>=g)break;var b=w.from(a,!1),C=U.keySpec;if(!C){console.warn("Internal error:  failed to properly filter set of keys for corrections");continue}var X=this.keyboardProcessor.activeKeyboard.constructKeyEvent(C,t.device,this.keyboardProcessor.stateKeys),Z=this.keyboardProcessor.processKeystroke(X,b);if(Z&&!Z.beep&&U.p>0){var G=Z.transcription.transform;G.id=e.transcription.token,s.push({sample:G,p:U.p}),y+=U.p}}}catch(p){i={error:p}}finally{try{F&&!F.done&&(r=I.return)&&r.call(I)}finally{if(i)throw i.error}}s.forEach(function(p){p.p/=y})}}return s},c.prototype.resetContext=function(e){this.keyboardProcessor.resetContext(e),this.languageProcessor.invalidateContext(e,this.keyboardProcessor.layerId)},c.DEFAULT_OPTIONS={baseLayout:"us"},c}(),Dn=Ss;var Hs=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=c.call(this)||this;i.initNewContext=!0,i._currentSuggestions=[],i.recentAccept=!1,i.swallowPrediction=!1,i.doRevert=!1,i.recentRevert=!1,i.doTryAccept=function(s){!i.recentAccept&&i.selected?i.accept(i.selected):i.recentAccept&&s=="space"&&(i.recentAccept=!1)},i.doTryRevert=function(){i.doRevert?(i.doRevert=!1,i.recentAccept=!1):i.recentAccept&&(i.showRevert(),i.swallowPrediction=!0)},i.invalidateSuggestions=function(s){i.initNewContext=!1,(!i.swallowPrediction||s=="context")&&(i.recentAccept=!1,i.doRevert=!1,i.recentRevert=!1,s=="context"&&(i.swallowPrediction=!1,i.initNewContext=!0)),s!="new"&&i.clearSuggestions()},i.updateSuggestions=function(s){var l,o,a=s.suggestions;i._currentSuggestions=a,i.keepSuggestion=null;try{for(var g=(0,Q.__values)(a),d=g.next();!d.done;d=g.next()){var B=d.value;B.tag=="keep"&&(i.keepSuggestion=B)}}catch(u){l={error:u}}finally{try{d&&!d.done&&(o=g.return)&&o.call(g)}finally{if(l)throw l.error}}i.keepSuggestion&&i._currentSuggestions.splice(i._currentSuggestions.indexOf(i.keepSuggestion),1),i.swallowPrediction?i.swallowPrediction=!1:(i.recentAccept=!1,i.doRevert=!1,i.recentRevert=!1),i.sendUpdateEvent()},i.onModelStateChange=function(s){(s=="configured"||s=="inactive")&&i.resetContext()},i.langProcessor=t,i.kbdProcessor=n;var r=function(){return i.currentTarget&&t.state=="configured"};return i.suggestionApplier=function(s){return r()?t.applySuggestion(s,i.currentTarget,function(){return n.layerId}):null},i.suggestionReverter=function(s){r()&&t.applyReversion(s,i.currentTarget)},i.postApplicationHandler=function(){var s;n.newLayerStore.set(""),n.oldLayerStore.set(""),(s=n.processPostKeystroke(n.contextDevice,i.currentTarget))===null||s===void 0||s.finalize(n,i.currentTarget,!0)},i.connect(),i}return Object.defineProperty(e.prototype,"currentTarget",{get:function(){return this._currentTarget},enumerable:!1,configurable:!0}),e.prototype.setCurrentTarget=function(t){var n=this._currentTarget;return this._currentTarget=t,n!=t?this.resetContext():Promise.resolve([])},Object.defineProperty(e.prototype,"modelState",{get:function(){return this.langProcessor.state},enumerable:!1,configurable:!0}),e.prototype.connect=function(){this.langProcessor.addListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.addListener("suggestionsready",this.updateSuggestions),this.langProcessor.addListener("tryaccept",this.doTryAccept),this.langProcessor.addListener("tryrevert",this.doTryRevert),this.langProcessor.addListener("statechange",this.onModelStateChange),this.langProcessor.addListener("suggestionapplied",this.postApplicationHandler)},e.prototype.disconnect=function(){this.langProcessor.removeListener("invalidatesuggestions",this.invalidateSuggestions),this.langProcessor.removeListener("suggestionsready",this.updateSuggestions),this.langProcessor.removeListener("tryaccept",this.doTryAccept),this.langProcessor.removeListener("tryrevert",this.doTryRevert),this.langProcessor.removeListener("statechange",this.onModelStateChange),this.langProcessor.removeListener("suggestionapplied",this.postApplicationHandler),this.clearSuggestions()},Object.defineProperty(e.prototype,"currentSuggestions",{get:function(){var t=[];return this.activateKeep()&&this.keepSuggestion&&this.keepSuggestion.matchesModel?t.push(this.keepSuggestion):this.doRevert&&t.push(this.revertSuggestion),t.concat(this._currentSuggestions)},enumerable:!1,configurable:!0}),e.prototype.acceptInternal=function(t){return t?t.tag=="revert"?(this.suggestionReverter(t),null):this.suggestionApplier(t):null},e.prototype.accept=function(t){var n=this;return this.selected=null,this.doRevert=!1,this.revertAcceptancePromise=this.acceptInternal(t),this.revertAcceptancePromise?(this.revertAcceptancePromise.then(function(i){i&&(n.revertSuggestion=i)}),this.recentAccept=!0,this.recentRevert=!1,this.swallowPrediction=!0,this.revertAcceptancePromise):(t&&t.tag=="revert"&&(this.recentAccept=!1,this.recentRevert=!0),Promise.resolve(null))},e.prototype.showRevert=function(){this.doRevert=!0,this.sendUpdateEvent()},e.prototype.clearSuggestions=function(){this.updateSuggestions({suggestions:[],transcriptionID:0})},e.prototype.activateKeep=function(){return!this.recentAccept&&!this.recentRevert&&!this.initNewContext},e.prototype.sendUpdateEvent=function(){this.emit("update",this.currentSuggestions)},e.prototype.resetContext=function(){var t=this.currentTarget;return t?this.langProcessor.invalidateContext(t,this.kbdProcessor.layerId):Promise.resolve([])},e}(V.default),Mn=Hs;var sc=function(){function c(e,t,n,i){this.Pelem=e,this.Peventname=t.toLowerCase(),this.Phandler=n,this.PuseCapture=i}return c.prototype.equals=function(e){return this.Pelem==e.Pelem&&this.Peventname==e.Peventname&&this.Phandler==e.Phandler&&this.PuseCapture==e.PuseCapture},c}(),Zt=function(){function c(){this.domEvents=[]}return c.prototype.attachDOMEvent=function(e,t,n,i){this.detachDOMEvent(e,t,n,i),e.addEventListener(t,n,!!i);var r=new sc(e,t,n,i);this.domEvents.push(r)},c.prototype.detachDOMEvent=function(e,t,n,i){e.removeEventListener(t,n,i);for(var r=new sc(e,t,n,i),s=0;s<this.domEvents.length;s++)if(this.domEvents[s].equals(r)){this.domEvents.splice(s,1);break}},c.prototype.shutdown=function(){for(var e=0,t=this.domEvents;e<t.length;e++){var n=t[e];this.detachDOMEvent(n.Pelem,n.Peventname,n.Phandler,n.PuseCapture)}},c}();var Ee=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this)||this;return t instanceof V.default?(t.on=n.listenerRegistrationSpy("listeneradded",t,t.on),t.addListener=n.listenerRegistrationSpy("listeneradded",t,t.addListener),t.off=n.listenerRegistrationSpy("listenerremoved",t,t.off),t.removeListener=n.listenerRegistrationSpy("listenerremoved",t,t.off)):(t.addEventListener=n.listenerRegistrationSpy("listeneradded",t,t.addEventListener),t.removeEventListener=n.listenerRegistrationSpy("listenerremoved",t,t.removeEventListener)),n}return e.prototype.listenerRegistrationSpy=function(t,n,i){var r=this;return function(s,l){var o=i.apply(n,[s,l]);return r.emit(t,s),o}},e}(V.default);var ke=function(){function c(){this.events={},this.currentEvents=[]}return c.prototype.addEventListener=function(e,t){return this._removeEventListener(e,t),this.events[e].push(t),!0},c.prototype.removeEventListener=function(e,t){return this._removeEventListener(e,t)},c.prototype._removeEventListener=function(e,t){typeof this.events[e]=="undefined"&&(this.events[e]=[]);for(var n=0;n<this.events[e].length;n++)if(this.events[e][n]==t)return this.events[e].splice(n,1),!0;return!1},c.prototype.callEvent=function(e,t){if(typeof this.events[e]=="undefined")return!0;if(this.currentEvents.indexOf(e)!=-1)return!1;this.currentEvents.push(e);for(var n=0;n<this.events[e].length;n++){var i=this.events[e][n],r=!1;try{r=i(t)}catch(s){console.error(s),r=!1}if(r===!1)return this.currentEvents.pop(),!1}return this.currentEvents.pop(),!0},c.prototype.listenerCount=function(e){var t=this.events[e];return t?t.length:0},c.prototype.shutdown=function(){this.events={}},c}();var Ws=function(){function c(e){e===void 0&&(e=!1),this.fileLocal=e}return c.prototype.request=function(e){var t=new A,n=window.setTimeout(function(){t.reject(new Error(_i))},1e4),i="&timerid="+n,r=e+i,s=document.createElement("script");s.onload=function(l){window.clearTimeout(n),t.isResolved||t.reject(new Error(Pi))},s.onerror=function(l,o,a,g,d){window.clearTimeout(n);var B=Ln;d&&(B=B+": "+d.message),t.reject(new Error(B))},this.fileLocal?s.src=e:s.src=r;try{document.body.appendChild(s)}catch(l){document.getElementsByTagName("head")[0].appendChild(s)}return t.finally(function(){clearTimeout(n)}),{promise:t,queryId:n}},c}(),lc=Ws;function Ns(){return typeof window.KeymanWeb_BaseLayout!="undefined"?window.KeymanWeb_BaseLayout:"us"}var Es=function(){function c(e,t,n,i){var r=this;this.legacyAPIEvents=new ke,this.keyEventListener=function(l,o){var a,g=r.contextManager.activeTarget;if(!r.contextManager.activeKeyboard||!g){o&&o(null,null);return}if(r.keyEventRefocus&&r.keyEventRefocus(),g.invalidateSelection(),g.deadkeys().deleteMatched(),l.isSynthetic){var d=r.osk.vkbd.layerId;d&&d!=r.core.keyboardProcessor.layerId&&(r.core.keyboardProcessor.layerId=d)}var B=r.core.processKeyEvent(l,g);B&&((a=B.transcription)===null||a===void 0?void 0:a.transform)&&r.config.onRuleFinalization(B,r.contextManager.activeTarget),o&&o(B,null)},this.config=t,this.contextManager=n;var s=i(this);s.baseLayout=Ns(),this.interface=s.keyboardInterface,this.core=new Dn(t.hostDevice,e,s),this.core.languageProcessor.on("statechange",function(l){var o,a;(o=r.osk)===null||o===void 0||o.bannerController.selectBanner(l),(a=r.osk)===null||a===void 0||a.refreshLayout()}),this.core.keyboardProcessor.on("statekeychange",function(l){var o,a;(a=(o=r.osk)===null||o===void 0?void 0:o.vkbd)===null||a===void 0||a.updateStateKeys(l)}),this.contextManager.on("beforekeyboardchange",function(l){r.legacyAPIEvents.callEvent("beforekeyboardchange",{internalName:l==null?void 0:l.id,languageCode:l==null?void 0:l.langId})}),this.contextManager.on("keyboardchange",function(l){l||r.osk.startHide(!1);var o=function(){var a,g;r.refreshModel(),r.core.activeKeyboard=l==null?void 0:l.keyboard,r.legacyAPIEvents.callEvent("keyboardchange",{internalName:(a=l==null?void 0:l.metadata.id)!==null&&a!==void 0?a:"",languageCode:(g=l==null?void 0:l.metadata.langId)!==null&&g!==void 0?g:""})};r.osk?r.osk.batchLayoutAfter(function(){o(),r.osk.activeKeyboard=l,r.contextManager.resetContext(),r.osk.present()}):(o(),r.contextManager.resetContext())}),this.contextManager.on("keyboardasyncload",function(l){var o,a;r.config.hostDevice.touchable&&((o=r.osk)===null||o===void 0?void 0:o.activationModel)&&(r.osk.activationModel.enabled=!0),(a=r.osk)===null||a===void 0||a.startHide(!1)})}return c.prototype.init=function(e){return(0,Q.__awaiter)(this,void 0,void 0,function(){var t,n,i,r=this;return(0,Q.__generator)(this,function(s){return t=this.config,t.deferForInitialization.isResolved?[2,Promise.resolve()]:(t.initialize(e),String.kmwEnableSupplementaryPlane(!0),n=new ec(this.interface,t.applyCacheBusting),this.keyboardRequisitioner=new Hn(n,new lc,this.config.paths),this.modelCache=new Wn,i=this.keyboardRequisitioner.cache,this.contextManager.configure({resetContext:function(l){r.osk?r.osk.batchLayoutAfter(function(){r.core.resetContext(l)}):r.core.resetContext(l)},predictionContext:new Mn(this.core.languageProcessor,this.core.keyboardProcessor),keyboardCache:this.keyboardRequisitioner.cache}),this.config.on("spacebartext",function(){var l;(l=r.osk)===null||l===void 0||l.refreshLayout()}),i.on("stubadded",function(l){var o=function(){r.legacyAPIEvents.callEvent("keyboardregistered",{internalName:l.KI,language:l.KL,keyboardName:l.KN,languageCode:l.KLC,package:l.KP}),r.config.activateFirstKeyboard&&r.keyboardRequisitioner.cache.defaultStub==l&&r.contextManager.activateKeyboard(l.id,l.langId,!0)};r.config.deferForInitialization.isResolved?o():r.config.deferForInitialization.then(o)}),i.on("keyboardadded",function(l){var o=function(){r.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:l.id})};r.config.deferForInitialization.isResolved?o():r.config.deferForInitialization.then(o)}),this.keyboardRequisitioner.cache.on("keyboardadded",function(l){r.legacyAPIEvents.callEvent("keyboardloaded",{keyboardName:l.id})}),[2])})})},Object.defineProperty(c.prototype,"build",{get:function(){return Number.parseInt(Lt.VERSION_PATCH,10)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"version",{get:function(){return Lt.VERSION_RELEASE},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"hardKeyboard",{get:function(){return this._hardKeyboard},set:function(e){this._hardKeyboard&&this._hardKeyboard.off("keyevent",this.keyEventListener),this._hardKeyboard=e,e.on("keyevent",this.keyEventListener)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"osk",{get:function(){return this._osk},set:function(e){this._osk&&(this._osk.off("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=this.osk.layerChangeHandler),this._osk=e,e&&(this.contextManager.activeKeyboard&&(e.activeKeyboard=this.contextManager.activeKeyboard),e.on("keyevent",this.keyEventListener),this.core.keyboardProcessor.layerStore.handler=e.layerChangeHandler)},enumerable:!1,configurable:!0}),c.prototype.getDebugInfo=function(){var e,t,n,i,r,s,l,o,a,g,d,B,u,y,I=(e=this.contextManager)===null||e===void 0?void 0:e.activeKeyboard,F={configReport:(t=this.config)===null||t===void 0?void 0:t.debugReport(),keyboard:{id:pt((i=(n=I==null?void 0:I.metadata)===null||n===void 0?void 0:n.id)!==null&&i!==void 0?i:""),langId:((r=I==null?void 0:I.metadata)===null||r===void 0?void 0:r.langId)||"",version:(l=(s=I==null?void 0:I.keyboard)===null||s===void 0?void 0:s.version)!==null&&l!==void 0?l:""},model:{id:((a=(o=this.core)===null||o===void 0?void 0:o.activeModel)===null||a===void 0?void 0:a.id)||""},osk:{banner:(B=(d=(g=this.osk)===null||g===void 0?void 0:g.banner)===null||d===void 0?void 0:d.banner.type)!==null&&B!==void 0?B:"",layer:((y=(u=this.osk)===null||u===void 0?void 0:u.vkbd)===null||y===void 0?void 0:y.layerId)||""}};return F},c.prototype.refreshModel=function(){var e=this.contextManager.activeKeyboard,t=this.modelCache.modelForLanguage(e==null?void 0:e.metadata.langId);return this.core.activeModel!=t&&(this.core.activeModel&&this.core.languageProcessor.unloadModel(),t)?this.core.languageProcessor.loadModel(t).then(function(){return t}):Promise.resolve(t)},c.prototype.addEventListener=function(e,t){this.legacyAPIEvents.addEventListener(e,t)},c.prototype.removeEventListener=function(e,t){this.legacyAPIEvents.removeEventListener(e,t)},c.prototype.shutdown=function(){var e;this.legacyAPIEvents.shutdown(),(e=this.osk)===null||e===void 0||e.shutdown()},c.prototype.addModel=function(e){var t;this.modelCache.register(e);var n=(t=this.contextManager.activeKeyboard)===null||t===void 0?void 0:t.metadata;return n&&e.languages.indexOf(n.langId)!=-1?this.refreshModel().then(function(){}):Promise.resolve()},c.prototype.removeModel=function(e){this.modelCache.unregister(e),this.core.activeModel&&this.core.activeModel.id==e&&this.core.languageProcessor.unloadModel()},c.prototype.setActiveKeyboard=function(e,t){return(0,Q.__awaiter)(this,void 0,void 0,function(){return(0,Q.__generator)(this,function(n){return[2,this.contextManager.activateKeyboard(e,t,!0)]})})},c.prototype.getActiveKeyboard=function(){var e,t;return(t=(e=this.contextManager.activeKeyboard)===null||e===void 0?void 0:e.metadata.id)!==null&&t!==void 0?t:""},c.prototype.getActiveLanguage=function(e){var t,n,i,r=(t=this.contextManager.activeKeyboard)===null||t===void 0?void 0:t.metadata;return e?(i=r==null?void 0:r.langName)!==null&&i!==void 0?i:"":(n=r==null?void 0:r.langId)!==null&&n!==void 0?n:""},c.prototype.isChiral=function(e){var t;if(e){if(typeof e=="string"){var n=this.keyboardRequisitioner.cache.getKeyboard(e);if(n)e=n;else throw new Error("Keyboard '".concat(e,"' has not been loaded."))}t=e}else t=this.core.activeKeyboard;return t.isChiral},c.prototype.resetContext=function(){this.contextManager.resetContext()},c.prototype.setNumericLayer=function(){this.core.keyboardProcessor.setNumericLayer(this.config.softDevice)},c}(),zn=Es;var It=function(){function c(e){var t=E("div");t.id=c.BANNER_ID,t.className=c.BANNER_CLASS,this.div=t,this.height=e,this.update()}return Object.defineProperty(c.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e>0?e:0,this.update()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e,this.update()},enumerable:!1,configurable:!0}),c.prototype.update=function(){var e=this.div.style,t=e.height,n=e.display;return this._height>0?(e.height=this._height+"px",e.display="block"):(e.height="0px",e.display="none"),t!==e.height||n!==e.display},c.prototype.appendStyleSheet=function(){},c.prototype.getDiv=function(){return this.div},c.prototype.configureForKeyboard=function(e,t){},c.prototype.shutdown=function(){},c.DEFAULT_HEIGHT=37,c.BANNER_CLASS="kmw-banner-bar",c.BANNER_ID="kmw-banner-bar",c}();var J=function(){function c(e){var t=typeof e=="string"?c.parseLengthStyle(e):e;this.val=t.val,this.absolute=t.absolute,t.special&&(this.special=t.special)}return Object.defineProperty(c.prototype,"styleString",{get:function(){return this.absolute?this.val+"px":this.special?this.val+this.special:this.val*100+"%"},enumerable:!1,configurable:!0}),c.prototype.scaledBy=function(e){return new c({val:e*this.val,absolute:this.absolute})},c.inPixels=function(e){return new c({val:e,absolute:!0})},c.inPercent=function(e){return new c({val:e/100,absolute:!1})},c.forScalar=function(e){return new c({val:e,absolute:!1})},c.special=function(e,t){return new c({val:e,absolute:!1,special:t})},c.parseLengthStyle=function(e){if(e=="")return oc;var t=parseFloat(e);return isNaN(t)?(console.error("Could not properly parse specified length style info: '"+e+"'."),oc):e.indexOf("px")!=-1?{val:t,absolute:!0}:e.indexOf("pt")!=-1?{val:4*t/3,absolute:!0}:e.indexOf("%")!=-1?{val:t/100,absolute:!1}:e.indexOf("rem")!=-1?{val:t,absolute:!1,special:"rem"}:e.indexOf("em")!=-1?{val:t,absolute:!1,special:"em"}:{val:4*t/3,absolute:!0}},c}();var oc=new J("1em");var Pt=function(c){(0,Q.__extends)(e,c);function e(){var t=c.call(this,0)||this;return t.type="blank",t}return e}(It);var ac=function(){function c(){this._activeBannerHeight=It.DEFAULT_HEIGHT,this.events=new V.default,this.constructContainer()}return c.prototype.constructContainer=function(){var e=E("div");return e.id="keymanweb_banner_container",e.className="kmw-banner-container",this.bannerContainer=e},Object.defineProperty(c.prototype,"element",{get:function(){return this.bannerContainer},enumerable:!1,configurable:!0}),c.prototype.appendStyles=function(){this.currentBanner&&this.currentBanner.appendStyleSheet()},Object.defineProperty(c.prototype,"banner",{get:function(){return this.currentBanner},set:function(e){if(this.currentBanner){if(e==this.currentBanner)return;var t=this.currentBanner;this.currentBanner=e,this.bannerContainer.replaceChild(e.getDiv(),t.getDiv()),t.shutdown()}else this.currentBanner=e,e&&this.bannerContainer.appendChild(e.getDiv());e instanceof Pt||(e.height=this.activeBannerHeight),this.events.emit("bannerchange")},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"height",{get:function(){return this.currentBanner?this.currentBanner.height:0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"activeBannerHeight",{get:function(){return this._activeBannerHeight},set:function(e){this._activeBannerHeight=e,this.currentBanner&&!(this.currentBanner instanceof Pt)&&(this.currentBanner.height=e)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"layoutHeight",{get:function(){return J.inPixels(this.height)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"width",{get:function(){var e;return(e=this.currentBanner)===null||e===void 0?void 0:e.width},set:function(e){this.currentBanner&&(this.currentBanner.width=e)},enumerable:!1,configurable:!0}),c.prototype.refreshLayout=function(){var e,t;(t=(e=this.currentBanner).refreshLayout)===null||t===void 0||t.call(e)},c}();var gc=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=this;t.length>0?(i=c.call(this)||this,n&&(i.height=n)):i=c.call(this,0)||this,i.type="image",t.indexOf("base64")>=0?console.log("Loading img from base64 data"):console.log("Loading img with src '"+t+"'"),i.img=document.createElement("img"),i.img.setAttribute("src",t);var r=i.img.style;return r.width="100%",r.height="100%",i.getDiv().appendChild(i.img),console.log("Image loaded."),i}return e.prototype.setImagePath=function(t){this.img&&this.img.setAttribute("src",t)},e}(It);function xt(c,e){e instanceof Error?console.error("".concat(c,": ").concat(e.message,"\n\n").concat(e.stack)):(console.error(c),console.error(e))}var dc=function(){function c(e){this.queue=[],this.defaultWaitFactory=e||function(){return Qt(0)}}return Object.defineProperty(c.prototype,"defaultWait",{get:function(){return this.defaultWaitFactory()},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"ready",{get:function(){return this.queue.length==0&&!this.waitLock},enumerable:!1,configurable:!0}),c.prototype.triggerNextClosure=function(){return(0,Q.__awaiter)(this,void 0,void 0,function(){var e,t,n;return(0,Q.__generator)(this,function(i){switch(i.label){case 0:if(this.queue.length==0)return[2];e=this.queue.shift(),this.waitLock=Promise.resolve();try{t=e()}catch(r){xt("Error from queued closure",r)}t=t!=null?t:this.defaultWaitFactory(),this.waitLock=t,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t];case 2:return i.sent(),[3,4];case 3:return n=i.sent(),xt("Async error from queued closure",n),[3,4];case 4:return this.waitLock=null,this.triggerNextClosure(),[2]}})})},c.prototype.runAsync=function(e){var t=this.ready;this.queue.push(e),t&&this.triggerNextClosure()},c}();function Qc(c){return"targetX"in c&&"targetY"in c&&"t"in c}var Ht=function(){function c(e){if(this.rawLinearSums={x:0,y:0,t:0},this.coordArcSum=0,this._sampleCount=0,!!e)if(e instanceof c)Object.assign(this,e),this.rawLinearSums=(0,Q.__assign)({},e.rawLinearSums);else if(Qc(e))Object.assign(this,this.extend(e));else throw new Error("A constructor for this input pattern has not yet been implemented")}return c.prototype.extend=function(e){return this._extend(new c(this),e)},c.prototype._extend=function(e,t){e._initialSample||(e._initialSample=t,e.baseSample=t);var n=e.baseSample;this.followingSample=t;var i=t.targetX-n.targetX,r=t.targetY-n.targetY,s=t.t-n.t;if(e.rawLinearSums.x+=i,e.rawLinearSums.y+=r,e.rawLinearSums.t+=s,this.lastSample){var l=t.targetX-this.lastSample.targetX,o=t.targetY-this.lastSample.targetY,a=l*l+o*o,g=Math.sqrt(a);e.coordArcSum+=g}return e._lastSample=t,e.sampleCount=this.sampleCount+1,e},c.prototype.deaccumulate=function(e){var t=new c(this);return this._deaccumulate(t,e)},c.prototype._deaccumulate=function(e,t){if(!t)return e;if(!t.followingSample||!t.lastSample)throw"Invalid argument:  stats missing necessary tracking variable.";for(var n in e.rawLinearSums){var i=n;e.rawLinearSums[i]-=t.rawLinearSums[i]}if(t.followingSample&&t.lastSample){var r=t.followingSample.targetX-t.lastSample.targetX,s=t.followingSample.targetY-t.lastSample.targetY,l=r*r+s*s,o=Math.sqrt(l);e.coordArcSum-=o,e.coordArcSum-=t.coordArcSum}return e.sampleCount-=t.sampleCount,e._initialSample=t.followingSample,e},c.prototype.translateCoordSystem=function(e){var t=new c(this);return this._translateCoordSystem(t,e)},c.prototype._translateCoordSystem=function(e,t){if(this.sampleCount==0)return e;var n=e.initialSample==e.lastSample;return e._initialSample=t(e.initialSample),e.baseSample=t(e.baseSample),e._lastSample=n?e._initialSample:t(e.lastSample),e},c.prototype.replaceInitialSample=function(e){var t=new c(this);return this._replaceInitialSample(t,e)},c.prototype._replaceInitialSample=function(e,t){if(this.sampleCount==0)throw new Error("no sample available to replace");var n=e.initialSample;if(e._initialSample=t,this.sampleCount>1){var i=t.targetX-n.targetX,r=t.targetY-n.targetY,s=t.t-n.t;e.rawLinearSums.x+=i,e.rawLinearSums.y+=r,e.rawLinearSums.t+=s;var l=i*i+r*r,o=Math.sqrt(l);e.coordArcSum+=o}else e._lastSample=t;return e},Object.defineProperty(c.prototype,"lastSample",{get:function(){return this._lastSample},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastTimestamp",{get:function(){var e;return(e=this.lastSample)===null||e===void 0?void 0:e.t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"sampleCount",{get:function(){return this._sampleCount},set:function(e){this._sampleCount=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"initialSample",{get:function(){return this._initialSample},enumerable:!1,configurable:!0}),c.prototype.mappingConstant=function(e){if(!!this.baseSample)return e=="t"?this.baseSample.t:e=="x"?this.baseSample.targetX:e=="y"?this.baseSample.targetY:0},c.prototype.mean=function(e){return this.rawLinearSums[e]/this.sampleCount+this.mappingConstant(e)},Object.defineProperty(c.prototype,"netDistance",{get:function(){if(!this.lastSample||!this.initialSample)return 0;var e=this.lastSample.targetX-this.initialSample.targetX,t=this.lastSample.targetY-this.initialSample.targetY;return Math.sqrt(e*e+t*t)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"duration",{get:function(){return!this.lastSample||!this.initialSample?0:this.lastSample.t-this.initialSample.t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"angle",{get:function(){if(!(this.sampleCount==1||!this.lastSample||!this.initialSample)&&!(this.netDistance<1)){var e=this.lastSample.targetX-this.initialSample.targetX,t=this.lastSample.targetY-this.initialSample.targetY,n=Math.acos(-t/this.netDistance);return e<0?2*Math.PI-n:n}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"angleInDegrees",{get:function(){return this.angle*180/Math.PI},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"cardinalDirection",{get:function(){if(!(this.sampleCount==1||!this.lastSample||!this.initialSample)&&!(isNaN(this.angle)||this.angle===null||this.angle===void 0)){var e=["n","ne","e","se","s","sw","w","nw","n"],t=Math.ceil((this.angleInDegrees-22.5)/45);return e[t]}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"speed",{get:function(){return this.duration?this.netDistance/this.duration:0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"rawDistance",{get:function(){return this.coordArcSum},enumerable:!1,configurable:!0}),c.prototype.toJSON=function(){return{angle:this.angle,cardinal:this.cardinalDirection,netDistance:this.netDistance,duration:this.duration,sampleCount:this.sampleCount,rawDistance:this.rawDistance}},c}();var Bc=function(){function c(){}return c.prototype.getBoundingClientRect=function(){return new DOMRect(0,0,Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),Math.max(document.documentElement.clientHeight||0,window.innerHeight||0))},c}();var Ut=function(){function c(e,t){Array.isArray(e)&&(t=e,e=new Bc),this.root=e,t=t||[0,0,0,0],this.updatePadding(t)}return Object.defineProperty(c.prototype,"edgePadding",{get:function(){return this._edgePadding},enumerable:!1,configurable:!0}),c.prototype.updatePadding=function(e){switch(e.length){case 1:var t=e[0];this._edgePadding={x:t,y:t,w:2*t,h:2*t};break;case 2:this._edgePadding={x:e[1],y:e[0],w:2*e[1],h:2*e[0]};break;case 3:this._edgePadding={x:e[1],y:e[0],w:2*e[1],h:e[0]+e[2]};break;case 4:this._edgePadding={x:e[3],y:e[0],w:e[1]+e[3],h:e[0]+e[2]};break;default:throw new Error("Invalid values for PaddedZoneSource's edgePadding - must be between 1 to 4 `number` values.")}},c.prototype.getBoundingClientRect=function(){var e=this.root.getBoundingClientRect();return new DOMRect(e.left+this.edgePadding.x,e.top+this.edgePadding.y,e.width-this.edgePadding.w,e.height-this.edgePadding.h)},c}();function Te(c){var e,t,n,i,r,s,l,o=(0,Q.__assign)({},c);if(o.mouseEventRoot=(e=o.mouseEventRoot)!==null&&e!==void 0?e:o.targetRoot,o.touchEventRoot=(t=o.touchEventRoot)!==null&&t!==void 0?t:o.targetRoot,o.inputStartBounds=(n=o.inputStartBounds)!==null&&n!==void 0?n:o.targetRoot,o.maxRoamingBounds=(i=o.maxRoamingBounds)!==null&&i!==void 0?i:o.targetRoot,o.safeBounds=(r=o.safeBounds)!==null&&r!==void 0?r:new Ut([2]),o.itemIdentifier=(s=o.itemIdentifier)!==null&&s!==void 0?s:function(){return null},o.recordingMode=!!o.recordingMode,o.historyLength=((l=o.historyLength)!==null&&l!==void 0?l:0)>0?o.historyLength:0,c.paddedSafeBounds)delete o.safeBoundPadding;else{var a=c.safeBoundPadding;typeof a=="number"&&(a=[a]),a=a!=null?a:[3],o.paddedSafeBounds=new Ut(o.safeBounds,a)}return o}var Ye=function(c){(0,Q.__extends)(e,c);function e(){var t=c.call(this)||this;return t._isComplete=!1,t._stats=new Ht,t}return Object.defineProperty(e.prototype,"stats",{get:function(){return this._stats},enumerable:!1,configurable:!0}),e.prototype.clone=function(){var t=new e;return t._isComplete=this._isComplete,t._wasCancelled=this._wasCancelled,t._stats=new Ht(this._stats),t},Object.defineProperty(e.prototype,"isComplete",{get:function(){return this._isComplete},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wasCancelled",{get:function(){return this._wasCancelled},enumerable:!1,configurable:!0}),e.prototype.translateCoordSystem=function(t){this._stats=this._stats.translateCoordSystem(t)},e.prototype.replaceInitialSample=function(t){this._stats=this._stats.replaceInitialSample(t)},e.prototype.extend=function(t){if(this._isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this._stats=this._stats.extend(t),this.emit("step",t)},e.prototype.terminate=function(t){t===void 0&&(t=!1),!this._isComplete&&(this._wasCancelled=t,this._isComplete=!0,t?this.emit("invalidated"):this.emit("complete"),this.removeAllListeners())},e.prototype.toJSON=function(){return{stats:this.stats,wasCancelled:this.wasCancelled}},e}(V.default);var jt=function(c){(0,Q.__extends)(e,c);function e(){var t=c!==null&&c.apply(this,arguments)||this;return t.samples=[],t}return e.prototype.clone=function(){var t=new e;return t.samples=[].concat(this.samples),t._isComplete=this._isComplete,t._wasCancelled=this._wasCancelled,t._stats=new Ht(this._stats),t},e.deserialize=function(t){var n=new e;n.samples=[].concat(t.coords.map(function(r){return(0,Q.__assign)({},r)})),n._isComplete=!0,n._wasCancelled=t.wasCancelled;var i=n.samples.reduce(function(r,s){return r.extend(s)},new Ht);return n._stats=i,n},e.prototype.extend=function(t){if(this.isComplete)throw new Error("Invalid state:  this GesturePath has already terminated.");this.samples.push(t),c.prototype.extend.call(this,t)},e.prototype.translateCoordSystem=function(t){c.prototype.translateCoordSystem.call(this,t);for(var n=0;n<this.samples.length;n++)this.samples[n]=t(this.samples[n])},Object.defineProperty(e.prototype,"coords",{get:function(){return this.samples},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){for(var t={coords:[].concat(this.samples.map(function(s){return{targetX:s.targetX,targetY:s.targetY,t:s.t,item:s.item}})),wasCancelled:this.wasCancelled,stats:this.stats},n=0,i=t.coords;n<i.length;n++){var r=i[n];delete r.clientX,delete r.clientY,r.item===void 0&&delete r.item}return t},e}(Ye);var Gt=function(){function c(e,t,n,i){this.stateToken=null,this.rawIdentifier=e,this.isFromTouch=n,this._path=i?new i:new Ye,this.recognizerConfigStack=Array.isArray(t)?t:[t]}return Object.defineProperty(c.prototype,"path",{get:function(){return this._path},enumerable:!1,configurable:!0}),c.prototype.setGestureMatchInspector=function(e){if(this._matchInspectionClosure)throw new Error("Invalid state:  the match-inspection closure has already been set");this._matchInspectionClosure=e},c.prototype.update=function(e){this.path.extend(e),this._baseItem||(this._baseItem=e.item)},Object.defineProperty(c.prototype,"baseItem",{get:function(){return this._baseItem},set:function(e){this._baseItem=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"currentSample",{get:function(){return this.path.stats.lastSample},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"potentialModelMatchIds",{get:function(){return this._matchInspectionClosure(this)},enumerable:!1,configurable:!0}),c.prototype.constructSubview=function(e,t,n){return new st(this,this.recognizerConfigStack,e,t,n)},c.prototype.terminate=function(e){this.path.terminate(e)},Object.defineProperty(c.prototype,"isPathComplete",{get:function(){return this.path.isComplete},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"identifier",{get:function(){var e=this.isFromTouch?"touch":"mouse";return"".concat(e,":").concat(this.rawIdentifier)},enumerable:!1,configurable:!0}),c.prototype.pushRecognizerConfig=function(e){var t=(0,Q.__assign)((0,Q.__assign)({},e),{mouseEventRoot:this.recognizerConfigStack[0].mouseEventRoot,touchEventRoot:this.recognizerConfigStack[0].touchEventRoot});this.recognizerConfigStack.push(Te(t))},c.prototype.popRecognizerConfig=function(){if(this.recognizerConfigStack.length==1)throw new Error("Cannot 'pop' the original recognizer-configuration for this GestureSource.");return this.recognizerConfigStack.pop()},Object.defineProperty(c.prototype,"currentRecognizerConfig",{get:function(){return this.recognizerConfigStack[this.recognizerConfigStack.length-1]},enumerable:!1,configurable:!0}),c.prototype.toJSON=function(){var e={identifier:this.identifier,isFromTouch:this.isFromTouch,path:this.path.toJSON(),stateToken:this.stateToken};return e},c}();var st=function(c){(0,Q.__extends)(e,c);function e(t,n,i,r,s){var l=this,o=0,a=t.path.stats.sampleCount;t instanceof e&&(o=t._baseStartIndex),l=c.call(this,t.rawIdentifier,n,t.isFromTouch,Object.getPrototypeOf(t.path).constructor)||this;var g=l._baseSource=t instanceof e?t._baseSource:t;l.stateToken=s!=null?s:t.stateToken;var d=function(F){var U=l.recognizerTranslation,b=(0,Q.__assign)((0,Q.__assign)({},F),{targetX:F.targetX-U.x,targetY:F.targetY-U.y});return l.stateToken&&(b.stateToken=l.stateToken),(l.stateToken!=g.stateToken||l.stateToken!=t.stateToken)&&(b.item=l.currentRecognizerConfig.itemIdentifier(b,null)),b},B=t.path.stats.lastSample;i?(l._baseStartIndex=o=Math.max(o+a-1,0),a=a>0?1:0):l._baseStartIndex=o,i?t.path.stats.sampleCount&&l._path.extend(t.path.stats.lastSample):l._path=t.path.clone(),l._path.translateCoordSystem(d),r?l._baseItem=t.baseItem:l._baseItem=B==null?void 0:B.item;var u=function(){return l.path.terminate(!1)},y=function(){return l.path.terminate(!0)},I=function(F){c.prototype.update.call(l,d(F))};return g.path.on("complete",u),g.path.on("invalidated",y),g.path.on("step",I),l.subviewDisconnector=function(){g.path.off("complete",u),g.path.off("invalidated",y),g.path.off("step",I)},g.isPathComplete&&(l.path.terminate(g.path.wasCancelled),l.disconnect()),l}return Object.defineProperty(e.prototype,"recognizerTranslation",{get:function(){if(this.recognizerConfigStack.length==1||!this.currentRecognizerConfig)return{x:0,y:0};var t=this.currentRecognizerConfig,n=t.targetRoot.getBoundingClientRect(),i=this.recognizerConfigStack[0].targetRoot.getBoundingClientRect();return{x:n.left-i.left,y:n.top-i.top}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"baseSource",{get:function(){return this._baseSource},enumerable:!1,configurable:!0}),e.prototype.disconnect=function(){this.subviewDisconnector&&(this.subviewDisconnector(),this.subviewDisconnector=null)},e.prototype.pushRecognizerConfig=function(t){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")},e.prototype.popRecognizerConfig=function(){throw new Error("Pushing and popping of recognizer configurations should only be called on the base GestureSource")},e.prototype.update=function(t){throw new Error("Updates should be provided through the base GestureSource.")},e.prototype.terminate=function(t){this.baseSource.terminate(t)},e}(Gt);var uc=function(c){(0,Q.__extends)(e,c);function e(t,n,i){var r=c.call(this,t,n,i,jt)||this;return r.stateToken=null,r}return e.prototype.initPath=function(){return new jt},e.deserialize=function(t,n){var i=n!==void 0?n:this._jsonIdSeed++,r=t.isFromTouch,s=jt.deserialize(t.path),l=new e(i,null,r);return l._path=s,l},e}(Gt);var Fc=function(c){(0,Q.__extends)(e,c);function e(t){var n,i=c.call(this)||this;return i._activeTouchpoints=[],i.identifierMap={},i.config=t,i.sourceConstructor=!((n=t==null?void 0:t.recordingMode)!==null&&n!==void 0)||n?uc:Gt,i}return e.prototype.createTouchpoint=function(t,n){var i=e.IDENTIFIER_SEED++;this.identifierMap[t]=i;var r=new this.sourceConstructor(i,this.config,n);return r.stateToken=this.stateToken,r},e.prototype.fulfillInputStart=function(t){},e.prototype.maintainTouchpoints=function(t){t||(t=[]),this._activeTouchpoints.filter(function(n){return!t.includes(n)}).forEach(function(n){return n.terminate(!0)})},e.prototype.hasActiveTouchpoint=function(t){return this.identifierMap[t]!==void 0},e.prototype.getTouchpointWithId=function(t){var n=this.identifierMap[t];return this._activeTouchpoints.find(function(i){return i.rawIdentifier==n})},e.prototype.getConfigForId=function(t){return this.getTouchpointWithId(t).currentRecognizerConfig},e.prototype.getStateTokenForId=function(t){var n;return(n=this.getTouchpointWithId(t).stateToken)!==null&&n!==void 0?n:null},e.prototype.dropTouchpoint=function(t){var n=t.rawIdentifier;this._activeTouchpoints=this._activeTouchpoints.filter(function(o){return t!=o});for(var i=0,r=Object.keys(this.identifierMap);i<r.length;i++){var s=r[i],l=Number.parseInt(s,10);this.identifierMap[l]==n&&delete this.identifierMap[l]}},e.prototype.addTouchpoint=function(t){this._activeTouchpoints.push(t)},Object.defineProperty(e.prototype,"activeSources",{get:function(){return[].concat(this._activeTouchpoints)},enumerable:!1,configurable:!0}),e.IDENTIFIER_SEED=0,e}(V.default);function Kn(c,e,t){var n=c.targetRoot.getBoundingClientRect();return{clientX:e,clientY:t,targetX:e-n.left,targetY:t-n.top}}var we=function(c){(0,Q.__extends)(e,c);function e(){return c!==null&&c.apply(this,arguments)||this}return e.prototype.buildSampleFor=function(t,n,i,r,s){var l,o,a=(0,Q.__assign)((0,Q.__assign)({},Kn(this.config,t,n)),{t:r,stateToken:(l=s==null?void 0:s.stateToken)!==null&&l!==void 0?l:this.stateToken}),g=(o=s==null?void 0:s.currentRecognizerConfig.itemIdentifier)!==null&&o!==void 0?o:this.config.itemIdentifier,d=g(a,i);return a.item=d,a},e.prototype.onInputStart=function(t,n,i,r){var s=this,l=this.createTouchpoint(t,r);l.update(n),this.addTouchpoint(l),l.path.on("invalidated",function(){s.dropTouchpoint(l)}),l.path.on("complete",function(){s.dropTouchpoint(l)});try{this.emit("pointstart",l)}catch(o){xt("Engine-internal error while initializing gesture matching for new source",o)}return l},e.prototype.onInputMove=function(t,n,i){if(!!t)try{t.update(n)}catch(r){xt("Error occurred while updating source",r)}},e.prototype.onInputMoveCancel=function(t,n,i){if(!!t)try{t.update(n),t.path.terminate(!0)}catch(r){xt("Error occurred while cancelling further input for source",r)}},e.prototype.onInputEnd=function(t,n){if(!!t)try{t.path.terminate(!1)}catch(i){xt("Error occurred while finalizing input for source",i)}},e}(Fc);var Wt=function(){function c(){}return c.getCoordZoneBitmask=function(e,t){var n=t.getBoundingClientRect(),i=0;return i|=e.clientX<n.left?c.FAR_LEFT:0,i|=e.clientX>n.right?c.FAR_RIGHT:0,i|=e.clientY<n.top?c.FAR_TOP:0,i|=e.clientY>n.bottom?c.FAR_BOTTOM:0,i},c.inputStartOutOfBoundsCheck=function(e,t){return!!this.getCoordZoneBitmask(e,t.inputStartBounds)},c.inputStartSafeBoundProximityCheck=function(e,t){return this.getCoordZoneBitmask(e,t.paddedSafeBounds)},c.inputMoveCancellationCheck=function(e,t,n){if(n=n||0,this.getCoordZoneBitmask(e,t.maxRoamingBounds))return!0;var i=this.getCoordZoneBitmask(e,t.safeBounds);return!!(i&~n)},c.FAR_TOP=8,c.FAR_LEFT=4,c.FAR_BOTTOM=2,c.FAR_RIGHT=1,c}();var yc=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this,t)||this;return n.hasActiveClick=!1,n.disabledSafeBounds=0,n.currentSource=null,n.activeIdentifier=0,n._mouseStart=function(i){return n.onMouseStart(i)},n._mouseMove=function(i){return n.onMouseMove(i)},n._mouseEnd=function(i){return n.onMouseEnd(i)},n}return Object.defineProperty(e.prototype,"eventRoot",{get:function(){return this.config.mouseEventRoot},enumerable:!1,configurable:!0}),e.prototype.registerEventHandlers=function(){this.eventRoot.addEventListener("mousedown",this._mouseStart,!0),this.eventRoot.addEventListener("mousemove",this._mouseMove,!1),this.eventRoot.addEventListener("mouseup",this._mouseEnd,!0)},e.prototype.unregisterEventHandlers=function(){this.eventRoot.removeEventListener("mousedown",this._mouseStart,!0),this.eventRoot.removeEventListener("mousemove",this._mouseMove,!1),this.eventRoot.removeEventListener("mouseup",this._mouseEnd,!0)},e.prototype.preventPropagation=function(t){t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,typeof t.stopImmediatePropagation=="function"?t.stopImmediatePropagation():typeof t.stopPropagation=="function"&&t.stopPropagation()},e.prototype.buildSampleFromEvent=function(t){return this.buildSampleFor(t.clientX,t.clientY,t.target,performance.now(),this.currentSource)},e.prototype.onMouseStart=function(t){var n=this;if(!!this.config.targetRoot.contains(t.target)){this.preventPropagation(t);var i=this.buildSampleFromEvent(t);Wt.inputStartOutOfBoundsCheck(i,this.config)||(this.disabledSafeBounds=Wt.inputStartSafeBoundProximityCheck(i,this.config));var r=this.onInputStart(this.activeIdentifier,i,t.target,!1);this.currentSource=r;var s=function(){n.currentSource=null};r.path.on("complete",s),r.path.on("invalidated",s)}},e.prototype.onMouseMove=function(t){var n=this.currentSource;if(!!n){var i=this.buildSampleFromEvent(t);if(!t.buttons){this.hasActiveClick&&(this.hasActiveClick=!1,this.onInputMoveCancel(n,i,t.target));return}this.preventPropagation(t);var r=n.currentRecognizerConfig;Wt.inputMoveCancellationCheck(i,r,this.disabledSafeBounds)?this.onInputMoveCancel(n,i,t.target):this.onInputMove(n,i,t.target)}},e.prototype.onMouseEnd=function(t){var n=this.currentSource;!n||(t.buttons||(this.hasActiveClick=!1),this.onInputEnd(n,t.target))},e}(we);function Ic(c){for(var e=[],t=0;t<c.length;t++)e.push(c.item(t));return e}var Uc=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this,t)||this;return n.eventDispatcher=new dc,n.safeBoundMaskMap={},n.pendingSourcePromises=new Map,n.inputStartSignalMap=new Map,n._touchStart=function(i){return n.onTouchStart(i)},n._touchMove=function(i){return n.onTouchMove(i)},n._touchEnd=function(i){return n.onTouchEnd(i)},n}return Object.defineProperty(e.prototype,"eventRoot",{get:function(){return this.config.touchEventRoot},enumerable:!1,configurable:!0}),e.prototype.registerEventHandlers=function(){this.eventRoot.addEventListener("touchstart",this._touchStart,{capture:!0,passive:!1}),this.eventRoot.addEventListener("touchmove",this._touchMove,{capture:!1,passive:!1}),this.eventRoot.addEventListener("touchend",this._touchEnd,{capture:!0,passive:!1})},e.prototype.unregisterEventHandlers=function(){this.eventRoot.removeEventListener("touchstart",this._touchStart,!0),this.eventRoot.removeEventListener("touchmove",this._touchMove,!1),this.eventRoot.removeEventListener("touchend",this._touchEnd,!0)},e.prototype.preventPropagation=function(t){t.cancelable&&t.preventDefault(),typeof t.stopImmediatePropagation=="function"?t.stopImmediatePropagation():typeof t.stopPropagation=="function"&&t.stopPropagation()},e.prototype.dropTouchpoint=function(t){c.prototype.dropTouchpoint.call(this,t);for(var n=0,i=Object.keys(this.safeBoundMaskMap);n<i.length;n++){var r=i[n],s=Number.parseInt(r,10);this.getTouchpointWithId(s)==t&&delete this.safeBoundMaskMap[s]}},e.prototype.fulfillInputStart=function(t){var n=this.inputStartSignalMap.get(t);n&&(this.inputStartSignalMap.delete(t),n.resolve())},e.prototype.hasActiveTouchpoint=function(t){var n=c.prototype.hasActiveTouchpoint.call(this,t);return n||!!this.pendingSourcePromises.has(t)},e.prototype.buildSampleFromTouch=function(t,n,i){return this.buildSampleFor(t.clientX,t.clientY,t.target,n,i)},e.prototype.onTouchStart=function(t){var n=this;if(!!this.config.targetRoot.contains(t.target)){this.preventPropagation(t);var i=Ic(t.touches),r=Ic(t.changedTouches),s=i.filter(function(B){return r.findIndex(function(u){return B.identifier==u.identifier})==-1}),l=s.map(function(B){return n.pendingSourcePromises.get(B.identifier)});this.eventDispatcher.runAsync(function(){return(0,Q.__awaiter)(n,void 0,void 0,function(){var B;return(0,Q.__generator)(this,function(u){switch(u.label){case 0:return[4,Promise.all(l)];case 1:return B=u.sent(),this.maintainTouchpoints(B),[2,this.eventDispatcher.defaultWait]}})})});for(var o=new Map,a=0;a<t.changedTouches.length;a++){var g=t.changedTouches.item(a),d=new A;this.pendingSourcePromises.set(g.identifier,d),o.set(g.identifier,d)}this.eventDispatcher.runAsync(function(){for(var B=performance.now(),u=null,y=function(U){var b=t.changedTouches.item(U),C=b.identifier,X=n.buildSampleFromTouch(b,B,null);if(!Wt.inputStartOutOfBoundsCheck(X,n.config))n.safeBoundMaskMap[C]=Wt.inputStartSafeBoundProximityCheck(X,n.config);else{var Z=o.get(C);return Z.resolve(null),"continue"}u=n.onInputStart(C,X,t.target,!0);var G=o.get(C);G.resolve(u);var p=function(){n.pendingSourcePromises.get(C)==G&&n.pendingSourcePromises.delete(C)};u.path.on("complete",p),u.path.on("invalidated",p)},I=0;I<t.changedTouches.length;I++)y(I);if(u){var F=new A;return n.inputStartSignalMap.set(u,F),F.corePromise}else return Promise.resolve()})}},e.prototype.onTouchMove=function(t){for(var n=this,i,r=0;r<t.touches.length;r++){var s=t.touches.item(r);if(this.hasActiveTouchpoint(s.identifier)){this.preventPropagation(t);break}}for(var l=new Map,r=0;r<t.touches.length;r++){var o=t.touches.item(r).identifier;l.set(o,(i=this.pendingSourcePromises.get(o))===null||i===void 0?void 0:i.corePromise)}this.eventDispatcher.runAsync(function(){return(0,Q.__awaiter)(n,void 0,void 0,function(){var a;return(0,Q.__generator)(this,function(g){switch(g.label){case 0:return[4,Promise.all(l.values())];case 1:return a=g.sent(),this.maintainTouchpoints(a),[2,this.eventDispatcher.defaultWait]}})})}),this.eventDispatcher.runAsync(function(){return(0,Q.__awaiter)(n,void 0,void 0,function(){var a,g,d,B,u,y,I;return(0,Q.__generator)(this,function(F){switch(F.label){case 0:a=performance.now(),g=0,F.label=1;case 1:return g<t.touches.length?(d=t.touches.item(g),B=d.identifier,[4,l.get(B)]):[3,4];case 2:if(u=F.sent(),!u||u.isPathComplete)return[3,3];y=u.currentRecognizerConfig,I=this.buildSampleFromTouch(d,a,u),Wt.inputMoveCancellationCheck(I,y,this.safeBoundMaskMap[B])?this.onInputMoveCancel(u,I,d.target):this.onInputMove(u,I,d.target),F.label=3;case 3:return g++,[3,1];case 4:return[2,this.eventDispatcher.defaultWait]}})})})},e.prototype.onTouchEnd=function(t){for(var n=this,i,r=0;r<t.changedTouches.length;r++){var s=t.changedTouches.item(r);if(this.hasActiveTouchpoint(s.identifier)){this.preventPropagation(t);break}}for(var l=new Map,r=0;r<t.changedTouches.length;r++){var o=t.changedTouches.item(r).identifier,a=(i=this.pendingSourcePromises.get(o))===null||i===void 0?void 0:i.corePromise;l.set(o,a)}this.eventDispatcher.runAsync(function(){return(0,Q.__awaiter)(n,void 0,void 0,function(){var g,d,B;return(0,Q.__generator)(this,function(u){switch(u.label){case 0:g=0,u.label=1;case 1:return g<t.changedTouches.length?(d=t.changedTouches.item(g),[4,l.get(d.identifier)]):[3,4];case 2:if(B=u.sent(),!B||B.isPathComplete)return[3,3];this.onInputEnd(B,t.target),u.label=3;case 3:return g++,[3,1];case 4:return[2,this.eventDispatcher.defaultWait]}})})})},e}(we);var bc=function(){function c(e,t,n){var i=this;if(!e||!t)throw new Error("A gesture-path source and contact-path model must be specified.");if(this.model=e,this.publishedPromise=new A,this.source=t,this.inheritedStats=n,this.lastStats=null,e.timer){var r=e.timer.inheritElapsed?Math.min(t.path.stats.duration,e.timer.duration):0;this.timerPromise=new le(e.timer.duration-r),this.publishedPromise.then(function(){i.timerPromise.resolve(!1)}),this.timerPromise.then(function(s){var l=t instanceof st?t.baseSource:t,o=performance.now();!l.isPathComplete&&l.currentSample.t!=o&&l.path.extend((0,Q.__assign)((0,Q.__assign)({},l.currentSample),{t:o})),s!=e.timer.expectedResult&&i.finalize(!1,"timer"),i.finalize(!0,"timer")})}}return Object.defineProperty(c.prototype,"promise",{get:function(){return this.publishedPromise.corePromise},enumerable:!1,configurable:!0}),c.prototype.finalize=function(e,t){if(this.publishedPromise.isFulfilled)return this._result;var n=this.model;n.validateItem&&e&&(e=n.validateItem(this.source.path.stats.lastSample.item,this.baseItem));var i;return e?i={type:n.pathResolutionAction,cause:t}:i={type:"reject",cause:t},this.publishedPromise.resolve(i),this._result=i,i},Object.defineProperty(c.prototype,"stats",{get:function(){return this.source.path.stats},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"baseItem",{get:function(){return this.source.baseItem},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"lastItem",{get:function(){return this.source.currentSample.item},enumerable:!1,configurable:!0}),c.prototype.update=function(){var e=this.model,t=this.source;if(t.path.wasCancelled)return this.finalize(!1,"path");if(e.itemChangeAction&&t.path.stats.sampleCount>0&&t.currentSample.item!=t.baseItem){var n=e.itemChangeAction=="resolve";return this.finalize(n,"item")}else{var n=e.pathModel.evaluate(t.path,this.lastStats,t.baseItem,this.inheritedStats)||"continue";return this.lastStats=t.path.stats,n!="continue"?this.finalize(n=="resolve","path"):t.path.isComplete?this.finalize(!1,"path"):{type:"continue"}}},c}();var On=function(){function c(e,t){var n=this,i;if(this._isCancelled=!1,!e||!t)throw new Error("Construction of GestureMatcher requires a gesture-model spec and a source for related contact points.");if(!e.sustainTimer&&!t)throw new Error("If the provided gesture-model spec lacks a sustain timer, there must be an active contact point.");var r=t instanceof Gt?null:t,s=r?null:t;this.predecessor=r,this.publishedPromise=new A,this.model=e,e.sustainTimer&&(this.sustainTimerPromise=new le(e.sustainTimer.duration),this.sustainTimerPromise.then(function(I){var F=e.sustainTimer.expectedResult==I;n.finalize(F,"timer")})),this.pathMatchers=[];var l=s?[s]:r.sources,o=l.map(function(I){return s&&I==s?s:I.isPathComplete?null:I}).reduce(function(I,F){return F?I.concat(F):I},[]);if(e.sustainTimer&&o.length>0){this.finalize(!1,"path");return}else!e.sustainTimer&&o.length==0&&this.finalize(!1,"path");for(var a=0;a<o.length;a++){var g=o[a];g instanceof st&&g.disconnect();var d=e.contacts[a];if(!d)throw new Error('No contact model for inherited path: gesture "'.concat(e.id,"', entry ").concat(a));var B=(i=d==null?void 0:d.model.pathInheritance)!==null&&i!==void 0?i:"chop",u=!1,y=void 0;switch(B){case"reject":this.finalize(!1,"path");return;case"full":y=g.constructSubview(!1,!0),this.addContactInternal(y,g.path.stats,!0);continue;case"partial":u=!0;case"chop":y=g.constructSubview(!0,u),this.addContactInternal(y,g.path.stats,!0);break}}}return Object.defineProperty(c.prototype,"sources",{get:function(){var e=this;return this.pathMatchers.map(function(t,n){if(!e.model.contacts[n].resetOnInstantFulfill)return t.source}).filter(function(t){return!!t})},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"promise",{get:function(){return this.publishedPromise.corePromise},enumerable:!1,configurable:!0}),c.prototype.cancel=function(){this._isCancelled=!0,this._result||this.finalize(!1,"cancelled")},Object.defineProperty(c.prototype,"isCancelled",{get:function(){return this._isCancelled},enumerable:!1,configurable:!0}),c.prototype.finalize=function(e,t){var n,i;if(this.publishedPromise.isFulfilled)return this._result;try{var r=void 0;e?r=this.model.resolutionAction:(t!="cancelled"&&((n=this.model.rejectionActions)===null||n===void 0?void 0:n[t])&&(r=this.model.rejectionActions[t],r.item="none"),r=r||{type:"none",item:"none"});var s=void 0,l=(i=r.item)!==null&&i!==void 0?i:"current";switch(l){case"none":s=null;break;case"base":s=this.primaryPath.baseItem;break;case"current":s=this.primaryPath.currentSample.item;break}var o={matched:e,action:(0,Q.__assign)((0,Q.__assign)({},r),{item:s})};return this.publishedPromise.resolve(o),this._result=o,o}catch(a){return this.publishedPromise.reject(a),{matched:!1,action:{type:"none",item:null}}}},c.prototype.finalizeSources=function(){if(!this._result)throw Error("Invalid state for source-finalization - the matcher's evaluation of the gesture model is not yet complete");for(var e=this._result.matched,t=0;t<this.pathMatchers.length;t++){var n=this.pathMatchers[t],i=this.model.contacts[t];n.source.isPathComplete||(e&&i.endOnResolve||!e&&i.endOnReject)&&n.source.terminate(!1)}},Object.defineProperty(c.prototype,"primaryPath",{get:function(){for(var e,t=Number.NEGATIVE_INFINITY,n=0,i=this.pathMatchers;n<i.length;n++){var r=i[n];r.model.itemPriority>t&&(t=r.model.itemPriority,e=r)}return!e&&this.predecessor?this.predecessor.primaryPath:e==null?void 0:e.source},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"baseItem",{get:function(){return this.primaryPath.baseItem},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"currentItem",{get:function(){return this.primaryPath.currentSample.item},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"allSourceIds",{get:function(){var e=this.sources.map(function(n){return n.identifier}),t=this.predecessor?this.predecessor.allSourceIds:[];return e=e.filter(function(n){return t.indexOf(n)==-1}),e.concat(t)},enumerable:!1,configurable:!0}),c.prototype.mayAddContact=function(){return this.pathMatchers.length<this.model.contacts.length},c.prototype.addContact=function(e){var t=this.pathMatchers.length;if(!this.mayAddContact())throw new Error("The specified gesture model does not support more than ".concat(t," contact points."));this.addContactInternal(e.constructSubview(!1,!0),null)},Object.defineProperty(c.prototype,"result",{get:function(){return this._result},enumerable:!1,configurable:!0}),c.prototype.addContactInternal=function(e,t,n){var i=this,r,s=this.pathMatchers.length,l=this.model.contacts[s],o=new bc(l.model,e,new Ht(t));this.pathMatchers.push(o);var a=null,g=null;if(!s&&this.predecessor&&this.model.sustainTimer){a=this.predecessor.primaryPath;var d=(r=this.model.sustainTimer.baseItem)!==null&&r!==void 0?r:"result",B=void 0;switch(d){case"none":g=null;break;case"base":g=this.predecessor.primaryPath.baseItem,B=this.predecessor.primaryPath.stateToken;break;case"result":g=this.predecessor.result.action.item,B=this.predecessor.primaryPath.currentSample.stateToken;break}e.baseItem=g!=null?g:e.baseItem,e.stateToken=B,e.currentSample.stateToken=B,e.currentRecognizerConfig&&(e.currentSample.item=e.currentRecognizerConfig.itemIdentifier(e.currentSample,null))}else g=this.primaryPath.baseItem,a=this.primaryPath;if(l.model.baseCoordReplacer){var u=e.path.stats,y=l.model.baseCoordReplacer(u,g);if(y){var I=(0,Q.__assign)((0,Q.__assign)({},Kn(e.currentRecognizerConfig,y.clientX,y.clientY)),{t:y.t||y.t===0?y.t:u.initialSample.t,item:g,stateToken:e.stateToken});e.path.replaceInitialSample(I)}}if(l.model.allowsInitialState){var F=l.model.allowsInitialState(e.currentSample,a.currentSample,g,a.stateToken);if(!F){this.pathMatchers.pop(),this.finalize(!1,"cancelled");return}}var U=o.update();if((U==null?void 0:U.type)=="reject"){this.finalize(!1,n?"cancelled":"path");return}o.promise.then(function(b){i.finalize(b.type=="resolve",b.cause)})},c.prototype.update=function(){var e=this;this.pathMatchers.forEach(function(t){try{t.update()}catch(n){console.error(n),e.finalize(!1,"cancelled")}})},c}();var De=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this)||this;return n._sourceSelector=[],n.potentialMatchers=[],n.sustainMode=!1,n.attemptSynchronousUpdate=function(){var i=n._sourceSelector.filter(function(l){return!l.source.isPathComplete}),r=i.map(function(l){return l.source.currentSample.t}),s=r[0];r.find(function(l){return s!=l})||n.potentialMatchers.forEach(function(l){return l.update()})},n.baseGestureSetId=t||"default",n}return e.prototype.potentialMatchersForSource=function(t){return this.potentialMatchers.filter(function(n){return n.allSourceIds.find(function(i){return i==t.identifier})})},e.prototype.cascadeTermination=function(){var t=this,n=this.potentialMatchers,i=n.filter(function(o){return!o.model.sustainWhenNested}),r=n.filter(function(o){return o.model.sustainWhenNested});this.potentialMatchers=r;var s=r.map(function(o){return o.allSourceIds}).reduce(function(o,a){for(var g=0,d=a;g<d.length;g++){var B=d[g];o.indexOf(B)==-1&&o.push(B)}return o},[]),l=this._sourceSelector.filter(function(o){return!s.find(function(a){return a==o.source.identifier})});return l.forEach(function(o){o.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}});var a=t._sourceSelector.indexOf(o);a>-1&&t._sourceSelector.splice(a,1)}),i.forEach(function(o){return o.cancel()}),this.sustainMode=!0,this._sourceSelector.map(function(o){return o.source})},e.prototype.matchGesture=function(t,n){return(0,Q.__awaiter)(this,void 0,void 0,function(){var i,r,s,l,o,a,g,d,B,u,y,I,F,U,b,C,X,Z,G,p,f=this;return(0,Q.__generator)(this,function(m){switch(m.label){case 0:return i=t instanceof Gt,r=function(x){var R=x.sources.map(function(k){return k.baseSource});return R&&R.length>0?R:x.predecessor?r(x.predecessor):[]},s=i?[t instanceof st?t.baseSource:t]:r(t),l=i?t:null,o=i?null:t,this.pendingMatchSetup?(a=this.pendingMatchSetup,g=new A,this.pendingMatchSetup=g.corePromise,[4,a]):[3,2];case 1:m.sent(),this.pendingMatchSetup==g.corePromise&&(this.pendingMatchSetup=null),g.resolve(),m.label=2;case 2:return i&&l.path.on("invalidated",function(){f.dropSourcesWithIds([l.identifier])}),d=new A,B=s.map(function(x){var R={source:x,matchPromise:d,preserve:!0};return f._sourceSelector.push(R),R}),u=B.map(function(x){return x.matchPromise}),i?(y=this.potentialMatchers.filter(function(x){return x.mayAddContact()}),y.forEach(function(x){x.addContact(l),x.promise.then(f.matcherSelectionFilter(x,u))}),y.length>0?(I=this.stateToken,F=new A,this.pendingMatchSetup=F.corePromise,[4,Qt(0)]):[3,5]):[3,5];case 3:return m.sent(),[4,Qt(0)];case 4:if(m.sent(),this.pendingMatchSetup==F.corePromise&&(this.pendingMatchSetup=null),F.resolve(),U=this.stateToken,I!=U&&(b=l.currentSample,l.stateToken=U,b.stateToken=U,b.item=t.currentRecognizerConfig.itemIdentifier(b,null),l.baseItem=b.item),C=y.find(function(x){return x.result}),C&&C.allSourceIds.includes(t.identifier))return d.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),[2,{selectionPromise:d.corePromise}];m.label=5;case 5:if(B.forEach(function(x){x.preserve=!1}),this.sustainMode&&l)return d.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),[2,{selectionPromise:d.corePromise,sustainModeWithoutMatch:!0}];for(X=n.map(function(x){try{return new On(x,l||o)}catch(R){return console.error(R),null}}).filter(function(x){return!!x}),X=X.filter(function(x){return!x.result||x.result.matched!==!1}),Z=0,G=X;Z<G.length;Z++)p=G[Z],p.promise.then(this.matcherSelectionFilter(p,u));return X.length>0?this.potentialMatchers=this.potentialMatchers.concat(X):d.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}}),this.potentialMatchers.sort(function(x,R){return R.model.resolutionPriority-x.model.resolutionPriority}),this.resetSourceHooks(),[2,{selectionPromise:d.corePromise}]}})})},e.prototype.resetSourceHooks=function(){var t=this,n=function(i){var r=i;r.path.off("step",t.attemptSynchronousUpdate),r.path.off("complete",t.attemptSynchronousUpdate),r.path.off("invalidated",t.attemptSynchronousUpdate),r.path.on("step",t.attemptSynchronousUpdate),r.path.on("complete",t.attemptSynchronousUpdate),r.path.on("invalidated",t.attemptSynchronousUpdate)};this._sourceSelector.forEach(function(i){return n(i.source)})},e.prototype.dropSourcesWithIds=function(t){for(var n=function(o){var a=i._sourceSelector.findIndex(function(d){return d.source.identifier==o});if(a>-1){var g=i._sourceSelector.splice(a,1)[0];g.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"none",item:null}}})}},i=this,r=0,s=t;r<s.length;r++){var l=s[r];n(l)}},e.prototype.matchersForSource=function(t){return this.potentialMatchers.filter(function(n){return!!n.sources.find(function(i){return i.identifier==t.identifier})})},e.prototype.matcherSelectionFilter=function(t,n){var i=this;return function(r){return(0,Q.__awaiter)(i,void 0,void 0,function(){var s,l,o,a,g,d,B,u,y,I=this;return(0,Q.__generator)(this,function(F){if(t.isCancelled?r={matched:!1,action:{type:"none",item:null}}:t.finalizeSources(),s=t.allSourceIds,l=s.map(function(U){return I._sourceSelector.find(function(b){return b.source.identifier==U})}).filter(function(U){return!!U}),o=this.potentialMatchers.indexOf(t),o==-1)return[2];if(this.potentialMatchers.splice(o,1),r.action.type=="none")return this.finalizeMatcherlessTrackers(l),[2];if(r.matched)for(g=function(U){var b=d.matchersForSource(U.source);d.potentialMatchers=d.potentialMatchers.filter(function(C){return!b.find(function(X){return C==X})}),b.forEach(function(C){C.cancel()}),d._sourceSelector=d._sourceSelector.filter(function(C){return!l.find(function(X){return C==X})}),U.matchPromise.resolve({matcher:t,result:r})},d=this,B=0,u=l;B<u.length;B++)y=u[B],g(y);else return a=function(U){if(I.sustainMode&&!U.sustainWhenNested){I.finalizeMatcherlessTrackers(l);return}var b=new On(U,t);if(b.result&&b.result.matched==!1){I.finalizeMatcherlessTrackers(l);return}b.promise.then(I.matcherSelectionFilter(b,l.map(function(C){return C.matchPromise}))),I.potentialMatchers.push(b),I.resetSourceHooks()},this.emit("rejectionwithaction",{matcher:t,result:r},a),[2];return[2]})})}},e.prototype.finalizeMatcherlessTrackers=function(t){for(var n=this,i=t.map(function(o){return{tracker:o,pendingCount:n.potentialMatchers.filter(function(a){return!!a.allSourceIds.find(function(g){return o.source.identifier==g})}).length}}),r=0,s=i;r<s.length;r++){var l=s[r];l.pendingCount==0&&!l.tracker.preserve&&l.tracker.matchPromise.resolve({matcher:null,result:{matched:!1,action:{type:"complete",item:null}}})}},e}(V.default);function qt(c,e){var t=c.gestures.find(function(n){return n.id==e});if(!t)throw new Error("Could not find spec for gesture with id '".concat(e,"'"));return t}function hc(c,e){var t=c.sets[e];if(!t)throw new Error("Could not find a defined gesture-set with id '".concat(e,"'"));var n=c.gestures.filter(function(r){return!!t.find(function(s){return r.id==s})}),i=t.filter(function(r){return!n.find(function(s){return s.id==r})});if(i.length>0)throw new Error("Set '".concat(e,"' cannot find definitions for gestures with ids ").concat(i));return n}var Cc={gestures:[],sets:{default:[]}};var ks=function(){function c(e,t){var n,i,r=e.matcher,s=e.result;this.gestureSetId=t,this.matchedId=r==null?void 0:r.model.id,this.linkType=s.action.type,this.item=s.action.item,this.sources=r==null?void 0:r.sources,(n=this.sources)===null||n===void 0||n.forEach(function(l){return l.disconnect()}),(i=this.sources)===null||i===void 0||i.sort(function(l,o){return(r==null?void 0:r.primaryPath)==l?-1:(r==null?void 0:r.primaryPath)==o?1:0}),this.allSourceIds=(r==null?void 0:r.allSourceIds)||[]}return c}();var Xc=function(c){(0,Q.__extends)(e,c);function e(t,n,i,r){var s=c.call(this)||this;return s.markedComplete=!1,s.selectionHandler=function(l){return(0,Q.__awaiter)(s,void 0,void 0,function(){var o,a,g,d,B,u,y,I,F,U,b,C,X,Z=this,G,p,f,m,x,R,k,W,T,L;return(0,Q.__generator)(this,function(S){switch(S.label){case 0:return o=((G=this.pushedSelector)===null||G===void 0?void 0:G.baseGestureSetId)||((p=this.selector)===null||p===void 0?void 0:p.baseGestureSetId),a=new ks(l,o),l.matcher&&this.stageReports.push(a),g=(f=l.matcher)!==null&&f!==void 0?f:this.stageReports[this.stageReports.length-1],d=(m=g==null?void 0:g.sources.map(function(H){return H instanceof st?H.baseSource:H}))!==null&&m!==void 0?m:[],B=l.result.action.type,(B=="complete"||B=="none")&&(d.forEach(function(H){H.isPathComplete||H.terminate(B=="none")}),!l.result.matched)?(this.markedComplete||(this.markedComplete=!0,this.emit("complete")),[2]):B=="complete"&&this.touchpointCoordinator&&this.pushedSelector?(u=(x=this.touchpointCoordinator)===null||x===void 0?void 0:x.sustainSelectorSubstack(this.pushedSelector),y=u.map(function(H){var N=new A;return H.path.on("invalidated",function(){return N.resolve()}),H.path.on("complete",function(){return N.resolve()}),N.corePromise}),y.length>0&&l.result.action.awaitNested?[4,Promise.all(y)]:[3,3]):[3,4];case 1:return S.sent(),[4,Qt(0)];case 2:S.sent(),S.label=3;case 3:(R=this.touchpointCoordinator)===null||R===void 0||R.popSelector(this.pushedSelector),this.pushedSelector=null,S.label=4;case 4:return this.emit("stage",a,function(H){H.type=="pop"?d.forEach(function(N){return N.popRecognizerConfig()}):d.forEach(function(N){return N.pushRecognizerConfig(H.config)})}),I=!1,this.touchpointCoordinator&&(I=!this.touchpointCoordinator.selectorStackIncludes(this.selector)),F=Ts(l.result.action,this.gestureConfig,this.baseGestureSetId),I&&(F=F.filter(function(H){return H.sustainWhenNested})),F.length>0?(B=="chain"&&l.result.action.selectionMode==((k=this.pushedSelector)===null||k===void 0?void 0:k.baseGestureSetId)||(this.pushedSelector&&(this.pushedSelector.off("rejectionwithaction",this.modelResetHandler),(W=this.touchpointCoordinator)===null||W===void 0||W.popSelector(this.pushedSelector),this.pushedSelector=null),B=="chain"&&(U=l.result.action.selectionMode,U&&(b=new De(U),b.on("rejectionwithaction",this.modelResetHandler),this.pushedSelector=b,(T=this.touchpointCoordinator)===null||T===void 0||T.pushSelector(b)))),C=(L=this.pushedSelector)!==null&&L!==void 0?L:this.selector,X=C.matchGesture(l.matcher,F),X.then(function(H){return(0,Q.__awaiter)(Z,void 0,void 0,function(){var N;return(0,Q.__generator)(this,function(ot){switch(ot.label){case 0:return N=this.selectionHandler,[4,H.selectionPromise];case 1:return[2,N.apply(this,[ot.sent()])]}})})})):this.markedComplete||(this.markedComplete=!0,this.emit("complete")),[2]}})})},s.modelResetHandler=function(l,o){var a=l.matcher.allSourceIds;if(!s.allSourceIds.find(function(g){return a.indexOf(g)==-1}))if(l.result.action.type=="replace")o(qt(s.gestureConfig,l.result.action.replace));else throw new Error("Missed a case in implementation!")},s.stageReports=[],s.selector=i,s.selector.on("rejectionwithaction",s.modelResetHandler),s.once("complete",function(){var l;s.pushedSelector&&((l=s.touchpointCoordinator)===null||l===void 0||l.popSelector(s.pushedSelector),s.pushedSelector=null),s.selector.off("rejectionwithaction",s.modelResetHandler),s.selector.dropSourcesWithIds(s.allSourceIds),s.selector=null}),s.gestureConfig=n,s.touchpointCoordinator=r,Promise.resolve().then(function(){return s.selectionHandler(t)}),s}return Object.defineProperty(e.prototype,"allSourceIds",{get:function(){var t,n;return(n=(t=this.stageReports[this.stageReports.length-1])===null||t===void 0?void 0:t.allSourceIds)!==null&&n!==void 0?n:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"baseGestureSetId",{get:function(){var t,n;return(n=(t=this.selector)===null||t===void 0?void 0:t.baseGestureSetId)!==null&&n!==void 0?n:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"potentialModelMatchIds",{get:function(){if(!this.selector)return[];var t=[this.selector];this.pushedSelector&&t.push(this.pushedSelector);var n=this.stageReports[this.stageReports.length-1],i=n.sources,r=i.map(function(s){return t.map(function(l){return l.potentialMatchersForSource(s).map(function(o){return o.model.id})})}).reduce(function(s,l){return s.concat(l)}).reduce(function(s,l){for(var o=0,a=l;o<a.length;o++){var g=a[o];s.indexOf(g)==-1&&s.push(g)}return s},[]);return r},enumerable:!1,configurable:!0}),e.prototype.cancel=function(){var t=this.stageReports[this.stageReports.length-1].sources;t.forEach(function(n){return n.baseSource.isPathComplete||n.baseSource.terminate(!0)}),this.markedComplete||(this.markedComplete=!0,this.emit("complete"))},e.prototype.toJSON=function(){return this.stageReports},e}(V.default);function Ts(c,e,t){switch(c.type){case"none":case"complete":return[];case"replace":return[qt(e,c.replace)];case"chain":return[qt(e,c.next)];default:throw new Error("Unexpected case arose within `processGestureAction` method")}}var xc=function(c){(0,Q.__extends)(e,c);function e(t,n,i){var r=c.call(this)||this;if(r.selectorStack=[new De],r._activeSources=[],r._activeGestures=[],r._history=[],r.modelResetHandler=function(a,g){var d=a.matcher.allSourceIds;if(!r.activeGestures.find(function(B){return B.allSourceIds.find(function(u){return d.indexOf(u)!=-1})}))if(a.result.action.type=="replace")g(qt(r.gestureModelDefinitions,a.result.action.replace));else throw new Error("Missed a case in implementation!")},r.onNewTrackedPath=function(a){return(0,Q.__awaiter)(r,void 0,void 0,function(){var g,d,B,u,y,I,F,U,b,C,X,Z,G,p,f=this;return(0,Q.__generator)(this,function(m){switch(m.label){case 0:this.addSimpleSourceHooks(a),g=this.gestureModelDefinitions,m.label=1;case 1:return d=this.currentSelector,u=d.matchGesture(a,hc(g,d.baseGestureSetId)),[4,u];case 2:return y=m.sent(),y.sustainModeWithoutMatch?(I=function(x){x.stateToken=f.stateToken,x.item=a.currentRecognizerConfig.itemIdentifier(x,null)},a.path instanceof jt&&a.path.coords.forEach(I),a.stateToken=this.stateToken,a.baseItem=a.path.stats.initialSample.item,I(a.path.stats.initialSample),I(a.path.stats.lastSample),[3,3]):(B=y.selectionPromise,[3,4]);case 3:if(d!=this.currentSelector)return[3,1];m.label=4;case 4:F=this.currentSelector,a.setGestureMatchInspector(this.buildGestureMatchInspector(F)),U=function(){f.recordHistory(a)};try{a.path.on("invalidated",U),this.emit("inputstart",a)}catch(x){xt("Error from 'inputstart' event listener",x)}return this.inputEngines.forEach(function(x){x.fulfillInputStart(a)}),[4,B];case 5:if(b=m.sent(),!b||b.result.matched==!1)return[2];for(C=b.matcher.allSourceIds,X=0,Z=this._activeGestures;X<Z.length;X++)if(G=Z[X],G.allSourceIds.find(function(x){return!!C.find(function(R){return x==R})}))return[2];return p=new Xc(b,g,this.currentSelector,this),this._activeGestures.push(p),p.on("complete",function(){var x=f._activeGestures.indexOf(p);x!=-1&&f._activeGestures.splice(x,1)}),a.path.wasCancelled||(a.path.off("invalidated",U),p.on("complete",function(){return f.recordHistory(p)})),this.emit("recognizedgesture",p),[2]}})})},r.historyMax=i>0?i:0,r.gestureModelDefinitions=t,r.inputEngines=[],n)for(var s=0,l=n;s<l.length;s++){var o=l[s];r.addEngine(o)}return r.selectorStack[0].on("rejectionwithaction",r.modelResetHandler),r}return e.prototype.pushSelector=function(t){this.selectorStack.push(t),t.on("rejectionwithaction",this.modelResetHandler)},e.prototype.sustainSelectorSubstack=function(t){if(!t)return[];var n=this.selectorStack.indexOf(t);if(n==-1)return[];if(this.selectorStack.length<=1)throw new Error("May not force the original, base gesture selector into sustain mode.");for(var i=[],r=n;r<this.selectorStack.length;r++)t=this.selectorStack[r],i=i.concat(t.cascadeTermination());return i},e.prototype.popSelector=function(t){if(!!t){var n=this.selectorStack.indexOf(t);if(n!=-1){if(this.selectorStack.length<=1)throw new Error("May not pop the original, base gesture selector.");for(;n<this.selectorStack.length;)t=this.selectorStack[n],t.off("rejectionwithaction",this.modelResetHandler),this.selectorStack.splice(n,1);this.currentSelector.stateToken=this.stateToken}}},e.prototype.selectorStackIncludes=function(t){return this.selectorStack.includes(t)},Object.defineProperty(e.prototype,"currentSelector",{get:function(){return this.selectorStack[this.selectorStack.length-1]},enumerable:!1,configurable:!0}),e.prototype.buildGestureMatchInspector=function(t){var n=this;return function(i){var r=n.selectorStack.indexOf(t),s=n.selectorStack.slice(r);return s.map(function(l){return l.potentialMatchersForSource(i).map(function(o){return o.model.id})}).reduce(function(l,o){return l.concat(o)})}},e.prototype.addEngine=function(t){t.on("pointstart",this.onNewTrackedPath),this.inputEngines.push(t)},e.prototype.recordHistory=function(t){var n=this.historyMax;n>0&&(this._history.length==n&&this._history.shift(),this._history.push(t))},Object.defineProperty(e.prototype,"activeGestures",{get:function(){return[].concat(this._activeGestures)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeSources",{get:function(){return[].concat(this.inputEngines.map(function(t){return t.activeSources}).reduce(function(t,n){return t.concat(n)},[]))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"history",{get:function(){return this._history},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"historyJSON",{get:function(){var t=function(n,i){return n=="item"?i==null?void 0:i.id:i};return JSON.stringify(this.history,t,2)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stateToken",{get:function(){return this._stateToken},set:function(t){this._stateToken=t,this.inputEngines.forEach(function(n){return n.stateToken=t}),this.currentSelector.stateToken=t},enumerable:!1,configurable:!0}),e.prototype.addSimpleSourceHooks=function(t){var n=this;t.path.on("invalidated",function(){var i=n.activeGestures.find(function(s){return s.allSourceIds.includes(t.identifier)});i&&i.cancel();var r=n._activeSources.indexOf(t);n._activeSources=n._activeSources.splice(r,1)}),t.path.on("complete",function(){var i=n._activeSources.indexOf(t);n._activeSources=n._activeSources.splice(i,1)})},e}(V.default);var Fe=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=this,r=Te(n);return t=t||Cc,i=c.call(this,t,null,r.historyLength)||this,i.config=r,i.mouseEngine=new yc(i.config),i.touchEngine=new Uc(i.config),i.mouseEngine.registerEventHandlers(),i.touchEngine.registerEventHandlers(),i.addEngine(i.mouseEngine),i.addEngine(i.touchEngine),i}return e.prototype.destroy=function(){this.activeGestures.forEach(function(t){return t.cancel()}),this.activeSources.forEach(function(t){return t.terminate(!0)}),this.mouseEngine.unregisterEventHandlers(),this.touchEngine.unregisterEventHandlers(),this.mouseEngine=null,this.touchEngine=null},e}(xc);var _n=["n","ne","e","se","s","sw","w","nw"],Gc=Math.PI,Pn=function(){for(var c=new Map,e=Gc/4,t=0;t<_n.length;t++)c.set(_n[t],[e*t,1]);return c}();function Me(c){return Math.PI/4*_n.indexOf(c)}function ye(c,e){var t=Me(e),n=c.initialSample,i=c.lastSample.targetX-n.targetX,r=c.lastSample.targetY-n.targetY,s=Math.max(0,-r*Math.cos(t)),l=Math.max(0,i*Math.sin(t));return l+s}function Ys(c,e,t,n){return function(i){var r=Me(e),s=n.flick.triggerDist-n.flick.dirLockDist,l=Math.max(0,ye(c.path.stats,e)-n.flick.dirLockDist),o=.7,a=Math.min(1,o*l/s),g=Math.sin(r)*a,d=-Math.cos(r)*a;t==null||t.scrollFlickPreview(g,d)}}var ze=Math.PI/3,ws=function(){function c(e,t,n,i,r,s){var l=this;this.directlyEmitsKeys=!0,this.sequence=e,this.gestureParams=r,this.baseSpec=i.key.spec,this.baseKeyDistances=n.getSimpleTapCorrectionDistances(e.stageReports[0].sources[0].path.stats.initialSample,this.baseSpec);var o=e.stageReports[0].sources[0].baseSource,a=o;e.on("complete",function(){s==null||s.cancel()}),this.sequence.on("stage",function(d){var B,u=a.path.stats;l.computedFlickDistribution=l.flickDistribution(u,!0);var y=l.computedFlickDistribution[0].keySpec;if(d.matchedId=="flick-restart"){a.path.replaceInitialSample(d.sources[0].path.stats.initialSample);return}if(d.matchedId=="flick-reset-centering"){a=o.constructSubview(!0,!0);return}else if(d.matchedId=="flick-reset-end"){l.emitKey(n,l.baseSpec,a.path.stats);return}else if(d.matchedId=="flick-reset"){l.flickScroller&&(l.flickScroller(a.currentSample),a.path.off("step",l.flickScroller)),l.lockedDir=null,l.lockedSelectable=null,a instanceof st&&a.disconnect();return}else if(d.matchedId=="flick-mid"){if(y==l.baseSpec)return;var I=Object.keys(l.baseSpec.flick).find(function(U){return l.baseSpec.flick[U]==y});l.lockedDir=I,l.lockedSelectable=y,l.flickScroller&&a.path.off("step",l.flickScroller),l.flickScroller=Ys(a,I,s,l.gestureParams),l.flickScroller(a.currentSample),a.path.on("step",l.flickScroller);return}var F=(B=l.lockedSelectable)!==null&&B!==void 0?B:y;l.emitKey(n,F,u)});var g=this.buildPopupRecognitionConfig(n);t({type:"push",config:g})}return c.prototype.emitKey=function(e,t,n){var i,r=ye(n,this.lockedDir);r>this.gestureParams.flick.triggerDist?i=e.keyEventFromSpec(t):i=e.keyEventFromSpec(this.baseSpec),i.keyDistribution=this.currentStageKeyDistribution(this.baseKeyDistances),e.raiseKeyEvent(i,null)},c.prototype.buildPopupRecognitionConfig=function(e){var t={getBoundingClientRect:function(){var n=Number.MAX_SAFE_INTEGER;return new DOMRect(-n,-n,2*n,2*n)}};return(0,Q.__assign)((0,Q.__assign)({},e.gestureEngine.config),{maxRoamingBounds:t,safeBounds:t})},c.prototype.cancel=function(){},c.prototype.flickDistribution=function(e,t){var n=this.baseSpec.flick,i=[{spec:this.baseSpec,coord:[NaN,0]}];i=i.concat(Object.keys(n).map(function(B){return{spec:n[B],coord:Pn.get(B)}}));var r=e.angle,s=this.gestureParams.flick.triggerDist,l=Math.min(s,t?s:e.netDistance),o=l/s,a=0,g=i.map(function(B){var u=0,y=B.coord;if(!isNaN(y[0])){var I=r-y[0],F=2*Gc+y[0]-r;u=Math.min(I*I,F*F)}var U=ze*(y[1]-o),b=U*U,C=1/(u+b+1e-6);return a+=C,{keySpec:B.spec,p:C}}),d=1/a;return g.forEach(function(B){return B.p*=d}),g.sort(function(B,u){return u.p-B.p})},c.prototype.currentStageKeyDistribution=function(e){var t=this.baseSpec,n=this.baseKeyDistances,i=this.computedFlickDistribution,r=n.get(t);if(!r){var s=i[0];return[{keySpec:s.keySpec,p:1}]}var l=i.findIndex(function(g){return g.keySpec==t}),o=i.splice(l,1)[0].p,a=St(n);return i.concat(a.map(function(g){return{keySpec:g.keySpec,p:g.p*o}}))},c}(),pc=ws;var jn={longpress:{permitsFlick:function(){return!0},flickDistStart:8,flickDistFinal:40,waitLength:500,noiseTolerance:10},multitap:{waitLength:300,holdLength:150},flick:{startDist:10,dirLockDist:25,triggerDist:40}};function mc(c){var e=c.getBoundingClientRect();return{clientX:e.left+e.width/2,clientY:e.top+e.height/2}}function Zc(c){var e=mc(c);return function(t){var n=t.lastSample.clientX-e.clientX,i=t.lastSample.clientY-e.clientY;return Math.sqrt(n*n+i*i)}}function Ie(c){var e,t,n=c.key.spec;if(n.sk)return!1;var i=["K_SHIFT","K_ALT","K_CTRL","K_NUMERALS","K_SYMBOLS","K_CURRENCIES"];try{for(var r=(0,Q.__values)(i),s=r.next();!s.done;s=r.next()){var l=s.value;if(n.id==l)return!0}}catch(o){e={error:o}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}if(n.nextlayer)switch(n.sp){case 1:case 2:case 3:case 4:return!0;default:return!1}else return!1}function qn(c,e){var t=function(B,u){if(!B)return!1;var y=B.key.spec;switch(u){case"modipress-start":return Ie(B);case"special-key-start":return["K_LOPT","K_ROPT","K_BKSP"].indexOf(y.baseKeyID)!=-1;case"longpress":return!0;case"multitap-start":case"modipress-multitap-start":return c.hasMultitaps?!!y.multitap:!1;case"flick-start":return!!y.flick;default:return!0}},n=e.roamingEnabled||(e.roamingEnabled=!c.hasFlicks),i=$(n?ol(e):Lc(e)),r=$(n?ti(e):Ac(e)),s=$(fc(e,!0,n));function l(B,u){B=$(B);var y=B.id;return typeof u=="number"&&(u=[u]),B.contacts.forEach(function(I,F){var U;if(u.indexOf(F)!=-1){var b=(U=I.model.allowsInitialState)!==null&&U!==void 0?U:function(){return!0};I.model=(0,Q.__assign)((0,Q.__assign)({},I.model),{allowsInitialState:function(C,X,Z){return t(Z,y)&&b(C,X,Z)}})}}),B}var o=Ps(),a=gl(),g=[l(s,0),l(sl(e),0),ll(e),i,r,l(o,0),js(e),al(),l(a,0),dl(e),Bl(),Ql(),l(ul(e),0),Fl(e),yl()],d=[s.id,i.id,a.id,o.id];return n?(g.push(l(qs(e),0)),g.push($s())):(g.push(l(Rc(e),0)),g.push(el(e)),g.push(nl(e)),g.push(il(e)),g.push(tl(e)),g.push(cl()),g.push(rl(e)),d.push("flick-start")),{gestures:g,sets:{default:d,modipress:d.filter(function(B){return B!=a.id}),none:[]}}}function $n(){return{itemPriority:0,pathResolutionAction:"reject",pathModel:{evaluate:function(c){return"resolve"}}}}function Jt(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:function(c){return"resolve"}}}}function Ds(c){var e=c.flick;return{itemPriority:1,pathModel:{evaluate:function(t,n,i){var r=t.stats,s=i==null?void 0:i.key.spec;if(s&&s.sk){var l=s.flick,o=l.nw||l.n||l.ne;if(!o){var a=r.netDistance,g=r.angle,d=a*Math.cos(g);if(d>c.longpress.flickDistStart)return"reject"}}return r.netDistance>e.startDist?"resolve":null}},pathResolutionAction:"resolve",pathInheritance:"partial"}}function Jc(c,e){var t,n,i=e.key.spec.flick,r=Object.keys(i),s,l=0;try{for(var o=(0,Q.__values)(r),a=o.next();!a.done;a=o.next()){var g=a.value,d=ye(c,g);d>l&&(l=d,s=g)}}catch(B){t={error:B}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return{dir:s,dist:l}}function Ms(c){return{itemPriority:1,pathModel:{evaluate:function(e,t,n){var i=Jc(e.stats,n),r=i.dir,s=i.dist;if(s>c.flick.dirLockDist){var l=e.stats.angle,o=Me(r),a=Math.abs(l-o),g=Math.abs(2*Math.PI+o-l);if(a<=ze||g<=ze)return"resolve"}else if(e.isComplete)return"reject"}},pathResolutionAction:"resolve",pathInheritance:"full"}}function zs(c){return{itemPriority:1,pathModel:{evaluate:function(e,t,n,i){if(e.isComplete)return"resolve";var r=Jc(i,n).dir;if(ye(e.stats,r)<c.flick.dirLockDist)return"reject"}},pathResolutionAction:"resolve",pathInheritance:"full"}}function Ks(c,e,t){var n=c.longpress;return{itemPriority:0,pathResolutionAction:"resolve",timer:{duration:n.waitLength,expectedResult:!0},validateItem:function(i,r){return!!(r!=null&&r.key.spec.sk)},pathModel:{evaluate:function(i){var r,s,l=i.stats;if(e&&n.permitsFlick(l.lastSample.item)&&((s=((r=l.cardinalDirection)===null||r===void 0?void 0:r.indexOf("n"))!=-1)!==null&&s!==void 0?s:!1)){var o=l.netDistance,a=l.angle,g=o*Math.cos(a);if(g>n.flickDistFinal)return"resolve"}else if(t){if(l.rawDistance>n.noiseTolerance||l.lastSample.item!=l.initialSample.item)return"reject"}else if(l.lastSample.item!=l.initialSample.item)return"reject";return i.isComplete?"reject":null}}}}function Vc(){return{itemPriority:-1,pathResolutionAction:"resolve",pathModel:{evaluate:function(c){return"resolve"}}}}function Os(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:function(c){if(c.isComplete)return"reject"}}}}function vc(){return{itemPriority:-1,itemChangeAction:"resolve",pathResolutionAction:"resolve",pathModel:{evaluate:function(c){if(c.isComplete)return"resolve"}}}}function Ke(c,e){var t,n=(t=c==null?void 0:c.roamingEnabled)!==null&&t!==void 0?t:!0;return{itemPriority:0,itemChangeAction:n?"reject":void 0,pathResolutionAction:"resolve",pathInheritance:!n&&e?"full":"chop",pathModel:{evaluate:function(i){if(i.isComplete&&!i.wasCancelled)return"resolve"}}}}function _s(){return{itemPriority:0,pathResolutionAction:"resolve",pathModel:{evaluate:function(c){if(c.isComplete&&!c.wasCancelled)return"resolve"}}}}function Ps(){return{id:"special-key-start",resolutionPriority:0,contacts:[{model:(0,Q.__assign)({},Jt()),endOnResolve:!1}],resolutionAction:{type:"chain",next:"special-key-end",item:"current"}}}function js(c){return{id:"special-key-end",resolutionPriority:0,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},Ke(c)),{itemChangeAction:"resolve"}),endOnResolve:!0}],resolutionAction:{type:"complete",item:"none"}}}function fc(c,e,t){var n={id:"longpress",resolutionPriority:4,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},Ks(c,e,t)),{itemPriority:1,pathInheritance:"chop"}),endOnResolve:!1},{model:$n(),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"subkey-select",selectionMode:"none",item:"none"}};return t?(0,Q.__assign)((0,Q.__assign)({},n),{rejectionActions:{path:{type:"replace",replace:"longpress-roam"},timer:{type:"replace",replace:"longpress-roam-restore"}}}):n}function qs(c){var e=fc(c,!1,!0);return(0,Q.__assign)((0,Q.__assign)({},e),{id:"longpress-roam"})}function $s(){return{id:"longpress-roam-restore",contacts:[{model:{pathModel:{evaluate:function(c){return null}},itemChangeAction:"reject",pathInheritance:"full",pathResolutionAction:"reject",itemPriority:0}}],resolutionPriority:-1,rejectionActions:{item:{type:"replace",replace:"longpress-roam"}},resolutionAction:{type:"chain",next:"longpress-roam"}}}function Rc(c){return{id:"flick-start",resolutionPriority:3,contacts:[{model:Ds(c)}],resolutionAction:{type:"chain",item:"none",next:"flick-mid"}}}function tl(c){var e=Rc(c);return(0,Q.__assign)((0,Q.__assign)({},e),{contacts:[(0,Q.__assign)((0,Q.__assign)({},e.contacts[0]),{model:(0,Q.__assign)((0,Q.__assign)({},e.contacts[0].model),{baseCoordReplacer:function(t,n){var i=mc(n),r=Zc(n),s=t.initialSample,l=r(t);if(l>c.flick.triggerDist)return i;var o=c.flick.dirLockDist;if(l<o)return s;var a=o/l,g=s.clientX-i.clientX,d=s.clientY-i.clientY;return{clientX:i.clientX+g*a,clientY:i.clientY+d*a}}})})],id:"flick-restart",sustainWhenNested:!0,rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}}})}function el(c){return{id:"flick-mid",resolutionPriority:0,contacts:[{model:Ms(c),endOnReject:!0},{model:$n(),resetOnInstantFulfill:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset-end"}},resolutionAction:{type:"chain",item:"none",next:"flick-end"},sustainWhenNested:!0}}function nl(c){return{id:"flick-reset",resolutionPriority:1,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},Jt()),{pathInheritance:"partial"})}],resolutionAction:{type:"chain",next:"flick-reset-centering"},sustainWhenNested:!0}}function il(c){return{id:"flick-reset-centering",resolutionPriority:1,contacts:[{model:{pathModel:{evaluate:function(e,t,n){t||(t=e.stats);var i=Zc(n),r=i(e.stats),s=i(t);if(s<r)return"resolve"}},itemPriority:0,pathResolutionAction:"resolve",pathInheritance:"full"}}],resolutionAction:{type:"chain",next:"flick-restart"},sustainWhenNested:!0}}function cl(){return{id:"flick-reset-end",resolutionPriority:1,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"complete",item:"base"},sustainWhenNested:!0}}function rl(c){return{id:"flick-end",resolutionPriority:0,contacts:[{model:zs(c)},{model:Jt(),resetOnInstantFulfill:!0}],rejectionActions:{path:{type:"replace",replace:"flick-reset"}},resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}function sl(c){return{id:"multitap-start",resolutionPriority:2,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},Jt()),{itemPriority:1,pathInheritance:"reject",allowsInitialState:function(e,t,n){return e.item==n}})}],sustainTimer:{duration:c.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"multitap-end",item:"current"}}}function ll(c){return{id:"multitap-end",resolutionPriority:2,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},Ke(c)),{itemPriority:1,timer:{duration:c.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Jt(),resetOnInstantFulfill:!0}],rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"none"}}}function Lc(c){return{id:"initial-tap",resolutionPriority:1,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},Ke(c)),{pathInheritance:"chop",itemPriority:1,timer:{duration:c.multitap.holdLength,expectedResult:!1}}),endOnResolve:!0},{model:Jt(),resetOnInstantFulfill:!0}],sustainWhenNested:!0,rejectionActions:{timer:{type:"replace",replace:"simple-tap"}},resolutionAction:{type:"chain",next:"multitap-start",item:"base"}}}function Ac(c){return{id:"simple-tap",resolutionPriority:1,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},Ke(c,!0)),{itemPriority:1}),endOnResolve:!0},{model:Jt(),resetOnInstantFulfill:!0}],sustainWhenNested:!0,resolutionAction:{type:"complete",item:"base"}}}function ol(c){var e=Lc(c);return(0,Q.__assign)((0,Q.__assign)({},e),{rejectionActions:(0,Q.__assign)((0,Q.__assign)({},e.rejectionActions),{item:{type:"replace",replace:"initial-tap"}})})}function ti(c){var e=Ac(c);return(0,Q.__assign)((0,Q.__assign)({},e),{rejectionActions:(0,Q.__assign)((0,Q.__assign)({},e.rejectionActions),{item:{type:"replace",replace:"simple-tap"}})})}function al(){return{id:"subkey-select",resolutionPriority:0,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},_s()),{pathInheritance:"full",itemPriority:1}),endOnResolve:!0,endOnReject:!0}],resolutionAction:{type:"complete",item:"current"},sustainWhenNested:!0}}function gl(){return{id:"modipress-start",resolutionPriority:5,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},Vc()),{allowsInitialState:function(c,e,t){return Ie(t)},itemChangeAction:"reject",itemPriority:1})}],resolutionAction:{type:"chain",next:"modipress-hold",selectionMode:"modipress",item:"current"}}}function dl(c){return{id:"modipress-hold",resolutionPriority:5,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},Os()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:c.multitap.holdLength,expectedResult:!0,inheritElapsed:!0}})},{model:(0,Q.__assign)({},Jt()),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"},rejectionActions:{path:{type:"replace",replace:"modipress-end-multitap-transition"}}}}function Ql(){return{id:"modipress-end-multitap-transition",resolutionPriority:5,contacts:[],sustainTimer:{duration:0,expectedResult:!0},resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"}}}function Bl(){return{id:"modipress-end",resolutionPriority:5,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},vc()),{itemChangeAction:"reject",pathInheritance:"full"})}],resolutionAction:{type:"complete",item:"none",awaitNested:!0}}}function ul(c){return{id:"modipress-multitap-start",resolutionPriority:6,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},Vc()),{pathInheritance:"reject",allowsInitialState:function(e,t,n){return e.item!=n?!1:Ie(n)},itemChangeAction:"reject",itemPriority:1})}],sustainTimer:{duration:c.multitap.waitLength,expectedResult:!1,baseItem:"base"},resolutionAction:{type:"chain",next:"modipress-multitap-end",selectionMode:"modipress",item:"current"}}}function Fl(c){return{id:"modipress-multitap-end",resolutionPriority:5,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},vc()),{itemChangeAction:"reject",pathInheritance:"full",timer:{duration:c.multitap.holdLength,expectedResult:!1}})},{model:(0,Q.__assign)({},$n()),resetOnInstantFulfill:!0}],resolutionAction:{type:"chain",next:"modipress-multitap-start",item:"none"},rejectionActions:{timer:{type:"replace",replace:"modipress-multitap-lock-transition"},path:{type:"replace",replace:"modipress-multitap-lock-transition"}}}}function yl(){return{id:"modipress-multitap-lock-transition",resolutionPriority:5,contacts:[{model:(0,Q.__assign)((0,Q.__assign)({},Jt()),{pathResolutionAction:"resolve"})}],resolutionAction:{type:"chain",next:"modipress-end",selectionMode:"modipress",item:"none"}}}var Sc=(0,Q.__assign)((0,Q.__assign)({},$(ti(null))),{resolutionAction:{type:"complete",item:"current"}}),Hc={gestures:[Sc],sets:{default:[Sc.id]}};function Oe(c){var e;return typeof c=="string"?e=c:(e=c.style.fontSize,e||(e=getComputedStyle(c).fontSize)),new J(e)}function Wc(c,e,t){if(c.touchable){var n=c.formFactor=="phone"?1.6*(t?.65:.6)*1.2:2;return J.special(n,"em")}else return e?J.inPixels(e/8):void 0}var Ue;function _e(c,e,t){t={fontFamily:t.fontFamily,fontSize:t.fontSize},t.fontFamily||(t.fontFamily=getComputedStyle(document.body).fontFamily),(!t.fontSize||t.fontSize=="")&&(t.fontSize="1em");var n=t.fontFamily,i=Oe(t.fontSize),r;i.absolute?r=i.val+"px":r=i.val*e+"px",Ue=Ue!=null?Ue:document.createElement("canvas");var s=Ue.getContext("2d");s.font=r+" "+n;var l=s.measureText(c);return l}var Il=10,Nc=function(){function c(e,t){this.totalLength=0,this.baseCoord=e,this.curCoord=e,this.baseScrollLeft=t,this.totalLength=0}return c.prototype.updateTo=function(e){var t=this.curCoord;this.curCoord=e;var n=this.baseCoord.targetX-this.curCoord.targetX+this.baseScrollLeft;return this.totalLength+=Math.abs(this.curCoord.targetX-t.targetX),n},Object.defineProperty(c.prototype,"hasScrolled",{get:function(){return this.totalLength>Il},enumerable:!1,configurable:!0}),c}();var Ec="kmw-suggest-touched",Ul="kmw-suggest-banner-scroller",kc=.666,Tc="swallow-fade-transition",bl=function(){function c(e,t){this.index=e,this.rtl=t!=null?t:!1,this.constructRoot();var n=this.display=E("span");n.className="kmw-suggestion-text",this.container.appendChild(n)}return Object.defineProperty(c.prototype,"computedStyle",{get:function(){return getComputedStyle(this.display)},enumerable:!1,configurable:!0}),c.prototype.constructRoot=function(){var e=this.div=E("div");e.className="kmw-suggest-option",e.id=c.BASE_ID+this.index,this.div.suggestion=this;var t=this.container=document.createElement("div");t.className="kmw-suggestion-container";var n=100-Nt.MARGIN*(Nt.LONG_SUGGESTION_DISPLAY_LIMIT-1),i=n/Nt.LONG_SUGGESTION_DISPLAY_LIMIT;t.style.minWidth=i+"%",e.appendChild(t)},c.prototype.matchKeyboardProperties=function(e){var t=this.div;if(e){e.KLC&&(t.lang=e.KLC);var n=e.KFont;n&&n.family&&n.family!=""&&(t.style.fontFamily=n.family)}},Object.defineProperty(c.prototype,"suggestion",{get:function(){return this._suggestion},enumerable:!1,configurable:!0}),c.prototype.update=function(e,t){this._suggestion=e;var n=this.generateSuggestionText(this.rtl);if(this.container.replaceChild(n,this.display),this.display=n,t.minWidth!==void 0&&(this._minWidth=t.minWidth),this._paddingWidth=t.paddingWidth,this._collapsedWidth=t.collapsedWidth,e&&e.displayAs){var i=_e(e.displayAs,t.emSize,t.styleForFont);this._textWidth=i.width}else this._textWidth=0;this.currentWidth=this.collapsedWidth,this.updateLayout()},c.prototype.updateLayout=function(){if(!this.suggestion&&this.index!=0){this.div.style.width="0px";return}else this.div.style.width="";var e=this.container.style;e.minWidth=this.collapsedWidth+"px",this.rtl?e.marginRight=this.collapsedWidth-this.expandedWidth+"px":e.marginLeft=this.collapsedWidth-this.expandedWidth+"px",this.updateFade()},c.prototype.updateFade=function(){var e=this;this.div.classList.add(Tc),window.requestAnimationFrame(function(){e.div.classList.remove(Tc)}),this.div.classList.add("kmw-hide-fade-".concat(this.rtl?"left":"right"));var t="kmw-hide-fade-".concat(this.rtl?"right":"left");this.expandedWidth-this.collapsedWidth?this.div.classList.remove(t):this.div.classList.add(t)},Object.defineProperty(c.prototype,"targetCollapsedWidth",{get:function(){return this._collapsedWidth},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"textWidth",{get:function(){return this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"paddingWidth",{get:function(){return this._paddingWidth},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"minWidth",{get:function(){return this._minWidth},set:function(e){this._minWidth=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"expandedWidth",{get:function(){return this.minWidth>this.spanWidth?this.minWidth:this.spanWidth},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"spanWidth",{get:function(){var e,t,n=(e=this.textWidth)!==null&&e!==void 0?e:0;return n&&(n+=(t=this.paddingWidth)!==null&&t!==void 0?t:0),n},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"collapsedWidth",{get:function(){var e=this.spanWidth<this.targetCollapsedWidth?this.spanWidth:this.targetCollapsedWidth,t=e<this.expandedWidth?e:this.expandedWidth;return this.minWidth>t?this.minWidth:t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"currentWidth",{get:function(){return this.div.offsetWidth},set:function(e){e<this.collapsedWidth?e=this.collapsedWidth:e>this.expandedWidth&&(e=this.expandedWidth),this.rtl?this.container.style.marginRight="".concat(e-this.expandedWidth,"px"):this.container.style.marginLeft="".concat(e-this.expandedWidth,"px")},enumerable:!1,configurable:!0}),c.prototype.highlight=function(e){var t=this.div;e?t.classList.add(Ec):t.classList.remove(Ec)},c.prototype.isEmpty=function(){return!this._suggestion},c.prototype.generateSuggestionText=function(e){var t=this._suggestion,n,i=E("span");if(i.className="kmw-suggestion-text",t==null)return i;if(t.displayAs==null||t.displayAs=="")n="\xA0";else{var r=e?8238:8237;n=String.fromCharCode(r)+t.displayAs}return i.innerHTML=n,i},c.BASE_ID="kmw-suggestion-",c}();var Nt=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=c.call(this,n||It.DEFAULT_HEIGHT)||this;return i.type="suggestion",i.currentSuggestions=[],i.options=[],i.separators=[],i.isRTL=!1,i.onSuggestionUpdate=function(r){var s;i.currentSuggestions=r,(s=i.highlightAnimation)===null||s===void 0||s.cancel();for(var l=i.options[0].computedStyle,o={fontSize:l.fontSize,fontFamily:l.fontFamily},a=getComputedStyle(document.body).fontSize,g=Oe(a).val,d=getComputedStyle(i.options[0].container.firstChild),B=i.width/e.LONG_SUGGESTION_DISPLAY_LIMIT,u=new J(d.paddingLeft||"4px"),y=new J(d.paddingRight||"4px"),I={paddingWidth:u.val+y.val,emSize:g,styleForFont:o,collapsedWidth:B,minWidth:0},F=0;F<e.SUGGESTION_LIMIT;F++){var U=i.options[F];if(r.length>F){var b=r[F];U.update(b,I)}else U.update(null,I)}i.refreshLayout()},i.refreshLayout=function(){for(var r=[],s=0,l=Math.min(i.currentSuggestions.length,8),o=0;o<l;o++){var a=i.options[o];a.minWidth=0,s+=a.collapsedWidth,a.collapsedWidth<a.expandedWidth&&r.push(a)}if(l=l||1,s<i.width){for(var g=i.width*.01*(l-1),d=function(){var y=(i.width-s-g)/r.length;r.sort(function(b,C){return b.expandedWidth-C.expandedWidth});var I=r[0],F=I.expandedWidth-I.collapsedWidth,U=Math.min(F,y);U>0&&(r.forEach(function(b){return b.minWidth=b.collapsedWidth+U}),s+=U*r.length),r.splice(0,1)};s<i.width&&r.length>0;)d();for(var B=(i.width-s-g)/l,o=0;o<l;o++){var u=i.options[o];u.minWidth=u.collapsedWidth+B,u.updateLayout()}}for(var o=0;o<e.SUGGESTION_LIMIT-1;o++)i.separators[o].style.display=o<l-1?"":"none"},i.getDiv().className=i.getDiv().className+" "+e.BANNER_CLASS,i.container=document.createElement("div"),i.container.className=Ul,i.getDiv().appendChild(i.container),i.buildInternals(!1),i.gestureEngine=i.setupInputHandling(),i}return e.prototype.shutdown=function(){this.gestureEngine.destroy()},e.prototype.buildInternals=function(t){this.isRTL=t,this.options.length>0&&(this.options=[],this.separators=[]);for(var n=0;n<e.SUGGESTION_LIMIT;n++){var i=new bl(n,t);this.options[n]=i}for(var n=0;n<e.SUGGESTION_LIMIT;n++){var r=t?e.SUGGESTION_LIMIT-n-1:n;if(this.container.appendChild(this.options[r].div),t&&(this.container.scrollLeft=this.container.scrollWidth),n!=e.SUGGESTION_LIMIT-1){var s=E("div");s.className="kmw-banner-separator";var l=s.style;l.marginLeft="calc(".concat(e.MARGIN/2,"% - 0.5px)"),l.marginRight="calc(".concat(e.MARGIN/2,"% - 0.5px)"),this.container.appendChild(s),this.separators[r-(t?1:0)]=s}}},e.prototype.setupInputHandling=function(){var t=this,n=new Ut(this.getDiv(),[-Number.MAX_SAFE_INTEGER]);this.selectionBounds=new Ut(this.getDiv(),[-kc*this.height,-Number.MAX_SAFE_INTEGER]);var i={targetRoot:this.getDiv(),maxRoamingBounds:n,safeBounds:n,itemIdentifier:function(a){var g,d,B=t.selectionBounds.getBoundingClientRect();if(a.clientX<B.left||a.clientX>B.right||a.clientY<B.top||a.clientY>B.bottom)return null;var u=null,y=Number.MAX_VALUE;try{for(var I=(0,Q.__values)(t.options),F=I.next();!F.done;F=I.next()){var U=F.value,b=U.div.getBoundingClientRect();if(b.left<=a.clientX&&a.clientX<b.right)return U.suggestion?U:null;var C=(a.clientX<b.left?-1:1)*(a.clientX-b.left);C<y&&(y=C,u=U)}}catch(X){g={error:X}}finally{try{F&&!F.done&&(d=I.return)&&d.call(I)}finally{if(g)throw g.error}}return u.suggestion?u:null}},r=new Fe(Hc,i),s={source:null,scrollingHandler:null,suggestion:null},l=function(a){a.highlight(!0),t.highlightAnimation&&(t.highlightAnimation.cancel(),t.highlightAnimation.decouple()),t.highlightAnimation=new Yc(t.container,a,!1),t.highlightAnimation.expand()},o=function(a){a.highlight(!1),t.highlightAnimation||(t.highlightAnimation=new Yc(t.container,a,!1)),t.highlightAnimation.collapse()};return r.on("inputstart",function(a){if(s.source){a.terminate(!0);return}t.scrollState=new Nc(a.currentSample,t.container.scrollLeft);var g=a.baseItem;s.source=a,s.scrollingHandler=function(B){var u,y=t.scrollState.updateTo(B);(u=t.highlightAnimation)===null||u===void 0||u.setBaseScroll(y);var I=B.item?g:null;I!=s.suggestion&&(s.suggestion&&o(s.suggestion),s.suggestion=I,I&&l(I))},s.suggestion=a.currentSample.item,s.suggestion&&l(s.suggestion);var d=function(){s.suggestion&&(o(s.suggestion),s.suggestion=null),s.source=null,s.scrollingHandler=null};a.path.on("complete",d),a.path.on("invalidated",d),a.path.on("step",s.scrollingHandler)}),r.on("recognizedgesture",function(a){a.once("stage",function(g){var d=g.item;d&&!t.scrollState.hasScrolled&&t.predictionContext.accept(d.suggestion).then(function(){t.container.scrollLeft=t.isRTL?t.container.scrollWidth:0}),t.scrollState=null})}),r},e.prototype.update=function(){var t,n=c.prototype.update.call(this);return(t=this.selectionBounds)===null||t===void 0||t.updatePadding([-kc*this.height,-Number.MAX_SAFE_INTEGER]),n},e.prototype.configureForKeyboard=function(t,n){var i=t.isRTL;this.container.textContent="",this.buildInternals(i),this.options.forEach(function(r){return r.matchKeyboardProperties(n)}),this.onSuggestionUpdate(this.currentSuggestions)},Object.defineProperty(e.prototype,"predictionContext",{get:function(){return this._predictionContext},set:function(t){this._predictionContext&&this._predictionContext.off("update",this.onSuggestionUpdate),this._predictionContext=t,t&&(t.on("update",this.onSuggestionUpdate),this.onSuggestionUpdate(t.currentSuggestions))},enumerable:!1,configurable:!0}),e.SUGGESTION_LIMIT=8,e.LONG_SUGGESTION_DISPLAY_LIMIT=3,e.MARGIN=1,e}(It);var Yc=function(){function c(e,t,n){var i=this;this.setScrollOffset=function(){if(!!i.scrollContainer){var r=i.option.currentWidth-i.option.collapsedWidth,s=i.option.rtl,l=Math.max(i.rootScrollOffset-i.option.div.offsetLeft,0),o=Math.max(i.option.div.offsetLeft+i.option.collapsedWidth-(i.rootScrollOffset+i.scrollContainer.offsetWidth)),a=Math.max(s?o:l,0),g=Math.max(i.collapsedScrollOffset+(s?0:1)*r,0)+(s?0:-1)*a,d=Math.max(i.rootScrollOffset+(s?0:1)*r,0)+(s?0:-1)*a,B=s?Math.max(g,d):Math.min(g,d),u=Math.max(s?i.option.div.offsetLeft+i.option.currentWidth-(B+i.scrollContainer.offsetWidth):B-i.option.div.offsetLeft,0),y=Math.min(r,u),I=g+(s?1:-1)*y+(s?0:1)*a;if(i.scrollContainer.scrollLeft=I,i.pendingAnimation){var F=i.scrollContainer.scrollLeft-I;i.option.currentWidth+=F}}},this._expand=function(r){if(i.startTimestamp!==void 0){var s=r-i.startTimestamp,l=s>c.TRANSITION_TIME;l&&(s=c.TRANSITION_TIME);var o=i.option.expandedWidth-i.option.collapsedWidth,a=s/c.TRANSITION_TIME,g=o*a;i.option.currentWidth=g+i.option.collapsedWidth,l?i.clear():i.pendingAnimation=window.requestAnimationFrame(i._expand),i.setScrollOffset()}},this._collapse=function(r){if(i.startTimestamp!==void 0){var s=r-i.startTimestamp,l=s>c.TRANSITION_TIME;l&&(s=c.TRANSITION_TIME);var o=i.option.expandedWidth-i.option.collapsedWidth,a=1-s/c.TRANSITION_TIME,g=o*a;i.option.currentWidth=g+i.option.collapsedWidth,l?i.clear():i.pendingAnimation=window.requestAnimationFrame(i._collapse),i.setScrollOffset()}},this.scrollContainer=e,this.option=t,this.collapsedScrollOffset=e.scrollLeft,this.rootScrollOffset=e.scrollLeft}return c.prototype.setBaseScroll=function(e){this.collapsedScrollOffset=e,this.option.rtl?e>this.rootScrollOffset&&(this.rootScrollOffset=e):e<this.rootScrollOffset&&(this.rootScrollOffset=e),window.requestAnimationFrame(this.setScrollOffset)},c.prototype.decouple=function(){this.cancel(),this.scrollContainer=null},c.prototype.clear=function(){this.startTimestamp=null,window.cancelAnimationFrame(this.pendingAnimation),this.pendingAnimation=null},c.prototype.cancel=function(){this.clear(),this.option.currentWidth=this.option.collapsedWidth},c.prototype.expand=function(){this.clear(),this.startTimestamp=performance.now();var e=this.option.currentWidth-this.option.collapsedWidth,t=this.option.expandedWidth-this.option.collapsedWidth;e!=0&&(this.startTimestamp-=e/t*c.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._expand)},c.prototype.collapse=function(){this.clear(),this.startTimestamp=performance.now();var e=this.option.expandedWidth-this.option.currentWidth,t=this.option.expandedWidth-this.option.collapsedWidth;e!=0&&(this.startTimestamp-=e/t*c.TRANSITION_TIME),this.pendingAnimation=window.requestAnimationFrame(this._collapse)},c.TRANSITION_TIME=250,c}();var wc=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this)||this;n.type="html";var i=n.getDiv(),r=document.createElement("div");return r.style.userSelect="none",r.style.height="100%",r.style.width="100%",i.appendChild(r),n.container=r.attachShadow?r.attachShadow({mode:"closed"}):r,n.container.innerHTML=t,n}return Object.defineProperty(e.prototype,"innerHTML",{get:function(){return this.container.innerHTML},set:function(t){this.container.innerHTML=t},enumerable:!1,configurable:!0}),e}(It);var ei=function(){function c(e,t,n){this.ImageBanner=gc,this.HTMLBanner=wc,this.hostDevice=t,this.container=e,this.predictionContext=n,this.inactiveBanner=new Pt}return Object.defineProperty(c.prototype,"inactiveBanner",{get:function(){return this._inactiveBanner},set:function(e){this._inactiveBanner=e!=null?e:new Pt,this.container.banner instanceof Nt||(this.container.banner=this._inactiveBanner)},enumerable:!1,configurable:!0}),c.prototype.activateBanner=function(e){var t=this.container.banner;if(t instanceof Nt&&(t.predictionContext=null),!e)this.container.banner=this.inactiveBanner;else{var n=new Nt(this.hostDevice,this.container.activeBannerHeight);n.predictionContext=this.predictionContext,this.container.banner=n}},c.prototype.selectBanner=function(e){this.activateBanner(e=="active"||e=="configured"),this.keyboard&&this.container.banner.configureForKeyboard(this.keyboard,this.keyboardStub)},c.prototype.configureForKeyboard=function(e,t){this.keyboard=e,this.keyboardStub=t,this.container.banner.configureForKeyboard(e,t)},c.prototype.shutdown=function(){this.container.banner instanceof Nt&&(this.container.banner.predictionContext=null)},c}();var hl=function(){function c(){var e=this.element=document.createElement("div");e.style.userSelect="none",e.className="kmw-osk-none"}return c.prototype.postInsert=function(){},c.prototype.updateState=function(){},c.prototype.refreshLayout=function(){},Object.defineProperty(c.prototype,"layoutHeight",{get:function(){return J.inPixels(0)},enumerable:!1,configurable:!0}),c}(),be=hl;var Cl=function(){function c(e){this.kbd=e;var t=this.element=document.createElement("div");t.style.userSelect="none",t.className="kmw-osk-static",t.id=c.ID,t.innerHTML=e.helpText}return c.prototype.postInsert=function(){if(!this.element.parentElement||!document.getElementById(c.ID))throw new Error("The HelpPage root element has not yet been inserted into the DOM.");this.kbd.hasScript&&this.kbd.embedScript(this.element.parentElement)},c.prototype.updateState=function(){},c.prototype.refreshLayout=function(){},Object.defineProperty(c.prototype,"layoutHeight",{get:function(){return J.inPercent(100)},enumerable:!1,configurable:!0}),c.ID="kmw-osk-help-page",c}(),Dc=Cl;var Xl={"*Shift*":8,"*Enter*":5,"*Tab*":6,"*BkSp*":4,"*Menu*":11,"*Hide*":10,"*Alt*":25,"*Ctrl*":1,"*Caps*":3,"*ABC*":16,"*abc*":17,"*123*":19,"*Symbol*":21,"*Currency*":20,"*Shifted*":9,"*AltGr*":2,"*TabLeft*":7,"*LAlt*":86,"*RAlt*":87,"*LCtrl*":88,"*RCtrl*":89,"*LAltCtrl*":96,"*RAltCtrl*":97,"*LAltCtrlShift*":98,"*RAltCtrlShift*":99,"*AltShift*":100,"*CtrlShift*":101,"*AltCtrlShift*":102,"*LAltShift*":103,"*RAltShift*":104,"*LCtrlShift*":105,"*RCtrlShift*":112,"*LTREnter*":5,"*LTRBkSp*":4,"*RTLEnter*":113,"*RTLBkSp*":114,"*ShiftLock*":115,"*ShiftedLock*":116,"*ZWNJ*":117,"*ZWNJiOS*":117,"*ZWNJAndroid*":118,"*ZWNJGeneric*":121,"*Sp*":128,"*NBSp*":130,"*NarNBSp*":131,"*EnQ*":132,"*EmQ*":133,"*EnSp*":134,"*EmSp*":135,"*PunctSp*":140,"*ThSp*":141,"*HSp*":142,"*ZWSp*":129,"*ZWJ*":119,"*WJ*":120,"*CGJ*":122,"*LTRM*":144,"*RTLM*":145,"*SH*":161,"*HTab*":162},ni=Xl;var xl=["default","shift","shift-on","special","special-on","","","","deadkey","blank","hidden"],Dt=xl;function Mt(c,e){switch(c){case"*ZWNJ*":c=e.device.OS==v.OperatingSystem.Android?"*ZWNJAndroid*":"*ZWNJiOS*";break;case"*Enter*":c=e.isRTL?"*RTLEnter*":"*LTREnter*";break;case"*BkSp*":c=e.isRTL?"*RTLBkSp*":"*LTRBkSp*";break;default:}var t=ni[c],n=57344+t;return t?String.fromCharCode(n):c}var Gl=function(){function c(e,t){this.spec=e,this.layer=t}return c.prototype.setButtonClass=function(){var e,t=this.spec,n=this.btn,i=0;typeof t.dk=="string"&&t.dk=="1"&&(i=8),i=(e=t.sp)!==null&&e!==void 0?e:i,(i<0||i>10)&&(i=0),n.className="kmw-key kmw-key-"+Dt[i]},c.prototype.setToggleState=function(e){var t;switch(t=this.spec.sp,Dt[t]){case"shift":case"shift-on":e===void 0&&(e=Dt[t]=="shift"),this.spec.sp=1+(e?1:0);break;case"special":case"special-on":e===void 0&&(e=Dt[t]=="special"),this.spec.sp=3+(e?1:0);break;default:return}this.setButtonClass()},c.prototype.isFrameKey=function(){var e=this.spec.sp||0;switch(Dt[e]){case"default":case"deadkey":return!1;default:return!0}},c.prototype.allowsKeyTip=function(){return this.isFrameKey()?!1:!this.btn.classList.contains("kmw-spacebar")},c.prototype.highlight=function(e){var t=this.btn.classList;e?t.contains(c.HIGHLIGHT_CLASS)||t.add(c.HIGHLIGHT_CLASS):t.remove(c.HIGHLIGHT_CLASS)},c.prototype.getIdealFontSize=function(e,t,n){if(!this._fontFamily)return new J("1em");n!=null||(n=1);var i=t.keyWidth,r=t.keyHeight,s=t.baseEmFontSize.scaledBy(t.layoutFontSize.val),l=this._fontSize;l.absolute||(l=s.scaledBy(l.val));var o={fontFamily:this._fontFamily,fontSize:l.styleString,height:t.keyHeight},a=_e(e,s.scaledBy(n).val,o),g=.9,d=.9,B=2,u;a.fontBoundingBoxAscent&&(u=a.fontBoundingBoxAscent+a.fontBoundingBoxDescent);var y=u!=null?u:0,I=i*g/(a.width+B),F=y&&r?r*d/y:void 0,U=I;return F&&F<I&&(U=F),J.forScalar(n*Math.min(U,1))},Object.defineProperty(c.prototype,"keyText",{get:function(){var e=this.spec,t="\xA0",n=null;return e.text==null||e.text==""?n=t:(n=e.text,n=="*Tab*"&&this.layer=="shift"&&(n="*TabLeft*")),n},enumerable:!1,configurable:!0}),c.prototype.generateKeyText=function(e){var t=this.spec,n=document.createElement("span"),i=n.style;n.className="kmw-key-text";var r=this.keyText,s=Mt(r,e);s!=r&&(r=s,t.font="SpecialOSK"),typeof t.font=="string"&&t.font!=""&&(i.fontFamily=t.font),typeof t.fontsize=="string"&&t.fontsize!=""&&(i.fontSize=t.fontsize);var l={fontSize:i.fontSize};return i.fontFamily?l.fontFamily=i.fontFamily:l.fontFamily=e.fontFamily,e.isRTL&&(r="\u200F"+r),n.innerText=r,n},c.prototype.resetFontPrecalc=function(){this._fontFamily=void 0,this._fontSize=void 0,this.label.style.fontSize=""},c.prototype.detectStyles=function(e){if(!(this.spec.sp==10||this.spec.sp==9)&&this._fontFamily===void 0){var t=getComputedStyle(this.label);if(!t.fontFamily)return;this._fontFamily=t.fontFamily;var n=new J(t.fontSize),i=e.layoutFontSize;if(i.absolute)this._fontSize=n;else{var r=e.baseEmFontSize,s=i.scaledBy(r.val),l=n.val/s.val;this._fontSize=J.forScalar(l)}}},c.prototype.refreshLayout=function(e){if(this.label)if(this.label.classList.contains("kmw-spacebar-caption")){var n=this.getIdealFontSize(this.keyText,e);this.label.style.setProperty("font-size",n.styleString,"important")}else{var t=this.label.textContent,n=this.getIdealFontSize(t,e);this.label.style.fontSize=n.styleString}},c.specialCharacters=ni,c.BUTTON_CLASSES=Dt,c.HIGHLIGHT_CLASS="kmw-key-touched",c}(),Et=Gl;var Pe=function(){function c(e,t){this.key=e,this.keyId=t}return c}();function je(c,e){var t=c;for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n]);return t}function pl(c){return c&&"key"in c&&c.key instanceof Et}function qe(c){return pl(c)?c:null}var ml=function(c){(0,Q.__extends)(e,c);function e(t,n,i){var r=c.call(this,t,n)||this;return r.row=i,r}return e.prototype.getId=function(){return this.spec.elementID},e.prototype.getCoreId=function(){return this.spec.coreID},e.prototype.getBaseId=function(){return this.spec.baseKeyID},e.prototype.generateKeyCapLabel=function(){var t=h.keyCodes[this.spec.baseKeyID];switch(t){case 186:t=59;break;case 187:t=61;break;case 188:t=44;break;case 189:t=45;break;case 190:t=46;break;case 191:t=47;break;case 192:t=96;break;case 219:t=91;break;case 220:t=92;break;case 221:t=93;break;case 222:t=39;break;default:(t<48||t>90)&&(t=0)}var n=document.createElement("div");return n.className="kmw-key-label",t>0&&(n.innerText=String.fromCharCode(t)),n},e.prototype.processSubkeys=function(t,n){var i,r=t.subKeys=this.spec.sk;for(i=0;i<r.length;i++){if(r[i].sp==1||r[i].sp==2){var s=r[i].text;r[i].text=Mt(s,n)}r[i].layer||(r[i].layer=t.key.layer)}},e.prototype.construct=function(t){var n=this.spec,i=document.createElement("div");i.className="kmw-key-square";var r=document.createElement("div"),s=this.btn=je(r,new Pe(this,n.id));this.setButtonClass();var l=this.capLabel=this.generateKeyCapLabel();s.appendChild(l),s.id=this.getId(),s.appendChild(this.label=this.generateKeyText(t)),typeof n.sk!="undefined"&&n.sk!=null?this.processSubkeys(s,t):s.subKeys=null;var o=this.generateHint(t);return s.appendChild(o),i.appendChild(s),this.preview=document.createElement("div"),this.preview.style.display="none",s.appendChild(this.preview),this.square=i},e.prototype.generateHint=function(t){var n=document.createElement("div");n.className="kmw-key-popup-icon";var i=this.spec.hintSrc;if(!i)return n;if(i.font&&i.font!="SpecialOSK"?n.style.fontFamily=i.font:n.classList.add("kmw-key-text"),i.fontsize){var r=new J(i.fontsize);n.style.fontSize=r.scaledBy(.5).styleString}var s=i==this.spec?this.spec.hint:i.text,l=Mt(s,t);return l=="\u2022"&&(n.style.fontWeight="bold"),s!=l&&(n.style.fontFamily="SpecialOSK"),n.textContent=l,n},e.prototype.setPreview=function(t){var n=this,i=this.preview;t?(this.previewHost=t,this.preview=this.previewHost.element):(this.previewHost=null,this.preview=document.createElement("div"),this.preview.style.display="none"),t==null||t.setCancellationHandler(function(){n.setPreview(null)}),this.btn.replaceChild(this.preview,i)},e.prototype.refreshLayout=function(t){c.prototype.refreshLayout.call(this,t);var n=t.baseEmFontSize;n.val<12?this.capLabel.style.fontSize="6px":this.capLabel.style.fontSize=J.forScalar(.5).styleString},Object.defineProperty(e.prototype,"displaysKeyCap",{get:function(){return this.capLabel&&this.capLabel.style.display=="block"},set:function(t){if(!this.capLabel)throw new Error("Key element not yet constructed; cannot display key cap");this.capLabel.style.display=t?"block":"none"},enumerable:!1,configurable:!0}),e}(Et),Mc=ml;var $e=.15,Zl=function(){function c(e,t,n){var i=this.element=document.createElement("div");i.className="kmw-key-row",this.heightFraction=1/t.row.length;var r=n.key;this.spec=n,this.keys=[];for(var s=0;s<r.length;s++){var l=r[s],o=new Mc(l,t.id,this),a=o.construct(e);this.keys.push(o),i.appendChild(a)}}return Object.defineProperty(c.prototype,"displaysKeyCaps",{get:function(){if(this.keys.length>0)return this.keys[0].displaysKeyCap},set:function(e){var t,n;try{for(var i=(0,Q.__values)(this.keys),r=i.next();!r.done;r=i.next()){var s=r.value;s.displaysKeyCap=e}}catch(l){t={error:l}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},enumerable:!1,configurable:!0}),c.prototype.refreshLayout=function(e){var t=this.element.style,n=e.heightStyle.scaledBy(this.heightFraction);t.maxHeight=t.lineHeight=t.height=n.styleString;var i=e.heightStyle.absolute?n:J.forScalar(1),r=i.scaledBy($e/2),s=i.scaledBy(1-$e);this.keys.forEach(function(l){var o=l.square,a=l.btn,g=o.style;g.height=g.minHeight=i.styleString;var d=a.style;d.top=r.styleString,d.height=d.lineHeight=d.minHeight=s.styleString})},c.prototype.buildKeyLayout=function(e,t){var n=e.widthStyle.scaledBy(t.spec.proportionalWidth),i=e.heightStyle.scaledBy(this.heightFraction).scaledBy(1-$e),r={keyWidth:n.val*(n.absolute?1:e.keyboardWidth),keyHeight:i.val*(i.absolute?1:e.keyboardHeight),baseEmFontSize:e.baseEmFontSize,layoutFontSize:e.layoutFontSize};return r},c.prototype.detectStyles=function(e){var t=this;this.keys.forEach(function(n){n.detectStyles(t.buildKeyLayout(e,n))})},c.prototype.refreshKeyLayouts=function(e){var t=this;this.keys.forEach(function(n){var i,r=n.btn,s=e.widthStyle,l=e.heightStyle,o=s.scaledBy(n.spec.proportionalWidth),a=s.scaledBy(n.spec.proportionalPad),g=l.scaledBy(t.heightFraction).scaledBy(1-$e),d=l.absolute?g.styleString:"100%",B=t.buildKeyLayout(e,n);(i=r.key)===null||i===void 0||i.refreshLayout(B),n.square.style.width=o.styleString,n.square.style.marginLeft=a.styleString,n.btn.style.width=s.absolute?o.styleString:"100%",n.square.style.height=d})},c}(),zc=Zl;var Jl=function(){function c(e,t,n){this.spec=n;var i=this.element=document.createElement("div"),r=i.style;i.className="kmw-key-layer";var s=n.row.length;s>4&&e.device.formFactor=="phone"&&(i.className=i.className+" kmw-5rows"),r.fontFamily="font"in t?t.font:"",this.nextlayer=n.id,i.layer=n.id,typeof n.nextlayer=="string"&&(i.nextLayer=this.nextlayer=n.nextlayer);var l=n.row;this.rows=[];for(var o=0;o<l.length;o++){var a=new zc(e,n,l[o]);a.displaysKeyCaps=t.displayUnderlying,i.appendChild(a.element),this.rows.push(a)}if(e.device.touchable&&(this.globeKey=this.findKey("K_LOPT"),this.hideKey=this.findKey("K_ROPT")),this.spaceBarKey=this.findKey("K_SPACE"),this.capsKey=this.findKey("K_CAPS"),this.numKey=this.findKey("K_NUMLOCK"),this.scrollKey=this.findKey("K_SCROLL"),this.spaceBarKey){var g=this.spaceBarKey.label,d=this.spaceBarKey.btn;typeof d.className=="undefined"||d.className==""?d.className="kmw-spacebar":d.className.indexOf("kmw-spacebar")==-1&&(d.className+=" kmw-spacebar"),g.className!="kmw-spacebar-caption"&&(g.className="kmw-spacebar-caption")}}return Object.defineProperty(c.prototype,"rowHeight",{get:function(){return this._rowHeight},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"id",{get:function(){return this.spec.id},enumerable:!1,configurable:!0}),c.prototype.findKey=function(e){var t,n,i,r;try{for(var s=(0,Q.__values)(this.rows),l=s.next();!l.done;l=s.next()){var o=l.value;try{for(var a=(i=void 0,(0,Q.__values)(o.keys)),g=a.next();!g.done;g=a.next()){var d=g.value;if(d.getBaseId()==e)return d}}catch(B){i={error:B}}finally{try{g&&!g.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}}}catch(B){t={error:B}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return null},c.prototype.showLanguage=function(e){if(!!this.spaceBarKey)try{var t=this.spaceBarKey.label;this.spaceBarKey.spec.text=e,(t.innerText!=e||e=="")&&(t.innerText=e)}catch(n){}},c.prototype.refreshLayout=function(e){var t,n;this.rows.forEach(function(y){return y.detectStyles(e)});var i=e.keyboardHeight,r=this.rows.length,s=this._rowHeight=Math.floor(i/(r==0?1:r)),l=e.widthStyle.absolute;l&&(this.element.style.height=i+"px"),this.showLanguage(e.spacebarText);for(var o=0;o<r;o++){var a=this.rows[o],g=(r-o-1)*s+1;l&&(this.spec.row[o].proportionalY=(i-g-s/2)/i),a.refreshLayout(e),o==r-1&&(a.element.style.bottom="1px")}try{for(var d=(0,Q.__values)(this.rows),B=d.next();!B.done;B=d.next()){var u=B.value;u.refreshKeyLayouts(e)}}catch(y){t={error:y}}finally{try{B&&!B.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}},c}(),Kc=Jl;var Vl=.06,vl=function(){function c(e,t,n){this.layers={},this._activeLayerId="default";var i=t.layout(n);this.spec=i;var r=this.element=document.createElement("div"),s=r.style;if(r.className="kmw-key-layer-group",i!=null){var l=i.fontsize;typeof l=="undefined"||l==null||l==""?s.fontSize="1em":s.fontSize=i.fontsize,s.width="100%",s.height="100%";var o,a;a=i.layer;var g=e.getDefaultKeyObject();for(g.fontsize=s.fontSize,o=0;o<a.length;o++){var d=a[o],B=new Kc(e,i,d);this.layers[d.id]=B,B.element.style.display=d.id=="default"?"block":"none",r.appendChild(B.element)}}}return Object.defineProperty(c.prototype,"activeLayer",{get:function(){return this.activeLayerId?this.layers[this.activeLayerId]:null},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"activeLayerId",{get:function(){return this._activeLayerId},set:function(e){var t,n;this._activeLayerId=e;try{for(var i=(0,Q.__values)(Object.keys(this.layers)),r=i.next();!r.done;r=i.next()){var s=r.value,l=this.layers[s],o=l.element;l.id==e?o.style.display="block":o.style.display="none"}}catch(a){t={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},enumerable:!1,configurable:!0}),c.prototype.findNearestKey=function(e){if(!e)return null;var t=e.stateToken;if(!t)throw new Error("Layer id not set for input coordinate");var n=this.layers[t];if(!n)throw new Error("Layer id ".concat(t," could not be found"));return this.nearestKey(e,n)},c.prototype.blinkLayer=function(e){var t=this;if(typeof e=="string"){var n=e;if(e=this.layers[n],!e)throw new Error("Layer id ".concat(n," could not be found"))}var i=e;if(i.element.style.display!="block")for(var r in this.layers){if(this.layers[r].element.style.display=="block"){var s=this.layers[r];s.element.style.display="none"}this.layers[r].element.style.display="none"}i.element.style.display="block",Promise.resolve().then(function(){var l=t.layers[t._activeLayerId];(i.element.style.display=="block"||l.element.style.display!="block")&&(i.element.style.display="none",l.element.style.display="block")})},c.prototype.nearestKey=function(e,t){var n,i;if(t.rows.length==0)return null;var r={x:e.targetX/this.computedWidth,y:e.targetY/this.computedHeight};if(!isFinite(r.x)||!isFinite(r.y))return null;var s=Math.max(0,Math.min(t.rows.length-1,Math.floor(r.y*t.rows.length))),l=t.rows[s],o=null,a=Number.MAX_VALUE;try{for(var g=(0,Q.__values)(l.keys),d=g.next();!d.done;d=g.next()){var B=d.value,u=B.spec;if(!(u.sp==9||u.sp==10)){var y=u.proportionalWidth/2,I=Math.abs(r.x-u.proportionalX);if(I-y<=0)return B.btn;var F=I-y;F<a&&(a=F,o=B)}}}catch(U){n={error:U}}finally{try{d&&!d.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}return a<=Vl?o.btn:null},c.prototype.resetPrecalcFontSizes=function(){var e,t,n,i,r,s;try{for(var l=(0,Q.__values)(Object.values(this.layers)),o=l.next();!o.done;o=l.next()){var a=o.value;try{for(var g=(n=void 0,(0,Q.__values)(a.rows)),d=g.next();!d.done;d=g.next()){var B=d.value;try{for(var u=(r=void 0,(0,Q.__values)(B.keys)),y=u.next();!y.done;y=u.next()){var I=y.value;I.resetFontPrecalc()}}catch(F){r={error:F}}finally{try{y&&!y.done&&(s=u.return)&&s.call(u)}finally{if(r)throw r.error}}}}catch(F){n={error:F}}finally{try{d&&!d.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}}}catch(F){e={error:F}}finally{try{o&&!o.done&&(t=l.return)&&t.call(l)}finally{if(e)throw e.error}}this._heightPadding=void 0},c.prototype.refreshLayout=function(e){if(!(isNaN(e.keyboardWidth)||isNaN(e.keyboardHeight))){if(this.computedWidth=e.keyboardWidth,this.computedHeight=e.keyboardHeight,this._heightPadding===void 0){var t=getComputedStyle(this.element),n=parseInt(t.paddingTop,10)||0,i=parseInt(t.paddingBottom,10)||0;this._heightPadding=n+i}this.activeLayer&&this.activeLayer.refreshLayout(e)}},Object.defineProperty(c.prototype,"verticalPadding",{get:function(){var e;return(e=this._heightPadding)!==null&&e!==void 0?e:0},enumerable:!1,configurable:!0}),c}(),Oc=vl;var _c="kmw-",Pc="top",fl=function(){function c(e,t){var n=this;this.state=!1,this.orientation=Pc,this.vkbd=e;var i=this.element=document.createElement("div");i.className="kmw-keytip",i.id="kmw-keytip",i.style.pointerEvents="none",i.style.display="none",i.appendChild(this.tip=document.createElement("div")),i.appendChild(this.cap=document.createElement("div")),this.tip.appendChild(this.preview=document.createElement("div")),this.tip.className="kmw-keytip-tip",this.cap.className="kmw-keytip-cap",this.constrain=t,this.reorient=function(r){n.orientation=r,n.show(n.key,n.state,n.previewHost)}}return c.prototype.show=function(e,t,n){var i=this,r,s=this.vkbd;if(t&&s.layerGroup.blinkLayer(e.key.spec.displayLayer),t&&e.offsetParent){var l=e.key.row.element,o=e.getClientRects()[0],a=l.getClientRects()[0],g=o.left-a.left,d=o.width,B=o.height,u=1.8,y=this.element.style,I=s.topContainer,F=I.getBoundingClientRect(),U=e.getBoundingClientRect(),b=void 0,C=this.orientation,X=U.bottom-F.top;b=X+(C=="top"?1:-1);var Z=b-Math.floor(b),G=d+Math.ceil(d*.3)*2,p=Math.ceil(2.3*B)+Z;C=="bottom"&&(b+=p-B),y.top="auto";var f=C=="top"?"bottom":"top";this.tip.classList.remove("".concat(_c).concat(f)),this.tip.classList.add("".concat(_c).concat(C)),y.bottom=Math.floor(F.height-b)+"px",y.textAlign="center",y.overflow="visible",y.width=G+"px",y.height=p+"px";var m=this.vkbd.currentLayer.element.style.fontFamily,x=getComputedStyle(s.element);y.fontFamily=e.key.spec.font||m||x.fontFamily;var R=parseInt(x.fontSize,10);if(R==Number.NaN&&(R=0),R!=0){var k={keyWidth:1.6*d,keyHeight:1.6*B,baseEmFontSize:s.getKeyEmFontSize(),layoutFontSize:new J(s.kbdDiv.style.fontSize)};y.fontSize=e.key.getIdealFontSize(e.key.keyText,k,u).styleString}var W=(G-d)/2;g<W?(this.cap.style.left="1px",g+=W-1):g>window.innerWidth-d-W?(this.cap.style.left=G-d-1+"px",g-=W-1):this.cap.style.left=W+"px",y.left=g-W+"px";var T=getComputedStyle(this.element),L=F.height,S=parseFloat(T.bottom),H=parseFloat(T.height),N=Math.ceil(p/2);this.cap.style.width=d+"px",this.tip.style.height=N+"px";var ot=3,it=N-ot+"px";C=="top"?(this.cap.style.top=it,this.cap.style.bottom=""):(this.cap.style.top="",this.cap.style.bottom=it);var Kt=X-Math.floor(b)+p-(C=="top"?N:-ot*2);if(this.cap.style.height=Kt+"px",this.constrain&&H+S>L){var ie=H+S-L;y.height=p-ie+"px";var cn=Math.max(0,p-ie-p/2+2);this.cap.style.height=cn+"px"}else S<0&&(y.bottom="0px",this.cap.style.height=Math.max(0,Kt+S)+"px");if(y.display="block",this.previewHost==n)return;var Lr=this.preview;this.previewHost&&this.previewHost.off("preferredOrientation",this.reorient),this.previewHost=n,n&&(this.previewHost.on("preferredOrientation",this.reorient),this.preview=this.previewHost.element,this.tip.replaceChild(this.preview,Lr),n.setCancellationHandler(function(){return i.show(null,!1,null)}),n.on("startFade",function(){i.element.classList.remove("kmw-preview-fade"),i.element.offsetWidth,i.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",(r=this.previewHost)===null||r===void 0||r.off("preferredOrientation",this.reorient),this.previewHost=null;var Ar=this.preview;this.preview=document.createElement("div"),this.tip.replaceChild(this.preview,Ar),this.element.classList.remove("kmw-preview-fade"),this.orientation=Pc}this.key=e,this.state=t},c}(),jc=fl;var ii="kmw-keypreview",Rl="kmw-preview-overlay",Ll="kmw-keytip",qc=function(){function c(e){this.state=!1,this.vkbd=e;var t=this.element=document.createElement("div");t.className=ii,t.id="kmw-keytip",t.style.pointerEvents="none",t.style.display="none",this.preview=document.createElement("div"),t.appendChild(this.preview)}return c.prototype.show=function(e,t,n){var i=this,r=this.vkbd,s=e==null?void 0:e.key.spec.displayLayer;if(t&&r.layerGroup.blinkLayer(s),t&&(e==null?void 0:e.offsetParent)){var l=this.vkbd.topContainer.getBoundingClientRect(),o=e.getBoundingClientRect(),a=s!=r.layerId?Rl:"";this.element.className="".concat(ii," ").concat(e.className," ").concat(a),this.element.id="".concat(Ll,"-").concat(e.id);var g=this.element.style,d=this.vkbd.currentLayer.element.style.fontFamily;if(g.fontFamily=e.key.spec.font||d,g.left=o.left-l.left+"px",g.top=o.top-l.top+"px",g.width=o.width+"px",g.height=o.height+"px",this.element.style.display="block",this.previewHost==n)return;var B=this.preview;this.previewHost=n,n&&(this.preview=this.previewHost.element,this.element.replaceChild(this.preview,B),n.setCancellationHandler(function(){return i.show(null,!1,null)}),n.on("startFade",function(){i.element.classList.remove("kmw-preview-fade"),i.element.offsetWidth,i.element.classList.add("kmw-preview-fade")}))}else{this.element.style.display="none",this.element.className=ii,this.previewHost=null;var u=this.preview;this.preview=document.createElement("div"),this.element.replaceChild(this.preview,u),this.element.classList.remove("kmw-preview-fade")}this.key=e,this.state=t},c}();function bt(c){try{if(c=="desktop")return 1;var e=document.documentElement.clientWidth;if(screen.width>e)return 1;var t=screen.width;return rt()?screen.width<screen.height&&(t=screen.height):screen.width>screen.height&&(t=screen.height),Math.round(100*t/e)/100}catch(n){return 1}}var $c=function(){function c(e,t){var n=this;this.directlyEmitsKeys=!0,this.hasModalVisualization=!1,this.deleteRepeater=function(){n.repeatClosure(),n.timerHandle=window.setTimeout(n.deleteRepeater,c.REPEAT_DELAY)},this.source=e;var i=e.stageReports[0].item;i.key.highlight(!0),this.repeatClosure=function(){t(),i.key.highlight(!0)},this.timerHandle=window.setTimeout(this.deleteRepeater,c.INITIAL_DELAY),this.source.on("complete",function(){window.clearTimeout(n.timerHandle),n.timerHandle=void 0,i.key.highlight(!1)})}return c.prototype.cancel=function(){this.deleteRepeater(),this.source.cancel()},c.prototype.currentStageKeyDistribution=function(){return null},c.INITIAL_DELAY=500,c.REPEAT_DELAY=100,c}();var Al=function(c){(0,Q.__extends)(e,c);function e(t,n){if(typeof n!="string"||n=="")throw"The 'layer' parameter for subkey construction must be properly defined.";return c.call(this,t,n)||this}return e.prototype.getId=function(){return"popup-"+this.layer+"-"+this.spec.id},e.prototype.construct=function(t,n,i,r){var s=this.spec,l=document.createElement("div"),o=l.style;l.className="kmw-key-square-ex",r&&(o.marginTop="5px"),o.width=i+"px",o.height=n.offsetHeight+"px";var a=document.createElement("div"),g=this.btn=je(a,new Pe(this,s.id));this.setButtonClass(),g.id=this.getId();var d=g.style;return d.height=o.height,d.lineHeight=n.style.lineHeight,d.width=o.width,d.position="absolute",g.appendChild(this.label=this.generateKeyText(t)),l.appendChild(g),this.square=l},e.prototype.allowsKeyTip=function(){return!1},e}(Et),tr=Al;var er=.2,Sl=1.2,ir=3,$t=5,nr=6+ir,Hl=function(){function c(e,t,n,i,r){var s=this,l;this.directlyEmitsKeys=!0,this.shouldLockLayer=!1,this.baseKey=i,this.source=e,this.gestureParams=r,n.layerLocked&&(this.shouldLockLayer=!0),e.on("complete",function(){var m;(m=s.currentSelection)===null||m===void 0||m.key.highlight(!1),s.clear()}),e.on("stage",function(){var m=s.currentSelection;if(m){var x=n.keyEventFromSpec(m.key.spec);x.keyDistribution=s.currentStageKeyDistribution(),n.raiseKeyEvent(x,m)}});var o=e.stageReports[0].sources[0].constructSubview(!0,!1);o.path.on("step",function(m){var x,R;o.path.stats.netDistance>=4&&((x=s.currentSelection)===null||x===void 0||x.key.highlight(!1),(R=m.item)===null||R===void 0||R.key.highlight(!0),s.currentSelection=m.item)}),this.currentSelection=i,i.key.highlight(!0);var a=i.subKeys,g=this.element=document.createElement("div");g.id="kmw-popup-keys";var d=g.style;d.fontFamily=n.fontFamily;var B=getComputedStyle(i);d.fontSize=B.fontSize,d.visibility="hidden";var u=i.key.layer;(typeof u!="string"||u=="")&&(u=n.layerId);var y=a.length,I=Math.ceil(y/9),F=Math.ceil(y/I);this.subkeys=[];for(var U=$t,b=0,C=0,X=0;C<y;C++,X++){var Z=typeof a[C].width!="undefined"?a[C].width*i.offsetWidth/100:i.offsetWidth;Z>n.width-2*$t&&(Z=n.width-2*$t),(U+Z+$t>n.width||X>=F)&&(b++,X=0,U=$t);var G=new tr(a[C],u),p=G.construct(n,i,Z,b>0);U+=Z+$t,this.menuWidth=Math.max((l=this.menuWidth)!==null&&l!==void 0?l:0,U),this.subkeys.push(p.firstChild),g.appendChild(p)}d.width=this.menuWidth+"px",this.shim=document.createElement("div"),this.shim.id="kmw-popup-shim",n.device.formFactor==v.FormFactor.Phone&&this.selectDefaultSubkey(i,g),n.element.appendChild(this.element),n.topContainer.appendChild(this.shim),this.reposition(n);var f=this.buildPopupRecognitionConfig(n);t({type:"push",config:f})}return c.prototype.buildPopupRecognitionConfig=function(e){var t=this,n=this.element.getBoundingClientRect(),i=this.baseKey.getBoundingClientRect(),r=this.subkeys[0].style,s=Number.parseInt(r.height,10),l=-.666*s,o=3,a=i.bottom-n.bottom,g=new Ut(this.element,[l*o,l,-a<l?-a:l]),d={getBoundingClientRect:function(){var B=Number.MAX_SAFE_INTEGER;return new DOMRect(-B,-B,2*B,2*B)}};return{targetRoot:this.element,inputStartBounds:e.element,maxRoamingBounds:d,safeBounds:d,itemIdentifier:function(B,u){var y,I,F=g.getBoundingClientRect(),U=null,b=Number.MAX_VALUE,C=Number.MAX_VALUE;if(B.clientX<F.left||B.clientX>F.right||B.clientY<F.top||B.clientY>F.bottom)return null;try{for(var X=(0,Q.__values)(t.subkeys),Z=X.next();!Z.done;Z=X.next()){var G=Z.value,p=G.getBoundingClientRect(),f=Number.MAX_VALUE,m=Number.MAX_VALUE;if(p.left<=B.clientX&&B.clientX<p.right?f=0:f=p.left>=B.clientX?p.left-B.clientX:B.clientX-p.right,p.top<=B.clientY&&B.clientY<p.bottom?m=0:m=p.top>=B.clientY?p.top-B.clientY:B.clientY-p.bottom,f==0&&m==0)return G;(f<C||f==C&&m<b)&&(C=f,U=G,b=m)}}catch(x){y={error:x}}finally{try{Z&&!Z.done&&(I=X.return)&&I.call(X)}finally{if(y)throw y.error}}return U}}},c.prototype.reposition=function(e){var t=this.element,n=this.baseKey,i=e.topContainer,r=n.key.row.element,s=t.style,l=n.offsetParent?n.offsetParent.offsetLeft:0,o=n.offsetLeft+l+.5*(n.offsetWidth-t.offsetWidth),a=e.width-t.offsetWidth;o>a&&(o=a),o<0&&(o=0),s.left=o+"px";var g=i.getBoundingClientRect(),d=r.getBoundingClientRect();s.top=d.top-g.top-t.offsetHeight-ir+"px",s.visibility="visible";var B=e.isEmbedded,u=getComputedStyle(t),y=parseFloat(u.top),I=0,F=0;y<I&&B&&(F=I-y,s.top=I+"px"),this.callout=this.addCallout(n,F,e.element,e.topContainer,e.device.formFactor=="tablet")},c.prototype.addCallout=function(e,t,n,i,r){t=t||0;var s=getComputedStyle(this.element),l=Math.max(Number.parseInt(s.borderRadius),0),o=e.getBoundingClientRect(),a=i.getBoundingClientRect(),g=Math.floor(Number.parseInt(s.top,10)+Number.parseInt(s.height,10)+Number.parseInt(s.paddingTop,10)/2+Number.parseInt(s.paddingBottom,10)),d=er*(o.height-t),B=er*o.height,u=d+nr,y=u/(B+nr),I=o.bottom-a.top-g-1,F=I<u?I:u;if(F>0){var U=document.createElement("div"),b=U.style;U.id="kmw-popup-callout",n.appendChild(U),b.top=g+"px",b.borderTopWidth=F+"px";var C=Sl*y,X=o.width*C,Z=this.menuWidth-2*l,G=Z<X?Z:X,p=o.left-a.left-(G-o.width)/2,f=Math.max(0,p+G-(a.right-l)),m=Math.max(0,l-p);return b.left=o.left-a.left-(G-o.width)/2+m+"px",b.borderLeftWidth=G/2-m+"px",b.borderRightWidth=G/2-f+"px",U}else return null},c.prototype.selectDefaultSubkey=function(e,t){for(var n,i,r=e.subKeys,s=0;s<r.length;s++){var l=r[s],o=t.childNodes[s].firstChild;if(l.default){i=o;break}else if(!e.key||!e.key.spec)continue;l.elementID==e.key.spec.elementID&&(i=o)}i&&((n=this.currentSelection)===null||n===void 0||n.key.highlight(!1),this.currentSelection=i,i.key.highlight(!0))},Object.defineProperty(c.prototype,"hasModalVisualization",{get:function(){return this.element.style.visibility=="visible"},enumerable:!1,configurable:!0}),c.prototype.buildCorrectiveLayout=function(){var e=this.element.getBoundingClientRect(),t=e.width/e.height,n=this.subkeys.map(function(i){var r=i.getBoundingClientRect(),s={keySpec:i.key.spec,centerX:(r.right-r.width/2-e.left)/e.width,centerY:(r.bottom-r.height/2-e.top)/e.height,width:r.width/e.width,height:r.height/e.height};return s});return{keys:n,kbdScaleRatio:t}},c.prototype.currentStageKeyDistribution=function(){var e=this,t=this.source.stageReports[this.source.stageReports.length-1],n=this.source.stageReports[0],i=t.sources[0],r=i.currentSample,s=this.element.getBoundingClientRect(),l={x:r.targetX/s.width,y:r.targetY/s.height};l.x=l.x<0?0:l.x>1?1:l.x,l.y=l.y<0?0:l.y>1?1:l.y;var o=We(l,this.buildCorrectiveLayout()),a=o.get(r.item.key.spec),g=Math.min(i.path.stats.duration-n.sources[0].path.stats.duration,this.gestureParams.longpress.waitLength)/(2*this.gestureParams.longpress.waitLength),d=Math.min(i.path.stats.rawDistance,this.gestureParams.longpress.noiseTolerance*4)/(this.gestureParams.longpress.noiseTolerance*8),B=Math.min(g*g,d*d),u=a+B,y=new Map,I=this.subkeys.find(function(F){return F.keyId==e.baseKey.keyId});return I?y.set(I.key.spec,u):y.set(this.baseKey.key.spec,u),St([o,y])},c.prototype.cancel=function(){this.clear(),this.source.cancel()},c.prototype.clear=function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.shim.parentNode&&this.shim.parentNode.removeChild(this.shim),this.callout&&this.callout.parentNode&&this.callout.parentNode.removeChild(this.callout)},c}(),ci=Hl;var Wl=function(){function c(e,t,n){var i=this;this.directlyEmitsKeys=!0,this.shouldRestore=!1,this.hasModalVisualization=!1;var r=e.stageReports[0];this.originalLayer=r.sources[0].stateToken,this.source=e,this.completionCallback=function(){t.lockLayer(!1),i.shouldRestore&&(t.layerId=i.originalLayer,t.updateState()),n==null||n()},t.lockLayer(!0),e.on("stage",function(s){var l=s.matchedId;l.includes("modipress")&&l.includes("-end")?i.clear():l.includes("modipress")&&l.includes("-hold")&&(i.shouldRestore=!0)}),e.on("complete",function(){return i.cancel()})}return Object.defineProperty(c.prototype,"isLocked",{get:function(){return this.shouldRestore},enumerable:!1,configurable:!0}),c.prototype.setLocked=function(){this.shouldRestore=!0},Object.defineProperty(c.prototype,"completed",{get:function(){return this.completionCallback===null},enumerable:!1,configurable:!0}),c.prototype.clear=function(){var e=this.completionCallback;this.completionCallback=null,e==null||e()},c.prototype.cancel=function(){this.clear(),this.source.cancel()},c.prototype.currentStageKeyDistribution=function(e){return null},c}(),he=Wl;var Nl=function(){function c(e,t,n,i,r){var s=this;this.directlyEmitsKeys=!0,this.hasModalVisualization=!1,this.tapIndex=0,this.baseKey=n,this.baseContextToken=i,this.multitaps=[n.key.spec].concat(n.key.spec.multitap),this.sequence=e;var l=function(B){var u;(u=s.modipress)===null||u===void 0||u.clear();var y=new he(e,t,function(){s.modipress=t.activeModipress=null});s.modipress=t.activeModipress=y};this.originalLayer=t.layerId;var o=function(B){return(s.tapIndex+B)%s.multitaps.length},a=function(){r==null||r.setMultitapHint(s.multitaps[o(0)],s.multitaps[o(1)],t)};e.on("complete",function(){var B;(B=s.modipress)===null||B===void 0||B.cancel(),s.clear()});var g=function(B){var u;switch(B.matchedId){case"modipress-hold":s.clear(),e.off("stage",g);return;case"modipress-end-multitap-transition":case"modipress-multitap-end":case"modipress-end":case"multitap-end":case"simple-tap":return;case"modipress-multitap-lock-transition":(u=s.modipress)===null||u===void 0||u.setLocked();return;case"modipress-multitap-start":case"multitap-start":break;default:throw new Error("Unsupported gesture state encountered during multitap: ".concat(B.matchedId))}s.tapIndex=o(1);var y=s.multitaps[s.tapIndex];a();var I=t.keyEventFromSpec(y);I.baseTranscriptionToken=s.baseContextToken;var F=B.sources[0].currentSample,U=t.getSimpleTapCorrectionDistances(F,s.baseKey.key.spec);if(F.stateToken!=t.layerId&&!B.matchedId.includes("modipress")){var b=t.layerGroup.findNearestKey((0,Q.__assign)((0,Q.__assign)({},F),{stateToken:t.layerId})),C=U.get(b.key.spec);C==null&&console.warn("Could not find current layer's key"),U.delete(b.key.spec),U.set(F.item.key.spec,C)}I.keyDistribution=s.currentStageKeyDistribution(U),I.kNextLayer||(I.kNextLayer=s.originalLayer),t.raiseKeyEvent(I,null),B.matchedId=="modipress-multitap-start"&&l(B)};e.on("stage",g);var d=e.stageReports[0];d.matchedId=="modipress-start"&&l(e.stageReports[0]),a()}return c.prototype.currentStageKeyDistribution=function(e){var t=this,n=St(e),i=n.findIndex(function(I){return I.keySpec==t.baseKey.key.spec});if(i==-1)return Ie(this.baseKey)||console.warn("Could not find base key's probability for multitap correction"),n;for(var r=n.splice(i,1)[0].p,s=0,l=[],o=0;o<this.multitaps.length;o++){var a=this.multitaps[o],g=Math.abs(o-this.tapIndex)%this.multitaps.length,d=(o+this.multitaps.length-this.tapIndex)%this.multitaps.length,B=g<d?g:d,u=1/((1+B)*(1+B));s+=u,l.push({keySpec:a,p:u})}var y=r/s;return l.forEach(function(I){I.p=y*I.p}),n.concat(l).sort(function(I,F){return F.p-I.p})},c.prototype.cancel=function(){this.clear(),this.sequence.cancel()},c.prototype.clear=function(){},c}(),cr=Nl;var Ce=1.4142,ri=function(c){return Math.abs(c)<1e-10?0:c},rr=function(c){(0,Q.__extends)(e,c);function e(t,n,i,r){var s,l=c.call(this)||this;l.flickPreviews=new Map,l.orientation="top";var o=t.key.spec,a=l.flickEdgeLength=Math.max(i,r),g=l.div=document.createElement("div");g.className=g.id="kmw-gesture-preview",g.style.pointerEvents="none";var d=l.previewImgContainer=document.createElement("div");l.previewImgContainer.id="kmw-preview-img-container";var B=l.label=document.createElement("span");if(B.className="kmw-gesture-base-label kmw-key-text",B.id="kmw-gesture-base-label",d.appendChild(B),B.textContent=t.key.label.textContent,l.div.appendChild(l.previewImgContainer),o.flick){var u=o.flick||{};Object.keys(u).forEach(function(I){var F=document.createElement("div");F.className="kmw-flick-preview kmw-key-text",F.textContent=u[I].text;var U=F.style,b=Pn.get(I),C=ri(-Math.sin(b[0])),X=ri(Math.cos(b[0]));U.width="100%",U.textAlign="center",C<0?U.right=-C*Ce*a+"px":C>0?U.left=C*Ce*a+"px":U.left="0px",U.height="100%",U.lineHeight="100%",X<0?U.bottom=-X*Ce*a+"px":X>0?U.top=X*Ce*a+"px":U.top="0px",l.flickPreviews.set(I,F),d.appendChild(F)})}var y=l.hintLabel=document.createElement("div");return y.className="kmw-key-popup-icon",n||(y.textContent=o==o.hintSrc?o.hint:(s=o.hintSrc)===null||s===void 0?void 0:s.text,y.style.fontWeight=y.textContent=="\u2022"?"bold":""),g.appendChild(y),l}return Object.defineProperty(e.prototype,"element",{get:function(){return this.div},enumerable:!1,configurable:!0}),e.prototype.refreshLayout=function(){var t=getComputedStyle(this.div),n=Number.parseInt(t.height,10);this.flickPreviews.forEach(function(i){i.style.lineHeight=i.style.height="".concat(n,"px")})},e.prototype.cancel=function(){var t;(t=this.onCancel)===null||t===void 0||t.call(this),this.onCancel=null},e.prototype.setCancellationHandler=function(t){this.onCancel=t},e.prototype.setMultitapHint=function(t,n,i){var r,s,l=Mt(t.text,i),o=Mt(n.text,i);this.label.textContent=l,this.hintLabel.textContent=o,this.label.style.fontFamily=l!=t.text?"SpecialOSK":(r=t.font)!==null&&r!==void 0?r:this.label.style.fontFamily,this.hintLabel.style.fontFamily=o!=n.text?"SpecialOSK":(s=n.font)!==null&&s!==void 0?s:this.hintLabel.style.fontFamily,this.emit("startFade"),this.clearFlick()},e.prototype.scrollFlickPreview=function(t,n){this.clearHint();var i=this.previewImgContainer.style,r=this.flickEdgeLength*Ce;i.marginLeft="".concat(r*t,"px"),i.marginTop="".concat(r*n,"px");var s=ri(n)<0?"bottom":"top";this.orientation!=s&&(this.orientation=s,this.emit("preferredOrientation",s))},e.prototype.clearFlick=function(){this.previewImgContainer.style.marginTop="0px",this.previewImgContainer.style.marginLeft="0px",this.previewImgContainer.classList.add("kmw-flick-clear")},e.prototype.clearHint=function(){this.hintLabel.classList.add("kmw-hint-clear")},e.prototype.clearAll=function(){this.clearFlick()},e}(V.default);var sr=Lt.TIER!="stable"||Lt.VERSION_ENVIRONMENT!="",El=sr?10:0,kl=function(c){(0,Q.__extends)(e,c);function e(t){var n,i,r=c.call(this)||this;r.gestureParams=(0,Q.__assign)({},jn),r.layerLocked=!1,r.layerIndex=0,r.isStatic=!1,r._fixedWidthScaling=!1,r._fixedHeightScaling=!0,r._borderWidth=0,r.stateKeys={K_CAPS:!1,K_NUMLOCK:!1,K_SCROLL:!1},r.activeGestures=[],r.activeModipress=null,r.repeatDelete=function(){this.deleting&&(this.modelKeyClick(this.deleteKey),this.deleting=window.setTimeout(this.repeatDelete,100))}.bind(r),r.config=t,r.config.device=t.device||t.hostDevice,r.config.isEmbedded=t.isEmbedded||!1,t.isStatic&&(r.isStatic=t.isStatic),r._fixedWidthScaling=r.device.touchable&&!r.isStatic,r._fixedHeightScaling=r.device.touchable&&!r.isStatic;var s=document.createElement("div");r.config.styleSheetManager=t.styleSheetManager||new Ft(s);var l;if(t.keyboard)l=r.kbdLayout=t.keyboard.layout(t.device.formFactor),r.layoutKeyboardProperties=t.keyboardMetadata,r.isRTL=t.keyboard.isRTL;else{var o=D.buildDefaultLayout(null,null,t.device.formFactor);l=r.kbdLayout=Re.polyfill(o,null,t.device.formFactor),r.layoutKeyboardProperties=null,r.isRTL=!1}"font"in l?r.fontFamily=l.font:r.fontFamily="";var a=t.device.formFactor;r.layoutKeyboard=t.keyboard,r.layoutKeyboard||(r.layoutKeyboard=new j(null)),r.layerGroup=new Oc(r,r.layoutKeyboard,a),r.layoutKeyboard.markLayoutCalibrated(a),s.appendChild(r.layerGroup.element),r.kbdDiv=s,r.isStatic||(r.gestureEngine=r.constructGestureEngine()),s.classList.add(t.device.formFactor,"kmw-osk-inner-frame");var g=(i=(n=r.layoutKeyboard)===null||n===void 0?void 0:n.id.replace("Keyboard_",""))!==null&&i!==void 0?i:"",d=g.indexOf("::");d!=-1&&(g=g.substring(d+2));var B="kmw-keyboard-"+g;return r.element.classList.add(B),r}return Object.defineProperty(e.prototype,"layerId",{get:function(){var t,n;return(n=(t=this.layerGroup)===null||t===void 0?void 0:t.activeLayerId)!==null&&n!==void 0?n:"default"},set:function(t){var n=t!=this.layerId;if(this.layerGroup.layers[t])this.layerGroup.activeLayerId=t,this.gestureEngine&&(this.gestureEngine.stateToken=t);else throw new Error("Keyboard ".concat(this.layoutKeyboard.id," does not have a layer with id ").concat(t));n&&!this.deferLayout&&(this.updateState(),this.layerGroup.refreshLayout(this.constructLayoutParams()))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentLayer",{get:function(){var t;return(t=this.layerGroup)===null||t===void 0?void 0:t.activeLayer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lgKey",{get:function(){var t,n;return(n=(t=this.currentLayer)===null||t===void 0?void 0:t.globeKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hkKey",{get:function(){var t,n;return(n=(t=this.currentLayer)===null||t===void 0?void 0:t.hideKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"spaceBar",{get:function(){var t,n;return(n=(t=this.currentLayer)===null||t===void 0?void 0:t.spaceBarKey)===null||n===void 0?void 0:n.btn},enumerable:!1,configurable:!0}),e.prototype.constructGestureEngine=function(){var t=this,n={targetRoot:this.element,mouseEventRoot:document.body,maxRoamingBounds:new Ut(this.topContainer,[NaN]),itemIdentifier:function(o,a){return t.layerGroup.findNearestKey(o)},recordingMode:sr,historyLength:El};this.gestureParams.longpress.permitsFlick=function(o){var a=o==null?void 0:o.key.spec.flick;return!a||!(a.n||a.nw||a.ne)};var i=new Fe(qn(this.kbdLayout,this.gestureParams),n);i.stateToken=this.layerId;var r={},s=function(o){var a,g;try{for(var d=(0,Q.__values)(Object.keys(r)),B=d.next();!B.done;B=d.next()){var u=B.value;if(u!=o){var y=r[u];y.source.terminate(!0)}}}catch(I){a={error:I}}finally{try{B&&!B.done&&(g=d.return)&&g.call(d)}finally{if(a)throw a.error}}},l=new Map;return i.on("inputstart",function(o){var a,g=t.highlightKey(o.currentSample.item,!0);g&&((a=t.gesturePreviewHost)===null||a===void 0||a.cancel(),t.gesturePreviewHost=g),r[o.identifier]={source:o,roamingHighlightHandler:null,key:o.currentSample.item,previewHost:g};var d=r[o.identifier],B=function(){Qt(0).then(function(){var u=d.previewHost;u&&(u.cancel(),t.gesturePreviewHost=null,d.previewHost=null),d.key&&(t.highlightKey(d.key,!1),d.key=null)})};d.roamingHighlightHandler=function(u){var y,I=u.item,F=r[o.identifier].key;if(!t.kbdLayout.hasFlicks&&I!=F){t.highlightKey(F,!1),(y=t.gesturePreviewHost)===null||y===void 0||y.cancel(),t.gesturePreviewHost=null,d.previewHost=null;var U=t.highlightKey(I,!0);U&&(t.gesturePreviewHost=U,d.previewHost=U),r[o.identifier].key=I}},o.path.on("invalidated",B),o.path.on("complete",B),o.path.on("step",d.roamingHighlightHandler)}),i.on("recognizedgesture",function(o){var a;(a=t.activeModipress)===null||a===void 0||a.setLocked(),o.on("complete",function(){var g,d,B;try{for(var u=(0,Q.__values)(o.allSourceIds),y=u.next();!y.done;y=u.next()){var I=y.value;!((B=r[I])===null||B===void 0)&&B.previewHost&&(t.gesturePreviewHost=null,r[I].previewHost.cancel()),delete r[I]}}catch(F){g={error:F}}finally{try{y&&!y.done&&(d=u.return)&&d.call(u)}finally{if(g)throw g.error}}}),o.on("stage",function(g,d){var B,u,y=o.allSourceIds.map(function(L){var S;return(S=r[L])===null||S===void 0?void 0:S.previewHost}).find(function(L){return!!L}),I=function(){y&&(y.cancel(),t.gesturePreviewHost=null)},F=l.get(o);!F&&y&&!g.matchedId.includes("flick")&&y.clearFlick();var U,b=function(L){var S=function(N){N.key&&(t.highlightKey(N.key,!1),N.key=null),N.source.path.off("step",N.roamingHighlightHandler)};if(U=r[L],U)S(U);else{var H=L;Qt(0).then(function(){var N=r[H];N&&S(N)})}};try{for(var C=(0,Q.__values)(g.allSourceIds),X=C.next();!X.done;X=C.next()){var Z=X.value;b(Z)}}catch(L){B={error:L}}finally{try{X&&!X.done&&(u=C.return)&&u.call(C)}finally{if(B)throw B.error}}var G=g.item,p=g.sources[0],f=p?p.currentSample:null,m=null;if(G&&!(F&&F[0].directlyEmitsKeys)){var x=void 0,R=t.getSimpleTapCorrectionDistances(p.currentSample,G.key.spec);F&&(x=F[0].currentStageKeyDistribution(R)),x||(x=St(R));var k=!t.layerLocked&&F&&F[0]instanceof ci&&F[0].shouldLockLayer;try{k&&t.lockLayer(!0),m=t.modelKeyClick(g.item,f)}finally{k&&t.lockLayer(!1)}}if(!(o.stageReports.length>1&&g.matchedId!="modipress-end")){var W=o.stageReports[0].item;if(g.matchedId=="special-key-start")G.key.spec.baseKeyID=="K_BKSP"?(I(),F=[new $c(o,function(){return t.modelKeyClick(G,f)})]):G.key.spec.baseKeyID=="K_LOPT"&&(o.on("complete",function(){G.key.highlight(!1),t.emit("globekey",G,!1)}),s(p.identifier),G.key.highlight(!0));else if(g.matchedId.indexOf("longpress")>-1)I(),F=[new ci(o,d,t,o.stageReports[0].sources[0].baseItem,t.gestureParams)];else if((W==null?void 0:W.key.spec.multitap)&&(g.matchedId=="initial-tap"||g.matchedId=="multitap"||g.matchedId=="modipress-start"))U.previewHost=null,o.on("complete",function(){I()}),F=[new cr(o,t,W,m.contextToken,y)];else if(g.matchedId.indexOf("flick")>-1)F=[new pc(o,d,t,o.stageReports[0].sources[0].baseItem,t.gestureParams,y)];else if(g.matchedId.includes("modipress")&&g.matchedId.includes("-start"))if(I(),t.layerLocked)console.warn("Unexpected state:  modipress start attempt during an active modipress");else{F||(F=[]);var T=new he(o,t,function(){var L=F.indexOf(T);L>-1&&F.splice(L,1),t.activeModipress=null});F.push(T),t.activeModipress=T}else I();F&&(t.activeGestures=t.activeGestures.concat(F),l.set(o,F),o.on("complete",function(){var L=t.activeGestures.filter(function(S){return F.includes(S)});t.activeGestures=t.activeGestures.filter(function(S){return!F.includes(S)}),L.forEach(function(S){S instanceof he&&S.cancel()})}))}})}),i},Object.defineProperty(e.prototype,"element",{get:function(){return this.kbdDiv},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"device",{get:function(){return this.config.device},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hostDevice",{get:function(){return this.config.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontRootPath",{get:function(){return this.config.pathConfig.fonts},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"styleSheetManager",{get:function(){return this.config.styleSheetManager},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topContainer",{get:function(){return this.config.topContainer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmbedded",{get:function(){return this.config.isEmbedded},enumerable:!1,configurable:!0}),e.prototype.postInsert=function(){},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layoutWidth",{get:function(){if(this.usesFixedWidthScaling){var t=this.width;return t-=this._borderWidth*2,J.inPixels(t)}else return J.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layoutHeight",{get:function(){if(this.usesFixedHeightScaling){var t=this.height;return t-=this._borderWidth*2,J.inPixels(t)}else return J.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"internalHeight",{get:function(){return this.usesFixedHeightScaling?J.inPixels(this.layoutHeight.val-this._borderWidth*2-this.layerGroup.verticalPadding):J.forScalar(1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize||(this._fontSize=new J("1em")),this._fontSize},set:function(t){this._fontSize=t,this.kbdDiv.style.fontSize=t.styleString},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"usesFixedWidthScaling",{get:function(){return this._fixedWidthScaling},set:function(t){this._fixedWidthScaling=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"usesFixedHeightScaling",{get:function(){return this._fixedHeightScaling},set:function(t){this._fixedHeightScaling=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"usesFixedPositioning",{get:function(){for(var t=this.element;t;){if(getComputedStyle(t).position=="fixed")return!0;t=t.offsetParent}return!1},enumerable:!1,configurable:!0}),e.prototype.setSize=function(t,n,i){this._width=t,this._height=n,this.kbdDiv&&(this.kbdDiv.style.width=t?this._width+"px":"",this.kbdDiv.style.height=n?this._height+"px":"",!this.device.touchable&&n&&(this.fontSize=new J(this._height/8+"px")),i||this.refreshLayout())},e.prototype.getDefaultKeyObject=function(){var t=(0,Q.__assign)({},P.DEFAULT_KEY);return P.polyfill(t,this.layoutKeyboard,this.kbdLayout,this.layerId),t},e.prototype.getTouchCoordinatesOnKeyboard=function(t){var n={x:t.targetX,y:t.targetY};return n.x/=this.layerGroup.element.offsetWidth,n.y/=this.kbdDiv.offsetHeight,n},e.prototype.getSimpleTapCorrectionDistances=function(t,n){var i=this.getTouchCoordinatesOnKeyboard(t),r=this.layerGroup.element,s=r.offsetWidth,l=this.kbdDiv.offsetHeight;if(!s||!l)return new Map;var o=s/l,a=nc(this.kbdLayout.getLayer(this.layerId),o);return We(i,a)},e.prototype.keyTarget=function(t){var n=t;try{if(n){if(n.classList.contains("kmw-key"))return qe(n);if(n.parentNode&&n.parentNode.classList.contains("kmw-key"))return qe(n.parentNode);if(n.firstChild&&n.firstChild.classList.contains("kmw-key"))return qe(n.firstChild)}}catch(i){}return null},e.prototype.cancelDelete=function(){this.deleting&&window.clearTimeout(this.deleting),this.deleting=0},e.prototype.modelKeyClick=function(t,n,i){var r=this.initKeyEvent(t);return n&&(r.source=n),i&&(r.keyDistribution=i),this.raiseKeyEvent(r,t)},e.prototype.initKeyEvent=function(t){this.highlightKey(t,!1);var n=t.key?t.key.spec:null;return n?this.keyEventFromSpec(n):null},e.prototype.keyEventFromSpec=function(t){var n=this.layoutKeyboard.constructKeyEvent(t,this.device,this.stateKeys);return n.srcKeyboard=this.layoutKeyboard,n},e.prototype._UpdateVKShiftStyle=function(t){var n,i;t||(t=this.layerId);var r=this.layerGroup.layers[t];if(!!r&&(this.gestureEngine&&(this.gestureEngine.stateToken=t),!!(!((n=this.layoutKeyboard)===null||n===void 0)&&n.usesDesktopLayoutOnDevice(this.device)))){var s=["K_CAPS","K_NUMLOCK","K_SCROLL"],l=[r.capsKey,r.numKey,r.scrollKey];for(i=0;i<l.length;i++)l[i]!=null&&l[i].setToggleState(this.stateKeys[s[i]])}},e.prototype.updateStateKeys=function(t){var n,i;try{for(var r=(0,Q.__values)(Object.keys(this.stateKeys)),s=r.next();!s.done;s=r.next()){var l=s.value;this.stateKeys[l]=t[l]}}catch(o){n={error:o}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}this._UpdateVKShiftStyle()},e.prototype.highlightKey=function(t,n){if(!t||!t.key||t.className==""||t.className.indexOf("kmw-key-row")>=0)return null;var i=t.key.allowsKeyTip(),r=this.activeGestures.find(function(s){return s.hasModalVisualization});return n=r?!1:n,t.key.highlight(n),n&&i?this.gesturePreviewHost?null:this.showGesturePreview(t):null},e.prototype.getKeyEmFontSize=function(){if(!this.fontSize)return new J("0px");if(this.device.formFactor=="desktop"){var t=.8;return this.fontSize.scaledBy(t)}else{var n=getComputedStyle(document.body).fontSize,i=new J(n),r=1;if(!this.isStatic){if(this.fontSize.absolute)return this.fontSize;r=this.fontSize.val}return i.scaledBy(r)}},e.prototype.updateState=function(){!this.currentLayer||(this.nextLayer=this.layerId,this.currentLayer.nextlayer&&(this.nextLayer=this.currentLayer.nextlayer),this.layerGroup.activeLayerId=this.layerId,this._UpdateVKShiftStyle())},e.prototype.refreshLayout=function(){if(!this.deferLayout){var t=this.device,n=1;t.OS==v.OperatingSystem.iOS&&!this.isEmbedded&&(n=n/bt(this.device.formFactor));var i=this.kbdDiv.style;this.usesFixedHeightScaling&&this.height&&(i.height=i.maxHeight=this.height+"px"),i.fontSize=this.fontSize.scaledBy(n).styleString;var r=this.width&&this.height,s=getComputedStyle(this.kbdDiv),l=getComputedStyle(this.layerGroup.element),o=s.height!=""&&s.height!="auto";if(s.border&&(this._borderWidth=new J(s.borderWidth).val),r)this._computedWidth=this.width,this._computedHeight=this.height;else if(o)this._computedWidth=parseInt(s.width,10),this._computedWidth||(this._computedWidth=parseInt(l.width,10)),this._computedHeight=parseInt(s.height,10);else return;if(!this.isStatic){var a=this.gestureEngine.config.maxRoamingBounds;a.updatePadding([-.333*this.currentLayer.rowHeight]),this.gestureParams.longpress.flickDistStart=.24*this.currentLayer.rowHeight,this.gestureParams.flick.startDist=.3*this.currentLayer.rowHeight,this.gestureParams.flick.dirLockDist=.35*this.currentLayer.rowHeight,this.gestureParams.flick.triggerDist=.75*this.currentLayer.rowHeight,this.gestureParams.longpress.flickDistFinal=.75*this.currentLayer.rowHeight}this.layerGroup.refreshLayout(this.constructLayoutParams())}},e.prototype.constructLayoutParams=function(){var t,n;return{keyboardWidth:this._computedWidth-2*this._borderWidth,keyboardHeight:this._computedHeight-2*this._borderWidth-this.layerGroup.verticalPadding,widthStyle:this.layoutWidth,heightStyle:this.internalHeight,baseEmFontSize:this.getKeyEmFontSize(),layoutFontSize:new J(this.layerGroup.element.style.fontSize),spacebarText:(n=(t=this.layoutKeyboardProperties)===null||t===void 0?void 0:t.displayName)!==null&&n!==void 0?n:"(System keyboard)"}},e.prototype.computedAdjustedOskHeight=function(t){if(!this.layerGroup)return t;var n=this.layerGroup.layers,i=0;for(var r in n){var s=n[r],l=s.rows.length,o=Math.floor(t/(l==0?1:l)),a=l*o;a>i&&(i=a)}var g=0,d=i+g;return d},e.prototype.appendStyleSheet=function(){var t=this,n=this.layoutKeyboard,i=this.layoutKeyboardProperties;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet);var r=i==null?void 0:i.textFont,s=i==null?void 0:i.oskFont;this.styleSheetManager.addStyleSheetForFont(r,this.fontRootPath,this.device.OS),this.styleSheetManager.addStyleSheetForFont(s,this.fontRootPath,this.device.OS),this.config.specialFont&&this.styleSheetManager.addStyleSheetForFont(this.config.specialFont,"",this.device.OS);var l=this.addFontStyle(r,s);n!=null&&typeof n.oskStyling=="string"&&(l=l+n.oskStyling),l&&(this.styleSheet=At(l),this.styleSheetManager.linkStylesheet(this.styleSheet)),this.styleSheetManager.allLoadedPromise().then(function(){t.layerGroup.resetPrecalcFontSizes(),t.refreshLayout()})},e.prototype.addFontStyle=function(t,n){var i="",r=function(s){return s.family.replace(/\u0022/g,"").replace(/,/g,'","')};return(t||n)&&(i='\n.kmw-key-text {\n  font-family: "'.concat(r(n||t),'";\n}\n\n.kmw-suggestion-text {\n  font-family: "').concat(r(t||n),'";\n}\n')),i},e.buildDocumentationKeyboard=function(t,n,i,r,s,l){var o,a,g=this;if(!t)return null;var d=typeof r=="undefined"?"desktop":r,B=typeof s=="undefined"?"default":s,u={};u.formFactor=d,d!="desktop"?(u.OS=v.OperatingSystem.iOS,u.touchable=!0):(u.OS=v.OperatingSystem.Windows,u.touchable=!1);var y=t.layout(d),I=new v("other",u.formFactor,u.OS,u.touchable),F=new e({keyboard:t,keyboardMetadata:n,hostDevice:I,isStatic:!0,topContainer:null,pathConfig:i,styleSheetManager:null,specialFont:{family:"SpecialOSK",files:["".concat(i.resources,"/osk/keymanweb-osk.ttf")],path:""}});F.layerGroup.element.className=F.kbdDiv.className,F.layerGroup.element.classList.add(u.formFactor+"-static");var U=F.kbdDiv.childNodes[0],b=document.createElement("div");b.classList.add(u.OS.toLowerCase(),u.formFactor),y!=null?(F.layerId=B,F.layerGroup.activeLayerId=B,F.setSize(800,l),F.fontSize=Wc(I,l,!1),b.style.fontSize=F.element.style.fontSize,F.refreshLayout(),U.style.height=F.kbdDiv.style.height,U.style.maxHeight=F.kbdDiv.style.maxHeight):U.innerHTML="<p style='color:#c40; font-size:0.5em;margin:10px;'>No "+d+" layout is defined for "+t.name+".</p>",U.style.border="1px solid #ccc",F.updateState();var C=function(){return(0,Q.__awaiter)(g,void 0,void 0,function(){var x,R,k,W,T,L,S;return(0,Q.__generator)(this,function(H){switch(H.label){case 0:if(!document.contains(U))return[3,4];H.label=1;case 1:return H.trys.push([1,,3,4]),[4,F.styleSheetManager.allLoadedPromise()];case 2:H.sent(),x=F.styleSheet,x&&U.appendChild(x),R=[].concat(F.styleSheetManager.sheets);try{for(k=(0,Q.__values)(R),W=k.next();!W.done;W=k.next())T=W.value,T!=x&&(T.href||(F.styleSheetManager.unlink(T),document.head.appendChild(T)))}catch(N){L={error:N}}finally{try{W&&!W.done&&(S=k.return)&&S.call(k)}finally{if(L)throw L.error}}return F.refreshLayout(),F.styleSheet=null,F.shutdown(),[3,4];case 3:return X.disconnect(),[7];case 4:return[2]}})})},X=new MutationObserver(C);X.observe(document.body,{childList:!0,subtree:!0}),b.append(U);try{for(var Z=(0,Q.__values)(vt.STYLESHEET_FILES),G=Z.next();!G.done;G=Z.next()){var p=G.value,f="".concat(i.resources,"/osk/").concat(p),m=F.styleSheetManager.linkExternalSheet(f,!0);m.parentNode.removeChild(m),b.appendChild(m)}}catch(x){o={error:x}}finally{try{G&&!G.done&&(a=Z.return)&&a.call(Z)}finally{if(o)throw o.error}}return F.appendStyleSheet(),b},e.prototype.onHide=function(){this.hkKey&&this.highlightKey(this.hkKey,!1)},e.prototype.optionKey=function(t,n,i){n.indexOf("K_LOPT")>=0?this.emit("globekey",t,i):n.indexOf("K_ROPT")>=0&&i&&this.emit("hiderequested",t)},e.prototype.showGesturePreview=function(t){var n=this.keytip,i=this.constructLayoutParams(),r=i.keyboardWidth*t.key.spec.proportionalWidth,s=i.keyboardHeight/this.currentLayer.rows.length,l=new rr(t,this.device.formFactor=="phone",r,s);if(n==null){var o=t.key;o.setPreview(l)}else n.show(t,!0,l);return l.refreshLayout(),l},e.prototype.createKeyTip=function(){if(this.keytip==null)if(this.device.formFactor=="phone"){var t=this.isEmbedded;this.keytip=new jc(this,t)}else this.keytip=new qc(this);this.keytip&&this.keytip.element&&this.element.appendChild(this.keytip.element)},e.prototype.createGlobeHint=function(){return this.config.embeddedGestureConfig.createGlobeHint?this.config.embeddedGestureConfig.createGlobeHint(this):null},e.prototype.shutdown=function(){var t;this.styleSheet&&this.styleSheet.parentNode&&this.styleSheet.parentNode.removeChild(this.styleSheet),this.activeGestures.forEach(function(n){return n.cancel()}),this.gestureEngine&&this.gestureEngine.destroy(),this.deleting&&window.clearTimeout(this.deleting),(t=this.keytip)===null||t===void 0||t.show(null,!1,null)},e.prototype.lockLayer=function(t){this.layerLocked=t},e.prototype.raiseKeyEvent=function(t,n){if(t.kName=="K_LOPT"||t.kName=="K_ROPT")return this.optionKey(n,t.kName,!0),{};var i={},r=function(s,l){var o,a;i.contextToken=(o=s==null?void 0:s.transcription)===null||o===void 0?void 0:o.token;var g=(a=s==null?void 0:s.transcription)===null||a===void 0?void 0:a.transform;i.alteredText=s&&(!g||wt(g))};return this.layerLocked&&(t.kNextLayer=this.layerId),this.emit("keyevent",t,r),i},e.specialCharacters=Et.specialCharacters,e}(V.default),Vt=kl;var lr=function(c){(0,Q.__extends)(e,c);function e(){return c!==null&&c.apply(this,arguments)||this}return e}(V.default),Xe=lr,xe=function(c){(0,Q.__extends)(e,c);function e(){return c!==null&&c.apply(this,arguments)||this}return Object.defineProperty(e.prototype,"enabled",{get:function(){return!0},set:function(t){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activate",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conditionsMet",{get:function(){return!0},enumerable:!1,configurable:!0}),e}(lr);var Tl=function(){function c(){this.map=new Map}return c.prototype.promiseForTouchpoint=function(e){return this.map.get(e)||this.map.set(e,new A),this.map.get(e)},c.prototype.maintainTouches=function(e){for(var t,n,i=[].concat(this.map.keys()),r=0;r<e.length;r++){var s=i.indexOf(""+e.item(r).identifier);s!=-1&&i.splice(s,1)}try{for(var l=(0,Q.__values)(i),o=l.next();!o.done;o=l.next()){var a=o.value;this.map.get(a).resolve(),this.map.delete(a)}}catch(g){t={error:g}}finally{try{o&&!o.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}},c}(),or=Tl;function ar(c){var e="osk/";return c.isEmbedded&&(e=""),"".concat(c.pathConfig.resources,"/").concat(e)}var Yl=function(c){(0,Q.__extends)(e,c);function e(t){var n,i,r,s=c.call(this)||this;s.legacyEvents=new ke,s.needsLayout=!0,s.touchEventPromiseManager=new or,s.activationListener=function(u){if(!s.mayDisable&&!s.activationModel.enabled){s.activationModel.off("activate",s.activationListener);try{s.activationModel.enabled=!0}finally{s.activationModel.on("activate",s.activationListener)}}s.commonCheckAndDisplay()},s.layerChangeHandler=function(u,y){var I,F;return s.vkbd&&s.vkbd._UpdateVKShiftStyle(y),(s.vkbd&&s.vkbd.layerId!=y||u.value!=y)&&((I=s.vkbd)===null||I===void 0?void 0:I.layerGroup.layers[y])&&!(!((F=s.vkbd)===null||F===void 0)&&F.layerLocked)&&(s.vkbd.layerId=y),!1},s._Visible=!1,s.config=t=(0,Q.__assign)({},t),s.config.allowHideAnimations===void 0&&(s.config.allowHideAnimations=!0),s.config.device=t.device||t.hostDevice,s.config.isEmbedded=t.isEmbedded||!1,s.config.embeddedGestureConfig=t.embeddedGestureConfig||{},s.config.activator.on("activate",s.activationListener),s._Box=E("div"),s.kbdStyleSheetManager=new Ft(s._Box,s.config.doCacheBusting||!1),s.uiStyleSheetManager=new Ft(s._Box),s.bannerView=new ac,s.bannerView.events.on("bannerchange",function(){return s.refreshLayout()}),s._Box.appendChild(s.bannerView.element),s._bannerController=new ei(s.bannerView,s.hostDevice,s.config.predictionContextManager),s.keyboardView=new be,s._Box.appendChild(s.keyboardView.element);var l=ar(s.config);try{for(var o=(0,Q.__values)(e.STYLESHEET_FILES),a=o.next();!a.done;a=o.next()){var g=a.value,d="".concat(l).concat(g);s.uiStyleSheetManager.linkExternalSheet(d)}}catch(u){n={error:u}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}s.activeKeyboard=s.config.keyboardToActivate;var B=(r=s.config.predictionContextManager)===null||r===void 0?void 0:r.modelState;return B&&s.bannerController.selectBanner(B),s.setBaseMouseEventListeners(),s.hostDevice.touchable&&s.setBaseTouchEventListeners(),s._Box.style.display="none",s.initialized=!0,s}return Object.defineProperty(e.prototype,"keyCodes",{get:function(){return h.keyCodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"modifierCodes",{get:function(){return h.modifierCodes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"modifierBitmasks",{get:function(){return h.modifierBitmasks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stateBitmasks",{get:function(){return h.stateBitmasks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"configuration",{get:function(){return this.config},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bannerController",{get:function(){return this._bannerController},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hostDevice",{get:function(){return this.config.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontRootPath",{get:function(){return this.config.pathConfig.fonts},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmbedded",{get:function(){return this.config.isEmbedded},enumerable:!1,configurable:!0}),e.prototype.setBaseMouseEventListeners=function(){var t=this;this._Box.onmouseenter=function(n){t.mouseEnterPromise&&t.mouseEnterPromise.resolve(),t.mouseEnterPromise=new A,t.emit("pointerinteraction",t.mouseEnterPromise.corePromise)},this._Box.onmouseleave=function(n){t.mouseEnterPromise.resolve(),t.mouseEnterPromise=null}},e.prototype.removeBaseMouseEventListeners=function(){this._Box.onmouseenter=null,this._Box.onmouseleave=null},e.prototype.setBaseTouchEventListeners=function(){var t=this,n=function(i){return i.cancelable&&i.preventDefault(),i.stopPropagation(),!1};this._boxBaseTouchEventCancel=function(i){return t.touchEventPromiseManager.maintainTouches(i.touches),n(i)},this._boxBaseTouchStart=function(i){for(var r=0;r<i.changedTouches.length;r++){var s=t.touchEventPromiseManager.promiseForTouchpoint(i.changedTouches[r].identifier);t.emit("pointerinteraction",s.corePromise)}return t.touchEventPromiseManager.maintainTouches(i.touches),n(i)},this._Box.addEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.addEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.addEventListener("touchcancel",this._boxBaseTouchEventCancel,!1)},e.prototype.removeBaseTouchEventListeners=function(){!this._boxBaseTouchEventCancel||(this._Box.removeEventListener("touchstart",this._boxBaseTouchStart,!1),this._Box.removeEventListener("touchmove",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchend",this._boxBaseTouchEventCancel,!1),this._Box.removeEventListener("touchcancel",this._boxBaseTouchEventCancel,!1),this._boxBaseTouchEventCancel=null,this._boxBaseTouchStart=null)},Object.defineProperty(e.prototype,"targetDevice",{get:function(){return this.config.device},set:function(t){this.allowsDeviceChange(t)?(this.config.device=t,this.loadActiveKeyboard()):console.error("May not change target device for this OSKView type.")},enumerable:!1,configurable:!0}),e.prototype.allowsDeviceChange=function(t){return!1},Object.defineProperty(e.prototype,"activationModel",{get:function(){return this.config.activator},set:function(t){if(!t)throw new Error("The activation model may not be set to null or undefined!");this.config.activator.off("activate",this.activationListener),t.on("activate",this.activationListener),this.config.activator=t,this.commonCheckAndDisplay()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mayDisable",{get:function(){var t;return!(this.hostDevice.touchable||!((t=this.activeKeyboard)===null||t===void 0)&&t.keyboard.isCJK)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displayIfActive",{get:function(){return this.activationModel.enabled},enumerable:!1,configurable:!0}),e.prototype.commonCheckAndDisplay=function(){this.activationModel.activate&&this.activeKeyboard?this.present():this.startHide(!1)},Object.defineProperty(e.prototype,"vkbd",{get:function(){return this.keyboardView instanceof Vt?this.keyboardView:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"banner",{get:function(){return this.bannerView},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"computedWidth",{get:function(){return this.needsLayout&&this.refreshLayout(),this._computedWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"computedHeight",{get:function(){return this.needsLayout&&this.refreshLayout(),this._computedHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"baseFontSize",{get:function(){var t;return((t=this.parsedBaseFontSize)===null||t===void 0?void 0:t.styleString)||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parsedBaseFontSize",{get:function(){return this._baseFontSize||(this._baseFontSize=e.defaultFontSize(this.targetDevice,this.computedHeight,this.isEmbedded)),this._baseFontSize},enumerable:!1,configurable:!0}),e.defaultFontSize=function(t,n,i){if(t.touchable){var r=t.formFactor=="phone"?1.6*(i?.65:.6)*1.2:2;return J.special(r,"em")}else return n?J.inPixels(n/8):void 0},Object.defineProperty(e.prototype,"activeKeyboard",{get:function(){return this.keyboardData},set:function(t){var n,i,r;this.initialized&&((n=this.keyboardData)===null||n===void 0?void 0:n.keyboard)==(t==null?void 0:t.keyboard)&&((i=this.keyboardData)===null||i===void 0?void 0:i.metadata)==(t==null?void 0:t.metadata)||(this.keyboardData=t,this.loadActiveKeyboard(),!((r=this.keyboardData)===null||r===void 0)&&r.keyboard.isCJK&&(this.activationModel.enabled=!0))},enumerable:!1,configurable:!0}),e.prototype.computeFrameHeight=function(){var t,n;return(((t=this.headerView)===null||t===void 0?void 0:t.layoutHeight.val)||0)+(((n=this.footerView)===null||n===void 0?void 0:n.layoutHeight.val)||0)},e.prototype.setSize=function(t,n,i){var r=!1,s,l;!t&&t!==0||!n&&n!==0||(Number.isFinite(t)?s=J.inPixels(t):s=new J(t),Number.isFinite(n)?l=J.inPixels(n):l=new J(n),t&&n&&(r=!this._width||!this._height,r=r||s.styleString!=this._width.styleString,r=r||l.styleString!=this._height.styleString,this._width=s,this._height=l),this.needsLayout=this.needsLayout||r,this.refreshLayoutIfNeeded(i))},e.prototype.setNeedsLayout=function(){this.needsLayout=!0},e.prototype.batchLayoutAfter=function(t){if(this.deferLayout){t();return}try{this.deferLayout=!0,this.vkbd&&(this.vkbd.deferLayout=!0),t()}finally{this.deferLayout=!1,this.vkbd&&(this.vkbd.deferLayout=!1),this.refreshLayout()}},e.prototype.refreshLayout=function(t){var n,i;if(!(!this.keyboardView||this.deferLayout)){var r=this.width&&this.height;if(!!r){var s=this.width.absolute&&this.height.absolute,l=getComputedStyle(this._Box),o=l.height!=""&&l.height!="auto";if(s)this._computedWidth=this.width.val,this._computedHeight=this.height.val;else if(o){var a=this._Box.parentElement;this._computedWidth=this.width.val*(this.width.absolute?1:a.offsetWidth),this._computedHeight=this.height.val*(this.height.absolute?1:a.offsetHeight)}else{console.warn("Unable to properly perform layout - specification uses a relative spec, thus relies upon insertion into the DOM for layout.");return}if(this.needsLayout=!1,this.banner.element.style.fontSize=this.baseFontSize,this.vkbd&&(this.vkbd.fontSize=this.parsedBaseFontSize),t||((n=this.headerView)===null||n===void 0||n.refreshLayout(),this.bannerView.width=this.computedWidth,this.bannerView.refreshLayout(),(i=this.footerView)===null||i===void 0||i.refreshLayout()),this.vkbd){var g=this.computedHeight-this.computeFrameHeight();this.bannerView.height>0&&(g-=this.bannerView.height+5),this.vkbd.setSize(this.computedWidth,g,t);var d=this._Box.style;d.width=d.maxWidth=this.computedWidth+"px",d.height=d.maxHeight=this.computedHeight+"px"}else{var d=this._Box.style;d.width="auto",d.height="auto",d.maxWidth=d.maxHeight=""}}}},e.prototype.refreshLayoutIfNeeded=function(t){this.needsLayout&&this.refreshLayout(t)},e.prototype.postKeyboardLoad=function(){this._Visible=!1,this.postKeyboardAdjustments(),this.displayIfActive&&this.present()},e.prototype.loadActiveKeyboard=function(){var t,n,i,r,s;this.setBoxStyling(),this.needsLayout=!0;var l=this.keyboardView,o=this.kbdStyleSheetManager;this.kbdStyleSheetManager=new Ft(this._Box,this.config.doCacheBusting||!1);var a=this.keyboardView=this._GenerateKeyboardView((t=this.keyboardData)===null||t===void 0?void 0:t.keyboard,(n=this.keyboardData)===null||n===void 0?void 0:n.metadata);if(this._Box.replaceChild(a.element,l.element),a.postInsert(),(i=this.bannerController)===null||i===void 0||i.configureForKeyboard((r=this.keyboardData)===null||r===void 0?void 0:r.keyboard,(s=this.keyboardData)===null||s===void 0?void 0:s.metadata),l instanceof Vt&&l.shutdown(),o.unlinkAll(),this.banner.appendStyles(),this.vkbd){this.vkbd.createKeyTip();var g=this.vkbd.createGlobeHint();g&&this._Box.appendChild(g.element),this.vkbd.appendStyleSheet()}this.postKeyboardLoad()},e.prototype._GenerateKeyboardView=function(t,n){var i=this.targetDevice;return this._Box.className="",t==null&&!i.touchable?new be:t&&t.layout(i.formFactor)?this._GenerateVisualKeyboard(t,n):!t||!n?this._GenerateVisualKeyboard(null,null):new Dc(t)},e.prototype._GenerateVisualKeyboard=function(t,n){var i=this,r=this.targetDevice,s=ar(this.config),l=new Vt({keyboard:t,keyboardMetadata:n,device:r,hostDevice:this.hostDevice,topContainer:this._Box,styleSheetManager:this.kbdStyleSheetManager,pathConfig:this.config.pathConfig,embeddedGestureConfig:this.config.embeddedGestureConfig,isEmbedded:this.config.isEmbedded,specialFont:{family:"SpecialOSK",files:["".concat(s,"/keymanweb-osk.ttf")],path:""}});return l.on("keyevent",function(o,a){return i.emit("keyevent",o,a)}),l.on("globekey",function(o,a){return i.emit("globekey",o,a)}),l.on("hiderequested",function(o){i.doHide(!0),i.emit("hiderequested",o)}),this._Box.className=r.formFactor+" "+r.OS.toLowerCase()+" kmw-osk-frame",l},e.prototype.present=function(){if(!!this.mayShow()){if(this.keyboardView.updateState(),this._Box.style.display="block",this.refreshLayoutIfNeeded(),this._Visible=!0,this._Box.style.opacity="1",this._Box.style.visibility=="hidden"){var t=this;window.setTimeout(function(){t._Box.style.visibility="visible"},0)}this.setDisplayPositioning()}},e.prototype.startHide=function(t){if(!!this.mayHide(t)){t&&(this.activationModel.enabled=!!(this.keyboardData.keyboard.isCJK||this.hostDevice.touchable));var n=null;this._Box&&this.hostDevice.touchable&&!(this.keyboardView instanceof be)&&this.config.allowHideAnimations?n=this.useHideAnimation():n=Promise.resolve(!0);var i=this;n.then(function(r){r&&i.finalizeHide()}),this.doHide(t)}},e.prototype.finalizeHide=function(){if(!(document.body.className.indexOf("osk-always-visible")>=0&&this.hostDevice.formFactor=="desktop")){if(this._Box){var t=this._Box.style;t.display="none",t.transition="",t.opacity="1",this._Visible=!1}this.vkbd&&this.vkbd.onHide()}},e.prototype.mayShow=function(){return!(!this.activationModel.conditionsMet||!this.keyboardView||this.keyboardView instanceof be||!this.activationModel.enabled||!this._Box)},e.prototype.mayHide=function(t){return!(this.activationModel.conditionsMet&&!this.mayDisable||this.activationModel instanceof xe||!t&&this.hostDevice.formFactor=="desktop"&&document.body.className.indexOf("osk-always-visible")>=0)},e.prototype.useHideAnimation=function(){var t=this._Box.style,n=this;return new Promise(function(i){var r=function(){return n._Box.removeEventListener("transitionend",r,!1),n._Box.removeEventListener("webkitTransitionEnd",r,!1),n._Box.removeEventListener("transitioncancel",r,!1),n._Box.removeEventListener("webkitTransitionCancel",r,!1),n._animatedHideTimeout!=0&&window.clearTimeout(n._animatedHideTimeout),n._animatedHideTimeout=0,n._Visible&&n.activationModel.conditionsMet?(t.transition="",t.opacity="1",i(!1),!1):(i(!0),!0)},s=function(){n._Box.removeEventListener("transitionrun",s,!1),n._Box.removeEventListener("webkitTransitionRun",s,!1),n._Box.addEventListener("transitionend",r,!1),n._Box.addEventListener("webkitTransitionEnd",r,!1),n._Box.addEventListener("transitioncancel",r,!1),n._Box.addEventListener("webkitTransitionCancel",r,!1)};n._Box.addEventListener("transitionrun",s,!1),n._Box.addEventListener("webkitTransitionRun",s,!1),t.transition="opacity 0.5s linear 0",t.opacity="0",n._animatedHideTimeout=window.setTimeout(r,200)})},e.prototype.hideNow=function(){if(!(!this.mayHide(!1)||!this._Box)){this._animatedHideTimeout&&(window.clearTimeout(this._animatedHideTimeout),this._animatedHideTimeout=0);var t=this._Box.style;t.transition="",t.opacity="0",this.finalizeHide()}},e.prototype.shutdown=function(){this.removeBaseMouseEventListeners(),this.removeBaseTouchEventListeners();var t=this._Box;t.parentElement&&t.parentElement.removeChild(t),this.kbdStyleSheetManager.unlinkAll(),this.uiStyleSheetManager.unlinkAll(),this.bannerController.shutdown()},e.prototype.getRect=function(){var t={};return t.left=t.left=z(this._Box),t.top=t.top=K(this._Box),t.width=this.computedWidth,t.height=this.computedHeight,t},e.prototype.isEnabled=function(){return this.displayIfActive},e.prototype.isVisible=function(){return this._Visible},e.prototype.hide=function(){this.activationModel.enabled=!1,this.startHide(!0)},e.prototype.show=function(t){arguments.length>0?this.activationModel.enabled=t:this.activationModel.conditionsMet&&(this.activationModel.enabled=!this.activationModel.enabled)},e.prototype.doShow=function(t){this.legacyEvents.callEvent("show",t)},e.prototype.doHide=function(t){var n={HiddenByUser:t};this.legacyEvents.callEvent("hide",n)},e.prototype.addEventListener=function(t,n){this.legacyEvents.addEventListener(t,n)},e.prototype.removeEventListener=function(t,n){this.legacyEvents.removeEventListener(t,n)},e.STYLESHEET_FILES=["kmwosk.css","globe-hint.css"],e}(V.default),vt=Yl;var wl=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.mouseCancellingHandler=function(i){return i.preventDefault(),i.cancelBubble=!0,!1},n._element=n.buildTitleBar(),n.helpEnabled=!1,n.configEnabled=!1,t&&(n.element.onmousedown=t.mouseDownHandler),n}return Object.defineProperty(e.prototype,"helpEnabled",{get:function(){return this._helpEnabled},set:function(t){this._helpEnabled=t,this._helpButton.style.display=t?"inline":"none"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"configEnabled",{get:function(){return this._configEnabled},set:function(t){this._configEnabled=t,this._configButton.style.display=t?"inline":"none"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layoutHeight",{get:function(){return e.DISPLAY_HEIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),e.prototype.setPinCJKOffset=function(){this._unpinButton.style.left="15px"},e.prototype.showPin=function(t){this._unpinButton.style.display=t?"block":"none"},e.prototype.setTitle=function(t){this._caption.innerHTML=t},e.prototype.setTitleFromKeyboard=function(t){var n="<span style='font-weight:bold'>"+(t==null?void 0:t.name)+"</span>";this._caption.innerHTML=n},e.prototype.buildTitleBar=function(){var t=this,n=E("div");n.id="keymanweb_title_bar",n.className="kmw-title-bar";var i=this._caption=E("span");i.className="kmw-title-bar-caption",i.style.color="#fff",n.appendChild(i);var r=this._closeButton=this.buildCloseButton();return this._closeButton.onclick=function(){return t.emit("close"),!1},n.appendChild(r),r=this._helpButton=this.buildHelpButton(),this._helpButton.onclick=function(){return t.emit("help"),!1},n.appendChild(r),r=this._configButton=this.buildConfigButton(),this._configButton.onclick=function(){return t.emit("config"),!1},n.appendChild(r),r=this._unpinButton=this.buildUnpinButton(),this._unpinButton.onclick=function(){return t.emit("unpin"),!1},n.appendChild(r),n},e.prototype.buildCloseButton=function(){var t=E("div");return t.id="kmw-close-button",t.className="kmw-title-bar-image",t.onmousedown=this.mouseCancellingHandler,t},e.prototype.buildHelpButton=function(){var t=E("div");return t.id="kmw-help-image",t.className="kmw-title-bar-image",t.title="KeymanWeb Help",t.onmousedown=this.mouseCancellingHandler,t},e.prototype.buildConfigButton=function(){var t=E("div");return t.id="kmw-config-image",t.className="kmw-title-bar-image",t.title="KeymanWeb Configuration Options",t.onmousedown=this.mouseCancellingHandler,t},e.prototype.buildUnpinButton=function(){var t=E("div");return t.id="kmw-pin-image",t.className="kmw-title-bar-image",t.title="Pin the On Screen Keyboard to its default location on the active text box",t.onmousedown=this.mouseCancellingHandler,t},e.prototype.refreshLayout=function(){},e.DISPLAY_HEIGHT=J.inPixels(20),e}(V.default),si=wl;var Dl=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.mouseCancellingHandler=function(i){return i.preventDefault(),i.cancelBubble=!0,!1},n._element=n.buildResizeBar(),t&&(n._resizeHandle.onmousedown=t.mouseDownHandler),n}return Object.defineProperty(e.prototype,"layoutHeight",{get:function(){return e.DISPLAY_HEIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this._element},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"handle",{get:function(){return this._resizeHandle},enumerable:!1,configurable:!0}),e.prototype.allowResizing=function(t){this._resizeHandle.style.display=t?"block":"none"},e.prototype.buildResizeBar=function(){var t=this,n=E("div");n.className="kmw-footer",n.onmousedown=this.mouseCancellingHandler;var i=E("div");i.className="kmw-footer-caption",i.innerHTML='<a href="https://keyman.com/developer/keymanweb/">KeymanWeb</a>',i.id="keymanweb-osk-footer-caption",i.addEventListener("dblclick",function(s){return t.emit("showbuild"),!1},!1),n.appendChild(i);var r=E("div");return r.className="kmw-footer-resize",n.appendChild(r),this._resizeHandle=r,n},e.prototype.refreshLayout=function(){},e.DISPLAY_HEIGHT=J.inPixels(16),e}(V.default),gr=Dl;var dr=function(){function c(e,t,n){this.x=e,this.y=t}return c.fromEvent=function(e){var t;if(window.TouchEvent&&e instanceof TouchEvent||e.changedTouches?t=e.changedTouches[0]:t=e,t.pageX)return new c(t.pageX,t.pageY,e);if(t.clientX){var n=t.clientX+document.body.scrollLeft,i=t.clientY+document.body.scrollTop;return new c(n,i,e)}else return new c(null,null,e)},c}(),Ml=function(){function c(e){this._VPreviousMouseMove=document.onmousemove,this._VPreviousMouseUp=document.onmouseup,this._VPreviousCursor=document.body.style.cursor,this._VPreviousMouseButton=typeof e.which=="undefined"?e.button:e.which}return c.prototype.restore=function(){document.onmousemove=this._VPreviousMouseMove,document.onmouseup=this._VPreviousMouseUp,document.body.style.cursor&&(document.body.style.cursor=this._VPreviousCursor)},c.prototype.matchesCausingClick=function(e){return this._VPreviousMouseButton==(typeof e.which=="undefined"?e.button:e.which)},c}(),zl=function(){function c(e){this.startHandler=this._VMoveMouseDown.bind(this),this.cursorType=e}return Object.defineProperty(c.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isActive",{get:function(){return!!this._mouseStartSnapshot},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"mouseDownHandler",{get:function(){return this.startHandler},enumerable:!1,configurable:!0}),c.prototype._VMoveMouseDown=function(e){return!e||!this._enabled?!0:(this._mouseStartSnapshot||(this._mouseStartSnapshot=new Ml(e)),this._startCoord=dr.fromEvent(e),document.onmousemove=this._VMoveMouseMove.bind(this),document.onmouseup=this._VMoveMouseUp.bind(this),document.body.style.cursor&&(document.body.style.cursor=this.cursorType),e.preventDefault(),e.cancelBubble=!0,this.onDragStart(),!1)},c.prototype._VMoveMouseMove=function(e){if(!e||!this.enabled)return!0;if(e.preventDefault(),e.cancelBubble=!0,this._mouseStartSnapshot.matchesCausingClick(e)){var t=dr.fromEvent(e),n=t.x-this._startCoord.x,i=t.y-this._startCoord.y;return this.onDragMove(n,i),!1}else return this._VMoveMouseUp(e)},c.prototype._VMoveMouseUp=function(e){return e?(this._mouseStartSnapshot.restore(),this._mouseStartSnapshot=null,e.preventDefault(),e.cancelBubble=!0,this.onDragRelease(),!1):!0},c}(),li=zl;var Kl=function(c){(0,Q.__extends)(e,c);function e(){var t=c.apply(this,(0,Q.__spreadArray)([],(0,Q.__read)(arguments),!1))||this;return t._enabled=!0,t.actValue=null,t}return Object.defineProperty(e.prototype,"activate",{get:function(){return this._enabled&&!!this.actValue},enumerable:!1,configurable:!0}),e.prototype.checkState=function(t){this.activate!=t&&this.emit("activate",this.activate)},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(t){var n=this.activate;this._enabled=t,this.checkState(n)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activationTrigger",{get:function(){return this.actValue},set:function(t){var n=this.activate,i=this.actValue;this.actValue=t,this.checkState(n),i!=t&&this.emit("triggerchange",t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conditionsMet",{get:function(){return!!this.activationTrigger},enumerable:!1,configurable:!0}),e}(Xe),Ge=Kl;var Qr=function(c){(0,Q.__extends)(e,c);function e(){return c.call(this,"KeymanWeb_OnScreenKeyboard")||this}return e.prototype.loadWithDefaults=function(t){return(0,Q.__assign)((0,Q.__assign)({},t),this.load())},e.prototype.load=function(){var t=c.prototype.load.call(this,function(n,i){switch(i){case"version":return n;default:return Number.parseInt(n,10)}});return t.width||delete t.width,t.height||delete t.height,t},e.prototype.save=function(t){c.prototype.save.call(this,t)},e}(yt);var Ol=function(c){(0,Q.__extends)(e,c);function e(t){var n,i,r=this;t.activator=t.activator||new Ge,r=c.call(this,t)||this,r.userPositioned=!1,r.specifiedPosition=!1,r.noDrag=!1,r.layoutSerializer=new Qr,r.restorePosition=function(B){var u=this._Visible,y=new A;this.emit("dragmove",y.corePromise),this.loadPersistedLayout(),this.userPositioned=!1,B||(delete this.dfltX,delete this.dfltY),this.savePersistedLayout(),u&&this.present(),this.titleBar.showPin(!1),y.resolve(),this.doResizeMove()}.bind(r),r.typedActivationModel.on("triggerchange",function(){return r.setDisplayPositioning()}),document.body.appendChild(r._Box),r.titleBar=new si(r.titleDragHandler),r.titleBar.on("help",function(){r.legacyEvents.callEvent("helpclick",{})}),r.titleBar.on("config",function(){r.legacyEvents.callEvent("configclick",{})}),r.titleBar.on("close",function(){return r.startHide(!0)}),r.titleBar.on("unpin",function(){return r.restorePosition(!0)}),r.resizeBar=new gr(r.resizeDragHandler),r.resizeBar.on("showbuild",function(){return r.emit("showbuild")}),r.headerView=r.titleBar,r._Box.insertBefore(r.headerView.element,r._Box.firstChild);var s=function(B){var u=r.headerView;if(u&&u instanceof si)switch(B){case"configclick":u.configEnabled=r.legacyEvents.listenerCount("configclick")>0;break;case"helpclick":u.helpEnabled=r.legacyEvents.listenerCount("helpclick")>0;break;default:return}},l=new Ee(r),o=new Ee(r.legacyEvents);try{for(var a=(0,Q.__values)([l,o]),g=a.next();!g.done;g=a.next()){var d=g.value;d.on("listeneradded",s),d.on("listenerremoved",s)}}catch(B){n={error:B}}finally{try{g&&!g.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return r.loadPersistedLayout(),r}return Object.defineProperty(e.prototype,"typedActivationModel",{get:function(){return this.activationModel},enumerable:!1,configurable:!0}),e.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},e.prototype.setBoxStyling=function(){var t=this._Box.style;t.zIndex="9999",t.display="none",t.width="auto",t.position="absolute"},e.prototype.postKeyboardAdjustments=function(){this.enableMoveResizeHandlers(),this.activeKeyboard&&this.titleBar.setTitleFromKeyboard(this.activeKeyboard.keyboard),this.vkbd?(this.footerView=this.resizeBar,this._Box.appendChild(this.footerView.element)):(this.footerView&&this._Box.removeChild(this.footerView.element),this.footerView=null),this.loadPersistedLayout(),this.setNeedsLayout()},e.prototype.isEnabled=function(){return this.displayIfActive},e.prototype.isVisible=function(){return this._Visible},e.prototype.savePersistedLayout=function(){var t=this.getPos(),n={visible:this.displayIfActive?1:0,userSet:this.userPositioned?1:0,left:t.left,top:t.top,_version:tt.CURRENT.toString()};this.vkbd&&(n.width=this.width.val,n.height=this.height.val),this.layoutSerializer.save(n)},e.prototype.loadPersistedLayout=function(){if(!!this.layoutSerializer){var t=this.layoutSerializer.loadWithDefaults({visible:1,userSet:0,left:-1,top:-1,_version:void 0,width:.3*screen.width,height:.15*screen.height});this.activationModel.enabled=t.visible==1,this.userPositioned=t.userSet==1,this.x=t.left,this.y=t.top;var n=t._version,i=n===void 0,r=t.width,s=t.height;r<.2*screen.width&&(r=.2*screen.width),s<.1*screen.height&&(s=.1*screen.height),r>.9*screen.width&&(r=.9*screen.width),s>.5*screen.height&&(s=.5*screen.height),(i||!n)&&(this.headerView&&this.headerView.layoutHeight.absolute&&(s+=this.headerView.layoutHeight.val),this.footerView&&this.footerView.layoutHeight.absolute&&(s+=this.footerView.layoutHeight.val)),this.setSize(r,s),(this.x==-1||this.y==-1||!this._Box)&&(this.userPositioned=!1),this.x<window.pageXOffset-.8*r&&(this.x=window.pageXOffset-.8*r),this.y<0&&(this.x=-1,this.y=-1,this.userPositioned=!1),this.userPositioned&&this._Box&&this.setPos({left:this.x,top:this.y})}},e.prototype.getDefaultKeyboardHeight=function(){if(this.configuration.heightOverride)return this.configuration.heightOverride();var t=Math.floor(Math.min(screen.availHeight,screen.availWidth)/2),n=t;if(this.targetDevice.formFactor=="phone"){var i=Math.min(screen.height,screen.width),r=Math.max(screen.height,screen.width);rt()?n=n*(r/i)/1.6:n=Math.floor(Math.max(screen.availHeight,screen.availWidth)/3)}return this.targetDevice.OS==v.OperatingSystem.iOS&&(n=n/bt(this.targetDevice.formFactor)),n},e.prototype.getDefaultWidth=function(){if(this.configuration.widthOverride)return this.configuration.widthOverride();var t;if(this.targetDevice.OS==v.OperatingSystem.iOS)t=window.innerWidth;else if(this.targetDevice.OS==v.OperatingSystem.Android)try{t=document.documentElement.clientWidth}catch(n){t=screen.availWidth}else t=screen.width;return t},e.prototype.doResizeMove=function(t){this.legacyEvents.callEvent("resizemove",t)},e.prototype.setRect=function(t){if(!(this._Box==null||this.targetDevice.formFactor!="desktop")){var n=this._Box,i=n.style;if("left"in t&&(this.x=t.left-z(n)+n.offsetLeft,i.left=this.x+"px",this.dfltX=i.left),"top"in t&&(this.y=t.top-K(n)+n.offsetTop,i.top=this.y+"px",this.dfltY=i.top),this.vkbd!=null){var r=this.vkbd.kbdDiv,s=r.style;if("width"in t){var l=t.width-(n.offsetWidth-r.offsetWidth);l<.2*screen.width&&(l=.2*screen.width),l>.9*screen.width&&(l=.9*screen.width),s.width=l+"px",this.setSize(l,this.computedHeight,!0)}if("height"in t){var o=t.height-(n.offsetHeight-r.offsetHeight);o<.1*screen.height&&(o=.1*screen.height),o>.5*screen.height&&(o=.5*screen.height),s.height=o+"px",s.fontSize=o/8+"px",this.setSize(this.computedWidth,o,!0)}"nosize"in t&&(this.resizingEnabled=!t.nosize)}"nomove"in t&&(this.noDrag=t.nomove,this.movementEnabled=!this.noDrag),this.savePersistedLayout()}},e.prototype.getPos=function(){var t=this._Box,n={left:this._Visible?t.offsetLeft:this.x,top:this._Visible?t.offsetTop:this.y};return n},e.prototype.setPos=function(t){if(typeof this._Box!="undefined"){if(this.userPositioned){var n=t.left,i=t.top;typeof n!="undefined"&&(n<-.8*this._Box.offsetWidth&&(n=-.8*this._Box.offsetWidth),this.userPositioned&&(this._Box.style.left=n+"px",this.x=n)),typeof i!="undefined"&&(i<0&&(i=0),this.userPositioned&&(this._Box.style.top=i+"px",this.y=i))}this.titleBar.showPin(this.userPositioned)}},e.prototype.setDisplayPositioning=function(){var t=this._Box.style;if(t.position="absolute",this.activationModel.activate&&(t.display="block"),t.left="0px",this.specifiedPosition||this.userPositioned)t.left=this.x+"px",t.top=this.y+"px";else{var n=this.typedActivationModel.activationTrigger||null;this.dfltX?t.left=this.dfltX:typeof n!="undefined"&&n!=null&&(t.left=z(n)+"px"),this.dfltY?t.top=this.dfltY:typeof n!="undefined"&&n!=null&&(t.top=K(n)+n.offsetHeight+"px")}this.specifiedPosition=!1},e.prototype.presentAtPosition=function(t,n){!this.mayShow()||(this.specifiedPosition=t>=0||n>=0,this.specifiedPosition&&(this.x=t,this.y=n),this.specifiedPosition=this.specifiedPosition||this.userPositioned,this.present())},e.prototype.present=function(){!this.mayShow()||(this.titleBar.showPin(this.userPositioned),c.prototype.present.call(this),this.doShow({x:this._Box.offsetLeft,y:this._Box.offsetTop,userLocated:this.userPositioned}))},e.prototype.startHide=function(t){c.prototype.startHide.call(this,t),t&&this.savePersistedLayout()},e.prototype.show=function(t){t!==void 0?c.prototype.show.call(this,t):c.prototype.show.call(this),this.savePersistedLayout()},e.prototype.userLocated=function(){return this.userPositioned},Object.defineProperty(e.prototype,"movementEnabled",{get:function(){return this.titleDragHandler.enabled},set:function(t){this.titleDragHandler.enabled=t,this.titleBar.showPin(t&&this.userPositioned)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resizingEnabled",{get:function(){return this.resizeDragHandler.enabled},set:function(t){this.resizeDragHandler.enabled=t,this.resizeBar.allowResizing(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBeingMoved",{get:function(){return this.titleDragHandler.isActive},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBeingResized",{get:function(){return this.resizeDragHandler.isActive},enumerable:!1,configurable:!0}),e.prototype.enableMoveResizeHandlers=function(){this.titleDragHandler.enabled=!this.noDrag,this.resizeDragHandler.enabled=!0},Object.defineProperty(e.prototype,"titleDragHandler",{get:function(){var t=this;return this._moveHandler?this._moveHandler:(this._moveHandler=new(function(n){(0,Q.__extends)(i,n);function i(){return n.call(this,"move")||this}return i.prototype.onDragStart=function(){this.startX=t._Box.offsetLeft,this.startY=t._Box.offsetTop,t.activeKeyboard.keyboard.isCJK&&t.titleBar.setPinCJKOffset(),this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new A,t.emit("dragmove",this.dragPromise.corePromise)},i.prototype.onDragMove=function(r,s){t.titleBar.showPin(!0),t.userPositioned=!0,t._Box.style.left=this.startX+r+"px",t._Box.style.top=this.startY+s+"px";var l=t.getRect();t.setSize(l.width,l.height,!0),t.x=l.left,t.y=l.top},i.prototype.onDragRelease=function(){t.vkbd&&(t.vkbd.currentKey=null),this.dragPromise.resolve(),this.dragPromise.then(function(){t.userPositioned=!0,t.doResizeMove(),t.savePersistedLayout()}),this.dragPromise=null},i}(li)),this._moveHandler)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resizeDragHandler",{get:function(){var t=this;return this._resizeHandler?this._resizeHandler:(this._resizeHandler=new(function(n){(0,Q.__extends)(i,n);function i(){return n.call(this,"se-resize")||this}return i.prototype.onDragStart=function(){this.startWidth=t.computedWidth,this.startHeight=t.computedHeight,this.dragPromise&&this.dragPromise.resolve(),this.dragPromise=new A,t.emit("resizemove",this.dragPromise.corePromise)},i.prototype.onDragMove=function(r,s){var l=this.startWidth+r,o=this.startHeight+s;l<.2*screen.width&&(l=.2*screen.width),o<.1*screen.height&&(o=.1*screen.height),l>.9*screen.width&&(l=.9*screen.width),o>.5*screen.height&&(o=.5*screen.height),t.setSize(l,o,!0)},i.prototype.onDragRelease=function(){t.vkbd&&(t.vkbd.currentKey=null),t.vkbd&&(this.startWidth=t.computedWidth,this.startHeight=t.computedHeight),t.refreshLayout(),this.dragPromise.resolve(),this.dragPromise.then(function(){t.doResizeMove(),t.savePersistedLayout()}),this.dragPromise=null},i}(li)),this._resizeHandler)},enumerable:!1,configurable:!0}),e}(vt),te=Ol;var _l=function(c){(0,Q.__extends)(e,c);function e(t){var n=this;return t.isEmbedded?t.activator=t.activator||new xe:t.activator=t.activator||new Ge,n=c.call(this,t)||this,n.isResizing=!1,n.restorePosition=function(i){}.bind(n),document.body.appendChild(n._Box),n}return e.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},e.prototype.setBoxStyling=function(){var t=this._Box.style;t.zIndex="9999",t.display="none",t.width="100%",t.position="fixed"},e.prototype.refreshLayout=function(t){if(!this.isResizing){try{this.isResizing=!0,this.doResize()}finally{this.isResizing=!1}c.prototype.refreshLayout.call(this,t)}},e.prototype.doResize=function(){if(this.vkbd){var t=this.getDefaultKeyboardHeight();this.setSize(this.getDefaultWidth(),t+this.banner.height)}},e.prototype.postKeyboardAdjustments=function(){this.doResize()},e.prototype.getDefaultKeyboardHeight=function(){var t,n,i=this.targetDevice;if(this.configuration.heightOverride)return this.configuration.heightOverride();var r=(t=document==null?void 0:document.documentElement)===null||t===void 0?void 0:t.clientWidth,s=(n=document==null?void 0:document.documentElement)===null||n===void 0?void 0:n.clientHeight;if(typeof r=="undefined"&&(r=Math.min(screen.height,screen.width),s=Math.max(screen.height,screen.width),rt())){var l=r;r=s,s=l}var o=Math.floor(Math.min(s,r)/2),a=o;return i.formFactor=="phone"&&(rt()?a=Math.floor(s/1.6):a=Math.floor(s/2.4)),this.targetDevice.OS==v.OperatingSystem.iOS&&(a=a/bt(this.targetDevice.formFactor)),a},e.prototype.getDefaultWidth=function(){var t,n=this.targetDevice;if(this.configuration.widthOverride)return this.configuration.widthOverride();var i;return i=(t=document==null?void 0:document.documentElement)===null||t===void 0?void 0:t.clientWidth,typeof i=="undefined"&&(this.targetDevice.OS==v.OperatingSystem.iOS?i=window.innerWidth:n.OS==v.OperatingSystem.Android?i=screen.availWidth:i=screen.width),i},e.prototype.setRect=function(t){},e.prototype.getPos=function(){var t=this._Box,n={left:this._Visible?t.offsetLeft:this.x,top:this._Visible?t.offsetTop:this.y};return n},e.prototype.setPos=function(t){},e.prototype.setDisplayPositioning=function(){var t=this._Box.style;this.vkbd&&(t.position="fixed",t.left=t.bottom="0px",t.border="none",t.borderTop="1px solid gray")},e.prototype.present=function(){c.prototype.present.call(this),this.legacyEvents.callEvent("show",{})},e}(vt),oi=_l;var Pl=function(c){(0,Q.__extends)(e,c);function e(){var t=c.apply(this,(0,Q.__spreadArray)([],(0,Q.__read)(arguments),!1))||this;return t.flag=!0,t}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this.flag},set:function(t){this.activate=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activate",{get:function(){return this.flag},set:function(t){this.flag!=t&&(this.flag=t,this.emit("activate",t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"conditionsMet",{get:function(){return!0},enumerable:!1,configurable:!0}),e}(Xe),ai=Pl;var jl=function(c){(0,Q.__extends)(e,c);function e(t){var n=this;return t.activator=t.activator||new ai,n=c.call(this,t)||this,n.restorePosition=function(i){}.bind(n),n}return Object.defineProperty(e.prototype,"element",{get:function(){return this._Box},enumerable:!1,configurable:!0}),e.prototype._Unload=function(){this.keyboardView=null,this.bannerView=null,this._Box=null},e.prototype.setBoxStyling=function(){var t=this._Box.style;t.display="none",t.position="relative"},e.prototype.postKeyboardAdjustments=function(){},e.prototype.getDefaultKeyboardHeight=function(){return this.keyboardView instanceof Vt?this.keyboardView.height:this.computedHeight},e.prototype.getDefaultWidth=function(){return this.computedWidth},e.prototype.setRect=function(t){},e.prototype.getPos=function(){var t=this._Box,n={left:this._Visible?t.offsetLeft:void 0,top:this._Visible?t.offsetTop:void 0};return n},e.prototype.setPos=function(t){},e.prototype.present=function(){c.prototype.present.call(this),this.legacyEvents.callEvent("show",{})},e.prototype.setDisplayPositioning=function(){},e.prototype.allowsDeviceChange=function(t){return!0},e}(vt),gi=jl;var ui={};Gi(ui,{AnchoredOSKView:function(){return Qi},FloatingOSKView:function(){return Bi},InlinedOSKView:function(){return ql}});function di(c){return{hostDevice:c.config.hostDevice,pathConfig:c.config.paths,predictionContextManager:c.contextManager.predictionContext,isEmbedded:!1}}var Qi=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=(0,Q.__assign)((0,Q.__assign)({},di(t)),n||{});return c.call(this,i)||this}return e}(oi),Bi=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=(0,Q.__assign)((0,Q.__assign)({},di(t)),n||{});return c.call(this,i)||this}return e}(te),ql=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=(0,Q.__assign)((0,Q.__assign)({},di(t)),n||{});return c.call(this,i)||this}return e}(gi);var $l=function(c){(0,Q.__extends)(e,c);function e(){var t=c!==null&&c.apply(this,arguments)||this;return t.events=new V.default,t.changed=!1,t}return e.prototype.focus=function(){var t=this.getElement();t.focus&&t.focus()},e.prototype.isForcingScroll=function(){return!1},e.prototype.dispatchInputEventOn=function(t){var n;window.InputEvent&&(n=new InputEvent("input",{bubbles:!0,cancelable:!1})),t&&n&&t.dispatchEvent(n)},e}(Cn),et=$l;var to=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.root=t,n._cachedSelectionStart=-1,n}return Object.defineProperty(e.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),e.isSupportedType=function(t){return t=="email"||t=="search"||t=="text"||t=="url"},e.prototype.getElement=function(){return this.root},e.prototype.clearSelection=function(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)},e.prototype.isSelectionEmpty=function(){return this.root.selectionStart==this.root.selectionEnd},e.prototype.hasSelection=function(){return!0},e.prototype.invalidateSelection=function(){this._cachedSelectionStart=-1},e.prototype.getCaret=function(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart},e.prototype.getDeadkeyCaret=function(){return this.getCaret()},e.prototype.setCaret=function(t){this.setSelection(t,t,"none")},e.prototype.setSelection=function(t,n,i){var r=this.root.value._kmwCodePointToCodeUnit(t),s=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(r,s,i),this.processedSelectionStart=t,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(r,s,i)},e.prototype.forceScroll=function(){var t=this.getElement(),n=t.selectionStart,i=t.selectionEnd;this._activeForcedScroll=!0;try{t.blur(),t.focus()}finally{t.selectionStart=n,t.selectionEnd=i,this._activeForcedScroll=!1}},e.prototype.isForcingScroll=function(){return this._activeForcedScroll},e.prototype.getSelectionDirection=function(){return this.root.selectionDirection},e.prototype.getTextBeforeCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)},e.prototype.getSelectedText=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)},e.prototype.setTextBeforeCaret=function(t){this.getCaret();var n=this.processedSelectionEnd-this.processedSelectionStart,i=this.getSelectionDirection(),r=t._kmwLength();this.root.value=t+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(r,r+n,i)},e.prototype.setTextAfterCaret=function(t){var n=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+t,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,n)},e.prototype.getTextAfterCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)},e.prototype.getText=function(){return this.root.value},e.prototype.deleteCharsBeforeCaret=function(t){if(t>0){var n=this.getTextBeforeCaret(),i=this.processedSelectionStart;t>i&&(t=i),this.adjustDeadkeys(-t),this.setTextBeforeCaret(n.kmwSubstring(0,i-t)),this.setCaret(i-t)}},e.prototype.insertTextBeforeCaret=function(t){if(!!t){var n=this.getCaret(),i=this.getTextBeforeCaret(),r=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(t._kmwLength()),this.root.value=i+t+r,this.setCaret(n+t._kmwLength())}},e.prototype.handleNewlineAtCaret=function(){var t=this.root;t&&(t.type=="search"||t.type=="submit")?(t.disabled=!1,t.form.submit()):this.events.emit("unhandlednewline",t)},e.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},e}(et),ee=to;var eo=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.root=t,n._cachedSelectionStart=-1,n}return Object.defineProperty(e.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.getElement=function(){return this.root},e.prototype.clearSelection=function(){this.getCaret(),this.root.value=this.root.value._kmwSubstring(0,this.processedSelectionStart)+this.root.value._kmwSubstring(this.processedSelectionEnd),this.setCaret(this.processedSelectionStart)},e.prototype.isSelectionEmpty=function(){return this.root.selectionStart==this.root.selectionEnd},e.prototype.hasSelection=function(){return!0},e.prototype.invalidateSelection=function(){this._cachedSelectionStart=-1},e.prototype.getCaret=function(){return this.root.selectionStart!=this._cachedSelectionStart&&(this._cachedSelectionStart=this.root.selectionStart,this.processedSelectionStart=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionStart),this.processedSelectionEnd=this.root.value._kmwCodeUnitToCodePoint(this.root.selectionEnd)),this.root.selectionDirection=="forward"?this.processedSelectionEnd:this.processedSelectionStart},e.prototype.getDeadkeyCaret=function(){return this.getCaret()},e.prototype.setCaret=function(t){this.setSelection(t,t,"none")},e.prototype.setSelection=function(t,n,i){var r=this.root.value._kmwCodePointToCodeUnit(t),s=this.root.value._kmwCodePointToCodeUnit(n);this.root.setSelectionRange(r,s,i),this.processedSelectionStart=t,this.processedSelectionEnd=n,this.forceScroll(),this.root.setSelectionRange(r,s,i)},e.prototype.forceScroll=function(){var t=this.getElement(),n=t.selectionStart,i=t.selectionEnd;this._activeForcedScroll=!0;try{t.blur(),t.focus()}finally{t.selectionStart=n,t.selectionEnd=i,this._activeForcedScroll=!1}},e.prototype.isForcingScroll=function(){return this._activeForcedScroll},e.prototype.getSelectionDirection=function(){return this.root.selectionDirection},e.prototype.getTextBeforeCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(0,this.processedSelectionStart)},e.prototype.setTextBeforeCaret=function(t){this.getCaret();var n=this.processedSelectionEnd-this.processedSelectionStart,i=this.getSelectionDirection(),r=t._kmwLength();this.root.value=t+this.getText()._kmwSubstring(this.processedSelectionStart),this.setSelection(r,r+n,i)},e.prototype.setTextAfterCaret=function(t){var n=this.getSelectionDirection();this.root.value=this.getTextBeforeCaret()+t,this.setSelection(this.processedSelectionStart,this.processedSelectionEnd,n)},e.prototype.getTextAfterCaret=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionEnd)},e.prototype.getSelectedText=function(){return this.getCaret(),this.getText()._kmwSubstring(this.processedSelectionStart,this.processedSelectionEnd)},e.prototype.getText=function(){return this.root.value},e.prototype.deleteCharsBeforeCaret=function(t){if(t>0){var n=this.getTextBeforeCaret(),i=this.processedSelectionStart;t>i&&(t=i),this.adjustDeadkeys(-t),this.setTextBeforeCaret(n.kmwSubstring(0,i-t)),this.setCaret(i-t)}},e.prototype.insertTextBeforeCaret=function(t){if(!!t){var n=this.getCaret(),i=this.getTextBeforeCaret(),r=this.getText()._kmwSubstring(this.processedSelectionStart);this.adjustDeadkeys(t._kmwLength()),this.root.value=i+t+r,this.setCaret(n+t._kmwLength())}},e.prototype.handleNewlineAtCaret=function(){this.insertTextBeforeCaret("\n")},e.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},e}(et),Fi=eo;var yi=function(){function c(e,t){this.node=e,this.offset=t}return c}(),Ii=function(){function c(e,t){this.start=e,this.end=t}return c}(),ht=function(){function c(e,t){this.cmd=e,this.stateType=t}return c}(),no=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this)||this;if(n.root=t,t.contentWindow&&t.contentWindow.document&&t.contentWindow.document.designMode=="on")n.doc=t.contentWindow.document,n.docRoot=t.contentWindow.document.documentElement;else throw"Specified IFrame is not in design-mode!";return n}return Object.defineProperty(e.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.getElement=function(){return this.root},e.prototype.focus=function(){this.doc.defaultView.focus()},e.prototype.isSelectionEmpty=function(){return this.hasSelection()?this.doc.getSelection().isCollapsed:!0},e.prototype.hasSelection=function(){var t=this.doc.getSelection(),n=document.getSelection();return n.anchorNode==t.anchorNode&&n.focusNode==t.focusNode,!0},e.prototype.clearSelection=function(){if(this.hasSelection()){var t=this.doc.getSelection();t.isCollapsed||t.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")},e.prototype.invalidateSelection=function(){},e.prototype.getCarets=function(){var t=this.doc.getSelection(),n=t.anchorNode.compareDocumentPosition(t.focusNode);if(t.isCollapsed){var i=new yi(t.anchorNode,t.anchorOffset);return new Ii(i,i)}else{var r=new yi(t.anchorNode,t.anchorOffset),s=new yi(t.focusNode,t.focusOffset);return r.node==s.node&&(n=s.offset-r.offset>0?2:4),n&2?new Ii(r,s):new Ii(s,r)}},e.prototype.getDeadkeyCaret=function(){return this.getTextBeforeCaret().kmwLength()},e.prototype.getTextBeforeCaret=function(){if(!this.hasSelection())return this.getText();var t=this.getCarets().start;return t.node.nodeType!=3?"":t.node.textContent.substr(0,t.offset)},e.prototype.getSelectedText=function(){return""},e.prototype.getTextAfterCaret=function(){if(!this.hasSelection())return"";var t=this.getCarets().end;return t.node.nodeType!=3?"":t.node.textContent.substr(t.offset)},e.prototype.getText=function(){return this.docRoot.innerText},e.prototype.deleteCharsBeforeCaret=function(t){if(!(!this.hasSelection()||t<=0)){var n=this.getCarets().start;if(t>n.offset&&(t=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}var i=this.doc.createRange(),r=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-t).length;i.setStart(n.node,r),i.setEnd(n.node,n.offset),this.adjustDeadkeys(-t),i.deleteContents()}},e.prototype.insertTextBeforeCaret=function(t){if(!!this.hasSelection()){var n=this.getCarets().start,i=t._kmwLength(),r=this.doc.getSelection();if(i!=0){this.adjustDeadkeys(i);var s=this.root.ownerDocument.createRange();if(n.node.nodeType==3){var l=n.node;l.insertData(n.offset,t),s.setStart(l,n.offset+t.length)}else{var o=this.doc.createTextNode(t),a=this.doc.createRange();a.setStart(n.node,n.offset),a.collapse(!0),a.insertNode(o),s.setStart(o,t.length)}s.collapse(!0),r.removeAllRanges();try{r.addRange(s)}catch(g){n.node.parentElement.scrollIntoView(),r.addRange(s)}r.collapseToEnd()}}},e.prototype.handleNewlineAtCaret=function(){},e.prototype.setTextAfterCaret=function(t){if(!!this.hasSelection()){var n=this.getCarets().end,i=t._kmwLength();if(i!=0)if(n.node.nodeType==3){var r=n.node;r.replaceData(n.offset,r.length,t)}else{var s=n.node.ownerDocument.createTextNode(t),l=this.root.ownerDocument.createRange();l.setStart(n.node,n.offset),l.collapse(!0),l.insertNode(s)}}},e.prototype.saveProperties=function(){var t=[new ht("backcolor",1),new ht("fontname",1),new ht("fontsize",1),new ht("forecolor",1),new ht("bold",0),new ht("italic",0),new ht("strikethrough",0),new ht("subscript",0),new ht("superscript",0),new ht("underline",0)];this.doc.defaultView&&t.push(new ht("hilitecolor",1));for(var n=0;n<t.length;n++){var i=t[n];i.stateType==1?i.cache=this.doc.queryCommandValue(i.cmd):i.cache=this.doc.queryCommandState(i.cmd)}this.commandCache=t},e.prototype.restoreProperties=function(t){this.commandCache||console.error("No command cache exists to restore!");for(var n=0;n<this.commandCache.length;n++){var i=this.commandCache[n];i.stateType==1?this.doc.queryCommandValue(i.cmd)!=i.cache&&(t&&t(),this.doc.execCommand(i.cmd,!1,i.cache)):this.doc.queryCommandState(i.cmd)!=i.cache&&(t&&t(),this.doc.execCommand(i.cmd,!1,null))}},e.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},e}(et),nt=no;var Ui=function(){function c(e,t){this.node=e,this.offset=t}return c}(),bi=function(){function c(e,t){this.start=e,this.end=t}return c}(),io=function(c){(0,Q.__extends)(e,c);function e(t){var n=this;if(t.isContentEditable)n=c.call(this)||this,n.root=t;else throw"Specified element is not already content-editable!";return n}return Object.defineProperty(e.prototype,"isSynthetic",{get:function(){return!1},enumerable:!1,configurable:!0}),e.prototype.getElement=function(){return this.root},e.prototype.isSelectionEmpty=function(){return this.hasSelection()?this.root.ownerDocument.getSelection().isCollapsed:!0},e.prototype.hasSelection=function(){var t=this.root.ownerDocument.getSelection();return!(this.root!=t.anchorNode&&!this.root.contains(t.anchorNode)||this.root!=t.focusNode&&!this.root.contains(t.focusNode))},e.prototype.clearSelection=function(){if(this.hasSelection()){var t=this.root.ownerDocument.getSelection();t.isCollapsed||t.deleteFromDocument()}else console.warn("Attempted to clear an unowned Selection!")},e.prototype.invalidateSelection=function(){},e.prototype.getCarets=function(){var t=this.root.ownerDocument.getSelection(),n=t.anchorNode.compareDocumentPosition(t.focusNode);if(t.isCollapsed){var i=new Ui(t.anchorNode,t.anchorOffset);return new bi(i,i)}else{var r=new Ui(t.anchorNode,t.anchorOffset),s=new Ui(t.focusNode,t.focusOffset);return r.node==s.node&&(n=s.offset-r.offset>0?2:4),n&2?new bi(r,s):new bi(s,r)}},e.prototype.getDeadkeyCaret=function(){return this.getTextBeforeCaret().kmwLength()},e.prototype.getTextBeforeCaret=function(){if(!this.hasSelection())return this.getText();var t=this.getCarets().start;return t.node.nodeType!=3?"":t.node.textContent.substr(0,t.offset)},e.prototype.getSelectedText=function(){return""},e.prototype.getTextAfterCaret=function(){if(!this.hasSelection())return"";var t=this.getCarets().end;return t.node.nodeType!=3?"":t.node.textContent.substr(t.offset)},e.prototype.getText=function(){return this.root.innerText},e.prototype.deleteCharsBeforeCaret=function(t){if(!(!this.hasSelection()||t<=0)){var n=this.getCarets().start;if(t>n.offset&&(t=n.offset),n.node.nodeType!=3){console.warn("Deletion of characters requested without available context!");return}var i=this.root.ownerDocument.createRange(),r=n.offset-n.node.nodeValue.substr(0,n.offset)._kmwSubstr(-t).length;i.setStart(n.node,r),i.setEnd(n.node,n.offset),this.adjustDeadkeys(-t),i.deleteContents()}},e.prototype.insertTextBeforeCaret=function(t){if(!!this.hasSelection()){var n=this.getCarets().start,i=t._kmwLength(),r=this.root.ownerDocument.getSelection();if(i!=0){this.adjustDeadkeys(i);var s=this.root.ownerDocument.createRange();if(n.node.nodeType==3){var l=n.node;l.insertData(n.offset,t),s.setStart(l,n.offset+t.length)}else{var o=n.node.ownerDocument.createTextNode(t),a=this.root.ownerDocument.createRange();a.setStart(n.node,n.offset),a.collapse(!0),a.insertNode(o),s.setStart(o,t.length)}s.collapse(!0),r.removeAllRanges();try{r.addRange(s)}catch(g){n.node.parentElement.scrollIntoView(),r.addRange(s)}r.collapseToEnd()}}},e.prototype.handleNewlineAtCaret=function(){},e.prototype.setTextAfterCaret=function(t){if(!!this.hasSelection()){var n=this.getCarets().end,i=t._kmwLength();if(i!=0)if(n.node.nodeType==3){var r=n.node;r.replaceData(n.offset,r.length,t)}else{var s=n.node.ownerDocument.createTextNode(t),l=this.root.ownerDocument.createRange();l.setStart(n.node,n.offset),l.collapse(!0),l.insertNode(s)}}},e.prototype.doInputEvent=function(){this.dispatchInputEventOn(this.root)},e}(et),tn=io;function O(c,e){var t;return c?c.Window?e=="Window":(c.defaultView?t=c.defaultView[e]:c.ownerDocument&&(t=c.ownerDocument.defaultView[e]),t?c instanceof t:!1):!1}function en(c){if(O(c,"HTMLInputElement"))return new ee(c);if(O(c,"HTMLTextAreaElement"))return new Fi(c);if(O(c,"HTMLIFrameElement")){var e=c;return e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.designMode=="on"?new nt(e):c.isContentEditable?new tn(c):null}else if(c.isContentEditable)return new tn(c);return null}var ne=function(){function c(){var e=this;this.pending=!1;var t=this.bg=document.createElement("div"),n=document.createElement("div"),i=this.lt=document.createElement("div"),r=this.gr=document.createElement("div"),s=this.bx=document.createElement("div");t.className="kmw-wait-background",n.className="kmw-wait-box",this.dismiss=null,i.className="kmw-wait-text",r.className="kmw-wait-graphic",s.className="kmw-alert-close";var l=n.onmousedown=n.onclick=function(a){s.style.display=="block"&&(t.style.display="none",e.dismiss&&e.dismiss())};n.addEventListener("touchstart",l,!1);var o=t.onmousedown=t.onclick=function(a){a.preventDefault(),a.stopPropagation()};t.addEventListener("touchstart",o,!1),n.appendChild(s),n.appendChild(i),n.appendChild(r),t.appendChild(n),document.body.appendChild(t)}return Object.defineProperty(c.prototype,"rootElement",{get:function(){return this.bg},enumerable:!1,configurable:!0}),c.prototype.wait=function(e){var t=this,n=this.bg;typeof n=="undefined"||n==null||(e?(this.pending=!0,window.setTimeout(function(){t.pending&&(window.scrollTo(0,0),t.bx.style.display="none",t.lt.className="kmw-wait-text",t.lt.innerHTML=e,t.gr.style.display="block",n.style.display="block")},1e3)):this.pending&&(this.lt.innerHTML="",this.pending=!1,n.style.display="none"))},c.prototype.alert=function(e,t){var n=this.bg;this.bx.style.display="block",this.lt.className="kmw-alert-text",this.lt.innerHTML=e,this.gr.style.display="none",n.style.display="block",this.dismiss=arguments.length>1?t:null},c.prototype.shutdown=function(){this.bg.parentNode.removeChild(this.bg)},c}();function pe(){return document.readyState==="complete"?Promise.resolve():new Promise(function(c,e){var t=function(){window.removeEventListener("load",t),c()};window.addEventListener("load",t)})}var Br=function(c){(0,Q.__extends)(e,c);function e(){return c!==null&&c.apply(this,arguments)||this}return e.prototype.initialize=function(t){var n=this;this._options?this._options=(0,Q.__assign)((0,Q.__assign)({},this._options),t):this._options=(0,Q.__assign)({},t),c.prototype.initialize.call(this,t),this._options=t,this._ui=t.ui,this._attachType=t.attachType,pe().then(function(){var i;t.useAlerts&&!n.alertHost?n._alertHost=new ne:!t.useAlerts&&n.alertHost&&((i=n._alertHost)===null||i===void 0||i.shutdown(),n._alertHost=null)})},Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attachType",{get:function(){return this._attachType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alertHost",{get:function(){return this._alertHost},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"signalUser",{set:function(t){(!t||t!=this.alertHost)&&this.alertHost.shutdown(),this._alertHost=t},enumerable:!1,configurable:!0}),e.prototype.debugReport=function(){var t=c.prototype.debugReport.call(this);return t.attachType=this.attachType,t.ui=this._ui,t.keymanEngine="app/browser",t},e.prototype.onRuleFinalization=function(t,n){var i=t.transcription.transform;wt(i)||n instanceof et&&(n.changed=!0)},e}(pn);var ur=(0,Q.__assign)({ui:"",attachType:"",useAlerts:!0},mn);var hi=function(){function c(e,t,n){this.interface=e,this.keyboard=t}return c}();function ft(c){var e=c==null?void 0:c.target;return Ct(e)}function Ct(c){var e;if(c==null)return null;if(c.body&&(c=c.body),c.nodeType==3&&(c=c.parentNode),O(c,"HTMLInputElement")){var t=c.type.toLowerCase();if(!(t=="text"||t=="search"))return null}return(e=c._kmwAttachment)===null||e===void 0?void 0:e.interface}var Ci=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=this;if(!t)throw new Error("Cannot attach to a null/undefined document");return i=c.call(this)||this,i.baseFont="",i.appliedFont="",i.embeddedPageContexts=[],i._inputList=[],i._sortedInputs=[],i._InputModeObserverCore=function(r){i.disableInputModeObserver();try{for(var s=0,l=r;s<l.length;s++){var o=l[s],a=o.target;!i.isAttached(a)||(a._kmwAttachment.inputMode=a.inputMode,i.device.touchable&&(a.inputMode="none"))}}finally{i.enableInputModeObserver()}},i._EnablementMutationObserverCore=function(r){for(var s=0;s<r.length;s++){var l=r[s],o=l.oldValue?l.oldValue.indexOf("kmw-disabled")>=0:!1,a=l.target.className.indexOf("kmw-disabled")>=0;if(o&&!a?i._EnableControl(l.target):!o&&a&&i._DisableControl(l.target),!a&&l.attributeName=="readonly"){var g=l.oldValue?l.oldValue!=null:!1,d=l.target;if(d instanceof d.ownerDocument.defaultView.HTMLInputElement||d instanceof d.ownerDocument.defaultView.HTMLTextAreaElement){var B=d.readOnly;g&&!B?i._EnableControl(l.target):!g&&B&&i._DisableControl(l.target)}}}},i._AutoAttachObserverCore=function(r){for(var s=[],l=[],o=0;o<r.length;o++){for(var a=r[o],g=0;g<a.addedNodes.length;g++)s=s.concat(i._GetDocumentEditables(a.addedNodes[g]));for(g=0;g<a.removedNodes.length;g++)l=l.concat(i._GetDocumentEditables(a.removedNodes[g]))}for(var d=0;d<s.length;d++)i.isKMWInput(s[d])&&i._MutationAdditionObserved(s[d]);for(d=0;d<l.length;d++){var B=!1,u=l[d];if(u instanceof u.ownerDocument.defaultView.HTMLIFrameElement){for(var y=0;y<i.embeddedPageContexts.length;y++)if(i.embeddedPageContexts[y].options.owner==u){i.embeddedPageContexts[y].shutdown(),i.embeddedPageContexts.splice(y,1),B=!0;break}if(!B){for(var I=0;I<i._inputList.length;I++)if(i._inputList[I]==u){i.detachFromControl(u),i._inputList[I]==u&&i._inputList.splice(I,1);break}}}else i.isKMWInput(u)&&i._MutationRemovalObserved(u)}(s.length||l.length)&&(i.device.touchable?i.device.touchable&&window.setTimeout(function(){i.listInputs()},1):i.listInputs())},i._MutationAdditionObserved=function(r){if(r instanceof r.ownerDocument.defaultView.HTMLIFrameElement){var s=function(){window.setTimeout(function(){i.attachToControl(r)},1)};r.addEventListener("load",s)}else i.attachToControl(r)},i._MutationRemovalObserved=function(r){i.detachFromControl(r)},i.options=n,i.document=t,i.stylesheetManager=new Ft(i.document.body),i}return Object.defineProperty(e.prototype,"device",{get:function(){return this.options.hostDevice},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"window",{get:function(){return this.document.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inputList",{get:function(){var t=this.embeddedPageContexts.map(function(n){return n.inputList}).reduce(function(n,i){return n.concat(i)},[]);return[].concat(this._inputList).concat(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sortedInputs",{get:function(){return this._sortedInputs},enumerable:!1,configurable:!0}),e.prototype.install=function(t){this.manualAttach=t,this.baseFont=this.getBaseFont(),this.manualAttach||(this._SetupDocument(this.document.documentElement),this.listInputs()),this.options.owner||this.initMutationObservers(this.document,t)},e.prototype.setupElementAttachment=function(t){if(!t._kmwAttachment){var n=en(t);n||O(t,"HTMLIFrameElement")||console.warn("Could not create processing interface for newly-attached element!"),t._kmwAttachment=new hi(n,null,this.device.touchable)}},e.prototype.clearElementAttachment=function(t){t._kmwAttachment=null},e.prototype.isKMWInput=function(t){if(t instanceof t.ownerDocument.defaultView.HTMLTextAreaElement)return!0;if(t instanceof t.ownerDocument.defaultView.HTMLInputElement){if(ee.isSupportedType(t.type))return!0}else if(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)try{if(t.contentWindow){var n=t.contentWindow.document;if(n)return!(this.device.touchable&&n.designMode.toLowerCase()=="on")}else return!!t._kmwAttachment}catch(i){console.warn("Error during attachment to / detachment from iframe: "),console.warn(i)}else if(t.isContentEditable)return!0;return!1},e.prototype.isAttached=function(t){if(t._kmwAttachment)return!0;if(O(t,"HTMLIFrameElement")){var n=t;if(n.contentDocument==this.document)return!0;for(var i=0,r=this.embeddedPageContexts;i<r.length;i++){var s=r[i];if(s.isAttached(t))return!0}}return!1},e.prototype.isKMWDisabled=function(t){var n=t.className;return t.readOnly?!0:!!(n&&n.indexOf("kmw-disabled")>=0)},e.prototype.enableInputElement=function(t){var n;this.isKMWDisabled(t)||(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement?this._AttachToIframe(t):(this.setupElementAttachment(t),t._kmwAttachment.inputMode=(n=t.inputMode)!==null&&n!==void 0?n:"text",this.disableInputModeObserver(),t.inputMode="none",this.enableInputModeObserver(),t.classList.add("keymanweb-font"),this._inputList.push(t),this.emit("enabled",t)))},e.prototype.disableInputElement=function(t){var n;if(!!t)if(t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLIFrameElement||t instanceof HTMLIFrameElement)this._DetachFromIframe(t);else{if(this.isAttached(t)){var i=(n=t._kmwAttachment)===null||n===void 0?void 0:n.inputMode;this.disableInputModeObserver(),t.inputMode=i,this.enableInputModeObserver()}var r=t.className.indexOf("keymanweb-font");r>=0&&(t.className=t.className.replace("keymanweb-font","").trim());var s=this.inputList.indexOf(t);s>-1&&this._inputList.splice(s,1),this.emit("disabled",t)}},e.prototype.enableTouchElement=function(t){return this.isKMWDisabled(t)?(this.emit("disabled",t),!1):(this.isAttached(t)||this.setupElementAttachment(t),this.enableInputElement(t),!0)},e.prototype.disableTouchElement=function(t){if(this.isAttached(t)){var n=t._kmwAttachment.inputMode;this.disableInputModeObserver(),t.inputMode=n,this.enableInputModeObserver()}},e.prototype._AttachToIframe=function(t){var n=this;try{var i=t.contentWindow.document;if(i){if(i.designMode.toLowerCase()=="on")this.setupElementAttachment(t),i.body._kmwAttachment=t._kmwAttachment,this._inputList.push(t),this.emit("enabled",t);else if(this.embeddedPageContexts.filter(function(s){return s.document==i}).length==0){var r=new e(i,(0,Q.__assign)((0,Q.__assign)({},this.options),{owner:t}));this.embeddedPageContexts.push(r),r.on("enabled",function(s){return n.emit("enabled",s)}),r.on("disabled",function(s){return n.emit("disabled",s)}),r.install(this.manualAttach)}}}catch(s){}},e.prototype._DetachFromIframe=function(t){var n=this,i=function(){n.clearElementAttachment(t);var o=n._inputList.indexOf(t);o!=-1&&n._inputList.splice(o,1),n.emit("disabled",t)};try{var r=t.contentWindow.document;if(r){if(r.designMode.toLowerCase()=="on")r.body._kmwAttachment=null,i();else for(var s=0;s<this.embeddedPageContexts.length;s++)if(this.embeddedPageContexts[s].document==r){var l=this.embeddedPageContexts.splice(s,1)[0];l._ClearDocument(r.body),l.shutdown(),this.embeddedPageContexts.splice(s,1);break}}}catch(o){t._kmwAttachment&&i()}},e.prototype.attachToControl=function(t){var n=this.device.touchable;this.isAttached(t)&&!(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(t)?this.isKMWDisabled(t)?this.emit("disabled",t):n?this.enableTouchElement(t):this.enableInputElement(t):n&&this.emit("disabled",t))},e.prototype.detachFromControl=function(t){!(this.isAttached(t)||t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)||(this.isKMWInput(t)&&(this.isKMWDisabled(t)||this._DisableControl(t)),this.clearElementAttachment(t))},e.prototype._DisableControl=function(t){(this.isAttached(t)||t instanceof t.ownerDocument.defaultView.HTMLIFrameElement)&&(this.device.touchable&&this.disableTouchElement(t),this.listInputs(),this.disableInputElement(t))},e.prototype._EnableControl=function(t){this.isAttached(t)?(this.device.touchable?this.enableTouchElement(t):this.enableInputElement(t),this.listInputs()):O(t,"HTMLIFrameElement")&&this._AttachToIframe(t)},e.prototype.disableControl=function(t){this.isAttached(t)||console.warn("KeymanWeb is not attached to element "+t);var n=t.className;n.indexOf("kmw-disabled")<0&&(t.className=n?n+" kmw-disabled":"kmw-disabled")},e.prototype.enableControl=function(t){!this.isAttached(t)&&!O(t,"HTMLIFrameElement")&&console.warn("KeymanWeb is not attached to element "+t);var n=t.className,i=n.indexOf("kmw-disabled");i>=0&&(t.className=n.replace("kmw-disabled","").trim())},e.prototype.listInputs=function(){for(var t=[],n=document.getElementsByTagName("input"),i=document.getElementsByTagName("textarea"),r=0;r<n.length;r++)ee.isSupportedType(n[r].type)&&n[r].className.indexOf("kmw-disabled")<0&&t.push({ip:n[r],x:z(n[r]),y:K(n[r])});for(var r=0;r<i.length;r++)i[r].className.indexOf("kmw-disabled")<0&&t.push({ip:i[r],x:z(i[r]),y:K(i[r])});t.sort(function(l,o){return l.y!=o.y?l.y-o.y:l.x-o.x});for(var s=[],r=0;r<t.length;r++)s.push(t[r].ip);this._sortedInputs=s},e.prototype.findNeighboringInput=function(t,n){var i,r=this.sortedInputs;if(r.length==0)return null;for(i=0;i<r.length&&r[i]!=t;i++);return i==r.length&&!n&&i--,i=n?i-1:i+1,i=i>=r.length?i-r.length:i,i=i<0?i+r.length:i,r[i]},e.prototype._GetDocumentEditables=function(t){var n=[];if(t.ownerDocument&&t instanceof t.ownerDocument.defaultView.HTMLElement){var i=t.ownerDocument.defaultView;(t instanceof i.HTMLInputElement||t instanceof i.HTMLTextAreaElement||t instanceof i.HTMLIFrameElement)&&n.push(t)}if(t.getElementsByTagName){var r=function(s){return He(t.getElementsByTagName(s))};n=n.concat(r("INPUT"),r("TEXTAREA"),r("IFRAME"))}return t.querySelectorAll&&(n=n.concat(He(t.querySelectorAll("[contenteditable]")))),t.ownerDocument&&t instanceof t.ownerDocument.defaultView.HTMLElement&&t.isContentEditable&&n.push(t),n},e.prototype._SetupDocument=function(t){for(var n=this._GetDocumentEditables(t),i=0;i<n.length;i++)this.attachToControl(n[i])},e.prototype._ClearDocument=function(t){for(var n=this._GetDocumentEditables(t),i=0;i<n.length;i++)this.detachFromControl(n[i])},e.prototype.initMutationObservers=function(t,n){if(typeof MutationObserver=="function"){var i=t.querySelector("body"),r;n||(r={childList:!0,subtree:!0},this.attachmentObserver=new MutationObserver(this._AutoAttachObserverCore),this.attachmentObserver.observe(i,r)),r={subtree:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["class","readonly"]},this.enablementObserver=new MutationObserver(this._EnablementMutationObserverCore),this.enablementObserver.observe(i,r),this.inputModeObserver=new MutationObserver(this._InputModeObserverCore),this.enableInputModeObserver()}else console.warn("Your browser is outdated and does not support MutationObservers, a web feature needed by KeymanWeb to support dynamically-added elements.")},e.prototype.enableInputModeObserver=function(){var t,n=document.querySelector("body"),i={subtree:!0,attributes:!0,attributeFilter:["inputmode"]};(t=this.inputModeObserver)===null||t===void 0||t.observe(n,i)},e.prototype.disableInputModeObserver=function(){var t;(t=this.inputModeObserver)===null||t===void 0||t.disconnect()},e.prototype.getBaseFont=function(){var t=document.getElementsByTagName("input"),n=document.getElementsByTagName("textarea"),i=0,r,s="Arial,sans-serif";if(t.length==0&&n.length==0)i=0;else if(t.length>0&&n.length==0)i=1;else if(t.length==0&&n.length>0)i=2;else{var l=t[0],o=n[0];l.offsetTop<o.offsetTop?i=1:l.offsetTop>o.offsetTop?i=2:l.offsetLeft<o.offsetLeft?i=1:l.offsetLeft>o.offsetLeft&&(i=2)}switch(i){case 0:r=s;break;case 1:r=getComputedStyle(t[0]).fontFamily||"";break;case 2:r=getComputedStyle(n[0]).fontFamily||"";break}return(typeof r=="undefined"||r=="monospace")&&(r=s),r},e.prototype.buildAttachmentFontStyle=function(t){var n=t,i=this.baseFont;n&&typeof n.family!="undefined"&&(i=n.family),i=i.replace(/\u0022/g,"");var r=new RegExp("\\s?"+i+",?"),s=this.appliedFont.replace(/\u0022/g,"");s=s.replace(r,""),s=s.replace(/,$/,""),s==""?s=i:s=i+","+s,s='"'+s.replace(/\,\s?/g,'","')+'"';var l=".keymanweb-font{\nfont-family:"+s+" !important;\n}\n";return this.appliedFont=s,l},e.prototype.setAttachmentFont=function(t,n,i){this.stylesheetManager.unlinkAll(),this.stylesheetManager.addStyleSheetForFont(t,n,i),this.stylesheetManager.linkStylesheet(At(this.buildAttachmentFontStyle(t)))},e.prototype.shutdown=function(){var t,n,i,r;try{(t=this.enablementObserver)===null||t===void 0||t.disconnect(),(n=this.attachmentObserver)===null||n===void 0||n.disconnect(),(i=this.inputModeObserver)===null||i===void 0||i.disconnect(),(r=this.stylesheetManager)===null||r===void 0||r.unlinkAll(),this.inputModeObserver=null,this.embeddedPageContexts.forEach(function(a){try{a.shutdown()}catch(g){}});for(var s=0,l=this.inputList;s<l.length;s++){var o=l[s];try{this.detachFromControl(o)}catch(a){this.emit("disabled",o)}}this._inputList=[]}catch(a){console.error("Error occurred during shutdown"),console.error(a)}},e}(V.default);var co=function(){function c(e,t){this.activationPending=e,this.activated=t}return c}();var Fr=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this)||this;return n._maintainingFocus=!1,n.restoringFocus=!1,n._IgnoreNextSelChange=0,n.isTargetForcingScroll=t,n}return Object.defineProperty(e.prototype,"maintainingFocus",{get:function(){return this._maintainingFocus},set:function(t){var n=this._maintainingFocus;this._maintainingFocus=t,n&&!t&&this.emit("maintainingfocusend")},enumerable:!1,configurable:!0}),e.prototype.getUIState=function(){return new co(this.maintainingFocus,this.restoringFocus)},e.prototype.setMaintainingFocus=function(t){this.maintainingFocus=!!t},e.prototype.setFocusTimer=function(){var t=this;this.focusing=!0,this.focusTimer=window.setTimeout(function(){t.focusing=!1},50)},e}(V.default);function yr(c,e){var t=e!=null&&e.isRTL?"rtl":"ltr";c&&(c instanceof c.ownerDocument.defaultView.HTMLInputElement||c instanceof c.ownerDocument.defaultView.HTMLTextAreaElement?c.value.length==0&&(c.dir=t):typeof c.textContent=="string"&&c.textContent.length==0&&(c.dir=t))}var ro=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=c.call(this,t)||this;return i.cookieManager=new yt("KeymanWeb_Keyboard"),i.focusAssistant=new Fr(function(){var r;return(r=i.activeTarget)===null||r===void 0?void 0:r.isForcingScroll()}),i.domEventTracker=new Zt,i._ControlFocus=function(r){var s=ft(r);return s&&i.setActiveTarget(s,!0),!0},i._ControlBlur=function(r){if(i.focusAssistant._IgnoreNextSelChange)return i.focusAssistant._IgnoreNextSelChange--,r.cancelBubble=!0,r.stopPropagation(),!0;if(i.focusAssistant.isTargetForcingScroll())return r.cancelBubble=!0,r.stopPropagation(),!0;var s=ft(r);if(s==null)return!0;i.lastActiveTarget&&i._BlurKeyboardSettings(i.lastActiveTarget.getElement());var l=i.activeTarget;i.currentTarget=null,(l||i.lastActiveTarget)&&(i.mostRecentTarget=s),i.focusAssistant.restoringFocus=!1;var o=i.activeKeyboard,a=i.focusAssistant.maintainingFocus;return!a&&o&&o.keyboard.notify(0,s,0),l&&!i.activeTarget&&i.emit("targetchange",null),i.apiEvents.callEvent("controlblurred",{target:s.getElement(),event:r,isActivating:a}),i.doChangeEvent(s),i.resetContext(),!0},i._Click=function(r){return i.resetContext(),!0},i.nonKMWTouchHandler=function(r){i.focusAssistant.focusing=!1,clearTimeout(i.focusAssistant.focusTimer),i.forgetActiveTarget()},i._eventsObj=n,i.page=new Ci(window.document,{hostDevice:i.engineConfig.hostDevice}),i.focusAssistant.on("maintainingfocusend",function(){!i.activeTarget&&i.mostRecentTarget&&i.emit("targetchange",i.activeTarget)}),i}return Object.defineProperty(e.prototype,"apiEvents",{get:function(){return this._eventsObj()},enumerable:!1,configurable:!0}),e.prototype.initialize=function(){var t=this;this.on("keyboardasyncload",function(n,i){var r;(r=t.engineConfig.alertHost)===null||r===void 0||r.wait("Installing keyboard<br/>"+n.name),i.then(function(){var s;(s=t.engineConfig.alertHost)===null||s===void 0||s.wait()})}),this.engineConfig.deferForInitialization.then(function(){var n=t.engineConfig.hostDevice,i=function(r){return r.stopPropagation()};t.page.on("enabled",function(r){if(!(r._kmwAttachment.interface instanceof nt))n.touchable&&(t.domEventTracker.detachDOMEvent(r,"touchstart",t.nonKMWTouchHandler),t.domEventTracker.attachDOMEvent(r,"touchmove",i,!1),t.domEventTracker.attachDOMEvent(r,"touchend",i,!1)),t.domEventTracker.attachDOMEvent(r,"focus",t._ControlFocus),t.domEventTracker.attachDOMEvent(r,"blur",t._ControlBlur),t.domEventTracker.attachDOMEvent(r,"click",t._Click);else{var s=r.contentWindow.document;n.browser=="firefox"?(t.domEventTracker.attachDOMEvent(s,"focus",t._ControlFocus),t.domEventTracker.attachDOMEvent(s,"blur",t._ControlBlur)):(t.domEventTracker.attachDOMEvent(s.body,"focus",t._ControlFocus),t.domEventTracker.attachDOMEvent(s.body,"blur",t._ControlBlur))}r.ownerDocument.activeElement==r&&t.setActiveTarget(Ct(r),!0)}),t.page.on("disabled",function(r){var s;if(!O(r,"HTMLIFrameElement"))n.touchable&&t.domEventTracker.attachDOMEvent(r,"touchstart",t.nonKMWTouchHandler,!1),t.domEventTracker.detachDOMEvent(r,"focus",t._ControlFocus),t.domEventTracker.detachDOMEvent(r,"blur",t._ControlBlur),t.domEventTracker.detachDOMEvent(r,"click",t._Click);else{var l=r.contentWindow.document;n.browser=="firefox"?(t.domEventTracker.detachDOMEvent(l,"focus",t._ControlFocus),t.domEventTracker.detachDOMEvent(l,"blur",t._ControlBlur)):(t.domEventTracker.detachDOMEvent(l.body,"focus",t._ControlFocus),t.domEventTracker.detachDOMEvent(l.body,"blur",t._ControlBlur))}var o=(s=t.mostRecentTarget)===null||s===void 0?void 0:s.getElement();o&&o==r&&t.forgetActiveTarget()}),t.page.install(t.engineConfig.attachType=="manual")})},Object.defineProperty(e.prototype,"activeTarget",{get:function(){var t=this.focusAssistant.maintainingFocus;return this.currentTarget||(t?this.mostRecentTarget:null)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastActiveTarget",{get:function(){return this.mostRecentTarget},enumerable:!1,configurable:!0}),e.prototype.deactivateCurrentTarget=function(){var t=this.activeTarget||this.lastActiveTarget;t&&this.page.isAttached(t.getElement())&&this._BlurKeyboardSettings(t.getElement()),this.activeTarget||this.setActiveTarget(null,!0)},e.prototype.forgetActiveTarget=function(){this.focusAssistant.maintainingFocus=!1,this.focusAssistant.restoringFocus=!1;var t=this.activeTarget||this.mostRecentTarget;t&&this._BlurKeyboardSettings(t.getElement()),this.setActiveTarget(null,!0),t==this.lastActiveTarget&&(this.mostRecentTarget=null)},e.prototype.setActiveTarget=function(t,n){var i,r=this.mostRecentTarget,s=this.activeTarget;if(t==s){s&&(this.currentTarget=s);return}var l=!!r;if(this.currentTarget=this.mostRecentTarget=t,this.predictionContext.setCurrentTarget(t),this.focusAssistant.restoringFocus?this._BlurKeyboardSettings(t.getElement()):t&&this._FocusKeyboardSettings(t.getElement(),!l),!this._CommonFocusHelper(t)){var o=t==null?void 0:t.getElement();if(t instanceof nt&&(o=t.docRoot),o&&o.ownerDocument&&o instanceof o.ownerDocument.defaultView.HTMLElement&&yr(o,(i=this.activeKeyboard)===null||i===void 0?void 0:i.keyboard),t!=s&&this.emit("targetchange",t),n){var a=r==null?void 0:r.getElement();r instanceof nt&&(a=r.docRoot),o?this.apiEvents.callEvent("controlfocused",{target:o,activeControl:a}):a&&this.apiEvents.callEvent("controlblurred",{target:a,event:null,isActivating:this.focusAssistant.maintainingFocus})}}},Object.defineProperty(e.prototype,"activeKeyboard",{get:function(){return this._activeKeyboard},enumerable:!1,configurable:!0}),e.prototype.restoreLastActiveTarget=function(){!this.mostRecentTarget||(this.focusAssistant.restoringFocus=!0,this.mostRecentTarget.focus(),this.focusAssistant.restoringFocus=!1)},e.prototype.insertText=function(t,n,i){this.restoreLastActiveTarget();var r=this.activeTarget;return r==null&&this.mostRecentTarget&&(r=this.activeTarget),r!=null?c.prototype.insertText.call(this,t,n,i):!1},e.prototype.currentKeyboardSrcTarget=function(){var t=this.currentTarget||this.mostRecentTarget;return this.isTargetKeyboardIndependent(t)?t:null},e.prototype.isTargetKeyboardIndependent=function(t){var n=t==null?void 0:t.getElement()._kmwAttachment;return!!((n==null?void 0:n.keyboard)||(n==null?void 0:n.keyboard)==="")},e.prototype.activateKeyboardForTarget=function(t,n){var i,r,s=n==null?void 0:n.getElement()._kmwAttachment;if(s?(s.keyboard=(i=t==null?void 0:t.metadata.id)!==null&&i!==void 0?i:"",s.languageCode=(r=t==null?void 0:t.metadata.langId)!==null&&r!==void 0?r:""):this.globalKeyboard=t,this.currentKeyboardSrcTarget()==n){this._activeKeyboard=t;var l=t==null?void 0:t.metadata;this.page.setAttachmentFont(l==null?void 0:l.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS)}},e.prototype.setKeyboardForTarget=function(t,n,i){if(t instanceof nt){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}var r=t.getElement()._kmwAttachment,s=this.currentKeyboardSrcTarget()==t;if(r){if(r.keyboard=n||null,r.languageCode=i||null,s||this.currentKeyboardSrcTarget()==t){var l=this.globalKeyboard.metadata;this.activateKeyboard(r.keyboard||l.id,r.languageCode||l.langId,!0)}}else return},e.prototype.getKeyboardStubForTarget=function(t){if(this.isTargetKeyboardIndependent(t)){var n=t.getElement()._kmwAttachment;return this.keyboardCache.getStub(n.keyboard,n.languageCode)}else return this.globalKeyboard.metadata},e.prototype.getFallbackStubKey=function(){var t={id:"",langId:""};return this.engineConfig.hostDevice.touchable&&this.keyboardCache.defaultStub||t},e.prototype.activateKeyboard=function(t,n,i){return(0,Q.__awaiter)(this,void 0,void 0,function(){var r,s,l,o,a,g=this,d,B,u,y,I,F;return(0,Q.__generator)(this,function(U){switch(U.label){case 0:i||(i=!1),r=this.currentKeyboardSrcTarget(),t||(t=this.getFallbackStubKey().id,n=this.getFallbackStubKey().langId),U.label=1;case 1:return U.trys.push([1,3,,7]),[4,c.prototype.activateKeyboard.call(this,t,n,i)];case 2:return s=U.sent(),(d=this.engineConfig.alertHost)===null||d===void 0||d.wait(),i&&!r&&this.cookieManager.save({current:"".concat(t,":").concat(n)}),r==this.currentKeyboardSrcTarget()&&(yr((B=this.currentTarget)===null||B===void 0?void 0:B.getElement(),this.keyboardCache.getKeyboard(t)),this.page.setAttachmentFont((y=(u=this.activeKeyboard)===null||u===void 0?void 0:u.metadata)===null||y===void 0?void 0:y.KFont,this.engineConfig.paths.fonts,this.engineConfig.hostDevice.OS),this.restoreLastActiveTarget()),[2,s];case 3:return l=U.sent(),o=function(){return(0,Q.__awaiter)(g,void 0,void 0,function(){var b;return(0,Q.__generator)(this,function(C){switch(C.label){case 0:return b=this.getFallbackStubKey(),b.id==t?[3,2]:[4,this.activateKeyboard(b.id,b.langId,!0).catch(function(){})];case 1:C.sent(),C.label=2;case 2:return[2]}})})},(I=this.engineConfig.alertHost)===null||I===void 0||I.wait(),a=(l==null?void 0:l.message)||"Sorry, the "+t+" keyboard for "+n+" is not currently available.",l instanceof de?console.error(l||a):console.warn(l||a),this.engineConfig.alertHost?((F=this.engineConfig.alertHost)===null||F===void 0||F.alert(a,o),[3,6]):[3,4];case 4:return[4,o()];case 5:U.sent(),U.label=6;case 6:throw l;case 7:return[2]}})})},e.prototype._BlurKeyboardSettings=function(t,n,i){var r,s=this.activeKeyboard?this.activeKeyboard.keyboard.id:"",l=(r=this.activeKeyboard)===null||r===void 0?void 0:r.metadata.langId;n!==void 0&&i!==void 0&&(s=n,l=i),t&&t._kmwAttachment.keyboard!=null?(t._kmwAttachment.keyboard=s,t._kmwAttachment.languageCode=l):this.globalKeyboard=this.activeKeyboard},e.prototype._FocusKeyboardSettings=function(t,n){var i,r=t._kmwAttachment,s=this.globalKeyboard;r.keyboard!=null?this.activateKeyboard(r.keyboard,r.languageCode,!0):!n&&(s==null?void 0:s.metadata)!=((i=this._activeKeyboard)===null||i===void 0?void 0:i.metadata)&&this.activateKeyboard(s==null?void 0:s.metadata.id,s==null?void 0:s.metadata.langId,!0)},e.prototype._CommonFocusHelper=function(t){var n,i=this.focusAssistant,r=(n=this.activeKeyboard)===null||n===void 0?void 0:n.keyboard;return i.restoringFocus||(t==null||t.deadkeys().clear(),r==null||r.notify(0,t,1)),!i.restoringFocus&&this.mostRecentTarget!=t&&(i.maintainingFocus=!1),i.restoringFocus=!1,this.resetContext(),!1},e.prototype.doChangeEvent=function(t){if(t.changed){var n=new Event("change",{bubbles:!0,cancelable:!1});t.getElement().dispatchEvent(n)}t.changed=!1},e.prototype.getSavedKeyboardRaw=function(){var t=new yt("KeymanWeb_Keyboard"),n=t.load(decodeURIComponent);return typeof n.current!="string"||n.current=="Keyboard_us:eng"?"Keyboard_us:en":n.current},e.prototype.getSavedKeyboard=function(){for(var t=this.getSavedKeyboardRaw(),n=this.keyboardCache.getStubList(),i,r=0;r<n.length;r++)if(i=n[r].KI+":"+n[r].KLC,i==t)return i;for(var r=0;r<n.length;r++)if(i=n[r].KI+":"+n[r].KLC,i=="Keyboard_us:en")return i;return n.length>0?n[0].KI+":"+n[0].KLC:"Keyboard_us:en"},e.prototype.restoreSavedKeyboard=function(t){var n=t,i=n.split(":");i.length<2&&(i[1]="");var r=this.keyboardCache.getStub(i[0],i[1])||this.keyboardCache.defaultStub;return r?this.activateKeyboard(r.id,r.langId):null},e.prototype.shutdown=function(){this.page.shutdown(),this.domEventTracker.shutdown()},e}(Zn),Ir=ro;var so=function(c){(0,Q.__extends)(e,c);function e(t){var n=c.call(this)||this;return n.contextManager=t,n}return e.prototype.isCommand=function(t){var n=this.codeForEvent(t);switch(n){case h.keyCodes.K_TAB:case h.keyCodes.K_TABBACK:case h.keyCodes.K_TABFWD:return!0;default:return c.prototype.isCommand.call(this,t)}},e.prototype.applyCommand=function(t,n){var i=this,r=this.codeForEvent(t),s=function(l){var o,a=i.contextManager,g=(o=a.activeTarget)===null||o===void 0?void 0:o.getElement(),d=a.page.findNeighboringInput(g,l);d==null||d.focus()};switch(r){case h.keyCodes.K_TAB:s((t.Lmodifiers&h.modifierCodes.SHIFT)!=0);break;case h.keyCodes.K_TABBACK:s(!0);break;case h.keyCodes.K_TABFWD:s(!1);break}c.prototype.applyCommand.call(this,t,n)},e}(kt),Ur=so;function Xi(c){return c.keyCode?c.keyCode:c.which?c.which:null}function nn(c,e,t){if(c.cancelBubble===!0)return null;var n=Xi(c);if(n==null)return null;var i=e.modStateFlags,r=0,s=!1,l=!1,o=h.keyCodes;switch(n){case o.K_CTRL:case o.K_LCTRL:case o.K_RCTRL:case o.K_CONTROL:case o.K_LCONTROL:case o.K_RCONTROL:s=!0;break;case o.K_LMENU:case o.K_RMENU:case o.K_ALT:case o.K_LALT:case o.K_RALT:l=!0;break}r|=c.getModifierState("Shift")?16:0;var a=h.modifierCodes;c.getModifierState("Control")&&(r|=c.location!=0&&s?c.location==1?a.LCTRL:a.RCTRL:i&3),c.getModifierState("Alt")&&(r|=c.location!=0&&l?c.location==1?a.LALT:a.RALT:i&12);var g=0;g|=c.getModifierState("CapsLock")?a.CAPS:a.NO_CAPS,g|=c.getModifierState("NumLock")?a.NUM_LOCK:a.NO_NUM_LOCK,g|=c.getModifierState("ScrollLock")?a.SCROLL_LOCK:a.NO_SCROLL_LOCK,r|=g;var d=e.modStateFlags!=r;e.modStateFlags=r;var B=a.RALT|a.LCTRL;(i&B)==B&&(r&B)!=B&&(r&=~B),r&a.RALT&&(r&=~a.LCTRL);var u=h.modifierBitmasks,y=e.activeKeyboard,I;y&&y.isChiral?(I=r&u.CHIRAL,y.emulatesAltGr&&(I&u.ALT_GR_SIM)==u.ALT_GR_SIM&&(I^=u.ALT_GR_SIM,I|=a.RALT)):I=r&16|(r&(a.LCTRL|a.RCTRL)?32:0)|(r&(a.LALT|a.RALT)?64:0),I|=c.metaKey?a.META:0,t.browser==v.Browser.Firefox&&dt.browserMap.FF["k"+n]&&(n=dt.browserMap.FF["k"+n]);var F=new gt({device:t,kName:"",Lcode:n,Lmodifiers:I,Lstates:g,LmodifierChange:d,isSynthetic:!1}),U=typeof c.charCode!="undefined"&&c.charCode!=null&&(c.charCode==0||(I&111)!=0);F.LisVirtualKey=U||c.type!="keypress",F=Vn(F,y,e.baseLayout);var b=new gt(F);return b.source=c,b}var lo=function(c){(0,Q.__extends)(e,c);function e(t,n,i){var r=c.call(this)||this;r.domEventTracker=new Zt,r.swallowKeypress=!1,r._KeyDown=function(o){var a,g=r.contextManager.activeKeyboard,d=ft(o);if(!d||g==null)return!0;var B=d.getElement();return((a=B==null?void 0:B.getAttribute("class"))===null||a===void 0?void 0:a.indexOf("kmw-disabled"))>=0?!0:r.keyDown(o)},r._KeyPress=function(o){var a,g=ft(o);return!g||((a=r.contextManager.activeKeyboard)===null||a===void 0?void 0:a.keyboard)==null?!0:r.keyPress(o)},r._KeyUp=function(o){var a=ft(o),g=nn(o,r.processor,r.hardDevice);if(g==null||a==null)return!0;var d=a.getElement();if(g.Lcode==13){var B=!1;if(O(d,"HTMLTextAreaElement")&&(B=!0),!B){if(d instanceof d.ownerDocument.defaultView.HTMLInputElement)if(d.form&&(d.type=="search"||d.type=="submit"))d.form.submit();else{var u=r.contextManager.page.findNeighboringInput(d,!1);u.focus()}return!0}}return r.keyUp(o)},r.hardDevice=t,r.contextManager=i,r.processor=n;var s=i.page,l=r.domEventTracker;return s.on("enabled",function(o){var a=Ct(o);if(!(a instanceof nt))l.attachDOMEvent(o,"keypress",r._KeyPress),l.attachDOMEvent(o,"keydown",r._KeyDown),l.attachDOMEvent(o,"keyup",r._KeyUp);else{var g=a.getElement().contentDocument;l.attachDOMEvent(g.body,"keydown",r._KeyDown),l.attachDOMEvent(g.body,"keypress",r._KeyPress),l.attachDOMEvent(g.body,"keyup",r._KeyUp)}}),s.on("disabled",function(o){var a=Ct(o);if(!(a instanceof nt))l.detachDOMEvent(o,"keypress",r._KeyPress),l.detachDOMEvent(o,"keydown",r._KeyDown),l.detachDOMEvent(o,"keyup",r._KeyUp);else{var g=a.getElement().contentDocument;l.detachDOMEvent(g.body,"keydown",r._KeyDown),l.detachDOMEvent(g.body,"keypress",r._KeyPress),l.detachDOMEvent(g.body,"keyup",r._KeyUp)}}),r}return e.prototype.keyDown=function(t){var n=this;this.swallowKeypress=!1;var i=nn(t,this.processor,this.hardDevice);if(i==null)return!0;var r={LeventMatched:!1};return this.emit("keyevent",i,function(s,l){r.LeventMatched=s&&!s.triggerKeyDefault,r.LeventMatched?(t&&t.preventDefault&&(t.preventDefault(),t.stopPropagation()),n.swallowKeypress=!!i.Lcode,i.Lcode==8&&(n.swallowKeypress=!1)):n.swallowKeypress=!1}),!r.LeventMatched},e.prototype.keyUp=function(t){var n=nn(t,this.processor,this.hardDevice);if(n==null)return!0;var i=ft(t);return this.processor.doModifierPress(n,i,!1)},e.prototype.keyPress=function(t){var n,i=nn(t,this.processor,this.hardDevice);if(i==null||i.LisVirtualKey)return!0;if(!(!((n=this.contextManager.activeKeyboard)===null||n===void 0)&&n.keyboard.isMnemonic))return!this.swallowKeypress||i.Lcode<32||this.hardDevice.browser==v.Browser.Safari&&i.Lcode>63232&&i.Lcode<63744;var r={};return this.swallowKeypress||this.emit("keyevent",i,function(s,l){r.preventDefaultKeystroke=!!s}),this.swallowKeypress||r.preventDefaultKeystroke?(this.swallowKeypress=!1,t&&t.preventDefault&&(t.preventDefault(),t.stopPropagation()),!1):(this.swallowKeypress=!1,!0)},e.prototype.shutdown=function(){this.domEventTracker.shutdown()},e}(Jn),br=lo;var hr=function(){function c(){this.innerWidth=window.innerWidth,this.innerHeight=window.innerHeight}return c.prototype.equals=function(e){return this.innerWidth==e.innerWidth&&this.innerHeight==e.innerHeight},c}(),Cr=function(){function c(e){this.idlePermutationCounter=c.IDLE_PERMUTATION_CAP,this.keyman=e}return c.prototype.resolve=function(){var e=this,t,n=this.keyman.osk;(t=this.keyman.touchLanguageMenu)===null||t===void 0||t.hide(),this.keyman.touchLanguageMenu=null,n.setNeedsLayout(),this.oskVisible&&n.present(),this.isActive=!1,this.updateTimer&&(window.clearInterval(this.updateTimer),this.rotState=null);var i=this.keyman.contextManager.activeTarget;i&&window.setTimeout(function(){e.keyman.ensureElementVisibility(i.getElement())},0)},c.prototype.initNewRotation=function(){this.oskVisible=this.keyman.osk.isVisible(),this.keyman.osk.hideNow(),this.isActive=!0},c.prototype.init=function(){var e=this,t=this.keyman.config.hostDevice.OS,n=this.keyman.util;t=="ios"?(n.attachDOMEvent(window,"orientationchange",function(){return e.iOSEventHandler(),!1}),n.attachDOMEvent(window,"resize",function(){return e.iOSEventHandler(),!1})):t=="android"&&("onmozorientationchange"in screen?n.attachDOMEvent(screen,"mozorientationchange",function(){return e.initNewRotation(),!1}):n.attachDOMEvent(window,"orientationchange",function(){return e.initNewRotation(),!1}),n.attachDOMEvent(window,"resize",function(){return e.resolve(),!1}))},c.prototype.iOSEventHandler=function(){this.isActive||(this.initNewRotation(),this.rotState=new hr,this.updateTimer=window.setInterval(this.iOSEventUpdate.bind(this),c.UPDATE_INTERVAL)),this.idlePermutationCounter=0},c.prototype.iOSEventUpdate=function(){var e=new hr;this.rotState.equals(e)?++this.idlePermutationCounter==c.IDLE_PERMUTATION_CAP&&this.resolve():(this.rotState=e,this.idlePermutationCounter=0)},c.IDLE_PERMUTATION_CAP=15,c.UPDATE_INTERVAL=20,c}();var Xr=function(){function c(e,t){var n=this;this.domEventTracker=new Zt,this.suppressFocusCheck=function(i){return n.focusAssistant.isTargetForcingScroll()&&(i.stopPropagation(),i.cancelBubble=!0),!0},this.pageFocusHandler=function(){var i;return!n.focusAssistant.maintainingFocus&&((i=n.engine.osk)===null||i===void 0?void 0:i.vkbd)&&(n.engine.contextManager.deactivateCurrentTarget(),n.engine.contextManager.resetContext()),!1},this.touchStartActivationHandler=function(i){var r,s,l=n.engine.osk;if(!l)return!1;var o=n.engine.config.hostDevice;if(n.deactivateOnRelease=!0,n.touchY=i.touches[0].screenY,n.deactivateOnScroll=!1,o.OS=="android"&&o.browser=="chrome"){if(typeof l._Box=="undefined"||typeof l._Box.style=="undefined")return!1;var a=i.target.parentElement;if(typeof a!="undefined"&&a!=null&&(((r=a.getAttribute("class"))===null||r===void 0?void 0:r.indexOf("kmw-key-"))>=0||typeof a.parentElement!="undefined"&&a.parentElement!=null&&(a=a.parentElement,((s=a.getAttribute("class"))===null||s===void 0?void 0:s.indexOf("kmw-key-"))>=0)))return!1;n.deactivateOnScroll=!0}return!1},this.touchMoveActivationHandler=function(i){n.deactivateOnScroll&&(n.focusAssistant.focusing=!1,n.engine.contextManager.deactivateCurrentTarget());var r=i.touches[0].screenY,s=n.touchY;return(r-s>5||s-r<5)&&(n.deactivateOnRelease=!1),!1},this.touchEndActivationHandler=function(i){return n.deactivateOnRelease&&!n.engine.touchLanguageMenu&&!n.focusAssistant.focusing&&n.engine.contextManager.deactivateCurrentTarget(),n.deactivateOnRelease=!1,!1},this._WindowLoad=function(){document.body.scrollTop=0,typeof document.documentElement!="undefined"&&(document.documentElement.scrollTop=0)},this._WindowUnload=function(){n.engine.shutdown()},this.window=e,this.engine=t,this.attachHandlers(),t.config.hostDevice.touchable&&(this.buildPageTrailer(),this.rotationProcessor=new Cr(this.engine),this.rotationProcessor.init())}return c.prototype.buildPageTrailer=function(){var e=this.mobilePageTrailer=document.createElement("div"),t=e.style;t.width="100%",t.height=screen.width/2+"px",document.body.appendChild(e)},Object.defineProperty(c.prototype,"focusAssistant",{get:function(){return this.engine.contextManager.focusAssistant},enumerable:!1,configurable:!0}),c.prototype.attachHandlers=function(){var e=this.domEventTracker,t=this.engine.config.hostDevice,n=this.window.document.body;e.attachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),e.attachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),e.attachDOMEvent(n,"focus",this.suppressFocusCheck,!0),e.attachDOMEvent(n,"blur",this.suppressFocusCheck,!0),t.touchable&&(e.attachDOMEvent(n,"touchstart",this.touchStartActivationHandler,!1),e.attachDOMEvent(n,"touchmove",this.touchMoveActivationHandler,!1),e.attachDOMEvent(n,"touchend",this.touchEndActivationHandler,!1)),e.attachDOMEvent(window,"load",this._WindowLoad,!1),e.attachDOMEvent(window,"unload",this._WindowUnload,!1),e.attachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)},c.prototype.shutdown=function(){var e,t=this.domEventTracker,n=this.engine.config.hostDevice,i=this.window.document.body;t.detachDOMEvent(this.window,"focus",this.pageFocusHandler,!1),t.detachDOMEvent(this.window,"blur",this.pageFocusHandler,!1),t.detachDOMEvent(i,"focus",this.suppressFocusCheck,!0),t.detachDOMEvent(i,"blur",this.suppressFocusCheck,!0),n.touchable&&(t.detachDOMEvent(i,"touchstart",this.touchStartActivationHandler,!1),t.detachDOMEvent(i,"touchmove",this.touchMoveActivationHandler,!1),t.detachDOMEvent(i,"touchend",this.touchEndActivationHandler,!1),(e=this.mobilePageTrailer)===null||e===void 0||e.parentElement.removeChild(this.mobilePageTrailer)),t.detachDOMEvent(window,"load",this._WindowLoad,!1),t.detachDOMEvent(window,"unload",this._WindowUnload,!1),t.detachDOMEvent(document,"keyup",this.engine.hotkeyManager._Process,!1)},c}();function lt(c){var e=document.createElement(c);return e.style.userSelect="none",e.style.MozUserSelect="none",e.style.KhtmlUserSelect="none",e.style.UserSelect="none",e.style.WebkitUserSelect="none",e}function zt(c,e){try{if(c&&typeof window.getComputedStyle!="undefined")return window.getComputedStyle(c,"").getPropertyValue(e)}catch(t){}return""}var xr=function(){function c(e){this.keyman=e,this.scrolling=!1,this.shim=this.constructShim()}return c.prototype.constructShim=function(){var e=this,t=this,n=lt("div"),i=this.keyman.osk;return n.id="kmw-language-menu-background",n.addEventListener("touchstart",function(r){if(r.preventDefault(),t.hide(),r.touches.length>2){var s=r.touches[1].pageX,l=r.touches[1].pageY,o=i.vkbd.spaceBar;s>o.offsetLeft&&s<o.offsetLeft+o.offsetWidth&&l>o.offsetTop&&l<o.offsetTop+o.offsetHeight&&e.keyman.osk.emit("showbuild")}},!1),n},c.prototype.show=function(){var e=this.keyman.config.hostDevice,t=this.keyman.keyboardRequisitioner.cache.getStubList(),n=t.length;if(!(n<1)){var i=this.lgList=lt("div");this.lgList.id="kmw-language-menu";var r=this;document.body.appendChild(this.shim);var s=lt("div"),l=s.style,o=lt("div");s.id="kmw-menu-scroll-container",o.id="kmw-menu-scroller","WebkitOverflowScrolling"in l&&(l.WebkitOverflowScrolling="touch"),s.appendChild(o),i.appendChild(s);var a,g=lt("div");g.id="kmw-menu-index";for(var d=1;d<=26;d++)a=lt("p"),a.innerHTML=String.fromCharCode(d+64),g.appendChild(a);if(g.addEventListener("touchstart",function(X){r.scrollToLanguage(X,s,o)},!1),g.addEventListener("touchend",function(X){X.stopPropagation()},!1),i.appendChild(g),i.addEventListener("scroll",function(X){r.scrolling=!0},!1),s.addEventListener("scroll",function(X){s.scrollTop<1&&(s.scrollTop=1),s.scrollTop>s.scrollHeight-s.offsetHeight-1&&(s.scrollTop=s.scrollHeight-s.offsetHeight-1)},!1),this.activeLgNo=this.addLanguages(o,t),this.lgList.style.visibility="hidden",document.body.appendChild(this.lgList),e.OS=="android"&&"devicePixelRatio"in window&&(this.lgList.style.fontSize=2/window.devicePixelRatio+"em"),e.OS=="android"&&e.formFactor=="tablet"&&"devicePixelRatio"in window){var B=parseInt(zt(i,"width"),10),u=i.style;isNaN(B)||(u.width=u.maxWidth=2*B/window.devicePixelRatio+"px"),B=parseInt(zt(s,"width"),10),u=s.style,isNaN(B)||(u.width=u.maxWidth=2*B/window.devicePixelRatio+"px"),B=parseInt(zt(o,"width"),10),u=o.style,isNaN(B)||(u.width=u.maxWidth=2*B/window.devicePixelRatio+"px")}this.adjust(0);var y=g.childNodes[1].offsetTop-g.childNodes[0].offsetTop,I=Math.floor(i.offsetHeight/26),F=Math.round(100*I/y)/100,U=F>.6?1:2;F>1.25&&(F=1.25);for(var d=0;d<26;d++){var b=g.childNodes[d].style;U==2&&d%2==1?b.display="none":(b.fontSize=F*U+"em",b.lineHeight=I*U+"px")}var C=s.offsetWidth;s.scrollHeight>s.offsetHeight+3?C=C+g.offsetWidth:g.style.display="none",i.style.width=C+"px",this.lgList.style.visibility="",this.scrollToIndex(this.activeLgNo,s,o)}},c.prototype.adjust=function(e){var t=this.keyman.osk,n=this.keyman.config.hostDevice,i=this.lgList,r=i.firstChild,s=r.firstChild,l=0,o=i.style,a=i.childNodes[1],g=window.innerHeight-t.vkbd.lgKey.offsetHeight-16,d=s.childNodes.length+e-1,B=s.firstChild.firstChild.offsetHeight,u=d*B;n.OS=="ios"&&(n.formFactor=="phone"?(l=rt()?36:0,g=(window.innerHeight-l-16)*bt(n.formFactor)):n.formFactor=="tablet"&&(l=rt()?16:0,g=g-l)),o.left=z(t.vkbd.lgKey)+"px",u>g&&(u=g),o.height=u+"px",o.bottom="0px",a.style.height=r.style.height=o.height},c.prototype.scrollToLanguage=function(e,t,n){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault();var i=e.touches[0].target;if(i.nodeName=="P"){var r,s,l=i.innerHTML.charCodeAt(0),o=n.childNodes;try{for(r=0;r<o.length-1&&(s=o[r].firstChild.innerHTML.toUpperCase().charCodeAt(0),!(s>=l));r++);}catch(a){}this.scrollToIndex(r,t,n)}},c.prototype.scrollToIndex=function(e,t,n){var i,r=.5;try{i=n.firstChild.getBoundingClientRect().height*(e-r)+1,t.scrollTop=i}catch(s){i=0}try{t.scrollTop<0&&(t.scrollTop=0),t.scrollTop>t.scrollHeight-t.offsetHeight-1&&(t.scrollTop=t.scrollHeight-t.offsetHeight-1)}catch(s){}},c.prototype.addLanguages=function(e,t){for(var n,i=t.length,r=this.keyman.config.hostDevice,s=[],l=0;l<i;l++){var o=t[l].KL;s.indexOf(o)==-1&&s.push(o)}s.sort();for(var a=Math.round(100/bt(r.formFactor))/100,g=-1,d=function(F){var U=lt("div");U.className="kbd-list-closed";var b=lt("p");b.kList=[];for(var C=0;C<i;C++)t[C].KL==s[F]&&b.kList.push(t[C]);r.OS=="ios"&&(b.style.fontSize=a+"em"),U.appendChild(b),e.appendChild(U),s[F]==((n=B.keyman.contextManager.activeKeyboard)===null||n===void 0?void 0:n.metadata.langName)&&(g=F);var X=B;if(b.kList.length>1){b.className="kbd-list",b.innerHTML=s[F]+"...",b.scrolled=!1,b.ontouchend=function(p){p.stopPropagation(),b.scrolled?b.scrolled=!1:b.parentElement.className=b.parentElement.className=="kbd-list-closed"?"kbd-list-open":"kbd-list-closed",X.adjust(b.parentElement.className=="kbd-list-closed"?0:b.kList.length)},b.addEventListener("touchstart",function(p){p.stopPropagation()},!1),b.addEventListener("touchmove",function(p){b.scrolled=!0,p.stopPropagation()},!1);for(var Z=0;Z<b.kList.length;Z++){var G=lt("p");G.className="kbd-list-entry",r.OS=="ios"&&(G.style.fontSize=a+"em"),B.addKeyboard(b.kList[Z],G,!1),U.appendChild(G)}}else b.innerHTML=s[F],b.className="kbd-single-entry",B.addKeyboard(b.kList[0],b,!0);F==g&&(b.className=b.className+" current")},B=this,u=0;u<s.length;u++)d(u);var y=lt("div");y.id="kmw-menu-footer";var I=function(F){F.cancelable&&F.preventDefault(),F.stopPropagation()};return y.addEventListener("touchstart",I,!1),y.addEventListener("touchmove",I,!1),y.addEventListener("touchend",I,!1),e.appendChild(y),g},c.prototype.addKeyboard=function(e,t,n){var i=this;t.kn=e.KI,t.kc=e.KLC,t.innerHTML=n?e.KL:e.KN.replace(" Keyboard","");var r=this,s=function(){if(i.originalBodyStyle)return console.error("Unexpected state:  `originalBodyStyle` was not cleared by a previous `unlockBodyScroll()` call"),!1;i.originalBodyStyle={};var B=i.originalBodyStyle,u=document.body.style;return B.overflowY=u.overflowY,B.height=u.height,u.overflowY="hidden",u.height="100%",!0},l=function(){if(!i.originalBodyStyle){console.error("Unexpected state:  `originalBodyStyle` is unset; cannot restore original body style");return}var B=i.originalBodyStyle,u=document.body.style;u.overflowY=B.overflowY,u.height=B.height,i.originalBodyStyle=null},o=function(B){B.stopPropagation(),this.className.indexOf("selected")<=0&&(this.className=this.className+" selected"),r.scrolling=!1,r.y0=B.touches[0].pageY,s()},a=function(B){B.stopImmediatePropagation();var u=r.lgList.childNodes[0],y=u.scrollHeight-u.offsetHeight,I,F;if(typeof B.pageY!="undefined")I=B.pageY;else if(typeof B.touches!="undefined")I=B.touches[0].pageY;else return!1;if(F=I-r.y0,F<0)u.scrollTop>=y-1&&(r.y0=I);else if(F>0)u.scrollTop<2&&(r.y0=I);else return!1;return(F<-5||F>5)&&(r.scrolling=!0,this.className=this.className.replace(/\s*selected/,""),r.y0=I),!0},g=function(B){var u=this;return typeof B.stopImmediatePropagation!="undefined"?B.stopImmediatePropagation():B.stopPropagation(),r.scrolling?this.className=this.className.replace(/\s*selected/,""):(r.keyman.contextManager.focusAssistant.setFocusTimer(),r.lgList.style.display="none",r.keyman.contextManager.activateKeyboard(u.kn,u.kc,!0),r.keyman.contextManager.restoreLastActiveTarget(),r.hide()),l(),!0},d=function(B){l()};t.addEventListener("touchstart",o,!1),t.addEventListener("touchmove",a,!1),t.addEventListener("touchend",g,!1),t.addEventListener("touchcancel",d,!1)},c.prototype.hide=function(){var e=this,t=this.keyman.osk;this.lgList&&(t.vkbd.highlightKey(t.vkbd.lgKey,!1),this.lgList.style.visibility="hidden",window.setTimeout(function(){e.shim.parentElement&&(document.body.removeChild(e.shim),document.body.removeChild(e.lgList))},500)),this.keyman.touchLanguageMenu=null},c}();function Gr(c,e,t){var n=this,i=t.focusAssistant;e.on("globekey",function(r,s){s&&e.hostDevice.touchable&&(c.touchLanguageMenu=new xr(c),c.touchLanguageMenu.show()),e.vkbd&&e.vkbd.highlightKey(r,!1)}),e.on("hiderequested",function(r){e&&(e.startHide(!0),t.forgetActiveTarget())}),e.addEventListener("hide",function(r){var s;r!=null&&r.HiddenByUser&&((s=t.activeTarget)===null||s===void 0||s.focus())}),e.on("showbuild",function(){var r;(r=c.config.alertHost)===null||r===void 0||r.alert("KeymanWeb Version "+Bn.VERSION+'<br /><br /><span style="font-size:0.8em">Copyright &copy; 2007-2023 SIL International</span>')}),e.on("dragmove",function(r){return(0,Q.__awaiter)(n,void 0,void 0,function(){return(0,Q.__generator)(this,function(s){switch(s.label){case 0:return i.restoringFocus=!0,[4,r];case 1:return s.sent(),t.restoreLastActiveTarget(),i.restoringFocus=!1,i.setMaintainingFocus(!1),[2]}})})}),e.on("resizemove",function(r){return(0,Q.__awaiter)(n,void 0,void 0,function(){return(0,Q.__generator)(this,function(s){switch(s.label){case 0:return i.restoringFocus=!0,[4,r];case 1:return s.sent(),t.restoreLastActiveTarget(),i.restoringFocus=!1,i.setMaintainingFocus(!1),[2]}})})}),e.on("pointerinteraction",function(r){return(0,Q.__awaiter)(n,void 0,void 0,function(){return(0,Q.__generator)(this,function(s){switch(s.label){case 0:return i.setMaintainingFocus(!0),[4,r];case 1:return s.sent(),i.setMaintainingFocus(!1),[2]}})})})}function ao(c){var e=document.createElement(c);return e.style.userSelect="none",e}var pr=function(){function c(e){this.getAbsoluteX=z,this.getAbsoluteY=K,this._GetAbsoluteX=z,this._GetAbsoluteY=K,this._GetAbsolute=this.getAbsolute,this.toNzString=this.nzString,this.createElement=ao,this.getStyleValue=zt,this.config=e,this.stylesheetManager=new Ft(document.body,e.applyCacheBusting),this.domEventTracker=new Zt}return c.prototype.isTouchDevice=function(){return this.config.hostDevice.touchable},c.prototype.getAbsolute=function(e){return{x:z(e),y:K(e)}},c.prototype.getOption=function(e,t){return e in this.config.paths?this.config.paths[e]:e in this.config.options?this.config.options[e]:arguments.length>1?t:""},c.prototype.setOption=function(e,t){switch(e){case"attachType":break;case"ui":break;case"useAlerts":this.config.signalUser=t?new ne:null;break;case"setActiveOnRegister":this.config.activateFirstKeyboard=!!t;break;case"spacebarText":this.config.spacebarText=t;break;default:throw new Error("Path-related options may not be changed after the engine has initialized.")}},c.prototype.loadCookie=function(e){var t=new yt(e);return t.load(decodeURIComponent)},c.prototype.saveCookie=function(e,t){var n=new yt(e);n.save(t,encodeURIComponent)},c.prototype.addStyleSheet=function(e){var t=At(e);return this.stylesheetManager.linkStylesheet(t),t},c.prototype.removeStyleSheet=function(e){return this.stylesheetManager.unlink(e)},c.prototype.linkStyleSheet=function(e){this.stylesheetManager.linkExternalSheet(e)},c.prototype.getLanguageCodes=function(e){return e.indexOf("-")==-1?[e]:e.split("-")},c.prototype.attachDOMEvent=function(e,t,n,i){this.domEventTracker.attachDOMEvent(e,t,n,i)},c.prototype.detachDOMEvent=function(e,t,n,i){this.domEventTracker.detachDOMEvent(e,t,n,i)},Object.defineProperty(c.prototype,"alertHost",{get:function(){return this.config.alertHost?this.config.alertHost:(this._alertHost||(this._alertHost=new ne),this._alertHost)},enumerable:!1,configurable:!0}),c.prototype.alert=function(e,t){this.alertHost.alert(e,t)},c.prototype.nzString=function(e,t){var n="";return arguments.length>1&&(n=t),typeof e=="undefined"||e==null||e==0||e==""?n:""+e},c.prototype.toNumber=function(e,t){var n=parseInt(e,10);return isNaN(n)?t:n},c.prototype.toFloat=function(e,t){var n=parseFloat(e);return isNaN(n)?t:n},c.prototype.rgba=function(e,t,n,i,r){var s="transparent";try{s="rgba("+t+","+n+","+i+","+r+")"}catch(l){s="rgb("+t+","+n+","+i+")"}return s},c.prototype.shutdown=function(){var e,t,n;(e=this.stylesheetManager)===null||e===void 0||e.unlinkAll(),(t=this.domEventTracker)===null||t===void 0||t.shutdown(),(n=this._alertHost)===null||n===void 0||n.shutdown()},c}();var go=function(){function c(e,t,n){this.code=e,this.shift=t,this.handler=n}return c.prototype.matches=function(e,t){return this.code==e&&this.shift==t},c}(),mr=function(){function c(){var e=this;this.hotkeys=[],this._Process=function(t){t||(t=window.event);var n=Xi(t);if(n==null)return!1;for(var i=(t.shiftKey?16:0)|(t.ctrlKey?32:0)|(t.altKey?64:0),r=0;r<e.hotkeys.length;r++)if(e.hotkeys[r].matches(n,i))return e.hotkeys[r].handler(),t.returnValue=!1,t&&t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,!1;return!0}}return c.prototype.addHotKey=function(e,t,n){for(var i=0;i<this.hotkeys.length;i++)if(this.hotkeys[i].code==e&&this.hotkeys[i].shift==t){this.hotkeys[i].handler=n;return}this.hotkeys.push(new go(e,t,n))},c.prototype.removeHotkey=function(e,t){for(var n=0;n<this.hotkeys.length;n++)if(this.hotkeys[n].matches(e,t)){this.hotkeys.splice(n,1);return}},c}();var Qo=function(){function c(e){this.e=e,this.c=e.style.backgroundColor}return c.prototype.reset=function(){this.e.style.backgroundColor=this.c},c}(),Zr=function(){function c(e){var t=this;this._BeepObjects=[],this._BeepTimeout=0,this.reset=function(){t.keyboardInterface.resetContextCache();var n;for(t._BeepTimeout=0,n=0;n<t._BeepObjects.length;n++)t._BeepObjects[n].reset();t._BeepObjects=[]},this.keyboardInterface=e}return c.prototype.beep=function(e){if(e instanceof et){var t=e.getElement();if(e instanceof nt&&(t=e.docRoot),!!t&&!(!t.style||typeof t.style.backgroundColor=="undefined")){for(var n=0;n<this._BeepObjects.length;n++)if(this._BeepObjects[n].e==t)return;this._BeepObjects.push(new Qo(t)),t.style.backgroundColor="#000000",this._BeepTimeout==0&&(this._BeepTimeout=1,window.setTimeout(this.reset,50))}}},c}();var Jr=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=c.call(this,t,n)||this;return i.GetLastActiveElement=i.getLastActiveElement,i.FocusLastActiveElement=i.focusLastActiveElement,i.HideHelp=i.hideHelp,i.ShowHelp=i.showHelp,i.ShowPinnedHelp=i.showPinnedHelp,i}return e.prototype.saveFocus=function(){this.engine.contextManager.focusAssistant._IgnoreNextSelChange=1},e.prototype.getLastActiveElement=function(){return this.engine.contextManager.lastActiveTarget},e.prototype.focusLastActiveElement=function(){this.engine.contextManager.restoreLastActiveTarget()},e.prototype.hideHelp=function(){var t=this.engine.osk;t.startHide(!0)},e.prototype.showHelp=function(t,n){var i=this.engine.osk;i instanceof te?i.presentAtPosition(t,n):i.present()},e.prototype.showPinnedHelp=function(){var t=this.engine.osk;t instanceof te&&(!t.activeKeyboard.keyboard.isCJK||!this.ruleBehavior)&&(t.userPositioned=!0),t.present()},e}(En),Vr=Jr;(function(){Jr.__publishShorthandAPI()})();var Bo=function(c){(0,Q.__extends)(e,c);function e(t,n){var i=this,r=new Br(n);return i=c.call(this,t,r,new Ir(r,function(){return i.legacyAPIEvents}),function(s){return{keyboardInterface:new Vr(window,s),defaultOutputRules:new Ur(s.contextManager)}})||this,i._initialized=0,i.hotkeyManager=new mr,i.getOskHeight=null,i.getOskWidth=null,i.helpURL="https://help.keyman.com/go",i.keyEventRefocus=function(){i.contextManager.restoreLastActiveTarget()},i._GetKeyboardDetail=function(s,l){var o={Name:s.KN,InternalName:s.KI,LanguageName:s.KL,LanguageCode:s.KLC,RegionName:s.KR,RegionCode:s.KRC,CountryName:s.KC,CountryCode:s.KCC,KeyboardID:s.KD,Font:s.KFont,OskFont:s.KOskFont,HasLoaded:!!l,IsRTL:l?l.isRTL:null};return o},i._util=new pr(r),i.beepHandler=new Zr(i.core.keyboardInterface),i.core.keyboardProcessor.beepHandler=function(){return i.beepHandler.beep(i.contextManager.activeTarget)},i.hardKeyboard=new br(r.hardDevice,i.core.keyboardProcessor,i.contextManager),i.contextManager.on("targetchange",function(s){var l=s==null?void 0:s.getElement();i.osk&&(i.osk.activationModel.activationTrigger=l),i.config.hostDevice.touchable&&s&&i.ensureElementVisibility(l)}),i}return e.prototype.ensureElementVisibility=function(t){if(!(!t||!this.osk)){var n=K(t),i=window.pageYOffset,r=n-i;n>=i&&(r-=window.innerHeight-this.osk._Box.offsetHeight-t.offsetHeight-2,r<0&&(r=0)),r!=0&&window.scrollTo(0,r+i)}},Object.defineProperty(e.prototype,"util",{get:function(){return this._util},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"views",{get:function(){return ui},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"initialized",{get:function(){return this._initialized},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ui",{get:function(){return this._ui},set:function(t){this._ui&&this._ui.shutdown(),this._ui=t,this.config.deferForInitialization.isFulfilled&&t.initialize()},enumerable:!1,configurable:!0}),e.prototype.init=function(t){return(0,Q.__awaiter)(this,void 0,void 0,function(){var n,i,r,s,l,o,a,g,d=this;return(0,Q.__generator)(this,function(B){switch(B.label){case 0:return n=new Ae,i=n.detect(),r=(0,Q.__assign)((0,Q.__assign)({},ur),t),this.config.hostDevice=i,this.config.initialize(r),this._initialized=1,[4,pe()];case 1:return B.sent(),this.config.deferForInitialization.isResolved?[2,Promise.resolve()]:[4,c.prototype.init.call(this,r)];case 2:return B.sent(),this.keyboardRequisitioner.cloudQueryEngine.once("unboundregister",function(){var u;!((u=d.contextManager.activeKeyboard)===null||u===void 0)&&u.keyboard||d.setActiveKeyboard("","")}),this.contextManager.initialize(),s=this.contextManager.getSavedKeyboardRaw(),this.pageIntegration=new Xr(window,this),this.config.finalizeInit(),this.ui&&(this.ui.initialize(),this.legacyAPIEvents.callEvent("loaduserinterface",{})),this._initialized=2,[4,this.config.deferForInitialization];case 3:B.sent(),l=this.contextManager.restoreSavedKeyboard(s),B.label=4;case 4:return B.trys.push([4,6,,7]),[4,l];case 5:return B.sent(),[3,7];case 6:return o=B.sent(),[3,7];case 7:return a={keyboardToActivate:this.contextManager.activeKeyboard},g=i.touchable?new Qi(this,a):new Bi(this,a),Gr(this,g,this.contextManager),this.osk=g,[2]}})})},Object.defineProperty(e.prototype,"register",{get:function(){return this.keyboardRequisitioner.cloudQueryEngine.registerFromCloud},enumerable:!1,configurable:!0}),e.prototype.getUIState=function(){return this.contextManager.focusAssistant.getUIState()},e.prototype.activatingUI=function(t){this.contextManager.focusAssistant.setMaintainingFocus(!!t)},e.prototype.setKeyboardForControl=function(t,n,i){if(t instanceof t.ownerDocument.defaultView.HTMLIFrameElement){console.warn("'keymanweb.setKeyboardForControl' cannot set keyboard on iframes.");return}if(!this.isAttached(t)){console.error("KeymanWeb is not attached to element "+t);return}var r=null;if(n&&(r=this.keyboardRequisitioner.cache.getStub(n,i),!r))throw new Error("No keyboard has been registered with id ".concat(n," and language code ").concat(i,"."));this.contextManager.setKeyboardForTarget(t._kmwAttachment.interface,n,i)},e.prototype.getKeyboardForControl=function(t){var n=Ct(t);return this.contextManager.getKeyboardStubForTarget(n).id},e.prototype.getLanguageForControl=function(t){var n=Ct(t);return this.contextManager.getKeyboardStubForTarget(n).langId},e.prototype.isAttached=function(t){return this.contextManager.page.isAttached(t)},e.prototype.addKeyboards=function(){for(var t=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return this.config.deferForInitialization.then(function(){if(!n||!n[0]||n[0].length==0)return t.keyboardRequisitioner.fetchCloudCatalog().catch(function(s){return console.error(s[0].error),s});var r=[];return Array.isArray(n[0])?r=r.concat(n[0]):Array.isArray(n)&&(r=r.concat(n)),t.keyboardRequisitioner.addKeyboardArray(r)})},e.prototype.addKeyboardsForLanguage=function(t){var n=this;return this.config.deferForInitialization.then(function(){return typeof t=="string"?n.keyboardRequisitioner.addLanguageKeyboards(t.split(",").map(function(i){return i.trim()})):n.keyboardRequisitioner.addLanguageKeyboards(t)})},e.prototype.isCJK=function(t){var n;if(t){var i=t;i.KeyboardID?n=this.keyboardRequisitioner.cache.getKeyboard(i.KeyboardID):n=new j(t)}else n=this.core.activeKeyboard;return n&&n.isCJK},e.prototype.getKeyboard=function(t,n){var i=this.keyboardRequisitioner.cache.getStub(t,n),r=this.keyboardRequisitioner.cache.getKeyboardForStub(i);return i&&this._GetKeyboardDetail(i,r)},e.prototype.getKeyboards=function(){for(var t=[],n=this.keyboardRequisitioner.cache,i=n.getStubList(),r=0;r<i.length;r++){var s=i[r],l=n.getKeyboardForStub(s),o=this._GetKeyboardDetail(s,l);t.push(o)}return t},e.prototype.removeKeyboards=function(){for(var t,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];for(var r=0;r<n.length;r++)this.keyboardRequisitioner.cache.forgetKeyboard(n[r],!0),((t=this.contextManager.activeKeyboard)===null||t===void 0?void 0:t.metadata.id)==q(n[r])&&this.contextManager.activateKeyboard("","");return!0},e.prototype.getSavedKeyboard=function(){return this.contextManager.getSavedKeyboard()},e.prototype.focusLastActiveElement=function(){var t;(t=this.contextManager.lastActiveTarget)===null||t===void 0||t.focus()},e.prototype.getLastActiveElement=function(){var t;return(t=this.contextManager.lastActiveTarget)===null||t===void 0?void 0:t.getElement()},e.prototype.setActiveElement=function(t,n){if(typeof t=="string"){var i=t;if(t=document.getElementById(t),!t)throw new Error("Could not find the specified element (id: ".concat(i))}var r=Ct(t);if(!r)throw new Error("KMW is not attached to the specified element (id: ".concat(t.id,")."));this.contextManager.setActiveTarget(r,n)},e.prototype.moveToElement=function(t){typeof t=="string"&&(t=document.getElementById(t)),t.focus()},e.prototype.addHotKey=function(t,n,i){this.hotkeyManager.addHotKey(t,n,i)},e.prototype.removeHotKey=function(t,n){this.hotkeyManager.removeHotkey(t,n)},e.prototype.attachToControl=function(t){this.contextManager.page.attachToControl(t)},e.prototype.detachFromControl=function(t){this.contextManager.page.detachFromControl(t)},e.prototype.disableControl=function(t){this.contextManager.page.disableControl(t)},e.prototype.enableControl=function(t){this.contextManager.page.enableControl(t)},e.prototype.BuildVisualKeyboard=function(t,n,i,r){var s=null;t!=null&&(s=this.keyboardRequisitioner.cache.getKeyboard(t)),s=s||this.core.activeKeyboard;var l=this.keyboardRequisitioner.cache.getStub(s),o=this.getOskHeight,a=(typeof o=="function"?o():null)||this.osk.computedHeight||200;return Vt.buildDocumentationKeyboard(s,l,this.config.paths,i,r,a)},e.prototype.shutdown=function(){var t,n;this.pageIntegration.shutdown(),this.contextManager.shutdown(),(t=this.osk)===null||t===void 0||t.shutdown(),this.core.languageProcessor.shutdown(),this.hardKeyboard.shutdown(),this.util.shutdown(),this.legacyAPIEvents.callEvent("unloaduserinterface",{}),(n=this.ui)===null||n===void 0||n.shutdown()},e}(zn),vr=Bo;var fr=document.getElementsByTagName("script"),Rr=fr[fr.length-1].src,uo=Rr.substr(0,Rr.lastIndexOf("/")+1);window.keyman=new vr(Tn.constructInstance(),uo);})();
//# sourceMappingURL=keymanweb.es5.js.map
