{"version":3,"file":"kmwuitoolbar.js","lineCount":30,"mappings":"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","sources":["https://s.keyman.com/kmw/engine/16.0.143/src/kmwuitoolbar.ts"],"sourcesContent":["/***\r\n   KeymanWeb 11.0\r\n   Copyright 2019 SIL International\r\n***/\r\n\r\n// If a UI module has been loaded, we can rely on the publically-published \u0027name\u0027 property\r\n// having been set as a way to short-out a UI reload.  Its parent object always exists by\r\n// this point in the build process.\r\nif(!window[\u0027keyman\u0027][\u0027ui\u0027][\u0027name\u0027]) {\r\n  /********************************/\r\n  /*                              */\r\n  /* Toolbar User Interface       */\r\n  /*                              */\r\n  /********************************/\r\n\r\n  /**\r\n   * Do not enclose in an anonymous function, as the compiler may create\r\n   * global scope variables to replace true, false, null, which can collide\r\n   * with other variables.\r\n   * Instead, use the --output-wrapper command during optimization, which will\r\n   * add the anonymous function to enclose all code, including those optimized\r\n   * variables which would otherwise have global scope.\r\n   **/\r\n\r\n  try {\r\n\r\n    // Declare KeymanWeb, OnScreen keyboard and Util objects\r\n    var keymanweb=window[\u0027keyman\u0027],util=keymanweb[\u0027util\u0027],dbg=keymanweb[\u0027debug\u0027];\r\n\r\n    // Disable UI for touch devices\r\n    if(util[\u0027isTouchDevice\u0027]()) throw \u0027\u0027;\r\n\r\n    // User interface local variables\r\n    keymanweb[\u0027ui\u0027] = {\r\n      init: false,\r\n      toolbarNode: null,\r\n      backgroundNode: null,\r\n      browseMapNode: null,\r\n      keyboardsButtonNode: null,\r\n      languageButtonsNode: null,\r\n      offButtonNode: null,\r\n      offBarNode: null,\r\n      oskButtonNode: null,\r\n      oskBarNode: null,\r\n      selectorNode: null,\r\n      regionLanguageListNodes: [],\r\n      regionNodes: null,\r\n      langKeyboardNodes: [],\r\n      langKeyboardListNodes: [],\r\n      selectedRegion: \u0027as\u0027,\r\n      listedKeyboards: [],\r\n      catchAllRegion: \u0027un\u0027,\r\n      keyboardListPriority: 0,\r\n      maxListedKeyboards: 1,\r\n      lastActiveControl: null,\r\n      selectedKeyboard: null,\r\n      selectedLanguage: \u0027\u0027,\r\n      helpOffsetX: 0,\r\n      helpOffsetY: 0,\r\n      languages: [],      // array of objects { id: \u003clangid\u003e, name: \u003cname\u003e, keyboards: \u003carray of KeymanWeb keyboards\u003e }\r\n      updateMap: false,   // flag to control re-initialization of keyboard map\r\n      startTimer: 0,      // initialization timer - wait 2 seconds after last stub installed then initialize map\r\n      lgText: \u0027\u0027          // language name in toolbar\r\n    }\r\n\r\n    // User Interface object\r\n    var ui=keymanweb[\u0027ui\u0027];\r\n    ui[\u0027name\u0027] = \u0027toolbar\u0027;\r\n\r\n    ui.ToolBar_Text = {\r\n      Keyboards: \u0027Languages\u0027,\r\n      OffTitle: \u0027Turn off KeymanWeb keyboards\u0027,\r\n      Off: \u0027Off\u0027,\r\n      ShowOSK: \u0027Show On Screen Keyboard\u0027,\r\n      LanguageSelector: \u0027Select language\u0027\r\n      };\r\n\r\n    ui.ToolBar_Text[\u0027SelectKeyboardPre\u0027]=\u0027Select \u0027;\r\n    ui.ToolBar_Text[\u0027SelectKeyboardSuf\u0027]=\u0027keyboard\u0027;\r\n    ui.ToolBar_Text[\u0027AltKeyboardsPre\u0027]=\u0027Alternate keyboards for \u0027;\r\n    ui.ToolBar_Text[\u0027AltKeyboardsSuf\u0027]=\u0027\u0027;\r\n\r\n    ui.ToolBar_Text[\u0027ca\u0027]=\u0027Central America\u0027;\r\n    ui.ToolBar_Text[\u0027sa\u0027]=\u0027South America\u0027;\r\n    ui.ToolBar_Text[\u0027na\u0027]=\u0027Americas\u0027;\r\n    ui.ToolBar_Text[\u0027eu\u0027]=\u0027Europe\u0027;\r\n    ui.ToolBar_Text[\u0027af\u0027]=\u0027Africa\u0027;\r\n    ui.ToolBar_Text[\u0027un\u0027]=\u0027Undetermined\u0027;\r\n    ui.ToolBar_Text[\u0027as\u0027]=\u0027Asia\u0027;\r\n    ui.ToolBar_Text[\u0027oc\u0027]=\u0027Oceania\u0027;\r\n\r\n\r\n    var controller=document.getElementById(\u0027KeymanWebControl\u0027);\r\n  /**\r\n     * Create some of the controls but don\u0027t insert them into the document yet\r\n     * This does not need or want to prevent loss of focus, so uses document.createElement\r\n     * rather than util.createElement.\r\n     *\r\n     * @param       {string}  tag\r\n     * @param       {?string=}  id\r\n     * @param       {?string=}  className\r\n     * @param       {string=}  innerHTML\r\n     * @return      {Node|null}\r\n     */\r\n    ui.createNode = function(tag, id, className, innerHTML)\r\n    {\r\n      //var node = util[\u0027createElement\u0027](tag);\r\n      var node = document.createElement(tag);\r\n      if(id) node.id = id;\r\n      if(className) node.className = className;\r\n      if(innerHTML) node.innerHTML = innerHTML;\r\n\r\n      // The following is OK for IE and for F3.5 and later - should simply be ignored for others\r\n      // first tried preventDefault() as suggested by many on web, which worked but interfered with keyboard and OSK enabling\r\n      if(tag == \u0027a\u0027 || tag == \u0027area\u0027 || tag == \u0027map\u0027) node.ondragstart = function(){return false;}\r\n      return node;\r\n    }\r\n\r\n    /**\r\n     * Initialize toolbar UI\r\n     */\r\n    ui[\u0027initialize\u0027] = ui.initToolbarUI = function()\r\n    {\r\n      if(!keymanweb[\u0027initialized\u0027] || ui.init) return;\r\n\r\n      // Find the controller DIV, insert at top of body if undefined\r\n      var e = document.getElementById(\u0027KeymanWebControl\u0027);\r\n      if(!e)\r\n      {\r\n        if(document.body == null)\r\n          return;\r\n        else\r\n        {\r\n          e=document.createElement(\u0027DIV\u0027);\r\n          e.id=\u0027KeymanWebControl\u0027;\r\n          document.body.insertBefore(e,document.body.firstChild);\r\n          ui._insertedElem = e;\r\n        }\r\n      }\r\n\r\n      // Hide toolbar until elements fully drawn, to prevent spurious text displays\r\n      e.style.visibility=\u0027hidden\u0027; e.style.maxHeight=\u002735px\u0027;\r\n\r\n      ui.init = true;\r\n\r\n      if(util[\u0027isTouchDevice\u0027]()) return;\r\n\r\n      util[\u0027linkStyleSheet\u0027](util[\u0027getOption\u0027](\u0027resources\u0027)+\u0027ui/toolbar/kmwuitoolbar.css\u0027);\r\n\r\n      ui.regions = {};\r\n      //ui.regions[\u0027ca\u0027] = {t: ui.ToolBar_Text[\u0027ca\u0027], m: \u002749,52,65,54,68,57,71,56,73,59,75,60,93,61,94,58,97,58,101,59,107,60,114,64,115,68,114,77,104,74,98,75,96,78,95,82,90,81,85,80,82,76,78,74,74,73,65,68,57,61\u0027 },\r\n      //ui.regions[\u0027sa\u0027] = {t: ui.ToolBar_Text[\u0027sa\u0027], m: \u002782,82,95,82,96,78,98,75,104,74,114,77,120,79,124,83,126,87,141,90,142,97,138,103,135,113,127,116,123,124,115,131,112,132,109,138,117,139,140,141,141,146,134,148,114,145,109,148,100,148,91,143,91,130,96,111,89,102,83,95,77,89\u0027 },\r\n      ui.regions[\u0027na\u0027] = {t: ui.ToolBar_Text[\u0027na\u0027], m: \u00270,3,0,37,24,32,35,37,43,47,49,52,65,54,68,57,71,56,73,59,75,60,93,61,93,57,103,49,118,41,126,41,136,23,148,17,156,14,164,5,164,0,57,0,35,5,25,9,5,8,49,52,65,54,68,57,71,56,73,59,75,60,93,61,94,58,97,58,101,59,107,60,114,64,115,68,114,77,104,74,98,75,96,78,95,82,90,81,85,80,82,76,78,74,74,73,65,68,57,61,82,82,95,82,96,78,98,75,104,74,114,77,120,79,124,83,126,87,141,90,142,97,138,103,135,113,127,116,123,124,115,131,112,132,109,138,117,139,140,141,141,146,134,148,114,145,109,148,100,148,91,143,91,130,96,111,89,102,83,95,77,89\u0027 },\r\n      ui.regions[\u0027eu\u0027] = {t: ui.ToolBar_Text[\u0027eu\u0027], m: \u0027145,29,146,19,158,14,171,6,187,2,206,1,217,4,227,11,231,16,231,33,227,34,225,35,225,37,227,39,228,44,228,47,227,48,223,46,218,44,215,43,208,43,203,45,202,48,205,52,201,52,195,49,189,50,187,48,177,48,175,49,166,50,147,33\u0027 },\r\n      ui.regions[\u0027af\u0027] = {t: ui.ToolBar_Text[\u0027af\u0027], m: \u0027150,58,158,50,166,50,175,49,177,48,187,48,189,50,195,49,201,52,205,52,207,53,221,75,229,75,231,77,231,85,227,92,232,101,237,106,237,112,227,115,222,118,206,125,199,127,193,127,185,111,183,104,180,87,168,89,153,85,143,71,147,60\u0027 },\r\n      ui.regions[\u0027as\u0027] = {t: ui.ToolBar_Text[\u0027as\u0027], m: \u0027219,1,221,6,228,12,231,16,231,33,227,34,225,35,225,37,227,39,229,45,232,48,239,48,240,49,239,53,242,60,243,65,249,70,252,81,259,87,271,87,278,95,289,100,303,101,311,98,320,98,323,98,323,84,311,81,308,73,307,65,317,57,330,50,334,44,348,36,364,38,375,34,375,8,355,8,336,5,292,1,285,0,219,0\u0027 },\r\n      ui.regions[\u0027oc\u0027] = {t: ui.ToolBar_Text[\u0027oc\u0027], m: \u0027288,117,289,107,303,101,311,98,323,98,323,84,333,77,344,73,362,80,369,88,375,96,375,141,352,143,323,142,316,136,310,130,291,130\u0027 }\r\n      ui.regions[\u0027un\u0027] = {t: ui.ToolBar_Text[\u0027un\u0027], m: \u0027205,52,202,48,203,45,208,43,215,43,218,44,223,46,227,48,232,48,239,48,240,49,239,53,242,60,243,65,237,76,231,77,229,75,221,75,207,53\u0027 },\r\n\r\n      ui.toolbarNode = ui.createNode(\u0027div\u0027, \u0027kmw_controls\u0027);\r\n      ui.toolbarNode.style.display=\u0027block\u0027;\r\n\r\n      var tbNode = ui.createNode(\u0027a\u0027, \u0027kmw_controls_start\u0027, null, \u0027 \u0027);\r\n      tbNode.href = \"https://keyman.com/developer/keymanweb/\";\r\n      tbNode.target=\"_blank\";\r\n      ui.toolbarNode.appendChild(tbNode);\r\n\r\n      /* Keyboards button */\r\n      ui.keyboardsButtonNode = ui.createNode(\u0027div\u0027,\u0027kmw_btn_keyboards\u0027,\u0027kmw_button\u0027);\r\n      ui.keyboardsButtonNode.title=ui.ToolBar_Text.LanguageSelector;\r\n      var aNode = ui.createNode(\u0027a\u0027, null, \u0027kmw_button_a\u0027);\r\n      aNode.href=\u0027#\u0027;\r\n      aNode.onclick = ui.showKeyboardsPopup;\r\n      aNode.appendChild(ui.createNode(\u0027div\u0027, \u0027kmw_img_keyboards\u0027, \u0027kmw_img\u0027));\r\n      aNode.appendChild(ui.createNode(\u0027div\u0027, null, \u0027kmw_a\u0027, ui.ToolBar_Text.Keyboards));\r\n      aNode.appendChild(ui.createNode(\u0027div\u0027, null, \u0027kmw_drop\u0027));\r\n      ui.keyboardsButtonNode.appendChild(aNode);\r\n\r\n      /* Keyboards popup */\r\n      ui.selectorNode = ui.createNode(\u0027div\u0027, \u0027kmw_selector\u0027);\r\n      ui.regionsNode = ui.createNode(\u0027div\u0027, \u0027kmw_selector_regions\u0027);\r\n      var imgNode;\r\n      ui.browseMapNode = ui.createNode(\u0027div\u0027, \u0027kmw_browsemap\u0027);\r\n      imgNode = ui.createNode(\u0027img\u0027, \u0027kmw_region_browsemap\u0027);\r\n      imgNode.src= util[\u0027getOption\u0027](\u0027resources\u0027)+\u0027ui/toolbar/blank.gif\u0027;\r\n      imgNode.useMap = \u0027#kmw_worldgrey16\u0027;\r\n      ui.browseMapNode.appendChild(imgNode);\r\n\r\n      var areaNode, mapNode = ui.createNode(\u0027map\u0027, \u0027kmw_worldgrey16\u0027);\r\n      mapNode.name=\u0027kmw_worldgrey16\u0027;\r\n      for(var i in ui.regions)\r\n      {\r\n        areaNode = ui.createNode(\u0027area\u0027);\r\n        areaNode.shape = \u0027poly\u0027;\r\n        areaNode.alt = \u0027\u0027;\r\n        areaNode.href = \u0027#\u0027;\r\n        areaNode.title = ui.regions[i].t;\r\n        areaNode.hidefocus = \u0027true\u0027;\r\n        areaNode.onclick = (function(i) { return function(event) { return ui.selectRegion(event, i); } })(i);\r\n        areaNode.onmouseover = (function(i) { return function(event) { return ui.hoverRegion(event, i); } })(i);\r\n        areaNode.onmouseout = (function(i) { return function(event) { return ui.unhoverRegion(event, i); } })(i);\r\n        areaNode.coords = ui.regions[i].m;\r\n        mapNode.appendChild(areaNode);\r\n      }\r\n\r\n      areaNode = ui.createNode(\u0027area\u0027);\r\n      areaNode.shape = \u0027default\u0027;\r\n      areaNode.nohref = \u0027true\u0027;\r\n      areaNode.alt = \u0027\u0027;\r\n      areaNode.onclick=ui.eventCapture;   // do not close map when clicking on ocean!\r\n      mapNode.appendChild(areaNode);\r\n      ui.browseMapNode.appendChild(mapNode);\r\n      ui.regionsNode.appendChild(ui.browseMapNode);\r\n      ui.regionNodes = {};\r\n\r\n      var listNode = ui.createNode(\u0027ul\u0027);\r\n      for(i in ui.regions)\r\n      {\r\n        var itemNode = ui.createNode(\u0027li\u0027);\r\n        ui.regionNodes[i] = ui.createNode(\u0027a\u0027, null, null, ui.regions[i].t);\r\n        ui.regionNodes[i].href=\u0027#\u0027;\r\n        ui.regionNodes[i].onclick = (function(i) { return function(event) { return ui.selectRegion(event, i); } })(i);\r\n        ui.regionNodes[i].onmouseover = (function(i) { return function(event) { return ui.hoverRegion(event, i); } })(i);\r\n        ui.regionNodes[i].onmouseout = (function(i) { return function(event) { return ui.unhoverRegion(event, i); } })(i);\r\n        itemNode.appendChild(ui.regionNodes[i]);\r\n        listNode.appendChild(itemNode);\r\n      }\r\n      ui.regionsNode.appendChild(listNode);\r\n      ui.selectorNode.appendChild(ui.regionsNode);\r\n      ui.keyboardsButtonNode.appendChild(ui.selectorNode);\r\n      ui.toolbarNode.appendChild(ui.keyboardsButtonNode);\r\n\r\n      // Separator and Keyboard Off Button\r\n      ui.toolbarNode.appendChild(ui.offBarNode = ui.createNode(\u0027div\u0027, \u0027kmw_bar_off\u0027, \u0027kmw_bar\u0027));\r\n\r\n      ui.offButtonNode = ui.createNode(\u0027div\u0027, \u0027kmw_btn_off\u0027, \u0027kmw_button_selected\u0027);\r\n      aNode = ui.createNode(\u0027a\u0027, null, \u0027kmw_button_a\u0027);\r\n      aNode.href = \u0027#\u0027;\r\n      aNode.onclick = ui.offButtonClickEvent;\r\n      aNode.title = ui.ToolBar_Text.OffTitle;\r\n      aNode.appendChild(ui.createNode(\u0027div\u0027, \u0027kmw_img_off\u0027, \u0027kmw_img\u0027));\r\n      aNode.appendChild(ui.createNode(\u0027div\u0027, null, \u0027kmw_a\u0027, ui.ToolBar_Text.Off));\r\n      ui.offButtonNode.appendChild(aNode);\r\n      ui.toolbarNode.appendChild(ui.offButtonNode);\r\n\r\n      // Keyboard buttons\r\n      ui.toolbarNode.appendChild(ui.languageButtonsNode = ui.createNode(\u0027div\u0027, \u0027kmw_control_keyboards\u0027, \u0027kmw_button\u0027));\r\n\r\n      // Separator and On Screen Keyboard Button\r\n      ui.toolbarNode.appendChild(ui.oskBarNode = ui.createNode(\u0027div\u0027, \u0027kmw_bar_osk\u0027, \u0027kmw_bar\u0027));\r\n\r\n      ui.oskButtonNode = ui.createNode(\u0027div\u0027, \u0027kmw_btn_osk\u0027, \u0027kmw_button\u0027);//was \u0027kmw_button_selected\u0027\r\n      aNode = ui.createNode(\u0027a\u0027, null, \u0027kmw_button_a\u0027);\r\n      aNode.href = \u0027#\u0027;\r\n      aNode.onclick = ui.showOSK;\r\n      aNode.onmousedown = function() {\r\n        keymanweb[\u0027activatingUI\u0027](true);\r\n      };\r\n      aNode.title = ui.ToolBar_Text.ShowOSK;\r\n      aNode.appendChild(ui.createNode(\u0027div\u0027, \u0027kmw_img_osk\u0027, \u0027kmw_img\u0027));\r\n      //aNode.appendChild(ui.createNode(\u0027div\u0027, null, \u0027kmw_a\u0027, \u0027On Screen Keyboard\u0027));\r\n      ui.oskButtonNode.appendChild(aNode);\r\n      ui.toolbarNode.appendChild(ui.oskButtonNode);\r\n\r\n      ui.toolbarNode.appendChild(ui.createNode(\u0027div\u0027, \u0027kmw_controls_end\u0027, null, \u0027 \u0027));\r\n\r\n      var img = ui.createNode(\u0027div\u0027);\r\n      img.id = \u0027kmw_map_preload\u0027;\r\n      ui.toolbarNode.appendChild(img);\r\n\r\n      ui.toolbarNode.appendChild(ui.createNode(\u0027br\u0027, null, \u0027kmw_clear\u0027));\r\n\r\n      // Append toolbar node to controller\r\n      e.appendChild(ui.toolbarNode);\r\n\r\n      // Initialize map array, using a timer to allow restarting if necessary after keyboards loaded\r\n      // Note that toolbar will be displayed and enabled on completion of timeout routine\r\n      ui.updateMap = true;\r\n      if(ui.startTimer) clearTimeout(ui.startTimer);\r\n      ui.startTimer = setTimeout(ui.addKeyboardsToMap,0);\r\n\r\n      // Ensure that popups are hidden by clicking elsewhere on document\r\n      util[\u0027attachDOMEvent\u0027](document.body,\u0027click\u0027,ui.hideAllPopups,false);\r\n\r\n      // Set Europe to be the default region\r\n      ui.selectedRegion = \u0027eu\u0027;\r\n\r\n      ui.registerEvents();\r\n\r\n      // Restore focus\r\n      keymanweb[\u0027focusLastActiveElement\u0027]();\r\n    }\r\n\r\n    ui.shutdown = function() {\r\n      var root = ui.toolbarNode;\r\n      if(root) {\r\n        root.parentNode.removeChild(root);\r\n      }\r\n\r\n      root = ui._insertedElem;\r\n      if(root) {\r\n        root.parentNode.removeChild(root);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Fill the map with available keyboards when the Keyboards selector is clicked\r\n     *    after all keyboard stubs have been registered\r\n    **/\r\n    ui.addKeyboardsToMap = function()\r\n    {\r\n      // Do nothing unless a keyboard has been installed since map created\r\n      if(ui.updateMap) ui.updateMap=false; else return;\r\n\r\n      var n = 0;\r\n      ui.regionLanguageListNodes = {};\r\n\r\n      // Build list of keyboards by region and language\r\n      var Keyboards = keymanweb[\u0027getKeyboards\u0027]();\r\n\r\n      // Sort the keyboards by region and language\r\n      Keyboards.sort(ui.sortKeyboards);\r\n\r\n      // Always rebuild the map, so remove any previously created language lists\r\n      for(n=ui.regionsNode.childNodes.length; n\u003e0; n--)\r\n      {\r\n        if(ui.regionsNode.childNodes[n-1].className == \u0027kmw_selector_region\u0027)\r\n        {\r\n          ui.regionsNode.removeChild(ui.regionsNode.childNodes[n-1]);\r\n        }\r\n      }\r\n\r\n      for(var i in ui.regions)\r\n      {\r\n\r\n        ui.regionLanguageListNodes[i] = ui.createNode(\u0027div\u0027, null, \u0027kmw_selector_region\u0027);\r\n        var colNode = ui.createNode(\u0027div\u0027, null, \u0027kmw_keyboard_col\u0027);\r\n        var max = 0, count = 0, languageCode = \u0027\u0027;\r\n\r\n        // Get number of languages for the region\r\n        for(var j=0; j\u003cKeyboards.length; j++) {\r\n          // REVERT:  ensures that keyboards without visible map region get displayed SOMEWHERE.\r\n          var kbdRegion = Keyboards[j][\u0027RegionCode\u0027];\r\n          if(!ui.regions[kbdRegion]) {\r\n            // For now, we\u0027ll display them within the \u0027middle-east\u0027 region.\r\n            if(i != ui.catchAllRegion) {\r\n              continue;\r\n            }\r\n          } else if(kbdRegion != i) {\r\n            continue; // Not this region\r\n          }\r\n\r\n          // Get JUST the language code for this section.  BCP-47 codes can include more!\r\n          var bcpSubtags: string[] = keymanweb[\u0027util\u0027][\u0027getLanguageCodes\u0027](Keyboards[j][\u0027LanguageCode\u0027]);\r\n          if(bcpSubtags[0] == languageCode) continue; // Same language as previous keyboard\r\n          languageCode = bcpSubtags[0];\r\n\r\n          max++;\r\n        }\r\n        max = Number(((max+3)/4).toFixed(0));   // Get number of entries per column\r\n\r\n        // Add language list to columns for the region\r\n        languageCode=\u0027\u0027;\r\n        for(var j=0; j\u003cKeyboards.length; j++) {\r\n          // REVERT:  ensures that keyboards without visible map region get displayed SOMEWHERE.\r\n          var kbdRegion = Keyboards[j][\u0027RegionCode\u0027];\r\n          if(!ui.regions[kbdRegion]) {\r\n            // For now, we\u0027ll display them within the \u0027middle-east\u0027 region.\r\n            if(i != ui.catchAllRegion) {\r\n              continue;\r\n            }\r\n          } else if(kbdRegion != i) {\r\n            continue; // Not this region\r\n          }\r\n\r\n          var bcpSubtags: string[] = keymanweb[\u0027util\u0027][\u0027getLanguageCodes\u0027](Keyboards[j][\u0027LanguageCode\u0027]);\r\n          if(bcpSubtags[0] == languageCode) {  // Same language as previous keyboard, so add it to that entry\r\n            var x = ui.languages[languageCode].keyboards;\r\n\r\n            // While we could avoid duplicating keyboard entries that occur for multiple regions, we\u0027ll instead\r\n            // allow them to display while distinguishing them more directly.  (That part is handled later.)\r\n            if(x.push) {\r\n              x.push(Keyboards[j]);\r\n            } else {\r\n              ui.languages[languageCode].keyboards = x.concat(Keyboards[j]);\r\n            }\r\n\r\n            continue;\r\n          }\r\n\r\n          // Add a new language entry\r\n          languageCode = bcpSubtags[0];\r\n          ui.languages[languageCode] = { id: Keyboards[j][\u0027LanguageCode\u0027], name: Keyboards[j][\u0027LanguageName\u0027], keyboards: [Keyboards[j]] };\r\n\r\n          // Start a new column if necessary\r\n          if(count % max == 0 \u0026\u0026 count \u003e 0)\r\n          {\r\n            ui.regionLanguageListNodes[i].appendChild(colNode);\r\n            colNode = ui.createNode(\u0027div\u0027, null, count/max == 3 ? \u0027kmw_keyboard_col_right\u0027 : \u0027kmw_keyboard_col\u0027);\r\n          }\r\n          count++;\r\n\r\n          // Add the language to the column\r\n          var langNode = ui.createNode(\u0027div\u0027, null, \u0027kmw_language\u0027);\r\n          var aNode = ui.createNode(\u0027a\u0027, null, null, Keyboards[j][\u0027LanguageName\u0027]);\r\n          aNode.href=\u0027#\u0027;\r\n          aNode.onclick = (function(lang) { return function(event) { return ui.selectLanguage(event, lang); }; })(ui.languages[languageCode]);\r\n          langNode.appendChild(aNode);\r\n          colNode.appendChild(langNode);\r\n\r\n          n++;\r\n        }\r\n        // Finish the last column and close the list\r\n        ui.regionLanguageListNodes[i].appendChild(colNode);\r\n        ui.regionLanguageListNodes[i].appendChild(ui.createNode(\u0027div\u0027, null, \u0027kmw_clear\u0027));\r\n        ui.regionsNode.appendChild(ui.regionLanguageListNodes[i]);\r\n      }\r\n      ui.loadCookie();\r\n\r\n      // Ensure that the correct region has been selected\r\n      ui.selectRegion(null, ui.selectedRegion);\r\n      ui.enableControls();\r\n\r\n      // When a keyboard is activated before init is complete,\r\n      // the toolbar needs to refresh the loaded keyboard\r\n      if(ui.lastSelectedKeyboard) {\r\n        ui.changeKeyboardEvent(ui.lastSelectedKeyboard);\r\n      }\r\n\r\n      // Restore focus\r\n      keymanweb[\u0027focusLastActiveElement\u0027]();\r\n    }\r\n\r\n    /**\r\n     * Sort keyboards array returned from keymanweb by region and language\r\n     *\r\n     * @param       {Object}  a\r\n     * @param       {Object}  b\r\n     * @return      {number}\r\n     **/\r\n    ui.sortKeyboards = function(a,b)\r\n    {\r\n      if(a[\u0027RegionCode\u0027] \u003c b[\u0027RegionCode\u0027]) return -2;\r\n      if(a[\u0027RegionCode\u0027] \u003e b[\u0027RegionCode\u0027]) return 2;\r\n      if(a[\u0027LanguageName\u0027] \u003c b[\u0027LanguageName\u0027]) return -1;\r\n      if(a[\u0027LanguageName\u0027] \u003e b[\u0027LanguageName\u0027]) return 1;\r\n      return 0;\r\n    }\r\n\r\n    /* KeymanWeb Interfaces */\r\n\r\n    /**\r\n     * Function     findListedKeyboard\r\n     * Scope        Private\r\n     * @param       {Object}  lang\r\n     * @return      {?number}\r\n     * Description  Test if a keyboard is still shown on the toolbar.  Returns index of keyboard in listedKeyboards or null if not found\r\n     */\r\n    ui.findListedKeyboard = function(lang)\r\n    {\r\n      for(var i = 0; i \u003c ui.listedKeyboards.length; i++)\r\n        if(ui.listedKeyboards[i].lang.id == lang.id) return i;\r\n      return null;\r\n    }\r\n\r\n    /**\r\n     * Add a keyboard to the list of keyboards available for a language\r\n     *\r\n     * @param       {Object}  lang\r\n     * @param       {Object}  kbd\r\n     **/\r\n    ui.addKeyboardToList = function(lang,kbd)\r\n    {\r\n      var found = ui.findListedKeyboard(lang);\r\n      if(found == null)\r\n      {\r\n        // Add the button\r\n        if(ui.listedKeyboards.length \u003e= ui.maxListedKeyboards)\r\n        {\r\n          var oldestPriority = 0x7fffffff, oldestFound = null;\r\n\r\n          for(var i = 0; i \u003c ui.listedKeyboards.length; i++)\r\n            if(ui.listedKeyboards[i].priority \u003c oldestPriority)\r\n            {\r\n              oldestFound = i;\r\n              oldestPriority = ui.listedKeyboards[i].priority;\r\n            }\r\n\r\n          // delete the oldest used control\r\n          if(oldestFound != null)\r\n          {\r\n            var rk = ui.listedKeyboards[oldestFound];\r\n            ui.langKeyboardListNodes[rk.lang.id] = null;\r\n            ui.langKeyboardNodes[rk.lang.id] = null;\r\n            ui.languageButtonsNode.removeChild(rk.buttonNode);\r\n            if(oldestFound == 0)\r\n              ui.listedKeyboards = ui.listedKeyboards.slice(oldestFound + 1);\r\n            else if(oldestFound == ui.listedKeyboards.length - 1)\r\n              ui.listedKeyboards = ui.listedKeyboards.slice(0, oldestFound);\r\n            else\r\n              ui.listedKeyboards = ui.listedKeyboards.slice(0, oldestFound).concat(ui.listedKeyboards.slice(oldestFound+1));\r\n          }\r\n        }\r\n        var buttonNode = ui.createNode(\u0027div\u0027, null/*\u0027kmw_button_keyboard_\u0027+lang.id*/, \u0027kmw_button\u0027);\r\n        var aNode = ui.createNode(\u0027a\u0027, null, \u0027kmw_button_a\u0027+(lang.keyboards.length\u003e1 ? \u0027 kmw_norightgap\u0027 : \u0027\u0027));\r\n        aNode.href=\u0027#\u0027;\r\n\r\n        var p1=ui.ToolBar_Text[\u0027SelectKeyboardPre\u0027]+kbd[\u0027Name\u0027],p2=ui.ToolBar_Text[\u0027SelectKeyboardSuf\u0027];\r\n        if(p1.toLowerCase().indexOf(p2.toLowerCase()) \u003c 0) p1=p1+\u0027 \u0027+ p2;\r\n        aNode.title = p1;\r\n        aNode.onclick = function(event) { return ui.selectLanguage(event, lang) };\r\n        aNode.appendChild(ui.createNode(\u0027div\u0027, \u0027kmw_img_kbd\u0027, \u0027kmw_img\u0027));\r\n\r\n        ui.lgText=ui.truncate(lang.name,28);\r\n        aNode.appendChild(ui.createNode(\u0027div\u0027, null, \u0027kmw_a\u0027, ui.lgText));\r\n        buttonNode.appendChild(aNode);\r\n\r\n        var thisANode = aNode;\r\n\r\n        if(lang.keyboards.length \u003e 1) {\r\n          aNode = ui.createNode(\u0027a\u0027, null, \u0027kmw_button_a kmw_noleftgap\u0027);\r\n          aNode.href = \u0027#\u0027;\r\n          aNode.title = ui.ToolBar_Text[\u0027AltKeyboardsPre\u0027]+lang.name+ui.ToolBar_Text[\u0027AltKeyboardsSuf\u0027];\r\n          aNode.onclick = function(event) { return ui.showKeyboardsForLanguage(event, lang) };\r\n          var divNode = ui.createNode(\u0027div\u0027, null, \u0027kmw_a\u0027);\r\n          var kbdText=ui.truncate(kbd[\u0027Name\u0027].replace(/\\s?keyboard/i,\u0027\u0027),40-ui.lgText.length);\r\n          divNode.appendChild(ui.langKeyboardNodes[lang.id] = ui.createNode(\u0027span\u0027, null, \u0027kmw_kbd\u0027, kbdText));\r\n          aNode.appendChild(divNode);\r\n          aNode.appendChild(ui.createNode(\u0027div\u0027, null, \u0027kmw_drop\u0027));\r\n          buttonNode.appendChild(aNode);\r\n\r\n          ui.langKeyboardListNodes[lang.id] = ui.createNode(\u0027ul\u0027, null, \u0027kmw_selector_kbd\u0027);\r\n          ui.langKeyboardListNodes[lang.id].style.display=\u0027none\u0027;\r\n\r\n          for(var n in lang.keyboards) {\r\n            var itemNode = ui.createNode(\u0027li\u0027);\r\n            kbdText = lang.keyboards[n][\u0027Name\u0027].replace(/\\s?keyboard/i,\u0027\u0027);\r\n            // We append the full BCP-47 code here for disambiguation when regional and/or script variants exist.\r\n            kbdText = kbdText + \" [\" + lang.keyboards[n][\u0027LanguageCode\u0027] + \"]\";\r\n            aNode = ui.createNode(\u0027a\u0027, null, null, kbdText);\r\n            aNode.href = \u0027#\u0027;\r\n            aNode.title = \u0027\u0027;\r\n            aNode.onclick = (function(lang,kbd) { return function(event) { return ui.selectKeyboard(event, lang, kbd, true); } })(lang, lang.keyboards[n]);\r\n\r\n            itemNode.appendChild(aNode);\r\n            ui.langKeyboardListNodes[lang.id].appendChild(itemNode);\r\n          }\r\n          buttonNode.appendChild(ui.langKeyboardListNodes[lang.id]);\r\n        }\r\n\r\n        ui.languageButtonsNode.appendChild(buttonNode);\r\n\r\n        var thisLang = lang, thisButtonNode = buttonNode;\r\n        ui.listedKeyboards.push({priority: ui.keyboardListPriority++, lang:thisLang, keyboard:kbd, buttonNode:thisButtonNode, aNode:thisANode});\r\n      }\r\n      else\r\n      {\r\n        ui.listedKeyboards[found].priority = ui.keyboardListPriority++;\r\n        ui.listedKeyboards[found].keyboard = kbd;\r\n        var e = ui.langKeyboardNodes[lang.id];\r\n        if(e)\r\n        {\r\n          var kbdText=kbd[\u0027Name\u0027].replace(/\\s?keyboard/i,\u0027\u0027);\r\n          e.innerHTML = ui.truncate(kbdText,40-ui.lgText.length);\r\n        }\r\n        if(ui.listedKeyboards[found].aNode)\r\n        {\r\n          var p1=ui.ToolBar_Text[\u0027SelectKeyboardPre\u0027]+kbd[\u0027Name\u0027],p2=ui.ToolBar_Text[\u0027SelectKeyboardSuf\u0027];\r\n          if(p1.toLowerCase().indexOf(p2.toLowerCase()) \u003c 0) p1=p1+\u0027 \u0027+ p2;\r\n          ui.listedKeyboards[found].aNode.title = p1;\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     *  Truncate a long name and add an ellipsis\r\n     *\r\n     *  @param  {string}  PName   string that may need to be truncated\r\n     *  @param  {number}  PLen    max non-truncated length\r\n     *  @return {string}          string, truncated with ellipsis if necessary\r\n     *\r\n     **/\r\n    ui.truncate = function(PName,PLen)\r\n    {\r\n      if(PName.length \u003c=PLen) return PName;\r\n      return PName.substr(0,PLen-1)+\u0027\\u2026\u0027;\r\n    }\r\n\r\n    /**\r\n     * Rebuild the entire keyboard list whenever a keyboard is installed\r\n     * (without necessarily loading the keyboard)\r\n     *\r\n     * @param       {Object}  p Keyboard metadata object\r\n     **/\r\n    ui.registerKeyboard = function(p)\r\n    {\r\n      ui.updateMap = true;\r\n      if(ui.startTimer) clearTimeout(ui.startTimer);\r\n      ui.startTimer = setTimeout(ui.addKeyboardsToMap,0);\r\n    }\r\n    keymanweb[\u0027addEventListener\u0027](\u0027keyboardregistered\u0027,ui.registerKeyboard);\r\n\r\n    var keyboardsForLangPopup = null;\r\n\r\n    /**\r\n     * Function     hideKeyboardsForLanguage\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @return      {boolean}\r\n     * Description  Hide the list of keyboards for this language\r\n     **/\r\n    ui.hideKeyboardsForLanguage = function(event)\r\n    {\r\n      var e = ui.keyboardsForLangPopup;\r\n      if(e) e.style.display=\u0027none\u0027;\r\n      ui.CancelPopupDismissal(ui.hideKeyboardsForLanguage);\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Display the list of keyboards for this language\r\n     *\r\n     * @param       {Object}  event\r\n     * @param       {Object}  lang\r\n     * @return      {boolean}\r\n     *\r\n     **/\r\n    ui.showKeyboardsForLanguage = function(event, lang)\r\n    {\r\n      ui.hideKeyboardsPopup(event);\r\n      var e = ui.langKeyboardListNodes[lang.id];\r\n      if(e)\r\n      {\r\n        if(e.style.display==\u0027block\u0027) return ui.hideKeyboardsForLanguage(event);\r\n        e.style.display=\u0027block\u0027;\r\n        ui.keyboardsForLangPopup = e;\r\n        ui.SetupPopupDismissal(e, ui.hideKeyboardsForLanguage);\r\n      }\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Select the language, and either select the keyboard (if unique) or display the list of keyboards\r\n     * available for this language\r\n     *\r\n     * @param       {Object}  event\r\n     * @param       {Object}  lang\r\n     * @return      {boolean}\r\n     **/\r\n    ui.selectLanguage = function(event, lang)\r\n    {\r\n      var found=ui.findListedKeyboard(lang), kbd = null;\r\n\r\n      if(found == null)\r\n        kbd = lang.keyboards[0];\r\n      else\r\n        kbd = ui.listedKeyboards[found].keyboard;\r\n      if(!kbd) return false;\r\n\r\n      return ui.selectKeyboard(event,lang,kbd,true);\r\n    }\r\n\r\n    /**\r\n     * Enable a selected keyboard\r\n     *\r\n     * @param       {Object}  event\r\n     * @param       {Object}  lang\r\n     * @param       {Object}  kbd\r\n     * @param       {boolean} updateKeyman\r\n     * @return      {boolean}\r\n     **/\r\n    ui.selectKeyboard = function(event,lang,kbd,updateKeyman:boolean) {\r\n      keymanweb[\u0027activatingUI\u0027](true);\r\n      if(ui.selectedLanguage) {\r\n        var found = ui.findListedKeyboard(ui.selectedLanguage);\r\n        if(found != null) {\r\n          ui.listedKeyboards[found].buttonNode.className = \u0027kmw_button\u0027;\r\n        }\r\n      }\r\n\r\n      ui.offButtonNode.className = \u0027kmw_button\u0027;\r\n      ui.selectedLanguage = lang;\r\n      ui.selectedKeyboard = kbd;\r\n\r\n      // In 12.0, this UI class has only been partially converted to BCP-47.\r\n      // `lang.id` refers to the base language identifier and will NOT include\r\n      // any subtags.  We want the FULL language identifier here, with subtags.\r\n      ui.SelectedLanguage = kbd.LanguageCode;\r\n\r\n      // Return focus to input area and activate the selected keyboard\r\n      ui.setLastFocus(); //*****this seems out of sequence???\r\n      ui.addKeyboardToList(lang, kbd);\r\n      if(updateKeyman) {\r\n        keymanweb[\u0027setActiveKeyboard\u0027](kbd[\u0027InternalName\u0027], kbd[\u0027LanguageCode\u0027]);\r\n      }\r\n      ui.listedKeyboards[ui.findListedKeyboard(lang)].buttonNode.className = \u0027kmw_button_selected\u0027;\r\n\r\n      // Always save current state when selecting a keyboard\r\n      ui.saveCookie();\r\n      ui.enableControls();\r\n      keymanweb[\u0027activatingUI\u0027](false);\r\n      return ui.hideKeyboardsPopup(event) || ui.hideKeyboardsForLanguage(event);\r\n    }\r\n\r\n    /**\r\n     * Enable all UI controls\r\n     *\r\n     * @return      {boolean}\r\n     **/\r\n    ui.enableControls = function()\r\n    {\r\n      var elems=[ui.offButtonNode, ui.offBarNode, ui.oskButtonNode, ui.oskBarNode],hideOskButton=false;\r\n\r\n      if(keymanweb[\u0027isCJK\u0027](ui.selectedKeyboard)) hideOskButton = true;\r\n      else if(ui.selectedKeyboard == null) hideOskButton = (elems[2].style.display == \u0027none\u0027)\r\n\r\n      if(ui.selectedKeyboard != null || ui.listedKeyboards.length \u003e 0)\r\n      {\r\n        for(var i = 0; i \u003c elems.length; i++)\r\n          elems[i].style.display=\u0027\u0027;\r\n      }\r\n      else\r\n      {\r\n        for(var i = 0; i \u003c elems.length; i++)\r\n          elems[i].style.display=\u0027none\u0027;\r\n      }\r\n\r\n      if(hideOskButton)\r\n        ui.oskButtonNode.style.display = ui.oskBarNode.style.display = \u0027none\u0027;\r\n\r\n      else if(ui.selectedKeyboard == null)\r\n        ui.oskButtonNode.className=\u0027kmw_button_disabled\u0027;\r\n      //else\r\n      //  ui.oskButtonNode.className=(osk \u0026\u0026 osk[\u0027isEnabled\u0027]() ? \u0027kmw_button_selected\u0027 : \u0027kmw_button\u0027);\r\n\r\n      // Display the toolbar if still hidden\r\n      ui.toolbarNode.parentNode.style.visibility=\u0027visible\u0027;\r\n      return true;\r\n    }\r\n\r\n    /**\r\n     * Restore the focus to the last focused element\r\n     **/\r\n    ui.setLastFocus = function()\r\n    {\r\n      keymanweb[\u0027focusLastActiveElement\u0027]();\r\n    }\r\n\r\n    /**\r\n     * Display or hide the OSK according to user control. This will always force\r\n     * the focus to the last active element if currently unfocused, which is\r\n     * preferable to not having the OSK appear when the OSK button is clicked.\r\n     *\r\n     * @param       {Object}  event\r\n     * @return      {boolean}\r\n     **/\r\n    ui.showOSK = function(event)\r\n    {\r\n      let osk = keymanweb[\u0027osk\u0027];\r\n      if(!osk) {\r\n        return;\r\n      }\r\n      keymanweb[\u0027activatingUI\u0027](true);\r\n      //Toggle OSK on or off\r\n      if(osk \u0026\u0026 keymanweb[\u0027getActiveKeyboard\u0027]() != \u0027\u0027)\r\n      {\r\n        if(osk[\u0027isEnabled\u0027]()) osk[\u0027hide\u0027](); else osk[\u0027show\u0027](true);\r\n      }\r\n      ui.setLastFocus();\r\n      keymanweb[\u0027activatingUI\u0027](false);\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Function     offButtonClickEvent\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @return      {boolean}\r\n     * Description  Update the UI when all keyboards disabled by user\r\n     **/\r\n    ui.offButtonClickEvent = function(event)\r\n    {\r\n      if(ui.toolbarNode.className != \u0027kmw_controls_disabled\u0027)\r\n      {\r\n        ui.hideKeyboardsForLanguage(null);\r\n        if(ui.selectedLanguage)\r\n        {\r\n          var found = ui.findListedKeyboard(ui.selectedLanguage);\r\n          if(found != null) ui.listedKeyboards[found].buttonNode.className = \u0027kmw_button\u0027;\r\n        }\r\n        ui.selectedKeyboard = null;\r\n        ui.selectedLanguage = null;\r\n        ui.SelectedLanguage = \u0027\u0027;\r\n        ui.offButtonNode.className = \u0027kmw_button_selected\u0027;\r\n      }\r\n      // Return the focus to the input area and set the active keyboard to nothing\r\n      ui.setLastFocus();\r\n      keymanweb[\u0027setActiveKeyboard\u0027](\u0027\u0027,\u0027\u0027);\r\n\r\n      //Save current state when deselecting a keyboard (may not be needed)\r\n      ui.saveCookie();\r\n      ui.enableControls();\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Function     eventCapture\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @return      {boolean}\r\n     * Description  Browser-independent event capture\r\n     **/\r\n    ui.eventCapture = function(event)\r\n    {\r\n      if(!event) event = window.event;\r\n      if(window.event) window.event.returnValue = false;\r\n      if(event) event.cancelBubble = true;\r\n\r\n      return false;\r\n    }\r\n\r\n    /**\r\n     * Function     selectRegion\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @param       {string}  region\r\n     * @return      {boolean}\r\n     * Description  Select the region for which to list languages\r\n     **/\r\n    ui.selectRegion = function(event, region)\r\n    {\r\n      var e = ui.browseMapNode;\r\n      if(!e) return ui.eventCapture(event);\r\n      e.className = \u0027kmw_browsemap_\u0027+region;\r\n      if(typeof(ui.regionLanguageListNodes[region]) == \u0027undefined\u0027)\r\n      {\r\n        ui.updateMap = true; ui.addKeyboardsToMap();\r\n      }\r\n      ui.regionLanguageListNodes[region].style.display=\u0027block\u0027;\r\n      ui.regionNodes[region].className=\u0027selected\u0027;\r\n      if(ui.selectedRegion != null \u0026\u0026 ui.selectedRegion != region)\r\n      {\r\n        ui.regionLanguageListNodes[ui.selectedRegion].style.display=\u0027none\u0027;\r\n        ui.regionNodes[ui.selectedRegion].className=\u0027\u0027;\r\n      }\r\n      ui.selectedRegion = region;\r\n      //ui.saveCookie();\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Function     unhoverRegion\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @param       {string}  region\r\n     * @return      {boolean}\r\n     * Description  Remove highlighting from a region\r\n     **/\r\n    ui.unhoverRegion = function(event, region)\r\n    {\r\n      ui.browseMapNode.className = (ui.selectedRegion == null ? \u0027\u0027 : \u0027kmw_browsemap_\u0027+ui.selectedRegion);\r\n      ui.regionNodes[region].className=(ui.selectedRegion==region?\u0027selected\u0027:\u0027\u0027);\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Function     hoverRegion\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @param       {string}  region\r\n     * @return      {boolean}\r\n     * Description  Highlight a hovered region\r\n     **/\r\n    ui.hoverRegion = function(event, region)\r\n    {\r\n      ui.browseMapNode.className = \u0027kmw_browsemap_\u0027+region+\u0027_sel\u0027;\r\n      ui.regionNodes[region].className=\u0027hover\u0027;\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Function     pluck\r\n     * Scope        Private\r\n     * @param       {Object}  elem\r\n     * @param       {string}  property\r\n     * @return      {*}\r\n     * Description  Get the value of an element property\r\n     **/\r\n    ui.pluck = function(elem, property) {\r\n        return elem.getAttribute ? elem.getAttribute(property) || elem[property] : elem[property];\r\n      };\r\n\r\n    /**\r\n     * Function     focusControlEvent\r\n     * Scope        Private\r\n     * @param       {Object}  params    Object containing Target element (or frame)\r\n     * @return      {boolean}\r\n     * Description  UI code to be executed on receiving focus\r\n     */\r\n    ui.focusControlEvent = function(params)\r\n    {\r\n      if(!ui.init) return true;\r\n\r\n      var t=params.target;\r\n      if(t.tagName.toLowerCase() == \u0027textarea\u0027 || (t.tagName.toLowerCase() == \u0027input\u0027 \u0026\u0026 t.type.toLowerCase() == \u0027text\u0027))\r\n      {\r\n        ui.lastActiveControl = t;\r\n        if(ui.pluck(t, \u0027kmw_disable\u0027))\r\n        {\r\n          if(ui.toolbarNode.className != \u0027kmw_controls_disabled\u0027)\r\n            ui.toolbarNode.className = \u0027kmw_controls_disabled\u0027;\r\n        }\r\n        else\r\n        {\r\n          if(ui.selectedKeyboard != null)\r\n          {\r\n            if(keymanweb[\u0027isCJK\u0027]())\r\n            {\r\n              ui.oskButtonNode.style.display = ui.oskBarNode.style.display = \u0027none\u0027;\r\n            }\r\n            else\r\n            {\r\n              let osk = keymanweb[\u0027osk\u0027];\r\n              ui.oskButtonNode.className = (osk \u0026\u0026 osk[\u0027isEnabled\u0027]()) ? \u0027kmw_button_selected\u0027 : \u0027kmw_button\u0027;\r\n            }\r\n          }\r\n\r\n          if(ui.toolbarNode.className != \u0027\u0027) ui.toolbarNode.className = \u0027\u0027;\r\n\r\n          var offsetX, offsetY;\r\n          if(t.KMW_HelpOffsetX) offsetX = t.KMW_HelpOffsetX; else offsetX = 64;\r\n          if(t.KMW_HelpOffsetY) offsetY = t.KMW_HelpOffsetY; else offsetY = 0;\r\n          ui.helpOffsetX = util[\u0027getAbsoluteX\u0027](t)+offsetX;\r\n          ui.helpOffsetY = util[\u0027getAbsoluteY\u0027](t)+t.offsetHeight+offsetY;\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n    keymanweb[\u0027addEventListener\u0027](\u0027controlfocused\u0027,ui.focusControlEvent);\r\n\r\n    /**\r\n     * Function     oncontrolblurred\r\n     * Scope        Private\r\n     * Parameters   {Object}  params  Object containing event\r\n     * @return      {boolean}\r\n     * Description  UI code to be executed on losing focus\r\n     */\r\n    ui.blurControlEvent = function(params)\r\n    {\r\n      if(!ui.init) return true;\r\n\r\n      // Must disable OSK button when not focused\r\n      if(ui.oskButtonNode.style.display != \u0027none\u0027) ui.oskButtonNode.className=\u0027kmw_button_disabled\u0027;\r\n\r\n      return true;\r\n    }\r\n    keymanweb[\u0027addEventListener\u0027](\u0027controlblurred\u0027,ui.blurControlEvent);\r\n\r\n\r\n    /**\r\n     * UI action required when keyboard changed indirectly\r\n     *\r\n     * @param       {Object}  p   keyboard selection object\r\n     * @return      {boolean}\r\n     **/\r\n\r\n    ui.lastSelectedKeyboard = null;\r\n\r\n    ui.changeKeyboardEvent = function(p)\r\n    {\r\n      ui.lastSelectedKeyboard = null;\r\n      var kbName=p[\u0027internalName\u0027],\r\n          lgName=keymanweb[\u0027util\u0027][\u0027getLanguageCodes\u0027](p[\u0027languageCode\u0027])[0];\r\n      if(lgName != \u0027\u0027 \u0026\u0026 kbName != \u0027\u0027)\r\n      {\r\n        var lg = ui.languages[lgName];\r\n        if(lg != null)\r\n        {\r\n          for(var j=0; j\u003clg.keyboards.length; j++)\r\n          {\r\n            if(lg.keyboards[j][\u0027InternalName\u0027] == kbName)\r\n            {\r\n              ui.selectKeyboard(null, lg, lg.keyboards[j], false);\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n        ui.lastSelectedKeyboard = {...p};\r\n      }\r\n      return true;\r\n    }\r\n    keymanweb[\u0027addEventListener\u0027](\u0027keyboardchange\u0027,ui.changeKeyboardEvent);\r\n\r\n\r\n    /**\r\n     * UI action when OSK displayed: restore to or update the saved OSK position\r\n     *\r\n     * @param       {Object}  oskPosition\r\n     * @return      {Object}\r\n     **/\r\n    ui.onShowOSK = function(oskPosition)\r\n    {\r\n      if(ui.init) ui.oskButtonNode.className = \u0027kmw_button_selected\u0027;\r\n      //The return valu is not currently useful, but allows for the possibility of the OSK restricting or limiting\r\n      //a UI-set position, and returning the corrected position to the UI\r\n      return oskPosition;\r\n    }\r\n\r\n    /**\r\n     * Update appearance of OSK button whenever the OSK is hidden by the user\r\n     *\r\n     * @param       {Object}  p\r\n     **/\r\n    ui.onHideOSK = function(p)\r\n    {\r\n      if(ui.init \u0026\u0026 p[\u0027HiddenByUser\u0027]) ui.oskButtonNode.className = \u0027kmw_button\u0027;\r\n    }\r\n\r\n\r\n    ui.registerEvents = function() {\r\n      let osk = keymanweb[\u0027osk\u0027];\r\n      if(!osk) {\r\n        return;\r\n      }\r\n\r\n      osk[\u0027addEventListener\u0027](\u0027show\u0027,ui.onShowOSK);\r\n      osk[\u0027addEventListener\u0027](\u0027hide\u0027,ui.onHideOSK);\r\n    }\r\n\r\n    /**\r\n     * Function     showKeyboardsPopup\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @return      {boolean}\r\n     * Description  Update the map when displayed\r\n     **/\r\n    ui.showKeyboardsPopup = function(event)\r\n    {\r\n      // Add any newly available keyboards to the map\r\n      ui.addKeyboardsToMap();\r\n\r\n      if(ui.toolbarNode.className == \u0027kmw_controls_disabled\u0027) return ui.eventCapture(event);\r\n      ui.hideKeyboardsForLanguage(null);\r\n      if(ui.selectorNode.className==\u0027kmw_over\u0027) return ui.hideKeyboardsPopup(event);\r\n      ui.selectorNode.className=\u0027kmw_over\u0027;\r\n      ui.keyboardsButtonNode.className=\u0027kmw_button_selected\u0027;\r\n\r\n      ui.SetupPopupDismissal(ui.selectorNode, ui.hideKeyboardsPopup);\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Function     hideKeyboardsPopup\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @return      {boolean}\r\n     * Description  Hide the list of keyboards for this language\r\n     **/\r\n    ui.hideKeyboardsPopup = function(event)\r\n    {\r\n      ui.selectorNode.className=\u0027\u0027;\r\n      ui.keyboardsButtonNode.className=\u0027kmw_button\u0027;\r\n      ui.CancelPopupDismissal(ui.hideKeyboardsPopup);\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    /**\r\n     * Hide both language and keyboard selection popups on body click\r\n     * @param   {Object}  event\r\n     * @return  {boolean}\r\n    **/\r\n    ui.hideAllPopups = function(event)\r\n    {\r\n      var e = ui.keyboardsForLangPopup;\r\n      if((!e || (e.style.display ==\u0027none\u0027)) \u0026\u0026 (ui.selectorNode.className == \u0027\u0027)) return true;\r\n      ui.hideKeyboardsPopup(event);\r\n      ui.hideKeyboardsForLanguage(event);\r\n      return ui.eventCapture(event);\r\n    }\r\n\r\n    var dismissalCallback = null, popupElement = null, lastDismissalCallback = null;\r\n\r\n    /**\r\n     * Function     PopupDismissal\r\n     * Scope        Private\r\n     * @param       {Object}  event\r\n     * @return      {Object}\r\n     * Description  Carry out action when popup dismissed\r\n     **/\r\n    ui.PopupDismissal = function(event)\r\n    {\r\n      var t = (event \u0026\u0026 event.target) || (window.event \u0026\u0026 window.event.srcElement);\r\n      if(t)\r\n      {\r\n        while(t.parentNode)\r\n        {\r\n          if (t == popupElement) return null;\r\n          t = t.parentNode;\r\n        }\r\n      }\r\n      if(t.nodeName == \u0027#document\u0027) ui.hideAllPopups(event); //KMEW-41, fixed for build 356.\r\n      return dismissalCallback;\r\n    }\r\n\r\n    /**\r\n     * Function     SetupPopupDismissal\r\n     * Scope        Private\r\n     * @param       {Object}            element\r\n     * @param       {function(Object)}  callback\r\n     * Description  Prepare for callback dismissal\r\n     **/\r\n    ui.SetupPopupDismissal = function(element, callback)\r\n    {\r\n      if(ui.PopupDismissal == document.onclick)\r\n        ui.CancelPopupDismissal(dismissalCallback);\r\n      dismissalCallback = callback;\r\n      popupElement = element;\r\n      lastDismissalCallback = document.onclick;\r\n      document.onclick = ui.PopupDismissal;\r\n    }\r\n\r\n    /**\r\n     * Function     CancelPopupDismissal\r\n     * Scope        Private\r\n     * @param       {?function(Object)}  callback\r\n     * Description  Cancel callback dismissal\r\n     **/\r\n    ui.CancelPopupDismissal = function(callback)\r\n    {\r\n      if(ui.PopupDismissal == document.onclick)\r\n      {\r\n        document.onclick = lastDismissalCallback;\r\n        lastDismissalCallback = null;\r\n        dismissalCallback = null;\r\n        popupElement = null;\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Load the previous state from the KeymanWeb_Keyboard and KeymanWeb_Toolbar cookies\r\n     **/\r\n    ui.loadCookie = function()\r\n    {\r\n      var currentKeyboard=\u0027\u0027,currentLgCode=\u0027\u0027,c=util[\u0027loadCookie\u0027](\"KeymanWeb_Keyboard\");\r\n      if(c[\u0027current\u0027] != undefined) currentKeyboard = c[\u0027current\u0027].split(\u0027:\u0027)[0];\r\n      c=util[\u0027loadCookie\u0027](\"KeymanWeb_Toolbar\");\r\n\r\n      if(c[\u0027region\u0027] != undefined) ui.selectedRegion = c[\u0027region\u0027];\r\n      if(c[\u0027maxrecent\u0027] != undefined)\r\n      {\r\n        for(var i=0; i\u003cc[\u0027maxrecent\u0027]; i++)\r\n        {\r\n          if(c[\u0027recent\u0027+i] != undefined)\r\n          {\r\n            var r=c[\u0027recent\u0027+i].split(\u0027,\u0027);\r\n            if(r.length == 2)\r\n            {\r\n              var k = ui.languages[r[0]];\r\n              if(k != null)\r\n              {\r\n                for(var j=0; j\u003ck.keyboards.length; j++)\r\n                {\r\n                  if(k.keyboards[j][\u0027InternalName\u0027] == r[1])\r\n                  {\r\n                    ui.addKeyboardToList(k, k.keyboards[j]);\r\n                    if(k.keyboards[j][\u0027InternalName\u0027] == currentKeyboard)\r\n                    {\r\n                      ui.selectKeyboard(null, k, k.keyboards[j], true);\r\n                      window.focus(); ui.setLastFocus();\r\n                      break;\r\n                    }\r\n                    break;\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n      // If language list and keyboard list have not yet been saved as a cookie,\r\n      // initialize to the current (default) language and keyboard, if set by KMW\r\n      else\r\n      {\r\n        var kbName=keymanweb[\u0027getActiveKeyboard\u0027](),\r\n            lgName=keymanweb[\u0027getActiveLanguage\u0027]();\r\n        if(lgName != \u0027\u0027 \u0026\u0026 kbName != \u0027\u0027)\r\n        {\r\n          var lg = ui.languages[lgName];\r\n          if(lg != null)\r\n          {\r\n            for(var j=0; j\u003clg.keyboards.length; j++)\r\n            {\r\n              if(lg.keyboards[j][\u0027InternalName\u0027] == kbName)\r\n              {\r\n                ui.selectKeyboard(null, lg, lg.keyboards[j], true);\r\n                window.focus(); ui.setLastFocus();\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Save the current UI state in the KeymanWeb_Toolbar cookie\r\n     **/\r\n    ui.saveCookie = function()\r\n    {\r\n      var vs={};\r\n      vs[\u0027region\u0027] = ui.selectedRegion;\r\n      vs[\u0027maxrecent\u0027] = \u0027\u0027+ui.listedKeyboards.length;\r\n      for(var i=0; i\u003cui.listedKeyboards.length; i++)\r\n        vs[\u0027recent\u0027+i] = ui.listedKeyboards[i].lang.id+\",\"+ui.listedKeyboards[i].keyboard[\u0027InternalName\u0027];\r\n      util[\u0027saveCookie\u0027](\u0027KeymanWeb_Toolbar\u0027,vs);\r\n    }\r\n\r\n    // Initialize when everything defined (replaces unreliable onload event handler)\r\n    // In case the toolbar script loads a bit later than the main KMW script\r\n    // (may happen in unit testing)\r\n    ui.initToolbarUI(); // equivalent to ui.Initialize() from the other UI modules\r\n  } catch(ex){}\r\n}"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","window","keymanweb","util","init","toolbarNode","backgroundNode","browseMapNode","keyboardsButtonNode","languageButtonsNode","offButtonNode","offBarNode","oskButtonNode","oskBarNode","selectorNode","regionLanguageListNodes","regionNodes","langKeyboardNodes","langKeyboardListNodes","selectedRegion","listedKeyboards","catchAllRegion","keyboardListPriority","maxListedKeyboards","lastActiveControl","selectedKeyboard","selectedLanguage","helpOffsetX","helpOffsetY","languages","updateMap","startTimer","lgText","ui","ToolBar_Text","Keyboards","OffTitle","Off","ShowOSK","LanguageSelector","createNode","ui.createNode","tag","id","className","innerHTML","node","document","createElement","ondragstart","node.ondragstart","initToolbarUI","ui.initToolbarUI","e","getElementById","body","insertBefore","firstChild","_insertedElem","style","visibility","maxHeight","regions","m","display","tbNode","href","target","appendChild","title","aNode","onclick","showKeyboardsPopup","regionsNode","imgNode","src","useMap","mapNode","name","areaNode","shape","alt","hidefocus","event","selectRegion","onmouseover","hoverRegion","onmouseout","unhoverRegion","coords","nohref","eventCapture","listNode","itemNode","offButtonClickEvent","showOSK","onmousedown","aNode.onmousedown","img","clearTimeout","setTimeout","addKeyboardsToMap","hideAllPopups","registerEvents","shutdown","ui.shutdown","root","parentNode","removeChild","ui.addKeyboardsToMap","sort","sortKeyboards","childNodes","colNode","max","count","languageCode","j","kbdRegion","bcpSubtags","Number","toFixed","x","keyboards","push","concat","langNode","lang","selectLanguage","loadCookie","enableControls","lastSelectedKeyboard","changeKeyboardEvent","ui.sortKeyboards","a","b","findListedKeyboard","ui.findListedKeyboard","addKeyboardToList","ui.addKeyboardToList","kbd","found","oldestPriority","oldestFound","priority","rk","buttonNode","slice","p1","p2","toLowerCase","indexOf","aNode.onclick","truncate","thisANode","showKeyboardsForLanguage","divNode","kbdText","replace","selectKeyboard","keyboard","ui.truncate","PName","PLen","substr","registerKeyboard","ui.registerKeyboard","hideKeyboardsForLanguage","ui.hideKeyboardsForLanguage","keyboardsForLangPopup","CancelPopupDismissal","ui.showKeyboardsForLanguage","hideKeyboardsPopup","SetupPopupDismissal","ui.selectLanguage","ui.selectKeyboard","updateKeyman","SelectedLanguage","LanguageCode","setLastFocus","saveCookie","ui.enableControls","elems","hideOskButton","ui.setLastFocus","ui.showOSK","osk","ui.offButtonClickEvent","ui.eventCapture","returnValue","cancelBubble","ui.selectRegion","region","ui.unhoverRegion","ui.hoverRegion","pluck","ui.pluck","elem","getAttribute","property","focusControlEvent","ui.focusControlEvent","params","tagName","type","offsetX","KMW_HelpOffsetX","offsetY","KMW_HelpOffsetY","offsetHeight","blurControlEvent","ui.blurControlEvent","ui.changeKeyboardEvent","kbName","lgName","lg","onShowOSK","ui.onShowOSK","oskPosition","onHideOSK","ui.onHideOSK","ui.registerEvents","ui.showKeyboardsPopup","ui.hideKeyboardsPopup","ui.hideAllPopups","dismissalCallback","popupElement","lastDismissalCallback","PopupDismissal","ui.PopupDismissal","srcElement","nodeName","ui.SetupPopupDismissal","element","callback","ui.CancelPopupDismissal","ui.loadCookie","currentKeyboard","c","undefined","split","r","k","focus","ui.saveCookie","vs","ex"],"sourceRoot":"/keyman/web/source/"}
